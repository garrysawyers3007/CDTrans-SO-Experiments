2022-04-13 16:22:57,409 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_2
2022-04-13 16:22:57,409 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2)
2022-04-13 16:22:57,409 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 16:22:57,409 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 16:22:57,409 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 16:23:06,649 reid_baseline.train INFO: start training
2022-04-13 16:23:21,418 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.100, Acc: 0.363, Base Lr: 8.72e-04
2022-04-13 16:23:29,054 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.147[s] Speed: 109.2[samples/s]
2022-04-13 16:23:58,282 reid_baseline.train INFO: normal accuracy 0.3974799541809851 4.171079635620117 
2022-04-13 16:23:59,561 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 16:23:59,561 reid_baseline.train INFO: Accuracy: 39.7% Mean Entropy: 417.1%
2022-04-13 16:24:19,589 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.713, Acc: 0.681, Base Lr: 1.66e-03
2022-04-13 16:24:28,491 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.190[s] Speed: 84.1[samples/s]
2022-04-13 16:25:01,622 reid_baseline.train INFO: normal accuracy 0.41741122565864835 4.145342826843262 
2022-04-13 16:25:03,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 16:25:03,009 reid_baseline.train INFO: Accuracy: 41.7% Mean Entropy: 414.5%
2022-04-13 16:25:22,827 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.012, Acc: 0.703, Base Lr: 2.46e-03
2022-04-13 16:25:33,181 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.198[s] Speed: 80.6[samples/s]
2022-04-13 16:26:01,510 reid_baseline.train INFO: normal accuracy 0.4309278350515464 3.9870083332061768 
2022-04-13 16:26:02,986 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 16:26:02,986 reid_baseline.train INFO: Accuracy: 43.1% Mean Entropy: 398.7%
2022-04-13 16:26:27,274 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.287, Acc: 0.712, Base Lr: 3.25e-03
2022-04-13 16:26:37,095 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.224[s] Speed: 71.6[samples/s]
2022-04-13 16:27:09,379 reid_baseline.train INFO: normal accuracy 0.47056128293241695 3.4949097633361816 
2022-04-13 16:27:10,502 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 16:27:10,502 reid_baseline.train INFO: Accuracy: 47.1% Mean Entropy: 349.5%
2022-04-13 16:27:30,645 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.739, Acc: 0.790, Base Lr: 4.04e-03
2022-04-13 16:27:41,889 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.206[s] Speed: 77.6[samples/s]
2022-04-13 16:28:12,160 reid_baseline.train INFO: normal accuracy 0.5271477663230241 2.9804391860961914 
2022-04-13 16:28:13,493 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 16:28:13,493 reid_baseline.train INFO: Accuracy: 52.7% Mean Entropy: 298.0%
2022-04-13 16:28:33,170 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.435, Acc: 0.836, Base Lr: 4.83e-03
2022-04-13 16:28:42,336 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.190[s] Speed: 84.4[samples/s]
2022-04-13 16:29:17,727 reid_baseline.train INFO: normal accuracy 0.5670103092783505 2.5711042881011963 
2022-04-13 16:29:18,790 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 16:29:18,790 reid_baseline.train INFO: Accuracy: 56.7% Mean Entropy: 257.1%
2022-04-13 16:29:39,275 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.275, Acc: 0.873, Base Lr: 5.62e-03
2022-04-13 16:29:48,997 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.199[s] Speed: 80.6[samples/s]
2022-04-13 16:30:17,570 reid_baseline.train INFO: normal accuracy 0.5809851088201604 2.311213254928589 
2022-04-13 16:30:18,846 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 16:30:18,847 reid_baseline.train INFO: Accuracy: 58.1% Mean Entropy: 231.1%
2022-04-13 16:30:42,136 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.131, Acc: 0.908, Base Lr: 6.42e-03
2022-04-13 16:30:51,026 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.210[s] Speed: 76.1[samples/s]
2022-04-13 16:31:22,750 reid_baseline.train INFO: normal accuracy 0.590836197021764 2.1102049350738525 
2022-04-13 16:31:23,905 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 16:31:23,905 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 211.0%
2022-04-13 16:31:42,981 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.053, Acc: 0.941, Base Lr: 7.21e-03
2022-04-13 16:31:54,149 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.199[s] Speed: 80.5[samples/s]
2022-04-13 16:32:26,309 reid_baseline.train INFO: normal accuracy 0.5945017182130584 2.022749662399292 
2022-04-13 16:32:27,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 16:32:27,492 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 202.3%
2022-04-13 16:32:47,294 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 0.981, Acc: 0.953, Base Lr: 4.01e-03
2022-04-13 16:32:56,870 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.193[s] Speed: 82.9[samples/s]
2022-04-13 16:33:30,730 reid_baseline.train INFO: normal accuracy 0.5947308132875143 2.04290509223938 
2022-04-13 16:33:30,732 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 16:33:30,733 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 204.3%
2022-04-13 16:33:50,408 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 0.960, Acc: 0.962, Base Lr: 3.38e-03
2022-04-13 16:34:00,100 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.193[s] Speed: 82.9[samples/s]
2022-04-13 16:34:31,976 reid_baseline.train INFO: normal accuracy 0.5938144329896907 1.92906653881073 
2022-04-13 16:34:33,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 16:34:33,492 reid_baseline.train INFO: Accuracy: 59.4% Mean Entropy: 192.9%
2022-04-13 16:34:57,141 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 0.936, Acc: 0.964, Base Lr: 2.77e-03
2022-04-13 16:35:07,024 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.220[s] Speed: 72.6[samples/s]
2022-04-13 16:35:38,824 reid_baseline.train INFO: normal accuracy 0.6011454753722795 1.992358922958374 
2022-04-13 16:35:38,825 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 16:35:38,825 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 199.2%
2022-04-13 16:35:58,766 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.918, Acc: 0.977, Base Lr: 2.20e-03
2022-04-13 16:36:08,059 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.191[s] Speed: 83.7[samples/s]
2022-04-13 16:36:40,672 reid_baseline.train INFO: normal accuracy 0.5963344788087056 1.985356330871582 
2022-04-13 16:36:40,673 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 16:36:40,673 reid_baseline.train INFO: Accuracy: 59.6% Mean Entropy: 198.5%
2022-04-13 16:37:00,457 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.905, Acc: 0.976, Base Lr: 1.66e-03
2022-04-13 16:37:10,097 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.193[s] Speed: 82.7[samples/s]
2022-04-13 16:37:38,698 reid_baseline.train INFO: normal accuracy 0.5995418098510882 1.9773465394973755 
2022-04-13 16:37:38,700 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 16:37:38,701 reid_baseline.train INFO: Accuracy: 60.0% Mean Entropy: 197.7%
2022-04-13 16:38:01,757 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.896, Acc: 0.984, Base Lr: 1.19e-03
2022-04-13 16:38:11,345 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.214[s] Speed: 74.8[samples/s]
2022-04-13 16:38:43,470 reid_baseline.train INFO: normal accuracy 0.5949599083619702 1.9348368644714355 
2022-04-13 16:38:43,472 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 16:38:43,472 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 193.5%
2022-04-13 16:39:06,037 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.883, Acc: 0.982, Base Lr: 7.78e-04
2022-04-13 16:39:18,595 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.231[s] Speed: 69.3[samples/s]
2022-04-13 16:39:48,053 reid_baseline.train INFO: normal accuracy 0.5972508591065292 2.0164411067962646 
2022-04-13 16:39:48,056 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 16:39:48,056 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 201.6%
2022-04-13 16:40:10,261 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.889, Acc: 0.984, Base Lr: 4.51e-04
2022-04-13 16:40:20,572 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.213[s] Speed: 75.0[samples/s]
2022-04-13 16:40:53,186 reid_baseline.train INFO: normal accuracy 0.5958762886597938 2.0156514644622803 
2022-04-13 16:40:53,188 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 16:40:53,189 reid_baseline.train INFO: Accuracy: 59.6% Mean Entropy: 201.6%
2022-04-13 16:41:15,946 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.888, Acc: 0.985, Base Lr: 2.11e-04
2022-04-13 16:41:26,071 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.216[s] Speed: 74.0[samples/s]
2022-04-13 16:41:57,048 reid_baseline.train INFO: normal accuracy 0.5951890034364261 1.9525339603424072 
2022-04-13 16:41:57,050 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 16:41:57,050 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 195.3%
2022-04-13 16:42:18,741 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.884, Acc: 0.979, Base Lr: 6.51e-05
2022-04-13 16:42:31,406 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-13 16:43:03,341 reid_baseline.train INFO: normal accuracy 0.5981672394043528 1.9457985162734985 
2022-04-13 16:43:03,341 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 16:43:03,342 reid_baseline.train INFO: Accuracy: 59.8% Mean Entropy: 194.6%
2022-04-13 16:43:23,826 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.878, Acc: 0.987, Base Lr: 1.60e-05
2022-04-13 16:43:34,039 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.202[s] Speed: 79.4[samples/s]
2022-04-13 16:44:11,220 reid_baseline.train INFO: normal accuracy 0.5945017182130584 1.9616438150405884 
2022-04-13 16:44:11,221 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 16:44:11,221 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 196.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_2/transformer_best_model.pth
2022-04-13 16:44:43,408 reid_baseline.train INFO: normal accuracy 0.5938144329896907 1.92906653881073 
2022-04-13 16:44:43,409 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 16:44:43,409 reid_baseline.train INFO: Accuracy: 59.4%
2022-04-13 16:45:10,445 reid_baseline.train INFO: normal accuracy 0.5175257731958763 2.0179011821746826 
2022-04-13 16:45:10,446 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 16:45:10,446 reid_baseline.train INFO: Shuffled Accuracy: 51.8%
2022-04-13 16:45:35,302 reid_baseline.train INFO: normal accuracy 0.9789864029666254 0.8357348442077637 
2022-04-13 16:45:35,303 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 16:45:35,303 reid_baseline.train INFO: Source Clean Accuracy: 97.9%
2022-04-13 16:45:42,317 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_3
2022-04-13 16:45:42,317 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3)
2022-04-13 16:45:42,317 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 16:45:42,317 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 16:45:42,318 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 16:45:55,651 reid_baseline.train INFO: start training
2022-04-13 16:46:16,099 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.105, Acc: 0.329, Base Lr: 8.72e-04
2022-04-13 16:46:26,098 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.199[s] Speed: 80.4[samples/s]
2022-04-13 16:47:02,691 reid_baseline.train INFO: normal accuracy 0.3624284077892325 4.170930862426758 
2022-04-13 16:47:03,966 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 16:47:03,967 reid_baseline.train INFO: Accuracy: 36.2% Mean Entropy: 417.1%
2022-04-13 16:47:24,974 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.746, Acc: 0.606, Base Lr: 1.66e-03
2022-04-13 16:47:34,810 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.203[s] Speed: 79.0[samples/s]
2022-04-13 16:48:03,683 reid_baseline.train INFO: normal accuracy 0.3846506300114548 4.142737865447998 
2022-04-13 16:48:05,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 16:48:05,412 reid_baseline.train INFO: Accuracy: 38.5% Mean Entropy: 414.3%
2022-04-13 16:48:28,604 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.090, Acc: 0.631, Base Lr: 2.46e-03
2022-04-13 16:48:36,725 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.206[s] Speed: 77.7[samples/s]
2022-04-13 16:49:07,813 reid_baseline.train INFO: normal accuracy 0.39862542955326463 3.9807865619659424 
2022-04-13 16:49:09,341 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 16:49:09,342 reid_baseline.train INFO: Accuracy: 39.9% Mean Entropy: 398.1%
2022-04-13 16:49:29,451 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.422, Acc: 0.657, Base Lr: 3.25e-03
2022-04-13 16:49:39,868 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.200[s] Speed: 79.8[samples/s]
2022-04-13 16:50:13,658 reid_baseline.train INFO: normal accuracy 0.4329896907216495 3.570871353149414 
2022-04-13 16:50:15,029 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 16:50:15,030 reid_baseline.train INFO: Accuracy: 43.3% Mean Entropy: 357.1%
2022-04-13 16:50:36,617 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.886, Acc: 0.729, Base Lr: 4.04e-03
2022-04-13 16:50:46,725 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.207[s] Speed: 77.2[samples/s]
2022-04-13 16:51:17,414 reid_baseline.train INFO: normal accuracy 0.4827033218785796 3.1144392490386963 
2022-04-13 16:51:18,779 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 16:51:18,779 reid_baseline.train INFO: Accuracy: 48.3% Mean Entropy: 311.4%
2022-04-13 16:51:39,942 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.585, Acc: 0.801, Base Lr: 4.83e-03
2022-04-13 16:51:49,626 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.202[s] Speed: 79.1[samples/s]
2022-04-13 16:52:21,693 reid_baseline.train INFO: normal accuracy 0.529438717067583 2.7772066593170166 
2022-04-13 16:52:23,117 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 16:52:23,118 reid_baseline.train INFO: Accuracy: 52.9% Mean Entropy: 277.7%
2022-04-13 16:52:50,762 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.394, Acc: 0.832, Base Lr: 5.62e-03
2022-04-13 16:53:01,957 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.255[s] Speed: 62.7[samples/s]
2022-04-13 16:53:37,307 reid_baseline.train INFO: normal accuracy 0.54524627720504 2.4884374141693115 
2022-04-13 16:53:38,791 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 16:53:38,791 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 248.8%
2022-04-13 16:54:03,004 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.248, Acc: 0.884, Base Lr: 6.42e-03
2022-04-13 16:54:16,547 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.247[s] Speed: 64.7[samples/s]
2022-04-13 16:54:44,760 reid_baseline.train INFO: normal accuracy 0.5564719358533792 2.345853090286255 
2022-04-13 16:54:46,237 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 16:54:46,237 reid_baseline.train INFO: Accuracy: 55.6% Mean Entropy: 234.6%
2022-04-13 16:55:03,097 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.153, Acc: 0.897, Base Lr: 7.21e-03
2022-04-13 16:55:14,466 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.185[s] Speed: 86.3[samples/s]
2022-04-13 16:55:46,632 reid_baseline.train INFO: normal accuracy 0.5594501718213059 2.1486458778381348 
2022-04-13 16:55:47,921 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 16:55:47,922 reid_baseline.train INFO: Accuracy: 55.9% Mean Entropy: 214.9%
2022-04-13 16:56:09,790 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.083, Acc: 0.931, Base Lr: 4.01e-03
2022-04-13 16:56:22,657 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-13 16:56:55,591 reid_baseline.train INFO: normal accuracy 0.5644902634593356 2.192434310913086 
2022-04-13 16:56:55,592 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 16:56:55,593 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 219.2%
2022-04-13 16:57:15,468 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.039, Acc: 0.940, Base Lr: 3.38e-03
2022-04-13 16:57:23,993 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.187[s] Speed: 85.8[samples/s]
2022-04-13 16:57:59,043 reid_baseline.train INFO: normal accuracy 0.561282932416953 2.0991029739379883 
2022-04-13 16:58:00,355 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 16:58:00,355 reid_baseline.train INFO: Accuracy: 56.1% Mean Entropy: 209.9%
2022-04-13 16:58:20,476 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.016, Acc: 0.939, Base Lr: 2.77e-03
2022-04-13 16:58:30,378 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.197[s] Speed: 81.3[samples/s]
2022-04-13 16:59:01,768 reid_baseline.train INFO: normal accuracy 0.5615120274914089 2.125211715698242 
2022-04-13 16:59:01,770 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 16:59:01,771 reid_baseline.train INFO: Accuracy: 56.2% Mean Entropy: 212.5%
2022-04-13 16:59:26,345 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.003, Acc: 0.949, Base Lr: 2.20e-03
2022-04-13 16:59:36,829 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-13 17:00:08,568 reid_baseline.train INFO: normal accuracy 0.5644902634593356 2.101743698120117 
2022-04-13 17:00:08,570 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 17:00:08,570 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 210.2%
2022-04-13 17:00:28,370 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.977, Acc: 0.960, Base Lr: 1.66e-03
2022-04-13 17:00:41,291 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.215[s] Speed: 74.5[samples/s]
2022-04-13 17:01:12,250 reid_baseline.train INFO: normal accuracy 0.563573883161512 2.064824104309082 
2022-04-13 17:01:13,483 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 17:01:13,483 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 206.5%
2022-04-13 17:01:33,635 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.966, Acc: 0.959, Base Lr: 1.19e-03
2022-04-13 17:01:43,251 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.196[s] Speed: 81.8[samples/s]
2022-04-13 17:02:18,242 reid_baseline.train INFO: normal accuracy 0.5631156930126002 2.0214686393737793 
2022-04-13 17:02:19,331 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 17:02:19,331 reid_baseline.train INFO: Accuracy: 56.3% Mean Entropy: 202.1%
2022-04-13 17:02:38,949 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.953, Acc: 0.970, Base Lr: 7.78e-04
2022-04-13 17:02:49,176 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.195[s] Speed: 82.1[samples/s]
2022-04-13 17:03:19,115 reid_baseline.train INFO: normal accuracy 0.5624284077892325 2.05908203125 
2022-04-13 17:03:19,116 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 17:03:19,116 reid_baseline.train INFO: Accuracy: 56.2% Mean Entropy: 205.9%
2022-04-13 17:03:42,223 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.959, Acc: 0.963, Base Lr: 4.51e-04
2022-04-13 17:03:53,436 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.225[s] Speed: 71.0[samples/s]
2022-04-13 17:04:23,276 reid_baseline.train INFO: normal accuracy 0.5596792668957618 2.0747365951538086 
2022-04-13 17:04:23,278 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 17:04:23,279 reid_baseline.train INFO: Accuracy: 56.0% Mean Entropy: 207.5%
2022-04-13 17:04:44,052 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.957, Acc: 0.964, Base Lr: 2.11e-04
2022-04-13 17:04:54,283 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.204[s] Speed: 78.6[samples/s]
2022-04-13 17:05:31,626 reid_baseline.train INFO: normal accuracy 0.5624284077892325 2.040402889251709 
2022-04-13 17:05:31,629 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 17:05:31,629 reid_baseline.train INFO: Accuracy: 56.2% Mean Entropy: 204.0%
2022-04-13 17:05:53,858 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.957, Acc: 0.961, Base Lr: 6.51e-05
2022-04-13 17:06:04,971 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.219[s] Speed: 73.0[samples/s]
2022-04-13 17:06:35,350 reid_baseline.train INFO: normal accuracy 0.5578465063001146 2.0274100303649902 
2022-04-13 17:06:35,350 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 17:06:35,351 reid_baseline.train INFO: Accuracy: 55.8% Mean Entropy: 202.7%
2022-04-13 17:07:01,451 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.936, Acc: 0.972, Base Lr: 1.60e-05
2022-04-13 17:07:10,757 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.232[s] Speed: 68.9[samples/s]
2022-04-13 17:07:45,240 reid_baseline.train INFO: normal accuracy 0.5578465063001146 2.0348458290100098 
2022-04-13 17:07:45,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 17:07:45,242 reid_baseline.train INFO: Accuracy: 55.8% Mean Entropy: 203.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_3/transformer_best_model.pth
2022-04-13 17:08:16,243 reid_baseline.train INFO: normal accuracy 0.5631156930126002 2.0214686393737793 
2022-04-13 17:08:16,244 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:08:16,244 reid_baseline.train INFO: Accuracy: 56.3%
2022-04-13 17:08:47,622 reid_baseline.train INFO: normal accuracy 0.4664375715922108 2.1026132106781006 
2022-04-13 17:08:47,623 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:08:47,623 reid_baseline.train INFO: Shuffled Accuracy: 46.6%
2022-04-13 17:09:07,002 reid_baseline.train INFO: normal accuracy 0.9765142150803461 0.8752188682556152 
2022-04-13 17:09:07,003 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:09:07,003 reid_baseline.train INFO: Source Clean Accuracy: 97.7%
2022-04-13 17:09:14,474 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_4
2022-04-13 17:09:14,474 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4)
2022-04-13 17:09:14,474 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 17:09:14,474 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 17:09:14,475 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 17:09:31,240 reid_baseline.train INFO: start training
2022-04-13 17:09:55,035 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.109, Acc: 0.284, Base Lr: 8.72e-04
2022-04-13 17:10:06,177 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-13 17:10:38,372 reid_baseline.train INFO: normal accuracy 0.33745704467353954 4.1711249351501465 
2022-04-13 17:10:39,567 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 17:10:39,568 reid_baseline.train INFO: Accuracy: 33.7% Mean Entropy: 417.1%
2022-04-13 17:10:59,544 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.775, Acc: 0.546, Base Lr: 1.66e-03
2022-04-13 17:11:10,411 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.203[s] Speed: 78.9[samples/s]
2022-04-13 17:11:43,840 reid_baseline.train INFO: normal accuracy 0.34914089347079036 4.145928382873535 
2022-04-13 17:11:45,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 17:11:45,492 reid_baseline.train INFO: Accuracy: 34.9% Mean Entropy: 414.6%
2022-04-13 17:12:08,258 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.159, Acc: 0.574, Base Lr: 2.46e-03
2022-04-13 17:12:17,964 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.213[s] Speed: 75.0[samples/s]
2022-04-13 17:12:46,878 reid_baseline.train INFO: normal accuracy 0.3667812142038946 4.0060648918151855 
2022-04-13 17:12:48,131 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 17:12:48,131 reid_baseline.train INFO: Accuracy: 36.7% Mean Entropy: 400.6%
2022-04-13 17:13:11,094 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.540, Acc: 0.610, Base Lr: 3.25e-03
2022-04-13 17:13:22,537 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-13 17:13:55,457 reid_baseline.train INFO: normal accuracy 0.40939289805269186 3.656644344329834 
2022-04-13 17:13:56,878 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 17:13:56,879 reid_baseline.train INFO: Accuracy: 40.9% Mean Entropy: 365.7%
2022-04-13 17:14:18,788 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.002, Acc: 0.704, Base Lr: 4.04e-03
2022-04-13 17:14:30,763 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.223[s] Speed: 71.9[samples/s]
2022-04-13 17:15:00,163 reid_baseline.train INFO: normal accuracy 0.4529209621993127 3.2414608001708984 
2022-04-13 17:15:01,499 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 17:15:01,500 reid_baseline.train INFO: Accuracy: 45.3% Mean Entropy: 324.1%
2022-04-13 17:15:22,026 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.680, Acc: 0.766, Base Lr: 4.83e-03
2022-04-13 17:15:31,831 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.199[s] Speed: 80.5[samples/s]
2022-04-13 17:16:06,935 reid_baseline.train INFO: normal accuracy 0.49805269186712486 2.9055793285369873 
2022-04-13 17:16:08,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 17:16:08,173 reid_baseline.train INFO: Accuracy: 49.8% Mean Entropy: 290.6%
2022-04-13 17:16:28,065 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.498, Acc: 0.803, Base Lr: 5.62e-03
2022-04-13 17:16:37,775 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.194[s] Speed: 82.3[samples/s]
2022-04-13 17:17:06,715 reid_baseline.train INFO: normal accuracy 0.5198167239404353 2.630380392074585 
2022-04-13 17:17:08,302 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 17:17:08,302 reid_baseline.train INFO: Accuracy: 52.0% Mean Entropy: 263.0%
2022-04-13 17:17:34,351 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.313, Acc: 0.862, Base Lr: 6.42e-03
2022-04-13 17:17:45,927 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.247[s] Speed: 64.7[samples/s]
2022-04-13 17:18:18,799 reid_baseline.train INFO: normal accuracy 0.5411225658648339 2.451982259750366 
2022-04-13 17:18:20,038 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 17:18:20,038 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 245.2%
2022-04-13 17:18:42,151 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.229, Acc: 0.884, Base Lr: 7.21e-03
2022-04-13 17:18:53,632 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-13 17:19:23,799 reid_baseline.train INFO: normal accuracy 0.5383734249713631 2.3056015968322754 
2022-04-13 17:19:25,380 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 17:19:25,381 reid_baseline.train INFO: Accuracy: 53.8% Mean Entropy: 230.6%
2022-04-13 17:19:47,934 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.140, Acc: 0.907, Base Lr: 4.01e-03
2022-04-13 17:19:59,259 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.223[s] Speed: 71.9[samples/s]
2022-04-13 17:20:39,023 reid_baseline.train INFO: normal accuracy 0.5468499427262313 2.2735342979431152 
2022-04-13 17:20:40,327 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 17:20:40,327 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 227.4%
2022-04-13 17:21:01,135 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.103, Acc: 0.911, Base Lr: 3.38e-03
2022-04-13 17:21:11,107 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.201[s] Speed: 79.4[samples/s]
2022-04-13 17:21:40,872 reid_baseline.train INFO: normal accuracy 0.5466208476517754 2.1755127906799316 
2022-04-13 17:21:42,523 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 17:21:42,524 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 217.6%
2022-04-13 17:22:06,932 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.069, Acc: 0.930, Base Lr: 2.77e-03
2022-04-13 17:22:16,924 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-13 17:22:47,456 reid_baseline.train INFO: normal accuracy 0.5489117983963345 2.231827735900879 
2022-04-13 17:22:47,458 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 17:22:47,459 reid_baseline.train INFO: Accuracy: 54.9% Mean Entropy: 223.2%
2022-04-13 17:23:09,548 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.053, Acc: 0.934, Base Lr: 2.20e-03
2022-04-13 17:23:22,069 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-13 17:23:56,042 reid_baseline.train INFO: normal accuracy 0.5482245131729668 2.219409465789795 
2022-04-13 17:23:56,042 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 17:23:56,043 reid_baseline.train INFO: Accuracy: 54.8% Mean Entropy: 221.9%
2022-04-13 17:24:16,741 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.024, Acc: 0.952, Base Lr: 1.66e-03
2022-04-13 17:24:27,109 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.204[s] Speed: 78.4[samples/s]
2022-04-13 17:24:57,760 reid_baseline.train INFO: normal accuracy 0.5489117983963345 2.1625962257385254 
2022-04-13 17:24:59,048 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 17:24:59,049 reid_baseline.train INFO: Accuracy: 54.9% Mean Entropy: 216.3%
2022-04-13 17:25:27,234 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.007, Acc: 0.947, Base Lr: 1.19e-03
2022-04-13 17:25:39,912 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.269[s] Speed: 59.6[samples/s]
2022-04-13 17:26:14,566 reid_baseline.train INFO: normal accuracy 0.547766323024055 2.1262309551239014 
2022-04-13 17:26:15,897 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 17:26:15,898 reid_baseline.train INFO: Accuracy: 54.8% Mean Entropy: 212.6%
2022-04-13 17:26:41,278 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.005, Acc: 0.954, Base Lr: 7.78e-04
2022-04-13 17:26:49,781 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-13 17:27:16,203 reid_baseline.train INFO: normal accuracy 0.5445589919816723 2.1492550373077393 
2022-04-13 17:27:16,205 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 17:27:16,205 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 214.9%
2022-04-13 17:27:36,345 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.996, Acc: 0.957, Base Lr: 4.51e-04
2022-04-13 17:27:46,609 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.200[s] Speed: 80.2[samples/s]
2022-04-13 17:28:15,829 reid_baseline.train INFO: normal accuracy 0.5461626575028636 2.168956756591797 
2022-04-13 17:28:15,832 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 17:28:15,846 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 216.9%
2022-04-13 17:28:42,332 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.001, Acc: 0.954, Base Lr: 2.11e-04
2022-04-13 17:28:53,076 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.243[s] Speed: 65.9[samples/s]
2022-04-13 17:29:25,838 reid_baseline.train INFO: normal accuracy 0.5445589919816723 2.139153480529785 
2022-04-13 17:29:25,840 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 17:29:25,841 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 213.9%
2022-04-13 17:29:46,178 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.000, Acc: 0.947, Base Lr: 6.51e-05
2022-04-13 17:29:58,615 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.215[s] Speed: 74.3[samples/s]
2022-04-13 17:30:28,996 reid_baseline.train INFO: normal accuracy 0.5427262313860252 2.1197850704193115 
2022-04-13 17:30:30,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 17:30:30,323 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 212.0%
2022-04-13 17:30:50,939 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.981, Acc: 0.953, Base Lr: 1.60e-05
2022-04-13 17:31:01,339 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.204[s] Speed: 78.5[samples/s]
2022-04-13 17:31:39,089 reid_baseline.train INFO: normal accuracy 0.5424971363115693 2.116302490234375 
2022-04-13 17:31:41,649 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 17:31:41,650 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 211.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_4/transformer_best_model.pth
2022-04-13 17:32:11,994 reid_baseline.train INFO: normal accuracy 0.5424971363115693 2.116302490234375 
2022-04-13 17:32:11,995 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:32:11,995 reid_baseline.train INFO: Accuracy: 54.2%
2022-04-13 17:32:42,881 reid_baseline.train INFO: normal accuracy 0.4240549828178694 2.1659669876098633 
2022-04-13 17:32:42,881 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:32:42,882 reid_baseline.train INFO: Shuffled Accuracy: 42.4%
2022-04-13 17:33:03,884 reid_baseline.train INFO: normal accuracy 0.9686856201071281 0.9599391222000122 
2022-04-13 17:33:03,885 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:33:03,885 reid_baseline.train INFO: Source Clean Accuracy: 96.9%
2022-04-13 17:33:10,829 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_5
2022-04-13 17:33:10,829 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=5)
2022-04-13 17:33:10,830 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 17:33:10,830 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 17:33:10,830 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 17:33:25,051 reid_baseline.train INFO: start training
2022-04-13 17:33:44,975 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.113, Acc: 0.265, Base Lr: 8.72e-04
2022-04-13 17:33:56,055 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.203[s] Speed: 79.0[samples/s]
2022-04-13 17:34:27,791 reid_baseline.train INFO: normal accuracy 0.27857961053837343 4.1712565422058105 
2022-04-13 17:34:29,234 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 17:34:29,234 reid_baseline.train INFO: Accuracy: 27.9% Mean Entropy: 417.1%
2022-04-13 17:34:49,655 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.799, Acc: 0.506, Base Lr: 1.66e-03
2022-04-13 17:34:59,736 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.200[s] Speed: 80.0[samples/s]
2022-04-13 17:35:32,131 reid_baseline.train INFO: normal accuracy 0.3131729667812142 4.147568702697754 
2022-04-13 17:35:33,351 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 17:35:33,351 reid_baseline.train INFO: Accuracy: 31.3% Mean Entropy: 414.8%
2022-04-13 17:35:56,464 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.235, Acc: 0.526, Base Lr: 2.46e-03
2022-04-13 17:36:07,709 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-13 17:36:38,409 reid_baseline.train INFO: normal accuracy 0.3418098510882016 4.026362895965576 
2022-04-13 17:36:39,664 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 17:36:39,664 reid_baseline.train INFO: Accuracy: 34.2% Mean Entropy: 402.6%
2022-04-13 17:36:59,386 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.655, Acc: 0.560, Base Lr: 3.25e-03
2022-04-13 17:37:07,850 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.185[s] Speed: 86.3[samples/s]
2022-04-13 17:37:42,029 reid_baseline.train INFO: normal accuracy 0.384192439862543 3.721254348754883 
2022-04-13 17:37:43,366 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 17:37:43,366 reid_baseline.train INFO: Accuracy: 38.4% Mean Entropy: 372.1%
2022-04-13 17:38:04,589 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.145, Acc: 0.652, Base Lr: 4.04e-03
2022-04-13 17:38:14,456 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.204[s] Speed: 78.3[samples/s]
2022-04-13 17:38:44,487 reid_baseline.train INFO: normal accuracy 0.4217640320733104 3.358806848526001 
2022-04-13 17:38:45,757 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 17:38:45,758 reid_baseline.train INFO: Accuracy: 42.2% Mean Entropy: 335.9%
2022-04-13 17:39:06,953 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.807, Acc: 0.722, Base Lr: 4.83e-03
2022-04-13 17:39:16,658 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.202[s] Speed: 79.3[samples/s]
2022-04-13 17:39:48,828 reid_baseline.train INFO: normal accuracy 0.4655211912943872 3.054037094116211 
2022-04-13 17:39:50,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 17:39:50,122 reid_baseline.train INFO: Accuracy: 46.6% Mean Entropy: 305.4%
2022-04-13 17:40:11,734 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.594, Acc: 0.772, Base Lr: 5.62e-03
2022-04-13 17:40:23,379 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.219[s] Speed: 73.2[samples/s]
2022-04-13 17:40:51,355 reid_baseline.train INFO: normal accuracy 0.4827033218785796 2.7460222244262695 
2022-04-13 17:40:52,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 17:40:52,839 reid_baseline.train INFO: Accuracy: 48.3% Mean Entropy: 274.6%
2022-04-13 17:41:13,981 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.419, Acc: 0.830, Base Lr: 6.42e-03
2022-04-13 17:41:23,628 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.202[s] Speed: 79.1[samples/s]
2022-04-13 17:41:54,504 reid_baseline.train INFO: normal accuracy 0.5003436426116838 2.5828542709350586 
2022-04-13 17:41:55,984 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 17:41:55,985 reid_baseline.train INFO: Accuracy: 50.0% Mean Entropy: 258.3%
2022-04-13 17:42:19,087 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.322, Acc: 0.854, Base Lr: 7.21e-03
2022-04-13 17:42:31,083 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-13 17:43:02,682 reid_baseline.train INFO: normal accuracy 0.5049255441008018 2.447833299636841 
2022-04-13 17:43:03,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 17:43:03,793 reid_baseline.train INFO: Accuracy: 50.5% Mean Entropy: 244.8%
2022-04-13 17:43:25,241 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.228, Acc: 0.882, Base Lr: 4.01e-03
2022-04-13 17:43:36,353 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.214[s] Speed: 74.9[samples/s]
2022-04-13 17:44:10,965 reid_baseline.train INFO: normal accuracy 0.5108820160366552 2.4052021503448486 
2022-04-13 17:44:13,300 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 17:44:13,300 reid_baseline.train INFO: Accuracy: 51.1% Mean Entropy: 240.5%
2022-04-13 17:44:33,918 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.159, Acc: 0.897, Base Lr: 3.38e-03
2022-04-13 17:44:44,948 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.208[s] Speed: 76.9[samples/s]
2022-04-13 17:45:19,045 reid_baseline.train INFO: normal accuracy 0.509049255441008 2.28488826751709 
2022-04-13 17:45:20,646 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 17:45:20,646 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 228.5%
2022-04-13 17:45:41,727 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.143, Acc: 0.904, Base Lr: 2.77e-03
2022-04-13 17:45:52,640 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.210[s] Speed: 76.1[samples/s]
2022-04-13 17:46:24,446 reid_baseline.train INFO: normal accuracy 0.5111111111111111 2.3443443775177 
2022-04-13 17:46:24,449 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 17:46:24,449 reid_baseline.train INFO: Accuracy: 51.1% Mean Entropy: 234.4%
2022-04-13 17:46:47,385 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.115, Acc: 0.922, Base Lr: 2.20e-03
2022-04-13 17:46:57,545 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.216[s] Speed: 73.9[samples/s]
2022-04-13 17:47:29,388 reid_baseline.train INFO: normal accuracy 0.5127147766323024 2.2796480655670166 
2022-04-13 17:47:30,684 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 17:47:30,684 reid_baseline.train INFO: Accuracy: 51.3% Mean Entropy: 228.0%
2022-04-13 17:47:54,315 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.087, Acc: 0.925, Base Lr: 1.66e-03
2022-04-13 17:48:05,591 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.229[s] Speed: 69.7[samples/s]
2022-04-13 17:48:36,429 reid_baseline.train INFO: normal accuracy 0.5122565864833906 2.252330780029297 
2022-04-13 17:48:37,722 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 17:48:37,722 reid_baseline.train INFO: Accuracy: 51.2% Mean Entropy: 225.2%
2022-04-13 17:48:57,765 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.082, Acc: 0.927, Base Lr: 1.19e-03
2022-04-13 17:49:06,230 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.186[s] Speed: 85.9[samples/s]
2022-04-13 17:49:40,398 reid_baseline.train INFO: normal accuracy 0.5143184421534936 2.213451862335205 
2022-04-13 17:49:41,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 17:49:41,905 reid_baseline.train INFO: Accuracy: 51.4% Mean Entropy: 221.3%
2022-04-13 17:50:05,434 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.066, Acc: 0.933, Base Lr: 7.78e-04
2022-04-13 17:50:15,817 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.223[s] Speed: 71.8[samples/s]
2022-04-13 17:50:42,966 reid_baseline.train INFO: normal accuracy 0.5131729667812142 2.2266793251037598 
2022-04-13 17:50:42,968 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 17:50:42,982 reid_baseline.train INFO: Accuracy: 51.3% Mean Entropy: 222.7%
2022-04-13 17:51:10,512 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.063, Acc: 0.939, Base Lr: 4.51e-04
2022-04-13 17:51:21,751 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.255[s] Speed: 62.8[samples/s]
2022-04-13 17:51:54,027 reid_baseline.train INFO: normal accuracy 0.51340206185567 2.275056838989258 
2022-04-13 17:51:54,028 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 17:51:54,028 reid_baseline.train INFO: Accuracy: 51.3% Mean Entropy: 227.5%
2022-04-13 17:52:13,668 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.060, Acc: 0.939, Base Lr: 2.11e-04
2022-04-13 17:52:24,974 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.203[s] Speed: 78.7[samples/s]
2022-04-13 17:52:56,970 reid_baseline.train INFO: normal accuracy 0.5129438717067583 2.2069716453552246 
2022-04-13 17:52:58,253 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 17:52:58,253 reid_baseline.train INFO: Accuracy: 51.3% Mean Entropy: 220.7%
2022-04-13 17:53:19,147 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.060, Acc: 0.933, Base Lr: 6.51e-05
2022-04-13 17:53:29,262 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.204[s] Speed: 78.5[samples/s]
2022-04-13 17:54:01,856 reid_baseline.train INFO: normal accuracy 0.5124856815578465 2.2168467044830322 
2022-04-13 17:54:01,858 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 17:54:01,859 reid_baseline.train INFO: Accuracy: 51.2% Mean Entropy: 221.7%
2022-04-13 17:54:22,757 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.046, Acc: 0.940, Base Lr: 1.60e-05
2022-04-13 17:54:33,104 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.205[s] Speed: 77.9[samples/s]
2022-04-13 17:55:05,406 reid_baseline.train INFO: normal accuracy 0.5147766323024054 2.221085548400879 
2022-04-13 17:55:05,408 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 17:55:05,408 reid_baseline.train INFO: Accuracy: 51.5% Mean Entropy: 222.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_5/transformer_best_model.pth
2022-04-13 17:55:42,210 reid_baseline.train INFO: normal accuracy 0.5129438717067583 2.2069716453552246 
2022-04-13 17:55:42,210 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:55:42,210 reid_baseline.train INFO: Accuracy: 51.3%
2022-04-13 17:56:12,043 reid_baseline.train INFO: normal accuracy 0.39083619702176403 2.2557005882263184 
2022-04-13 17:56:12,043 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:56:12,043 reid_baseline.train INFO: Shuffled Accuracy: 39.1%
2022-04-13 17:56:31,102 reid_baseline.train INFO: normal accuracy 0.9596209311907705 1.0509929656982422 
2022-04-13 17:56:31,105 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:56:31,105 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-13 17:56:39,855 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_6
2022-04-13 17:56:39,856 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-13 17:56:39,856 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 17:56:39,856 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 17:56:39,857 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 17:56:58,888 reid_baseline.train INFO: start training
2022-04-13 17:57:20,440 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.245, Base Lr: 8.72e-04
2022-04-13 17:57:31,734 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.214[s] Speed: 74.8[samples/s]
2022-04-13 17:58:04,967 reid_baseline.train INFO: normal accuracy 0.2034364261168385 4.171036243438721 
2022-04-13 17:58:06,272 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 17:58:06,272 reid_baseline.train INFO: Accuracy: 20.3% Mean Entropy: 417.1%
2022-04-13 17:58:28,341 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.820, Acc: 0.438, Base Lr: 1.66e-03
2022-04-13 17:58:41,167 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.230[s] Speed: 69.7[samples/s]
2022-04-13 17:59:04,458 reid_baseline.train INFO: normal accuracy 0.20778923253150058 4.146274566650391 
2022-04-13 17:59:05,541 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 17:59:05,541 reid_baseline.train INFO: Accuracy: 20.8% Mean Entropy: 414.6%
2022-04-13 17:59:24,494 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.300, Acc: 0.466, Base Lr: 2.46e-03
2022-04-13 17:59:34,343 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.189[s] Speed: 84.8[samples/s]
2022-04-13 18:00:04,270 reid_baseline.train INFO: normal accuracy 0.2650630011454754 4.034875392913818 
2022-04-13 18:00:05,776 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 18:00:05,777 reid_baseline.train INFO: Accuracy: 26.5% Mean Entropy: 403.5%
2022-04-13 18:00:31,480 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.788, Acc: 0.511, Base Lr: 3.25e-03
2022-04-13 18:00:40,941 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.231[s] Speed: 69.2[samples/s]
2022-04-13 18:01:05,826 reid_baseline.train INFO: normal accuracy 0.3333333333333333 3.784083366394043 
2022-04-13 18:01:08,205 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 18:01:08,205 reid_baseline.train INFO: Accuracy: 33.3% Mean Entropy: 378.4%
2022-04-13 18:01:24,605 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.302, Acc: 0.601, Base Lr: 4.04e-03
2022-04-13 18:01:33,243 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.164[s] Speed: 97.3[samples/s]
2022-04-13 18:01:54,227 reid_baseline.train INFO: normal accuracy 0.3828178694158076 3.4763545989990234 
2022-04-13 18:01:55,515 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 18:01:55,515 reid_baseline.train INFO: Accuracy: 38.3% Mean Entropy: 347.6%
2022-04-13 18:02:10,395 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.973, Acc: 0.673, Base Lr: 4.83e-03
2022-04-13 18:02:17,598 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.145[s] Speed: 110.3[samples/s]
2022-04-13 18:02:39,111 reid_baseline.train INFO: normal accuracy 0.4297823596792669 3.1814985275268555 
2022-04-13 18:02:40,384 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 18:02:40,385 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 318.1%
2022-04-13 18:02:56,138 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.735, Acc: 0.725, Base Lr: 5.62e-03
2022-04-13 18:03:02,899 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.147[s] Speed: 108.5[samples/s]
2022-04-13 18:03:21,937 reid_baseline.train INFO: normal accuracy 0.456815578465063 2.9135658740997314 
2022-04-13 18:03:23,230 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 18:03:23,230 reid_baseline.train INFO: Accuracy: 45.7% Mean Entropy: 291.4%
2022-04-13 18:03:38,767 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.531, Acc: 0.790, Base Lr: 6.42e-03
2022-04-13 18:03:49,819 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.175[s] Speed: 91.6[samples/s]
2022-04-13 18:04:22,246 reid_baseline.train INFO: normal accuracy 0.4762886597938144 2.7284533977508545 
2022-04-13 18:04:23,781 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 18:04:23,781 reid_baseline.train INFO: Accuracy: 47.6% Mean Entropy: 272.8%
2022-04-13 18:04:46,805 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.423, Acc: 0.819, Base Lr: 7.21e-03
2022-04-13 18:04:58,251 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.225[s] Speed: 71.1[samples/s]
2022-04-13 18:05:27,200 reid_baseline.train INFO: normal accuracy 0.47835051546391755 2.5620999336242676 
2022-04-13 18:05:28,530 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 18:05:28,531 reid_baseline.train INFO: Accuracy: 47.8% Mean Entropy: 256.2%
2022-04-13 18:05:50,033 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.319, Acc: 0.852, Base Lr: 4.01e-03
2022-04-13 18:06:01,008 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.213[s] Speed: 75.1[samples/s]
2022-04-13 18:06:38,128 reid_baseline.train INFO: normal accuracy 0.4868270332187858 2.5327866077423096 
2022-04-13 18:06:39,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 18:06:39,625 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 253.3%
2022-04-13 18:07:00,250 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.260, Acc: 0.867, Base Lr: 3.38e-03
2022-04-13 18:07:10,724 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.204[s] Speed: 78.3[samples/s]
2022-04-13 18:07:40,329 reid_baseline.train INFO: normal accuracy 0.4856815578465063 2.4321722984313965 
2022-04-13 18:07:44,581 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 18:07:44,582 reid_baseline.train INFO: Accuracy: 48.6% Mean Entropy: 243.2%
2022-04-13 18:08:10,308 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.233, Acc: 0.874, Base Lr: 2.77e-03
2022-04-13 18:08:19,793 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.231[s] Speed: 69.3[samples/s]
2022-04-13 18:08:51,999 reid_baseline.train INFO: normal accuracy 0.49117983963344786 2.4662156105041504 
2022-04-13 18:08:52,002 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 18:08:52,002 reid_baseline.train INFO: Accuracy: 49.1% Mean Entropy: 246.6%
2022-04-13 18:09:11,382 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.201, Acc: 0.882, Base Lr: 2.20e-03
2022-04-13 18:09:23,637 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.208[s] Speed: 77.0[samples/s]
2022-04-13 18:09:55,032 reid_baseline.train INFO: normal accuracy 0.4838487972508591 2.4234673976898193 
2022-04-13 18:09:58,232 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 18:09:58,232 reid_baseline.train INFO: Accuracy: 48.4% Mean Entropy: 242.3%
2022-04-13 18:10:19,779 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.168, Acc: 0.898, Base Lr: 1.66e-03
2022-04-13 18:10:30,679 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.213[s] Speed: 75.2[samples/s]
2022-04-13 18:11:07,077 reid_baseline.train INFO: normal accuracy 0.4868270332187858 2.3749663829803467 
2022-04-13 18:11:08,236 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 18:11:08,236 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 237.5%
2022-04-13 18:11:27,330 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.152, Acc: 0.907, Base Lr: 1.19e-03
2022-04-13 18:11:37,166 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.189[s] Speed: 84.5[samples/s]
2022-04-13 18:12:07,375 reid_baseline.train INFO: normal accuracy 0.4882016036655212 2.3636629581451416 
2022-04-13 18:12:09,931 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 18:12:09,931 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 236.4%
2022-04-13 18:12:36,964 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.135, Acc: 0.907, Base Lr: 7.78e-04
2022-04-13 18:12:45,903 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.236[s] Speed: 67.7[samples/s]
2022-04-13 18:13:18,381 reid_baseline.train INFO: normal accuracy 0.48911798396334477 2.3834447860717773 
2022-04-13 18:13:18,383 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 18:13:18,383 reid_baseline.train INFO: Accuracy: 48.9% Mean Entropy: 238.3%
2022-04-13 18:13:44,071 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.125, Acc: 0.916, Base Lr: 4.51e-04
2022-04-13 18:13:56,809 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.253[s] Speed: 63.4[samples/s]
2022-04-13 18:14:26,280 reid_baseline.train INFO: normal accuracy 0.4865979381443299 2.3606879711151123 
2022-04-13 18:14:27,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 18:14:27,858 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 236.1%
2022-04-13 18:14:50,553 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.131, Acc: 0.918, Base Lr: 2.11e-04
2022-04-13 18:15:00,224 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.212[s] Speed: 75.3[samples/s]
2022-04-13 18:15:32,148 reid_baseline.train INFO: normal accuracy 0.4872852233676976 2.3597793579101562 
2022-04-13 18:15:33,443 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 18:15:33,444 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 236.0%
2022-04-13 18:15:53,558 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.136, Acc: 0.907, Base Lr: 6.51e-05
2022-04-13 18:16:03,691 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.198[s] Speed: 81.0[samples/s]
2022-04-13 18:16:33,864 reid_baseline.train INFO: normal accuracy 0.486368843069874 2.3340485095977783 
2022-04-13 18:16:35,356 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 18:16:35,357 reid_baseline.train INFO: Accuracy: 48.6% Mean Entropy: 233.4%
2022-04-13 18:16:57,945 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.109, Acc: 0.919, Base Lr: 1.60e-05
2022-04-13 18:17:09,251 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.223[s] Speed: 71.8[samples/s]
2022-04-13 18:17:41,549 reid_baseline.train INFO: normal accuracy 0.4870561282932417 2.342944860458374 
2022-04-13 18:17:41,550 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 18:17:41,550 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 234.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_6/transformer_best_model.pth
2022-04-13 18:18:13,983 reid_baseline.train INFO: normal accuracy 0.486368843069874 2.3340485095977783 
2022-04-13 18:18:13,984 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 18:18:13,984 reid_baseline.train INFO: Accuracy: 48.6%
2022-04-13 18:18:49,523 reid_baseline.train INFO: normal accuracy 0.35738831615120276 2.3416409492492676 
2022-04-13 18:18:49,524 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 18:18:49,525 reid_baseline.train INFO: Shuffled Accuracy: 35.7%
2022-04-13 18:19:08,804 reid_baseline.train INFO: normal accuracy 0.9419035846724351 1.2081717252731323 
2022-04-13 18:19:08,804 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 18:19:08,804 reid_baseline.train INFO: Source Clean Accuracy: 94.2%
