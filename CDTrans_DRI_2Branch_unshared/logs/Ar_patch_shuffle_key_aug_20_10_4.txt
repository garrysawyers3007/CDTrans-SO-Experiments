2022-04-19 03:25:39,337 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_4_20_10
2022-04-19 03:25:39,337 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_4_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-19 03:25:39,337 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 03:25:39,338 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 03:25:39,338 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_4_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 03:25:43,273 reid_baseline.train INFO: start training
2022-04-19 03:26:03,019 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.294, Base Lr: 8.72e-04
2022-04-19 03:26:17,421 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.223[s] Speed: 71.7[samples/s]
2022-04-19 03:26:42,880 reid_baseline.train INFO: normal accuracy 0.38167239404352804 4.171792984008789 
2022-04-19 03:26:45,966 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 03:26:45,967 reid_baseline.train INFO: Accuracy: 38.2% Mean Entropy: 417.2%
2022-04-19 03:27:27,015 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.818, Acc: 0.590, Base Lr: 1.66e-03
2022-04-19 03:27:47,251 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.403[s] Speed: 39.7[samples/s]
2022-04-19 03:28:12,119 reid_baseline.train INFO: normal accuracy 0.40870561282932416 4.152847766876221 
2022-04-19 03:28:15,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 03:28:15,239 reid_baseline.train INFO: Accuracy: 40.9% Mean Entropy: 415.3%
2022-04-19 03:28:49,171 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.213, Acc: 0.635, Base Lr: 2.46e-03
2022-04-19 03:29:10,027 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.360[s] Speed: 44.4[samples/s]
2022-04-19 03:29:35,141 reid_baseline.train INFO: normal accuracy 0.44100801832760594 3.9986627101898193 
2022-04-19 03:29:38,236 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 03:29:38,236 reid_baseline.train INFO: Accuracy: 44.1% Mean Entropy: 399.9%
2022-04-19 03:30:19,994 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.435, Acc: 0.663, Base Lr: 3.25e-03
2022-04-19 03:30:36,184 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.381[s] Speed: 42.0[samples/s]
2022-04-19 03:31:13,925 reid_baseline.train INFO: normal accuracy 0.4943871706758305 3.535684108734131 
2022-04-19 03:31:17,950 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 03:31:17,950 reid_baseline.train INFO: Accuracy: 49.4% Mean Entropy: 353.6%
2022-04-19 03:32:00,807 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.983, Acc: 0.703, Base Lr: 4.04e-03
2022-04-19 03:32:20,502 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.411[s] Speed: 38.9[samples/s]
2022-04-19 03:32:47,308 reid_baseline.train INFO: normal accuracy 0.5468499427262313 3.067608594894409 
2022-04-19 03:32:50,429 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 03:32:50,430 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 306.8%
2022-04-19 03:33:23,170 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.645, Acc: 0.770, Base Lr: 4.83e-03
2022-04-19 03:33:38,877 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-19 03:34:03,622 reid_baseline.train INFO: normal accuracy 0.5878579610538374 2.720329523086548 
2022-04-19 03:34:06,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 03:34:06,729 reid_baseline.train INFO: Accuracy: 58.8% Mean Entropy: 272.0%
2022-04-19 03:34:48,688 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.464, Acc: 0.813, Base Lr: 5.62e-03
2022-04-19 03:35:09,584 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.413[s] Speed: 38.7[samples/s]
2022-04-19 03:35:41,115 reid_baseline.train INFO: normal accuracy 0.5974799541809851 2.3957579135894775 
2022-04-19 03:35:45,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 03:35:45,622 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 239.6%
2022-04-19 03:36:27,587 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.357, Acc: 0.837, Base Lr: 6.42e-03
2022-04-19 03:36:46,728 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.402[s] Speed: 39.8[samples/s]
2022-04-19 03:37:12,522 reid_baseline.train INFO: normal accuracy 0.6185567010309279 2.136120557785034 
2022-04-19 03:37:15,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 03:37:15,624 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 213.6%
2022-04-19 03:37:53,734 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.247, Acc: 0.865, Base Lr: 7.21e-03
2022-04-19 03:38:09,623 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.355[s] Speed: 45.0[samples/s]
2022-04-19 03:38:38,735 reid_baseline.train INFO: normal accuracy 0.606643757159221 2.087750196456909 
2022-04-19 03:38:43,548 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 03:38:43,548 reid_baseline.train INFO: Accuracy: 60.7% Mean Entropy: 208.8%
2022-04-19 03:39:23,311 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.177, Acc: 0.884, Base Lr: 4.01e-03
2022-04-19 03:39:43,816 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.396[s] Speed: 40.4[samples/s]
2022-04-19 03:40:16,941 reid_baseline.train INFO: normal accuracy 0.6155784650630012 1.9077136516571045 
2022-04-19 03:40:20,070 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 03:40:20,071 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 190.8%
2022-04-19 03:40:58,731 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.130, Acc: 0.902, Base Lr: 3.38e-03
2022-04-19 03:41:18,119 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.382[s] Speed: 41.9[samples/s]
2022-04-19 03:41:44,021 reid_baseline.train INFO: normal accuracy 0.6229095074455899 1.9461586475372314 
2022-04-19 03:41:44,024 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 03:41:44,024 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 194.6%
2022-04-19 03:42:23,559 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.106, Acc: 0.899, Base Lr: 2.77e-03
2022-04-19 03:42:41,236 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.376[s] Speed: 42.5[samples/s]
2022-04-19 03:43:11,244 reid_baseline.train INFO: normal accuracy 0.622680412371134 1.8552961349487305 
2022-04-19 03:43:17,196 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 03:43:17,197 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 185.5%
2022-04-19 03:43:58,314 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.096, Acc: 0.925, Base Lr: 2.20e-03
2022-04-19 03:44:17,937 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.400[s] Speed: 40.0[samples/s]
2022-04-19 03:44:47,960 reid_baseline.train INFO: normal accuracy 0.6238258877434135 1.8538987636566162 
2022-04-19 03:44:51,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 03:44:51,066 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 185.4%
2022-04-19 03:45:31,444 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.080, Acc: 0.915, Base Lr: 1.66e-03
2022-04-19 03:45:50,280 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.390[s] Speed: 41.1[samples/s]
2022-04-19 03:46:16,094 reid_baseline.train INFO: normal accuracy 0.6233676975945017 1.940281867980957 
2022-04-19 03:46:16,099 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 03:46:16,099 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 194.0%
2022-04-19 03:46:52,568 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.065, Acc: 0.919, Base Lr: 1.19e-03
2022-04-19 03:47:12,382 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.370[s] Speed: 43.2[samples/s]
2022-04-19 03:47:36,476 reid_baseline.train INFO: normal accuracy 0.6238258877434135 1.8769104480743408 
2022-04-19 03:47:36,481 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 03:47:36,481 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 187.7%
2022-04-19 03:48:13,656 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.059, Acc: 0.928, Base Lr: 7.78e-04
2022-04-19 03:48:32,889 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.371[s] Speed: 43.1[samples/s]
2022-04-19 03:49:00,833 reid_baseline.train INFO: normal accuracy 0.6245131729667812 1.8435828685760498 
2022-04-19 03:49:03,949 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 03:49:03,949 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 184.4%
2022-04-19 03:49:45,957 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.061, Acc: 0.921, Base Lr: 4.51e-04
2022-04-19 03:50:02,123 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-04-19 03:50:33,352 reid_baseline.train INFO: normal accuracy 0.6274914089347079 1.8717193603515625 
2022-04-19 03:50:33,356 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 03:50:33,356 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 187.2%
2022-04-19 03:51:11,509 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.048, Acc: 0.931, Base Lr: 2.11e-04
2022-04-19 03:51:31,704 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.384[s] Speed: 41.7[samples/s]
2022-04-19 03:51:57,657 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.7978204488754272 
2022-04-19 03:52:00,797 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 03:52:00,798 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 179.8%
2022-04-19 03:52:41,387 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.047, Acc: 0.932, Base Lr: 6.51e-05
2022-04-19 03:52:58,894 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.382[s] Speed: 41.9[samples/s]
2022-04-19 03:53:29,518 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.8419145345687866 
2022-04-19 03:53:29,519 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 03:53:29,519 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 184.2%
2022-04-19 03:54:11,316 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.042, Acc: 0.934, Base Lr: 1.60e-05
2022-04-19 03:54:31,268 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.406[s] Speed: 39.4[samples/s]
2022-04-19 03:55:04,753 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.875159502029419 
2022-04-19 03:55:04,754 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 03:55:04,754 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 187.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_4_20_10/transformer_best_model.pth
2022-04-19 03:55:39,803 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.7978204488754272 
2022-04-19 03:55:39,803 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 03:55:39,803 reid_baseline.train INFO: Accuracy: 62.9%
2022-04-19 03:56:05,523 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.7978204488754272 
2022-04-19 03:56:05,524 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 03:56:05,524 reid_baseline.train INFO: Shuffled Accuracy: 62.9%
2022-04-19 03:56:27,601 reid_baseline.train INFO: normal accuracy 0.9756901524515863 0.8361334204673767 
2022-04-19 03:56:27,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 03:56:27,602 reid_baseline.train INFO: Source Clean Accuracy: 97.6%
2022-04-19 03:56:31,309 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_4_20_10
2022-04-19 03:56:31,310 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_4_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-19 03:56:31,310 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 03:56:31,310 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 03:56:31,310 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_4_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 03:56:40,401 reid_baseline.train INFO: start training
2022-04-19 03:57:23,419 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.294, Base Lr: 8.72e-04
2022-04-19 03:57:44,682 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.411[s] Speed: 38.9[samples/s]
2022-04-19 03:58:11,797 reid_baseline.train INFO: normal accuracy 0.48749718405046183 4.171915531158447 
2022-04-19 03:58:14,808 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 03:58:14,810 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 417.2%
2022-04-19 03:58:56,319 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.818, Acc: 0.590, Base Lr: 1.66e-03
2022-04-19 03:59:15,159 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.397[s] Speed: 40.3[samples/s]
2022-04-19 03:59:50,777 reid_baseline.train INFO: normal accuracy 0.5194863708042352 4.150625228881836 
2022-04-19 03:59:53,959 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 03:59:53,960 reid_baseline.train INFO: Accuracy: 51.9% Mean Entropy: 415.1%
2022-04-19 04:00:34,865 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.213, Acc: 0.635, Base Lr: 2.46e-03
2022-04-19 04:00:54,016 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.395[s] Speed: 40.5[samples/s]
2022-04-19 04:01:19,763 reid_baseline.train INFO: normal accuracy 0.5438161748141473 3.9763917922973633 
2022-04-19 04:01:22,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 04:01:22,891 reid_baseline.train INFO: Accuracy: 54.4% Mean Entropy: 397.6%
2022-04-19 04:01:58,134 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.435, Acc: 0.663, Base Lr: 3.25e-03
2022-04-19 04:02:16,376 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.352[s] Speed: 45.5[samples/s]
2022-04-19 04:02:42,782 reid_baseline.train INFO: normal accuracy 0.5899977472403695 3.4529964923858643 
2022-04-19 04:02:45,881 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 04:02:45,882 reid_baseline.train INFO: Accuracy: 59.0% Mean Entropy: 345.3%
2022-04-19 04:03:27,632 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.983, Acc: 0.705, Base Lr: 4.04e-03
2022-04-19 04:03:46,607 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.399[s] Speed: 40.1[samples/s]
2022-04-19 04:04:19,587 reid_baseline.train INFO: normal accuracy 0.6607343996395585 2.8986716270446777 
2022-04-19 04:04:22,816 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 04:04:22,817 reid_baseline.train INFO: Accuracy: 66.1% Mean Entropy: 289.9%
2022-04-19 04:05:03,958 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.645, Acc: 0.768, Base Lr: 4.83e-03
2022-04-19 04:05:24,637 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.407[s] Speed: 39.3[samples/s]
2022-04-19 04:05:50,895 reid_baseline.train INFO: normal accuracy 0.7163775625140798 2.520448923110962 
2022-04-19 04:05:54,031 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 04:05:54,032 reid_baseline.train INFO: Accuracy: 71.6% Mean Entropy: 252.0%
2022-04-19 04:06:29,435 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.463, Acc: 0.815, Base Lr: 5.62e-03
2022-04-19 04:06:48,281 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-19 04:07:16,057 reid_baseline.train INFO: normal accuracy 0.7470150934895247 2.1996307373046875 
2022-04-19 04:07:19,237 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 04:07:19,237 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 220.0%
2022-04-19 04:08:02,469 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.358, Acc: 0.839, Base Lr: 6.42e-03
2022-04-19 04:08:20,478 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.403[s] Speed: 39.7[samples/s]
2022-04-19 04:08:46,088 reid_baseline.train INFO: normal accuracy 0.7603063753097544 1.961008071899414 
2022-04-19 04:08:50,949 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 04:08:50,950 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 196.1%
2022-04-19 04:09:31,079 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.246, Acc: 0.866, Base Lr: 7.21e-03
2022-04-19 04:09:52,626 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.406[s] Speed: 39.4[samples/s]
2022-04-19 04:10:21,726 reid_baseline.train INFO: normal accuracy 0.7686415859427799 1.8797051906585693 
2022-04-19 04:10:24,900 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 04:10:24,902 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 188.0%
2022-04-19 04:11:00,586 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.178, Acc: 0.888, Base Lr: 4.01e-03
2022-04-19 04:11:14,661 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.327[s] Speed: 48.9[samples/s]
2022-04-19 04:11:50,433 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.7282590866088867 
2022-04-19 04:11:53,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 04:11:53,598 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 172.8%
2022-04-19 04:12:28,569 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.130, Acc: 0.902, Base Lr: 3.38e-03
2022-04-19 04:12:47,891 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-19 04:13:14,937 reid_baseline.train INFO: normal accuracy 0.7776526244649696 1.7598702907562256 
2022-04-19 04:13:14,940 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 04:13:14,940 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 176.0%
2022-04-19 04:13:52,324 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.105, Acc: 0.900, Base Lr: 2.77e-03
2022-04-19 04:14:10,219 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.364[s] Speed: 44.0[samples/s]
2022-04-19 04:14:47,497 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6787325143814087 
2022-04-19 04:14:50,740 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 04:14:50,740 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 167.9%
2022-04-19 04:15:30,596 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.097, Acc: 0.925, Base Lr: 2.20e-03
2022-04-19 04:15:46,052 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.364[s] Speed: 44.0[samples/s]
2022-04-19 04:16:11,716 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.6718789339065552 
2022-04-19 04:16:14,978 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 04:16:14,979 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 167.2%
2022-04-19 04:16:56,298 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.080, Acc: 0.912, Base Lr: 1.66e-03
2022-04-19 04:17:16,454 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.404[s] Speed: 39.6[samples/s]
2022-04-19 04:17:43,214 reid_baseline.train INFO: normal accuracy 0.7805812119846812 1.7667475938796997 
2022-04-19 04:17:43,219 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 04:17:43,219 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 176.7%
2022-04-19 04:18:23,240 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.066, Acc: 0.919, Base Lr: 1.19e-03
2022-04-19 04:18:43,444 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.396[s] Speed: 40.4[samples/s]
2022-04-19 04:19:13,598 reid_baseline.train INFO: normal accuracy 0.7801306600585718 1.6974743604660034 
2022-04-19 04:19:13,603 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 04:19:13,603 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 169.7%
2022-04-19 04:19:55,223 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.058, Acc: 0.928, Base Lr: 7.78e-04
2022-04-19 04:20:15,762 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.409[s] Speed: 39.1[samples/s]
2022-04-19 04:20:47,048 reid_baseline.train INFO: normal accuracy 0.7801306600585718 1.6620948314666748 
2022-04-19 04:20:50,253 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 04:20:50,253 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 166.2%
2022-04-19 04:21:34,630 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.060, Acc: 0.921, Base Lr: 4.51e-04
2022-04-19 04:21:54,356 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.422[s] Speed: 37.9[samples/s]
2022-04-19 04:22:20,876 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.7054983377456665 
2022-04-19 04:22:20,881 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 04:22:20,881 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 170.5%
2022-04-19 04:23:02,011 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.048, Acc: 0.931, Base Lr: 2.11e-04
2022-04-19 04:23:21,372 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.398[s] Speed: 40.2[samples/s]
2022-04-19 04:23:51,623 reid_baseline.train INFO: normal accuracy 0.7785537283171886 1.6176278591156006 
2022-04-19 04:23:54,931 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 04:23:54,932 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 161.8%
2022-04-19 04:24:38,974 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.047, Acc: 0.932, Base Lr: 6.51e-05
2022-04-19 04:24:59,010 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.422[s] Speed: 38.0[samples/s]
2022-04-19 04:25:30,841 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.6697577238082886 
2022-04-19 04:25:30,843 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 04:25:30,844 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 167.0%
2022-04-19 04:26:13,878 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.042, Acc: 0.934, Base Lr: 1.60e-05
2022-04-19 04:26:32,632 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.406[s] Speed: 39.4[samples/s]
2022-04-19 04:27:02,384 reid_baseline.train INFO: normal accuracy 0.7830592475782834 1.7036247253417969 
2022-04-19 04:27:02,386 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 04:27:02,386 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 170.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_4_20_10/transformer_best_model.pth
2022-04-19 04:27:31,957 reid_baseline.train INFO: normal accuracy 0.7785537283171886 1.6176278591156006 
2022-04-19 04:27:31,957 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:27:31,958 reid_baseline.train INFO: Accuracy: 77.9%
2022-04-19 04:28:02,558 reid_baseline.train INFO: normal accuracy 0.7785537283171886 1.6176278591156006 
2022-04-19 04:28:02,558 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:28:02,559 reid_baseline.train INFO: Shuffled Accuracy: 77.9%
2022-04-19 04:28:31,798 reid_baseline.train INFO: normal accuracy 0.9756901524515863 0.8359334468841553 
2022-04-19 04:28:31,798 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:28:31,798 reid_baseline.train INFO: Source Clean Accuracy: 97.6%
2022-04-19 04:28:40,192 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_4_20_10
2022-04-19 04:28:40,192 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_4_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-19 04:28:40,192 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 04:28:40,193 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 04:28:40,193 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_4_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 04:28:48,963 reid_baseline.train INFO: start training
2022-04-19 04:29:40,490 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.294, Base Lr: 8.72e-04
2022-04-19 04:30:01,775 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.465[s] Speed: 34.4[samples/s]
2022-04-19 04:31:40,487 reid_baseline.train INFO: normal accuracy 0.5632315813633234 4.171630859375 
2022-04-19 04:31:44,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 04:31:44,203 reid_baseline.train INFO: Accuracy: 56.3% Mean Entropy: 417.2%
2022-04-19 04:32:23,202 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.818, Acc: 0.590, Base Lr: 1.66e-03
2022-04-19 04:32:43,891 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.393[s] Speed: 40.7[samples/s]
2022-04-19 04:34:16,181 reid_baseline.train INFO: normal accuracy 0.610741335781501 4.140951633453369 
2022-04-19 04:34:20,105 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 04:34:20,105 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 414.1%
2022-04-19 04:34:59,093 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.213, Acc: 0.635, Base Lr: 2.46e-03
2022-04-19 04:35:18,770 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.386[s] Speed: 41.5[samples/s]
2022-04-19 04:37:03,315 reid_baseline.train INFO: normal accuracy 0.6343814551296764 3.87772274017334 
2022-04-19 04:37:08,486 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 04:37:08,486 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 387.8%
2022-04-19 04:37:51,874 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.435, Acc: 0.664, Base Lr: 3.25e-03
2022-04-19 04:38:13,648 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.429[s] Speed: 37.3[samples/s]
2022-04-19 04:40:01,036 reid_baseline.train INFO: normal accuracy 0.6791370208859306 3.1960840225219727 
2022-04-19 04:40:04,639 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 04:40:04,640 reid_baseline.train INFO: Accuracy: 67.9% Mean Entropy: 319.6%
2022-04-19 04:40:45,737 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.983, Acc: 0.705, Base Lr: 4.04e-03
2022-04-19 04:41:04,538 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.394[s] Speed: 40.6[samples/s]
2022-04-19 04:42:47,408 reid_baseline.train INFO: normal accuracy 0.7369749827863209 2.599269151687622 
2022-04-19 04:42:50,799 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 04:42:50,800 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 259.9%
2022-04-19 04:43:33,437 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.645, Acc: 0.770, Base Lr: 4.83e-03
2022-04-19 04:43:56,740 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.434[s] Speed: 36.9[samples/s]
2022-04-19 04:45:33,509 reid_baseline.train INFO: normal accuracy 0.7810420013770943 2.2226364612579346 
2022-04-19 04:45:36,894 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 04:45:36,896 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 222.3%
2022-04-19 04:46:20,626 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.463, Acc: 0.814, Base Lr: 5.62e-03
2022-04-19 04:46:42,005 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.428[s] Speed: 37.4[samples/s]
2022-04-19 04:48:16,359 reid_baseline.train INFO: normal accuracy 0.8131742024328666 1.8835657835006714 
2022-04-19 04:48:19,456 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 04:48:19,457 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 188.4%
2022-04-19 04:49:01,740 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.356, Acc: 0.840, Base Lr: 6.42e-03
2022-04-19 04:49:20,727 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.403[s] Speed: 39.7[samples/s]
2022-04-19 04:50:59,727 reid_baseline.train INFO: normal accuracy 0.8189120954785403 1.6811058521270752 
2022-04-19 04:51:02,914 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 04:51:02,915 reid_baseline.train INFO: Accuracy: 81.9% Mean Entropy: 168.1%
2022-04-19 04:51:44,400 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.245, Acc: 0.867, Base Lr: 7.21e-03
2022-04-19 04:52:05,069 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.409[s] Speed: 39.1[samples/s]
2022-04-19 04:53:39,923 reid_baseline.train INFO: normal accuracy 0.8251090199678678 1.638163447380066 
2022-04-19 04:53:43,138 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 04:53:43,138 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 163.8%
2022-04-19 04:54:22,951 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.177, Acc: 0.881, Base Lr: 4.01e-03
2022-04-19 04:54:45,444 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.410[s] Speed: 39.0[samples/s]
2022-04-19 04:56:31,831 reid_baseline.train INFO: normal accuracy 0.8292403029607528 1.4984385967254639 
2022-04-19 04:56:35,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 04:56:35,066 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 149.8%
2022-04-19 04:57:17,191 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.130, Acc: 0.902, Base Lr: 3.38e-03
2022-04-19 04:57:36,655 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.405[s] Speed: 39.5[samples/s]
2022-04-19 04:59:07,618 reid_baseline.train INFO: normal accuracy 0.8296993344044067 1.5372503995895386 
2022-04-19 04:59:07,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 04:59:07,620 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 153.7%
2022-04-19 04:59:41,926 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.105, Acc: 0.900, Base Lr: 2.77e-03
2022-04-19 04:59:59,738 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.343[s] Speed: 46.7[samples/s]
2022-04-19 05:01:49,689 reid_baseline.train INFO: normal accuracy 0.83245352306633 1.4739105701446533 
2022-04-19 05:01:52,880 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 05:01:52,880 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 147.4%
2022-04-19 05:02:35,983 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.096, Acc: 0.924, Base Lr: 2.20e-03
2022-04-19 05:02:49,352 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.371[s] Speed: 43.1[samples/s]
2022-04-19 05:04:39,036 reid_baseline.train INFO: normal accuracy 0.8354372274500803 1.4626235961914062 
2022-04-19 05:04:42,178 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 05:04:42,179 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.3%
2022-04-19 05:05:19,262 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.080, Acc: 0.916, Base Lr: 1.66e-03
2022-04-19 05:05:36,251 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.356[s] Speed: 45.0[samples/s]
2022-04-19 05:07:29,242 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.5581458806991577 
2022-04-19 05:07:29,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 05:07:29,242 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 155.8%
2022-04-19 05:08:01,297 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.066, Acc: 0.916, Base Lr: 1.19e-03
2022-04-19 05:08:18,339 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.323[s] Speed: 49.5[samples/s]
2022-04-19 05:10:10,802 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.4860727787017822 
2022-04-19 05:10:10,802 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 05:10:10,802 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 148.6%
2022-04-19 05:10:41,743 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.058, Acc: 0.928, Base Lr: 7.78e-04
2022-04-19 05:10:54,763 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-19 05:12:45,416 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4584819078445435 
2022-04-19 05:12:49,144 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 05:12:49,145 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 145.8%
2022-04-19 05:13:25,379 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.060, Acc: 0.921, Base Lr: 4.51e-04
2022-04-19 05:13:40,963 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-19 05:15:30,807 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4919118881225586 
2022-04-19 05:15:30,808 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 05:15:30,809 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 149.2%
2022-04-19 05:16:06,962 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.048, Acc: 0.930, Base Lr: 2.11e-04
2022-04-19 05:16:23,266 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-19 05:18:10,761 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4119482040405273 
2022-04-19 05:18:14,587 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 05:18:14,588 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 141.2%
2022-04-19 05:18:46,350 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.046, Acc: 0.932, Base Lr: 6.51e-05
2022-04-19 05:19:01,975 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-19 05:20:50,825 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4633324146270752 
2022-04-19 05:20:50,826 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 05:20:50,826 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.3%
2022-04-19 05:21:24,130 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.042, Acc: 0.934, Base Lr: 1.60e-05
2022-04-19 05:21:38,620 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.314[s] Speed: 50.9[samples/s]
2022-04-19 05:23:32,985 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.4929555654525757 
2022-04-19 05:23:32,987 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 05:23:32,988 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 149.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_4_20_10/transformer_best_model.pth
2022-04-19 05:25:34,313 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4119482040405273 
2022-04-19 05:25:34,313 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:25:34,313 reid_baseline.train INFO: Accuracy: 83.6%
2022-04-19 05:27:15,453 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4119482040405273 
2022-04-19 05:27:15,470 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:27:15,470 reid_baseline.train INFO: Shuffled Accuracy: 83.6%
2022-04-19 05:27:47,987 reid_baseline.train INFO: normal accuracy 0.9761021837659662 0.8356931209564209 
2022-04-19 05:27:47,987 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:27:47,988 reid_baseline.train INFO: Source Clean Accuracy: 97.6%
2022-04-19 05:27:54,673 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_6_20_10
2022-04-19 05:27:54,673 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_6_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-19 05:27:54,674 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 05:27:54,674 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 05:27:54,674 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_6_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 05:28:03,256 reid_baseline.train INFO: start training
2022-04-19 05:28:32,743 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.297, Base Lr: 8.72e-04
2022-04-19 05:28:48,906 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.298[s] Speed: 53.8[samples/s]
2022-04-19 05:29:16,420 reid_baseline.train INFO: normal accuracy 0.37983963344788085 4.171809673309326 
2022-04-19 05:29:19,888 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 05:29:19,888 reid_baseline.train INFO: Accuracy: 38.0% Mean Entropy: 417.2%
2022-04-19 05:30:01,389 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.816, Acc: 0.580, Base Lr: 1.66e-03
2022-04-19 05:30:21,161 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.403[s] Speed: 39.7[samples/s]
2022-04-19 05:30:52,589 reid_baseline.train INFO: normal accuracy 0.4059564719358534 4.152719020843506 
2022-04-19 05:30:55,844 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 05:30:55,845 reid_baseline.train INFO: Accuracy: 40.6% Mean Entropy: 415.3%
2022-04-19 05:31:28,724 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.237, Acc: 0.632, Base Lr: 2.46e-03
2022-04-19 05:31:44,153 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.318[s] Speed: 50.4[samples/s]
2022-04-19 05:32:19,993 reid_baseline.train INFO: normal accuracy 0.43711340206185567 4.000514030456543 
2022-04-19 05:32:25,138 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 05:32:25,139 reid_baseline.train INFO: Accuracy: 43.7% Mean Entropy: 400.1%
2022-04-19 05:32:59,425 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.465, Acc: 0.654, Base Lr: 3.25e-03
2022-04-19 05:33:19,694 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-19 05:33:45,836 reid_baseline.train INFO: normal accuracy 0.4946162657502864 3.5533363819122314 
2022-04-19 05:33:49,059 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 05:33:49,060 reid_baseline.train INFO: Accuracy: 49.5% Mean Entropy: 355.3%
2022-04-19 05:34:26,313 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.970, Acc: 0.706, Base Lr: 4.04e-03
2022-04-19 05:34:40,879 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-19 05:35:17,934 reid_baseline.train INFO: normal accuracy 0.5443298969072164 3.057562828063965 
2022-04-19 05:35:21,453 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 05:35:21,454 reid_baseline.train INFO: Accuracy: 54.4% Mean Entropy: 305.8%
2022-04-19 05:35:54,549 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.629, Acc: 0.763, Base Lr: 4.83e-03
2022-04-19 05:36:07,524 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-19 05:36:37,371 reid_baseline.train INFO: normal accuracy 0.593127147766323 2.712367534637451 
2022-04-19 05:36:42,787 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 05:36:42,787 reid_baseline.train INFO: Accuracy: 59.3% Mean Entropy: 271.2%
2022-04-19 05:37:25,404 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.467, Acc: 0.820, Base Lr: 5.62e-03
2022-04-19 05:37:45,924 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.415[s] Speed: 38.5[samples/s]
2022-04-19 05:38:12,592 reid_baseline.train INFO: normal accuracy 0.6077892325315005 2.346890687942505 
2022-04-19 05:38:16,077 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 05:38:16,077 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 234.7%
2022-04-19 05:38:48,316 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.342, Acc: 0.847, Base Lr: 6.42e-03
2022-04-19 05:39:03,619 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-19 05:39:38,345 reid_baseline.train INFO: normal accuracy 0.6077892325315005 2.147270679473877 
2022-04-19 05:39:41,710 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 05:39:41,710 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 214.7%
2022-04-19 05:40:07,375 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.272, Acc: 0.861, Base Lr: 7.21e-03
2022-04-19 05:40:25,172 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-19 05:40:51,292 reid_baseline.train INFO: normal accuracy 0.6151202749140894 1.9921298027038574 
2022-04-19 05:40:55,243 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 05:40:55,244 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 199.2%
2022-04-19 05:41:36,803 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.193, Acc: 0.884, Base Lr: 4.01e-03
2022-04-19 05:41:57,299 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.408[s] Speed: 39.2[samples/s]
2022-04-19 05:42:36,317 reid_baseline.train INFO: normal accuracy 0.6187857961053838 1.9636974334716797 
2022-04-19 05:42:39,472 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 05:42:39,473 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 196.4%
2022-04-19 05:43:14,238 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.155, Acc: 0.886, Base Lr: 3.38e-03
2022-04-19 05:43:30,255 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.334[s] Speed: 47.9[samples/s]
2022-04-19 05:43:59,785 reid_baseline.train INFO: normal accuracy 0.6242840778923253 1.8019787073135376 
2022-04-19 05:44:02,900 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 05:44:02,900 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 180.2%
2022-04-19 05:44:44,780 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.111, Acc: 0.909, Base Lr: 2.77e-03
2022-04-19 05:45:06,540 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.419[s] Speed: 38.2[samples/s]
2022-04-19 05:45:32,681 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.851791262626648 
2022-04-19 05:45:32,686 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 05:45:32,686 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 185.2%
2022-04-19 05:46:07,478 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.098, Acc: 0.916, Base Lr: 2.20e-03
2022-04-19 05:46:24,219 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-19 05:46:59,966 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.8415879011154175 
2022-04-19 05:46:59,967 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 05:46:59,967 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 184.2%
2022-04-19 05:47:32,185 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.072, Acc: 0.920, Base Lr: 1.66e-03
2022-04-19 05:47:43,575 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.287[s] Speed: 55.8[samples/s]
2022-04-19 05:48:12,852 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.8607162237167358 
2022-04-19 05:48:12,856 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 05:48:12,856 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.1%
2022-04-19 05:48:51,757 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.068, Acc: 0.916, Base Lr: 1.19e-03
2022-04-19 05:49:12,311 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.391[s] Speed: 40.9[samples/s]
2022-04-19 05:49:37,758 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.8365545272827148 
2022-04-19 05:49:37,760 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 05:49:37,760 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 183.7%
2022-04-19 05:50:08,979 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.062, Acc: 0.924, Base Lr: 7.78e-04
2022-04-19 05:50:23,853 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-19 05:50:59,739 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.8650661706924438 
2022-04-19 05:50:59,741 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 05:50:59,743 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.5%
2022-04-19 05:51:28,320 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.057, Acc: 0.927, Base Lr: 4.51e-04
2022-04-19 05:51:42,986 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.284[s] Speed: 56.3[samples/s]
2022-04-19 05:52:09,066 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.89683997631073 
2022-04-19 05:52:09,070 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 05:52:09,071 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 189.7%
2022-04-19 05:52:49,728 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.038, Acc: 0.933, Base Lr: 2.11e-04
2022-04-19 05:53:09,213 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.396[s] Speed: 40.4[samples/s]
2022-04-19 05:53:36,936 reid_baseline.train INFO: normal accuracy 0.6334478808705613 1.8493919372558594 
2022-04-19 05:53:36,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 05:53:36,937 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 184.9%
2022-04-19 05:54:10,052 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.045, Acc: 0.929, Base Lr: 6.51e-05
2022-04-19 05:54:25,324 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-19 05:54:59,609 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.8231887817382812 
2022-04-19 05:54:59,610 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 05:54:59,610 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 182.3%
2022-04-19 05:55:30,069 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.034, Acc: 0.940, Base Lr: 1.60e-05
2022-04-19 05:55:47,930 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-19 05:56:17,833 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.8504586219787598 
2022-04-19 05:56:17,836 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 05:56:17,836 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 185.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_6_20_10/transformer_best_model.pth
2022-04-19 05:56:47,443 reid_baseline.train INFO: normal accuracy 0.6242840778923253 1.8019787073135376 
2022-04-19 05:56:47,444 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:56:47,444 reid_baseline.train INFO: Accuracy: 62.4%
2022-04-19 05:57:13,830 reid_baseline.train INFO: normal accuracy 0.6242840778923253 1.8019787073135376 
2022-04-19 05:57:13,834 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:57:13,834 reid_baseline.train INFO: Shuffled Accuracy: 62.4%
2022-04-19 05:57:45,321 reid_baseline.train INFO: normal accuracy 0.9629171817058096 0.8706583976745605 
2022-04-19 05:57:45,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:57:45,322 reid_baseline.train INFO: Source Clean Accuracy: 96.3%
2022-04-19 05:57:51,893 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_6_20_10
2022-04-19 05:57:51,893 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_6_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-19 05:57:51,893 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 05:57:51,893 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 05:57:51,894 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_6_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 05:58:00,772 reid_baseline.train INFO: start training
2022-04-19 05:58:35,264 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.297, Base Lr: 8.72e-04
2022-04-19 05:58:48,656 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-19 05:59:16,516 reid_baseline.train INFO: normal accuracy 0.4888488398287903 4.171922206878662 
2022-04-19 05:59:19,698 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 05:59:19,699 reid_baseline.train INFO: Accuracy: 48.9% Mean Entropy: 417.2%
2022-04-19 06:00:02,570 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.816, Acc: 0.580, Base Lr: 1.66e-03
2022-04-19 06:00:22,401 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.413[s] Speed: 38.8[samples/s]
2022-04-19 06:00:53,127 reid_baseline.train INFO: normal accuracy 0.5215138544717278 4.151651859283447 
2022-04-19 06:00:56,374 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 06:00:56,376 reid_baseline.train INFO: Accuracy: 52.2% Mean Entropy: 415.2%
2022-04-19 06:01:30,163 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.238, Acc: 0.632, Base Lr: 2.46e-03
2022-04-19 06:01:44,636 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.317[s] Speed: 50.4[samples/s]
2022-04-19 06:02:18,714 reid_baseline.train INFO: normal accuracy 0.5465194863708043 3.980642080307007 
2022-04-19 06:02:21,806 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 06:02:21,806 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 398.1%
2022-04-19 06:02:51,056 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.465, Acc: 0.654, Base Lr: 3.25e-03
2022-04-19 06:03:10,060 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.317[s] Speed: 50.4[samples/s]
2022-04-19 06:03:36,192 reid_baseline.train INFO: normal accuracy 0.596530750168957 3.459045648574829 
2022-04-19 06:03:39,264 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 06:03:39,264 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 345.9%
2022-04-19 06:04:19,039 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.970, Acc: 0.706, Base Lr: 4.04e-03
2022-04-19 06:04:34,255 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.362[s] Speed: 44.2[samples/s]
2022-04-19 06:05:08,708 reid_baseline.train INFO: normal accuracy 0.6548772246001352 2.9081692695617676 
2022-04-19 06:05:11,892 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 06:05:11,893 reid_baseline.train INFO: Accuracy: 65.5% Mean Entropy: 290.8%
2022-04-19 06:05:44,874 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.629, Acc: 0.764, Base Lr: 4.83e-03
2022-04-19 06:05:59,860 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.316[s] Speed: 50.7[samples/s]
2022-04-19 06:06:32,740 reid_baseline.train INFO: normal accuracy 0.7184050461815724 2.4968535900115967 
2022-04-19 06:06:36,170 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 06:06:36,172 reid_baseline.train INFO: Accuracy: 71.8% Mean Entropy: 249.7%
2022-04-19 06:07:13,249 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.467, Acc: 0.818, Base Lr: 5.62e-03
2022-04-19 06:07:29,783 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.353[s] Speed: 45.4[samples/s]
2022-04-19 06:07:58,605 reid_baseline.train INFO: normal accuracy 0.7503942329353458 2.1037111282348633 
2022-04-19 06:08:01,786 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 06:08:01,787 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 210.4%
2022-04-19 06:08:34,877 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.343, Acc: 0.843, Base Lr: 6.42e-03
2022-04-19 06:08:50,556 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-19 06:09:26,377 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.9327538013458252 
2022-04-19 06:09:29,709 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 06:09:29,711 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 193.3%
2022-04-19 06:09:59,960 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.272, Acc: 0.861, Base Lr: 7.21e-03
2022-04-19 06:10:17,132 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-19 06:10:42,865 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.7735947370529175 
2022-04-19 06:10:46,246 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 06:10:46,247 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 177.4%
2022-04-19 06:11:27,938 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.193, Acc: 0.885, Base Lr: 4.01e-03
2022-04-19 06:11:49,038 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.413[s] Speed: 38.7[samples/s]
2022-04-19 06:12:27,768 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.7712403535842896 
2022-04-19 06:12:30,915 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 06:12:30,916 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 177.1%
2022-04-19 06:13:02,964 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.155, Acc: 0.889, Base Lr: 3.38e-03
2022-04-19 06:13:19,916 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.322[s] Speed: 49.6[samples/s]
2022-04-19 06:13:48,912 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.6207709312438965 
2022-04-19 06:13:52,247 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 06:13:52,248 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 162.1%
2022-04-19 06:14:24,155 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.111, Acc: 0.908, Base Lr: 2.77e-03
2022-04-19 06:14:39,424 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-19 06:15:13,819 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.6683554649353027 
2022-04-19 06:15:13,822 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 06:15:13,822 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 166.8%
2022-04-19 06:15:47,575 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.099, Acc: 0.917, Base Lr: 2.20e-03
2022-04-19 06:16:05,473 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.340[s] Speed: 47.1[samples/s]
2022-04-19 06:16:39,504 reid_baseline.train INFO: normal accuracy 0.7866636629871593 1.6730629205703735 
2022-04-19 06:16:39,504 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 06:16:39,505 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 167.3%
2022-04-19 06:17:10,240 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.072, Acc: 0.921, Base Lr: 1.66e-03
2022-04-19 06:17:26,346 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-19 06:17:58,608 reid_baseline.train INFO: normal accuracy 0.7868889389502141 1.6831955909729004 
2022-04-19 06:17:58,608 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 06:17:58,608 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 168.3%
2022-04-19 06:18:28,057 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.068, Acc: 0.918, Base Lr: 1.19e-03
2022-04-19 06:18:45,769 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-19 06:19:14,336 reid_baseline.train INFO: normal accuracy 0.7864383870241045 1.665006160736084 
2022-04-19 06:19:14,338 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 06:19:14,338 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 166.5%
2022-04-19 06:19:54,227 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.062, Acc: 0.923, Base Lr: 7.78e-04
2022-04-19 06:20:13,945 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.392[s] Speed: 40.8[samples/s]
2022-04-19 06:20:46,937 reid_baseline.train INFO: normal accuracy 0.7886911466546519 1.6937050819396973 
2022-04-19 06:20:46,942 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 06:20:46,942 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 169.4%
2022-04-19 06:21:25,873 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.057, Acc: 0.929, Base Lr: 4.51e-04
2022-04-19 06:21:46,166 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.390[s] Speed: 41.1[samples/s]
2022-04-19 06:22:12,312 reid_baseline.train INFO: normal accuracy 0.7882405947285425 1.7253230810165405 
2022-04-19 06:22:12,316 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 06:22:12,316 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 172.5%
2022-04-19 06:22:47,231 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.038, Acc: 0.935, Base Lr: 2.11e-04
2022-04-19 06:23:06,033 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.353[s] Speed: 45.3[samples/s]
2022-04-19 06:23:36,849 reid_baseline.train INFO: normal accuracy 0.7875647668393783 1.6751998662948608 
2022-04-19 06:23:36,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 06:23:36,851 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 167.5%
2022-04-19 06:24:17,616 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.045, Acc: 0.930, Base Lr: 6.51e-05
2022-04-19 06:24:36,679 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.394[s] Speed: 40.7[samples/s]
2022-04-19 06:25:08,344 reid_baseline.train INFO: normal accuracy 0.7866636629871593 1.6372184753417969 
2022-04-19 06:25:08,346 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 06:25:08,346 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 163.7%
2022-04-19 06:25:46,251 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.035, Acc: 0.940, Base Lr: 1.60e-05
2022-04-19 06:26:05,240 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-19 06:26:35,175 reid_baseline.train INFO: normal accuracy 0.7893669745438162 1.6811004877090454 
2022-04-19 06:26:35,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 06:26:35,177 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 168.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_6_20_10/transformer_best_model.pth
2022-04-19 06:27:06,936 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.6207709312438965 
2022-04-19 06:27:06,936 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:27:06,936 reid_baseline.train INFO: Accuracy: 77.8%
2022-04-19 06:27:39,951 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.6207709312438965 
2022-04-19 06:27:39,951 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:27:39,951 reid_baseline.train INFO: Shuffled Accuracy: 77.8%
2022-04-19 06:28:06,513 reid_baseline.train INFO: normal accuracy 0.9616810877626699 0.8698053359985352 
2022-04-19 06:28:06,513 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:28:06,513 reid_baseline.train INFO: Source Clean Accuracy: 96.2%
2022-04-19 06:28:10,148 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_6_20_10
2022-04-19 06:28:10,148 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_6_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-19 06:28:10,148 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 06:28:10,149 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 06:28:10,149 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_6_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 06:28:19,095 reid_baseline.train INFO: start training
2022-04-19 06:29:06,139 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.297, Base Lr: 8.72e-04
2022-04-19 06:29:22,645 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.408[s] Speed: 39.2[samples/s]
2022-04-19 06:31:00,933 reid_baseline.train INFO: normal accuracy 0.5584117512049576 4.171622276306152 
2022-04-19 06:31:04,144 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 06:31:04,145 reid_baseline.train INFO: Accuracy: 55.8% Mean Entropy: 417.2%
2022-04-19 06:31:43,740 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.816, Acc: 0.580, Base Lr: 1.66e-03
2022-04-19 06:32:02,946 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.387[s] Speed: 41.4[samples/s]
2022-04-19 06:33:42,229 reid_baseline.train INFO: normal accuracy 0.6130364929997705 4.14262580871582 
2022-04-19 06:33:48,655 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 06:33:48,656 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 414.3%
2022-04-19 06:34:29,988 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.238, Acc: 0.632, Base Lr: 2.46e-03
2022-04-19 06:34:50,307 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.405[s] Speed: 39.5[samples/s]
2022-04-19 06:36:26,046 reid_baseline.train INFO: normal accuracy 0.6336929079641955 3.8771355152130127 
2022-04-19 06:36:29,255 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 06:36:29,256 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 387.7%
2022-04-19 06:37:10,996 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.465, Acc: 0.654, Base Lr: 3.25e-03
2022-04-19 06:37:28,468 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.389[s] Speed: 41.1[samples/s]
2022-04-19 06:39:04,924 reid_baseline.train INFO: normal accuracy 0.6782189579986229 3.2035744190216064 
2022-04-19 06:39:11,616 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 06:39:11,616 reid_baseline.train INFO: Accuracy: 67.8% Mean Entropy: 320.4%
2022-04-19 06:39:47,806 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.970, Acc: 0.706, Base Lr: 4.04e-03
2022-04-19 06:40:05,461 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-19 06:41:42,874 reid_baseline.train INFO: normal accuracy 0.732384668349782 2.60066819190979 
2022-04-19 06:41:46,223 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 06:41:46,224 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 260.1%
2022-04-19 06:42:26,557 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.629, Acc: 0.761, Base Lr: 4.83e-03
2022-04-19 06:42:47,091 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.400[s] Speed: 40.0[samples/s]
2022-04-19 06:44:31,146 reid_baseline.train INFO: normal accuracy 0.7856323158136332 2.207211971282959 
2022-04-19 06:44:34,475 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 06:44:34,475 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 220.7%
2022-04-19 06:45:15,599 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.467, Acc: 0.820, Base Lr: 5.62e-03
2022-04-19 06:45:33,906 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.391[s] Speed: 40.9[samples/s]
2022-04-19 06:47:10,247 reid_baseline.train INFO: normal accuracy 0.8120266238237319 1.8312647342681885 
2022-04-19 06:47:13,625 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 06:47:13,626 reid_baseline.train INFO: Accuracy: 81.2% Mean Entropy: 183.1%
2022-04-19 06:47:50,515 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.342, Acc: 0.847, Base Lr: 6.42e-03
2022-04-19 06:48:09,983 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.371[s] Speed: 43.2[samples/s]
2022-04-19 06:49:38,901 reid_baseline.train INFO: normal accuracy 0.8161579068166169 1.6706244945526123 
2022-04-19 06:49:42,156 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 06:49:42,156 reid_baseline.train INFO: Accuracy: 81.6% Mean Entropy: 167.1%
2022-04-19 06:50:17,188 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.272, Acc: 0.859, Base Lr: 7.21e-03
2022-04-19 06:50:36,972 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.360[s] Speed: 44.4[samples/s]
2022-04-19 06:52:16,300 reid_baseline.train INFO: normal accuracy 0.8278632086297911 1.5418345928192139 
2022-04-19 06:52:20,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 06:52:20,594 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 154.2%
2022-04-19 06:52:59,669 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.193, Acc: 0.880, Base Lr: 4.01e-03
2022-04-19 06:53:20,532 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.394[s] Speed: 40.6[samples/s]
2022-04-19 06:54:53,981 reid_baseline.train INFO: normal accuracy 0.8296993344044067 1.543854832649231 
2022-04-19 06:54:53,986 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 06:54:53,986 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 154.4%
2022-04-19 06:55:31,005 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.155, Acc: 0.884, Base Lr: 3.38e-03
2022-04-19 06:55:50,356 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.371[s] Speed: 43.2[samples/s]
2022-04-19 06:57:25,135 reid_baseline.train INFO: normal accuracy 0.8336011016754648 1.4000037908554077 
2022-04-19 06:57:28,355 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 06:57:28,355 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 140.0%
2022-04-19 06:58:09,527 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.110, Acc: 0.908, Base Lr: 2.77e-03
2022-04-19 06:58:30,120 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.406[s] Speed: 39.4[samples/s]
2022-04-19 07:00:11,902 reid_baseline.train INFO: normal accuracy 0.8336011016754648 1.4472001791000366 
2022-04-19 07:00:11,905 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 07:00:11,905 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.7%
2022-04-19 07:00:47,936 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.098, Acc: 0.916, Base Lr: 2.20e-03
2022-04-19 07:01:06,638 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.360[s] Speed: 44.4[samples/s]
2022-04-19 07:02:45,358 reid_baseline.train INFO: normal accuracy 0.8375028689465228 1.451083779335022 
2022-04-19 07:02:45,362 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 07:02:45,362 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 145.1%
2022-04-19 07:03:24,842 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.072, Acc: 0.921, Base Lr: 1.66e-03
2022-04-19 07:03:43,927 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.385[s] Speed: 41.5[samples/s]
2022-04-19 07:05:28,594 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.4605902433395386 
2022-04-19 07:05:28,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 07:05:28,598 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.1%
2022-04-19 07:06:05,074 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.068, Acc: 0.918, Base Lr: 1.19e-03
2022-04-19 07:06:26,652 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.382[s] Speed: 41.9[samples/s]
2022-04-19 07:07:56,151 reid_baseline.train INFO: normal accuracy 0.8375028689465228 1.4449093341827393 
2022-04-19 07:07:56,154 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 07:07:56,154 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 144.5%
2022-04-19 07:08:36,339 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.062, Acc: 0.924, Base Lr: 7.78e-04
2022-04-19 07:08:51,690 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-19 07:10:24,793 reid_baseline.train INFO: normal accuracy 0.8381914161120037 1.476722002029419 
2022-04-19 07:10:24,798 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 07:10:24,798 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 147.7%
2022-04-19 07:11:03,630 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.057, Acc: 0.928, Base Lr: 4.51e-04
2022-04-19 07:11:23,625 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.387[s] Speed: 41.4[samples/s]
2022-04-19 07:13:02,468 reid_baseline.train INFO: normal accuracy 0.836584806059215 1.5114456415176392 
2022-04-19 07:13:02,471 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 07:13:02,471 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 151.1%
2022-04-19 07:13:42,340 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.038, Acc: 0.932, Base Lr: 2.11e-04
2022-04-19 07:14:03,205 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.399[s] Speed: 40.1[samples/s]
2022-04-19 07:15:44,659 reid_baseline.train INFO: normal accuracy 0.8370438375028689 1.4613221883773804 
2022-04-19 07:15:44,662 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 07:15:44,662 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 146.1%
2022-04-19 07:16:26,562 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.045, Acc: 0.929, Base Lr: 6.51e-05
2022-04-19 07:16:45,872 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.403[s] Speed: 39.7[samples/s]
2022-04-19 07:18:25,492 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.4295742511749268 
2022-04-19 07:18:25,492 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 07:18:25,492 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 143.0%
2022-04-19 07:19:06,802 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.034, Acc: 0.938, Base Lr: 1.60e-05
2022-04-19 07:19:25,062 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.392[s] Speed: 40.8[samples/s]
2022-04-19 07:21:04,735 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4664149284362793 
2022-04-19 07:21:04,737 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 07:21:04,737 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_6_20_10/transformer_best_model.pth
2022-04-19 07:22:42,696 reid_baseline.train INFO: normal accuracy 0.8336011016754648 1.4000037908554077 
2022-04-19 07:22:42,697 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:22:42,697 reid_baseline.train INFO: Accuracy: 83.4%
2022-04-19 07:24:23,159 reid_baseline.train INFO: normal accuracy 0.8336011016754648 1.4000037908554077 
2022-04-19 07:24:23,160 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:24:23,160 reid_baseline.train INFO: Shuffled Accuracy: 83.4%
2022-04-19 07:24:49,431 reid_baseline.train INFO: normal accuracy 0.9625051503914297 0.8722305297851562 
2022-04-19 07:24:49,431 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:24:49,431 reid_baseline.train INFO: Source Clean Accuracy: 96.3%
2022-04-19 07:24:53,388 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_8_20_10
2022-04-19 07:24:53,389 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_8_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-19 07:24:53,389 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 07:24:53,389 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 07:24:53,389 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_8_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 07:25:02,430 reid_baseline.train INFO: start training
2022-04-19 07:25:53,569 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.120, Acc: 0.283, Base Lr: 8.72e-04
2022-04-19 07:26:12,673 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.448[s] Speed: 35.7[samples/s]
2022-04-19 07:26:41,492 reid_baseline.train INFO: normal accuracy 0.3715922107674685 4.1717963218688965 
2022-04-19 07:26:44,619 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 07:26:44,620 reid_baseline.train INFO: Accuracy: 37.2% Mean Entropy: 417.2%
2022-04-19 07:27:26,330 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.815, Acc: 0.565, Base Lr: 1.66e-03
2022-04-19 07:27:45,648 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.401[s] Speed: 39.9[samples/s]
2022-04-19 07:28:15,563 reid_baseline.train INFO: normal accuracy 0.41741122565864835 4.15243673324585 
2022-04-19 07:28:18,719 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 07:28:18,721 reid_baseline.train INFO: Accuracy: 41.7% Mean Entropy: 415.2%
2022-04-19 07:29:00,487 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.216, Acc: 0.612, Base Lr: 2.46e-03
2022-04-19 07:29:20,930 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.409[s] Speed: 39.1[samples/s]
2022-04-19 07:29:46,838 reid_baseline.train INFO: normal accuracy 0.43963344788087055 3.9933128356933594 
2022-04-19 07:29:50,016 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 07:29:50,017 reid_baseline.train INFO: Accuracy: 44.0% Mean Entropy: 399.3%
2022-04-19 07:30:32,303 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.491, Acc: 0.639, Base Lr: 3.25e-03
2022-04-19 07:30:50,369 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.397[s] Speed: 40.3[samples/s]
2022-04-19 07:31:20,277 reid_baseline.train INFO: normal accuracy 0.4836197021764032 3.528501033782959 
2022-04-19 07:31:24,171 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 07:31:24,172 reid_baseline.train INFO: Accuracy: 48.4% Mean Entropy: 352.9%
2022-04-19 07:32:07,640 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.938, Acc: 0.716, Base Lr: 4.04e-03
2022-04-19 07:32:27,338 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.415[s] Speed: 38.5[samples/s]
2022-04-19 07:32:56,863 reid_baseline.train INFO: normal accuracy 0.5539518900343643 3.075737714767456 
2022-04-19 07:33:00,172 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 07:33:00,173 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 307.6%
2022-04-19 07:33:44,557 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.640, Acc: 0.763, Base Lr: 4.83e-03
2022-04-19 07:34:03,406 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.416[s] Speed: 38.5[samples/s]
2022-04-19 07:34:28,538 reid_baseline.train INFO: normal accuracy 0.597709049255441 2.6531667709350586 
2022-04-19 07:34:31,718 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 07:34:31,719 reid_baseline.train INFO: Accuracy: 59.8% Mean Entropy: 265.3%
2022-04-19 07:35:12,646 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.451, Acc: 0.826, Base Lr: 5.62e-03
2022-04-19 07:35:32,316 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.399[s] Speed: 40.1[samples/s]
2022-04-19 07:36:01,382 reid_baseline.train INFO: normal accuracy 0.604352806414662 2.3523175716400146 
2022-04-19 07:36:04,627 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 07:36:04,628 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 235.2%
2022-04-19 07:36:47,605 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.323, Acc: 0.849, Base Lr: 6.42e-03
2022-04-19 07:37:08,843 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.422[s] Speed: 37.9[samples/s]
2022-04-19 07:37:37,278 reid_baseline.train INFO: normal accuracy 0.6061855670103092 2.199272871017456 
2022-04-19 07:37:41,517 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 07:37:41,519 reid_baseline.train INFO: Accuracy: 60.6% Mean Entropy: 219.9%
2022-04-19 07:38:23,088 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.240, Acc: 0.869, Base Lr: 7.21e-03
2022-04-19 07:38:42,812 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.403[s] Speed: 39.7[samples/s]
2022-04-19 07:39:08,728 reid_baseline.train INFO: normal accuracy 0.6103092783505155 2.0778307914733887 
2022-04-19 07:39:11,915 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 07:39:11,915 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 207.8%
2022-04-19 07:39:43,811 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.185, Acc: 0.893, Base Lr: 4.01e-03
2022-04-19 07:39:59,632 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.314[s] Speed: 51.0[samples/s]
2022-04-19 07:40:33,754 reid_baseline.train INFO: normal accuracy 0.6217640320733104 1.9945999383926392 
2022-04-19 07:40:37,005 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 07:40:37,007 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 199.5%
2022-04-19 07:41:12,628 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.123, Acc: 0.910, Base Lr: 3.38e-03
2022-04-19 07:41:34,314 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.377[s] Speed: 42.4[samples/s]
2022-04-19 07:42:00,408 reid_baseline.train INFO: normal accuracy 0.624971363115693 1.9569814205169678 
2022-04-19 07:42:03,507 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 07:42:03,508 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 195.7%
2022-04-19 07:42:43,949 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.105, Acc: 0.907, Base Lr: 2.77e-03
2022-04-19 07:43:00,943 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.378[s] Speed: 42.4[samples/s]
2022-04-19 07:43:33,467 reid_baseline.train INFO: normal accuracy 0.6233676975945017 1.885576844215393 
2022-04-19 07:43:37,269 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 07:43:37,270 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 188.6%
2022-04-19 07:44:11,504 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.104, Acc: 0.909, Base Lr: 2.20e-03
2022-04-19 07:44:29,585 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-19 07:44:58,671 reid_baseline.train INFO: normal accuracy 0.6256586483390607 1.9257922172546387 
2022-04-19 07:44:58,675 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 07:44:58,675 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 192.6%
2022-04-19 07:45:37,857 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.056, Acc: 0.926, Base Lr: 1.66e-03
2022-04-19 07:45:57,249 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.385[s] Speed: 41.5[samples/s]
2022-04-19 07:46:25,262 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.8674471378326416 
2022-04-19 07:46:29,733 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 07:46:29,735 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.7%
2022-04-19 07:47:02,480 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.044, Acc: 0.932, Base Lr: 1.19e-03
2022-04-19 07:47:18,568 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-19 07:47:55,252 reid_baseline.train INFO: normal accuracy 0.6313860252004582 1.8906344175338745 
2022-04-19 07:47:55,255 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 07:47:55,255 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 189.1%
2022-04-19 07:48:20,583 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.037, Acc: 0.941, Base Lr: 7.78e-04
2022-04-19 07:48:39,404 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-19 07:49:05,371 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.9017826318740845 
2022-04-19 07:49:05,374 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 07:49:05,374 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 190.2%
2022-04-19 07:49:44,584 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.051, Acc: 0.930, Base Lr: 4.51e-04
2022-04-19 07:50:04,313 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.388[s] Speed: 41.3[samples/s]
2022-04-19 07:50:39,692 reid_baseline.train INFO: normal accuracy 0.6284077892325315 1.839948058128357 
2022-04-19 07:50:42,837 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 07:50:42,838 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 184.0%
2022-04-19 07:51:17,311 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.041, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 07:51:32,106 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-19 07:52:04,338 reid_baseline.train INFO: normal accuracy 0.6290950744558992 1.9173007011413574 
2022-04-19 07:52:04,338 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 07:52:04,338 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 191.7%
2022-04-19 07:52:41,909 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.024, Acc: 0.940, Base Lr: 6.51e-05
2022-04-19 07:53:01,886 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.379[s] Speed: 42.3[samples/s]
2022-04-19 07:53:27,724 reid_baseline.train INFO: normal accuracy 0.627262313860252 1.8931914567947388 
2022-04-19 07:53:27,727 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 07:53:27,727 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 189.3%
2022-04-19 07:54:02,161 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.042, Acc: 0.921, Base Lr: 1.60e-05
2022-04-19 07:54:17,003 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-19 07:54:56,940 reid_baseline.train INFO: normal accuracy 0.6311569301260023 1.864115595817566 
2022-04-19 07:54:56,943 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 07:54:56,943 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_8_20_10/transformer_best_model.pth
2022-04-19 07:55:35,269 reid_baseline.train INFO: normal accuracy 0.6284077892325315 1.839948058128357 
2022-04-19 07:55:35,269 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:55:35,269 reid_baseline.train INFO: Accuracy: 62.8%
2022-04-19 07:56:05,497 reid_baseline.train INFO: normal accuracy 0.6284077892325315 1.839948058128357 
2022-04-19 07:56:05,498 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:56:05,498 reid_baseline.train INFO: Shuffled Accuracy: 62.8%
2022-04-19 07:56:28,950 reid_baseline.train INFO: normal accuracy 0.9736299958796869 0.8759815096855164 
2022-04-19 07:56:28,951 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:56:28,951 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-19 07:56:32,703 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_8_20_10
2022-04-19 07:56:32,703 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_8_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-19 07:56:32,703 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 07:56:32,704 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 07:56:32,704 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_8_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 07:56:41,413 reid_baseline.train INFO: start training
2022-04-19 07:57:26,386 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.120, Acc: 0.282, Base Lr: 8.72e-04
2022-04-19 07:57:41,264 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.389[s] Speed: 41.2[samples/s]
2022-04-19 07:58:17,477 reid_baseline.train INFO: normal accuracy 0.47217841856273934 4.1719231605529785 
2022-04-19 07:58:20,605 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 07:58:20,608 reid_baseline.train INFO: Accuracy: 47.2% Mean Entropy: 417.2%
2022-04-19 07:58:51,950 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.815, Acc: 0.564, Base Lr: 1.66e-03
2022-04-19 07:59:06,513 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-19 07:59:39,568 reid_baseline.train INFO: normal accuracy 0.5104753322820456 4.150720596313477 
2022-04-19 07:59:44,474 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 07:59:44,475 reid_baseline.train INFO: Accuracy: 51.0% Mean Entropy: 415.1%
2022-04-19 08:00:24,369 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.216, Acc: 0.612, Base Lr: 2.46e-03
2022-04-19 08:00:43,402 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.388[s] Speed: 41.3[samples/s]
2022-04-19 08:01:09,234 reid_baseline.train INFO: normal accuracy 0.5422392430727642 3.969060182571411 
2022-04-19 08:01:12,414 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 08:01:12,416 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 396.9%
2022-04-19 08:01:44,431 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.491, Acc: 0.640, Base Lr: 3.25e-03
2022-04-19 08:01:59,792 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.312[s] Speed: 51.4[samples/s]
2022-04-19 08:02:35,798 reid_baseline.train INFO: normal accuracy 0.5987835097995043 3.439419746398926 
2022-04-19 08:02:39,046 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 08:02:39,047 reid_baseline.train INFO: Accuracy: 59.9% Mean Entropy: 343.9%
2022-04-19 08:03:07,251 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.938, Acc: 0.718, Base Lr: 4.04e-03
2022-04-19 08:03:22,472 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-19 08:03:49,159 reid_baseline.train INFO: normal accuracy 0.673349853570624 2.896411180496216 
2022-04-19 08:03:52,395 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 08:03:52,396 reid_baseline.train INFO: Accuracy: 67.3% Mean Entropy: 289.6%
2022-04-19 08:04:33,673 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.640, Acc: 0.761, Base Lr: 4.83e-03
2022-04-19 08:04:52,517 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.395[s] Speed: 40.5[samples/s]
2022-04-19 08:05:26,450 reid_baseline.train INFO: normal accuracy 0.7294435683712548 2.4291129112243652 
2022-04-19 08:05:29,617 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 08:05:29,618 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 242.9%
2022-04-19 08:06:04,678 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.451, Acc: 0.825, Base Lr: 5.62e-03
2022-04-19 08:06:18,365 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-19 08:06:50,770 reid_baseline.train INFO: normal accuracy 0.7526469925658932 2.132253646850586 
2022-04-19 08:06:59,033 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 08:06:59,034 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 213.2%
2022-04-19 08:07:36,385 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.324, Acc: 0.850, Base Lr: 6.42e-03
2022-04-19 08:07:55,640 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-19 08:08:22,241 reid_baseline.train INFO: normal accuracy 0.7663888263122325 1.9974629878997803 
2022-04-19 08:08:25,454 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 08:08:25,455 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 199.7%
2022-04-19 08:09:01,545 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.240, Acc: 0.870, Base Lr: 7.21e-03
2022-04-19 08:09:16,009 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.332[s] Speed: 48.1[samples/s]
2022-04-19 08:09:52,497 reid_baseline.train INFO: normal accuracy 0.7722460013516558 1.872726559638977 
2022-04-19 08:09:55,819 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 08:09:55,823 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 187.3%
2022-04-19 08:10:26,970 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.185, Acc: 0.891, Base Lr: 4.01e-03
2022-04-19 08:10:39,715 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-19 08:11:18,784 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.793580174446106 
2022-04-19 08:11:21,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 08:11:21,905 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 179.4%
2022-04-19 08:12:02,678 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.123, Acc: 0.910, Base Lr: 3.38e-03
2022-04-19 08:12:22,368 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.398[s] Speed: 40.2[samples/s]
2022-04-19 08:12:51,053 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.7674410343170166 
2022-04-19 08:12:54,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 08:12:54,569 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 176.7%
2022-04-19 08:13:27,830 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.105, Acc: 0.905, Base Lr: 2.77e-03
2022-04-19 08:13:43,025 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-19 08:14:18,478 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.7013835906982422 
2022-04-19 08:14:21,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 08:14:21,622 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 170.1%
2022-04-19 08:14:49,466 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.105, Acc: 0.909, Base Lr: 2.20e-03
2022-04-19 08:15:09,561 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.315[s] Speed: 50.7[samples/s]
2022-04-19 08:15:36,114 reid_baseline.train INFO: normal accuracy 0.7796801081324622 1.748611569404602 
2022-04-19 08:15:36,114 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 08:15:36,115 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 174.9%
2022-04-19 08:16:15,986 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.056, Acc: 0.925, Base Lr: 1.66e-03
2022-04-19 08:16:33,323 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.376[s] Speed: 42.5[samples/s]
2022-04-19 08:17:09,320 reid_baseline.train INFO: normal accuracy 0.7812570398738454 1.684435486793518 
2022-04-19 08:17:12,548 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 08:17:12,551 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 168.4%
2022-04-19 08:17:45,237 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.044, Acc: 0.932, Base Lr: 1.19e-03
2022-04-19 08:17:59,500 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-19 08:18:32,422 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.7259101867675781 
2022-04-19 08:18:32,425 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 08:18:32,425 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 172.6%
2022-04-19 08:19:09,570 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.038, Acc: 0.941, Base Lr: 7.78e-04
2022-04-19 08:19:29,083 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-04-19 08:19:55,454 reid_baseline.train INFO: normal accuracy 0.7823834196891192 1.7457096576690674 
2022-04-19 08:19:55,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 08:19:55,455 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 174.6%
2022-04-19 08:20:28,649 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.051, Acc: 0.930, Base Lr: 4.51e-04
2022-04-19 08:20:44,007 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.319[s] Speed: 50.1[samples/s]
2022-04-19 08:21:21,001 reid_baseline.train INFO: normal accuracy 0.7830592475782834 1.6776702404022217 
2022-04-19 08:21:24,197 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 08:21:24,199 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 167.8%
2022-04-19 08:21:57,009 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.042, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 08:22:09,751 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-19 08:22:35,407 reid_baseline.train INFO: normal accuracy 0.7841856273935571 1.7503732442855835 
2022-04-19 08:22:35,408 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 08:22:35,408 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 175.0%
2022-04-19 08:23:14,729 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.024, Acc: 0.940, Base Lr: 6.51e-05
2022-04-19 08:23:34,589 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.389[s] Speed: 41.1[samples/s]
2022-04-19 08:24:00,781 reid_baseline.train INFO: normal accuracy 0.779905384095517 1.7295676469802856 
2022-04-19 08:24:00,785 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 08:24:00,785 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 173.0%
2022-04-19 08:24:30,823 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.043, Acc: 0.920, Base Lr: 1.60e-05
2022-04-19 08:24:45,572 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-19 08:25:25,336 reid_baseline.train INFO: normal accuracy 0.7832845235413382 1.6959741115570068 
2022-04-19 08:25:25,336 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 08:25:25,337 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 169.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_8_20_10/transformer_best_model.pth
2022-04-19 08:26:00,787 reid_baseline.train INFO: normal accuracy 0.7830592475782834 1.6776702404022217 
2022-04-19 08:26:00,787 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:26:00,787 reid_baseline.train INFO: Accuracy: 78.3%
2022-04-19 08:26:33,131 reid_baseline.train INFO: normal accuracy 0.7830592475782834 1.6776702404022217 
2022-04-19 08:26:33,131 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:26:33,131 reid_baseline.train INFO: Shuffled Accuracy: 78.3%
2022-04-19 08:26:56,445 reid_baseline.train INFO: normal accuracy 0.9728059332509271 0.8769619464874268 
2022-04-19 08:26:56,446 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:26:56,446 reid_baseline.train INFO: Source Clean Accuracy: 97.3%
2022-04-19 08:27:00,434 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_8_20_10
2022-04-19 08:27:00,434 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_8_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-19 08:27:00,434 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 08:27:00,435 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 08:27:00,435 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_8_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 08:27:09,301 reid_baseline.train INFO: start training
2022-04-19 08:27:53,597 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.120, Acc: 0.282, Base Lr: 8.72e-04
2022-04-19 08:28:08,599 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.377[s] Speed: 42.4[samples/s]
2022-04-19 08:30:08,263 reid_baseline.train INFO: normal accuracy 0.5577232040394767 4.171633720397949 
2022-04-19 08:30:12,616 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 08:30:12,617 reid_baseline.train INFO: Accuracy: 55.8% Mean Entropy: 417.2%
2022-04-19 08:30:53,693 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.815, Acc: 0.564, Base Lr: 1.66e-03
2022-04-19 08:31:13,117 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.398[s] Speed: 40.2[samples/s]
2022-04-19 08:33:11,263 reid_baseline.train INFO: normal accuracy 0.6105118200596741 4.141014099121094 
2022-04-19 08:33:14,552 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 08:33:14,552 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 414.1%
2022-04-19 08:33:47,926 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.216, Acc: 0.612, Base Lr: 2.46e-03
2022-04-19 08:34:07,119 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.346[s] Speed: 46.3[samples/s]
2022-04-19 08:35:55,198 reid_baseline.train INFO: normal accuracy 0.6330043607987147 3.8634352684020996 
2022-04-19 08:35:58,596 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 08:35:58,597 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 386.3%
2022-04-19 08:36:28,845 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.491, Acc: 0.640, Base Lr: 3.25e-03
2022-04-19 08:36:40,996 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.279[s] Speed: 57.4[samples/s]
2022-04-19 08:38:14,882 reid_baseline.train INFO: normal accuracy 0.6795960523295845 3.191387176513672 
2022-04-19 08:38:17,998 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 08:38:17,999 reid_baseline.train INFO: Accuracy: 68.0% Mean Entropy: 319.1%
2022-04-19 08:38:49,698 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.938, Acc: 0.717, Base Lr: 4.04e-03
2022-04-19 08:39:04,740 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-19 08:40:49,763 reid_baseline.train INFO: normal accuracy 0.740876750057379 2.6065356731414795 
2022-04-19 08:40:53,040 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 08:40:53,041 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 260.7%
2022-04-19 08:41:33,449 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.640, Acc: 0.762, Base Lr: 4.83e-03
2022-04-19 08:41:49,111 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-04-19 08:43:46,182 reid_baseline.train INFO: normal accuracy 0.7858618315354602 2.1342735290527344 
2022-04-19 08:43:49,354 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 08:43:49,355 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 213.4%
2022-04-19 08:44:27,858 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.451, Acc: 0.824, Base Lr: 5.62e-03
2022-04-19 08:44:47,182 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-19 08:46:44,150 reid_baseline.train INFO: normal accuracy 0.8090429194399816 1.8608726263046265 
2022-04-19 08:46:47,325 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 08:46:47,326 reid_baseline.train INFO: Accuracy: 80.9% Mean Entropy: 186.1%
2022-04-19 08:47:15,184 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.323, Acc: 0.851, Base Lr: 6.42e-03
2022-04-19 08:47:32,842 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-19 08:49:08,241 reid_baseline.train INFO: normal accuracy 0.8150103282074822 1.73636794090271 
2022-04-19 08:49:11,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 08:49:11,535 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 173.6%
2022-04-19 08:49:44,004 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.239, Acc: 0.869, Base Lr: 7.21e-03
2022-04-19 08:49:59,278 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.314[s] Speed: 51.0[samples/s]
2022-04-19 08:51:50,601 reid_baseline.train INFO: normal accuracy 0.8251090199678678 1.6319609880447388 
2022-04-19 08:51:53,887 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 08:51:53,889 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 163.2%
2022-04-19 08:52:24,299 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.185, Acc: 0.891, Base Lr: 4.01e-03
2022-04-19 08:52:35,897 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.276[s] Speed: 57.9[samples/s]
2022-04-19 08:54:33,005 reid_baseline.train INFO: normal accuracy 0.8274041771861372 1.5594788789749146 
2022-04-19 08:54:36,223 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 08:54:36,223 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 155.9%
2022-04-19 08:55:12,871 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.123, Acc: 0.909, Base Lr: 3.38e-03
2022-04-19 08:55:28,323 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.343[s] Speed: 46.7[samples/s]
2022-04-19 08:57:19,284 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.537997841835022 
2022-04-19 08:57:22,456 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 08:57:22,457 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 153.8%
2022-04-19 08:58:03,566 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.105, Acc: 0.906, Base Lr: 2.77e-03
2022-04-19 08:58:24,344 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.407[s] Speed: 39.3[samples/s]
2022-04-19 09:00:18,291 reid_baseline.train INFO: normal accuracy 0.8336011016754648 1.4821887016296387 
2022-04-19 09:00:21,521 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 09:00:21,522 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 148.2%
2022-04-19 09:00:48,930 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.104, Acc: 0.910, Base Lr: 2.20e-03
2022-04-19 09:01:03,956 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.279[s] Speed: 57.3[samples/s]
2022-04-19 09:03:00,006 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.5214329957962036 
2022-04-19 09:03:00,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 09:03:00,011 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 152.1%
2022-04-19 09:03:34,349 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.057, Acc: 0.926, Base Lr: 1.66e-03
2022-04-19 09:03:49,891 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-19 09:05:33,008 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4711121320724487 
2022-04-19 09:05:36,196 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 09:05:36,199 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 147.1%
2022-04-19 09:06:16,379 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.044, Acc: 0.933, Base Lr: 1.19e-03
2022-04-19 09:06:34,178 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.381[s] Speed: 42.0[samples/s]
2022-04-19 09:08:12,778 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4975183010101318 
2022-04-19 09:08:12,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 09:08:12,783 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 149.8%
2022-04-19 09:08:50,399 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.038, Acc: 0.941, Base Lr: 7.78e-04
2022-04-19 09:09:07,374 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-19 09:10:46,224 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.517693042755127 
2022-04-19 09:10:46,226 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 09:10:46,226 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 151.8%
2022-04-19 09:11:23,767 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.052, Acc: 0.928, Base Lr: 4.51e-04
2022-04-19 09:11:43,927 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.379[s] Speed: 42.2[samples/s]
2022-04-19 09:13:27,521 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4543709754943848 
2022-04-19 09:13:30,751 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 09:13:30,751 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 145.4%
2022-04-19 09:14:07,392 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.041, Acc: 0.928, Base Lr: 2.11e-04
2022-04-19 09:14:26,403 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.366[s] Speed: 43.7[samples/s]
2022-04-19 09:16:04,842 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.5267174243927002 
2022-04-19 09:16:04,847 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 09:16:04,847 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 152.7%
2022-04-19 09:16:40,416 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.025, Acc: 0.939, Base Lr: 6.51e-05
2022-04-19 09:16:58,185 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.351[s] Speed: 45.6[samples/s]
2022-04-19 09:18:32,816 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.5082237720489502 
2022-04-19 09:18:32,820 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 09:18:32,820 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 150.8%
2022-04-19 09:19:11,856 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.043, Acc: 0.920, Base Lr: 1.60e-05
2022-04-19 09:19:31,429 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.385[s] Speed: 41.5[samples/s]
2022-04-19 09:21:17,223 reid_baseline.train INFO: normal accuracy 0.836584806059215 1.4702084064483643 
2022-04-19 09:21:17,228 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 09:21:17,228 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 147.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_8_20_10/transformer_best_model.pth
2022-04-19 09:23:04,070 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4543709754943848 
2022-04-19 09:23:04,070 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:23:04,070 reid_baseline.train INFO: Accuracy: 83.6%
2022-04-19 09:24:42,445 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4543709754943848 
2022-04-19 09:24:42,445 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:24:42,445 reid_baseline.train INFO: Shuffled Accuracy: 83.6%
2022-04-19 09:25:06,072 reid_baseline.train INFO: normal accuracy 0.973217964565307 0.8769717216491699 
2022-04-19 09:25:06,072 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:25:06,072 reid_baseline.train INFO: Source Clean Accuracy: 97.3%
