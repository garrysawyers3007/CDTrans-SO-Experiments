2022-04-27 16:04:36,648 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_1
2022-04-27 16:04:36,648 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-27 16:04:36,648 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 16:04:36,648 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 16:04:36,648 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 16:04:47,503 reid_baseline.train INFO: start training
2022-04-27 16:05:03,682 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.163, Acc: 0.067, Base Lr: 8.72e-04
2022-04-27 16:05:10,890 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.153[s] Speed: 104.8[samples/s]
2022-04-27 16:05:32,355 reid_baseline.train INFO: normal accuracy 0.12073310423825888 4.172584533691406 
2022-04-27 16:05:33,091 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 16:05:33,091 reid_baseline.train INFO: Accuracy: 12.1% Mean Entropy: 417.3%
2022-04-27 16:05:48,591 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 4.054, Acc: 0.288, Base Lr: 1.66e-03
2022-04-27 16:05:55,842 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.149[s] Speed: 107.4[samples/s]
2022-04-27 16:06:17,306 reid_baseline.train INFO: normal accuracy 0.24536082474226803 4.166829586029053 
2022-04-27 16:06:18,114 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 16:06:18,114 reid_baseline.train INFO: Accuracy: 24.5% Mean Entropy: 416.7%
2022-04-27 16:06:34,101 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.592, Acc: 0.492, Base Lr: 2.46e-03
2022-04-27 16:06:41,777 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.153[s] Speed: 104.4[samples/s]
2022-04-27 16:07:03,353 reid_baseline.train INFO: normal accuracy 0.3097365406643757 4.070008754730225 
2022-04-27 16:07:04,154 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 16:07:04,155 reid_baseline.train INFO: Accuracy: 31.0% Mean Entropy: 407.0%
2022-04-27 16:07:20,681 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.689, Acc: 0.585, Base Lr: 3.25e-03
2022-04-27 16:07:28,063 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.156[s] Speed: 102.3[samples/s]
2022-04-27 16:07:49,969 reid_baseline.train INFO: normal accuracy 0.384192439862543 3.6918890476226807 
2022-04-27 16:07:50,723 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 16:07:50,724 reid_baseline.train INFO: Accuracy: 38.4% Mean Entropy: 369.2%
2022-04-27 16:08:07,880 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.102, Acc: 0.686, Base Lr: 4.04e-03
2022-04-27 16:08:15,146 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.160[s] Speed: 99.9[samples/s]
2022-04-27 16:08:36,618 reid_baseline.train INFO: normal accuracy 0.4517754868270332 3.259904623031616 
2022-04-27 16:08:37,417 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 16:08:37,417 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 326.0%
2022-04-27 16:08:54,291 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.716, Acc: 0.754, Base Lr: 4.83e-03
2022-04-27 16:09:01,945 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.160[s] Speed: 99.8[samples/s]
2022-04-27 16:09:23,750 reid_baseline.train INFO: normal accuracy 0.49942726231386025 2.8696858882904053 
2022-04-27 16:09:25,206 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 16:09:25,207 reid_baseline.train INFO: Accuracy: 49.9% Mean Entropy: 287.0%
2022-04-27 16:09:41,949 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.466, Acc: 0.819, Base Lr: 5.62e-03
2022-04-27 16:09:49,226 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.158[s] Speed: 101.4[samples/s]
2022-04-27 16:10:11,134 reid_baseline.train INFO: normal accuracy 0.5365406643757159 2.63368821144104 
2022-04-27 16:10:11,927 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 16:10:11,927 reid_baseline.train INFO: Accuracy: 53.7% Mean Entropy: 263.4%
2022-04-27 16:10:28,951 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.293, Acc: 0.861, Base Lr: 6.42e-03
2022-04-27 16:10:36,477 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.160[s] Speed: 100.0[samples/s]
2022-04-27 16:10:58,225 reid_baseline.train INFO: normal accuracy 0.563573883161512 2.3342232704162598 
2022-04-27 16:10:58,982 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 16:10:58,983 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 233.4%
2022-04-27 16:11:16,182 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.170, Acc: 0.896, Base Lr: 7.21e-03
2022-04-27 16:11:23,469 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.161[s] Speed: 99.4[samples/s]
2022-04-27 16:11:45,291 reid_baseline.train INFO: normal accuracy 0.5594501718213059 2.1354575157165527 
2022-04-27 16:11:46,153 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 16:11:46,153 reid_baseline.train INFO: Accuracy: 55.9% Mean Entropy: 213.5%
2022-04-27 16:12:01,940 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.084, Acc: 0.926, Base Lr: 4.01e-03
2022-04-27 16:12:09,461 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.152[s] Speed: 105.1[samples/s]
2022-04-27 16:12:31,754 reid_baseline.train INFO: normal accuracy 0.5745704467353951 2.086078643798828 
2022-04-27 16:12:32,572 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 16:12:32,572 reid_baseline.train INFO: Accuracy: 57.5% Mean Entropy: 208.6%
2022-04-27 16:12:49,599 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.046, Acc: 0.931, Base Lr: 3.38e-03
2022-04-27 16:12:57,014 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.159[s] Speed: 100.7[samples/s]
2022-04-27 16:13:18,723 reid_baseline.train INFO: normal accuracy 0.5741122565864833 1.9932658672332764 
2022-04-27 16:13:19,518 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 16:13:19,518 reid_baseline.train INFO: Accuracy: 57.4% Mean Entropy: 199.3%
2022-04-27 16:13:36,339 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.009, Acc: 0.946, Base Lr: 2.77e-03
2022-04-27 16:13:43,779 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.158[s] Speed: 101.3[samples/s]
2022-04-27 16:14:05,541 reid_baseline.train INFO: normal accuracy 0.5754868270332187 2.0304007530212402 
2022-04-27 16:14:05,542 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 16:14:05,542 reid_baseline.train INFO: Accuracy: 57.5% Mean Entropy: 203.0%
2022-04-27 16:14:22,593 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.988, Acc: 0.954, Base Lr: 2.20e-03
2022-04-27 16:14:30,208 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.162[s] Speed: 98.9[samples/s]
2022-04-27 16:14:51,853 reid_baseline.train INFO: normal accuracy 0.5821305841924399 1.9531701803207397 
2022-04-27 16:14:52,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 16:14:52,667 reid_baseline.train INFO: Accuracy: 58.2% Mean Entropy: 195.3%
2022-04-27 16:15:08,759 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.964, Acc: 0.959, Base Lr: 1.66e-03
2022-04-27 16:15:16,247 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.155[s] Speed: 103.4[samples/s]
2022-04-27 16:15:38,965 reid_baseline.train INFO: normal accuracy 0.5809851088201604 1.8694708347320557 
2022-04-27 16:15:40,795 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 16:15:40,795 reid_baseline.train INFO: Accuracy: 58.1% Mean Entropy: 186.9%
2022-04-27 16:15:57,683 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.959, Acc: 0.961, Base Lr: 1.19e-03
2022-04-27 16:16:05,209 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.160[s] Speed: 100.2[samples/s]
2022-04-27 16:16:27,177 reid_baseline.train INFO: normal accuracy 0.5832760595647194 1.9371570348739624 
2022-04-27 16:16:27,178 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 16:16:27,178 reid_baseline.train INFO: Accuracy: 58.3% Mean Entropy: 193.7%
2022-04-27 16:16:43,782 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.945, Acc: 0.966, Base Lr: 7.78e-04
2022-04-27 16:16:51,409 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.159[s] Speed: 100.7[samples/s]
2022-04-27 16:17:13,238 reid_baseline.train INFO: normal accuracy 0.5846506300114548 1.9447510242462158 
2022-04-27 16:17:13,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 16:17:13,238 reid_baseline.train INFO: Accuracy: 58.5% Mean Entropy: 194.5%
2022-04-27 16:17:30,485 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.945, Acc: 0.963, Base Lr: 4.51e-04
2022-04-27 16:17:37,998 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.162[s] Speed: 98.8[samples/s]
2022-04-27 16:17:59,683 reid_baseline.train INFO: normal accuracy 0.5825887743413517 1.9136484861373901 
2022-04-27 16:17:59,683 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 16:17:59,683 reid_baseline.train INFO: Accuracy: 58.3% Mean Entropy: 191.4%
2022-04-27 16:18:16,768 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.932, Acc: 0.976, Base Lr: 2.11e-04
2022-04-27 16:18:24,376 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.162[s] Speed: 98.9[samples/s]
2022-04-27 16:18:46,545 reid_baseline.train INFO: normal accuracy 0.5823596792668958 1.9485185146331787 
2022-04-27 16:18:46,546 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 16:18:46,546 reid_baseline.train INFO: Accuracy: 58.2% Mean Entropy: 194.9%
2022-04-27 16:19:03,075 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.935, Acc: 0.971, Base Lr: 6.51e-05
2022-04-27 16:19:10,693 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.158[s] Speed: 101.0[samples/s]
2022-04-27 16:19:32,274 reid_baseline.train INFO: normal accuracy 0.5823596792668958 1.9317373037338257 
2022-04-27 16:19:32,275 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 16:19:32,275 reid_baseline.train INFO: Accuracy: 58.2% Mean Entropy: 193.2%
2022-04-27 16:19:49,293 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.938, Acc: 0.971, Base Lr: 1.60e-05
2022-04-27 16:19:56,684 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.160[s] Speed: 100.2[samples/s]
2022-04-27 16:20:18,347 reid_baseline.train INFO: normal accuracy 0.5800687285223368 1.9287456274032593 
2022-04-27 16:20:18,348 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 16:20:18,348 reid_baseline.train INFO: Accuracy: 58.0% Mean Entropy: 192.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_1/transformer_best_model.pth
2022-04-27 16:20:41,625 reid_baseline.train INFO: normal accuracy 0.5809851088201604 1.8694708347320557 
2022-04-27 16:20:41,625 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:20:41,625 reid_baseline.train INFO: Accuracy: 58.1%
2022-04-27 16:21:03,295 reid_baseline.train INFO: normal accuracy 0.5809851088201604 1.8694708347320557 
2022-04-27 16:21:03,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:21:03,295 reid_baseline.train INFO: Shuffled Accuracy: 58.1%
2022-04-27 16:21:25,906 reid_baseline.train INFO: normal accuracy 0.9777503090234858 0.8497982025146484 
2022-04-27 16:21:25,906 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:21:25,906 reid_baseline.train INFO: Source Clean Accuracy: 97.8%
2022-04-27 16:21:30,382 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_1
2022-04-27 16:21:30,382 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-27 16:21:30,382 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 16:21:30,382 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 16:21:30,383 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 16:21:42,511 reid_baseline.train INFO: start training
2022-04-27 16:21:59,109 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.163, Acc: 0.067, Base Lr: 8.72e-04
2022-04-27 16:22:07,067 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.158[s] Speed: 101.2[samples/s]
2022-04-27 16:22:29,377 reid_baseline.train INFO: normal accuracy 0.1457535480964181 4.172484874725342 
2022-04-27 16:22:30,159 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 16:22:30,160 reid_baseline.train INFO: Accuracy: 14.6% Mean Entropy: 417.2%
2022-04-27 16:22:46,671 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 4.054, Acc: 0.288, Base Lr: 1.66e-03
2022-04-27 16:22:54,238 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.158[s] Speed: 101.0[samples/s]
2022-04-27 16:23:17,285 reid_baseline.train INFO: normal accuracy 0.27438612300067583 4.166781425476074 
2022-04-27 16:23:18,136 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 16:23:18,137 reid_baseline.train INFO: Accuracy: 27.4% Mean Entropy: 416.7%
2022-04-27 16:23:38,065 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.592, Acc: 0.492, Base Lr: 2.46e-03
2022-04-27 16:23:48,298 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.198[s] Speed: 80.7[samples/s]
2022-04-27 16:24:14,660 reid_baseline.train INFO: normal accuracy 0.37823834196891193 4.047873020172119 
2022-04-27 16:24:15,507 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 16:24:15,507 reid_baseline.train INFO: Accuracy: 37.8% Mean Entropy: 404.8%
2022-04-27 16:24:36,471 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.689, Acc: 0.585, Base Lr: 3.25e-03
2022-04-27 16:24:44,171 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.188[s] Speed: 84.9[samples/s]
2022-04-27 16:25:06,306 reid_baseline.train INFO: normal accuracy 0.45663437711196214 3.615983247756958 
2022-04-27 16:25:07,143 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 16:25:07,143 reid_baseline.train INFO: Accuracy: 45.7% Mean Entropy: 361.6%
2022-04-27 16:25:24,199 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.102, Acc: 0.686, Base Lr: 4.04e-03
2022-04-27 16:25:33,556 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.173[s] Speed: 92.5[samples/s]
2022-04-27 16:25:57,273 reid_baseline.train INFO: normal accuracy 0.5634151835999099 3.0347177982330322 
2022-04-27 16:25:58,093 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 16:25:58,093 reid_baseline.train INFO: Accuracy: 56.3% Mean Entropy: 303.5%
2022-04-27 16:26:19,456 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.716, Acc: 0.754, Base Lr: 4.83e-03
2022-04-27 16:26:28,302 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.198[s] Speed: 80.7[samples/s]
2022-04-27 16:26:56,551 reid_baseline.train INFO: normal accuracy 0.6427123225951791 2.565551519393921 
2022-04-27 16:26:57,644 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 16:26:57,644 reid_baseline.train INFO: Accuracy: 64.3% Mean Entropy: 256.6%
2022-04-27 16:27:27,546 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.466, Acc: 0.819, Base Lr: 5.62e-03
2022-04-27 16:27:45,406 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-27 16:28:14,776 reid_baseline.train INFO: normal accuracy 0.6918224825411129 2.2996866703033447 
2022-04-27 16:28:15,564 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 16:28:15,564 reid_baseline.train INFO: Accuracy: 69.2% Mean Entropy: 230.0%
2022-04-27 16:28:32,903 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.293, Acc: 0.861, Base Lr: 6.42e-03
2022-04-27 16:28:40,250 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.161[s] Speed: 99.4[samples/s]
2022-04-27 16:29:02,637 reid_baseline.train INFO: normal accuracy 0.7150259067357513 2.023470640182495 
2022-04-27 16:29:03,459 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 16:29:03,459 reid_baseline.train INFO: Accuracy: 71.5% Mean Entropy: 202.3%
2022-04-27 16:29:20,559 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.170, Acc: 0.896, Base Lr: 7.21e-03
2022-04-27 16:29:27,772 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.160[s] Speed: 100.3[samples/s]
2022-04-27 16:29:50,571 reid_baseline.train INFO: normal accuracy 0.7251633250732147 1.8011133670806885 
2022-04-27 16:29:51,308 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 16:29:51,308 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 180.1%
2022-04-27 16:30:07,123 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.084, Acc: 0.926, Base Lr: 4.01e-03
2022-04-27 16:30:14,670 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.153[s] Speed: 104.8[samples/s]
2022-04-27 16:30:36,737 reid_baseline.train INFO: normal accuracy 0.7364271232259518 1.77605402469635 
2022-04-27 16:30:37,560 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 16:30:37,560 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 177.6%
2022-04-27 16:30:54,495 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.046, Acc: 0.931, Base Lr: 3.38e-03
2022-04-27 16:31:02,025 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.161[s] Speed: 99.6[samples/s]
2022-04-27 16:31:24,075 reid_baseline.train INFO: normal accuracy 0.730119396260419 1.6905306577682495 
2022-04-27 16:31:24,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 16:31:24,946 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 169.1%
2022-04-27 16:31:41,706 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.009, Acc: 0.946, Base Lr: 2.77e-03
2022-04-27 16:31:49,045 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.157[s] Speed: 101.9[samples/s]
2022-04-27 16:32:11,735 reid_baseline.train INFO: normal accuracy 0.7413831944131561 1.763795018196106 
2022-04-27 16:32:11,736 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 16:32:11,736 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 176.4%
2022-04-27 16:32:27,764 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.988, Acc: 0.954, Base Lr: 2.20e-03
2022-04-27 16:32:35,155 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.154[s] Speed: 104.1[samples/s]
2022-04-27 16:32:57,601 reid_baseline.train INFO: normal accuracy 0.7404820905609372 1.6630620956420898 
2022-04-27 16:32:58,406 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 16:32:58,407 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 166.3%
2022-04-27 16:33:15,093 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.964, Acc: 0.959, Base Lr: 1.66e-03
2022-04-27 16:33:22,622 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.158[s] Speed: 101.3[samples/s]
2022-04-27 16:33:45,162 reid_baseline.train INFO: normal accuracy 0.7443117819328677 1.5798721313476562 
2022-04-27 16:33:46,027 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 16:33:46,027 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 158.0%
2022-04-27 16:34:03,391 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.959, Acc: 0.961, Base Lr: 1.19e-03
2022-04-27 16:34:11,059 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.163[s] Speed: 98.2[samples/s]
2022-04-27 16:34:33,175 reid_baseline.train INFO: normal accuracy 0.7479161973417436 1.6618906259536743 
2022-04-27 16:34:33,176 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 16:34:33,176 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 166.2%
2022-04-27 16:34:49,686 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.945, Acc: 0.966, Base Lr: 7.78e-04
2022-04-27 16:34:57,326 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.158[s] Speed: 101.1[samples/s]
2022-04-27 16:35:19,635 reid_baseline.train INFO: normal accuracy 0.7474656454156342 1.6692224740982056 
2022-04-27 16:35:19,636 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 16:35:19,636 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 166.9%
2022-04-27 16:35:36,071 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.945, Acc: 0.963, Base Lr: 4.51e-04
2022-04-27 16:35:43,481 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.156[s] Speed: 102.4[samples/s]
2022-04-27 16:36:06,441 reid_baseline.train INFO: normal accuracy 0.7474656454156342 1.6277060508728027 
2022-04-27 16:36:06,442 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 16:36:06,442 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 162.8%
2022-04-27 16:36:23,115 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.932, Acc: 0.976, Base Lr: 2.11e-04
2022-04-27 16:36:30,569 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.158[s] Speed: 101.3[samples/s]
2022-04-27 16:36:52,656 reid_baseline.train INFO: normal accuracy 0.7467898175264699 1.6693857908248901 
2022-04-27 16:36:52,656 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 16:36:52,656 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 166.9%
2022-04-27 16:37:09,215 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.935, Acc: 0.971, Base Lr: 6.51e-05
2022-04-27 16:37:16,933 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.158[s] Speed: 101.3[samples/s]
2022-04-27 16:37:39,119 reid_baseline.train INFO: normal accuracy 0.7467898175264699 1.6442713737487793 
2022-04-27 16:37:39,119 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 16:37:39,119 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 164.4%
2022-04-27 16:37:55,254 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.938, Acc: 0.971, Base Lr: 1.60e-05
2022-04-27 16:38:02,445 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.152[s] Speed: 105.2[samples/s]
2022-04-27 16:38:24,765 reid_baseline.train INFO: normal accuracy 0.750168956972291 1.6444989442825317 
2022-04-27 16:38:24,765 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 16:38:24,765 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 164.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_1/transformer_best_model.pth
2022-04-27 16:38:47,679 reid_baseline.train INFO: normal accuracy 0.7443117819328677 1.5798721313476562 
2022-04-27 16:38:47,679 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:38:47,680 reid_baseline.train INFO: Accuracy: 74.4%
2022-04-27 16:39:10,128 reid_baseline.train INFO: normal accuracy 0.7443117819328677 1.5798721313476562 
2022-04-27 16:39:10,129 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:39:10,129 reid_baseline.train INFO: Shuffled Accuracy: 74.4%
2022-04-27 16:39:32,609 reid_baseline.train INFO: normal accuracy 0.9777503090234858 0.8497982025146484 
2022-04-27 16:39:32,609 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:39:32,609 reid_baseline.train INFO: Source Clean Accuracy: 97.8%
2022-04-27 16:39:37,442 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_1
2022-04-27 16:39:37,442 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-27 16:39:37,442 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 16:39:37,442 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 16:39:37,443 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 16:39:48,315 reid_baseline.train INFO: start training
2022-04-27 16:40:06,181 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.163, Acc: 0.067, Base Lr: 8.72e-04
2022-04-27 16:40:14,504 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.169[s] Speed: 94.6[samples/s]
2022-04-27 16:41:42,827 reid_baseline.train INFO: normal accuracy 0.19325223777828782 4.172441482543945 
2022-04-27 16:41:43,569 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 16:41:43,570 reid_baseline.train INFO: Accuracy: 19.3% Mean Entropy: 417.2%
2022-04-27 16:42:00,180 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 4.054, Acc: 0.288, Base Lr: 1.66e-03
2022-04-27 16:42:07,443 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.157[s] Speed: 101.9[samples/s]
2022-04-27 16:43:31,833 reid_baseline.train INFO: normal accuracy 0.38857011705301814 4.165831089019775 
2022-04-27 16:43:32,645 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 16:43:32,645 reid_baseline.train INFO: Accuracy: 38.9% Mean Entropy: 416.6%
2022-04-27 16:43:48,488 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.592, Acc: 0.492, Base Lr: 2.46e-03
2022-04-27 16:43:56,069 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.153[s] Speed: 104.4[samples/s]
2022-04-27 16:45:21,495 reid_baseline.train INFO: normal accuracy 0.4783107642873537 3.991285562515259 
2022-04-27 16:45:22,326 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 16:45:22,326 reid_baseline.train INFO: Accuracy: 47.8% Mean Entropy: 399.1%
2022-04-27 16:45:38,897 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.689, Acc: 0.585, Base Lr: 3.25e-03
2022-04-27 16:45:46,271 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.156[s] Speed: 102.7[samples/s]
2022-04-27 16:47:13,995 reid_baseline.train INFO: normal accuracy 0.5708056001836126 3.3796942234039307 
2022-04-27 16:47:14,815 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 16:47:14,815 reid_baseline.train INFO: Accuracy: 57.1% Mean Entropy: 338.0%
2022-04-27 16:47:32,456 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.102, Acc: 0.686, Base Lr: 4.04e-03
2022-04-27 16:47:39,920 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.163[s] Speed: 97.9[samples/s]
2022-04-27 16:49:04,239 reid_baseline.train INFO: normal accuracy 0.6678907505164103 2.7425119876861572 
2022-04-27 16:49:05,160 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 16:49:05,161 reid_baseline.train INFO: Accuracy: 66.8% Mean Entropy: 274.3%
2022-04-27 16:49:24,142 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.716, Acc: 0.754, Base Lr: 4.83e-03
2022-04-27 16:49:32,325 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.178[s] Speed: 89.7[samples/s]
2022-04-27 16:51:16,700 reid_baseline.train INFO: normal accuracy 0.7273353224695892 2.277233839035034 
2022-04-27 16:51:17,632 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 16:51:17,632 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 227.7%
2022-04-27 16:51:55,271 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.466, Acc: 0.819, Base Lr: 5.62e-03
2022-04-27 16:52:04,417 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-27 16:53:37,508 reid_baseline.train INFO: normal accuracy 0.7691071838420932 2.0165505409240723 
2022-04-27 16:53:38,399 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 16:53:38,399 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 201.7%
2022-04-27 16:53:58,070 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.293, Acc: 0.861, Base Lr: 6.42e-03
2022-04-27 16:54:05,838 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.180[s] Speed: 89.0[samples/s]
2022-04-27 16:55:44,966 reid_baseline.train INFO: normal accuracy 0.7902226302501721 1.7575398683547974 
2022-04-27 16:55:45,837 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 16:55:45,837 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 175.8%
2022-04-27 16:56:03,195 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.170, Acc: 0.896, Base Lr: 7.21e-03
2022-04-27 16:56:10,730 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.163[s] Speed: 97.9[samples/s]
2022-04-27 16:57:39,428 reid_baseline.train INFO: normal accuracy 0.7961900390176727 1.5677070617675781 
2022-04-27 16:57:40,305 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 16:57:40,306 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 156.8%
2022-04-27 16:57:57,417 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.084, Acc: 0.926, Base Lr: 4.01e-03
2022-04-27 16:58:04,768 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.159[s] Speed: 100.4[samples/s]
2022-04-27 16:59:28,456 reid_baseline.train INFO: normal accuracy 0.7998622905669038 1.5455553531646729 
2022-04-27 16:59:29,218 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 16:59:29,219 reid_baseline.train INFO: Accuracy: 80.0% Mean Entropy: 154.6%
2022-04-27 16:59:44,923 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.046, Acc: 0.931, Base Lr: 3.38e-03
2022-04-27 16:59:52,349 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.151[s] Speed: 105.7[samples/s]
2022-04-27 17:01:17,283 reid_baseline.train INFO: normal accuracy 0.8056001836125775 1.4649748802185059 
2022-04-27 17:01:18,134 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 17:01:18,135 reid_baseline.train INFO: Accuracy: 80.6% Mean Entropy: 146.5%
2022-04-27 17:01:37,298 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.009, Acc: 0.946, Base Lr: 2.77e-03
2022-04-27 17:01:45,232 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.178[s] Speed: 90.0[samples/s]
2022-04-27 17:03:16,482 reid_baseline.train INFO: normal accuracy 0.8081248565526739 1.527370810508728 
2022-04-27 17:03:16,483 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 17:03:16,483 reid_baseline.train INFO: Accuracy: 80.8% Mean Entropy: 152.7%
2022-04-27 17:03:35,139 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.988, Acc: 0.954, Base Lr: 2.20e-03
2022-04-27 17:03:43,160 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.175[s] Speed: 91.6[samples/s]
2022-04-27 17:05:15,834 reid_baseline.train INFO: normal accuracy 0.80766582510902 1.4470133781433105 
2022-04-27 17:05:16,689 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 17:05:16,689 reid_baseline.train INFO: Accuracy: 80.8% Mean Entropy: 144.7%
2022-04-27 17:05:33,444 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.964, Acc: 0.959, Base Lr: 1.66e-03
2022-04-27 17:05:41,040 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.160[s] Speed: 100.1[samples/s]
2022-04-27 17:07:07,168 reid_baseline.train INFO: normal accuracy 0.8127151709892128 1.359287977218628 
2022-04-27 17:07:08,011 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 17:07:08,011 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 135.9%
2022-04-27 17:07:24,757 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.959, Acc: 0.961, Base Lr: 1.19e-03
2022-04-27 17:07:32,297 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.158[s] Speed: 101.0[samples/s]
2022-04-27 17:08:57,384 reid_baseline.train INFO: normal accuracy 0.8131742024328666 1.4447077512741089 
2022-04-27 17:08:57,384 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 17:08:57,384 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 144.5%
2022-04-27 17:09:13,753 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.945, Acc: 0.966, Base Lr: 7.78e-04
2022-04-27 17:09:21,234 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.155[s] Speed: 102.9[samples/s]
2022-04-27 17:11:00,582 reid_baseline.train INFO: normal accuracy 0.8122561395455589 1.4518868923187256 
2022-04-27 17:11:00,583 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 17:11:00,583 reid_baseline.train INFO: Accuracy: 81.2% Mean Entropy: 145.2%
2022-04-27 17:11:16,069 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.945, Acc: 0.963, Base Lr: 4.51e-04
2022-04-27 17:11:23,416 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.150[s] Speed: 106.9[samples/s]
2022-04-27 17:12:47,641 reid_baseline.train INFO: normal accuracy 0.8134037181546936 1.4170094728469849 
2022-04-27 17:12:47,642 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 17:12:47,642 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 141.7%
2022-04-27 17:13:04,476 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.932, Acc: 0.976, Base Lr: 2.11e-04
2022-04-27 17:13:11,568 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.156[s] Speed: 102.8[samples/s]
2022-04-27 17:14:37,267 reid_baseline.train INFO: normal accuracy 0.811567592380078 1.4598069190979004 
2022-04-27 17:14:37,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 17:14:37,268 reid_baseline.train INFO: Accuracy: 81.2% Mean Entropy: 146.0%
2022-04-27 17:14:54,339 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.935, Acc: 0.971, Base Lr: 6.51e-05
2022-04-27 17:15:02,043 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.162[s] Speed: 98.6[samples/s]
2022-04-27 17:16:25,689 reid_baseline.train INFO: normal accuracy 0.8124856552673858 1.4332294464111328 
2022-04-27 17:16:25,690 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 17:16:25,690 reid_baseline.train INFO: Accuracy: 81.2% Mean Entropy: 143.3%
2022-04-27 17:16:42,350 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.938, Acc: 0.971, Base Lr: 1.60e-05
2022-04-27 17:16:49,990 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.158[s] Speed: 101.2[samples/s]
2022-04-27 17:18:15,395 reid_baseline.train INFO: normal accuracy 0.8122561395455589 1.4319214820861816 
2022-04-27 17:18:15,395 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 17:18:15,395 reid_baseline.train INFO: Accuracy: 81.2% Mean Entropy: 143.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_1/transformer_best_model.pth
2022-04-27 17:19:43,967 reid_baseline.train INFO: normal accuracy 0.8127151709892128 1.359287977218628 
2022-04-27 17:19:43,967 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:19:43,967 reid_baseline.train INFO: Accuracy: 81.3%
2022-04-27 17:21:11,825 reid_baseline.train INFO: normal accuracy 0.8127151709892128 1.359287977218628 
2022-04-27 17:21:11,826 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:21:11,826 reid_baseline.train INFO: Shuffled Accuracy: 81.3%
2022-04-27 17:21:34,650 reid_baseline.train INFO: normal accuracy 0.9777503090234858 0.8497982025146484 
2022-04-27 17:21:34,650 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:21:34,650 reid_baseline.train INFO: Source Clean Accuracy: 97.8%
2022-04-27 17:21:38,965 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_2
2022-04-27 17:21:38,965 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-27 17:21:38,965 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 17:21:38,965 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 17:21:38,965 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 17:21:49,866 reid_baseline.train INFO: start training
2022-04-27 17:22:07,115 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.151, Acc: 0.123, Base Lr: 8.72e-04
2022-04-27 17:22:14,811 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.162[s] Speed: 98.6[samples/s]
2022-04-27 17:22:36,786 reid_baseline.train INFO: normal accuracy 0.17525773195876287 4.172323226928711 
2022-04-27 17:22:37,534 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 17:22:37,534 reid_baseline.train INFO: Accuracy: 17.5% Mean Entropy: 417.2%
2022-04-27 17:22:54,549 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.933, Acc: 0.447, Base Lr: 1.66e-03
2022-04-27 17:23:02,102 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.162[s] Speed: 99.0[samples/s]
2022-04-27 17:23:24,031 reid_baseline.train INFO: normal accuracy 0.28888888888888886 4.156322002410889 
2022-04-27 17:23:24,825 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 17:23:24,825 reid_baseline.train INFO: Accuracy: 28.9% Mean Entropy: 415.6%
2022-04-27 17:23:40,889 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.324, Acc: 0.520, Base Lr: 2.46e-03
2022-04-27 17:23:48,263 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.154[s] Speed: 104.1[samples/s]
2022-04-27 17:24:09,986 reid_baseline.train INFO: normal accuracy 0.3335624284077892 3.995692014694214 
2022-04-27 17:24:10,827 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 17:24:10,827 reid_baseline.train INFO: Accuracy: 33.4% Mean Entropy: 399.6%
2022-04-27 17:24:27,626 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.498, Acc: 0.600, Base Lr: 3.25e-03
2022-04-27 17:24:35,156 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.159[s] Speed: 100.6[samples/s]
2022-04-27 17:24:57,703 reid_baseline.train INFO: normal accuracy 0.4020618556701031 3.6051878929138184 
2022-04-27 17:24:58,522 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 17:24:58,522 reid_baseline.train INFO: Accuracy: 40.2% Mean Entropy: 360.5%
2022-04-27 17:25:15,010 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.978, Acc: 0.717, Base Lr: 4.04e-03
2022-04-27 17:25:22,681 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.158[s] Speed: 101.0[samples/s]
2022-04-27 17:25:44,628 reid_baseline.train INFO: normal accuracy 0.46002290950744557 3.161396026611328 
2022-04-27 17:25:45,376 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 17:25:45,377 reid_baseline.train INFO: Accuracy: 46.0% Mean Entropy: 316.1%
2022-04-27 17:26:01,707 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.637, Acc: 0.779, Base Lr: 4.83e-03
2022-04-27 17:26:09,235 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.157[s] Speed: 102.1[samples/s]
2022-04-27 17:26:30,831 reid_baseline.train INFO: normal accuracy 0.516151202749141 2.7819159030914307 
2022-04-27 17:26:31,614 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 17:26:31,614 reid_baseline.train INFO: Accuracy: 51.6% Mean Entropy: 278.2%
2022-04-27 17:26:48,304 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.413, Acc: 0.831, Base Lr: 5.62e-03
2022-04-27 17:26:55,958 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.160[s] Speed: 100.0[samples/s]
2022-04-27 17:27:18,572 reid_baseline.train INFO: normal accuracy 0.5468499427262313 2.5617001056671143 
2022-04-27 17:27:19,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 17:27:19,365 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 256.2%
2022-04-27 17:27:36,446 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.275, Acc: 0.865, Base Lr: 6.42e-03
2022-04-27 17:27:43,753 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.159[s] Speed: 100.8[samples/s]
2022-04-27 17:28:05,520 reid_baseline.train INFO: normal accuracy 0.5608247422680412 2.2972164154052734 
2022-04-27 17:28:06,319 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 17:28:06,320 reid_baseline.train INFO: Accuracy: 56.1% Mean Entropy: 229.7%
2022-04-27 17:28:23,114 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.148, Acc: 0.902, Base Lr: 7.21e-03
2022-04-27 17:28:30,577 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.159[s] Speed: 100.6[samples/s]
2022-04-27 17:28:52,408 reid_baseline.train INFO: normal accuracy 0.5550973654066438 2.093554973602295 
2022-04-27 17:28:53,227 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 17:28:53,227 reid_baseline.train INFO: Accuracy: 55.5% Mean Entropy: 209.4%
2022-04-27 17:29:10,766 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.065, Acc: 0.926, Base Lr: 4.01e-03
2022-04-27 17:29:18,599 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.166[s] Speed: 96.2[samples/s]
2022-04-27 17:29:40,610 reid_baseline.train INFO: normal accuracy 0.5736540664375716 2.0964763164520264 
2022-04-27 17:29:40,610 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 17:29:40,610 reid_baseline.train INFO: Accuracy: 57.4% Mean Entropy: 209.6%
2022-04-27 17:29:56,755 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.026, Acc: 0.938, Base Lr: 3.38e-03
2022-04-27 17:30:04,049 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.153[s] Speed: 104.8[samples/s]
2022-04-27 17:30:25,856 reid_baseline.train INFO: normal accuracy 0.5665521191294387 1.9979506731033325 
2022-04-27 17:30:26,699 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 17:30:26,699 reid_baseline.train INFO: Accuracy: 56.7% Mean Entropy: 199.8%
2022-04-27 17:30:43,288 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 0.999, Acc: 0.952, Base Lr: 2.77e-03
2022-04-27 17:30:50,746 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.157[s] Speed: 101.7[samples/s]
2022-04-27 17:31:13,192 reid_baseline.train INFO: normal accuracy 0.5706758304696449 2.0054428577423096 
2022-04-27 17:31:13,193 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 17:31:13,193 reid_baseline.train INFO: Accuracy: 57.1% Mean Entropy: 200.5%
2022-04-27 17:31:30,038 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.976, Acc: 0.959, Base Lr: 2.20e-03
2022-04-27 17:31:37,667 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.160[s] Speed: 99.9[samples/s]
2022-04-27 17:31:59,994 reid_baseline.train INFO: normal accuracy 0.5729667812142039 1.9351309537887573 
2022-04-27 17:32:00,740 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 17:32:00,741 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 193.5%
2022-04-27 17:32:17,482 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.961, Acc: 0.964, Base Lr: 1.66e-03
2022-04-27 17:32:25,108 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.159[s] Speed: 100.5[samples/s]
2022-04-27 17:32:47,086 reid_baseline.train INFO: normal accuracy 0.5738831615120275 1.8786977529525757 
2022-04-27 17:32:47,873 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 17:32:47,873 reid_baseline.train INFO: Accuracy: 57.4% Mean Entropy: 187.9%
2022-04-27 17:33:04,930 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.942, Acc: 0.967, Base Lr: 1.19e-03
2022-04-27 17:33:12,504 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.161[s] Speed: 99.1[samples/s]
2022-04-27 17:33:34,466 reid_baseline.train INFO: normal accuracy 0.5773195876288659 1.9284547567367554 
2022-04-27 17:33:34,466 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 17:33:34,466 reid_baseline.train INFO: Accuracy: 57.7% Mean Entropy: 192.8%
2022-04-27 17:33:51,788 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.934, Acc: 0.969, Base Lr: 7.78e-04
2022-04-27 17:33:59,228 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.162[s] Speed: 98.6[samples/s]
2022-04-27 17:34:21,011 reid_baseline.train INFO: normal accuracy 0.5759450171821305 1.9363991022109985 
2022-04-27 17:34:21,012 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 17:34:21,012 reid_baseline.train INFO: Accuracy: 57.6% Mean Entropy: 193.6%
2022-04-27 17:34:36,965 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.927, Acc: 0.969, Base Lr: 4.51e-04
2022-04-27 17:34:44,505 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.153[s] Speed: 104.5[samples/s]
2022-04-27 17:35:06,313 reid_baseline.train INFO: normal accuracy 0.574799541809851 1.8967632055282593 
2022-04-27 17:35:06,313 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 17:35:06,314 reid_baseline.train INFO: Accuracy: 57.5% Mean Entropy: 189.7%
2022-04-27 17:35:23,960 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.920, Acc: 0.975, Base Lr: 2.11e-04
2022-04-27 17:35:31,596 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.165[s] Speed: 97.1[samples/s]
2022-04-27 17:35:53,667 reid_baseline.train INFO: normal accuracy 0.5750286368843069 1.9314581155776978 
2022-04-27 17:35:53,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 17:35:53,667 reid_baseline.train INFO: Accuracy: 57.5% Mean Entropy: 193.1%
2022-04-27 17:36:10,399 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.930, Acc: 0.970, Base Lr: 6.51e-05
2022-04-27 17:36:17,547 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.157[s] Speed: 102.1[samples/s]
2022-04-27 17:36:39,754 reid_baseline.train INFO: normal accuracy 0.5743413516609392 1.9185196161270142 
2022-04-27 17:36:39,754 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 17:36:39,754 reid_baseline.train INFO: Accuracy: 57.4% Mean Entropy: 191.9%
2022-04-27 17:36:56,815 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.927, Acc: 0.977, Base Lr: 1.60e-05
2022-04-27 17:37:04,577 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.162[s] Speed: 98.7[samples/s]
2022-04-27 17:37:26,532 reid_baseline.train INFO: normal accuracy 0.5750286368843069 1.9020898342132568 
2022-04-27 17:37:26,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 17:37:26,533 reid_baseline.train INFO: Accuracy: 57.5% Mean Entropy: 190.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_2/transformer_best_model.pth
2022-04-27 17:37:49,209 reid_baseline.train INFO: normal accuracy 0.5738831615120275 1.8786977529525757 
2022-04-27 17:37:49,210 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:37:49,210 reid_baseline.train INFO: Accuracy: 57.4%
2022-04-27 17:38:11,491 reid_baseline.train INFO: normal accuracy 0.5738831615120275 1.8786977529525757 
2022-04-27 17:38:11,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:38:11,491 reid_baseline.train INFO: Shuffled Accuracy: 57.4%
2022-04-27 17:38:34,814 reid_baseline.train INFO: normal accuracy 0.9765142150803461 0.8585700392723083 
2022-04-27 17:38:34,815 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:38:34,815 reid_baseline.train INFO: Source Clean Accuracy: 97.7%
2022-04-27 17:38:39,577 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_2
2022-04-27 17:38:39,577 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-27 17:38:39,577 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 17:38:39,577 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 17:38:39,578 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 17:38:50,552 reid_baseline.train INFO: start training
2022-04-27 17:39:07,529 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.151, Acc: 0.123, Base Lr: 8.72e-04
2022-04-27 17:39:14,970 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.159[s] Speed: 100.9[samples/s]
2022-04-27 17:39:37,521 reid_baseline.train INFO: normal accuracy 0.2056769542689795 4.172283172607422 
2022-04-27 17:39:38,229 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 17:39:38,229 reid_baseline.train INFO: Accuracy: 20.6% Mean Entropy: 417.2%
2022-04-27 17:39:53,893 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.933, Acc: 0.447, Base Lr: 1.66e-03
2022-04-27 17:40:01,275 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.151[s] Speed: 105.8[samples/s]
2022-04-27 17:40:23,445 reid_baseline.train INFO: normal accuracy 0.33498535706240146 4.153239727020264 
2022-04-27 17:40:24,249 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 17:40:24,249 reid_baseline.train INFO: Accuracy: 33.5% Mean Entropy: 415.3%
2022-04-27 17:40:40,758 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.324, Acc: 0.520, Base Lr: 2.46e-03
2022-04-27 17:40:48,475 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.159[s] Speed: 100.6[samples/s]
2022-04-27 17:41:10,643 reid_baseline.train INFO: normal accuracy 0.40865059698130207 3.9666049480438232 
2022-04-27 17:41:11,521 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 17:41:11,521 reid_baseline.train INFO: Accuracy: 40.9% Mean Entropy: 396.7%
2022-04-27 17:41:27,602 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.498, Acc: 0.600, Base Lr: 3.25e-03
2022-04-27 17:41:35,246 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.156[s] Speed: 102.6[samples/s]
2022-04-27 17:41:57,463 reid_baseline.train INFO: normal accuracy 0.4850191484568597 3.5094809532165527 
2022-04-27 17:41:58,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 17:41:58,318 reid_baseline.train INFO: Accuracy: 48.5% Mean Entropy: 350.9%
2022-04-27 17:42:14,421 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.978, Acc: 0.717, Base Lr: 4.04e-03
2022-04-27 17:42:21,987 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.156[s] Speed: 102.8[samples/s]
2022-04-27 17:42:44,064 reid_baseline.train INFO: normal accuracy 0.5812119846812345 2.905884265899658 
2022-04-27 17:42:44,872 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 17:42:44,872 reid_baseline.train INFO: Accuracy: 58.1% Mean Entropy: 290.6%
2022-04-27 17:43:01,513 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.637, Acc: 0.779, Base Lr: 4.83e-03
2022-04-27 17:43:09,164 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.158[s] Speed: 101.2[samples/s]
2022-04-27 17:43:31,278 reid_baseline.train INFO: normal accuracy 0.6578058121198468 2.4806084632873535 
2022-04-27 17:43:32,088 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 17:43:32,088 reid_baseline.train INFO: Accuracy: 65.8% Mean Entropy: 248.1%
2022-04-27 17:43:48,757 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.413, Acc: 0.831, Base Lr: 5.62e-03
2022-04-27 17:43:56,149 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.157[s] Speed: 102.0[samples/s]
2022-04-27 17:44:18,213 reid_baseline.train INFO: normal accuracy 0.7028610047307953 2.2181248664855957 
2022-04-27 17:44:19,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 17:44:19,021 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 221.8%
2022-04-27 17:44:36,002 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.275, Acc: 0.865, Base Lr: 6.42e-03
2022-04-27 17:44:43,347 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.160[s] Speed: 100.1[samples/s]
2022-04-27 17:45:05,465 reid_baseline.train INFO: normal accuracy 0.7193061500337914 1.9918138980865479 
2022-04-27 17:45:06,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 17:45:06,289 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 199.2%
2022-04-27 17:45:22,804 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.148, Acc: 0.902, Base Lr: 7.21e-03
2022-04-27 17:45:30,181 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.157[s] Speed: 101.9[samples/s]
2022-04-27 17:45:52,485 reid_baseline.train INFO: normal accuracy 0.7242622212209957 1.7735775709152222 
2022-04-27 17:45:53,283 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 17:45:53,283 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 177.4%
2022-04-27 17:46:09,801 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.065, Acc: 0.926, Base Lr: 4.01e-03
2022-04-27 17:46:17,123 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.156[s] Speed: 102.4[samples/s]
2022-04-27 17:46:39,127 reid_baseline.train INFO: normal accuracy 0.7350754674476233 1.7937458753585815 
2022-04-27 17:46:39,128 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 17:46:39,128 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 179.4%
2022-04-27 17:46:55,545 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.026, Acc: 0.938, Base Lr: 3.38e-03
2022-04-27 17:47:03,276 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.159[s] Speed: 100.9[samples/s]
2022-04-27 17:47:25,351 reid_baseline.train INFO: normal accuracy 0.7298941202973642 1.7052847146987915 
2022-04-27 17:47:26,146 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 17:47:26,146 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 170.5%
2022-04-27 17:47:42,868 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 0.999, Acc: 0.952, Base Lr: 2.77e-03
2022-04-27 17:47:50,347 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.159[s] Speed: 100.6[samples/s]
2022-04-27 17:48:12,688 reid_baseline.train INFO: normal accuracy 0.7429601261545393 1.730210304260254 
2022-04-27 17:48:12,689 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 17:48:12,689 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 173.0%
2022-04-27 17:48:28,418 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.976, Acc: 0.959, Base Lr: 2.20e-03
2022-04-27 17:48:35,814 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.151[s] Speed: 105.8[samples/s]
2022-04-27 17:48:58,037 reid_baseline.train INFO: normal accuracy 0.739806262671773 1.6650407314300537 
2022-04-27 17:48:58,815 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 17:48:58,815 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 166.5%
2022-04-27 17:49:15,687 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.961, Acc: 0.964, Base Lr: 1.66e-03
2022-04-27 17:49:23,204 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.160[s] Speed: 100.2[samples/s]
2022-04-27 17:49:45,640 reid_baseline.train INFO: normal accuracy 0.7474656454156342 1.5990427732467651 
2022-04-27 17:49:46,431 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 17:49:46,432 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 159.9%
2022-04-27 17:50:02,857 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.942, Acc: 0.967, Base Lr: 1.19e-03
2022-04-27 17:50:10,455 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.157[s] Speed: 102.1[samples/s]
2022-04-27 17:50:32,869 reid_baseline.train INFO: normal accuracy 0.7470150934895247 1.6606791019439697 
2022-04-27 17:50:32,869 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 17:50:32,869 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 166.1%
2022-04-27 17:50:50,159 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.934, Acc: 0.969, Base Lr: 7.78e-04
2022-04-27 17:50:57,796 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.163[s] Speed: 98.3[samples/s]
2022-04-27 17:51:20,187 reid_baseline.train INFO: normal accuracy 0.750168956972291 1.668233036994934 
2022-04-27 17:51:20,187 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 17:51:20,188 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 166.8%
2022-04-27 17:51:37,399 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.927, Acc: 0.969, Base Lr: 4.51e-04
2022-04-27 17:51:44,802 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.161[s] Speed: 99.3[samples/s]
2022-04-27 17:52:07,107 reid_baseline.train INFO: normal accuracy 0.7483667492678531 1.6239014863967896 
2022-04-27 17:52:07,108 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 17:52:07,108 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 162.4%
2022-04-27 17:52:24,458 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.920, Acc: 0.975, Base Lr: 2.11e-04
2022-04-27 17:52:32,009 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.160[s] Speed: 99.7[samples/s]
2022-04-27 17:52:54,034 reid_baseline.train INFO: normal accuracy 0.7463392656003605 1.6637778282165527 
2022-04-27 17:52:54,034 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 17:52:54,034 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 166.4%
2022-04-27 17:53:10,458 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.930, Acc: 0.970, Base Lr: 6.51e-05
2022-04-27 17:53:18,317 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.159[s] Speed: 100.9[samples/s]
2022-04-27 17:53:40,435 reid_baseline.train INFO: normal accuracy 0.7485920252309078 1.641511082649231 
2022-04-27 17:53:40,436 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 17:53:40,436 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 164.2%
2022-04-27 17:53:57,229 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.927, Acc: 0.977, Base Lr: 1.60e-05
2022-04-27 17:54:04,498 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.157[s] Speed: 101.7[samples/s]
2022-04-27 17:54:26,824 reid_baseline.train INFO: normal accuracy 0.7497184050461816 1.6293119192123413 
2022-04-27 17:54:26,825 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 17:54:26,825 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 162.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_2/transformer_best_model.pth
2022-04-27 17:54:49,954 reid_baseline.train INFO: normal accuracy 0.7474656454156342 1.5990427732467651 
2022-04-27 17:54:49,954 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:54:49,955 reid_baseline.train INFO: Accuracy: 74.7%
2022-04-27 17:55:12,330 reid_baseline.train INFO: normal accuracy 0.7474656454156342 1.5990427732467651 
2022-04-27 17:55:12,331 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:55:12,331 reid_baseline.train INFO: Shuffled Accuracy: 74.7%
2022-04-27 17:55:35,248 reid_baseline.train INFO: normal accuracy 0.9765142150803461 0.8585700392723083 
2022-04-27 17:55:35,248 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:55:35,248 reid_baseline.train INFO: Source Clean Accuracy: 97.7%
2022-04-27 17:55:39,845 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_2
2022-04-27 17:55:39,845 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-27 17:55:39,845 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 17:55:39,845 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 17:55:39,845 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 17:55:51,125 reid_baseline.train INFO: start training
2022-04-27 17:56:08,803 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.151, Acc: 0.123, Base Lr: 8.72e-04
2022-04-27 17:56:18,970 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.182[s] Speed: 87.9[samples/s]
2022-04-27 17:57:53,771 reid_baseline.train INFO: normal accuracy 0.305485425751664 4.172152996063232 
2022-04-27 17:57:54,515 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 17:57:54,516 reid_baseline.train INFO: Accuracy: 30.5% Mean Entropy: 417.2%
2022-04-27 17:58:11,154 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.933, Acc: 0.447, Base Lr: 1.66e-03
2022-04-27 17:58:18,677 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.159[s] Speed: 100.7[samples/s]
2022-04-27 17:59:42,317 reid_baseline.train INFO: normal accuracy 0.4422767959605233 4.146925449371338 
2022-04-27 17:59:43,092 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 17:59:43,092 reid_baseline.train INFO: Accuracy: 44.2% Mean Entropy: 414.7%
2022-04-27 18:00:02,481 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.324, Acc: 0.520, Base Lr: 2.46e-03
2022-04-27 18:00:09,819 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.174[s] Speed: 92.2[samples/s]
2022-04-27 18:01:43,172 reid_baseline.train INFO: normal accuracy 0.49391783337158596 3.834378242492676 
2022-04-27 18:01:43,954 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 18:01:43,954 reid_baseline.train INFO: Accuracy: 49.4% Mean Entropy: 383.4%
2022-04-27 18:02:01,290 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.498, Acc: 0.600, Base Lr: 3.25e-03
2022-04-27 18:02:08,805 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.162[s] Speed: 98.8[samples/s]
2022-04-27 18:03:36,402 reid_baseline.train INFO: normal accuracy 0.5884783107642874 3.243957757949829 
2022-04-27 18:03:37,227 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 18:03:37,228 reid_baseline.train INFO: Accuracy: 58.8% Mean Entropy: 324.4%
2022-04-27 18:04:00,385 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.978, Acc: 0.717, Base Lr: 4.04e-03
2022-04-27 18:04:09,472 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.212[s] Speed: 75.5[samples/s]
2022-04-27 18:05:33,447 reid_baseline.train INFO: normal accuracy 0.6782189579986229 2.6000938415527344 
2022-04-27 18:05:34,235 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 18:05:34,235 reid_baseline.train INFO: Accuracy: 67.8% Mean Entropy: 260.0%
2022-04-27 18:05:50,655 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.637, Acc: 0.779, Base Lr: 4.83e-03
2022-04-27 18:05:58,052 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.156[s] Speed: 102.9[samples/s]
2022-04-27 18:07:27,674 reid_baseline.train INFO: normal accuracy 0.7372044985081478 2.174475908279419 
2022-04-27 18:07:28,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 18:07:28,533 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 217.4%
2022-04-27 18:07:50,483 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.413, Acc: 0.831, Base Lr: 5.62e-03
2022-04-27 18:07:58,442 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.195[s] Speed: 82.0[samples/s]
2022-04-27 18:09:24,286 reid_baseline.train INFO: normal accuracy 0.7750745926095938 1.9389013051986694 
2022-04-27 18:09:25,123 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 18:09:25,123 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 193.9%
2022-04-27 18:09:46,511 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.275, Acc: 0.865, Base Lr: 6.42e-03
2022-04-27 18:09:56,705 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.207[s] Speed: 77.3[samples/s]
2022-04-27 18:11:25,015 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.7304863929748535 
2022-04-27 18:11:25,815 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 18:11:25,816 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 173.0%
2022-04-27 18:11:42,986 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.148, Acc: 0.902, Base Lr: 7.21e-03
2022-04-27 18:11:50,627 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.163[s] Speed: 98.4[samples/s]
2022-04-27 18:13:17,947 reid_baseline.train INFO: normal accuracy 0.7934358503557494 1.5199265480041504 
2022-04-27 18:13:18,714 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 18:13:18,715 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 152.0%
2022-04-27 18:13:35,409 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.065, Acc: 0.926, Base Lr: 4.01e-03
2022-04-27 18:13:43,437 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.161[s] Speed: 99.3[samples/s]
2022-04-27 18:15:15,464 reid_baseline.train INFO: normal accuracy 0.7982556805141152 1.5415600538253784 
2022-04-27 18:15:15,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 18:15:15,465 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 154.2%
2022-04-27 18:15:32,185 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.026, Acc: 0.938, Base Lr: 3.38e-03
2022-04-27 18:15:39,505 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.158[s] Speed: 101.3[samples/s]
2022-04-27 18:17:04,036 reid_baseline.train INFO: normal accuracy 0.8028459949506541 1.4568315744400024 
2022-04-27 18:17:04,830 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 18:17:04,830 reid_baseline.train INFO: Accuracy: 80.3% Mean Entropy: 145.7%
2022-04-27 18:17:21,355 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 0.999, Acc: 0.952, Base Lr: 2.77e-03
2022-04-27 18:17:29,157 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.160[s] Speed: 100.1[samples/s]
2022-04-27 18:18:53,228 reid_baseline.train INFO: normal accuracy 0.8044526050034427 1.4821921586990356 
2022-04-27 18:18:53,229 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 18:18:53,229 reid_baseline.train INFO: Accuracy: 80.4% Mean Entropy: 148.2%
2022-04-27 18:19:09,346 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.976, Acc: 0.959, Base Lr: 2.20e-03
2022-04-27 18:19:17,067 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.156[s] Speed: 102.4[samples/s]
2022-04-27 18:20:42,269 reid_baseline.train INFO: normal accuracy 0.8088134037181547 1.4318981170654297 
2022-04-27 18:20:43,071 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 18:20:43,071 reid_baseline.train INFO: Accuracy: 80.9% Mean Entropy: 143.2%
2022-04-27 18:20:59,525 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.961, Acc: 0.964, Base Lr: 1.66e-03
2022-04-27 18:21:06,930 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.156[s] Speed: 102.4[samples/s]
2022-04-27 18:22:30,651 reid_baseline.train INFO: normal accuracy 0.815698875372963 1.3693881034851074 
2022-04-27 18:22:31,479 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 18:22:31,479 reid_baseline.train INFO: Accuracy: 81.6% Mean Entropy: 136.9%
2022-04-27 18:22:48,387 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.942, Acc: 0.967, Base Lr: 1.19e-03
2022-04-27 18:22:55,647 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.159[s] Speed: 100.8[samples/s]
2022-04-27 18:24:19,228 reid_baseline.train INFO: normal accuracy 0.8143217810420014 1.4339946508407593 
2022-04-27 18:24:19,228 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 18:24:19,228 reid_baseline.train INFO: Accuracy: 81.4% Mean Entropy: 143.4%
2022-04-27 18:24:35,912 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.934, Acc: 0.969, Base Lr: 7.78e-04
2022-04-27 18:24:43,753 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.160[s] Speed: 100.1[samples/s]
2022-04-27 18:26:09,545 reid_baseline.train INFO: normal accuracy 0.8150103282074822 1.4464105367660522 
2022-04-27 18:26:09,545 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 18:26:09,546 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 144.6%
2022-04-27 18:26:26,577 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.927, Acc: 0.969, Base Lr: 4.51e-04
2022-04-27 18:26:34,133 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.160[s] Speed: 99.9[samples/s]
2022-04-27 18:27:55,987 reid_baseline.train INFO: normal accuracy 0.8150103282074822 1.4035601615905762 
2022-04-27 18:27:55,987 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 18:27:55,988 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 140.4%
2022-04-27 18:28:12,923 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.920, Acc: 0.975, Base Lr: 2.11e-04
2022-04-27 18:28:20,569 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.161[s] Speed: 99.4[samples/s]
2022-04-27 18:29:49,152 reid_baseline.train INFO: normal accuracy 0.8136332338765205 1.4462077617645264 
2022-04-27 18:29:49,152 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 18:29:49,152 reid_baseline.train INFO: Accuracy: 81.4% Mean Entropy: 144.6%
2022-04-27 18:30:05,217 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.930, Acc: 0.970, Base Lr: 6.51e-05
2022-04-27 18:30:12,906 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.156[s] Speed: 102.5[samples/s]
2022-04-27 18:31:39,493 reid_baseline.train INFO: normal accuracy 0.81592839109479 1.4219776391983032 
2022-04-27 18:31:39,493 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 18:31:39,493 reid_baseline.train INFO: Accuracy: 81.6% Mean Entropy: 142.2%
2022-04-27 18:31:55,835 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.927, Acc: 0.977, Base Lr: 1.60e-05
2022-04-27 18:32:03,364 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.157[s] Speed: 102.1[samples/s]
2022-04-27 18:33:30,244 reid_baseline.train INFO: normal accuracy 0.8161579068166169 1.4082881212234497 
2022-04-27 18:33:30,244 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 18:33:30,245 reid_baseline.train INFO: Accuracy: 81.6% Mean Entropy: 140.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_2/transformer_best_model.pth
2022-04-27 18:34:56,837 reid_baseline.train INFO: normal accuracy 0.815698875372963 1.3693881034851074 
2022-04-27 18:34:56,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:34:56,838 reid_baseline.train INFO: Accuracy: 81.6%
2022-04-27 18:36:23,009 reid_baseline.train INFO: normal accuracy 0.815698875372963 1.3693881034851074 
2022-04-27 18:36:23,009 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:36:23,009 reid_baseline.train INFO: Shuffled Accuracy: 81.6%
2022-04-27 18:36:46,190 reid_baseline.train INFO: normal accuracy 0.9765142150803461 0.8585700392723083 
2022-04-27 18:36:46,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:36:46,191 reid_baseline.train INFO: Source Clean Accuracy: 97.7%
2022-04-27 18:36:51,203 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_11
2022-04-27 18:36:51,203 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=11)
2022-04-27 18:36:51,203 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 18:36:51,203 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 18:36:51,204 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 18:37:02,561 reid_baseline.train INFO: start training
2022-04-27 18:37:20,329 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.152, Acc: 0.101, Base Lr: 8.72e-04
2022-04-27 18:37:28,499 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.170[s] Speed: 94.1[samples/s]
2022-04-27 18:37:50,428 reid_baseline.train INFO: normal accuracy 0.1365406643757159 4.17240571975708 
2022-04-27 18:37:51,169 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 18:37:51,169 reid_baseline.train INFO: Accuracy: 13.7% Mean Entropy: 417.2%
2022-04-27 18:38:07,126 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.989, Acc: 0.362, Base Lr: 1.66e-03
2022-04-27 18:38:14,350 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.152[s] Speed: 104.9[samples/s]
2022-04-27 18:38:36,157 reid_baseline.train INFO: normal accuracy 0.27101947308132873 4.16267728805542 
2022-04-27 18:38:36,971 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 18:38:36,971 reid_baseline.train INFO: Accuracy: 27.1% Mean Entropy: 416.3%
2022-04-27 18:38:54,528 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.450, Acc: 0.491, Base Lr: 2.46e-03
2022-04-27 18:39:02,365 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.167[s] Speed: 96.0[samples/s]
2022-04-27 18:39:24,298 reid_baseline.train INFO: normal accuracy 0.31844215349369986 4.057589054107666 
2022-04-27 18:39:25,098 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 18:39:25,098 reid_baseline.train INFO: Accuracy: 31.8% Mean Entropy: 405.8%
2022-04-27 18:39:42,127 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.604, Acc: 0.576, Base Lr: 3.25e-03
2022-04-27 18:39:49,260 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.158[s] Speed: 101.4[samples/s]
2022-04-27 18:40:10,814 reid_baseline.train INFO: normal accuracy 0.3848797250859107 3.693756580352783 
2022-04-27 18:40:11,596 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 18:40:11,597 reid_baseline.train INFO: Accuracy: 38.5% Mean Entropy: 369.4%
2022-04-27 18:40:27,803 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.067, Acc: 0.682, Base Lr: 4.04e-03
2022-04-27 18:40:35,302 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.155[s] Speed: 103.3[samples/s]
2022-04-27 18:40:57,231 reid_baseline.train INFO: normal accuracy 0.44696449026345936 3.261314868927002 
2022-04-27 18:40:58,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 18:40:58,021 reid_baseline.train INFO: Accuracy: 44.7% Mean Entropy: 326.1%
2022-04-27 18:41:15,419 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.713, Acc: 0.748, Base Lr: 4.83e-03
2022-04-27 18:41:23,298 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.165[s] Speed: 96.8[samples/s]
2022-04-27 18:41:45,270 reid_baseline.train INFO: normal accuracy 0.4946162657502864 2.9207918643951416 
2022-04-27 18:41:46,052 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 18:41:46,053 reid_baseline.train INFO: Accuracy: 49.5% Mean Entropy: 292.1%
2022-04-27 18:42:01,800 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.489, Acc: 0.816, Base Lr: 5.62e-03
2022-04-27 18:42:09,177 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.152[s] Speed: 105.3[samples/s]
2022-04-27 18:42:30,966 reid_baseline.train INFO: normal accuracy 0.5372279495990836 2.710355758666992 
2022-04-27 18:42:31,738 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 18:42:31,739 reid_baseline.train INFO: Accuracy: 53.7% Mean Entropy: 271.0%
2022-04-27 18:42:48,116 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.316, Acc: 0.856, Base Lr: 6.42e-03
2022-04-27 18:42:55,790 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.156[s] Speed: 102.3[samples/s]
2022-04-27 18:43:18,155 reid_baseline.train INFO: normal accuracy 0.5544100801832761 2.474699020385742 
2022-04-27 18:43:18,953 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 18:43:18,953 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 247.5%
2022-04-27 18:43:36,182 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.185, Acc: 0.901, Base Lr: 7.21e-03
2022-04-27 18:43:43,689 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.162[s] Speed: 98.8[samples/s]
2022-04-27 18:44:05,460 reid_baseline.train INFO: normal accuracy 0.5498281786941581 2.224224090576172 
2022-04-27 18:44:06,526 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 18:44:06,526 reid_baseline.train INFO: Accuracy: 55.0% Mean Entropy: 222.4%
2022-04-27 18:44:23,427 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.097, Acc: 0.926, Base Lr: 4.01e-03
2022-04-27 18:44:30,870 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.158[s] Speed: 101.4[samples/s]
2022-04-27 18:44:52,877 reid_baseline.train INFO: normal accuracy 0.5663230240549828 2.1921679973602295 
2022-04-27 18:44:53,647 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 18:44:53,648 reid_baseline.train INFO: Accuracy: 56.6% Mean Entropy: 219.2%
2022-04-27 18:45:10,266 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.052, Acc: 0.934, Base Lr: 3.38e-03
2022-04-27 18:45:17,821 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.158[s] Speed: 101.4[samples/s]
2022-04-27 18:45:39,870 reid_baseline.train INFO: normal accuracy 0.5676975945017182 2.1124391555786133 
2022-04-27 18:45:40,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 18:45:40,667 reid_baseline.train INFO: Accuracy: 56.8% Mean Entropy: 211.2%
2022-04-27 18:45:57,756 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.017, Acc: 0.952, Base Lr: 2.77e-03
2022-04-27 18:46:05,046 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.160[s] Speed: 100.3[samples/s]
2022-04-27 18:46:26,462 reid_baseline.train INFO: normal accuracy 0.572737686139748 2.1146132946014404 
2022-04-27 18:46:26,463 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 18:46:26,463 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 211.5%
2022-04-27 18:46:43,193 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.998, Acc: 0.961, Base Lr: 2.20e-03
2022-04-27 18:46:50,757 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.159[s] Speed: 100.4[samples/s]
2022-04-27 18:47:12,531 reid_baseline.train INFO: normal accuracy 0.5738831615120275 2.064746856689453 
2022-04-27 18:47:13,358 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 18:47:13,358 reid_baseline.train INFO: Accuracy: 57.4% Mean Entropy: 206.5%
2022-04-27 18:47:30,637 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.985, Acc: 0.964, Base Lr: 1.66e-03
2022-04-27 18:47:38,348 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.163[s] Speed: 98.0[samples/s]
2022-04-27 18:48:00,310 reid_baseline.train INFO: normal accuracy 0.5718213058419244 2.005478620529175 
2022-04-27 18:48:01,109 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 18:48:01,109 reid_baseline.train INFO: Accuracy: 57.2% Mean Entropy: 200.5%
2022-04-27 18:48:17,287 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.965, Acc: 0.967, Base Lr: 1.19e-03
2022-04-27 18:48:24,640 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.154[s] Speed: 103.9[samples/s]
2022-04-27 18:48:46,516 reid_baseline.train INFO: normal accuracy 0.5764032073310423 2.0223443508148193 
2022-04-27 18:48:46,516 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 18:48:46,516 reid_baseline.train INFO: Accuracy: 57.6% Mean Entropy: 202.2%
2022-04-27 18:49:02,936 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.957, Acc: 0.972, Base Lr: 7.78e-04
2022-04-27 18:49:10,322 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.156[s] Speed: 102.4[samples/s]
2022-04-27 18:49:32,341 reid_baseline.train INFO: normal accuracy 0.5757159221076746 2.0511085987091064 
2022-04-27 18:49:32,341 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 18:49:32,341 reid_baseline.train INFO: Accuracy: 57.6% Mean Entropy: 205.1%
2022-04-27 18:49:49,319 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.955, Acc: 0.971, Base Lr: 4.51e-04
2022-04-27 18:49:56,907 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.160[s] Speed: 99.9[samples/s]
2022-04-27 18:50:18,845 reid_baseline.train INFO: normal accuracy 0.57709049255441 2.041180372238159 
2022-04-27 18:50:18,846 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 18:50:18,846 reid_baseline.train INFO: Accuracy: 57.7% Mean Entropy: 204.1%
2022-04-27 18:50:35,361 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.949, Acc: 0.972, Base Lr: 2.11e-04
2022-04-27 18:50:42,837 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.157[s] Speed: 101.9[samples/s]
2022-04-27 18:51:04,777 reid_baseline.train INFO: normal accuracy 0.5754868270332187 2.0385396480560303 
2022-04-27 18:51:04,777 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 18:51:04,777 reid_baseline.train INFO: Accuracy: 57.5% Mean Entropy: 203.9%
2022-04-27 18:51:21,251 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.954, Acc: 0.967, Base Lr: 6.51e-05
2022-04-27 18:51:28,890 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.158[s] Speed: 101.4[samples/s]
2022-04-27 18:51:51,109 reid_baseline.train INFO: normal accuracy 0.5775486827033218 2.04292893409729 
2022-04-27 18:51:51,110 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 18:51:51,110 reid_baseline.train INFO: Accuracy: 57.8% Mean Entropy: 204.3%
2022-04-27 18:52:07,870 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.950, Acc: 0.975, Base Lr: 1.60e-05
2022-04-27 18:52:15,500 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.159[s] Speed: 100.9[samples/s]
2022-04-27 18:52:37,199 reid_baseline.train INFO: normal accuracy 0.5759450171821305 2.032050609588623 
2022-04-27 18:52:37,200 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 18:52:37,200 reid_baseline.train INFO: Accuracy: 57.6% Mean Entropy: 203.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_11/transformer_best_model.pth
2022-04-27 18:53:00,121 reid_baseline.train INFO: normal accuracy 0.5718213058419244 2.005478620529175 
2022-04-27 18:53:00,121 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:53:00,121 reid_baseline.train INFO: Accuracy: 57.2%
2022-04-27 18:53:21,894 reid_baseline.train INFO: normal accuracy 0.5718213058419244 2.005478620529175 
2022-04-27 18:53:21,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:53:21,895 reid_baseline.train INFO: Shuffled Accuracy: 57.2%
2022-04-27 18:53:45,037 reid_baseline.train INFO: normal accuracy 0.9728059332509271 0.9798203110694885 
2022-04-27 18:53:45,037 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:53:45,038 reid_baseline.train INFO: Source Clean Accuracy: 97.3%
2022-04-27 18:53:49,584 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_11
2022-04-27 18:53:49,585 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=11)
2022-04-27 18:53:49,585 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 18:53:49,585 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 18:53:49,585 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 18:54:00,304 reid_baseline.train INFO: start training
2022-04-27 18:54:17,859 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.152, Acc: 0.101, Base Lr: 8.72e-04
2022-04-27 18:54:25,466 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.162[s] Speed: 98.5[samples/s]
2022-04-27 18:54:47,519 reid_baseline.train INFO: normal accuracy 0.15183599909889614 4.1723103523254395 
2022-04-27 18:54:48,310 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 18:54:48,311 reid_baseline.train INFO: Accuracy: 15.2% Mean Entropy: 417.2%
2022-04-27 18:55:05,223 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.989, Acc: 0.362, Base Lr: 1.66e-03
2022-04-27 18:55:12,670 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.160[s] Speed: 99.9[samples/s]
2022-04-27 18:55:34,665 reid_baseline.train INFO: normal accuracy 0.31516107231358415 4.16238260269165 
2022-04-27 18:55:35,476 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 18:55:35,476 reid_baseline.train INFO: Accuracy: 31.5% Mean Entropy: 416.2%
2022-04-27 18:55:52,169 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.450, Acc: 0.491, Base Lr: 2.46e-03
2022-04-27 18:55:59,775 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.159[s] Speed: 100.6[samples/s]
2022-04-27 18:56:22,035 reid_baseline.train INFO: normal accuracy 0.39333183149357964 4.035139083862305 
2022-04-27 18:56:22,820 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 18:56:22,820 reid_baseline.train INFO: Accuracy: 39.3% Mean Entropy: 403.5%
2022-04-27 18:56:38,671 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.604, Acc: 0.576, Base Lr: 3.25e-03
2022-04-27 18:56:46,124 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.152[s] Speed: 105.1[samples/s]
2022-04-27 18:57:08,425 reid_baseline.train INFO: normal accuracy 0.45505744537057896 3.6299829483032227 
2022-04-27 18:57:09,244 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 18:57:09,244 reid_baseline.train INFO: Accuracy: 45.5% Mean Entropy: 363.0%
2022-04-27 18:57:25,560 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.067, Acc: 0.682, Base Lr: 4.04e-03
2022-04-27 18:57:33,039 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.156[s] Speed: 102.3[samples/s]
2022-04-27 18:57:56,164 reid_baseline.train INFO: normal accuracy 0.5465194863708043 3.1051852703094482 
2022-04-27 18:57:56,969 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 18:57:56,969 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 310.5%
2022-04-27 18:58:13,560 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.713, Acc: 0.748, Base Lr: 4.83e-03
2022-04-27 18:58:21,199 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.159[s] Speed: 100.6[samples/s]
2022-04-27 18:58:43,392 reid_baseline.train INFO: normal accuracy 0.6309979725163325 2.724378824234009 
2022-04-27 18:58:44,205 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 18:58:44,205 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 272.4%
2022-04-27 18:59:00,083 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.489, Acc: 0.816, Base Lr: 5.62e-03
2022-04-27 18:59:07,749 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.155[s] Speed: 103.4[samples/s]
2022-04-27 18:59:29,916 reid_baseline.train INFO: normal accuracy 0.6852894796125254 2.493323564529419 
2022-04-27 18:59:30,763 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 18:59:30,763 reid_baseline.train INFO: Accuracy: 68.5% Mean Entropy: 249.3%
2022-04-27 18:59:47,804 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.316, Acc: 0.856, Base Lr: 6.42e-03
2022-04-27 18:59:55,462 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.161[s] Speed: 99.3[samples/s]
2022-04-27 19:00:17,976 reid_baseline.train INFO: normal accuracy 0.7202072538860104 2.2845592498779297 
2022-04-27 19:00:18,791 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 19:00:18,791 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 228.5%
2022-04-27 19:00:35,526 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.185, Acc: 0.901, Base Lr: 7.21e-03
2022-04-27 19:00:42,613 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.156[s] Speed: 102.8[samples/s]
2022-04-27 19:01:04,562 reid_baseline.train INFO: normal accuracy 0.7224600135165578 2.0135674476623535 
2022-04-27 19:01:05,367 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 19:01:05,367 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 201.4%
2022-04-27 19:01:21,106 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.097, Acc: 0.926, Base Lr: 4.01e-03
2022-04-27 19:01:28,378 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.151[s] Speed: 106.0[samples/s]
2022-04-27 19:01:50,864 reid_baseline.train INFO: normal accuracy 0.7287677404820906 1.9577968120574951 
2022-04-27 19:01:51,686 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 19:01:51,687 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 195.8%
2022-04-27 19:02:08,418 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.052, Acc: 0.934, Base Lr: 3.38e-03
2022-04-27 19:02:16,079 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.160[s] Speed: 99.9[samples/s]
2022-04-27 19:02:38,476 reid_baseline.train INFO: normal accuracy 0.7303446722234738 1.894800066947937 
2022-04-27 19:02:39,284 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 19:02:39,284 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 189.5%
2022-04-27 19:02:55,790 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.017, Acc: 0.952, Base Lr: 2.77e-03
2022-04-27 19:03:03,319 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.156[s] Speed: 102.4[samples/s]
2022-04-27 19:03:25,634 reid_baseline.train INFO: normal accuracy 0.7373282270781708 1.9259933233261108 
2022-04-27 19:03:25,635 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 19:03:25,635 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 192.6%
2022-04-27 19:03:42,312 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.998, Acc: 0.961, Base Lr: 2.20e-03
2022-04-27 19:03:49,829 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.159[s] Speed: 100.8[samples/s]
2022-04-27 19:04:12,644 reid_baseline.train INFO: normal accuracy 0.7366523991890065 1.8593190908432007 
2022-04-27 19:04:13,503 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 19:04:13,503 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 185.9%
2022-04-27 19:04:30,217 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.985, Acc: 0.964, Base Lr: 1.66e-03
2022-04-27 19:04:37,905 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.160[s] Speed: 100.3[samples/s]
2022-04-27 19:05:00,127 reid_baseline.train INFO: normal accuracy 0.7422842982653751 1.793573021888733 
2022-04-27 19:05:00,945 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 19:05:00,946 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 179.4%
2022-04-27 19:05:17,325 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.965, Acc: 0.967, Base Lr: 1.19e-03
2022-04-27 19:05:24,529 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.155[s] Speed: 103.2[samples/s]
2022-04-27 19:05:46,811 reid_baseline.train INFO: normal accuracy 0.7420590223023203 1.8207777738571167 
2022-04-27 19:05:46,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 19:05:46,812 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 182.1%
2022-04-27 19:06:03,889 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.957, Acc: 0.972, Base Lr: 7.78e-04
2022-04-27 19:06:11,594 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.162[s] Speed: 98.6[samples/s]
2022-04-27 19:06:34,564 reid_baseline.train INFO: normal accuracy 0.7443117819328677 1.8484288454055786 
2022-04-27 19:06:34,565 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 19:06:34,565 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 184.8%
2022-04-27 19:06:51,081 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.955, Acc: 0.971, Base Lr: 4.51e-04
2022-04-27 19:06:58,195 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.153[s] Speed: 104.4[samples/s]
2022-04-27 19:07:20,456 reid_baseline.train INFO: normal accuracy 0.7447623338589773 1.8354228734970093 
2022-04-27 19:07:20,456 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 19:07:20,456 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 183.5%
2022-04-27 19:07:36,556 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.949, Acc: 0.972, Base Lr: 2.11e-04
2022-04-27 19:07:44,121 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.155[s] Speed: 103.3[samples/s]
2022-04-27 19:08:06,356 reid_baseline.train INFO: normal accuracy 0.7476909213786889 1.8387701511383057 
2022-04-27 19:08:06,356 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 19:08:06,357 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 183.9%
2022-04-27 19:08:23,328 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.954, Acc: 0.967, Base Lr: 6.51e-05
2022-04-27 19:08:31,014 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.161[s] Speed: 99.3[samples/s]
2022-04-27 19:08:53,651 reid_baseline.train INFO: normal accuracy 0.7461139896373057 1.835174322128296 
2022-04-27 19:08:53,652 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 19:08:53,652 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 183.5%
2022-04-27 19:09:09,174 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.950, Acc: 0.975, Base Lr: 1.60e-05
2022-04-27 19:09:16,767 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.151[s] Speed: 106.0[samples/s]
2022-04-27 19:09:39,556 reid_baseline.train INFO: normal accuracy 0.7463392656003605 1.8266621828079224 
2022-04-27 19:09:39,557 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 19:09:39,557 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 182.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_11/transformer_best_model.pth
2022-04-27 19:10:03,753 reid_baseline.train INFO: normal accuracy 0.7422842982653751 1.793573021888733 
2022-04-27 19:10:03,753 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:10:03,754 reid_baseline.train INFO: Accuracy: 74.2%
2022-04-27 19:10:26,323 reid_baseline.train INFO: normal accuracy 0.7422842982653751 1.793573021888733 
2022-04-27 19:10:26,324 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:10:26,324 reid_baseline.train INFO: Shuffled Accuracy: 74.2%
2022-04-27 19:10:48,460 reid_baseline.train INFO: normal accuracy 0.9728059332509271 0.9798203110694885 
2022-04-27 19:10:48,461 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:10:48,461 reid_baseline.train INFO: Source Clean Accuracy: 97.3%
2022-04-27 19:10:53,712 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_11
2022-04-27 19:10:53,712 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=11)
2022-04-27 19:10:53,712 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 19:10:53,712 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 19:10:53,713 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 19:11:05,451 reid_baseline.train INFO: start training
2022-04-27 19:11:23,948 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.152, Acc: 0.101, Base Lr: 8.72e-04
2022-04-27 19:11:32,191 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.173[s] Speed: 92.7[samples/s]
2022-04-27 19:12:59,186 reid_baseline.train INFO: normal accuracy 0.23754877209088823 4.172307968139648 
2022-04-27 19:12:59,939 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 19:12:59,939 reid_baseline.train INFO: Accuracy: 23.8% Mean Entropy: 417.2%
2022-04-27 19:13:16,414 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.989, Acc: 0.362, Base Lr: 1.66e-03
2022-04-27 19:13:23,825 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.157[s] Speed: 101.8[samples/s]
2022-04-27 19:14:48,006 reid_baseline.train INFO: normal accuracy 0.42735827404177185 4.159960746765137 
2022-04-27 19:14:48,780 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 19:14:48,781 reid_baseline.train INFO: Accuracy: 42.7% Mean Entropy: 416.0%
2022-04-27 19:15:05,690 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.450, Acc: 0.491, Base Lr: 2.46e-03
2022-04-27 19:15:13,256 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.160[s] Speed: 100.1[samples/s]
2022-04-27 19:16:37,923 reid_baseline.train INFO: normal accuracy 0.48565526738581594 3.965355157852173 
2022-04-27 19:16:38,716 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 19:16:38,716 reid_baseline.train INFO: Accuracy: 48.6% Mean Entropy: 396.5%
2022-04-27 19:16:55,651 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.604, Acc: 0.576, Base Lr: 3.25e-03
2022-04-27 19:17:03,022 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.159[s] Speed: 100.7[samples/s]
2022-04-27 19:18:29,297 reid_baseline.train INFO: normal accuracy 0.5685104429653431 3.4354498386383057 
2022-04-27 19:18:30,107 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 19:18:30,108 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 343.5%
2022-04-27 19:18:47,273 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.067, Acc: 0.682, Base Lr: 4.04e-03
2022-04-27 19:18:54,548 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.161[s] Speed: 99.6[samples/s]
2022-04-27 19:20:19,013 reid_baseline.train INFO: normal accuracy 0.665136561854487 2.8321163654327393 
2022-04-27 19:20:19,816 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 19:20:19,816 reid_baseline.train INFO: Accuracy: 66.5% Mean Entropy: 283.2%
2022-04-27 19:20:36,269 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.713, Acc: 0.748, Base Lr: 4.83e-03
2022-04-27 19:20:43,845 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.157[s] Speed: 101.6[samples/s]
2022-04-27 19:22:11,032 reid_baseline.train INFO: normal accuracy 0.724122102364012 2.4524214267730713 
2022-04-27 19:22:11,839 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 19:22:11,839 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 245.2%
2022-04-27 19:22:28,500 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.489, Acc: 0.816, Base Lr: 5.62e-03
2022-04-27 19:22:35,773 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.157[s] Speed: 101.9[samples/s]
2022-04-27 19:24:01,414 reid_baseline.train INFO: normal accuracy 0.7626807436309387 2.225633382797241 
2022-04-27 19:24:02,178 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 19:24:02,178 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 222.6%
2022-04-27 19:24:19,013 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.316, Acc: 0.856, Base Lr: 6.42e-03
2022-04-27 19:24:26,292 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.156[s] Speed: 102.3[samples/s]
2022-04-27 19:25:50,289 reid_baseline.train INFO: normal accuracy 0.790681661693826 2.0333354473114014 
2022-04-27 19:25:51,098 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 19:25:51,098 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 203.3%
2022-04-27 19:26:08,470 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.185, Acc: 0.901, Base Lr: 7.21e-03
2022-04-27 19:26:15,736 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.160[s] Speed: 99.8[samples/s]
2022-04-27 19:27:43,453 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.7760379314422607 
2022-04-27 19:27:44,230 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 19:27:44,231 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 177.6%
2022-04-27 19:28:00,630 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.097, Acc: 0.926, Base Lr: 4.01e-03
2022-04-27 19:28:08,425 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.158[s] Speed: 101.1[samples/s]
2022-04-27 19:29:30,935 reid_baseline.train INFO: normal accuracy 0.7994032591232499 1.7310354709625244 
2022-04-27 19:29:31,740 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 19:29:31,740 reid_baseline.train INFO: Accuracy: 79.9% Mean Entropy: 173.1%
2022-04-27 19:29:48,763 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.052, Acc: 0.934, Base Lr: 3.38e-03
2022-04-27 19:29:55,950 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.159[s] Speed: 100.7[samples/s]
2022-04-27 19:31:19,198 reid_baseline.train INFO: normal accuracy 0.8053706678907505 1.6632053852081299 
2022-04-27 19:31:19,981 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 19:31:19,981 reid_baseline.train INFO: Accuracy: 80.5% Mean Entropy: 166.3%
2022-04-27 19:31:37,007 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.017, Acc: 0.952, Base Lr: 2.77e-03
2022-04-27 19:31:44,513 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.160[s] Speed: 100.0[samples/s]
2022-04-27 19:33:08,219 reid_baseline.train INFO: normal accuracy 0.8097314666054625 1.7019505500793457 
2022-04-27 19:33:08,220 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 19:33:08,220 reid_baseline.train INFO: Accuracy: 81.0% Mean Entropy: 170.2%
2022-04-27 19:33:24,871 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.998, Acc: 0.961, Base Lr: 2.20e-03
2022-04-27 19:33:32,247 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.157[s] Speed: 102.2[samples/s]
2022-04-27 19:34:56,863 reid_baseline.train INFO: normal accuracy 0.8106495294927702 1.6405080556869507 
2022-04-27 19:34:57,686 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 19:34:57,686 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 164.1%
2022-04-27 19:35:13,642 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.985, Acc: 0.964, Base Lr: 1.66e-03
2022-04-27 19:35:21,097 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.153[s] Speed: 104.3[samples/s]
2022-04-27 19:36:46,472 reid_baseline.train INFO: normal accuracy 0.8131742024328666 1.5765718221664429 
2022-04-27 19:36:47,297 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 19:36:47,297 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 157.7%
2022-04-27 19:37:03,595 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.965, Acc: 0.967, Base Lr: 1.19e-03
2022-04-27 19:37:11,035 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.156[s] Speed: 102.6[samples/s]
2022-04-27 19:38:35,218 reid_baseline.train INFO: normal accuracy 0.8113380766582511 1.612644076347351 
2022-04-27 19:38:35,218 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 19:38:35,219 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 161.3%
2022-04-27 19:38:52,063 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.957, Acc: 0.972, Base Lr: 7.78e-04
2022-04-27 19:38:59,875 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.162[s] Speed: 98.9[samples/s]
2022-04-27 19:40:26,190 reid_baseline.train INFO: normal accuracy 0.8127151709892128 1.6427531242370605 
2022-04-27 19:40:26,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 19:40:26,191 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 164.3%
2022-04-27 19:40:42,233 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.955, Acc: 0.971, Base Lr: 4.51e-04
2022-04-27 19:40:49,898 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.156[s] Speed: 102.7[samples/s]
2022-04-27 19:42:12,604 reid_baseline.train INFO: normal accuracy 0.8129446867110397 1.6280536651611328 
2022-04-27 19:42:12,605 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 19:42:12,605 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 162.8%
2022-04-27 19:42:29,515 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.949, Acc: 0.972, Base Lr: 2.11e-04
2022-04-27 19:42:37,289 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.161[s] Speed: 99.3[samples/s]
2022-04-27 19:44:04,010 reid_baseline.train INFO: normal accuracy 0.8129446867110397 1.631250262260437 
2022-04-27 19:44:04,011 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 19:44:04,011 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 163.1%
2022-04-27 19:44:20,617 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.954, Acc: 0.967, Base Lr: 6.51e-05
2022-04-27 19:44:28,170 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.157[s] Speed: 101.9[samples/s]
2022-04-27 19:45:53,345 reid_baseline.train INFO: normal accuracy 0.8145512967638283 1.6282650232315063 
2022-04-27 19:45:53,346 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 19:45:53,346 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 162.8%
2022-04-27 19:46:10,853 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.950, Acc: 0.975, Base Lr: 1.60e-05
2022-04-27 19:46:18,322 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.162[s] Speed: 98.8[samples/s]
2022-04-27 19:47:44,436 reid_baseline.train INFO: normal accuracy 0.8136332338765205 1.6150509119033813 
2022-04-27 19:47:44,437 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 19:47:44,437 reid_baseline.train INFO: Accuracy: 81.4% Mean Entropy: 161.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_11/transformer_best_model.pth
2022-04-27 19:49:12,203 reid_baseline.train INFO: normal accuracy 0.8131742024328666 1.5765718221664429 
2022-04-27 19:49:12,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:49:12,203 reid_baseline.train INFO: Accuracy: 81.3%
2022-04-27 19:50:37,949 reid_baseline.train INFO: normal accuracy 0.8131742024328666 1.5765718221664429 
2022-04-27 19:50:37,950 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:50:37,950 reid_baseline.train INFO: Shuffled Accuracy: 81.3%
2022-04-27 19:51:00,703 reid_baseline.train INFO: normal accuracy 0.9728059332509271 0.9798203110694885 
2022-04-27 19:51:00,703 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:51:00,704 reid_baseline.train INFO: Source Clean Accuracy: 97.3%
2022-04-27 19:51:05,731 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_12
2022-04-27 19:51:05,731 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-27 19:51:05,731 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 19:51:05,731 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 19:51:05,732 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 19:51:18,756 reid_baseline.train INFO: start training
2022-04-27 19:51:36,727 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.146, Acc: 0.132, Base Lr: 8.72e-04
2022-04-27 19:51:44,434 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.165[s] Speed: 96.7[samples/s]
2022-04-27 19:52:06,522 reid_baseline.train INFO: normal accuracy 0.15578465063001146 4.1720476150512695 
2022-04-27 19:52:07,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 19:52:07,335 reid_baseline.train INFO: Accuracy: 15.6% Mean Entropy: 417.2%
2022-04-27 19:52:24,101 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.914, Acc: 0.397, Base Lr: 1.66e-03
2022-04-27 19:52:31,529 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.159[s] Speed: 100.9[samples/s]
2022-04-27 19:52:53,196 reid_baseline.train INFO: normal accuracy 0.26666666666666666 4.154376983642578 
2022-04-27 19:52:54,022 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 19:52:54,022 reid_baseline.train INFO: Accuracy: 26.7% Mean Entropy: 415.4%
2022-04-27 19:53:10,285 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.294, Acc: 0.457, Base Lr: 2.46e-03
2022-04-27 19:53:17,928 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.156[s] Speed: 102.5[samples/s]
2022-04-27 19:53:39,849 reid_baseline.train INFO: normal accuracy 0.3131729667812142 4.0274457931518555 
2022-04-27 19:53:40,733 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 19:53:40,733 reid_baseline.train INFO: Accuracy: 31.3% Mean Entropy: 402.7%
2022-04-27 19:53:57,280 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.519, Acc: 0.574, Base Lr: 3.25e-03
2022-04-27 19:54:04,465 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.155[s] Speed: 102.9[samples/s]
2022-04-27 19:54:26,295 reid_baseline.train INFO: normal accuracy 0.3938144329896907 3.775766134262085 
2022-04-27 19:54:27,057 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 19:54:27,057 reid_baseline.train INFO: Accuracy: 39.4% Mean Entropy: 377.6%
2022-04-27 19:54:43,839 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.036, Acc: 0.685, Base Lr: 4.04e-03
2022-04-27 19:54:51,241 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.157[s] Speed: 101.8[samples/s]
2022-04-27 19:55:13,154 reid_baseline.train INFO: normal accuracy 0.4529209621993127 3.557460069656372 
2022-04-27 19:55:13,945 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 19:55:13,946 reid_baseline.train INFO: Accuracy: 45.3% Mean Entropy: 355.7%
2022-04-27 19:55:30,697 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.704, Acc: 0.757, Base Lr: 4.83e-03
2022-04-27 19:55:38,191 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.159[s] Speed: 100.6[samples/s]
2022-04-27 19:56:00,246 reid_baseline.train INFO: normal accuracy 0.493241695303551 3.395850896835327 
2022-04-27 19:56:01,106 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 19:56:01,106 reid_baseline.train INFO: Accuracy: 49.3% Mean Entropy: 339.6%
2022-04-27 19:56:17,792 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.482, Acc: 0.826, Base Lr: 5.62e-03
2022-04-27 19:56:25,404 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.158[s] Speed: 101.0[samples/s]
2022-04-27 19:56:47,927 reid_baseline.train INFO: normal accuracy 0.5379152348224513 3.308535575866699 
2022-04-27 19:56:48,701 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 19:56:48,701 reid_baseline.train INFO: Accuracy: 53.8% Mean Entropy: 330.9%
2022-04-27 19:57:04,608 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.306, Acc: 0.866, Base Lr: 6.42e-03
2022-04-27 19:57:12,116 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.153[s] Speed: 104.4[samples/s]
2022-04-27 19:57:33,911 reid_baseline.train INFO: normal accuracy 0.5470790378006873 3.188776969909668 
2022-04-27 19:57:34,712 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 19:57:34,712 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 318.9%
2022-04-27 19:57:51,209 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.185, Acc: 0.902, Base Lr: 7.21e-03
2022-04-27 19:57:58,734 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.158[s] Speed: 101.6[samples/s]
2022-04-27 19:58:20,738 reid_baseline.train INFO: normal accuracy 0.5457044673539518 3.0597643852233887 
2022-04-27 19:58:21,538 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 19:58:21,538 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 306.0%
2022-04-27 19:58:38,691 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.083, Acc: 0.928, Base Lr: 4.01e-03
2022-04-27 19:58:46,238 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.162[s] Speed: 98.9[samples/s]
2022-04-27 19:59:07,948 reid_baseline.train INFO: normal accuracy 0.5594501718213059 3.0475919246673584 
2022-04-27 19:59:08,732 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 19:59:08,732 reid_baseline.train INFO: Accuracy: 55.9% Mean Entropy: 304.8%
2022-04-27 19:59:24,469 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.055, Acc: 0.941, Base Lr: 3.38e-03
2022-04-27 19:59:31,891 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.152[s] Speed: 105.1[samples/s]
2022-04-27 19:59:53,856 reid_baseline.train INFO: normal accuracy 0.5576174112256587 2.9695076942443848 
2022-04-27 19:59:54,688 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 19:59:54,688 reid_baseline.train INFO: Accuracy: 55.8% Mean Entropy: 297.0%
2022-04-27 20:00:12,373 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.021, Acc: 0.949, Base Lr: 2.77e-03
2022-04-27 20:00:20,134 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.166[s] Speed: 96.6[samples/s]
2022-04-27 20:00:42,255 reid_baseline.train INFO: normal accuracy 0.5638029782359679 2.985490083694458 
2022-04-27 20:00:42,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 20:00:42,256 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 298.5%
2022-04-27 20:00:59,605 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.997, Acc: 0.954, Base Lr: 2.20e-03
2022-04-27 20:01:06,788 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.160[s] Speed: 100.2[samples/s]
2022-04-27 20:01:28,463 reid_baseline.train INFO: normal accuracy 0.5663230240549828 2.943997621536255 
2022-04-27 20:01:29,346 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 20:01:29,346 reid_baseline.train INFO: Accuracy: 56.6% Mean Entropy: 294.4%
2022-04-27 20:01:45,183 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.971, Acc: 0.967, Base Lr: 1.66e-03
2022-04-27 20:01:52,476 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.152[s] Speed: 105.5[samples/s]
2022-04-27 20:02:14,441 reid_baseline.train INFO: normal accuracy 0.5640320733104238 2.927368402481079 
2022-04-27 20:02:15,251 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 20:02:15,251 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 292.7%
2022-04-27 20:02:32,267 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.959, Acc: 0.967, Base Lr: 1.19e-03
2022-04-27 20:02:39,965 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.162[s] Speed: 98.7[samples/s]
2022-04-27 20:03:02,228 reid_baseline.train INFO: normal accuracy 0.565864833906071 2.9538629055023193 
2022-04-27 20:03:02,228 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 20:03:02,228 reid_baseline.train INFO: Accuracy: 56.6% Mean Entropy: 295.4%
2022-04-27 20:03:18,349 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.948, Acc: 0.971, Base Lr: 7.78e-04
2022-04-27 20:03:25,861 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.154[s] Speed: 104.0[samples/s]
2022-04-27 20:03:47,772 reid_baseline.train INFO: normal accuracy 0.565864833906071 2.9566171169281006 
2022-04-27 20:03:47,772 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 20:03:47,772 reid_baseline.train INFO: Accuracy: 56.6% Mean Entropy: 295.7%
2022-04-27 20:04:03,825 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.950, Acc: 0.967, Base Lr: 4.51e-04
2022-04-27 20:04:11,340 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.155[s] Speed: 103.4[samples/s]
2022-04-27 20:04:33,409 reid_baseline.train INFO: normal accuracy 0.5683848797250859 2.909653425216675 
2022-04-27 20:04:34,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 20:04:34,242 reid_baseline.train INFO: Accuracy: 56.8% Mean Entropy: 291.0%
2022-04-27 20:04:51,412 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.936, Acc: 0.974, Base Lr: 2.11e-04
2022-04-27 20:04:59,096 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.163[s] Speed: 97.9[samples/s]
2022-04-27 20:05:21,028 reid_baseline.train INFO: normal accuracy 0.5702176403207331 2.9374611377716064 
2022-04-27 20:05:21,029 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 20:05:21,029 reid_baseline.train INFO: Accuracy: 57.0% Mean Entropy: 293.7%
2022-04-27 20:05:36,983 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.947, Acc: 0.971, Base Lr: 6.51e-05
2022-04-27 20:05:44,390 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.152[s] Speed: 105.1[samples/s]
2022-04-27 20:06:06,252 reid_baseline.train INFO: normal accuracy 0.5702176403207331 2.9248552322387695 
2022-04-27 20:06:06,253 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 20:06:06,253 reid_baseline.train INFO: Accuracy: 57.0% Mean Entropy: 292.5%
2022-04-27 20:06:23,000 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.941, Acc: 0.972, Base Lr: 1.60e-05
2022-04-27 20:06:30,615 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.157[s] Speed: 102.0[samples/s]
2022-04-27 20:06:52,687 reid_baseline.train INFO: normal accuracy 0.5697594501718213 2.931448221206665 
2022-04-27 20:06:52,688 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 20:06:52,688 reid_baseline.train INFO: Accuracy: 57.0% Mean Entropy: 293.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_cross_key_layer_12/transformer_best_model.pth
2022-04-27 20:07:16,141 reid_baseline.train INFO: normal accuracy 0.5683848797250859 2.909653425216675 
2022-04-27 20:07:16,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 20:07:16,142 reid_baseline.train INFO: Accuracy: 56.8%
2022-04-27 20:07:37,987 reid_baseline.train INFO: normal accuracy 0.5683848797250859 2.909653425216675 
2022-04-27 20:07:37,988 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 20:07:37,988 reid_baseline.train INFO: Shuffled Accuracy: 56.8%
2022-04-27 20:08:01,072 reid_baseline.train INFO: normal accuracy 0.9752781211372065 2.1287927627563477 
2022-04-27 20:08:01,073 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 20:08:01,073 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-27 20:08:05,799 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_12
2022-04-27 20:08:05,799 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-27 20:08:05,799 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 20:08:05,799 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 20:08:05,800 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 20:08:16,774 reid_baseline.train INFO: start training
2022-04-27 20:08:34,640 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.146, Acc: 0.132, Base Lr: 8.72e-04
2022-04-27 20:08:43,172 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.173[s] Speed: 92.5[samples/s]
2022-04-27 20:09:05,872 reid_baseline.train INFO: normal accuracy 0.17503942329353459 4.172030448913574 
2022-04-27 20:09:06,639 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 20:09:06,640 reid_baseline.train INFO: Accuracy: 17.5% Mean Entropy: 417.2%
2022-04-27 20:09:23,644 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.914, Acc: 0.397, Base Lr: 1.66e-03
2022-04-27 20:09:30,849 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.159[s] Speed: 100.6[samples/s]
2022-04-27 20:09:52,682 reid_baseline.train INFO: normal accuracy 0.31561162423969363 4.150853157043457 
2022-04-27 20:09:53,508 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 20:09:53,508 reid_baseline.train INFO: Accuracy: 31.6% Mean Entropy: 415.1%
2022-04-27 20:10:09,062 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.294, Acc: 0.457, Base Lr: 2.46e-03
2022-04-27 20:10:16,416 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.150[s] Speed: 106.3[samples/s]
2022-04-27 20:10:38,661 reid_baseline.train INFO: normal accuracy 0.38702410452804686 4.018746376037598 
2022-04-27 20:10:39,493 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 20:10:39,493 reid_baseline.train INFO: Accuracy: 38.7% Mean Entropy: 401.9%
2022-04-27 20:10:56,553 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.519, Acc: 0.574, Base Lr: 3.25e-03
2022-04-27 20:11:04,375 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.163[s] Speed: 98.0[samples/s]
2022-04-27 20:11:27,077 reid_baseline.train INFO: normal accuracy 0.48073890515881956 3.7700750827789307 
2022-04-27 20:11:27,924 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 20:11:27,924 reid_baseline.train INFO: Accuracy: 48.1% Mean Entropy: 377.0%
2022-04-27 20:11:43,778 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.036, Acc: 0.685, Base Lr: 4.04e-03
2022-04-27 20:11:51,311 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.152[s] Speed: 105.0[samples/s]
2022-04-27 20:12:13,528 reid_baseline.train INFO: normal accuracy 0.5841405722009462 3.5105347633361816 
2022-04-27 20:12:14,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 20:12:14,344 reid_baseline.train INFO: Accuracy: 58.4% Mean Entropy: 351.1%
2022-04-27 20:12:30,559 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.704, Acc: 0.757, Base Lr: 4.83e-03
2022-04-27 20:12:38,278 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.157[s] Speed: 102.0[samples/s]
2022-04-27 20:13:01,002 reid_baseline.train INFO: normal accuracy 0.6413606668168507 3.3155038356781006 
2022-04-27 20:13:01,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 20:13:01,801 reid_baseline.train INFO: Accuracy: 64.1% Mean Entropy: 331.6%
2022-04-27 20:13:18,966 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.482, Acc: 0.826, Base Lr: 5.62e-03
2022-04-27 20:13:26,489 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.161[s] Speed: 99.4[samples/s]
2022-04-27 20:13:48,732 reid_baseline.train INFO: normal accuracy 0.6857400315386348 3.196169137954712 
2022-04-27 20:13:49,472 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 20:13:49,472 reid_baseline.train INFO: Accuracy: 68.6% Mean Entropy: 319.6%
2022-04-27 20:14:06,351 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.306, Acc: 0.866, Base Lr: 6.42e-03
2022-04-27 20:14:13,882 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.159[s] Speed: 100.5[samples/s]
2022-04-27 20:14:36,140 reid_baseline.train INFO: normal accuracy 0.7120973192160397 3.092890739440918 
2022-04-27 20:14:36,923 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 20:14:36,923 reid_baseline.train INFO: Accuracy: 71.2% Mean Entropy: 309.3%
2022-04-27 20:14:53,600 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.185, Acc: 0.902, Base Lr: 7.21e-03
2022-04-27 20:15:01,252 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.159[s] Speed: 100.5[samples/s]
2022-04-27 20:15:24,322 reid_baseline.train INFO: normal accuracy 0.7175039423293534 2.9302775859832764 
2022-04-27 20:15:25,152 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 20:15:25,152 reid_baseline.train INFO: Accuracy: 71.8% Mean Entropy: 293.0%
2022-04-27 20:15:42,119 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.083, Acc: 0.928, Base Lr: 4.01e-03
2022-04-27 20:15:49,412 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.159[s] Speed: 100.4[samples/s]
2022-04-27 20:16:11,327 reid_baseline.train INFO: normal accuracy 0.7296688443343096 2.915144205093384 
2022-04-27 20:16:12,105 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 20:16:12,105 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 291.5%
2022-04-27 20:16:28,439 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.055, Acc: 0.941, Base Lr: 3.38e-03
2022-04-27 20:16:36,005 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.157[s] Speed: 101.9[samples/s]
2022-04-27 20:16:58,163 reid_baseline.train INFO: normal accuracy 0.7269655327776526 2.8376240730285645 
2022-04-27 20:16:59,016 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 20:16:59,017 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 283.8%
2022-04-27 20:17:16,554 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.021, Acc: 0.949, Base Lr: 2.77e-03
2022-04-27 20:17:24,259 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.166[s] Speed: 96.6[samples/s]
2022-04-27 20:17:47,070 reid_baseline.train INFO: normal accuracy 0.7377787790042802 2.86979341506958 
2022-04-27 20:17:47,071 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 20:17:47,071 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 287.0%
2022-04-27 20:18:03,221 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.997, Acc: 0.954, Base Lr: 2.20e-03
2022-04-27 20:18:10,387 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.153[s] Speed: 104.5[samples/s]
2022-04-27 20:18:33,614 reid_baseline.train INFO: normal accuracy 0.7395809867087182 2.8313918113708496 
2022-04-27 20:18:34,451 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 20:18:34,451 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 283.1%
2022-04-27 20:18:50,590 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.971, Acc: 0.967, Base Lr: 1.66e-03
2022-04-27 20:18:58,676 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.159[s] Speed: 100.5[samples/s]
2022-04-27 20:19:22,173 reid_baseline.train INFO: normal accuracy 0.7436359540437035 2.7954647541046143 
2022-04-27 20:19:22,977 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 20:19:22,977 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 279.5%
2022-04-27 20:19:43,788 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.959, Acc: 0.967, Base Lr: 1.19e-03
2022-04-27 20:19:51,628 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.188[s] Speed: 85.0[samples/s]
2022-04-27 20:20:16,032 reid_baseline.train INFO: normal accuracy 0.7422842982653751 2.8237271308898926 
2022-04-27 20:20:16,032 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 20:20:16,033 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 282.4%
2022-04-27 20:20:33,752 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.948, Acc: 0.971, Base Lr: 7.78e-04
2022-04-27 20:20:41,258 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.164[s] Speed: 97.4[samples/s]
2022-04-27 20:21:03,842 reid_baseline.train INFO: normal accuracy 0.7461139896373057 2.8299942016601562 
2022-04-27 20:21:03,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 20:21:03,843 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 283.0%
2022-04-27 20:21:22,395 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.950, Acc: 0.967, Base Lr: 4.51e-04
2022-04-27 20:21:30,568 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.175[s] Speed: 91.3[samples/s]
2022-04-27 20:21:55,275 reid_baseline.train INFO: normal accuracy 0.7470150934895247 2.778674602508545 
2022-04-27 20:21:56,091 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 20:21:56,091 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 277.9%
2022-04-27 20:22:15,562 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.936, Acc: 0.974, Base Lr: 2.11e-04
2022-04-27 20:22:25,413 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.192[s] Speed: 83.2[samples/s]
2022-04-27 20:22:47,382 reid_baseline.train INFO: normal accuracy 0.7463392656003605 2.808748722076416 
2022-04-27 20:22:47,382 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 20:22:47,382 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 280.9%
2022-04-27 20:23:03,878 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.947, Acc: 0.971, Base Lr: 6.51e-05
2022-04-27 20:23:11,759 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.160[s] Speed: 100.0[samples/s]
2022-04-27 20:23:35,010 reid_baseline.train INFO: normal accuracy 0.7490425771570174 2.7892284393310547 
2022-04-27 20:23:35,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 20:23:35,011 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 278.9%
2022-04-27 20:23:53,745 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.941, Acc: 0.972, Base Lr: 1.60e-05
2022-04-27 20:24:03,555 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.187[s] Speed: 85.5[samples/s]
2022-04-27 20:24:29,458 reid_baseline.train INFO: normal accuracy 0.7465645415634152 2.797159433364868 
2022-04-27 20:24:29,458 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 20:24:29,458 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 279.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_cross_key_layer_12/transformer_best_model.pth
2022-04-27 20:24:52,903 reid_baseline.train INFO: normal accuracy 0.7470150934895247 2.778674602508545 
2022-04-27 20:24:52,903 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 20:24:52,903 reid_baseline.train INFO: Accuracy: 74.7%
2022-04-27 20:25:15,417 reid_baseline.train INFO: normal accuracy 0.7470150934895247 2.778674602508545 
2022-04-27 20:25:15,418 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 20:25:15,418 reid_baseline.train INFO: Shuffled Accuracy: 74.7%
2022-04-27 20:25:38,612 reid_baseline.train INFO: normal accuracy 0.9752781211372065 2.1287927627563477 
2022-04-27 20:25:38,613 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 20:25:38,613 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-27 20:25:43,448 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_12
2022-04-27 20:25:43,448 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-27 20:25:43,448 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 20:25:43,448 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 20:25:43,449 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 20:25:53,086 reid_baseline.train INFO: start training
2022-04-27 20:26:12,767 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.146, Acc: 0.132, Base Lr: 8.72e-04
2022-04-27 20:26:21,932 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.188[s] Speed: 85.1[samples/s]
2022-04-27 20:27:53,632 reid_baseline.train INFO: normal accuracy 0.26715630020656417 4.171896457672119 
2022-04-27 20:27:54,432 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 20:27:54,432 reid_baseline.train INFO: Accuracy: 26.7% Mean Entropy: 417.2%
2022-04-27 20:28:13,059 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.914, Acc: 0.397, Base Lr: 1.66e-03
2022-04-27 20:28:21,364 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.177[s] Speed: 90.4[samples/s]
2022-04-27 20:29:53,083 reid_baseline.train INFO: normal accuracy 0.4083084691301354 4.145849704742432 
2022-04-27 20:29:53,908 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 20:29:53,908 reid_baseline.train INFO: Accuracy: 40.8% Mean Entropy: 414.6%
2022-04-27 20:30:12,015 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.294, Acc: 0.457, Base Lr: 2.46e-03
2022-04-27 20:30:21,875 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.184[s] Speed: 87.0[samples/s]
2022-04-27 20:31:56,369 reid_baseline.train INFO: normal accuracy 0.47968785861831537 3.9522933959960938 
2022-04-27 20:31:57,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 20:31:57,155 reid_baseline.train INFO: Accuracy: 48.0% Mean Entropy: 395.2%
2022-04-27 20:32:13,695 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.519, Acc: 0.574, Base Lr: 3.25e-03
2022-04-27 20:32:21,765 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.162[s] Speed: 98.9[samples/s]
2022-04-27 20:33:59,477 reid_baseline.train INFO: normal accuracy 0.5861831535460179 3.6277215480804443 
2022-04-27 20:34:00,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 20:34:00,296 reid_baseline.train INFO: Accuracy: 58.6% Mean Entropy: 362.8%
2022-04-27 20:34:17,407 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.036, Acc: 0.685, Base Lr: 4.04e-03
2022-04-27 20:34:25,262 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.164[s] Speed: 97.5[samples/s]
2022-04-27 20:35:58,895 reid_baseline.train INFO: normal accuracy 0.6699563920128528 3.331246852874756 
2022-04-27 20:35:59,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 20:35:59,730 reid_baseline.train INFO: Accuracy: 67.0% Mean Entropy: 333.1%
2022-04-27 20:36:16,834 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.704, Acc: 0.757, Base Lr: 4.83e-03
2022-04-27 20:36:24,587 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.163[s] Speed: 98.4[samples/s]
2022-04-27 20:38:04,396 reid_baseline.train INFO: normal accuracy 0.7186137250401653 3.1333396434783936 
2022-04-27 20:38:05,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 20:38:05,202 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 313.3%
2022-04-27 20:38:21,842 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.482, Acc: 0.826, Base Lr: 5.62e-03
2022-04-27 20:38:29,646 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.160[s] Speed: 99.8[samples/s]
2022-04-27 20:40:02,621 reid_baseline.train INFO: normal accuracy 0.757631397750746 3.0258443355560303 
2022-04-27 20:40:03,480 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 20:40:03,480 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 302.6%
2022-04-27 20:40:22,407 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.306, Acc: 0.866, Base Lr: 6.42e-03
2022-04-27 20:40:30,387 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.176[s] Speed: 91.0[samples/s]
2022-04-27 20:42:12,942 reid_baseline.train INFO: normal accuracy 0.7764516869405554 2.921664237976074 
2022-04-27 20:42:13,761 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 20:42:13,761 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 292.2%
2022-04-27 20:42:35,855 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.185, Acc: 0.902, Base Lr: 7.21e-03
2022-04-27 20:42:46,290 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.214[s] Speed: 74.9[samples/s]
2022-04-27 20:44:41,478 reid_baseline.train INFO: normal accuracy 0.7870094101445949 2.7882726192474365 
2022-04-27 20:44:42,407 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 20:44:42,407 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 278.8%
2022-04-27 20:45:14,239 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.083, Acc: 0.928, Base Lr: 4.01e-03
2022-04-27 20:45:29,927 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-27 20:47:17,029 reid_baseline.train INFO: normal accuracy 0.7927473031902685 2.7688515186309814 
2022-04-27 20:47:18,063 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 20:47:18,063 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 276.9%
2022-04-27 20:48:10,313 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.055, Acc: 0.941, Base Lr: 3.38e-03
2022-04-27 20:48:33,360 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.495[s] Speed: 32.3[samples/s]
2022-04-27 20:50:27,308 reid_baseline.train INFO: normal accuracy 0.7945834289648841 2.6974518299102783 
2022-04-27 20:50:28,364 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 20:50:28,364 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 269.7%
2022-04-27 20:51:19,540 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.021, Acc: 0.949, Base Lr: 2.77e-03
2022-04-27 20:51:42,382 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.487[s] Speed: 32.9[samples/s]
2022-04-27 20:53:37,165 reid_baseline.train INFO: normal accuracy 0.7998622905669038 2.7287142276763916 
2022-04-27 20:53:37,166 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 20:53:37,167 reid_baseline.train INFO: Accuracy: 80.0% Mean Entropy: 272.9%
2022-04-27 20:54:29,246 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 0.997, Acc: 0.954, Base Lr: 2.20e-03
2022-04-27 20:54:52,878 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.497[s] Speed: 32.2[samples/s]
2022-04-27 20:56:48,684 reid_baseline.train INFO: normal accuracy 0.7984851962359422 2.6830432415008545 
2022-04-27 20:56:49,733 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 20:56:49,733 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 268.3%
2022-04-27 20:57:41,926 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 0.971, Acc: 0.967, Base Lr: 1.66e-03
2022-04-27 20:58:05,014 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.494[s] Speed: 32.4[samples/s]
2022-04-27 20:59:59,683 reid_baseline.train INFO: normal accuracy 0.8051411521689236 2.650967836380005 
2022-04-27 21:00:00,768 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 21:00:00,769 reid_baseline.train INFO: Accuracy: 80.5% Mean Entropy: 265.1%
2022-04-27 21:00:55,931 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 0.959, Acc: 0.967, Base Lr: 1.19e-03
2022-04-27 21:01:19,600 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.518[s] Speed: 30.9[samples/s]
2022-04-27 21:03:14,274 reid_baseline.train INFO: normal accuracy 0.8039935735597888 2.6914448738098145 
2022-04-27 21:03:14,276 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 21:03:14,277 reid_baseline.train INFO: Accuracy: 80.4% Mean Entropy: 269.1%
2022-04-27 21:04:08,005 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 0.948, Acc: 0.971, Base Lr: 7.78e-04
2022-04-27 21:04:32,798 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.516[s] Speed: 31.0[samples/s]
2022-04-27 21:06:29,335 reid_baseline.train INFO: normal accuracy 0.8062887307780583 2.701214075088501 
2022-04-27 21:06:29,336 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 21:06:29,336 reid_baseline.train INFO: Accuracy: 80.6% Mean Entropy: 270.1%
2022-04-27 21:07:28,780 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 0.950, Acc: 0.967, Base Lr: 4.51e-04
2022-04-27 21:07:54,801 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.562[s] Speed: 28.5[samples/s]
2022-04-27 21:09:53,387 reid_baseline.train INFO: normal accuracy 0.8078953408308469 2.6526403427124023 
2022-04-27 21:09:53,388 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 21:09:53,388 reid_baseline.train INFO: Accuracy: 80.8% Mean Entropy: 265.3%
2022-04-27 21:10:55,598 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 0.936, Acc: 0.974, Base Lr: 2.11e-04
2022-04-27 21:11:25,822 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.608[s] Speed: 26.3[samples/s]
2022-04-27 21:13:24,062 reid_baseline.train INFO: normal accuracy 0.8065182464998852 2.6890616416931152 
2022-04-27 21:13:24,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 21:13:24,065 reid_baseline.train INFO: Accuracy: 80.7% Mean Entropy: 268.9%
2022-04-27 21:14:19,113 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 0.947, Acc: 0.971, Base Lr: 6.51e-05
2022-04-27 21:14:44,783 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.531[s] Speed: 30.1[samples/s]
2022-04-27 21:16:36,774 reid_baseline.train INFO: normal accuracy 0.80766582510902 2.660737991333008 
2022-04-27 21:16:36,775 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 21:16:36,775 reid_baseline.train INFO: Accuracy: 80.8% Mean Entropy: 266.1%
2022-04-27 21:17:23,473 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 0.941, Acc: 0.972, Base Lr: 1.60e-05
2022-04-27 21:17:47,624 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.466[s] Speed: 34.3[samples/s]
2022-04-27 21:19:41,873 reid_baseline.train INFO: normal accuracy 0.80766582510902 2.669238567352295 
2022-04-27 21:19:41,877 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 21:19:41,877 reid_baseline.train INFO: Accuracy: 80.8% Mean Entropy: 266.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_cross_key_layer_12/transformer_best_model.pth
2022-04-27 21:21:37,869 reid_baseline.train INFO: normal accuracy 0.8051411521689236 2.650967836380005 
2022-04-27 21:21:37,869 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 21:21:37,869 reid_baseline.train INFO: Accuracy: 80.5%
2022-04-27 21:23:30,494 reid_baseline.train INFO: normal accuracy 0.8051411521689236 2.650967836380005 
2022-04-27 21:23:30,495 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 21:23:30,495 reid_baseline.train INFO: Shuffled Accuracy: 80.5%
2022-04-27 21:24:00,821 reid_baseline.train INFO: normal accuracy 0.9703337453646477 2.1451282501220703 
2022-04-27 21:24:00,821 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 21:24:00,821 reid_baseline.train INFO: Source Clean Accuracy: 97.0%
