2022-04-27 16:05:54,505 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_1
2022-04-27 16:05:54,505 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-27 16:05:54,505 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 16:05:54,505 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 16:05:54,506 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 16:06:08,043 reid_baseline.train INFO: start training
2022-04-27 16:06:24,627 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.159, Acc: 0.062, Base Lr: 8.72e-04
2022-04-27 16:06:38,476 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.139, Acc: 0.107, Base Lr: 8.72e-04
2022-04-27 16:06:48,601 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.147[s] Speed: 108.6[samples/s]
2022-04-27 16:07:11,167 reid_baseline.train INFO: normal accuracy 0.16275236918005767 4.169884204864502 
2022-04-27 16:07:12,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 16:07:12,008 reid_baseline.train INFO: Accuracy: 16.3% Mean Entropy: 417.0%
2022-04-27 16:07:27,918 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.937, Acc: 0.373, Base Lr: 1.66e-03
2022-04-27 16:07:41,558 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.814, Acc: 0.412, Base Lr: 1.66e-03
2022-04-27 16:07:51,562 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.144[s] Speed: 111.0[samples/s]
2022-04-27 16:08:14,468 reid_baseline.train INFO: normal accuracy 0.36711990111248455 4.108278274536133 
2022-04-27 16:08:15,229 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 16:08:15,229 reid_baseline.train INFO: Accuracy: 36.7% Mean Entropy: 410.8%
2022-04-27 16:08:30,152 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 3.047, Acc: 0.530, Base Lr: 2.46e-03
2022-04-27 16:08:43,923 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.873, Acc: 0.541, Base Lr: 2.46e-03
2022-04-27 16:08:54,298 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.143[s] Speed: 111.8[samples/s]
2022-04-27 16:09:17,025 reid_baseline.train INFO: normal accuracy 0.48413679439637414 3.6757121086120605 
2022-04-27 16:09:17,816 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 16:09:17,817 reid_baseline.train INFO: Accuracy: 48.4% Mean Entropy: 367.6%
2022-04-27 16:09:33,305 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.227, Acc: 0.632, Base Lr: 3.25e-03
2022-04-27 16:09:47,425 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.134, Acc: 0.650, Base Lr: 3.25e-03
2022-04-27 16:09:57,307 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.144[s] Speed: 111.2[samples/s]
2022-04-27 16:10:19,171 reid_baseline.train INFO: normal accuracy 0.580964153275649 3.132314682006836 
2022-04-27 16:10:20,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 16:10:20,001 reid_baseline.train INFO: Accuracy: 58.1% Mean Entropy: 313.2%
2022-04-27 16:10:35,648 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.784, Acc: 0.729, Base Lr: 4.04e-03
2022-04-27 16:10:49,182 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.725, Acc: 0.740, Base Lr: 4.04e-03
2022-04-27 16:10:59,044 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.143[s] Speed: 112.3[samples/s]
2022-04-27 16:11:22,610 reid_baseline.train INFO: normal accuracy 0.6312319736299958 2.7353949546813965 
2022-04-27 16:11:23,383 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 16:11:23,383 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 273.5%
2022-04-27 16:11:38,840 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.494, Acc: 0.799, Base Lr: 4.83e-03
2022-04-27 16:11:52,405 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.460, Acc: 0.804, Base Lr: 4.83e-03
2022-04-27 16:12:02,831 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.144[s] Speed: 111.1[samples/s]
2022-04-27 16:12:26,054 reid_baseline.train INFO: normal accuracy 0.6608982282653482 2.481790781021118 
2022-04-27 16:12:26,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 16:12:26,848 reid_baseline.train INFO: Accuracy: 66.1% Mean Entropy: 248.2%
2022-04-27 16:12:42,063 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.327, Acc: 0.837, Base Lr: 5.62e-03
2022-04-27 16:12:56,092 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.326, Acc: 0.839, Base Lr: 5.62e-03
2022-04-27 16:13:06,206 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.143[s] Speed: 111.7[samples/s]
2022-04-27 16:13:29,033 reid_baseline.train INFO: normal accuracy 0.6687268232385661 2.248538017272949 
2022-04-27 16:13:29,867 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 16:13:29,867 reid_baseline.train INFO: Accuracy: 66.9% Mean Entropy: 224.9%
2022-04-27 16:13:45,355 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.266, Acc: 0.852, Base Lr: 6.42e-03
2022-04-27 16:13:59,087 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.246, Acc: 0.858, Base Lr: 6.42e-03
2022-04-27 16:14:09,022 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.143[s] Speed: 111.6[samples/s]
2022-04-27 16:14:32,329 reid_baseline.train INFO: normal accuracy 0.6880922950144212 2.136289596557617 
2022-04-27 16:14:33,145 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 16:14:33,145 reid_baseline.train INFO: Accuracy: 68.8% Mean Entropy: 213.6%
2022-04-27 16:14:48,322 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.149, Acc: 0.903, Base Lr: 7.21e-03
2022-04-27 16:15:01,784 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.151, Acc: 0.899, Base Lr: 7.21e-03
2022-04-27 16:15:12,074 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.143[s] Speed: 112.2[samples/s]
2022-04-27 16:15:34,668 reid_baseline.train INFO: normal accuracy 0.6782035434693037 2.0243935585021973 
2022-04-27 16:15:35,452 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 16:15:35,452 reid_baseline.train INFO: Accuracy: 67.8% Mean Entropy: 202.4%
2022-04-27 16:15:50,460 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.060, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 16:16:04,566 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.070, Acc: 0.919, Base Lr: 4.01e-03
2022-04-27 16:16:14,565 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.143[s] Speed: 111.7[samples/s]
2022-04-27 16:16:36,793 reid_baseline.train INFO: normal accuracy 0.6971569839307787 1.9030301570892334 
2022-04-27 16:16:37,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 16:16:37,595 reid_baseline.train INFO: Accuracy: 69.7% Mean Entropy: 190.3%
2022-04-27 16:16:53,061 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.045, Acc: 0.919, Base Lr: 3.38e-03
2022-04-27 16:17:06,807 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.034, Acc: 0.925, Base Lr: 3.38e-03
2022-04-27 16:17:16,801 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.144[s] Speed: 111.4[samples/s]
2022-04-27 16:17:40,513 reid_baseline.train INFO: normal accuracy 0.7021013597033374 2.006113290786743 
2022-04-27 16:17:40,513 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 16:17:40,513 reid_baseline.train INFO: Accuracy: 70.2% Mean Entropy: 200.6%
2022-04-27 16:17:55,705 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 0.999, Acc: 0.940, Base Lr: 2.77e-03
2022-04-27 16:18:09,860 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.014, Acc: 0.931, Base Lr: 2.77e-03
2022-04-27 16:18:20,480 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.146[s] Speed: 109.5[samples/s]
2022-04-27 16:18:44,503 reid_baseline.train INFO: normal accuracy 0.6971569839307787 2.001880645751953 
2022-04-27 16:18:44,504 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 16:18:44,504 reid_baseline.train INFO: Accuracy: 69.7% Mean Entropy: 200.2%
2022-04-27 16:18:59,708 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.992, Acc: 0.940, Base Lr: 2.20e-03
2022-04-27 16:19:13,727 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.986, Acc: 0.942, Base Lr: 2.20e-03
2022-04-27 16:19:23,619 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.143[s] Speed: 112.1[samples/s]
2022-04-27 16:19:46,179 reid_baseline.train INFO: normal accuracy 0.7062216728471363 1.9707634449005127 
2022-04-27 16:19:46,179 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 16:19:46,179 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 197.1%
2022-04-27 16:20:01,427 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.982, Acc: 0.944, Base Lr: 1.66e-03
2022-04-27 16:20:15,003 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.975, Acc: 0.945, Base Lr: 1.66e-03
2022-04-27 16:20:24,745 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.141[s] Speed: 113.3[samples/s]
2022-04-27 16:20:47,363 reid_baseline.train INFO: normal accuracy 0.7004532344458179 1.979967713356018 
2022-04-27 16:20:47,363 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 16:20:47,363 reid_baseline.train INFO: Accuracy: 70.0% Mean Entropy: 198.0%
2022-04-27 16:21:02,208 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.965, Acc: 0.946, Base Lr: 1.19e-03
2022-04-27 16:21:15,769 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.962, Acc: 0.949, Base Lr: 1.19e-03
2022-04-27 16:21:25,757 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.140[s] Speed: 114.0[samples/s]
2022-04-27 16:21:46,606 reid_baseline.train INFO: normal accuracy 0.7058096415327565 1.9377824068069458 
2022-04-27 16:21:46,607 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 16:21:46,607 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 193.8%
2022-04-27 16:22:02,505 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.966, Acc: 0.945, Base Lr: 7.78e-04
2022-04-27 16:22:16,118 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.960, Acc: 0.950, Base Lr: 7.78e-04
2022-04-27 16:22:26,089 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.144[s] Speed: 110.9[samples/s]
2022-04-27 16:22:49,646 reid_baseline.train INFO: normal accuracy 0.7058096415327565 1.95924711227417 
2022-04-27 16:22:49,647 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 16:22:49,647 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 195.9%
2022-04-27 16:23:04,979 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.954, Acc: 0.949, Base Lr: 4.51e-04
2022-04-27 16:23:22,915 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.953, Acc: 0.952, Base Lr: 4.51e-04
2022-04-27 16:23:42,316 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.193[s] Speed: 82.9[samples/s]
2022-04-27 16:24:10,533 reid_baseline.train INFO: normal accuracy 0.703749484960857 1.9093679189682007 
2022-04-27 16:24:10,535 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 16:24:10,535 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 190.9%
2022-04-27 16:24:32,851 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.946, Acc: 0.952, Base Lr: 2.11e-04
2022-04-27 16:24:47,282 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.945, Acc: 0.956, Base Lr: 2.11e-04
2022-04-27 16:24:57,252 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.171[s] Speed: 93.7[samples/s]
2022-04-27 16:25:19,797 reid_baseline.train INFO: normal accuracy 0.7025133910177174 1.9518786668777466 
2022-04-27 16:25:19,797 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 16:25:19,797 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 195.2%
2022-04-27 16:25:40,744 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.949, Acc: 0.954, Base Lr: 6.51e-05
2022-04-27 16:26:04,333 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.948, Acc: 0.957, Base Lr: 6.51e-05
2022-04-27 16:26:27,092 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.246[s] Speed: 64.9[samples/s]
2022-04-27 16:26:55,752 reid_baseline.train INFO: normal accuracy 0.7053976102183765 1.9176063537597656 
2022-04-27 16:26:55,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 16:26:55,752 reid_baseline.train INFO: Accuracy: 70.5% Mean Entropy: 191.8%
2022-04-27 16:27:31,258 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.941, Acc: 0.953, Base Lr: 1.60e-05
2022-04-27 16:28:03,668 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.946, Acc: 0.954, Base Lr: 1.60e-05
2022-04-27 16:28:13,645 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.285[s] Speed: 56.1[samples/s]
2022-04-27 16:28:36,893 reid_baseline.train INFO: normal accuracy 0.7029254223320972 1.9826745986938477 
2022-04-27 16:28:36,893 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 16:28:36,894 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 198.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_1/transformer_best_model.pth
2022-04-27 16:29:00,133 reid_baseline.train INFO: normal accuracy 0.6971569839307787 1.9030301570892334 
2022-04-27 16:29:00,133 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:29:00,133 reid_baseline.train INFO: Accuracy: 69.7%
2022-04-27 16:29:22,975 reid_baseline.train INFO: normal accuracy 0.6971569839307787 1.9030301570892334 
2022-04-27 16:29:22,975 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:29:22,975 reid_baseline.train INFO: Shuffled Accuracy: 69.7%
2022-04-27 16:29:45,191 reid_baseline.train INFO: normal accuracy 0.9420389461626575 0.8775624632835388 
2022-04-27 16:29:45,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:29:45,192 reid_baseline.train INFO: Source Clean Accuracy: 94.2%
2022-04-27 16:29:49,943 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_1
2022-04-27 16:29:49,943 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-27 16:29:49,943 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 16:29:49,943 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 16:29:49,944 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 16:30:01,501 reid_baseline.train INFO: start training
2022-04-27 16:30:17,866 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.159, Acc: 0.062, Base Lr: 8.72e-04
2022-04-27 16:30:31,199 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.139, Acc: 0.107, Base Lr: 8.72e-04
2022-04-27 16:30:41,247 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.145[s] Speed: 110.4[samples/s]
2022-04-27 16:31:04,908 reid_baseline.train INFO: normal accuracy 0.17931966659157467 4.17007303237915 
2022-04-27 16:31:05,679 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 16:31:05,679 reid_baseline.train INFO: Accuracy: 17.9% Mean Entropy: 417.0%
2022-04-27 16:31:20,694 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.937, Acc: 0.373, Base Lr: 1.66e-03
2022-04-27 16:31:34,279 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.814, Acc: 0.412, Base Lr: 1.66e-03
2022-04-27 16:31:44,462 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.142[s] Speed: 112.7[samples/s]
2022-04-27 16:32:06,936 reid_baseline.train INFO: normal accuracy 0.4737553503041225 4.0897722244262695 
2022-04-27 16:32:07,807 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 16:32:07,808 reid_baseline.train INFO: Accuracy: 47.4% Mean Entropy: 409.0%
2022-04-27 16:32:23,091 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 3.047, Acc: 0.530, Base Lr: 2.46e-03
2022-04-27 16:32:36,534 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.873, Acc: 0.541, Base Lr: 2.46e-03
2022-04-27 16:32:46,213 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.140[s] Speed: 114.1[samples/s]
2022-04-27 16:33:08,423 reid_baseline.train INFO: normal accuracy 0.5661184951565668 3.506086826324463 
2022-04-27 16:33:09,247 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 16:33:09,247 reid_baseline.train INFO: Accuracy: 56.6% Mean Entropy: 350.6%
2022-04-27 16:33:24,879 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.227, Acc: 0.632, Base Lr: 3.25e-03
2022-04-27 16:33:38,244 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.134, Acc: 0.650, Base Lr: 3.25e-03
2022-04-27 16:33:48,065 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.142[s] Speed: 112.8[samples/s]
2022-04-27 16:34:11,386 reid_baseline.train INFO: normal accuracy 0.6346023879252084 2.8691675662994385 
2022-04-27 16:34:12,218 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 16:34:12,218 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 286.9%
2022-04-27 16:34:27,207 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.784, Acc: 0.729, Base Lr: 4.04e-03
2022-04-27 16:34:40,546 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.725, Acc: 0.740, Base Lr: 4.04e-03
2022-04-27 16:34:50,774 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.141[s] Speed: 113.4[samples/s]
2022-04-27 16:35:13,389 reid_baseline.train INFO: normal accuracy 0.679432304573102 2.4681007862091064 
2022-04-27 16:35:14,178 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 16:35:14,179 reid_baseline.train INFO: Accuracy: 67.9% Mean Entropy: 246.8%
2022-04-27 16:35:29,702 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.494, Acc: 0.799, Base Lr: 4.83e-03
2022-04-27 16:35:43,373 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.460, Acc: 0.804, Base Lr: 4.83e-03
2022-04-27 16:35:53,426 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.143[s] Speed: 112.0[samples/s]
2022-04-27 16:36:16,060 reid_baseline.train INFO: normal accuracy 0.7003829691371931 2.2106924057006836 
2022-04-27 16:36:16,930 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 16:36:16,930 reid_baseline.train INFO: Accuracy: 70.0% Mean Entropy: 221.1%
2022-04-27 16:36:32,557 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.327, Acc: 0.837, Base Lr: 5.62e-03
2022-04-27 16:36:46,325 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.326, Acc: 0.839, Base Lr: 5.62e-03
2022-04-27 16:36:56,053 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.143[s] Speed: 111.7[samples/s]
2022-04-27 16:37:19,431 reid_baseline.train INFO: normal accuracy 0.7145753548096418 2.0325024127960205 
2022-04-27 16:37:20,221 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 16:37:20,221 reid_baseline.train INFO: Accuracy: 71.5% Mean Entropy: 203.3%
2022-04-27 16:37:35,745 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.266, Acc: 0.852, Base Lr: 6.42e-03
2022-04-27 16:37:49,332 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.246, Acc: 0.858, Base Lr: 6.42e-03
2022-04-27 16:37:59,677 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.144[s] Speed: 111.2[samples/s]
2022-04-27 16:38:22,171 reid_baseline.train INFO: normal accuracy 0.7262897048884884 1.8903424739837646 
2022-04-27 16:38:22,960 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 16:38:22,961 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 189.0%
2022-04-27 16:38:37,519 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.149, Acc: 0.903, Base Lr: 7.21e-03
2022-04-27 16:38:50,882 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.151, Acc: 0.899, Base Lr: 7.21e-03
2022-04-27 16:39:00,686 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.138[s] Speed: 116.0[samples/s]
2022-04-27 16:39:22,885 reid_baseline.train INFO: normal accuracy 0.7330479837801307 1.8315058946609497 
2022-04-27 16:39:23,736 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 16:39:23,736 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 183.2%
2022-04-27 16:39:38,608 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.060, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 16:39:51,897 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.070, Acc: 0.919, Base Lr: 4.01e-03
2022-04-27 16:40:02,427 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.141[s] Speed: 113.2[samples/s]
2022-04-27 16:40:24,984 reid_baseline.train INFO: normal accuracy 0.7474656454156342 1.7287169694900513 
2022-04-27 16:40:25,785 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 16:40:25,785 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 172.9%
2022-04-27 16:40:40,782 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.045, Acc: 0.919, Base Lr: 3.38e-03
2022-04-27 16:40:54,292 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.034, Acc: 0.925, Base Lr: 3.38e-03
2022-04-27 16:41:04,296 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.141[s] Speed: 113.5[samples/s]
2022-04-27 16:41:26,722 reid_baseline.train INFO: normal accuracy 0.7443117819328677 1.8294917345046997 
2022-04-27 16:41:26,723 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 16:41:26,723 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 182.9%
2022-04-27 16:41:41,180 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 0.999, Acc: 0.940, Base Lr: 2.77e-03
2022-04-27 16:41:55,067 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.014, Acc: 0.931, Base Lr: 2.77e-03
2022-04-27 16:42:05,157 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.140[s] Speed: 114.2[samples/s]
2022-04-27 16:42:27,690 reid_baseline.train INFO: normal accuracy 0.7503942329353458 1.8261703252792358 
2022-04-27 16:42:27,690 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 16:42:27,690 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 182.6%
2022-04-27 16:42:42,984 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.992, Acc: 0.940, Base Lr: 2.20e-03
2022-04-27 16:42:56,383 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.986, Acc: 0.942, Base Lr: 2.20e-03
2022-04-27 16:43:06,202 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.141[s] Speed: 113.6[samples/s]
2022-04-27 16:43:28,658 reid_baseline.train INFO: normal accuracy 0.7497184050461816 1.8309383392333984 
2022-04-27 16:43:28,659 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 16:43:28,659 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 183.1%
2022-04-27 16:43:43,835 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.982, Acc: 0.944, Base Lr: 1.66e-03
2022-04-27 16:43:57,529 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.975, Acc: 0.945, Base Lr: 1.66e-03
2022-04-27 16:44:07,313 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.141[s] Speed: 113.2[samples/s]
2022-04-27 16:44:29,742 reid_baseline.train INFO: normal accuracy 0.7517458887136742 1.8236467838287354 
2022-04-27 16:44:29,742 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 16:44:29,742 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 182.4%
2022-04-27 16:44:44,744 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.965, Acc: 0.946, Base Lr: 1.19e-03
2022-04-27 16:44:58,458 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.962, Acc: 0.949, Base Lr: 1.19e-03
2022-04-27 16:45:08,301 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.141[s] Speed: 113.6[samples/s]
2022-04-27 16:45:30,393 reid_baseline.train INFO: normal accuracy 0.751971164676729 1.789854645729065 
2022-04-27 16:45:30,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 16:45:30,394 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 179.0%
2022-04-27 16:45:45,944 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.966, Acc: 0.945, Base Lr: 7.78e-04
2022-04-27 16:45:59,370 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.960, Acc: 0.950, Base Lr: 7.78e-04
2022-04-27 16:46:09,221 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.142[s] Speed: 112.6[samples/s]
2022-04-27 16:46:31,802 reid_baseline.train INFO: normal accuracy 0.7542239243072764 1.8194353580474854 
2022-04-27 16:46:31,802 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 16:46:31,803 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 181.9%
2022-04-27 16:46:46,970 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.954, Acc: 0.949, Base Lr: 4.51e-04
2022-04-27 16:47:00,426 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.953, Acc: 0.952, Base Lr: 4.51e-04
2022-04-27 16:47:10,200 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.140[s] Speed: 113.9[samples/s]
2022-04-27 16:47:32,559 reid_baseline.train INFO: normal accuracy 0.7537733723811669 1.7603285312652588 
2022-04-27 16:47:32,559 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 16:47:32,559 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 176.0%
2022-04-27 16:47:47,591 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.946, Acc: 0.952, Base Lr: 2.11e-04
2022-04-27 16:48:00,945 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.945, Acc: 0.956, Base Lr: 2.11e-04
2022-04-27 16:48:10,596 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.139[s] Speed: 115.1[samples/s]
2022-04-27 16:48:33,626 reid_baseline.train INFO: normal accuracy 0.7560261320117143 1.8107179403305054 
2022-04-27 16:48:33,626 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 16:48:33,627 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 181.1%
2022-04-27 16:48:49,113 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.949, Acc: 0.954, Base Lr: 6.51e-05
2022-04-27 16:49:02,140 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.948, Acc: 0.957, Base Lr: 6.51e-05
2022-04-27 16:49:12,249 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.140[s] Speed: 114.1[samples/s]
2022-04-27 16:49:36,452 reid_baseline.train INFO: normal accuracy 0.7544492002703311 1.771552562713623 
2022-04-27 16:49:36,453 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 16:49:36,453 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 177.2%
2022-04-27 16:49:51,303 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.941, Acc: 0.953, Base Lr: 1.60e-05
2022-04-27 16:50:05,556 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.946, Acc: 0.954, Base Lr: 1.60e-05
2022-04-27 16:50:21,108 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.163[s] Speed: 98.2[samples/s]
2022-04-27 16:50:53,199 reid_baseline.train INFO: normal accuracy 0.7576030637530975 1.834939956665039 
2022-04-27 16:50:53,199 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 16:50:53,200 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 183.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_1/transformer_best_model.pth
2022-04-27 16:51:26,110 reid_baseline.train INFO: normal accuracy 0.7474656454156342 1.7287169694900513 
2022-04-27 16:51:26,110 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:51:26,110 reid_baseline.train INFO: Accuracy: 74.7%
2022-04-27 16:51:54,052 reid_baseline.train INFO: normal accuracy 0.7474656454156342 1.7287169694900513 
2022-04-27 16:51:54,052 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:51:54,052 reid_baseline.train INFO: Shuffled Accuracy: 74.7%
2022-04-27 16:52:17,635 reid_baseline.train INFO: normal accuracy 0.9420389461626575 0.8775624632835388 
2022-04-27 16:52:17,635 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 16:52:17,635 reid_baseline.train INFO: Source Clean Accuracy: 94.2%
2022-04-27 16:52:22,909 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_1
2022-04-27 16:52:22,909 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-27 16:52:22,909 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 16:52:22,909 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 16:52:22,910 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 16:52:35,754 reid_baseline.train INFO: start training
2022-04-27 16:52:58,828 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.159, Acc: 0.062, Base Lr: 8.72e-04
2022-04-27 16:53:20,186 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.139, Acc: 0.107, Base Lr: 8.72e-04
2022-04-27 16:53:32,212 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.206[s] Speed: 77.8[samples/s]
2022-04-27 16:55:11,280 reid_baseline.train INFO: normal accuracy 0.22102364011934816 4.170096397399902 
2022-04-27 16:55:12,167 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 16:55:12,167 reid_baseline.train INFO: Accuracy: 22.1% Mean Entropy: 417.0%
2022-04-27 16:55:32,635 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.937, Acc: 0.373, Base Lr: 1.66e-03
2022-04-27 16:55:46,893 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.814, Acc: 0.412, Base Lr: 1.66e-03
2022-04-27 16:55:57,822 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.167[s] Speed: 95.7[samples/s]
2022-04-27 16:57:26,549 reid_baseline.train INFO: normal accuracy 0.4666054624741795 4.093691825866699 
2022-04-27 16:57:27,328 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 16:57:27,328 reid_baseline.train INFO: Accuracy: 46.7% Mean Entropy: 409.4%
2022-04-27 16:57:42,332 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 3.047, Acc: 0.530, Base Lr: 2.46e-03
2022-04-27 16:57:56,787 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.873, Acc: 0.541, Base Lr: 2.46e-03
2022-04-27 16:58:06,922 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.144[s] Speed: 111.3[samples/s]
2022-04-27 16:59:33,475 reid_baseline.train INFO: normal accuracy 0.5673628643562084 3.5273818969726562 
2022-04-27 16:59:34,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 16:59:34,288 reid_baseline.train INFO: Accuracy: 56.7% Mean Entropy: 352.7%
2022-04-27 16:59:50,019 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.227, Acc: 0.632, Base Lr: 3.25e-03
2022-04-27 17:00:03,363 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.134, Acc: 0.650, Base Lr: 3.25e-03
2022-04-27 17:00:13,131 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.142[s] Speed: 112.6[samples/s]
2022-04-27 17:01:42,210 reid_baseline.train INFO: normal accuracy 0.6699563920128528 2.891432523727417 
2022-04-27 17:01:43,070 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 17:01:43,070 reid_baseline.train INFO: Accuracy: 67.0% Mean Entropy: 289.1%
2022-04-27 17:02:10,886 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.784, Acc: 0.729, Base Lr: 4.04e-03
2022-04-27 17:02:36,319 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.725, Acc: 0.740, Base Lr: 4.04e-03
2022-04-27 17:02:46,976 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.234[s] Speed: 68.4[samples/s]
2022-04-27 17:04:17,353 reid_baseline.train INFO: normal accuracy 0.7133348634381456 2.4643630981445312 
2022-04-27 17:04:18,205 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 17:04:18,206 reid_baseline.train INFO: Accuracy: 71.3% Mean Entropy: 246.4%
2022-04-27 17:04:48,870 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.494, Acc: 0.799, Base Lr: 4.83e-03
2022-04-27 17:05:05,949 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.460, Acc: 0.804, Base Lr: 4.83e-03
2022-04-27 17:05:15,663 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.210[s] Speed: 76.3[samples/s]
2022-04-27 17:06:45,149 reid_baseline.train INFO: normal accuracy 0.7413357815010329 2.2213001251220703 
2022-04-27 17:06:46,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 17:06:46,011 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 222.1%
2022-04-27 17:07:00,804 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.327, Acc: 0.837, Base Lr: 5.62e-03
2022-04-27 17:07:14,140 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.326, Acc: 0.839, Base Lr: 5.62e-03
2022-04-27 17:07:24,589 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.141[s] Speed: 113.4[samples/s]
2022-04-27 17:08:50,563 reid_baseline.train INFO: normal accuracy 0.7468441588248795 2.0005602836608887 
2022-04-27 17:08:51,325 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 17:08:51,325 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 200.1%
2022-04-27 17:09:06,266 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.266, Acc: 0.852, Base Lr: 6.42e-03
2022-04-27 17:09:20,134 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.246, Acc: 0.858, Base Lr: 6.42e-03
2022-04-27 17:09:29,866 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.140[s] Speed: 114.0[samples/s]
2022-04-27 17:11:11,589 reid_baseline.train INFO: normal accuracy 0.7613036492999771 1.8721076250076294 
2022-04-27 17:11:12,418 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 17:11:12,418 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 187.2%
2022-04-27 17:11:27,689 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.149, Acc: 0.903, Base Lr: 7.21e-03
2022-04-27 17:11:41,170 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.151, Acc: 0.899, Base Lr: 7.21e-03
2022-04-27 17:11:51,190 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.142[s] Speed: 113.0[samples/s]
2022-04-27 17:13:19,277 reid_baseline.train INFO: normal accuracy 0.7665825109019968 1.7922382354736328 
2022-04-27 17:13:20,081 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 17:13:20,081 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 179.2%
2022-04-27 17:13:35,469 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.060, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 17:13:48,912 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.070, Acc: 0.919, Base Lr: 4.01e-03
2022-04-27 17:13:58,836 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.141[s] Speed: 113.6[samples/s]
2022-04-27 17:15:25,047 reid_baseline.train INFO: normal accuracy 0.773927014000459 1.6991474628448486 
2022-04-27 17:15:25,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 17:15:25,845 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 169.9%
2022-04-27 17:15:41,183 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.045, Acc: 0.919, Base Lr: 3.38e-03
2022-04-27 17:15:54,819 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.034, Acc: 0.925, Base Lr: 3.38e-03
2022-04-27 17:16:04,760 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.142[s] Speed: 112.3[samples/s]
2022-04-27 17:17:28,961 reid_baseline.train INFO: normal accuracy 0.7759926554969016 1.7987902164459229 
2022-04-27 17:17:28,961 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 17:17:28,961 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 179.9%
2022-04-27 17:17:44,289 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 0.999, Acc: 0.940, Base Lr: 2.77e-03
2022-04-27 17:17:57,900 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.014, Acc: 0.931, Base Lr: 2.77e-03
2022-04-27 17:18:07,540 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.141[s] Speed: 113.5[samples/s]
2022-04-27 17:19:32,815 reid_baseline.train INFO: normal accuracy 0.7817305485425752 1.7923033237457275 
2022-04-27 17:19:32,816 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 17:19:32,816 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 179.2%
2022-04-27 17:19:47,708 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.992, Acc: 0.940, Base Lr: 2.20e-03
2022-04-27 17:20:01,096 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.986, Acc: 0.942, Base Lr: 2.20e-03
2022-04-27 17:20:10,953 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.139[s] Speed: 114.7[samples/s]
2022-04-27 17:21:38,962 reid_baseline.train INFO: normal accuracy 0.7817305485425752 1.7872025966644287 
2022-04-27 17:21:38,962 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 17:21:38,963 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 178.7%
2022-04-27 17:21:53,808 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.982, Acc: 0.944, Base Lr: 1.66e-03
2022-04-27 17:22:07,858 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.975, Acc: 0.945, Base Lr: 1.66e-03
2022-04-27 17:22:17,615 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.141[s] Speed: 113.6[samples/s]
2022-04-27 17:23:42,153 reid_baseline.train INFO: normal accuracy 0.7817305485425752 1.785609245300293 
2022-04-27 17:23:42,154 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 17:23:42,154 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 178.6%
2022-04-27 17:23:57,415 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.965, Acc: 0.946, Base Lr: 1.19e-03
2022-04-27 17:24:10,678 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.962, Acc: 0.949, Base Lr: 1.19e-03
2022-04-27 17:24:20,536 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.140[s] Speed: 114.2[samples/s]
2022-04-27 17:25:47,658 reid_baseline.train INFO: normal accuracy 0.782419095708056 1.7420225143432617 
2022-04-27 17:25:47,658 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 17:25:47,658 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 174.2%
2022-04-27 17:26:03,402 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.966, Acc: 0.945, Base Lr: 7.78e-04
2022-04-27 17:26:16,766 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.960, Acc: 0.950, Base Lr: 7.78e-04
2022-04-27 17:26:26,577 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.142[s] Speed: 112.6[samples/s]
2022-04-27 17:27:52,547 reid_baseline.train INFO: normal accuracy 0.7835666743171907 1.7685974836349487 
2022-04-27 17:27:52,548 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 17:27:52,548 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 176.9%
2022-04-27 17:28:07,851 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.954, Acc: 0.949, Base Lr: 4.51e-04
2022-04-27 17:28:21,738 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.953, Acc: 0.952, Base Lr: 4.51e-04
2022-04-27 17:28:31,851 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.143[s] Speed: 112.2[samples/s]
2022-04-27 17:29:57,442 reid_baseline.train INFO: normal accuracy 0.7860913472572871 1.7127070426940918 
2022-04-27 17:29:57,442 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 17:29:57,442 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 171.3%
2022-04-27 17:30:13,002 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.946, Acc: 0.952, Base Lr: 2.11e-04
2022-04-27 17:30:26,225 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.945, Acc: 0.956, Base Lr: 2.11e-04
2022-04-27 17:30:36,623 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.142[s] Speed: 112.7[samples/s]
2022-04-27 17:32:02,311 reid_baseline.train INFO: normal accuracy 0.7831076428735368 1.765102744102478 
2022-04-27 17:32:02,311 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 17:32:02,311 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 176.5%
2022-04-27 17:32:18,918 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.949, Acc: 0.954, Base Lr: 6.51e-05
2022-04-27 17:32:32,418 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.948, Acc: 0.957, Base Lr: 6.51e-05
2022-04-27 17:32:42,422 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.146[s] Speed: 109.5[samples/s]
2022-04-27 17:34:08,667 reid_baseline.train INFO: normal accuracy 0.7821895799862291 1.727799892425537 
2022-04-27 17:34:08,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 17:34:08,668 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 172.8%
2022-04-27 17:34:23,838 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.941, Acc: 0.953, Base Lr: 1.60e-05
2022-04-27 17:34:37,731 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.946, Acc: 0.954, Base Lr: 1.60e-05
2022-04-27 17:34:47,599 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.142[s] Speed: 112.7[samples/s]
2022-04-27 17:36:14,708 reid_baseline.train INFO: normal accuracy 0.782419095708056 1.7909252643585205 
2022-04-27 17:36:14,708 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 17:36:14,708 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 179.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_1/transformer_best_model.pth
2022-04-27 17:37:46,357 reid_baseline.train INFO: normal accuracy 0.773927014000459 1.6991474628448486 
2022-04-27 17:37:46,358 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:37:46,358 reid_baseline.train INFO: Accuracy: 77.4%
2022-04-27 17:39:11,468 reid_baseline.train INFO: normal accuracy 0.773927014000459 1.6991474628448486 
2022-04-27 17:39:11,468 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:39:11,468 reid_baseline.train INFO: Shuffled Accuracy: 77.4%
2022-04-27 17:39:34,430 reid_baseline.train INFO: normal accuracy 0.9420389461626575 0.8775624632835388 
2022-04-27 17:39:34,430 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 17:39:34,430 reid_baseline.train INFO: Source Clean Accuracy: 94.2%
2022-04-27 17:39:39,082 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_2
2022-04-27 17:39:39,082 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-27 17:39:39,082 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 17:39:39,082 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 17:39:39,082 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 17:39:50,634 reid_baseline.train INFO: start training
2022-04-27 17:40:07,152 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.145, Acc: 0.134, Base Lr: 8.72e-04
2022-04-27 17:40:20,751 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.098, Acc: 0.227, Base Lr: 8.72e-04
2022-04-27 17:40:31,503 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.149[s] Speed: 107.5[samples/s]
2022-04-27 17:40:54,405 reid_baseline.train INFO: normal accuracy 0.27400082406262877 4.166577339172363 
2022-04-27 17:40:55,211 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 17:40:55,211 reid_baseline.train INFO: Accuracy: 27.4% Mean Entropy: 416.7%
2022-04-27 17:41:10,529 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.695, Acc: 0.481, Base Lr: 1.66e-03
2022-04-27 17:41:24,377 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.543, Acc: 0.484, Base Lr: 1.66e-03
2022-04-27 17:41:34,534 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.143[s] Speed: 111.9[samples/s]
2022-04-27 17:41:56,678 reid_baseline.train INFO: normal accuracy 0.40832303255047386 4.021088600158691 
2022-04-27 17:41:57,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 17:41:57,455 reid_baseline.train INFO: Accuracy: 40.8% Mean Entropy: 402.1%
2022-04-27 17:42:12,377 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.798, Acc: 0.548, Base Lr: 2.46e-03
2022-04-27 17:42:26,120 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.657, Acc: 0.565, Base Lr: 2.46e-03
2022-04-27 17:42:36,333 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.142[s] Speed: 112.4[samples/s]
2022-04-27 17:42:59,206 reid_baseline.train INFO: normal accuracy 0.515451174289246 3.54522442817688 
2022-04-27 17:43:00,024 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 17:43:00,025 reid_baseline.train INFO: Accuracy: 51.5% Mean Entropy: 354.5%
2022-04-27 17:43:15,163 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.106, Acc: 0.666, Base Lr: 3.25e-03
2022-04-27 17:43:28,767 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.030, Acc: 0.673, Base Lr: 3.25e-03
2022-04-27 17:43:38,808 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.141[s] Speed: 113.2[samples/s]
2022-04-27 17:44:01,787 reid_baseline.train INFO: normal accuracy 0.5966213432220849 2.9903135299682617 
2022-04-27 17:44:02,563 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 17:44:02,563 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 299.0%
2022-04-27 17:44:17,608 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.719, Acc: 0.748, Base Lr: 4.04e-03
2022-04-27 17:44:31,472 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.672, Acc: 0.754, Base Lr: 4.04e-03
2022-04-27 17:44:42,068 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.144[s] Speed: 110.8[samples/s]
2022-04-27 17:45:04,650 reid_baseline.train INFO: normal accuracy 0.6518335393489906 2.6386497020721436 
2022-04-27 17:45:05,400 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 17:45:05,401 reid_baseline.train INFO: Accuracy: 65.2% Mean Entropy: 263.9%
2022-04-27 17:45:20,777 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.457, Acc: 0.806, Base Lr: 4.83e-03
2022-04-27 17:45:34,607 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.434, Acc: 0.811, Base Lr: 4.83e-03
2022-04-27 17:45:44,659 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.144[s] Speed: 111.3[samples/s]
2022-04-27 17:46:07,543 reid_baseline.train INFO: normal accuracy 0.672847136382365 2.405766487121582 
2022-04-27 17:46:08,355 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 17:46:08,355 reid_baseline.train INFO: Accuracy: 67.3% Mean Entropy: 240.6%
2022-04-27 17:46:23,564 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.308, Acc: 0.848, Base Lr: 5.62e-03
2022-04-27 17:46:37,190 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.307, Acc: 0.843, Base Lr: 5.62e-03
2022-04-27 17:46:47,333 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.142[s] Speed: 112.5[samples/s]
2022-04-27 17:47:10,134 reid_baseline.train INFO: normal accuracy 0.665430572723527 2.1921980381011963 
2022-04-27 17:47:10,929 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 17:47:10,929 reid_baseline.train INFO: Accuracy: 66.5% Mean Entropy: 219.2%
2022-04-27 17:47:26,103 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.244, Acc: 0.864, Base Lr: 6.42e-03
2022-04-27 17:47:40,395 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.231, Acc: 0.867, Base Lr: 6.42e-03
2022-04-27 17:47:50,714 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.145[s] Speed: 110.3[samples/s]
2022-04-27 17:48:13,325 reid_baseline.train INFO: normal accuracy 0.681087762669963 2.0547046661376953 
2022-04-27 17:48:14,144 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 17:48:14,145 reid_baseline.train INFO: Accuracy: 68.1% Mean Entropy: 205.5%
2022-04-27 17:48:29,401 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.143, Acc: 0.892, Base Lr: 7.21e-03
2022-04-27 17:48:43,014 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.145, Acc: 0.890, Base Lr: 7.21e-03
2022-04-27 17:48:53,160 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.143[s] Speed: 112.2[samples/s]
2022-04-27 17:49:15,967 reid_baseline.train INFO: normal accuracy 0.6897404202719407 2.013310432434082 
2022-04-27 17:49:16,814 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 17:49:16,814 reid_baseline.train INFO: Accuracy: 69.0% Mean Entropy: 201.3%
2022-04-27 17:49:32,037 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.049, Acc: 0.924, Base Lr: 4.01e-03
2022-04-27 17:49:45,625 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.061, Acc: 0.917, Base Lr: 4.01e-03
2022-04-27 17:49:55,765 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.143[s] Speed: 112.2[samples/s]
2022-04-27 17:50:19,068 reid_baseline.train INFO: normal accuracy 0.6905644829007005 1.8805201053619385 
2022-04-27 17:50:19,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 17:50:19,933 reid_baseline.train INFO: Accuracy: 69.1% Mean Entropy: 188.1%
2022-04-27 17:50:34,658 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.035, Acc: 0.922, Base Lr: 3.38e-03
2022-04-27 17:50:49,378 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.030, Acc: 0.925, Base Lr: 3.38e-03
2022-04-27 17:50:59,651 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.145[s] Speed: 110.1[samples/s]
2022-04-27 17:51:22,419 reid_baseline.train INFO: normal accuracy 0.7004532344458179 1.9623268842697144 
2022-04-27 17:51:22,420 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 17:51:22,420 reid_baseline.train INFO: Accuracy: 70.0% Mean Entropy: 196.2%
2022-04-27 17:51:38,464 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 0.989, Acc: 0.941, Base Lr: 2.77e-03
2022-04-27 17:51:52,044 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.007, Acc: 0.936, Base Lr: 2.77e-03
2022-04-27 17:52:02,090 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.145[s] Speed: 110.3[samples/s]
2022-04-27 17:52:25,381 reid_baseline.train INFO: normal accuracy 0.6983930778739185 1.952623963356018 
2022-04-27 17:52:25,381 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 17:52:25,381 reid_baseline.train INFO: Accuracy: 69.8% Mean Entropy: 195.3%
2022-04-27 17:52:40,640 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.986, Acc: 0.934, Base Lr: 2.20e-03
2022-04-27 17:52:54,026 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.983, Acc: 0.941, Base Lr: 2.20e-03
2022-04-27 17:53:04,344 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.143[s] Speed: 112.2[samples/s]
2022-04-27 17:53:27,006 reid_baseline.train INFO: normal accuracy 0.7008652657601978 1.902014136314392 
2022-04-27 17:53:27,006 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 17:53:27,006 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 190.2%
2022-04-27 17:53:42,046 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.972, Acc: 0.949, Base Lr: 1.66e-03
2022-04-27 17:53:56,311 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.971, Acc: 0.944, Base Lr: 1.66e-03
2022-04-27 17:54:06,354 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.144[s] Speed: 111.1[samples/s]
2022-04-27 17:54:29,202 reid_baseline.train INFO: normal accuracy 0.6975690152451587 1.9390980005264282 
2022-04-27 17:54:29,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 17:54:29,202 reid_baseline.train INFO: Accuracy: 69.8% Mean Entropy: 193.9%
2022-04-27 17:54:44,456 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.958, Acc: 0.950, Base Lr: 1.19e-03
2022-04-27 17:54:57,983 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.957, Acc: 0.952, Base Lr: 1.19e-03
2022-04-27 17:55:08,074 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.142[s] Speed: 112.7[samples/s]
2022-04-27 17:55:30,434 reid_baseline.train INFO: normal accuracy 0.7091058920477956 1.883791446685791 
2022-04-27 17:55:30,434 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 17:55:30,434 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 188.4%
2022-04-27 17:55:45,104 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.963, Acc: 0.948, Base Lr: 7.78e-04
2022-04-27 17:55:59,244 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.957, Acc: 0.953, Base Lr: 7.78e-04
2022-04-27 17:56:09,963 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.144[s] Speed: 111.3[samples/s]
2022-04-27 17:56:35,611 reid_baseline.train INFO: normal accuracy 0.7062216728471363 1.9238415956497192 
2022-04-27 17:56:35,614 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 17:56:35,614 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 192.4%
2022-04-27 17:57:07,541 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.947, Acc: 0.953, Base Lr: 4.51e-04
2022-04-27 17:57:29,042 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.952, Acc: 0.951, Base Lr: 4.51e-04
2022-04-27 17:57:39,494 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.234[s] Speed: 68.4[samples/s]
2022-04-27 17:58:01,741 reid_baseline.train INFO: normal accuracy 0.7041615162752369 1.869701862335205 
2022-04-27 17:58:02,536 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 17:58:02,536 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 187.0%
2022-04-27 17:58:18,418 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.943, Acc: 0.954, Base Lr: 2.11e-04
2022-04-27 17:58:31,953 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.942, Acc: 0.955, Base Lr: 2.11e-04
2022-04-27 17:58:42,001 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.144[s] Speed: 110.9[samples/s]
2022-04-27 17:59:04,485 reid_baseline.train INFO: normal accuracy 0.7070457354758962 1.9078015089035034 
2022-04-27 17:59:04,485 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 17:59:04,485 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 190.8%
2022-04-27 17:59:19,910 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.938, Acc: 0.957, Base Lr: 6.51e-05
2022-04-27 17:59:33,583 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.941, Acc: 0.959, Base Lr: 6.51e-05
2022-04-27 17:59:43,320 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.141[s] Speed: 113.1[samples/s]
2022-04-27 18:00:08,507 reid_baseline.train INFO: normal accuracy 0.7045735475896168 1.877255916595459 
2022-04-27 18:00:08,508 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 18:00:08,508 reid_baseline.train INFO: Accuracy: 70.5% Mean Entropy: 187.7%
2022-04-27 18:00:31,552 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.940, Acc: 0.956, Base Lr: 1.60e-05
2022-04-27 18:00:59,507 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.942, Acc: 0.955, Base Lr: 1.60e-05
2022-04-27 18:01:17,839 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.253[s] Speed: 63.1[samples/s]
2022-04-27 18:01:40,578 reid_baseline.train INFO: normal accuracy 0.7066337041615163 1.9531750679016113 
2022-04-27 18:01:40,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 18:01:40,578 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 195.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_2/transformer_best_model.pth
2022-04-27 18:02:03,799 reid_baseline.train INFO: normal accuracy 0.7041615162752369 1.869701862335205 
2022-04-27 18:02:03,799 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:02:03,800 reid_baseline.train INFO: Accuracy: 70.4%
2022-04-27 18:02:25,837 reid_baseline.train INFO: normal accuracy 0.7041615162752369 1.869701862335205 
2022-04-27 18:02:25,837 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:02:25,837 reid_baseline.train INFO: Shuffled Accuracy: 70.4%
2022-04-27 18:02:48,525 reid_baseline.train INFO: normal accuracy 0.9638029782359679 0.816101610660553 
2022-04-27 18:02:48,525 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:02:48,525 reid_baseline.train INFO: Source Clean Accuracy: 96.4%
2022-04-27 18:02:53,573 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_2
2022-04-27 18:02:53,573 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-27 18:02:53,573 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 18:02:53,573 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 18:02:53,573 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 18:03:05,847 reid_baseline.train INFO: start training
2022-04-27 18:03:28,794 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.145, Acc: 0.134, Base Lr: 8.72e-04
2022-04-27 18:03:54,632 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.098, Acc: 0.227, Base Lr: 8.72e-04
2022-04-27 18:04:11,737 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.240[s] Speed: 66.8[samples/s]
2022-04-27 18:04:35,985 reid_baseline.train INFO: normal accuracy 0.3856724487497184 4.16577672958374 
2022-04-27 18:04:36,713 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 18:04:36,713 reid_baseline.train INFO: Accuracy: 38.6% Mean Entropy: 416.6%
2022-04-27 18:04:51,871 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.695, Acc: 0.481, Base Lr: 1.66e-03
2022-04-27 18:05:05,618 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.543, Acc: 0.484, Base Lr: 1.66e-03
2022-04-27 18:05:15,890 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.143[s] Speed: 111.9[samples/s]
2022-04-27 18:05:38,097 reid_baseline.train INFO: normal accuracy 0.5059698130209507 3.956735610961914 
2022-04-27 18:05:38,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 18:05:38,904 reid_baseline.train INFO: Accuracy: 50.6% Mean Entropy: 395.7%
2022-04-27 18:05:54,486 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.798, Acc: 0.548, Base Lr: 2.46e-03
2022-04-27 18:06:08,167 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.657, Acc: 0.565, Base Lr: 2.46e-03
2022-04-27 18:06:18,377 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.144[s] Speed: 110.8[samples/s]
2022-04-27 18:06:41,882 reid_baseline.train INFO: normal accuracy 0.5861680558684388 3.352409839630127 
2022-04-27 18:06:42,743 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 18:06:42,744 reid_baseline.train INFO: Accuracy: 58.6% Mean Entropy: 335.2%
2022-04-27 18:07:05,648 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.106, Acc: 0.666, Base Lr: 3.25e-03
2022-04-27 18:07:29,588 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.030, Acc: 0.673, Base Lr: 3.25e-03
2022-04-27 18:07:49,655 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.245[s] Speed: 65.3[samples/s]
2022-04-27 18:08:12,754 reid_baseline.train INFO: normal accuracy 0.6476683937823834 2.7202768325805664 
2022-04-27 18:08:13,581 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 18:08:13,582 reid_baseline.train INFO: Accuracy: 64.8% Mean Entropy: 272.0%
2022-04-27 18:08:29,608 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.719, Acc: 0.748, Base Lr: 4.04e-03
2022-04-27 18:08:43,653 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.672, Acc: 0.754, Base Lr: 4.04e-03
2022-04-27 18:08:54,054 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.147[s] Speed: 109.0[samples/s]
2022-04-27 18:09:17,712 reid_baseline.train INFO: normal accuracy 0.6852894796125254 2.3539047241210938 
2022-04-27 18:09:18,487 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 18:09:18,487 reid_baseline.train INFO: Accuracy: 68.5% Mean Entropy: 235.4%
2022-04-27 18:09:45,504 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.457, Acc: 0.806, Base Lr: 4.83e-03
2022-04-27 18:10:12,507 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.434, Acc: 0.811, Base Lr: 4.83e-03
2022-04-27 18:10:27,298 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.251[s] Speed: 63.6[samples/s]
2022-04-27 18:10:50,271 reid_baseline.train INFO: normal accuracy 0.7037621085830142 2.14599609375 
2022-04-27 18:10:51,087 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 18:10:51,087 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 214.6%
2022-04-27 18:11:06,838 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.308, Acc: 0.848, Base Lr: 5.62e-03
2022-04-27 18:11:20,282 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.307, Acc: 0.843, Base Lr: 5.62e-03
2022-04-27 18:11:30,161 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.143[s] Speed: 112.0[samples/s]
2022-04-27 18:11:53,250 reid_baseline.train INFO: normal accuracy 0.7143500788465871 1.9725202322006226 
2022-04-27 18:11:54,057 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 18:11:54,057 reid_baseline.train INFO: Accuracy: 71.4% Mean Entropy: 197.3%
2022-04-27 18:12:09,459 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.244, Acc: 0.864, Base Lr: 6.42e-03
2022-04-27 18:12:23,286 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.231, Acc: 0.867, Base Lr: 6.42e-03
2022-04-27 18:12:33,547 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.144[s] Speed: 111.1[samples/s]
2022-04-27 18:12:55,944 reid_baseline.train INFO: normal accuracy 0.7240369452579409 1.8376761674880981 
2022-04-27 18:12:56,723 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 18:12:56,724 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 183.8%
2022-04-27 18:13:11,651 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.143, Acc: 0.892, Base Lr: 7.21e-03
2022-04-27 18:13:24,924 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.145, Acc: 0.890, Base Lr: 7.21e-03
2022-04-27 18:13:35,605 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.142[s] Speed: 112.4[samples/s]
2022-04-27 18:13:58,812 reid_baseline.train INFO: normal accuracy 0.728317188555981 1.8185802698135376 
2022-04-27 18:13:59,772 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 18:13:59,773 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 181.9%
2022-04-27 18:14:23,717 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.049, Acc: 0.924, Base Lr: 4.01e-03
2022-04-27 18:14:51,146 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.061, Acc: 0.917, Base Lr: 4.01e-03
2022-04-27 18:15:09,632 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.256[s] Speed: 62.6[samples/s]
2022-04-27 18:15:31,987 reid_baseline.train INFO: normal accuracy 0.7456634377111963 1.7197643518447876 
2022-04-27 18:15:32,873 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 18:15:32,873 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 172.0%
2022-04-27 18:15:48,108 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.035, Acc: 0.922, Base Lr: 3.38e-03
2022-04-27 18:16:01,854 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.030, Acc: 0.925, Base Lr: 3.38e-03
2022-04-27 18:16:12,199 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.144[s] Speed: 111.2[samples/s]
2022-04-27 18:16:34,339 reid_baseline.train INFO: normal accuracy 0.7431854021175941 1.793660283088684 
2022-04-27 18:16:34,339 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 18:16:34,339 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 179.4%
2022-04-27 18:16:50,218 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 0.989, Acc: 0.941, Base Lr: 2.77e-03
2022-04-27 18:17:03,605 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.007, Acc: 0.936, Base Lr: 2.77e-03
2022-04-27 18:17:13,773 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.143[s] Speed: 111.9[samples/s]
2022-04-27 18:17:36,349 reid_baseline.train INFO: normal accuracy 0.7472403694525794 1.7986595630645752 
2022-04-27 18:17:36,350 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 18:17:36,350 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 179.9%
2022-04-27 18:17:51,463 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.986, Acc: 0.934, Base Lr: 2.20e-03
2022-04-27 18:18:05,182 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.983, Acc: 0.941, Base Lr: 2.20e-03
2022-04-27 18:18:15,208 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.142[s] Speed: 112.7[samples/s]
2022-04-27 18:18:37,699 reid_baseline.train INFO: normal accuracy 0.7506195088984006 1.783815860748291 
2022-04-27 18:18:37,700 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 18:18:37,700 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 178.4%
2022-04-27 18:18:52,961 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.972, Acc: 0.949, Base Lr: 1.66e-03
2022-04-27 18:19:07,090 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.971, Acc: 0.944, Base Lr: 1.66e-03
2022-04-27 18:19:17,362 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.145[s] Speed: 110.3[samples/s]
2022-04-27 18:19:39,755 reid_baseline.train INFO: normal accuracy 0.7515206127506195 1.8031026124954224 
2022-04-27 18:19:39,755 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 18:19:39,756 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 180.3%
2022-04-27 18:19:54,890 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.958, Acc: 0.950, Base Lr: 1.19e-03
2022-04-27 18:20:08,466 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.957, Acc: 0.952, Base Lr: 1.19e-03
2022-04-27 18:20:18,547 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.142[s] Speed: 113.0[samples/s]
2022-04-27 18:20:41,029 reid_baseline.train INFO: normal accuracy 0.7526469925658932 1.757703185081482 
2022-04-27 18:20:41,029 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 18:20:41,029 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 175.8%
2022-04-27 18:20:56,414 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.963, Acc: 0.948, Base Lr: 7.78e-04
2022-04-27 18:21:10,450 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.957, Acc: 0.953, Base Lr: 7.78e-04
2022-04-27 18:21:20,588 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.145[s] Speed: 110.6[samples/s]
2022-04-27 18:21:43,070 reid_baseline.train INFO: normal accuracy 0.7551250281594953 1.8105058670043945 
2022-04-27 18:21:43,070 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 18:21:43,071 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 181.1%
2022-04-27 18:21:58,542 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.947, Acc: 0.953, Base Lr: 4.51e-04
2022-04-27 18:22:12,307 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.952, Acc: 0.951, Base Lr: 4.51e-04
2022-04-27 18:22:22,307 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.143[s] Speed: 111.8[samples/s]
2022-04-27 18:22:44,314 reid_baseline.train INFO: normal accuracy 0.7546744762333859 1.7503801584243774 
2022-04-27 18:22:44,314 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 18:22:44,314 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 175.0%
2022-04-27 18:22:59,700 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.943, Acc: 0.954, Base Lr: 2.11e-04
2022-04-27 18:23:13,446 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.942, Acc: 0.955, Base Lr: 2.11e-04
2022-04-27 18:23:23,475 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.143[s] Speed: 111.6[samples/s]
2022-04-27 18:23:46,031 reid_baseline.train INFO: normal accuracy 0.7555755800856049 1.7947776317596436 
2022-04-27 18:23:46,031 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 18:23:46,031 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 179.5%
2022-04-27 18:24:01,885 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.938, Acc: 0.957, Base Lr: 6.51e-05
2022-04-27 18:24:15,258 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.941, Acc: 0.959, Base Lr: 6.51e-05
2022-04-27 18:24:25,417 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.144[s] Speed: 111.1[samples/s]
2022-04-27 18:24:48,113 reid_baseline.train INFO: normal accuracy 0.7560261320117143 1.761305809020996 
2022-04-27 18:24:48,113 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 18:24:48,114 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 176.1%
2022-04-27 18:25:03,655 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.940, Acc: 0.956, Base Lr: 1.60e-05
2022-04-27 18:25:17,264 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.942, Acc: 0.955, Base Lr: 1.60e-05
2022-04-27 18:25:27,340 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.143[s] Speed: 112.2[samples/s]
2022-04-27 18:25:49,687 reid_baseline.train INFO: normal accuracy 0.7560261320117143 1.8324923515319824 
2022-04-27 18:25:49,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 18:25:49,687 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 183.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_2/transformer_best_model.pth
2022-04-27 18:26:12,636 reid_baseline.train INFO: normal accuracy 0.7456634377111963 1.7197643518447876 
2022-04-27 18:26:12,637 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:26:12,637 reid_baseline.train INFO: Accuracy: 74.6%
2022-04-27 18:26:35,517 reid_baseline.train INFO: normal accuracy 0.7456634377111963 1.7197643518447876 
2022-04-27 18:26:35,517 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:26:35,517 reid_baseline.train INFO: Shuffled Accuracy: 74.6%
2022-04-27 18:26:58,575 reid_baseline.train INFO: normal accuracy 0.9434135166093929 0.8685184717178345 
2022-04-27 18:26:58,575 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 18:26:58,575 reid_baseline.train INFO: Source Clean Accuracy: 94.3%
2022-04-27 18:27:03,303 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_2
2022-04-27 18:27:03,303 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-27 18:27:03,303 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 18:27:03,303 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 18:27:03,303 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 18:27:15,032 reid_baseline.train INFO: start training
2022-04-27 18:27:31,445 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.145, Acc: 0.134, Base Lr: 8.72e-04
2022-04-27 18:27:45,155 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.098, Acc: 0.227, Base Lr: 8.72e-04
2022-04-27 18:27:55,635 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.148[s] Speed: 108.3[samples/s]
2022-04-27 18:29:21,882 reid_baseline.train INFO: normal accuracy 0.3741106265779206 4.165884971618652 
2022-04-27 18:29:22,617 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 18:29:22,617 reid_baseline.train INFO: Accuracy: 37.4% Mean Entropy: 416.6%
2022-04-27 18:29:37,845 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.695, Acc: 0.481, Base Lr: 1.66e-03
2022-04-27 18:29:50,961 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.543, Acc: 0.484, Base Lr: 1.66e-03
2022-04-27 18:30:01,066 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.140[s] Speed: 113.9[samples/s]
2022-04-27 18:31:29,241 reid_baseline.train INFO: normal accuracy 0.489557034656874 3.968569278717041 
2022-04-27 18:31:30,017 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 18:31:30,017 reid_baseline.train INFO: Accuracy: 49.0% Mean Entropy: 396.9%
2022-04-27 18:31:45,191 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.798, Acc: 0.548, Base Lr: 2.46e-03
2022-04-27 18:31:59,373 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.657, Acc: 0.565, Base Lr: 2.46e-03
2022-04-27 18:32:09,120 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.143[s] Speed: 111.8[samples/s]
2022-04-27 18:33:35,674 reid_baseline.train INFO: normal accuracy 0.5985770025246729 3.3572471141815186 
2022-04-27 18:33:36,467 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 18:33:36,468 reid_baseline.train INFO: Accuracy: 59.9% Mean Entropy: 335.7%
2022-04-27 18:33:51,583 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.106, Acc: 0.666, Base Lr: 3.25e-03
2022-04-27 18:34:05,230 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.030, Acc: 0.673, Base Lr: 3.25e-03
2022-04-27 18:34:15,270 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.142[s] Speed: 113.0[samples/s]
2022-04-27 18:35:41,244 reid_baseline.train INFO: normal accuracy 0.6768418636676612 2.7168052196502686 
2022-04-27 18:35:42,044 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 18:35:42,045 reid_baseline.train INFO: Accuracy: 67.7% Mean Entropy: 271.7%
2022-04-27 18:35:57,400 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.719, Acc: 0.748, Base Lr: 4.04e-03
2022-04-27 18:36:10,922 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.672, Acc: 0.754, Base Lr: 4.04e-03
2022-04-27 18:36:20,427 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.140[s] Speed: 114.4[samples/s]
2022-04-27 18:37:43,674 reid_baseline.train INFO: normal accuracy 0.7204498508147809 2.346526861190796 
2022-04-27 18:37:44,462 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 18:37:44,462 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 234.7%
2022-04-27 18:38:00,101 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.457, Acc: 0.806, Base Lr: 4.83e-03
2022-04-27 18:38:13,894 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.434, Acc: 0.811, Base Lr: 4.83e-03
2022-04-27 18:38:23,680 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.142[s] Speed: 112.4[samples/s]
2022-04-27 18:39:52,149 reid_baseline.train INFO: normal accuracy 0.7415652972228598 2.1286633014678955 
2022-04-27 18:39:52,973 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 18:39:52,973 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 212.9%
2022-04-27 18:40:08,369 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.308, Acc: 0.848, Base Lr: 5.62e-03
2022-04-27 18:40:22,112 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.307, Acc: 0.843, Base Lr: 5.62e-03
2022-04-27 18:40:32,371 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.144[s] Speed: 111.2[samples/s]
2022-04-27 18:41:59,025 reid_baseline.train INFO: normal accuracy 0.7512049575395915 1.9247196912765503 
2022-04-27 18:41:59,876 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 18:41:59,877 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 192.5%
2022-04-27 18:42:15,387 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.244, Acc: 0.864, Base Lr: 6.42e-03
2022-04-27 18:42:28,737 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.231, Acc: 0.867, Base Lr: 6.42e-03
2022-04-27 18:42:38,656 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.142[s] Speed: 112.9[samples/s]
2022-04-27 18:44:05,226 reid_baseline.train INFO: normal accuracy 0.7665825109019968 1.783859133720398 
2022-04-27 18:44:06,291 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 18:44:06,291 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 178.4%
2022-04-27 18:44:21,571 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.143, Acc: 0.892, Base Lr: 7.21e-03
2022-04-27 18:44:34,916 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.145, Acc: 0.890, Base Lr: 7.21e-03
2022-04-27 18:44:44,843 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.141[s] Speed: 113.5[samples/s]
2022-04-27 18:46:13,584 reid_baseline.train INFO: normal accuracy 0.7681891209547854 1.7529946565628052 
2022-04-27 18:46:14,391 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 18:46:14,391 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 175.3%
2022-04-27 18:46:29,305 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.049, Acc: 0.924, Base Lr: 4.01e-03
2022-04-27 18:46:42,980 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.061, Acc: 0.917, Base Lr: 4.01e-03
2022-04-27 18:46:53,056 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.141[s] Speed: 113.4[samples/s]
2022-04-27 18:48:18,148 reid_baseline.train INFO: normal accuracy 0.774156529722286 1.6641902923583984 
2022-04-27 18:48:19,005 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 18:48:19,006 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 166.4%
2022-04-27 18:48:34,243 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.035, Acc: 0.922, Base Lr: 3.38e-03
2022-04-27 18:48:47,373 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.030, Acc: 0.925, Base Lr: 3.38e-03
2022-04-27 18:48:57,590 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.141[s] Speed: 113.5[samples/s]
2022-04-27 18:50:22,597 reid_baseline.train INFO: normal accuracy 0.7759926554969016 1.741859793663025 
2022-04-27 18:50:22,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 18:50:22,598 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 174.2%
2022-04-27 18:50:38,453 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 0.989, Acc: 0.941, Base Lr: 2.77e-03
2022-04-27 18:50:51,851 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.007, Acc: 0.936, Base Lr: 2.77e-03
2022-04-27 18:51:01,730 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.143[s] Speed: 111.9[samples/s]
2022-04-27 18:52:26,165 reid_baseline.train INFO: normal accuracy 0.778287812715171 1.7460843324661255 
2022-04-27 18:52:26,166 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 18:52:26,166 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 174.6%
2022-04-27 18:52:41,207 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.986, Acc: 0.934, Base Lr: 2.20e-03
2022-04-27 18:52:54,714 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.983, Acc: 0.941, Base Lr: 2.20e-03
2022-04-27 18:53:04,340 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.139[s] Speed: 114.8[samples/s]
2022-04-27 18:54:31,338 reid_baseline.train INFO: normal accuracy 0.7819600642644021 1.7204622030258179 
2022-04-27 18:54:31,339 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 18:54:31,339 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 172.0%
2022-04-27 18:54:46,665 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.972, Acc: 0.949, Base Lr: 1.66e-03
2022-04-27 18:55:00,992 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.971, Acc: 0.944, Base Lr: 1.66e-03
2022-04-27 18:55:11,431 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.146[s] Speed: 109.8[samples/s]
2022-04-27 18:56:35,133 reid_baseline.train INFO: normal accuracy 0.7837961900390177 1.739277720451355 
2022-04-27 18:56:35,133 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 18:56:35,133 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 173.9%
2022-04-27 18:56:50,646 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.958, Acc: 0.950, Base Lr: 1.19e-03
2022-04-27 18:57:04,073 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.957, Acc: 0.952, Base Lr: 1.19e-03
2022-04-27 18:57:14,050 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.142[s] Speed: 113.0[samples/s]
2022-04-27 18:58:41,334 reid_baseline.train INFO: normal accuracy 0.7840257057608446 1.6952698230743408 
2022-04-27 18:58:41,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 18:58:41,335 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 169.5%
2022-04-27 18:58:56,530 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.963, Acc: 0.948, Base Lr: 7.78e-04
2022-04-27 18:59:10,526 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.957, Acc: 0.953, Base Lr: 7.78e-04
2022-04-27 18:59:20,372 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.143[s] Speed: 112.2[samples/s]
2022-04-27 19:00:46,001 reid_baseline.train INFO: normal accuracy 0.7847142529263255 1.739467978477478 
2022-04-27 19:00:46,002 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 19:00:46,002 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 173.9%
2022-04-27 19:01:01,430 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.947, Acc: 0.953, Base Lr: 4.51e-04
2022-04-27 19:01:14,828 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.952, Acc: 0.951, Base Lr: 4.51e-04
2022-04-27 19:01:25,019 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.142[s] Speed: 112.6[samples/s]
2022-04-27 19:02:50,605 reid_baseline.train INFO: normal accuracy 0.7863208629791141 1.6775625944137573 
2022-04-27 19:02:50,606 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 19:02:50,606 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.8%
2022-04-27 19:03:06,512 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.943, Acc: 0.954, Base Lr: 2.11e-04
2022-04-27 19:03:19,623 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.942, Acc: 0.955, Base Lr: 2.11e-04
2022-04-27 19:03:29,278 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.140[s] Speed: 114.1[samples/s]
2022-04-27 19:04:55,295 reid_baseline.train INFO: normal accuracy 0.7849437686481524 1.7265647649765015 
2022-04-27 19:04:55,296 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 19:04:55,296 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 172.7%
2022-04-27 19:05:10,832 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.938, Acc: 0.957, Base Lr: 6.51e-05
2022-04-27 19:05:24,523 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.941, Acc: 0.959, Base Lr: 6.51e-05
2022-04-27 19:05:34,358 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.143[s] Speed: 112.2[samples/s]
2022-04-27 19:07:00,589 reid_baseline.train INFO: normal accuracy 0.7842552214826716 1.6929386854171753 
2022-04-27 19:07:00,590 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 19:07:00,590 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 169.3%
2022-04-27 19:07:15,667 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.940, Acc: 0.956, Base Lr: 1.60e-05
2022-04-27 19:07:28,980 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.942, Acc: 0.955, Base Lr: 1.60e-05
2022-04-27 19:07:39,171 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.141[s] Speed: 113.5[samples/s]
2022-04-27 19:09:04,663 reid_baseline.train INFO: normal accuracy 0.7847142529263255 1.766585350036621 
2022-04-27 19:09:04,663 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 19:09:04,663 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 176.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_2/transformer_best_model.pth
2022-04-27 19:10:35,959 reid_baseline.train INFO: normal accuracy 0.774156529722286 1.6641902923583984 
2022-04-27 19:10:35,959 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:10:35,959 reid_baseline.train INFO: Accuracy: 77.4%
2022-04-27 19:12:01,352 reid_baseline.train INFO: normal accuracy 0.774156529722286 1.6641902923583984 
2022-04-27 19:12:01,352 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:12:01,353 reid_baseline.train INFO: Shuffled Accuracy: 77.4%
2022-04-27 19:12:24,256 reid_baseline.train INFO: normal accuracy 0.9434135166093929 0.8685184717178345 
2022-04-27 19:12:24,257 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:12:24,257 reid_baseline.train INFO: Source Clean Accuracy: 94.3%
2022-04-27 19:12:29,370 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_11
2022-04-27 19:12:29,371 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=11)
2022-04-27 19:12:29,371 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 19:12:29,371 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 19:12:29,371 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 19:12:40,146 reid_baseline.train INFO: start training
2022-04-27 19:12:56,512 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.144, Acc: 0.126, Base Lr: 8.72e-04
2022-04-27 19:13:10,512 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.094, Acc: 0.226, Base Lr: 8.72e-04
2022-04-27 19:13:21,606 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.151[s] Speed: 106.2[samples/s]
2022-04-27 19:13:44,041 reid_baseline.train INFO: normal accuracy 0.25010300782859496 4.166801929473877 
2022-04-27 19:13:44,799 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 19:13:44,800 reid_baseline.train INFO: Accuracy: 25.0% Mean Entropy: 416.7%
2022-04-27 19:13:59,872 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.684, Acc: 0.442, Base Lr: 1.66e-03
2022-04-27 19:14:13,630 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.538, Acc: 0.449, Base Lr: 1.66e-03
2022-04-27 19:14:23,760 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.143[s] Speed: 112.2[samples/s]
2022-04-27 19:14:45,358 reid_baseline.train INFO: normal accuracy 0.3700041203131438 4.045525074005127 
2022-04-27 19:14:46,099 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 19:14:46,099 reid_baseline.train INFO: Accuracy: 37.0% Mean Entropy: 404.6%
2022-04-27 19:15:01,255 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.818, Acc: 0.542, Base Lr: 2.46e-03
2022-04-27 19:15:15,283 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.680, Acc: 0.558, Base Lr: 2.46e-03
2022-04-27 19:15:25,244 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.143[s] Speed: 111.6[samples/s]
2022-04-27 19:15:47,924 reid_baseline.train INFO: normal accuracy 0.5105067985166872 3.6610374450683594 
2022-04-27 19:15:48,704 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 19:15:48,704 reid_baseline.train INFO: Accuracy: 51.1% Mean Entropy: 366.1%
2022-04-27 19:16:03,762 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.152, Acc: 0.649, Base Lr: 3.25e-03
2022-04-27 19:16:17,425 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.069, Acc: 0.663, Base Lr: 3.25e-03
2022-04-27 19:16:27,431 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.142[s] Speed: 112.8[samples/s]
2022-04-27 19:16:49,047 reid_baseline.train INFO: normal accuracy 0.5929130613926659 3.195025682449341 
2022-04-27 19:16:49,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 19:16:49,853 reid_baseline.train INFO: Accuracy: 59.3% Mean Entropy: 319.5%
2022-04-27 19:17:05,624 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.758, Acc: 0.738, Base Lr: 4.04e-03
2022-04-27 19:17:19,318 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.704, Acc: 0.748, Base Lr: 4.04e-03
2022-04-27 19:17:29,186 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.144[s] Speed: 111.1[samples/s]
2022-04-27 19:17:51,605 reid_baseline.train INFO: normal accuracy 0.6353522867737948 2.840735673904419 
2022-04-27 19:17:52,407 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 19:17:52,407 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 284.1%
2022-04-27 19:18:07,508 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.491, Acc: 0.796, Base Lr: 4.83e-03
2022-04-27 19:18:20,814 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.457, Acc: 0.812, Base Lr: 4.83e-03
2022-04-27 19:18:30,476 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.139[s] Speed: 114.8[samples/s]
2022-04-27 19:18:53,940 reid_baseline.train INFO: normal accuracy 0.6761433868974042 2.606454849243164 
2022-04-27 19:18:54,705 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 19:18:54,706 reid_baseline.train INFO: Accuracy: 67.6% Mean Entropy: 260.6%
2022-04-27 19:19:10,153 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.328, Acc: 0.842, Base Lr: 5.62e-03
2022-04-27 19:19:23,841 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.328, Acc: 0.844, Base Lr: 5.62e-03
2022-04-27 19:19:33,940 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.142[s] Speed: 112.3[samples/s]
2022-04-27 19:19:56,907 reid_baseline.train INFO: normal accuracy 0.6674907292954264 2.3792943954467773 
2022-04-27 19:19:57,748 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 19:19:57,749 reid_baseline.train INFO: Accuracy: 66.7% Mean Entropy: 237.9%
2022-04-27 19:20:12,989 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.271, Acc: 0.864, Base Lr: 6.42e-03
2022-04-27 19:20:26,437 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.253, Acc: 0.867, Base Lr: 6.42e-03
2022-04-27 19:20:36,791 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.142[s] Speed: 112.4[samples/s]
2022-04-27 19:20:58,883 reid_baseline.train INFO: normal accuracy 0.6864441697569015 2.2687716484069824 
2022-04-27 19:20:59,680 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 19:20:59,680 reid_baseline.train INFO: Accuracy: 68.6% Mean Entropy: 226.9%
2022-04-27 19:21:15,395 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.152, Acc: 0.898, Base Lr: 7.21e-03
2022-04-27 19:21:29,244 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.158, Acc: 0.892, Base Lr: 7.21e-03
2022-04-27 19:21:39,490 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.146[s] Speed: 109.9[samples/s]
2022-04-27 19:22:01,794 reid_baseline.train INFO: normal accuracy 0.6831479192418624 2.2133681774139404 
2022-04-27 19:22:02,588 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 19:22:02,588 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 221.3%
2022-04-27 19:22:17,222 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.063, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 19:22:31,399 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.072, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 19:22:41,316 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.141[s] Speed: 113.4[samples/s]
2022-04-27 19:23:04,499 reid_baseline.train INFO: normal accuracy 0.6971569839307787 2.0544774532318115 
2022-04-27 19:23:05,324 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 19:23:05,324 reid_baseline.train INFO: Accuracy: 69.7% Mean Entropy: 205.4%
2022-04-27 19:23:20,346 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.045, Acc: 0.926, Base Lr: 3.38e-03
2022-04-27 19:23:33,941 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.040, Acc: 0.927, Base Lr: 3.38e-03
2022-04-27 19:23:44,232 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.142[s] Speed: 112.3[samples/s]
2022-04-27 19:24:06,027 reid_baseline.train INFO: normal accuracy 0.6971569839307787 2.1734817028045654 
2022-04-27 19:24:06,027 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 19:24:06,027 reid_baseline.train INFO: Accuracy: 69.7% Mean Entropy: 217.3%
2022-04-27 19:24:22,123 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 0.997, Acc: 0.946, Base Lr: 2.77e-03
2022-04-27 19:24:35,501 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.010, Acc: 0.936, Base Lr: 2.77e-03
2022-04-27 19:24:45,444 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.144[s] Speed: 111.1[samples/s]
2022-04-27 19:25:08,601 reid_baseline.train INFO: normal accuracy 0.6983930778739185 2.1222190856933594 
2022-04-27 19:25:08,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 19:25:08,602 reid_baseline.train INFO: Accuracy: 69.8% Mean Entropy: 212.2%
2022-04-27 19:25:23,922 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.997, Acc: 0.939, Base Lr: 2.20e-03
2022-04-27 19:25:37,589 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.995, Acc: 0.944, Base Lr: 2.20e-03
2022-04-27 19:25:47,400 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.142[s] Speed: 112.6[samples/s]
2022-04-27 19:26:10,216 reid_baseline.train INFO: normal accuracy 0.6983930778739185 2.073833703994751 
2022-04-27 19:26:10,216 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 19:26:10,216 reid_baseline.train INFO: Accuracy: 69.8% Mean Entropy: 207.4%
2022-04-27 19:26:25,468 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.989, Acc: 0.948, Base Lr: 1.66e-03
2022-04-27 19:26:39,047 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.984, Acc: 0.949, Base Lr: 1.66e-03
2022-04-27 19:26:49,087 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.141[s] Speed: 113.3[samples/s]
2022-04-27 19:27:12,945 reid_baseline.train INFO: normal accuracy 0.6950968273588792 2.142385721206665 
2022-04-27 19:27:12,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 19:27:12,946 reid_baseline.train INFO: Accuracy: 69.5% Mean Entropy: 214.2%
2022-04-27 19:27:28,194 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.968, Acc: 0.952, Base Lr: 1.19e-03
2022-04-27 19:27:41,414 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.969, Acc: 0.952, Base Lr: 1.19e-03
2022-04-27 19:27:51,525 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.141[s] Speed: 113.7[samples/s]
2022-04-27 19:28:14,279 reid_baseline.train INFO: normal accuracy 0.7025133910177174 2.0596330165863037 
2022-04-27 19:28:14,280 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 19:28:14,280 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 206.0%
2022-04-27 19:28:29,547 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.977, Acc: 0.943, Base Lr: 7.78e-04
2022-04-27 19:28:43,215 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.967, Acc: 0.952, Base Lr: 7.78e-04
2022-04-27 19:28:53,202 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.142[s] Speed: 112.7[samples/s]
2022-04-27 19:29:17,171 reid_baseline.train INFO: normal accuracy 0.7029254223320972 2.118873357772827 
2022-04-27 19:29:17,171 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 19:29:17,171 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 211.9%
2022-04-27 19:29:32,108 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.955, Acc: 0.957, Base Lr: 4.51e-04
2022-04-27 19:29:46,807 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.959, Acc: 0.952, Base Lr: 4.51e-04
2022-04-27 19:29:57,126 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.146[s] Speed: 109.3[samples/s]
2022-04-27 19:30:19,753 reid_baseline.train INFO: normal accuracy 0.7004532344458179 2.0565624237060547 
2022-04-27 19:30:19,753 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 19:30:19,753 reid_baseline.train INFO: Accuracy: 70.0% Mean Entropy: 205.7%
2022-04-27 19:30:35,069 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.948, Acc: 0.956, Base Lr: 2.11e-04
2022-04-27 19:30:48,879 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.949, Acc: 0.957, Base Lr: 2.11e-04
2022-04-27 19:30:59,031 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.144[s] Speed: 111.4[samples/s]
2022-04-27 19:31:20,920 reid_baseline.train INFO: normal accuracy 0.7008652657601978 2.1102828979492188 
2022-04-27 19:31:20,920 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 19:31:20,920 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 211.0%
2022-04-27 19:31:36,742 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.942, Acc: 0.962, Base Lr: 6.51e-05
2022-04-27 19:31:50,580 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.948, Acc: 0.961, Base Lr: 6.51e-05
2022-04-27 19:32:00,548 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.145[s] Speed: 110.4[samples/s]
2022-04-27 19:32:23,613 reid_baseline.train INFO: normal accuracy 0.7029254223320972 2.0582919120788574 
2022-04-27 19:32:23,613 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 19:32:23,613 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 205.8%
2022-04-27 19:32:38,707 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.942, Acc: 0.954, Base Lr: 1.60e-05
2022-04-27 19:32:52,435 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.946, Acc: 0.957, Base Lr: 1.60e-05
2022-04-27 19:33:02,519 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.142[s] Speed: 112.3[samples/s]
2022-04-27 19:33:25,207 reid_baseline.train INFO: normal accuracy 0.703749484960857 2.1479668617248535 
2022-04-27 19:33:25,207 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 19:33:25,208 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 214.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_11/transformer_best_model.pth
2022-04-27 19:33:48,440 reid_baseline.train INFO: normal accuracy 0.6971569839307787 2.0544774532318115 
2022-04-27 19:33:48,441 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:33:48,441 reid_baseline.train INFO: Accuracy: 69.7%
2022-04-27 19:34:11,130 reid_baseline.train INFO: normal accuracy 0.6971569839307787 2.0544774532318115 
2022-04-27 19:34:11,130 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:34:11,131 reid_baseline.train INFO: Shuffled Accuracy: 69.7%
2022-04-27 19:34:33,489 reid_baseline.train INFO: normal accuracy 0.9399770904925544 0.9723746180534363 
2022-04-27 19:34:33,489 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:34:33,490 reid_baseline.train INFO: Source Clean Accuracy: 94.0%
2022-04-27 19:34:38,177 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_11
2022-04-27 19:34:38,177 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=11)
2022-04-27 19:34:38,177 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 19:34:38,177 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 19:34:38,178 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 19:34:50,466 reid_baseline.train INFO: start training
2022-04-27 19:35:07,187 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.144, Acc: 0.126, Base Lr: 8.72e-04
2022-04-27 19:35:21,085 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.094, Acc: 0.226, Base Lr: 8.72e-04
2022-04-27 19:35:31,436 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.148[s] Speed: 108.0[samples/s]
2022-04-27 19:35:54,479 reid_baseline.train INFO: normal accuracy 0.3322820455057445 4.166110515594482 
2022-04-27 19:35:55,225 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 19:35:55,225 reid_baseline.train INFO: Accuracy: 33.2% Mean Entropy: 416.6%
2022-04-27 19:36:10,553 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.684, Acc: 0.442, Base Lr: 1.66e-03
2022-04-27 19:36:24,140 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.538, Acc: 0.449, Base Lr: 1.66e-03
2022-04-27 19:36:34,019 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.142[s] Speed: 112.8[samples/s]
2022-04-27 19:36:55,920 reid_baseline.train INFO: normal accuracy 0.4789366974543816 3.9892051219940186 
2022-04-27 19:36:56,747 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 19:36:56,747 reid_baseline.train INFO: Accuracy: 47.9% Mean Entropy: 398.9%
2022-04-27 19:37:12,486 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.818, Acc: 0.542, Base Lr: 2.46e-03
2022-04-27 19:37:26,075 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.680, Acc: 0.558, Base Lr: 2.46e-03
2022-04-27 19:37:36,000 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.143[s] Speed: 111.7[samples/s]
2022-04-27 19:37:58,312 reid_baseline.train INFO: normal accuracy 0.5722009461590448 3.467747926712036 
2022-04-27 19:37:59,109 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 19:37:59,109 reid_baseline.train INFO: Accuracy: 57.2% Mean Entropy: 346.8%
2022-04-27 19:38:14,420 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.152, Acc: 0.649, Base Lr: 3.25e-03
2022-04-27 19:38:28,065 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.069, Acc: 0.663, Base Lr: 3.25e-03
2022-04-27 19:38:38,055 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.142[s] Speed: 112.3[samples/s]
2022-04-27 19:39:00,666 reid_baseline.train INFO: normal accuracy 0.6355034917774274 2.9251656532287598 
2022-04-27 19:39:01,507 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 19:39:01,507 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 292.5%
2022-04-27 19:39:16,602 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.758, Acc: 0.738, Base Lr: 4.04e-03
2022-04-27 19:39:30,099 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.704, Acc: 0.748, Base Lr: 4.04e-03
2022-04-27 19:39:40,198 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.141[s] Speed: 113.1[samples/s]
2022-04-27 19:40:02,673 reid_baseline.train INFO: normal accuracy 0.6776300968686642 2.5844309329986572 
2022-04-27 19:40:03,468 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 19:40:03,468 reid_baseline.train INFO: Accuracy: 67.8% Mean Entropy: 258.4%
2022-04-27 19:40:18,545 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.491, Acc: 0.796, Base Lr: 4.83e-03
2022-04-27 19:40:31,852 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.457, Acc: 0.812, Base Lr: 4.83e-03
2022-04-27 19:40:42,144 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.141[s] Speed: 113.3[samples/s]
2022-04-27 19:41:04,543 reid_baseline.train INFO: normal accuracy 0.697003829691372 2.3695616722106934 
2022-04-27 19:41:05,329 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 19:41:05,329 reid_baseline.train INFO: Accuracy: 69.7% Mean Entropy: 237.0%
2022-04-27 19:41:20,485 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.328, Acc: 0.842, Base Lr: 5.62e-03
2022-04-27 19:41:34,140 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.328, Acc: 0.844, Base Lr: 5.62e-03
2022-04-27 19:41:44,093 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.142[s] Speed: 112.9[samples/s]
2022-04-27 19:42:06,631 reid_baseline.train INFO: normal accuracy 0.7136742509574229 2.1518890857696533 
2022-04-27 19:42:07,400 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 19:42:07,401 reid_baseline.train INFO: Accuracy: 71.4% Mean Entropy: 215.2%
2022-04-27 19:42:22,520 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.271, Acc: 0.864, Base Lr: 6.42e-03
2022-04-27 19:42:36,891 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.253, Acc: 0.867, Base Lr: 6.42e-03
2022-04-27 19:42:47,108 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.145[s] Speed: 110.3[samples/s]
2022-04-27 19:43:09,431 reid_baseline.train INFO: normal accuracy 0.7244874971840505 2.0435988903045654 
2022-04-27 19:43:10,261 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 19:43:10,262 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 204.4%
2022-04-27 19:43:25,630 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.152, Acc: 0.898, Base Lr: 7.21e-03
2022-04-27 19:43:39,261 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.158, Acc: 0.892, Base Lr: 7.21e-03
2022-04-27 19:43:49,356 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.143[s] Speed: 111.9[samples/s]
2022-04-27 19:44:11,375 reid_baseline.train INFO: normal accuracy 0.7298941202973642 2.0312283039093018 
2022-04-27 19:44:12,234 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 19:44:12,234 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 203.1%
2022-04-27 19:44:28,078 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.063, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 19:44:41,569 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.072, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 19:44:51,401 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.143[s] Speed: 112.0[samples/s]
2022-04-27 19:45:14,249 reid_baseline.train INFO: normal accuracy 0.7438612300067583 1.8611907958984375 
2022-04-27 19:45:15,039 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 19:45:15,039 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 186.1%
2022-04-27 19:45:30,303 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.045, Acc: 0.926, Base Lr: 3.38e-03
2022-04-27 19:45:43,892 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.040, Acc: 0.927, Base Lr: 3.38e-03
2022-04-27 19:45:53,652 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.141[s] Speed: 113.2[samples/s]
2022-04-27 19:46:16,564 reid_baseline.train INFO: normal accuracy 0.7488173011939626 1.9781711101531982 
2022-04-27 19:46:16,565 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 19:46:16,565 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 197.8%
2022-04-27 19:46:31,586 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 0.997, Acc: 0.946, Base Lr: 2.77e-03
2022-04-27 19:46:45,040 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.010, Acc: 0.936, Base Lr: 2.77e-03
2022-04-27 19:46:54,925 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.140[s] Speed: 114.0[samples/s]
2022-04-27 19:47:17,142 reid_baseline.train INFO: normal accuracy 0.7539986483442217 1.9368549585342407 
2022-04-27 19:47:17,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 19:47:17,143 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 193.7%
2022-04-27 19:47:32,623 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.997, Acc: 0.939, Base Lr: 2.20e-03
2022-04-27 19:47:45,679 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.995, Acc: 0.944, Base Lr: 2.20e-03
2022-04-27 19:47:55,815 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.141[s] Speed: 113.4[samples/s]
2022-04-27 19:48:18,696 reid_baseline.train INFO: normal accuracy 0.7560261320117143 1.9048538208007812 
2022-04-27 19:48:18,697 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 19:48:18,697 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 190.5%
2022-04-27 19:48:34,285 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.989, Acc: 0.948, Base Lr: 1.66e-03
2022-04-27 19:48:48,123 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.984, Acc: 0.949, Base Lr: 1.66e-03
2022-04-27 19:48:58,210 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.145[s] Speed: 110.6[samples/s]
2022-04-27 19:49:20,221 reid_baseline.train INFO: normal accuracy 0.7544492002703311 1.962355136871338 
2022-04-27 19:49:20,221 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 19:49:20,222 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 196.2%
2022-04-27 19:49:35,528 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.968, Acc: 0.952, Base Lr: 1.19e-03
2022-04-27 19:49:49,269 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.969, Acc: 0.952, Base Lr: 1.19e-03
2022-04-27 19:49:59,296 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.143[s] Speed: 112.0[samples/s]
2022-04-27 19:50:21,994 reid_baseline.train INFO: normal accuracy 0.7616580310880829 1.8774960041046143 
2022-04-27 19:50:21,994 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 19:50:21,995 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 187.7%
2022-04-27 19:50:37,088 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.977, Acc: 0.943, Base Lr: 7.78e-04
2022-04-27 19:50:50,606 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.967, Acc: 0.952, Base Lr: 7.78e-04
2022-04-27 19:51:00,416 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.140[s] Speed: 114.3[samples/s]
2022-04-27 19:51:22,266 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.941114902496338 
2022-04-27 19:51:22,266 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 19:51:22,267 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 194.1%
2022-04-27 19:51:38,387 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.955, Acc: 0.957, Base Lr: 4.51e-04
2022-04-27 19:51:52,019 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.959, Acc: 0.952, Base Lr: 4.51e-04
2022-04-27 19:52:02,192 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.146[s] Speed: 109.7[samples/s]
2022-04-27 19:52:24,897 reid_baseline.train INFO: normal accuracy 0.7578283397161523 1.8670545816421509 
2022-04-27 19:52:24,897 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 19:52:24,897 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 186.7%
2022-04-27 19:52:40,571 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.948, Acc: 0.956, Base Lr: 2.11e-04
2022-04-27 19:52:54,111 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.949, Acc: 0.957, Base Lr: 2.11e-04
2022-04-27 19:53:04,409 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.145[s] Speed: 110.7[samples/s]
2022-04-27 19:53:26,795 reid_baseline.train INFO: normal accuracy 0.7587294435683712 1.9295225143432617 
2022-04-27 19:53:26,796 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 19:53:26,796 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 193.0%
2022-04-27 19:53:42,042 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.942, Acc: 0.962, Base Lr: 6.51e-05
2022-04-27 19:53:56,483 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.948, Acc: 0.961, Base Lr: 6.51e-05
2022-04-27 19:54:06,589 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.145[s] Speed: 110.0[samples/s]
2022-04-27 19:54:28,849 reid_baseline.train INFO: normal accuracy 0.759855823383645 1.8683478832244873 
2022-04-27 19:54:28,849 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 19:54:28,849 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 186.8%
2022-04-27 19:54:44,542 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.942, Acc: 0.954, Base Lr: 1.60e-05
2022-04-27 19:54:58,266 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.946, Acc: 0.957, Base Lr: 1.60e-05
2022-04-27 19:55:08,308 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.144[s] Speed: 111.1[samples/s]
2022-04-27 19:55:30,722 reid_baseline.train INFO: normal accuracy 0.760756927235864 1.9568023681640625 
2022-04-27 19:55:30,723 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 19:55:30,723 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 195.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_11/transformer_best_model.pth
2022-04-27 19:55:53,849 reid_baseline.train INFO: normal accuracy 0.7438612300067583 1.8611907958984375 
2022-04-27 19:55:53,850 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:55:53,850 reid_baseline.train INFO: Accuracy: 74.4%
2022-04-27 19:56:16,768 reid_baseline.train INFO: normal accuracy 0.7438612300067583 1.8611907958984375 
2022-04-27 19:56:16,768 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:56:16,768 reid_baseline.train INFO: Shuffled Accuracy: 74.4%
2022-04-27 19:56:39,337 reid_baseline.train INFO: normal accuracy 0.9399770904925544 0.9723746180534363 
2022-04-27 19:56:39,338 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 19:56:39,338 reid_baseline.train INFO: Source Clean Accuracy: 94.0%
2022-04-27 19:56:44,624 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_11
2022-04-27 19:56:44,624 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=11)
2022-04-27 19:56:44,624 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 19:56:44,624 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 19:56:44,624 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 19:56:55,922 reid_baseline.train INFO: start training
2022-04-27 19:57:12,612 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.144, Acc: 0.126, Base Lr: 8.72e-04
2022-04-27 19:57:26,333 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.094, Acc: 0.226, Base Lr: 8.72e-04
2022-04-27 19:57:36,446 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.147[s] Speed: 108.8[samples/s]
2022-04-27 19:59:04,023 reid_baseline.train INFO: normal accuracy 0.31489557034656873 4.166086196899414 
2022-04-27 19:59:04,785 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 19:59:04,785 reid_baseline.train INFO: Accuracy: 31.5% Mean Entropy: 416.6%
2022-04-27 19:59:20,105 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.684, Acc: 0.442, Base Lr: 1.66e-03
2022-04-27 19:59:33,862 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.538, Acc: 0.449, Base Lr: 1.66e-03
2022-04-27 19:59:44,041 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.144[s] Speed: 111.4[samples/s]
2022-04-27 20:01:12,439 reid_baseline.train INFO: normal accuracy 0.45880192793206337 4.004144668579102 
2022-04-27 20:01:13,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 20:01:13,242 reid_baseline.train INFO: Accuracy: 45.9% Mean Entropy: 400.4%
2022-04-27 20:01:28,413 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.818, Acc: 0.542, Base Lr: 2.46e-03
2022-04-27 20:01:42,184 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.680, Acc: 0.558, Base Lr: 2.46e-03
2022-04-27 20:01:52,235 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.142[s] Speed: 112.3[samples/s]
2022-04-27 20:03:18,283 reid_baseline.train INFO: normal accuracy 0.5843470277714023 3.5087649822235107 
2022-04-27 20:03:19,138 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 20:03:19,139 reid_baseline.train INFO: Accuracy: 58.4% Mean Entropy: 350.9%
2022-04-27 20:03:34,685 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.152, Acc: 0.649, Base Lr: 3.25e-03
2022-04-27 20:03:48,137 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.069, Acc: 0.663, Base Lr: 3.25e-03
2022-04-27 20:03:58,196 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.143[s] Speed: 112.0[samples/s]
2022-04-27 20:05:24,201 reid_baseline.train INFO: normal accuracy 0.6690383291255451 2.9760661125183105 
2022-04-27 20:05:25,046 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 20:05:25,046 reid_baseline.train INFO: Accuracy: 66.9% Mean Entropy: 297.6%
2022-04-27 20:05:40,733 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.758, Acc: 0.738, Base Lr: 4.04e-03
2022-04-27 20:05:54,178 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.704, Acc: 0.748, Base Lr: 4.04e-03
2022-04-27 20:06:04,213 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.143[s] Speed: 111.7[samples/s]
2022-04-27 20:07:29,600 reid_baseline.train INFO: normal accuracy 0.7149414734909342 2.605830669403076 
2022-04-27 20:07:30,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 20:07:30,395 reid_baseline.train INFO: Accuracy: 71.5% Mean Entropy: 260.6%
2022-04-27 20:07:45,439 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.491, Acc: 0.796, Base Lr: 4.83e-03
2022-04-27 20:07:58,844 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.457, Acc: 0.812, Base Lr: 4.83e-03
2022-04-27 20:08:08,443 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.139[s] Speed: 115.0[samples/s]
2022-04-27 20:09:37,851 reid_baseline.train INFO: normal accuracy 0.7346798255680514 2.3887906074523926 
2022-04-27 20:09:38,666 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 20:09:38,666 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 238.9%
2022-04-27 20:09:54,204 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.328, Acc: 0.842, Base Lr: 5.62e-03
2022-04-27 20:10:08,053 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.328, Acc: 0.844, Base Lr: 5.62e-03
2022-04-27 20:10:18,148 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.143[s] Speed: 111.6[samples/s]
2022-04-27 20:11:43,032 reid_baseline.train INFO: normal accuracy 0.7417948129446867 2.1478915214538574 
2022-04-27 20:11:43,917 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 20:11:43,918 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 214.8%
2022-04-27 20:11:59,912 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.271, Acc: 0.864, Base Lr: 6.42e-03
2022-04-27 20:12:13,275 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.253, Acc: 0.867, Base Lr: 6.42e-03
2022-04-27 20:12:23,518 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.144[s] Speed: 111.2[samples/s]
2022-04-27 20:13:50,320 reid_baseline.train INFO: normal accuracy 0.7613036492999771 2.0503110885620117 
2022-04-27 20:13:51,165 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 20:13:51,165 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 205.0%
2022-04-27 20:14:07,784 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.152, Acc: 0.898, Base Lr: 7.21e-03
2022-04-27 20:14:21,355 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.158, Acc: 0.892, Base Lr: 7.21e-03
2022-04-27 20:14:31,348 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.146[s] Speed: 109.8[samples/s]
2022-04-27 20:15:59,216 reid_baseline.train INFO: normal accuracy 0.7626807436309387 2.0049171447753906 
2022-04-27 20:16:00,052 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 20:16:00,052 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 200.5%
2022-04-27 20:16:15,521 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.063, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 20:16:29,896 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.072, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 20:16:40,040 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.146[s] Speed: 109.9[samples/s]
2022-04-27 20:18:08,367 reid_baseline.train INFO: normal accuracy 0.7670415423456507 1.8594295978546143 
2022-04-27 20:18:09,192 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 20:18:09,192 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 185.9%
2022-04-27 20:18:24,476 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.045, Acc: 0.926, Base Lr: 3.38e-03
2022-04-27 20:18:37,961 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.040, Acc: 0.927, Base Lr: 3.38e-03
2022-04-27 20:18:48,466 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.144[s] Speed: 111.3[samples/s]
2022-04-27 20:20:21,014 reid_baseline.train INFO: normal accuracy 0.7743860454441129 1.9831478595733643 
2022-04-27 20:20:21,015 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 20:20:21,015 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 198.3%
2022-04-27 20:20:37,410 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 0.997, Acc: 0.946, Base Lr: 2.77e-03
2022-04-27 20:20:51,191 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.010, Acc: 0.936, Base Lr: 2.77e-03
2022-04-27 20:21:01,268 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.146[s] Speed: 109.5[samples/s]
2022-04-27 20:22:32,724 reid_baseline.train INFO: normal accuracy 0.7789763598806518 1.9407459497451782 
2022-04-27 20:22:32,725 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 20:22:32,725 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 194.1%
2022-04-27 20:22:48,566 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.997, Acc: 0.939, Base Lr: 2.20e-03
2022-04-27 20:23:02,913 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.995, Acc: 0.944, Base Lr: 2.20e-03
2022-04-27 20:23:13,551 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.149[s] Speed: 107.1[samples/s]
2022-04-27 20:24:45,228 reid_baseline.train INFO: normal accuracy 0.7837961900390177 1.9031918048858643 
2022-04-27 20:24:45,228 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 20:24:45,228 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 190.3%
2022-04-27 20:25:00,753 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.989, Acc: 0.948, Base Lr: 1.66e-03
2022-04-27 20:25:14,418 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.984, Acc: 0.949, Base Lr: 1.66e-03
2022-04-27 20:25:24,493 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.143[s] Speed: 111.5[samples/s]
2022-04-27 20:26:53,570 reid_baseline.train INFO: normal accuracy 0.7808124856552674 1.9694019556045532 
2022-04-27 20:26:53,570 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 20:26:53,570 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 196.9%
2022-04-27 20:27:10,404 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.968, Acc: 0.952, Base Lr: 1.19e-03
2022-04-27 20:27:24,602 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.969, Acc: 0.952, Base Lr: 1.19e-03
2022-04-27 20:27:34,895 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.151[s] Speed: 106.1[samples/s]
2022-04-27 20:29:12,279 reid_baseline.train INFO: normal accuracy 0.7789763598806518 1.8795232772827148 
2022-04-27 20:29:12,279 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 20:29:12,279 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 188.0%
2022-04-27 20:29:27,886 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.977, Acc: 0.943, Base Lr: 7.78e-04
2022-04-27 20:29:41,857 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.967, Acc: 0.952, Base Lr: 7.78e-04
2022-04-27 20:29:51,720 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.144[s] Speed: 110.9[samples/s]
2022-04-27 20:31:28,396 reid_baseline.train INFO: normal accuracy 0.7819600642644021 1.944734811782837 
2022-04-27 20:31:28,397 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 20:31:28,397 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 194.5%
2022-04-27 20:31:44,094 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.955, Acc: 0.957, Base Lr: 4.51e-04
2022-04-27 20:31:57,422 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.959, Acc: 0.952, Base Lr: 4.51e-04
2022-04-27 20:32:07,843 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.144[s] Speed: 110.9[samples/s]
2022-04-27 20:33:43,686 reid_baseline.train INFO: normal accuracy 0.7821895799862291 1.8750122785568237 
2022-04-27 20:33:43,686 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 20:33:43,687 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 187.5%
2022-04-27 20:33:58,540 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.948, Acc: 0.956, Base Lr: 2.11e-04
2022-04-27 20:34:13,353 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.949, Acc: 0.957, Base Lr: 2.11e-04
2022-04-27 20:34:23,819 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.147[s] Speed: 109.0[samples/s]
2022-04-27 20:35:58,499 reid_baseline.train INFO: normal accuracy 0.782419095708056 1.9381741285324097 
2022-04-27 20:35:58,500 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 20:35:58,500 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 193.8%
2022-04-27 20:36:14,651 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.942, Acc: 0.962, Base Lr: 6.51e-05
2022-04-27 20:36:29,025 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.948, Acc: 0.961, Base Lr: 6.51e-05
2022-04-27 20:36:39,038 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.147[s] Speed: 108.5[samples/s]
2022-04-27 20:38:18,392 reid_baseline.train INFO: normal accuracy 0.782648611429883 1.8808624744415283 
2022-04-27 20:38:18,392 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 20:38:18,393 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 188.1%
2022-04-27 20:38:34,423 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.942, Acc: 0.954, Base Lr: 1.60e-05
2022-04-27 20:38:48,015 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.946, Acc: 0.957, Base Lr: 1.60e-05
2022-04-27 20:38:58,085 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.145[s] Speed: 110.2[samples/s]
2022-04-27 20:40:32,793 reid_baseline.train INFO: normal accuracy 0.7819600642644021 1.9700952768325806 
2022-04-27 20:40:32,793 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 20:40:32,793 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 197.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_11/transformer_best_model.pth
2022-04-27 20:42:21,463 reid_baseline.train INFO: normal accuracy 0.7670415423456507 1.8594295978546143 
2022-04-27 20:42:21,463 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 20:42:21,463 reid_baseline.train INFO: Accuracy: 76.7%
2022-04-27 20:44:13,249 reid_baseline.train INFO: normal accuracy 0.7670415423456507 1.8594295978546143 
2022-04-27 20:44:13,250 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 20:44:13,250 reid_baseline.train INFO: Shuffled Accuracy: 76.7%
2022-04-27 20:44:39,539 reid_baseline.train INFO: normal accuracy 0.9399770904925544 0.9723746180534363 
2022-04-27 20:44:39,539 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 20:44:39,540 reid_baseline.train INFO: Source Clean Accuracy: 94.0%
2022-04-27 20:44:44,412 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_12
2022-04-27 20:44:44,412 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-27 20:44:44,413 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 20:44:44,413 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 20:44:44,413 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 20:44:53,878 reid_baseline.train INFO: start training
2022-04-27 20:45:24,613 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.147, Acc: 0.113, Base Lr: 8.72e-04
2022-04-27 20:45:47,706 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.100, Acc: 0.197, Base Lr: 8.72e-04
2022-04-27 20:46:04,640 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.259[s] Speed: 61.8[samples/s]
2022-04-27 20:46:34,945 reid_baseline.train INFO: normal accuracy 0.23485784919653893 4.165731906890869 
2022-04-27 20:46:35,747 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 20:46:35,748 reid_baseline.train INFO: Accuracy: 23.5% Mean Entropy: 416.6%
2022-04-27 20:47:08,582 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.689, Acc: 0.441, Base Lr: 1.66e-03
2022-04-27 20:47:46,149 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.533, Acc: 0.441, Base Lr: 1.66e-03
2022-04-27 20:48:16,782 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.369[s] Speed: 43.3[samples/s]
2022-04-27 20:48:46,569 reid_baseline.train INFO: normal accuracy 0.3642356819118253 4.046873092651367 
2022-04-27 20:48:47,477 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 20:48:47,477 reid_baseline.train INFO: Accuracy: 36.4% Mean Entropy: 404.7%
2022-04-27 20:49:34,289 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.790, Acc: 0.527, Base Lr: 2.46e-03
2022-04-27 20:50:17,529 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.661, Acc: 0.544, Base Lr: 2.46e-03
2022-04-27 20:50:41,188 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.416[s] Speed: 38.4[samples/s]
2022-04-27 20:51:10,855 reid_baseline.train INFO: normal accuracy 0.5150391429748661 3.763514518737793 
2022-04-27 20:51:11,806 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 20:51:11,806 reid_baseline.train INFO: Accuracy: 51.5% Mean Entropy: 376.4%
2022-04-27 20:51:51,624 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.142, Acc: 0.659, Base Lr: 3.25e-03
2022-04-27 20:52:31,628 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.066, Acc: 0.671, Base Lr: 3.25e-03
2022-04-27 20:52:59,675 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.395[s] Speed: 40.5[samples/s]
2022-04-27 20:53:29,736 reid_baseline.train INFO: normal accuracy 0.5920889987639061 3.464434862136841 
2022-04-27 20:53:30,664 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 20:53:30,665 reid_baseline.train INFO: Accuracy: 59.2% Mean Entropy: 346.4%
2022-04-27 20:54:09,463 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.761, Acc: 0.743, Base Lr: 4.04e-03
2022-04-27 20:54:50,976 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.709, Acc: 0.749, Base Lr: 4.04e-03
2022-04-27 20:55:16,554 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.388[s] Speed: 41.3[samples/s]
2022-04-27 20:55:48,308 reid_baseline.train INFO: normal accuracy 0.6390605686032138 3.303570032119751 
2022-04-27 20:55:49,215 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 20:55:49,216 reid_baseline.train INFO: Accuracy: 63.9% Mean Entropy: 330.4%
2022-04-27 20:56:33,947 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.491, Acc: 0.803, Base Lr: 4.83e-03
2022-04-27 20:57:05,995 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.462, Acc: 0.812, Base Lr: 4.83e-03
2022-04-27 20:57:37,446 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.396[s] Speed: 40.4[samples/s]
2022-04-27 20:58:07,061 reid_baseline.train INFO: normal accuracy 0.6600741656365884 3.1614205837249756 
2022-04-27 20:58:08,023 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 20:58:08,023 reid_baseline.train INFO: Accuracy: 66.0% Mean Entropy: 316.1%
2022-04-27 20:58:53,816 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.338, Acc: 0.837, Base Lr: 5.62e-03
2022-04-27 20:59:37,428 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.336, Acc: 0.840, Base Lr: 5.62e-03
2022-04-27 20:59:58,627 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.405[s] Speed: 39.5[samples/s]
2022-04-27 21:00:28,427 reid_baseline.train INFO: normal accuracy 0.6683147919241862 3.0592591762542725 
2022-04-27 21:00:29,358 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 21:00:29,358 reid_baseline.train INFO: Accuracy: 66.8% Mean Entropy: 305.9%
2022-04-27 21:01:14,725 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.269, Acc: 0.855, Base Lr: 6.42e-03
2022-04-27 21:01:53,527 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.251, Acc: 0.867, Base Lr: 6.42e-03
2022-04-27 21:02:22,660 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.415[s] Speed: 38.6[samples/s]
2022-04-27 21:02:54,492 reid_baseline.train INFO: normal accuracy 0.6823238566131026 3.0848610401153564 
2022-04-27 21:02:54,492 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 21:02:54,492 reid_baseline.train INFO: Accuracy: 68.2% Mean Entropy: 308.5%
2022-04-27 21:03:31,753 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.159, Acc: 0.897, Base Lr: 7.21e-03
2022-04-27 21:04:13,223 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.156, Acc: 0.894, Base Lr: 7.21e-03
2022-04-27 21:04:38,656 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.382[s] Speed: 41.9[samples/s]
2022-04-27 21:05:09,721 reid_baseline.train INFO: normal accuracy 0.6761433868974042 2.998840808868408 
2022-04-27 21:05:10,734 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 21:05:10,735 reid_baseline.train INFO: Accuracy: 67.6% Mean Entropy: 299.9%
2022-04-27 21:05:44,588 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.063, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 21:06:10,365 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.073, Acc: 0.921, Base Lr: 4.01e-03
2022-04-27 21:06:43,059 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-27 21:07:15,382 reid_baseline.train INFO: normal accuracy 0.695920889987639 2.8817479610443115 
2022-04-27 21:07:16,513 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 21:07:16,514 reid_baseline.train INFO: Accuracy: 69.6% Mean Entropy: 288.2%
2022-04-27 21:08:13,078 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.047, Acc: 0.926, Base Lr: 3.38e-03
2022-04-27 21:09:12,237 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.038, Acc: 0.927, Base Lr: 3.38e-03
2022-04-27 21:09:48,930 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.558[s] Speed: 28.7[samples/s]
2022-04-27 21:10:19,867 reid_baseline.train INFO: normal accuracy 0.7029254223320972 2.946364164352417 
2022-04-27 21:10:19,868 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 21:10:19,868 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 294.6%
2022-04-27 21:11:20,784 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.002, Acc: 0.943, Base Lr: 2.77e-03
2022-04-27 21:12:21,771 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.017, Acc: 0.933, Base Lr: 2.77e-03
2022-04-27 21:12:49,423 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.548[s] Speed: 29.2[samples/s]
2022-04-27 21:13:19,097 reid_baseline.train INFO: normal accuracy 0.6988051091882983 2.944286584854126 
2022-04-27 21:13:19,097 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 21:13:19,098 reid_baseline.train INFO: Accuracy: 69.9% Mean Entropy: 294.4%
2022-04-27 21:13:57,040 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.993, Acc: 0.944, Base Lr: 2.20e-03
2022-04-27 21:14:35,650 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.995, Acc: 0.946, Base Lr: 2.20e-03
2022-04-27 21:14:57,002 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.358[s] Speed: 44.7[samples/s]
2022-04-27 21:15:28,154 reid_baseline.train INFO: normal accuracy 0.7029254223320972 2.9552764892578125 
2022-04-27 21:15:28,154 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 21:15:28,155 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 295.5%
2022-04-27 21:16:07,031 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.988, Acc: 0.942, Base Lr: 1.66e-03
2022-04-27 21:16:34,716 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.980, Acc: 0.948, Base Lr: 1.66e-03
2022-04-27 21:16:54,914 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.317[s] Speed: 50.4[samples/s]
2022-04-27 21:17:24,909 reid_baseline.train INFO: normal accuracy 0.696332921302019 2.951855182647705 
2022-04-27 21:17:24,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 21:17:24,909 reid_baseline.train INFO: Accuracy: 69.6% Mean Entropy: 295.2%
2022-04-27 21:18:00,285 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.968, Acc: 0.949, Base Lr: 1.19e-03
2022-04-27 21:18:34,939 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.969, Acc: 0.950, Base Lr: 1.19e-03
2022-04-27 21:19:00,987 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.352[s] Speed: 45.5[samples/s]
2022-04-27 21:19:31,802 reid_baseline.train INFO: normal accuracy 0.7053976102183765 2.9253902435302734 
2022-04-27 21:19:31,803 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 21:19:31,803 reid_baseline.train INFO: Accuracy: 70.5% Mean Entropy: 292.5%
2022-04-27 21:20:02,414 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.974, Acc: 0.944, Base Lr: 7.78e-04
2022-04-27 21:20:40,813 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.968, Acc: 0.949, Base Lr: 7.78e-04
2022-04-27 21:21:06,903 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.348[s] Speed: 45.9[samples/s]
2022-04-27 21:21:36,827 reid_baseline.train INFO: normal accuracy 0.7025133910177174 2.9561517238616943 
2022-04-27 21:21:36,827 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 21:21:36,827 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 295.6%
2022-04-27 21:22:13,075 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.954, Acc: 0.957, Base Lr: 4.51e-04
2022-04-27 21:22:50,090 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.957, Acc: 0.956, Base Lr: 4.51e-04
2022-04-27 21:23:16,605 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-27 21:23:45,003 reid_baseline.train INFO: normal accuracy 0.7012772970745776 2.913844347000122 
2022-04-27 21:23:45,003 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 21:23:45,003 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 291.4%
2022-04-27 21:24:07,934 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.952, Acc: 0.954, Base Lr: 2.11e-04
2022-04-27 21:24:24,102 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.951, Acc: 0.956, Base Lr: 2.11e-04
2022-04-27 21:24:38,280 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.195[s] Speed: 82.0[samples/s]
2022-04-27 21:25:03,331 reid_baseline.train INFO: normal accuracy 0.7058096415327565 2.9128260612487793 
2022-04-27 21:25:03,332 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 21:25:03,332 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 291.3%
2022-04-27 21:25:23,788 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.948, Acc: 0.957, Base Lr: 6.51e-05
2022-04-27 21:25:40,936 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.950, Acc: 0.959, Base Lr: 6.51e-05
2022-04-27 21:25:53,348 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.183[s] Speed: 87.5[samples/s]
2022-04-27 21:26:17,281 reid_baseline.train INFO: normal accuracy 0.7041615162752369 2.898952007293701 
2022-04-27 21:26:17,281 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 21:26:17,282 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 289.9%
2022-04-27 21:26:37,439 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.952, Acc: 0.952, Base Lr: 1.60e-05
2022-04-27 21:26:53,351 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.952, Acc: 0.956, Base Lr: 1.60e-05
2022-04-27 21:27:05,094 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.175[s] Speed: 91.6[samples/s]
2022-04-27 21:27:31,900 reid_baseline.train INFO: normal accuracy 0.7033374536464772 2.9779844284057617 
2022-04-27 21:27:31,900 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 21:27:31,900 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 297.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_cross_key_layer_12/transformer_best_model.pth
2022-04-27 21:28:01,609 reid_baseline.train INFO: normal accuracy 0.695920889987639 2.8817479610443115 
2022-04-27 21:28:01,609 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 21:28:01,609 reid_baseline.train INFO: Accuracy: 69.6%
2022-04-27 21:28:30,203 reid_baseline.train INFO: normal accuracy 0.695920889987639 2.8817479610443115 
2022-04-27 21:28:30,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 21:28:30,203 reid_baseline.train INFO: Shuffled Accuracy: 69.6%
2022-04-27 21:28:54,202 reid_baseline.train INFO: normal accuracy 0.9369988545246277 1.981525182723999 
2022-04-27 21:28:54,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 21:28:54,203 reid_baseline.train INFO: Source Clean Accuracy: 93.7%
2022-04-27 21:28:58,865 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_12
2022-04-27 21:28:58,865 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-27 21:28:58,865 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 21:28:58,865 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 21:28:58,866 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 21:29:06,840 reid_baseline.train INFO: start training
2022-04-27 21:29:27,556 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.147, Acc: 0.113, Base Lr: 8.72e-04
2022-04-27 21:29:44,477 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.100, Acc: 0.197, Base Lr: 8.72e-04
2022-04-27 21:29:56,144 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.180[s] Speed: 88.8[samples/s]
2022-04-27 21:30:19,596 reid_baseline.train INFO: normal accuracy 0.29984230682586166 4.165606498718262 
2022-04-27 21:30:20,370 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 21:30:20,370 reid_baseline.train INFO: Accuracy: 30.0% Mean Entropy: 416.6%
2022-04-27 21:30:47,371 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.689, Acc: 0.441, Base Lr: 1.66e-03
2022-04-27 21:31:15,714 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.533, Acc: 0.441, Base Lr: 1.66e-03
2022-04-27 21:31:35,005 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.273[s] Speed: 58.5[samples/s]
2022-04-27 21:32:03,478 reid_baseline.train INFO: normal accuracy 0.4575354809641811 4.012210369110107 
2022-04-27 21:32:04,515 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 21:32:04,515 reid_baseline.train INFO: Accuracy: 45.8% Mean Entropy: 401.2%
2022-04-27 21:32:27,998 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.790, Acc: 0.527, Base Lr: 2.46e-03
2022-04-27 21:32:42,552 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.661, Acc: 0.544, Base Lr: 2.46e-03
2022-04-27 21:32:53,158 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.178[s] Speed: 89.9[samples/s]
2022-04-27 21:33:18,807 reid_baseline.train INFO: normal accuracy 0.5753548096418112 3.664276599884033 
2022-04-27 21:33:19,867 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 21:33:19,867 reid_baseline.train INFO: Accuracy: 57.5% Mean Entropy: 366.4%
2022-04-27 21:33:48,934 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.142, Acc: 0.659, Base Lr: 3.25e-03
2022-04-27 21:34:08,166 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.066, Acc: 0.671, Base Lr: 3.25e-03
2022-04-27 21:34:22,959 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.231[s] Speed: 69.3[samples/s]
2022-04-27 21:34:50,131 reid_baseline.train INFO: normal accuracy 0.6476683937823834 3.321197032928467 
2022-04-27 21:34:51,052 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 21:34:51,052 reid_baseline.train INFO: Accuracy: 64.8% Mean Entropy: 332.1%
2022-04-27 21:35:11,969 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.761, Acc: 0.743, Base Lr: 4.04e-03
2022-04-27 21:35:31,598 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.709, Acc: 0.749, Base Lr: 4.04e-03
2022-04-27 21:35:44,921 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.197[s] Speed: 81.1[samples/s]
2022-04-27 21:36:12,363 reid_baseline.train INFO: normal accuracy 0.6868664113539086 3.1276583671569824 
2022-04-27 21:36:13,251 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 21:36:13,251 reid_baseline.train INFO: Accuracy: 68.7% Mean Entropy: 312.8%
2022-04-27 21:36:34,646 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.491, Acc: 0.803, Base Lr: 4.83e-03
2022-04-27 21:36:55,824 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.462, Acc: 0.812, Base Lr: 4.83e-03
2022-04-27 21:37:09,741 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.207[s] Speed: 77.4[samples/s]
2022-04-27 21:37:37,109 reid_baseline.train INFO: normal accuracy 0.6963280018022077 2.993509292602539 
2022-04-27 21:37:37,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 21:37:37,955 reid_baseline.train INFO: Accuracy: 69.6% Mean Entropy: 299.4%
2022-04-27 21:37:58,433 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.338, Acc: 0.837, Base Lr: 5.62e-03
2022-04-27 21:38:24,886 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.336, Acc: 0.840, Base Lr: 5.62e-03
2022-04-27 21:38:43,225 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.239[s] Speed: 66.9[samples/s]
2022-04-27 21:39:10,824 reid_baseline.train INFO: normal accuracy 0.7127731471052039 2.883702516555786 
2022-04-27 21:39:11,704 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 21:39:11,704 reid_baseline.train INFO: Accuracy: 71.3% Mean Entropy: 288.4%
2022-04-27 21:39:34,429 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.269, Acc: 0.855, Base Lr: 6.42e-03
2022-04-27 21:39:54,514 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.251, Acc: 0.867, Base Lr: 6.42e-03
2022-04-27 21:40:08,215 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.207[s] Speed: 77.3[samples/s]
2022-04-27 21:40:35,611 reid_baseline.train INFO: normal accuracy 0.7229105654426673 2.936878204345703 
2022-04-27 21:40:35,613 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 21:40:35,613 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 293.7%
2022-04-27 21:40:52,527 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.159, Acc: 0.897, Base Lr: 7.21e-03
2022-04-27 21:41:07,449 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.156, Acc: 0.894, Base Lr: 7.21e-03
2022-04-27 21:41:18,012 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.155[s] Speed: 103.1[samples/s]
2022-04-27 21:41:44,234 reid_baseline.train INFO: normal accuracy 0.7292182924082 2.860879898071289 
2022-04-27 21:41:45,272 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 21:41:45,273 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 286.1%
2022-04-27 21:42:14,277 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.063, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 21:42:43,662 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.073, Acc: 0.921, Base Lr: 4.01e-03
2022-04-27 21:43:05,566 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-27 21:43:32,236 reid_baseline.train INFO: normal accuracy 0.7445370578959225 2.7762789726257324 
2022-04-27 21:43:33,153 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 21:43:33,153 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 277.6%
2022-04-27 21:43:55,194 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.047, Acc: 0.926, Base Lr: 3.38e-03
2022-04-27 21:44:15,267 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.038, Acc: 0.927, Base Lr: 3.38e-03
2022-04-27 21:44:29,421 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.206[s] Speed: 77.7[samples/s]
2022-04-27 21:44:56,206 reid_baseline.train INFO: normal accuracy 0.738905158819554 2.837554454803467 
2022-04-27 21:44:56,206 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 21:44:56,207 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 283.8%
2022-04-27 21:45:17,613 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.002, Acc: 0.943, Base Lr: 2.77e-03
2022-04-27 21:45:37,624 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.017, Acc: 0.933, Base Lr: 2.77e-03
2022-04-27 21:45:51,465 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.202[s] Speed: 79.2[samples/s]
2022-04-27 21:46:18,154 reid_baseline.train INFO: normal accuracy 0.7526469925658932 2.804131269454956 
2022-04-27 21:46:18,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 21:46:18,155 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 280.4%
2022-04-27 21:46:39,666 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.993, Acc: 0.944, Base Lr: 2.20e-03
2022-04-27 21:46:57,885 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.995, Acc: 0.946, Base Lr: 2.20e-03
2022-04-27 21:47:12,855 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.200[s] Speed: 79.9[samples/s]
2022-04-27 21:47:40,238 reid_baseline.train INFO: normal accuracy 0.7488173011939626 2.851292610168457 
2022-04-27 21:47:40,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 21:47:40,238 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 285.1%
2022-04-27 21:48:05,374 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.988, Acc: 0.942, Base Lr: 1.66e-03
2022-04-27 21:48:33,742 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.980, Acc: 0.948, Base Lr: 1.66e-03
2022-04-27 21:48:56,103 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.278[s] Speed: 57.7[samples/s]
2022-04-27 21:49:24,728 reid_baseline.train INFO: normal accuracy 0.7553503041225501 2.8348424434661865 
2022-04-27 21:49:24,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 21:49:24,729 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 283.5%
2022-04-27 21:49:48,859 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.968, Acc: 0.949, Base Lr: 1.19e-03
2022-04-27 21:50:04,438 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.969, Acc: 0.950, Base Lr: 1.19e-03
2022-04-27 21:50:15,901 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.187[s] Speed: 85.4[samples/s]
2022-04-27 21:50:39,495 reid_baseline.train INFO: normal accuracy 0.7558008560486597 2.825326919555664 
2022-04-27 21:50:39,495 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 21:50:39,496 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 282.5%
2022-04-27 21:50:58,392 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.974, Acc: 0.944, Base Lr: 7.78e-04
2022-04-27 21:51:13,832 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.968, Acc: 0.949, Base Lr: 7.78e-04
2022-04-27 21:51:26,809 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.173[s] Speed: 92.6[samples/s]
2022-04-27 21:51:51,745 reid_baseline.train INFO: normal accuracy 0.7546744762333859 2.865966558456421 
2022-04-27 21:51:51,746 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 21:51:51,746 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 286.6%
2022-04-27 21:52:13,831 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.954, Acc: 0.957, Base Lr: 4.51e-04
2022-04-27 21:52:33,331 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.957, Acc: 0.956, Base Lr: 4.51e-04
2022-04-27 21:52:49,508 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.211[s] Speed: 75.7[samples/s]
2022-04-27 21:53:16,594 reid_baseline.train INFO: normal accuracy 0.752872268528948 2.8105595111846924 
2022-04-27 21:53:16,595 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 21:53:16,595 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 281.1%
2022-04-27 21:53:38,679 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.952, Acc: 0.954, Base Lr: 2.11e-04
2022-04-27 21:53:58,730 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.951, Acc: 0.956, Base Lr: 2.11e-04
2022-04-27 21:54:12,096 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.203[s] Speed: 78.9[samples/s]
2022-04-27 21:54:39,373 reid_baseline.train INFO: normal accuracy 0.7571525118269881 2.81213116645813 
2022-04-27 21:54:39,374 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 21:54:39,374 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 281.2%
2022-04-27 21:54:59,898 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.948, Acc: 0.957, Base Lr: 6.51e-05
2022-04-27 21:55:19,368 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.950, Acc: 0.959, Base Lr: 6.51e-05
2022-04-27 21:55:32,969 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.196[s] Speed: 81.7[samples/s]
2022-04-27 21:56:00,202 reid_baseline.train INFO: normal accuracy 0.7551250281594953 2.7935097217559814 
2022-04-27 21:56:00,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 21:56:00,202 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 279.4%
2022-04-27 21:56:21,763 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.952, Acc: 0.952, Base Lr: 1.60e-05
2022-04-27 21:56:41,764 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.952, Acc: 0.956, Base Lr: 1.60e-05
2022-04-27 21:56:56,254 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.205[s] Speed: 78.0[samples/s]
2022-04-27 21:57:22,971 reid_baseline.train INFO: normal accuracy 0.7567019599008786 2.8722469806671143 
2022-04-27 21:57:22,971 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 21:57:22,972 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 287.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_cross_key_layer_12/transformer_best_model.pth
2022-04-27 21:57:50,573 reid_baseline.train INFO: normal accuracy 0.7445370578959225 2.7762789726257324 
2022-04-27 21:57:50,573 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 21:57:50,573 reid_baseline.train INFO: Accuracy: 74.5%
2022-04-27 21:58:17,636 reid_baseline.train INFO: normal accuracy 0.7445370578959225 2.7762789726257324 
2022-04-27 21:58:17,637 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 21:58:17,637 reid_baseline.train INFO: Shuffled Accuracy: 74.5%
2022-04-27 21:58:45,034 reid_baseline.train INFO: normal accuracy 0.9369988545246277 1.981525182723999 
2022-04-27 21:58:45,034 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 21:58:45,035 reid_baseline.train INFO: Source Clean Accuracy: 93.7%
2022-04-27 21:58:50,558 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_12
2022-04-27 21:58:50,558 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-27 21:58:50,558 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 21:58:50,558 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 21:58:50,559 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 21:59:01,873 reid_baseline.train INFO: start training
2022-04-27 21:59:29,794 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.147, Acc: 0.113, Base Lr: 8.72e-04
2022-04-27 21:59:49,261 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.100, Acc: 0.197, Base Lr: 8.72e-04
2022-04-27 22:00:04,593 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-27 22:01:47,768 reid_baseline.train INFO: normal accuracy 0.2942391553821437 4.165715217590332 
2022-04-27 22:01:48,591 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 22:01:48,591 reid_baseline.train INFO: Accuracy: 29.4% Mean Entropy: 416.6%
2022-04-27 22:02:18,378 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.689, Acc: 0.441, Base Lr: 1.66e-03
2022-04-27 22:02:43,388 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.533, Acc: 0.441, Base Lr: 1.66e-03
2022-04-27 22:03:02,632 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-27 22:04:47,315 reid_baseline.train INFO: normal accuracy 0.456277254991967 4.024938106536865 
2022-04-27 22:04:48,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 22:04:48,288 reid_baseline.train INFO: Accuracy: 45.6% Mean Entropy: 402.5%
2022-04-27 22:05:14,941 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.790, Acc: 0.527, Base Lr: 2.46e-03
2022-04-27 22:05:42,446 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.661, Acc: 0.544, Base Lr: 2.46e-03
2022-04-27 22:06:00,330 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.264[s] Speed: 60.7[samples/s]
2022-04-27 22:07:47,741 reid_baseline.train INFO: normal accuracy 0.5864126692678449 3.6856257915496826 
2022-04-27 22:07:48,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 22:07:48,729 reid_baseline.train INFO: Accuracy: 58.6% Mean Entropy: 368.6%
2022-04-27 22:08:34,667 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.142, Acc: 0.659, Base Lr: 3.25e-03
2022-04-27 22:09:21,378 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.066, Acc: 0.671, Base Lr: 3.25e-03
2022-04-27 22:09:47,325 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.434[s] Speed: 36.9[samples/s]
2022-04-27 22:11:51,760 reid_baseline.train INFO: normal accuracy 0.6697268762910259 3.3442838191986084 
2022-04-27 22:11:52,898 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 22:11:52,899 reid_baseline.train INFO: Accuracy: 67.0% Mean Entropy: 334.4%
2022-04-27 22:13:18,515 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.761, Acc: 0.743, Base Lr: 4.04e-03
2022-04-27 22:14:37,010 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.709, Acc: 0.749, Base Lr: 4.04e-03
2022-04-27 22:15:26,722 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.783[s] Speed: 20.4[samples/s]
2022-04-27 22:17:39,060 reid_baseline.train INFO: normal accuracy 0.7131053477163186 3.1676759719848633 
2022-04-27 22:17:40,212 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 22:17:40,213 reid_baseline.train INFO: Accuracy: 71.3% Mean Entropy: 316.8%
2022-04-27 22:18:20,160 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.491, Acc: 0.803, Base Lr: 4.83e-03
2022-04-27 22:18:47,653 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.462, Acc: 0.812, Base Lr: 4.83e-03
2022-04-27 22:19:16,715 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.352[s] Speed: 45.4[samples/s]
2022-04-27 22:21:28,294 reid_baseline.train INFO: normal accuracy 0.7305485425751664 3.0317866802215576 
2022-04-27 22:21:29,415 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 22:21:29,415 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 303.2%
2022-04-27 22:22:50,203 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.338, Acc: 0.837, Base Lr: 5.62e-03
2022-04-27 22:23:39,965 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.336, Acc: 0.840, Base Lr: 5.62e-03
2022-04-27 22:24:19,416 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.622[s] Speed: 25.7[samples/s]
2022-04-27 22:26:19,063 reid_baseline.train INFO: normal accuracy 0.7397291714482442 2.910305976867676 
2022-04-27 22:26:20,131 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 22:26:20,131 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 291.0%
2022-04-27 22:27:11,916 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.269, Acc: 0.855, Base Lr: 6.42e-03
2022-04-27 22:27:57,846 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.251, Acc: 0.867, Base Lr: 6.42e-03
2022-04-27 22:28:33,625 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.489[s] Speed: 32.7[samples/s]
2022-04-27 22:30:37,797 reid_baseline.train INFO: normal accuracy 0.7544181776451687 2.956791639328003 
2022-04-27 22:30:37,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 22:30:37,800 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 295.7%
2022-04-27 22:31:33,648 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.159, Acc: 0.897, Base Lr: 7.21e-03
2022-04-27 22:32:20,115 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.156, Acc: 0.894, Base Lr: 7.21e-03
2022-04-27 22:32:56,338 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.507[s] Speed: 31.5[samples/s]
2022-04-27 22:34:58,726 reid_baseline.train INFO: normal accuracy 0.7603855864126693 2.8760063648223877 
2022-04-27 22:34:59,545 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 22:34:59,545 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 287.6%
2022-04-27 22:35:42,570 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.063, Acc: 0.922, Base Lr: 4.01e-03
2022-04-27 22:36:15,834 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.073, Acc: 0.921, Base Lr: 4.01e-03
2022-04-27 22:36:39,408 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-27 22:38:44,977 reid_baseline.train INFO: normal accuracy 0.7677300895111315 2.7779879570007324 
2022-04-27 22:38:45,991 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 22:38:45,992 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 277.8%
2022-04-27 22:39:49,695 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.047, Acc: 0.926, Base Lr: 3.38e-03
2022-04-27 22:40:35,813 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.038, Acc: 0.927, Base Lr: 3.38e-03
2022-04-27 22:41:41,746 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.644[s] Speed: 24.9[samples/s]
2022-04-27 22:43:44,236 reid_baseline.train INFO: normal accuracy 0.7679596052329585 2.847282886505127 
2022-04-27 22:43:44,237 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 22:43:44,237 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 284.7%
2022-04-27 22:44:34,571 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.002, Acc: 0.943, Base Lr: 2.77e-03
2022-04-27 22:45:22,339 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.017, Acc: 0.933, Base Lr: 2.77e-03
2022-04-27 22:45:53,967 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.475[s] Speed: 33.7[samples/s]
2022-04-27 22:47:52,849 reid_baseline.train INFO: normal accuracy 0.7645168694055543 2.8427956104278564 
2022-04-27 22:47:52,852 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 22:47:52,852 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 284.3%
2022-04-27 22:48:59,749 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.993, Acc: 0.944, Base Lr: 2.20e-03
2022-04-27 22:50:17,470 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.995, Acc: 0.946, Base Lr: 2.20e-03
2022-04-27 22:51:05,625 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.706[s] Speed: 22.7[samples/s]
2022-04-27 22:53:07,085 reid_baseline.train INFO: normal accuracy 0.7711728253385357 2.8686249256134033 
2022-04-27 22:53:07,087 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 22:53:07,088 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 286.9%
2022-04-27 22:53:56,983 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.988, Acc: 0.942, Base Lr: 1.66e-03
2022-04-27 22:54:32,966 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.980, Acc: 0.948, Base Lr: 1.66e-03
2022-04-27 22:54:54,124 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.392[s] Speed: 40.8[samples/s]
2022-04-27 22:56:56,140 reid_baseline.train INFO: normal accuracy 0.7766812026623824 2.855264902114868 
2022-04-27 22:56:56,143 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 22:56:56,143 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 285.5%
2022-04-27 22:57:38,598 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.968, Acc: 0.949, Base Lr: 1.19e-03
2022-04-27 22:58:11,257 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.969, Acc: 0.950, Base Lr: 1.19e-03
2022-04-27 22:58:44,146 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.395[s] Speed: 40.5[samples/s]
2022-04-27 23:00:47,555 reid_baseline.train INFO: normal accuracy 0.7732384668349782 2.8375189304351807 
2022-04-27 23:00:47,556 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 23:00:47,556 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 283.8%
2022-04-27 23:01:31,240 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.974, Acc: 0.944, Base Lr: 7.78e-04
2022-04-27 23:02:12,391 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.968, Acc: 0.949, Base Lr: 7.78e-04
2022-04-27 23:03:01,499 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.490[s] Speed: 32.6[samples/s]
2022-04-27 23:05:09,667 reid_baseline.train INFO: normal accuracy 0.7755336240532477 2.8745484352111816 
2022-04-27 23:05:09,668 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 23:05:09,668 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 287.5%
2022-04-27 23:06:51,024 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.954, Acc: 0.957, Base Lr: 4.51e-04
2022-04-27 23:08:12,921 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.957, Acc: 0.956, Base Lr: 4.51e-04
2022-04-27 23:09:12,331 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.887[s] Speed: 18.0[samples/s]
2022-04-27 23:11:17,212 reid_baseline.train INFO: normal accuracy 0.7736974982786321 2.8208537101745605 
2022-04-27 23:11:17,212 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 23:11:17,213 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 282.1%
2022-04-27 23:12:23,628 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.952, Acc: 0.954, Base Lr: 2.11e-04
2022-04-27 23:13:15,300 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.951, Acc: 0.956, Base Lr: 2.11e-04
2022-04-27 23:13:54,230 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.574[s] Speed: 27.9[samples/s]
2022-04-27 23:15:55,034 reid_baseline.train INFO: normal accuracy 0.7755336240532477 2.827108144760132 
2022-04-27 23:15:55,037 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 23:15:55,037 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 282.7%
2022-04-27 23:16:43,327 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.948, Acc: 0.957, Base Lr: 6.51e-05
2022-04-27 23:17:21,953 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.950, Acc: 0.959, Base Lr: 6.51e-05
2022-04-27 23:17:39,891 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-04-27 23:19:45,293 reid_baseline.train INFO: normal accuracy 0.7755336240532477 2.8088362216949463 
2022-04-27 23:19:45,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 23:19:45,296 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 280.9%
2022-04-27 23:21:07,250 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.952, Acc: 0.952, Base Lr: 1.60e-05
2022-04-27 23:22:31,151 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.952, Acc: 0.956, Base Lr: 1.60e-05
2022-04-27 23:23:34,357 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.839[s] Speed: 19.1[samples/s]
2022-04-27 23:25:39,227 reid_baseline.train INFO: normal accuracy 0.7753041083314207 2.889596700668335 
2022-04-27 23:25:39,227 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 23:25:39,227 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 289.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_cross_key_layer_12/transformer_best_model.pth
2022-04-27 23:27:48,461 reid_baseline.train INFO: normal accuracy 0.7677300895111315 2.7779879570007324 
2022-04-27 23:27:48,461 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 23:27:48,461 reid_baseline.train INFO: Accuracy: 76.8%
2022-04-27 23:30:08,266 reid_baseline.train INFO: normal accuracy 0.7677300895111315 2.7779879570007324 
2022-04-27 23:30:08,269 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 23:30:08,269 reid_baseline.train INFO: Shuffled Accuracy: 76.8%
2022-04-27 23:30:40,446 reid_baseline.train INFO: normal accuracy 0.9369988545246277 1.981525182723999 
2022-04-27 23:30:40,446 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 23:30:40,446 reid_baseline.train INFO: Source Clean Accuracy: 93.7%
