2022-04-19 03:26:04,221 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_4_20_10
2022-04-19 03:26:04,221 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_4_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-19 03:26:04,221 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 03:26:04,222 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 03:26:04,222 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_4_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 03:26:13,607 reid_baseline.train INFO: start training
2022-04-19 03:27:01,712 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.120, Acc: 0.241, Base Lr: 8.72e-04
2022-04-19 03:27:38,951 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.055, Acc: 0.366, Base Lr: 8.72e-04
2022-04-19 03:28:07,644 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.410[s] Speed: 39.0[samples/s]
2022-04-19 03:28:40,001 reid_baseline.train INFO: normal accuracy 0.5055624227441285 4.167189121246338 
2022-04-19 03:28:44,706 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 03:28:44,707 reid_baseline.train INFO: Accuracy: 50.6% Mean Entropy: 416.7%
2022-04-19 03:29:26,202 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.641, Acc: 0.549, Base Lr: 1.66e-03
2022-04-19 03:30:02,924 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.479, Acc: 0.557, Base Lr: 1.66e-03
2022-04-19 03:30:31,087 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.390[s] Speed: 41.1[samples/s]
2022-04-19 03:31:01,877 reid_baseline.train INFO: normal accuracy 0.5442933662958385 4.035552978515625 
2022-04-19 03:31:06,844 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 03:31:06,845 reid_baseline.train INFO: Accuracy: 54.4% Mean Entropy: 403.6%
2022-04-19 03:31:46,136 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.709, Acc: 0.611, Base Lr: 2.46e-03
2022-04-19 03:32:23,252 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.554, Acc: 0.626, Base Lr: 2.46e-03
2022-04-19 03:32:52,426 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.387[s] Speed: 41.4[samples/s]
2022-04-19 03:33:21,638 reid_baseline.train INFO: normal accuracy 0.6234033786567779 3.4488577842712402 
2022-04-19 03:33:24,741 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 03:33:24,742 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 344.9%
2022-04-19 03:34:04,959 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 1.999, Acc: 0.708, Base Lr: 3.25e-03
2022-04-19 03:34:41,694 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.943, Acc: 0.700, Base Lr: 3.25e-03
2022-04-19 03:35:09,581 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.384[s] Speed: 41.7[samples/s]
2022-04-19 03:35:39,468 reid_baseline.train INFO: normal accuracy 0.6798516687268232 2.8788466453552246 
2022-04-19 03:35:43,981 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 03:35:43,982 reid_baseline.train INFO: Accuracy: 68.0% Mean Entropy: 287.9%
2022-04-19 03:36:22,489 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.664, Acc: 0.739, Base Lr: 4.04e-03
2022-04-19 03:37:02,680 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.617, Acc: 0.750, Base Lr: 4.04e-03
2022-04-19 03:37:31,862 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.395[s] Speed: 40.5[samples/s]
2022-04-19 03:37:54,609 reid_baseline.train INFO: normal accuracy 0.7099299546765554 2.5738823413848877 
2022-04-19 03:37:57,703 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 03:37:57,704 reid_baseline.train INFO: Accuracy: 71.0% Mean Entropy: 257.4%
2022-04-19 03:38:38,630 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.459, Acc: 0.805, Base Lr: 4.83e-03
2022-04-19 03:39:16,270 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.444, Acc: 0.801, Base Lr: 4.83e-03
2022-04-19 03:39:44,465 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.391[s] Speed: 40.9[samples/s]
2022-04-19 03:40:13,735 reid_baseline.train INFO: normal accuracy 0.7185826122785332 2.371371269226074 
2022-04-19 03:40:16,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 03:40:16,934 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 237.1%
2022-04-19 03:40:53,753 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.340, Acc: 0.832, Base Lr: 5.62e-03
2022-04-19 03:41:32,023 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.328, Acc: 0.834, Base Lr: 5.62e-03
2022-04-19 03:42:02,161 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.385[s] Speed: 41.5[samples/s]
2022-04-19 03:42:25,505 reid_baseline.train INFO: normal accuracy 0.7189946435929131 2.1809730529785156 
2022-04-19 03:42:28,618 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 03:42:28,619 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 218.1%
2022-04-19 03:43:04,337 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.261, Acc: 0.844, Base Lr: 6.42e-03
2022-04-19 03:43:40,653 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.273, Acc: 0.843, Base Lr: 6.42e-03
2022-04-19 03:44:08,758 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-19 03:44:33,481 reid_baseline.train INFO: normal accuracy 0.7321796456530696 2.100771427154541 
2022-04-19 03:44:36,592 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 03:44:36,593 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 210.1%
2022-04-19 03:45:14,136 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.183, Acc: 0.881, Base Lr: 7.21e-03
2022-04-19 03:45:49,291 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.197, Acc: 0.871, Base Lr: 7.21e-03
2022-04-19 03:46:17,311 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-04-19 03:46:42,360 reid_baseline.train INFO: normal accuracy 0.7284713638236506 1.973706603050232 
2022-04-19 03:46:45,811 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 03:46:45,812 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 197.4%
2022-04-19 03:47:27,207 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.154, Acc: 0.878, Base Lr: 4.01e-03
2022-04-19 03:48:00,814 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.140, Acc: 0.886, Base Lr: 4.01e-03
2022-04-19 03:48:28,859 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.377[s] Speed: 42.4[samples/s]
2022-04-19 03:49:00,169 reid_baseline.train INFO: normal accuracy 0.7379480840543882 2.003117561340332 
2022-04-19 03:49:00,171 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 03:49:00,172 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 200.3%
2022-04-19 03:49:37,908 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.087, Acc: 0.908, Base Lr: 3.38e-03
2022-04-19 03:50:09,347 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.101, Acc: 0.901, Base Lr: 3.38e-03
2022-04-19 03:50:36,561 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.353[s] Speed: 45.3[samples/s]
2022-04-19 03:51:00,109 reid_baseline.train INFO: normal accuracy 0.7424804285125669 1.9442119598388672 
2022-04-19 03:51:03,201 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 03:51:03,202 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 194.4%
2022-04-19 03:51:43,690 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.068, Acc: 0.910, Base Lr: 2.77e-03
2022-04-19 03:52:20,447 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.083, Acc: 0.907, Base Lr: 2.77e-03
2022-04-19 03:52:45,731 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-04-19 03:53:11,791 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.913313865661621 
2022-04-19 03:53:14,902 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 03:53:14,903 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 191.3%
2022-04-19 03:53:55,334 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.034, Acc: 0.923, Base Lr: 2.20e-03
2022-04-19 03:54:33,397 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.048, Acc: 0.919, Base Lr: 2.20e-03
2022-04-19 03:54:55,024 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-19 03:55:21,833 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.8617914915084839 
2022-04-19 03:55:24,930 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 03:55:24,932 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 186.2%
2022-04-19 03:56:07,775 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.043, Acc: 0.924, Base Lr: 1.66e-03
2022-04-19 03:56:39,365 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.040, Acc: 0.926, Base Lr: 1.66e-03
2022-04-19 03:57:01,704 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.354[s] Speed: 45.1[samples/s]
2022-04-19 03:57:27,475 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.9203274250030518 
2022-04-19 03:57:27,477 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 03:57:27,477 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 192.0%
2022-04-19 03:58:07,781 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.045, Acc: 0.920, Base Lr: 1.19e-03
2022-04-19 03:58:44,762 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.037, Acc: 0.925, Base Lr: 1.19e-03
2022-04-19 03:59:12,887 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.386[s] Speed: 41.4[samples/s]
2022-04-19 03:59:42,782 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8466249704360962 
2022-04-19 03:59:45,905 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 03:59:45,906 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 184.7%
2022-04-19 04:00:23,120 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.051, Acc: 0.917, Base Lr: 7.78e-04
2022-04-19 04:00:59,398 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.038, Acc: 0.923, Base Lr: 7.78e-04
2022-04-19 04:01:28,257 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.375[s] Speed: 42.7[samples/s]
2022-04-19 04:01:58,692 reid_baseline.train INFO: normal accuracy 0.7441285537700866 1.9014769792556763 
2022-04-19 04:01:58,692 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 04:01:58,692 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 190.1%
2022-04-19 04:02:41,658 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.046, Acc: 0.921, Base Lr: 4.51e-04
2022-04-19 04:03:18,279 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.030, Acc: 0.924, Base Lr: 4.51e-04
2022-04-19 04:03:46,332 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.394[s] Speed: 40.6[samples/s]
2022-04-19 04:04:18,093 reid_baseline.train INFO: normal accuracy 0.749896992171405 1.8523108959197998 
2022-04-19 04:04:18,098 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 04:04:18,098 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 185.2%
2022-04-19 04:04:52,554 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.022, Acc: 0.933, Base Lr: 2.11e-04
2022-04-19 04:05:29,095 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.018, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 04:05:59,107 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.370[s] Speed: 43.2[samples/s]
2022-04-19 04:06:22,370 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.8795902729034424 
2022-04-19 04:06:22,371 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 04:06:22,371 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 188.0%
2022-04-19 04:06:56,722 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.011, Acc: 0.928, Base Lr: 6.51e-05
2022-04-19 04:07:35,409 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.013, Acc: 0.927, Base Lr: 6.51e-05
2022-04-19 04:08:03,939 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-19 04:08:28,195 reid_baseline.train INFO: normal accuracy 0.749896992171405 1.8667855262756348 
2022-04-19 04:08:28,199 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 04:08:28,200 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 186.7%
2022-04-19 04:09:04,891 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.032, Acc: 0.921, Base Lr: 1.60e-05
2022-04-19 04:09:40,331 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.025, Acc: 0.926, Base Lr: 1.60e-05
2022-04-19 04:10:09,394 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.371[s] Speed: 43.2[samples/s]
2022-04-19 04:10:39,721 reid_baseline.train INFO: normal accuracy 0.749896992171405 1.8965394496917725 
2022-04-19 04:10:39,721 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 04:10:39,722 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 189.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_4_20_10/transformer_best_model.pth
2022-04-19 04:11:07,417 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8466249704360962 
2022-04-19 04:11:07,417 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:11:07,417 reid_baseline.train INFO: Accuracy: 74.5%
2022-04-19 04:11:39,106 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8466249704360962 
2022-04-19 04:11:39,107 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:11:39,107 reid_baseline.train INFO: Shuffled Accuracy: 74.5%
2022-04-19 04:12:09,585 reid_baseline.train INFO: normal accuracy 0.9573883161512028 0.8157070279121399 
2022-04-19 04:12:09,585 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:12:09,585 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-04-19 04:12:13,567 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_4_20_10
2022-04-19 04:12:13,567 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_4_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-19 04:12:13,567 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 04:12:13,568 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 04:12:13,568 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_4_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 04:12:22,468 reid_baseline.train INFO: start training
2022-04-19 04:13:11,130 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.120, Acc: 0.241, Base Lr: 8.72e-04
2022-04-19 04:13:44,100 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.055, Acc: 0.365, Base Lr: 8.72e-04
2022-04-19 04:14:09,653 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.386[s] Speed: 41.4[samples/s]
2022-04-19 04:14:43,824 reid_baseline.train INFO: normal accuracy 0.5647668393782384 4.165721416473389 
2022-04-19 04:14:47,186 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 04:14:47,187 reid_baseline.train INFO: Accuracy: 56.5% Mean Entropy: 416.6%
2022-04-19 04:15:28,929 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.641, Acc: 0.549, Base Lr: 1.66e-03
2022-04-19 04:15:59,122 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.479, Acc: 0.558, Base Lr: 1.66e-03
2022-04-19 04:16:25,980 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.362[s] Speed: 44.2[samples/s]
2022-04-19 04:16:52,748 reid_baseline.train INFO: normal accuracy 0.5839152962378914 3.9824881553649902 
2022-04-19 04:16:55,967 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 04:16:55,967 reid_baseline.train INFO: Accuracy: 58.4% Mean Entropy: 398.2%
2022-04-19 04:17:37,975 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.709, Acc: 0.610, Base Lr: 2.46e-03
2022-04-19 04:18:15,909 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.554, Acc: 0.626, Base Lr: 2.46e-03
2022-04-19 04:18:44,665 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.398[s] Speed: 40.2[samples/s]
2022-04-19 04:19:14,880 reid_baseline.train INFO: normal accuracy 0.6526244649695877 3.232581377029419 
2022-04-19 04:19:18,371 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 04:19:18,372 reid_baseline.train INFO: Accuracy: 65.3% Mean Entropy: 323.3%
2022-04-19 04:19:59,614 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 1.999, Acc: 0.707, Base Lr: 3.25e-03
2022-04-19 04:20:39,530 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.943, Acc: 0.699, Base Lr: 3.25e-03
2022-04-19 04:21:04,900 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.390[s] Speed: 41.0[samples/s]
2022-04-19 04:21:31,206 reid_baseline.train INFO: normal accuracy 0.7062401441766164 2.597154140472412 
2022-04-19 04:21:34,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 04:21:34,858 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 259.7%
2022-04-19 04:22:17,901 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.664, Acc: 0.739, Base Lr: 4.04e-03
2022-04-19 04:22:58,597 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.617, Acc: 0.751, Base Lr: 4.04e-03
2022-04-19 04:23:24,317 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.401[s] Speed: 39.9[samples/s]
2022-04-19 04:23:55,430 reid_baseline.train INFO: normal accuracy 0.7274160847037621 2.28098201751709 
2022-04-19 04:23:58,689 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 04:23:58,690 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 228.1%
2022-04-19 04:24:39,730 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.458, Acc: 0.805, Base Lr: 4.83e-03
2022-04-19 04:25:17,282 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.444, Acc: 0.801, Base Lr: 4.83e-03
2022-04-19 04:25:45,732 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.392[s] Speed: 40.8[samples/s]
2022-04-19 04:26:11,999 reid_baseline.train INFO: normal accuracy 0.7404820905609372 2.102215051651001 
2022-04-19 04:26:15,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 04:26:15,163 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 210.2%
2022-04-19 04:26:54,321 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.340, Acc: 0.831, Base Lr: 5.62e-03
2022-04-19 04:27:32,386 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.328, Acc: 0.834, Base Lr: 5.62e-03
2022-04-19 04:28:03,097 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.395[s] Speed: 40.5[samples/s]
2022-04-19 04:28:34,404 reid_baseline.train INFO: normal accuracy 0.7456634377111963 1.9367001056671143 
2022-04-19 04:28:37,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 04:28:37,621 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 193.7%
2022-04-19 04:29:11,012 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.261, Acc: 0.843, Base Lr: 6.42e-03
2022-04-19 04:29:47,752 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.273, Acc: 0.845, Base Lr: 6.42e-03
2022-04-19 04:30:12,465 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-19 04:30:46,042 reid_baseline.train INFO: normal accuracy 0.7591799954944808 1.888741374015808 
2022-04-19 04:30:49,608 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 04:30:49,608 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 188.9%
2022-04-19 04:31:22,104 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.182, Acc: 0.879, Base Lr: 7.21e-03
2022-04-19 04:31:55,186 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.197, Acc: 0.871, Base Lr: 7.21e-03
2022-04-19 04:32:23,313 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-19 04:32:49,587 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.8366830348968506 
2022-04-19 04:32:53,257 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 04:32:53,257 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 183.7%
2022-04-19 04:33:26,322 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.154, Acc: 0.878, Base Lr: 4.01e-03
2022-04-19 04:33:57,488 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.140, Acc: 0.887, Base Lr: 4.01e-03
2022-04-19 04:34:18,334 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-19 04:34:55,549 reid_baseline.train INFO: normal accuracy 0.7591799954944808 1.839429259300232 
2022-04-19 04:34:55,552 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 04:34:55,552 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 183.9%
2022-04-19 04:35:29,417 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.088, Acc: 0.908, Base Lr: 3.38e-03
2022-04-19 04:36:02,398 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.101, Acc: 0.902, Base Lr: 3.38e-03
2022-04-19 04:36:24,236 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.325[s] Speed: 49.3[samples/s]
2022-04-19 04:36:55,320 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7907572984695435 
2022-04-19 04:37:00,809 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 04:37:00,809 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 179.1%
2022-04-19 04:37:40,405 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.068, Acc: 0.910, Base Lr: 2.77e-03
2022-04-19 04:38:18,274 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.083, Acc: 0.908, Base Lr: 2.77e-03
2022-04-19 04:38:40,322 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.365[s] Speed: 43.9[samples/s]
2022-04-19 04:39:18,811 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.7410160303115845 
2022-04-19 04:39:22,610 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 04:39:22,611 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 174.1%
2022-04-19 04:39:56,006 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.035, Acc: 0.923, Base Lr: 2.20e-03
2022-04-19 04:40:30,978 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.048, Acc: 0.919, Base Lr: 2.20e-03
2022-04-19 04:40:56,895 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.345[s] Speed: 46.3[samples/s]
2022-04-19 04:41:28,048 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.7207143306732178 
2022-04-19 04:41:31,235 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 04:41:31,236 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 172.1%
2022-04-19 04:42:02,042 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.044, Acc: 0.924, Base Lr: 1.66e-03
2022-04-19 04:42:35,622 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.041, Acc: 0.926, Base Lr: 1.66e-03
2022-04-19 04:42:59,760 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.324[s] Speed: 49.3[samples/s]
2022-04-19 04:43:27,044 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.7941144704818726 
2022-04-19 04:43:27,047 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 04:43:27,047 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 179.4%
2022-04-19 04:44:04,496 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.045, Acc: 0.918, Base Lr: 1.19e-03
2022-04-19 04:44:36,646 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.037, Acc: 0.923, Base Lr: 1.19e-03
2022-04-19 04:45:01,118 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-19 04:45:30,569 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.7188388109207153 
2022-04-19 04:45:33,917 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 04:45:33,917 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 171.9%
2022-04-19 04:46:16,275 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.050, Acc: 0.917, Base Lr: 7.78e-04
2022-04-19 04:46:51,466 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.038, Acc: 0.924, Base Lr: 7.78e-04
2022-04-19 04:47:14,532 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-04-19 04:47:46,505 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.7790400981903076 
2022-04-19 04:47:46,506 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 04:47:46,506 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 177.9%
2022-04-19 04:48:18,813 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.046, Acc: 0.921, Base Lr: 4.51e-04
2022-04-19 04:48:56,405 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.030, Acc: 0.924, Base Lr: 4.51e-04
2022-04-19 04:49:23,209 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-19 04:49:54,476 reid_baseline.train INFO: normal accuracy 0.7767515206127507 1.73002290725708 
2022-04-19 04:49:54,477 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 04:49:54,477 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 173.0%
2022-04-19 04:50:24,953 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.022, Acc: 0.931, Base Lr: 2.11e-04
2022-04-19 04:50:55,405 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.018, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 04:51:20,832 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-19 04:51:47,852 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.745841383934021 
2022-04-19 04:51:47,854 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 04:51:47,854 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 174.6%
2022-04-19 04:52:20,903 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.011, Acc: 0.930, Base Lr: 6.51e-05
2022-04-19 04:52:52,557 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.013, Acc: 0.928, Base Lr: 6.51e-05
2022-04-19 04:53:15,476 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-19 04:53:46,864 reid_baseline.train INFO: normal accuracy 0.7787790042802433 1.735985279083252 
2022-04-19 04:53:46,866 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 04:53:46,866 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 173.6%
2022-04-19 04:54:24,696 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.031, Acc: 0.920, Base Lr: 1.60e-05
2022-04-19 04:54:58,236 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.025, Acc: 0.926, Base Lr: 1.60e-05
2022-04-19 04:55:21,169 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.345[s] Speed: 46.3[samples/s]
2022-04-19 04:55:57,275 reid_baseline.train INFO: normal accuracy 0.7758504167605317 1.7721165418624878 
2022-04-19 04:55:57,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 04:55:57,277 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 177.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_4_20_10/transformer_best_model.pth
2022-04-19 04:56:29,690 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.7188388109207153 
2022-04-19 04:56:29,690 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:56:29,690 reid_baseline.train INFO: Accuracy: 77.5%
2022-04-19 04:57:05,391 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.7188388109207153 
2022-04-19 04:57:05,391 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:57:05,392 reid_baseline.train INFO: Shuffled Accuracy: 77.5%
2022-04-19 04:57:32,742 reid_baseline.train INFO: normal accuracy 0.9573883161512028 0.815994381904602 
2022-04-19 04:57:32,742 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:57:32,742 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-04-19 04:57:38,163 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_4_20_10
2022-04-19 04:57:38,163 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_4_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-19 04:57:38,163 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 04:57:38,164 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 04:57:38,164 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_4_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 04:57:45,810 reid_baseline.train INFO: start training
2022-04-19 04:58:24,400 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.120, Acc: 0.241, Base Lr: 8.72e-04
2022-04-19 04:58:54,881 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.055, Acc: 0.366, Base Lr: 8.72e-04
2022-04-19 04:59:19,783 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.341[s] Speed: 47.0[samples/s]
2022-04-19 05:01:08,415 reid_baseline.train INFO: normal accuracy 0.5728712416800551 4.166800498962402 
2022-04-19 05:01:11,511 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 05:01:11,512 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 416.7%
2022-04-19 05:01:43,822 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.641, Acc: 0.549, Base Lr: 1.66e-03
2022-04-19 05:02:16,937 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.479, Acc: 0.557, Base Lr: 1.66e-03
2022-04-19 05:02:44,720 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-19 05:04:31,290 reid_baseline.train INFO: normal accuracy 0.5974294239155382 4.008573532104492 
2022-04-19 05:04:34,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 05:04:34,412 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 400.9%
2022-04-19 05:05:08,012 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.709, Acc: 0.611, Base Lr: 2.46e-03
2022-04-19 05:05:37,873 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.554, Acc: 0.626, Base Lr: 2.46e-03
2022-04-19 05:05:53,302 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-19 05:07:38,460 reid_baseline.train INFO: normal accuracy 0.6795960523295845 3.2968766689300537 
2022-04-19 05:07:41,745 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 05:07:41,746 reid_baseline.train INFO: Accuracy: 68.0% Mean Entropy: 329.7%
2022-04-19 05:08:16,439 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 1.999, Acc: 0.708, Base Lr: 3.25e-03
2022-04-19 05:08:42,789 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.943, Acc: 0.700, Base Lr: 3.25e-03
2022-04-19 05:08:59,618 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.285[s] Speed: 56.1[samples/s]
2022-04-19 05:10:47,474 reid_baseline.train INFO: normal accuracy 0.7374340142299748 2.6603665351867676 
2022-04-19 05:10:50,639 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 05:10:50,640 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 266.0%
2022-04-19 05:11:19,172 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.664, Acc: 0.739, Base Lr: 4.04e-03
2022-04-19 05:11:47,176 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.617, Acc: 0.750, Base Lr: 4.04e-03
2022-04-19 05:12:05,253 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.273[s] Speed: 58.5[samples/s]
2022-04-19 05:13:46,164 reid_baseline.train INFO: normal accuracy 0.7562543034197843 2.3438034057617188 
2022-04-19 05:13:49,355 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 05:13:49,355 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 234.4%
2022-04-19 05:14:19,878 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.459, Acc: 0.806, Base Lr: 4.83e-03
2022-04-19 05:14:47,236 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.444, Acc: 0.802, Base Lr: 4.83e-03
2022-04-19 05:15:07,358 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-19 05:16:46,586 reid_baseline.train INFO: normal accuracy 0.7750745926095938 2.152141571044922 
2022-04-19 05:16:49,716 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 05:16:49,717 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 215.2%
2022-04-19 05:17:20,351 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.340, Acc: 0.833, Base Lr: 5.62e-03
2022-04-19 05:17:46,003 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.328, Acc: 0.834, Base Lr: 5.62e-03
2022-04-19 05:18:04,631 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.274[s] Speed: 58.3[samples/s]
2022-04-19 05:19:56,389 reid_baseline.train INFO: normal accuracy 0.7789763598806518 1.96224844455719 
2022-04-19 05:19:59,540 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 05:19:59,541 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 196.2%
2022-04-19 05:20:29,705 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.262, Acc: 0.844, Base Lr: 6.42e-03
2022-04-19 05:20:52,794 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.273, Acc: 0.843, Base Lr: 6.42e-03
2022-04-19 05:21:14,789 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.275[s] Speed: 58.1[samples/s]
2022-04-19 05:23:04,418 reid_baseline.train INFO: normal accuracy 0.7858618315354602 1.9083034992218018 
2022-04-19 05:23:07,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 05:23:07,622 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 190.8%
2022-04-19 05:23:34,043 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.183, Acc: 0.878, Base Lr: 7.21e-03
2022-04-19 05:23:59,516 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.197, Acc: 0.871, Base Lr: 7.21e-03
2022-04-19 05:24:19,124 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.262[s] Speed: 61.1[samples/s]
2022-04-19 05:26:13,369 reid_baseline.train INFO: normal accuracy 0.7812715170989213 1.8029239177703857 
2022-04-19 05:26:16,466 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 05:26:16,468 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 180.3%
2022-04-19 05:26:48,434 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.154, Acc: 0.877, Base Lr: 4.01e-03
2022-04-19 05:27:10,733 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.140, Acc: 0.886, Base Lr: 4.01e-03
2022-04-19 05:27:29,260 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.266[s] Speed: 60.1[samples/s]
2022-04-19 05:29:19,253 reid_baseline.train INFO: normal accuracy 0.7874684415882488 1.8499536514282227 
2022-04-19 05:29:19,260 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 05:29:19,260 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 185.0%
2022-04-19 05:29:56,739 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.087, Acc: 0.908, Base Lr: 3.38e-03
2022-04-19 05:30:30,895 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.102, Acc: 0.900, Base Lr: 3.38e-03
2022-04-19 05:30:54,147 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-19 05:32:54,622 reid_baseline.train INFO: normal accuracy 0.786550378700941 1.7980146408081055 
2022-04-19 05:32:57,788 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 05:32:57,790 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 179.8%
2022-04-19 05:33:38,185 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.068, Acc: 0.908, Base Lr: 2.77e-03
2022-04-19 05:34:15,039 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.083, Acc: 0.907, Base Lr: 2.77e-03
2022-04-19 05:34:36,973 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.363[s] Speed: 44.0[samples/s]
2022-04-19 05:36:36,573 reid_baseline.train INFO: normal accuracy 0.790911177415653 1.7540059089660645 
2022-04-19 05:36:41,939 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 05:36:41,940 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 175.4%
2022-04-19 05:37:21,140 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.035, Acc: 0.924, Base Lr: 2.20e-03
2022-04-19 05:38:00,725 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.048, Acc: 0.918, Base Lr: 2.20e-03
2022-04-19 05:38:17,653 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.351[s] Speed: 45.6[samples/s]
2022-04-19 05:40:12,351 reid_baseline.train INFO: normal accuracy 0.7899931145283452 1.7161918878555298 
2022-04-19 05:40:16,090 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 05:40:16,091 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 171.6%
2022-04-19 05:40:56,221 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.045, Acc: 0.924, Base Lr: 1.66e-03
2022-04-19 05:41:34,934 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.041, Acc: 0.926, Base Lr: 1.66e-03
2022-04-19 05:41:59,224 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.378[s] Speed: 42.4[samples/s]
2022-04-19 05:43:59,711 reid_baseline.train INFO: normal accuracy 0.7927473031902685 1.786008596420288 
2022-04-19 05:43:59,712 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 05:43:59,712 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 178.6%
2022-04-19 05:44:41,128 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.045, Acc: 0.919, Base Lr: 1.19e-03
2022-04-19 05:45:19,895 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.037, Acc: 0.924, Base Lr: 1.19e-03
2022-04-19 05:45:49,337 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.402[s] Speed: 39.8[samples/s]
2022-04-19 05:47:44,690 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.7146379947662354 
2022-04-19 05:47:47,921 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 05:47:47,921 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 171.5%
2022-04-19 05:48:27,244 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.051, Acc: 0.916, Base Lr: 7.78e-04
2022-04-19 05:49:05,287 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.038, Acc: 0.922, Base Lr: 7.78e-04
2022-04-19 05:49:34,567 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.391[s] Speed: 41.0[samples/s]
2022-04-19 05:51:31,817 reid_baseline.train INFO: normal accuracy 0.7936653660775763 1.7774291038513184 
2022-04-19 05:51:31,820 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 05:51:31,820 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 177.7%
2022-04-19 05:52:09,712 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.046, Acc: 0.922, Base Lr: 4.51e-04
2022-04-19 05:52:47,735 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.030, Acc: 0.925, Base Lr: 4.51e-04
2022-04-19 05:53:16,930 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.385[s] Speed: 41.6[samples/s]
2022-04-19 05:55:14,741 reid_baseline.train INFO: normal accuracy 0.795042460408538 1.722681999206543 
2022-04-19 05:55:14,741 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 05:55:14,741 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 172.3%
2022-04-19 05:55:50,452 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.022, Acc: 0.933, Base Lr: 2.11e-04
2022-04-19 05:56:27,705 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.018, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 05:56:57,551 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.377[s] Speed: 42.5[samples/s]
2022-04-19 05:58:47,043 reid_baseline.train INFO: normal accuracy 0.7913702088593069 1.7437663078308105 
2022-04-19 05:58:47,045 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 05:58:47,045 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 174.4%
2022-04-19 05:59:18,419 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.011, Acc: 0.927, Base Lr: 6.51e-05
2022-04-19 05:59:55,419 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.013, Acc: 0.927, Base Lr: 6.51e-05
2022-04-19 06:00:24,317 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.356[s] Speed: 44.9[samples/s]
2022-04-19 06:02:28,536 reid_baseline.train INFO: normal accuracy 0.7927473031902685 1.7365056276321411 
2022-04-19 06:02:28,537 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 06:02:28,537 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 173.7%
2022-04-19 06:03:02,607 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.032, Acc: 0.920, Base Lr: 1.60e-05
2022-04-19 06:03:41,228 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.026, Acc: 0.926, Base Lr: 1.60e-05
2022-04-19 06:04:09,578 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.370[s] Speed: 43.2[samples/s]
2022-04-19 06:06:07,854 reid_baseline.train INFO: normal accuracy 0.7941243975212302 1.7666934728622437 
2022-04-19 06:06:07,856 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 06:06:07,856 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 176.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_4_20_10/transformer_best_model.pth
2022-04-19 06:07:49,786 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.7146379947662354 
2022-04-19 06:07:49,787 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:07:49,787 reid_baseline.train INFO: Accuracy: 79.2%
2022-04-19 06:09:44,131 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.7146379947662354 
2022-04-19 06:09:44,132 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:09:44,132 reid_baseline.train INFO: Shuffled Accuracy: 79.2%
2022-04-19 06:10:14,132 reid_baseline.train INFO: normal accuracy 0.9557846506300115 0.8161032795906067 
2022-04-19 06:10:14,132 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:10:14,132 reid_baseline.train INFO: Source Clean Accuracy: 95.6%
2022-04-19 06:10:19,368 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_6_20_10
2022-04-19 06:10:19,368 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_6_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-19 06:10:19,368 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 06:10:19,368 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 06:10:19,369 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_6_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 06:10:28,450 reid_baseline.train INFO: start training
2022-04-19 06:11:16,170 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.120, Acc: 0.256, Base Lr: 8.72e-04
2022-04-19 06:11:53,314 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.054, Acc: 0.363, Base Lr: 8.72e-04
2022-04-19 06:12:14,582 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.377[s] Speed: 42.4[samples/s]
2022-04-19 06:12:48,334 reid_baseline.train INFO: normal accuracy 0.49979398434281 4.167088031768799 
2022-04-19 06:12:51,353 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 06:12:51,354 reid_baseline.train INFO: Accuracy: 50.0% Mean Entropy: 416.7%
2022-04-19 06:13:24,093 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.647, Acc: 0.541, Base Lr: 1.66e-03
2022-04-19 06:13:53,667 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.481, Acc: 0.562, Base Lr: 1.66e-03
2022-04-19 06:14:14,245 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-19 06:14:45,600 reid_baseline.train INFO: normal accuracy 0.5525339925834364 4.040445804595947 
2022-04-19 06:14:48,954 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 06:14:48,955 reid_baseline.train INFO: Accuracy: 55.3% Mean Entropy: 404.0%
2022-04-19 06:15:21,492 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.730, Acc: 0.597, Base Lr: 2.46e-03
2022-04-19 06:15:52,641 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.557, Acc: 0.616, Base Lr: 2.46e-03
2022-04-19 06:16:14,269 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-19 06:16:47,222 reid_baseline.train INFO: normal accuracy 0.6266996291718171 3.4795660972595215 
2022-04-19 06:16:50,567 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 06:16:50,567 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 348.0%
2022-04-19 06:17:24,105 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.013, Acc: 0.693, Base Lr: 3.25e-03
2022-04-19 06:17:59,695 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.934, Acc: 0.697, Base Lr: 3.25e-03
2022-04-19 06:18:20,141 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-19 06:18:43,926 reid_baseline.train INFO: normal accuracy 0.6823238566131026 2.892016887664795 
2022-04-19 06:18:47,088 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 06:18:47,088 reid_baseline.train INFO: Accuracy: 68.2% Mean Entropy: 289.2%
2022-04-19 06:19:28,091 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.614, Acc: 0.765, Base Lr: 4.04e-03
2022-04-19 06:20:06,792 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.600, Acc: 0.763, Base Lr: 4.04e-03
2022-04-19 06:20:30,078 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.377[s] Speed: 42.4[samples/s]
2022-04-19 06:20:57,907 reid_baseline.train INFO: normal accuracy 0.6955088586732592 2.5328404903411865 
2022-04-19 06:21:01,088 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 06:21:01,089 reid_baseline.train INFO: Accuracy: 69.6% Mean Entropy: 253.3%
2022-04-19 06:21:42,105 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.452, Acc: 0.798, Base Lr: 4.83e-03
2022-04-19 06:22:19,722 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.442, Acc: 0.800, Base Lr: 4.83e-03
2022-04-19 06:22:45,005 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.381[s] Speed: 42.0[samples/s]
2022-04-19 06:23:09,020 reid_baseline.train INFO: normal accuracy 0.7144622991347342 2.3131420612335205 
2022-04-19 06:23:13,481 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 06:23:13,481 reid_baseline.train INFO: Accuracy: 71.4% Mean Entropy: 231.3%
2022-04-19 06:23:55,795 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.342, Acc: 0.831, Base Lr: 5.62e-03
2022-04-19 06:24:34,364 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.338, Acc: 0.832, Base Lr: 5.62e-03
2022-04-19 06:24:59,634 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.389[s] Speed: 41.1[samples/s]
2022-04-19 06:25:28,050 reid_baseline.train INFO: normal accuracy 0.7214668314791924 2.1684458255767822 
2022-04-19 06:25:31,181 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 06:25:31,181 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 216.8%
2022-04-19 06:26:09,732 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.262, Acc: 0.848, Base Lr: 6.42e-03
2022-04-19 06:26:47,161 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.244, Acc: 0.854, Base Lr: 6.42e-03
2022-04-19 06:27:12,490 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.371[s] Speed: 43.1[samples/s]
2022-04-19 06:27:41,519 reid_baseline.train INFO: normal accuracy 0.723114956736712 2.1115341186523438 
2022-04-19 06:27:44,751 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 06:27:44,752 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 211.2%
2022-04-19 06:28:18,867 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.173, Acc: 0.880, Base Lr: 7.21e-03
2022-04-19 06:28:52,778 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.178, Acc: 0.877, Base Lr: 7.21e-03
2022-04-19 06:29:17,779 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.341[s] Speed: 47.0[samples/s]
2022-04-19 06:29:45,940 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.9399917125701904 
2022-04-19 06:29:49,235 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 06:29:49,237 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 194.0%
2022-04-19 06:30:22,790 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.154, Acc: 0.892, Base Lr: 4.01e-03
2022-04-19 06:30:53,007 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.138, Acc: 0.891, Base Lr: 4.01e-03
2022-04-19 06:31:12,582 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-19 06:31:42,546 reid_baseline.train INFO: normal accuracy 0.7371240214256284 1.9305248260498047 
2022-04-19 06:31:47,313 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 06:31:47,314 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 193.1%
2022-04-19 06:32:21,341 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.095, Acc: 0.907, Base Lr: 3.38e-03
2022-04-19 06:32:51,739 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.099, Acc: 0.903, Base Lr: 3.38e-03
2022-04-19 06:33:12,179 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-19 06:33:40,919 reid_baseline.train INFO: normal accuracy 0.7379480840543882 1.9067734479904175 
2022-04-19 06:33:47,309 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 06:33:47,309 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 190.7%
2022-04-19 06:34:27,916 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.083, Acc: 0.906, Base Lr: 2.77e-03
2022-04-19 06:35:01,749 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.088, Acc: 0.906, Base Lr: 2.77e-03
2022-04-19 06:35:22,010 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-19 06:35:53,927 reid_baseline.train INFO: normal accuracy 0.7350638648537289 1.9894392490386963 
2022-04-19 06:35:53,928 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 06:35:53,928 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 198.9%
2022-04-19 06:36:28,876 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.058, Acc: 0.919, Base Lr: 2.20e-03
2022-04-19 06:37:04,774 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.053, Acc: 0.919, Base Lr: 2.20e-03
2022-04-19 06:37:28,833 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-19 06:37:59,366 reid_baseline.train INFO: normal accuracy 0.7391841779975278 1.8787758350372314 
2022-04-19 06:38:02,551 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 06:38:02,552 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 187.9%
2022-04-19 06:38:36,766 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.048, Acc: 0.917, Base Lr: 1.66e-03
2022-04-19 06:39:10,164 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.053, Acc: 0.915, Base Lr: 1.66e-03
2022-04-19 06:39:35,633 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-19 06:40:03,461 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.8770827054977417 
2022-04-19 06:40:08,320 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 06:40:08,321 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 187.7%
2022-04-19 06:40:39,757 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.018, Acc: 0.919, Base Lr: 1.19e-03
2022-04-19 06:41:12,006 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.029, Acc: 0.920, Base Lr: 1.19e-03
2022-04-19 06:41:30,170 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-19 06:42:00,234 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.8812007904052734 
2022-04-19 06:42:00,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 06:42:00,238 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 188.1%
2022-04-19 06:42:40,711 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.011, Acc: 0.935, Base Lr: 7.78e-04
2022-04-19 06:43:11,173 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.016, Acc: 0.932, Base Lr: 7.78e-04
2022-04-19 06:43:30,561 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-19 06:44:03,853 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8936855792999268 
2022-04-19 06:44:03,858 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 06:44:03,858 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 189.4%
2022-04-19 06:44:34,063 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.023, Acc: 0.922, Base Lr: 4.51e-04
2022-04-19 06:45:13,055 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.020, Acc: 0.927, Base Lr: 4.51e-04
2022-04-19 06:45:36,094 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.338[s] Speed: 47.4[samples/s]
2022-04-19 06:46:06,498 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.8936290740966797 
2022-04-19 06:46:06,503 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 06:46:06,503 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 189.4%
2022-04-19 06:46:39,087 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.998, Acc: 0.935, Base Lr: 2.11e-04
2022-04-19 06:47:09,888 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.010, Acc: 0.930, Base Lr: 2.11e-04
2022-04-19 06:47:34,350 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-19 06:48:01,102 reid_baseline.train INFO: normal accuracy 0.7470127729707458 1.8888328075408936 
2022-04-19 06:48:01,107 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 06:48:01,107 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 188.9%
2022-04-19 06:48:34,439 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.013, Acc: 0.925, Base Lr: 6.51e-05
2022-04-19 06:49:07,717 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.016, Acc: 0.928, Base Lr: 6.51e-05
2022-04-19 06:49:30,841 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.329[s] Speed: 48.7[samples/s]
2022-04-19 06:50:04,327 reid_baseline.train INFO: normal accuracy 0.7470127729707458 1.8882063627243042 
2022-04-19 06:50:04,331 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 06:50:04,332 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 188.8%
2022-04-19 06:50:40,898 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.016, Acc: 0.934, Base Lr: 1.60e-05
2022-04-19 06:51:12,148 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.017, Acc: 0.932, Base Lr: 1.60e-05
2022-04-19 06:51:33,894 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-19 06:52:08,404 reid_baseline.train INFO: normal accuracy 0.7437165224557066 1.8956348896026611 
2022-04-19 06:52:08,404 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 06:52:08,405 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 189.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_6_20_10/transformer_best_model.pth
2022-04-19 06:52:40,509 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.8770827054977417 
2022-04-19 06:52:40,509 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:52:40,509 reid_baseline.train INFO: Accuracy: 73.9%
2022-04-19 06:53:04,655 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.8770827054977417 
2022-04-19 06:53:04,655 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:53:04,655 reid_baseline.train INFO: Shuffled Accuracy: 73.9%
2022-04-19 06:53:32,942 reid_baseline.train INFO: normal accuracy 0.9541809851088202 0.8231912851333618 
2022-04-19 06:53:32,942 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:53:32,942 reid_baseline.train INFO: Source Clean Accuracy: 95.4%
2022-04-19 06:53:38,043 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_6_20_10
2022-04-19 06:53:38,043 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_6_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-19 06:53:38,043 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 06:53:38,044 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 06:53:38,044 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_6_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 06:53:47,220 reid_baseline.train INFO: start training
2022-04-19 06:54:23,486 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.120, Acc: 0.255, Base Lr: 8.72e-04
2022-04-19 06:54:57,856 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.054, Acc: 0.363, Base Lr: 8.72e-04
2022-04-19 06:55:27,934 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-19 06:55:54,920 reid_baseline.train INFO: normal accuracy 0.5573327325974319 4.165682315826416 
2022-04-19 06:55:58,072 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 06:55:58,073 reid_baseline.train INFO: Accuracy: 55.7% Mean Entropy: 416.6%
2022-04-19 06:56:29,492 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.647, Acc: 0.542, Base Lr: 1.66e-03
2022-04-19 06:57:01,414 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.481, Acc: 0.563, Base Lr: 1.66e-03
2022-04-19 06:57:25,491 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-19 06:57:53,610 reid_baseline.train INFO: normal accuracy 0.5904482991664789 3.988511800765991 
2022-04-19 06:57:56,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 06:57:56,897 reid_baseline.train INFO: Accuracy: 59.0% Mean Entropy: 398.9%
2022-04-19 06:58:34,754 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.730, Acc: 0.597, Base Lr: 2.46e-03
2022-04-19 06:59:05,802 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.557, Acc: 0.616, Base Lr: 2.46e-03
2022-04-19 06:59:28,076 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.334[s] Speed: 47.9[samples/s]
2022-04-19 07:00:02,695 reid_baseline.train INFO: normal accuracy 0.6521739130434783 3.2550556659698486 
2022-04-19 07:00:07,861 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 07:00:07,862 reid_baseline.train INFO: Accuracy: 65.2% Mean Entropy: 325.5%
2022-04-19 07:00:40,747 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.013, Acc: 0.693, Base Lr: 3.25e-03
2022-04-19 07:01:13,055 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.934, Acc: 0.696, Base Lr: 3.25e-03
2022-04-19 07:01:34,658 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-19 07:02:06,431 reid_baseline.train INFO: normal accuracy 0.7048884883982879 2.594736337661743 
2022-04-19 07:02:09,706 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 07:02:09,707 reid_baseline.train INFO: Accuracy: 70.5% Mean Entropy: 259.5%
2022-04-19 07:02:43,249 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.614, Acc: 0.765, Base Lr: 4.04e-03
2022-04-19 07:03:23,505 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.600, Acc: 0.763, Base Lr: 4.04e-03
2022-04-19 07:03:47,912 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.360[s] Speed: 44.5[samples/s]
2022-04-19 07:04:22,440 reid_baseline.train INFO: normal accuracy 0.7298941202973642 2.231893539428711 
2022-04-19 07:04:27,935 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 07:04:27,937 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 223.2%
2022-04-19 07:05:01,804 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.452, Acc: 0.799, Base Lr: 4.83e-03
2022-04-19 07:05:31,413 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.442, Acc: 0.800, Base Lr: 4.83e-03
2022-04-19 07:05:58,890 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.333[s] Speed: 48.0[samples/s]
2022-04-19 07:06:30,838 reid_baseline.train INFO: normal accuracy 0.7395809867087182 2.0480685234069824 
2022-04-19 07:06:33,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 07:06:33,938 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 204.8%
2022-04-19 07:07:07,300 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.342, Acc: 0.831, Base Lr: 5.62e-03
2022-04-19 07:07:39,312 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.338, Acc: 0.832, Base Lr: 5.62e-03
2022-04-19 07:08:03,856 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-19 07:08:35,050 reid_baseline.train INFO: normal accuracy 0.7508447848614552 1.937398076057434 
2022-04-19 07:08:38,159 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 07:08:38,160 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 193.7%
2022-04-19 07:09:09,576 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.262, Acc: 0.848, Base Lr: 6.42e-03
2022-04-19 07:09:42,829 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.244, Acc: 0.854, Base Lr: 6.42e-03
2022-04-19 07:10:05,955 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.322[s] Speed: 49.8[samples/s]
2022-04-19 07:10:37,141 reid_baseline.train INFO: normal accuracy 0.7567019599008786 1.893808364868164 
2022-04-19 07:10:40,419 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 07:10:40,419 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 189.4%
2022-04-19 07:11:17,231 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.173, Acc: 0.882, Base Lr: 7.21e-03
2022-04-19 07:11:48,399 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.178, Acc: 0.879, Base Lr: 7.21e-03
2022-04-19 07:12:11,300 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.333[s] Speed: 48.1[samples/s]
2022-04-19 07:12:45,958 reid_baseline.train INFO: normal accuracy 0.7596305474205902 1.7258926630020142 
2022-04-19 07:12:49,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 07:12:49,302 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 172.6%
2022-04-19 07:13:21,264 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.155, Acc: 0.892, Base Lr: 4.01e-03
2022-04-19 07:14:00,963 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.139, Acc: 0.892, Base Lr: 4.01e-03
2022-04-19 07:14:24,835 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-19 07:15:01,262 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7174512147903442 
2022-04-19 07:15:04,496 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 07:15:04,497 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 171.7%
2022-04-19 07:15:35,511 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.095, Acc: 0.906, Base Lr: 3.38e-03
2022-04-19 07:16:08,639 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.098, Acc: 0.905, Base Lr: 3.38e-03
2022-04-19 07:16:35,570 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.334[s] Speed: 48.0[samples/s]
2022-04-19 07:17:02,392 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.7448726892471313 
2022-04-19 07:17:02,395 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 07:17:02,395 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 174.5%
2022-04-19 07:17:34,391 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.083, Acc: 0.906, Base Lr: 2.77e-03
2022-04-19 07:18:04,527 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.088, Acc: 0.907, Base Lr: 2.77e-03
2022-04-19 07:18:26,768 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-19 07:18:54,221 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.8243224620819092 
2022-04-19 07:18:54,223 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 07:18:54,223 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 182.4%
2022-04-19 07:19:32,100 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.058, Acc: 0.921, Base Lr: 2.20e-03
2022-04-19 07:19:59,347 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.053, Acc: 0.921, Base Lr: 2.20e-03
2022-04-19 07:20:21,943 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-19 07:20:54,055 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.7271546125411987 
2022-04-19 07:20:54,057 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 07:20:54,057 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 172.7%
2022-04-19 07:21:24,227 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.047, Acc: 0.919, Base Lr: 1.66e-03
2022-04-19 07:21:55,657 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.052, Acc: 0.915, Base Lr: 1.66e-03
2022-04-19 07:22:19,802 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.314[s] Speed: 50.9[samples/s]
2022-04-19 07:22:47,670 reid_baseline.train INFO: normal accuracy 0.7722460013516558 1.7232803106307983 
2022-04-19 07:22:47,672 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 07:22:47,672 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 172.3%
2022-04-19 07:23:20,467 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.018, Acc: 0.920, Base Lr: 1.19e-03
2022-04-19 07:23:51,167 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.029, Acc: 0.922, Base Lr: 1.19e-03
2022-04-19 07:24:11,747 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-19 07:24:39,037 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.717952013015747 
2022-04-19 07:24:39,041 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 07:24:39,041 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 171.8%
2022-04-19 07:25:10,388 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.011, Acc: 0.936, Base Lr: 7.78e-04
2022-04-19 07:25:49,080 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.016, Acc: 0.933, Base Lr: 7.78e-04
2022-04-19 07:26:14,654 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-19 07:26:46,937 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.7312477827072144 
2022-04-19 07:26:46,940 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 07:26:46,941 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 173.1%
2022-04-19 07:27:24,241 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.023, Acc: 0.923, Base Lr: 4.51e-04
2022-04-19 07:28:00,980 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.020, Acc: 0.928, Base Lr: 4.51e-04
2022-04-19 07:28:28,676 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-04-19 07:28:55,788 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.7233721017837524 
2022-04-19 07:28:55,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 07:28:55,793 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 172.3%
2022-04-19 07:29:34,943 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.998, Acc: 0.934, Base Lr: 2.11e-04
2022-04-19 07:30:12,800 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.010, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 07:30:42,673 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.391[s] Speed: 40.9[samples/s]
2022-04-19 07:31:11,581 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.7392414808273315 
2022-04-19 07:31:11,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 07:31:11,586 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 173.9%
2022-04-19 07:31:49,355 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.013, Acc: 0.926, Base Lr: 6.51e-05
2022-04-19 07:32:27,883 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.015, Acc: 0.928, Base Lr: 6.51e-05
2022-04-19 07:32:57,598 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.388[s] Speed: 41.2[samples/s]
2022-04-19 07:33:26,959 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.7292200326919556 
2022-04-19 07:33:26,963 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 07:33:26,963 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 172.9%
2022-04-19 07:34:04,795 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.016, Acc: 0.933, Base Lr: 1.60e-05
2022-04-19 07:34:42,924 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.017, Acc: 0.932, Base Lr: 1.60e-05
2022-04-19 07:35:12,276 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.386[s] Speed: 41.5[samples/s]
2022-04-19 07:35:42,421 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.7387239933013916 
2022-04-19 07:35:42,423 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 07:35:42,424 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 173.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_6_20_10/transformer_best_model.pth
2022-04-19 07:36:19,159 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7174512147903442 
2022-04-19 07:36:19,159 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:36:19,160 reid_baseline.train INFO: Accuracy: 77.1%
2022-04-19 07:36:45,508 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7174512147903442 
2022-04-19 07:36:45,508 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:36:45,508 reid_baseline.train INFO: Shuffled Accuracy: 77.1%
2022-04-19 07:37:12,959 reid_baseline.train INFO: normal accuracy 0.9402061855670103 0.8717685341835022 
2022-04-19 07:37:12,960 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:37:12,960 reid_baseline.train INFO: Source Clean Accuracy: 94.0%
2022-04-19 07:37:20,350 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_6_20_10
2022-04-19 07:37:20,350 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_6_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-19 07:37:20,350 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 07:37:20,350 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 07:37:20,351 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_6_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 07:37:30,147 reid_baseline.train INFO: start training
2022-04-19 07:38:11,792 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.120, Acc: 0.256, Base Lr: 8.72e-04
2022-04-19 07:38:47,993 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.054, Acc: 0.363, Base Lr: 8.72e-04
2022-04-19 07:39:15,902 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.386[s] Speed: 41.4[samples/s]
2022-04-19 07:41:03,607 reid_baseline.train INFO: normal accuracy 0.5655267385815929 4.166751384735107 
2022-04-19 07:41:06,844 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 07:41:06,845 reid_baseline.train INFO: Accuracy: 56.6% Mean Entropy: 416.7%
2022-04-19 07:41:46,847 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.647, Acc: 0.541, Base Lr: 1.66e-03
2022-04-19 07:42:23,843 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.481, Acc: 0.563, Base Lr: 1.66e-03
2022-04-19 07:42:52,178 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.386[s] Speed: 41.5[samples/s]
2022-04-19 07:44:35,212 reid_baseline.train INFO: normal accuracy 0.6075281156759238 4.014395713806152 
2022-04-19 07:44:38,474 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 07:44:38,474 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 401.4%
2022-04-19 07:45:20,664 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.730, Acc: 0.597, Base Lr: 2.46e-03
2022-04-19 07:45:58,358 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.557, Acc: 0.616, Base Lr: 2.46e-03
2022-04-19 07:46:27,495 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.399[s] Speed: 40.1[samples/s]
2022-04-19 07:48:17,920 reid_baseline.train INFO: normal accuracy 0.6809731466605462 3.3257126808166504 
2022-04-19 07:48:21,127 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 07:48:21,128 reid_baseline.train INFO: Accuracy: 68.1% Mean Entropy: 332.6%
2022-04-19 07:49:02,554 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.013, Acc: 0.694, Base Lr: 3.25e-03
2022-04-19 07:49:41,238 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.934, Acc: 0.697, Base Lr: 3.25e-03
2022-04-19 07:50:06,029 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.384[s] Speed: 41.6[samples/s]
2022-04-19 07:52:08,968 reid_baseline.train INFO: normal accuracy 0.7362864356208401 2.666839599609375 
2022-04-19 07:52:12,161 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 07:52:12,161 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 266.7%
2022-04-19 07:52:51,476 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.614, Acc: 0.766, Base Lr: 4.04e-03
2022-04-19 07:53:32,275 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.600, Acc: 0.764, Base Lr: 4.04e-03
2022-04-19 07:53:56,682 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-04-19 07:55:51,482 reid_baseline.train INFO: normal accuracy 0.7599265549690154 2.2998929023742676 
2022-04-19 07:55:54,767 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 07:55:54,768 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 230.0%
2022-04-19 07:56:32,566 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.452, Acc: 0.799, Base Lr: 4.83e-03
2022-04-19 07:57:03,727 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.441, Acc: 0.801, Base Lr: 4.83e-03
2022-04-19 07:57:28,547 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.344[s] Speed: 46.6[samples/s]
2022-04-19 07:59:25,901 reid_baseline.train INFO: normal accuracy 0.7723204039476704 2.085322380065918 
2022-04-19 07:59:29,211 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 07:59:29,212 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 208.5%
2022-04-19 08:00:10,566 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.343, Acc: 0.831, Base Lr: 5.62e-03
2022-04-19 08:00:48,221 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.338, Acc: 0.830, Base Lr: 5.62e-03
2022-04-19 08:01:13,899 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.383[s] Speed: 41.7[samples/s]
2022-04-19 08:03:13,840 reid_baseline.train INFO: normal accuracy 0.7789763598806518 1.9704077243804932 
2022-04-19 08:03:17,006 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 08:03:17,007 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 197.0%
2022-04-19 08:03:55,970 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.263, Acc: 0.848, Base Lr: 6.42e-03
2022-04-19 08:04:34,735 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.244, Acc: 0.855, Base Lr: 6.42e-03
2022-04-19 08:04:58,911 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-04-19 08:07:03,035 reid_baseline.train INFO: normal accuracy 0.778287812715171 1.920390248298645 
2022-04-19 08:07:07,364 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 08:07:07,365 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 192.0%
2022-04-19 08:07:47,205 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.173, Acc: 0.879, Base Lr: 7.21e-03
2022-04-19 08:08:26,041 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.178, Acc: 0.876, Base Lr: 7.21e-03
2022-04-19 08:08:52,652 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.386[s] Speed: 41.5[samples/s]
2022-04-19 08:10:50,883 reid_baseline.train INFO: normal accuracy 0.7902226302501721 1.7467706203460693 
2022-04-19 08:10:58,049 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 08:10:58,050 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 174.7%
2022-04-19 08:11:38,032 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.156, Acc: 0.888, Base Lr: 4.01e-03
2022-04-19 08:12:15,760 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.139, Acc: 0.889, Base Lr: 4.01e-03
2022-04-19 08:12:41,886 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-19 08:14:46,695 reid_baseline.train INFO: normal accuracy 0.7932063346339224 1.7487049102783203 
2022-04-19 08:14:46,700 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 08:14:46,700 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 174.9%
2022-04-19 08:15:27,319 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.094, Acc: 0.907, Base Lr: 3.38e-03
2022-04-19 08:16:06,333 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.098, Acc: 0.906, Base Lr: 3.38e-03
2022-04-19 08:16:33,584 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.391[s] Speed: 40.9[samples/s]
2022-04-19 08:18:36,480 reid_baseline.train INFO: normal accuracy 0.7913702088593069 1.7527190446853638 
2022-04-19 08:18:36,484 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 08:18:36,484 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 175.3%
2022-04-19 08:19:16,644 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.084, Acc: 0.905, Base Lr: 2.77e-03
2022-04-19 08:19:56,884 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.088, Acc: 0.906, Base Lr: 2.77e-03
2022-04-19 08:20:22,776 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.389[s] Speed: 41.1[samples/s]
2022-04-19 08:22:19,887 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.8454813957214355 
2022-04-19 08:22:19,891 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 08:22:19,892 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 184.5%
2022-04-19 08:22:59,926 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.058, Acc: 0.922, Base Lr: 2.20e-03
2022-04-19 08:23:36,095 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.053, Acc: 0.920, Base Lr: 2.20e-03
2022-04-19 08:24:04,391 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-04-19 08:26:01,000 reid_baseline.train INFO: normal accuracy 0.7959605232958458 1.7385224103927612 
2022-04-19 08:26:04,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 08:26:04,202 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 173.9%
2022-04-19 08:26:45,317 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.048, Acc: 0.919, Base Lr: 1.66e-03
2022-04-19 08:27:15,561 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.053, Acc: 0.915, Base Lr: 1.66e-03
2022-04-19 08:27:42,122 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-19 08:29:39,267 reid_baseline.train INFO: normal accuracy 0.7977966490704613 1.7299050092697144 
2022-04-19 08:29:42,473 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 08:29:42,474 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 173.0%
2022-04-19 08:30:10,553 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.019, Acc: 0.919, Base Lr: 1.19e-03
2022-04-19 08:30:46,698 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.029, Acc: 0.921, Base Lr: 1.19e-03
2022-04-19 08:31:14,039 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.335[s] Speed: 47.7[samples/s]
2022-04-19 08:33:18,726 reid_baseline.train INFO: normal accuracy 0.7975671333486344 1.7341632843017578 
2022-04-19 08:33:18,728 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 08:33:18,728 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 173.4%
2022-04-19 08:33:54,796 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.011, Acc: 0.936, Base Lr: 7.78e-04
2022-04-19 08:34:25,620 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.016, Acc: 0.933, Base Lr: 7.78e-04
2022-04-19 08:34:48,899 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.330[s] Speed: 48.4[samples/s]
2022-04-19 08:36:44,153 reid_baseline.train INFO: normal accuracy 0.7968785861831535 1.7488021850585938 
2022-04-19 08:36:44,154 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 08:36:44,154 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 174.9%
2022-04-19 08:37:10,234 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.023, Acc: 0.922, Base Lr: 4.51e-04
2022-04-19 08:37:41,986 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.020, Acc: 0.927, Base Lr: 4.51e-04
2022-04-19 08:38:05,923 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-19 08:40:07,145 reid_baseline.train INFO: normal accuracy 0.8003213220105577 1.7446249723434448 
2022-04-19 08:40:07,146 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 08:40:07,146 reid_baseline.train INFO: Accuracy: 80.0% Mean Entropy: 174.5%
2022-04-19 08:40:36,740 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.998, Acc: 0.937, Base Lr: 2.11e-04
2022-04-19 08:41:10,302 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.010, Acc: 0.931, Base Lr: 2.11e-04
2022-04-19 08:41:38,012 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.333[s] Speed: 48.1[samples/s]
2022-04-19 08:43:39,428 reid_baseline.train INFO: normal accuracy 0.7975671333486344 1.7508113384246826 
2022-04-19 08:43:39,428 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 08:43:39,428 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 175.1%
2022-04-19 08:44:09,401 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.013, Acc: 0.923, Base Lr: 6.51e-05
2022-04-19 08:44:47,860 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.015, Acc: 0.928, Base Lr: 6.51e-05
2022-04-19 08:45:09,670 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-19 08:47:08,887 reid_baseline.train INFO: normal accuracy 0.8000918062887308 1.745503544807434 
2022-04-19 08:47:08,889 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 08:47:08,889 reid_baseline.train INFO: Accuracy: 80.0% Mean Entropy: 174.6%
2022-04-19 08:47:41,334 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.015, Acc: 0.935, Base Lr: 1.60e-05
2022-04-19 08:48:12,441 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.017, Acc: 0.933, Base Lr: 1.60e-05
2022-04-19 08:48:36,113 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.319[s] Speed: 50.1[samples/s]
2022-04-19 08:50:36,886 reid_baseline.train INFO: normal accuracy 0.7996327748450769 1.7492026090621948 
2022-04-19 08:50:36,886 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 08:50:36,886 reid_baseline.train INFO: Accuracy: 80.0% Mean Entropy: 174.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_6_20_10/transformer_best_model.pth
2022-04-19 08:52:32,748 reid_baseline.train INFO: normal accuracy 0.7977966490704613 1.7299050092697144 
2022-04-19 08:52:32,748 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:52:32,748 reid_baseline.train INFO: Accuracy: 79.8%
2022-04-19 08:54:27,149 reid_baseline.train INFO: normal accuracy 0.7977966490704613 1.7299050092697144 
2022-04-19 08:54:27,149 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:54:27,149 reid_baseline.train INFO: Shuffled Accuracy: 79.8%
2022-04-19 08:54:55,729 reid_baseline.train INFO: normal accuracy 0.9544100801832761 0.8225803971290588 
2022-04-19 08:54:55,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:54:55,729 reid_baseline.train INFO: Source Clean Accuracy: 95.4%
2022-04-19 08:54:59,831 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_8_20_10
2022-04-19 08:54:59,832 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_8_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-19 08:54:59,832 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 08:54:59,832 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 08:54:59,832 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_8_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 08:55:09,175 reid_baseline.train INFO: start training
2022-04-19 08:55:43,292 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.120, Acc: 0.255, Base Lr: 8.72e-04
2022-04-19 08:56:11,366 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.054, Acc: 0.364, Base Lr: 8.72e-04
2022-04-19 08:56:30,679 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-19 08:56:58,763 reid_baseline.train INFO: normal accuracy 0.511742892459827 4.16728401184082 
2022-04-19 08:57:01,879 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 08:57:01,880 reid_baseline.train INFO: Accuracy: 51.2% Mean Entropy: 416.7%
2022-04-19 08:57:35,508 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.633, Acc: 0.566, Base Lr: 1.66e-03
2022-04-19 08:58:13,975 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.493, Acc: 0.554, Base Lr: 1.66e-03
2022-04-19 08:58:36,306 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.346[s] Speed: 46.3[samples/s]
2022-04-19 08:59:09,867 reid_baseline.train INFO: normal accuracy 0.5525339925834364 4.045727252960205 
2022-04-19 08:59:13,028 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 08:59:13,029 reid_baseline.train INFO: Accuracy: 55.3% Mean Entropy: 404.6%
2022-04-19 08:59:42,199 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.700, Acc: 0.607, Base Lr: 2.46e-03
2022-04-19 09:00:08,201 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.552, Acc: 0.614, Base Lr: 2.46e-03
2022-04-19 09:00:24,983 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.264[s] Speed: 60.7[samples/s]
2022-04-19 09:00:53,280 reid_baseline.train INFO: normal accuracy 0.6209311907704985 3.477428436279297 
2022-04-19 09:00:56,511 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 09:00:56,512 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 347.7%
2022-04-19 09:01:24,770 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 1.991, Acc: 0.693, Base Lr: 3.25e-03
2022-04-19 09:01:51,422 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.924, Acc: 0.701, Base Lr: 3.25e-03
2022-04-19 09:02:12,359 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.278[s] Speed: 57.6[samples/s]
2022-04-19 09:02:39,656 reid_baseline.train INFO: normal accuracy 0.6823238566131026 2.902440309524536 
2022-04-19 09:02:42,856 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 09:02:42,857 reid_baseline.train INFO: Accuracy: 68.2% Mean Entropy: 290.2%
2022-04-19 09:03:10,076 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.642, Acc: 0.759, Base Lr: 4.04e-03
2022-04-19 09:03:41,342 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.635, Acc: 0.754, Base Lr: 4.04e-03
2022-04-19 09:04:00,248 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.283[s] Speed: 56.4[samples/s]
2022-04-19 09:04:32,072 reid_baseline.train INFO: normal accuracy 0.7041615162752369 2.576256036758423 
2022-04-19 09:04:35,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 09:04:35,192 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 257.6%
2022-04-19 09:05:02,216 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.443, Acc: 0.802, Base Lr: 4.83e-03
2022-04-19 09:05:31,900 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.432, Acc: 0.804, Base Lr: 4.83e-03
2022-04-19 09:06:00,615 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-19 09:06:24,735 reid_baseline.train INFO: normal accuracy 0.7202307375360527 2.3297719955444336 
2022-04-19 09:06:28,120 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 09:06:28,121 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 233.0%
2022-04-19 09:06:58,528 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.329, Acc: 0.833, Base Lr: 5.62e-03
2022-04-19 09:07:27,306 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.342, Acc: 0.827, Base Lr: 5.62e-03
2022-04-19 09:07:51,437 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-19 09:08:17,612 reid_baseline.train INFO: normal accuracy 0.7301194890811702 2.176273822784424 
2022-04-19 09:08:20,912 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 09:08:20,913 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 217.6%
2022-04-19 09:08:59,042 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.259, Acc: 0.850, Base Lr: 6.42e-03
2022-04-19 09:09:29,494 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.251, Acc: 0.854, Base Lr: 6.42e-03
2022-04-19 09:09:51,601 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-19 09:10:21,653 reid_baseline.train INFO: normal accuracy 0.7362999587968686 2.0622851848602295 
2022-04-19 09:10:25,151 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 09:10:25,153 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 206.2%
2022-04-19 09:10:53,113 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.199, Acc: 0.870, Base Lr: 7.21e-03
2022-04-19 09:11:31,460 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.200, Acc: 0.867, Base Lr: 7.21e-03
2022-04-19 09:11:56,178 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.333[s] Speed: 48.0[samples/s]
2022-04-19 09:12:25,018 reid_baseline.train INFO: normal accuracy 0.7247630819942316 2.0247011184692383 
2022-04-19 09:12:28,146 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 09:12:28,147 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 202.5%
2022-04-19 09:12:57,102 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.153, Acc: 0.883, Base Lr: 4.01e-03
2022-04-19 09:13:28,737 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.129, Acc: 0.895, Base Lr: 4.01e-03
2022-04-19 09:13:55,777 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-19 09:14:26,762 reid_baseline.train INFO: normal accuracy 0.7354758961681088 2.002239227294922 
2022-04-19 09:14:30,776 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 09:14:30,776 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 200.2%
2022-04-19 09:14:58,552 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.117, Acc: 0.897, Base Lr: 3.38e-03
2022-04-19 09:15:29,989 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.108, Acc: 0.897, Base Lr: 3.38e-03
2022-04-19 09:15:53,369 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-19 09:16:19,278 reid_baseline.train INFO: normal accuracy 0.7391841779975278 1.9250092506408691 
2022-04-19 09:16:22,494 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 09:16:22,495 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 192.5%
2022-04-19 09:16:58,563 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.084, Acc: 0.908, Base Lr: 2.77e-03
2022-04-19 09:17:29,417 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.087, Acc: 0.906, Base Lr: 2.77e-03
2022-04-19 09:17:53,813 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.334[s] Speed: 47.8[samples/s]
2022-04-19 09:18:22,662 reid_baseline.train INFO: normal accuracy 0.7313555830243098 1.933414101600647 
2022-04-19 09:18:22,664 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 09:18:22,665 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 193.3%
2022-04-19 09:18:53,108 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.030, Acc: 0.931, Base Lr: 2.20e-03
2022-04-19 09:19:31,045 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.044, Acc: 0.923, Base Lr: 2.20e-03
2022-04-19 09:19:51,044 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-19 09:20:19,335 reid_baseline.train INFO: normal accuracy 0.7404202719406675 1.9267394542694092 
2022-04-19 09:20:19,336 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 09:20:19,336 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 192.7%
2022-04-19 09:20:49,643 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.060, Acc: 0.914, Base Lr: 1.66e-03
2022-04-19 09:21:19,995 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.054, Acc: 0.915, Base Lr: 1.66e-03
2022-04-19 09:21:40,962 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-19 09:22:10,780 reid_baseline.train INFO: normal accuracy 0.7400082406262876 1.8984752893447876 
2022-04-19 09:22:13,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 09:22:13,910 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 189.8%
2022-04-19 09:22:44,440 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.999, Acc: 0.929, Base Lr: 1.19e-03
2022-04-19 09:23:15,232 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.023, Acc: 0.923, Base Lr: 1.19e-03
2022-04-19 09:23:39,186 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.312[s] Speed: 51.2[samples/s]
2022-04-19 09:24:09,896 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.8602744340896606 
2022-04-19 09:24:13,028 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 09:24:13,029 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 186.0%
2022-04-19 09:24:42,175 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.023, Acc: 0.925, Base Lr: 7.78e-04
2022-04-19 09:25:14,052 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.027, Acc: 0.929, Base Lr: 7.78e-04
2022-04-19 09:25:33,364 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-19 09:25:54,067 reid_baseline.train INFO: normal accuracy 0.7375360527400082 1.9038136005401611 
2022-04-19 09:25:54,069 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 09:25:54,069 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 190.4%
2022-04-19 09:26:15,838 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.039, Acc: 0.920, Base Lr: 4.51e-04
2022-04-19 09:26:43,502 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.032, Acc: 0.924, Base Lr: 4.51e-04
2022-04-19 09:27:03,991 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-19 09:27:25,912 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.8859485387802124 
2022-04-19 09:27:25,913 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 09:27:25,913 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 188.6%
2022-04-19 09:27:47,937 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.023, Acc: 0.927, Base Lr: 2.11e-04
2022-04-19 09:28:15,974 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.029, Acc: 0.924, Base Lr: 2.11e-04
2022-04-19 09:28:36,943 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.260[s] Speed: 61.5[samples/s]
2022-04-19 09:28:57,620 reid_baseline.train INFO: normal accuracy 0.7408323032550473 1.8544254302978516 
2022-04-19 09:29:00,735 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 09:29:00,735 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 185.4%
2022-04-19 09:29:23,666 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.038, Acc: 0.923, Base Lr: 6.51e-05
2022-04-19 09:29:49,903 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.032, Acc: 0.926, Base Lr: 6.51e-05
2022-04-19 09:30:08,640 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.249[s] Speed: 64.3[samples/s]
2022-04-19 09:30:30,004 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8328030109405518 
2022-04-19 09:30:33,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 09:30:33,301 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 183.3%
2022-04-19 09:30:55,835 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.014, Acc: 0.932, Base Lr: 1.60e-05
2022-04-19 09:31:21,945 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.017, Acc: 0.930, Base Lr: 1.60e-05
2022-04-19 09:31:42,506 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.253[s] Speed: 63.1[samples/s]
2022-04-19 09:32:06,154 reid_baseline.train INFO: normal accuracy 0.7379480840543882 1.9479838609695435 
2022-04-19 09:32:06,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 09:32:06,155 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 194.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_aug_key_8_20_10/transformer_best_model.pth
2022-04-19 09:32:33,559 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8328030109405518 
2022-04-19 09:32:33,559 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:32:33,559 reid_baseline.train INFO: Accuracy: 74.5%
2022-04-19 09:32:53,061 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8328030109405518 
2022-04-19 09:32:53,061 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:32:53,061 reid_baseline.train INFO: Shuffled Accuracy: 74.5%
2022-04-19 09:33:14,906 reid_baseline.train INFO: normal accuracy 0.9585337915234823 0.7685844898223877 
2022-04-19 09:33:14,906 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:33:14,906 reid_baseline.train INFO: Source Clean Accuracy: 95.9%
2022-04-19 09:33:18,453 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_8_20_10
2022-04-19 09:33:18,454 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_8_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-19 09:33:18,454 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 09:33:18,454 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 09:33:18,454 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_8_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 09:33:24,512 reid_baseline.train INFO: start training
2022-04-19 09:33:51,787 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.120, Acc: 0.255, Base Lr: 8.72e-04
2022-04-19 09:34:15,680 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.054, Acc: 0.364, Base Lr: 8.72e-04
2022-04-19 09:34:35,670 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.260[s] Speed: 61.6[samples/s]
2022-04-19 09:34:58,917 reid_baseline.train INFO: normal accuracy 0.5649921153412931 4.165950298309326 
2022-04-19 09:35:02,007 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 09:35:02,008 reid_baseline.train INFO: Accuracy: 56.5% Mean Entropy: 416.6%
2022-04-19 09:35:23,240 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.633, Acc: 0.566, Base Lr: 1.66e-03
2022-04-19 09:35:48,711 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.493, Acc: 0.554, Base Lr: 1.66e-03
2022-04-19 09:36:09,001 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.245[s] Speed: 65.2[samples/s]
2022-04-19 09:36:31,434 reid_baseline.train INFO: normal accuracy 0.5904482991664789 3.9984960556030273 
2022-04-19 09:36:34,509 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 09:36:34,509 reid_baseline.train INFO: Accuracy: 59.0% Mean Entropy: 399.8%
2022-04-19 09:36:58,274 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.700, Acc: 0.606, Base Lr: 2.46e-03
2022-04-19 09:37:23,649 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.552, Acc: 0.614, Base Lr: 2.46e-03
2022-04-19 09:37:43,441 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.252[s] Speed: 63.4[samples/s]
2022-04-19 09:38:05,579 reid_baseline.train INFO: normal accuracy 0.6569047082676278 3.2891390323638916 
2022-04-19 09:38:08,713 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 09:38:08,714 reid_baseline.train INFO: Accuracy: 65.7% Mean Entropy: 328.9%
2022-04-19 09:38:31,842 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 1.991, Acc: 0.693, Base Lr: 3.25e-03
2022-04-19 09:38:56,358 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.924, Acc: 0.702, Base Lr: 3.25e-03
2022-04-19 09:39:15,710 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.245[s] Speed: 65.2[samples/s]
2022-04-19 09:39:38,110 reid_baseline.train INFO: normal accuracy 0.7150259067357513 2.6321845054626465 
2022-04-19 09:39:41,211 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 09:39:41,211 reid_baseline.train INFO: Accuracy: 71.5% Mean Entropy: 263.2%
2022-04-19 09:40:05,268 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.642, Acc: 0.759, Base Lr: 4.04e-03
2022-04-19 09:40:24,806 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.635, Acc: 0.753, Base Lr: 4.04e-03
2022-04-19 09:40:39,197 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.212[s] Speed: 75.3[samples/s]
2022-04-19 09:41:03,841 reid_baseline.train INFO: normal accuracy 0.728317188555981 2.2397255897521973 
2022-04-19 09:41:06,985 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 09:41:06,986 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 224.0%
2022-04-19 09:41:33,289 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.443, Acc: 0.802, Base Lr: 4.83e-03
2022-04-19 09:41:52,834 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.432, Acc: 0.804, Base Lr: 4.83e-03
2022-04-19 09:42:13,173 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.242[s] Speed: 66.0[samples/s]
2022-04-19 09:42:35,655 reid_baseline.train INFO: normal accuracy 0.7425095742284298 2.0161468982696533 
2022-04-19 09:42:38,768 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 09:42:38,769 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 201.6%
2022-04-19 09:43:05,448 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.329, Acc: 0.833, Base Lr: 5.62e-03
2022-04-19 09:43:31,151 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.342, Acc: 0.828, Base Lr: 5.62e-03
2022-04-19 09:43:51,129 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.265[s] Speed: 60.4[samples/s]
2022-04-19 09:44:13,242 reid_baseline.train INFO: normal accuracy 0.7530975444920027 1.91880202293396 
2022-04-19 09:44:16,363 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 09:44:16,364 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 191.9%
2022-04-19 09:44:42,119 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.259, Acc: 0.850, Base Lr: 6.42e-03
2022-04-19 09:45:07,410 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.250, Acc: 0.853, Base Lr: 6.42e-03
2022-04-19 09:45:26,400 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.257[s] Speed: 62.4[samples/s]
2022-04-19 09:45:48,846 reid_baseline.train INFO: normal accuracy 0.7614327551250282 1.834471344947815 
2022-04-19 09:45:52,039 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 09:45:52,039 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 183.4%
2022-04-19 09:46:19,492 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.200, Acc: 0.871, Base Lr: 7.21e-03
2022-04-19 09:46:45,509 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.200, Acc: 0.866, Base Lr: 7.21e-03
2022-04-19 09:47:04,843 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.267[s] Speed: 60.0[samples/s]
2022-04-19 09:47:27,810 reid_baseline.train INFO: normal accuracy 0.7546744762333859 1.8176933526992798 
2022-04-19 09:47:30,901 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 09:47:30,902 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 181.8%
2022-04-19 09:47:58,984 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.152, Acc: 0.884, Base Lr: 4.01e-03
2022-04-19 09:48:24,400 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.129, Acc: 0.895, Base Lr: 4.01e-03
2022-04-19 09:48:43,295 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-19 09:49:10,619 reid_baseline.train INFO: normal accuracy 0.7663888263122325 1.8241393566131592 
2022-04-19 09:49:10,621 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 09:49:10,621 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 182.4%
2022-04-19 09:49:36,281 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.117, Acc: 0.895, Base Lr: 3.38e-03
2022-04-19 09:50:00,210 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.108, Acc: 0.896, Base Lr: 3.38e-03
2022-04-19 09:50:19,853 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.254[s] Speed: 63.1[samples/s]
2022-04-19 09:50:41,974 reid_baseline.train INFO: normal accuracy 0.7686415859427799 1.7381412982940674 
2022-04-19 09:50:45,107 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 09:50:45,107 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 173.8%
2022-04-19 09:51:12,118 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.084, Acc: 0.908, Base Lr: 2.77e-03
2022-04-19 09:51:36,573 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.087, Acc: 0.905, Base Lr: 2.77e-03
2022-04-19 09:51:54,161 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.253[s] Speed: 63.3[samples/s]
2022-04-19 09:52:16,484 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.745842695236206 
2022-04-19 09:52:16,484 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 09:52:16,485 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 174.6%
2022-04-19 09:52:43,790 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.030, Acc: 0.931, Base Lr: 2.20e-03
2022-04-19 09:53:09,716 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.044, Acc: 0.924, Base Lr: 2.20e-03
2022-04-19 09:53:27,894 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.262[s] Speed: 61.2[samples/s]
2022-04-19 09:53:50,139 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.7496697902679443 
2022-04-19 09:53:50,140 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 09:53:50,140 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.0%
2022-04-19 09:54:17,294 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.060, Acc: 0.914, Base Lr: 1.66e-03
2022-04-19 09:54:40,762 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.054, Acc: 0.915, Base Lr: 1.66e-03
2022-04-19 09:54:58,320 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.250[s] Speed: 64.1[samples/s]
2022-04-19 09:55:20,678 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.7209243774414062 
2022-04-19 09:55:25,239 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 09:55:25,240 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 172.1%
2022-04-19 09:55:53,842 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.999, Acc: 0.928, Base Lr: 1.19e-03
2022-04-19 09:56:19,466 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.023, Acc: 0.923, Base Lr: 1.19e-03
2022-04-19 09:56:38,150 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-19 09:57:00,997 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.6778130531311035 
2022-04-19 09:57:05,674 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 09:57:05,675 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 167.8%
2022-04-19 09:57:35,015 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.024, Acc: 0.925, Base Lr: 7.78e-04
2022-04-19 09:58:00,750 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.027, Acc: 0.929, Base Lr: 7.78e-04
2022-04-19 09:58:20,829 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.275[s] Speed: 58.1[samples/s]
2022-04-19 09:58:43,655 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.7248525619506836 
2022-04-19 09:58:43,657 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 09:58:43,657 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 172.5%
2022-04-19 09:59:10,944 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.040, Acc: 0.919, Base Lr: 4.51e-04
2022-04-19 09:59:35,673 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.032, Acc: 0.923, Base Lr: 4.51e-04
2022-04-19 09:59:56,316 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.266[s] Speed: 60.1[samples/s]
2022-04-19 10:00:19,237 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.715998649597168 
2022-04-19 10:00:19,239 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 10:00:19,240 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 171.6%
2022-04-19 10:00:47,924 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.023, Acc: 0.924, Base Lr: 2.11e-04
2022-04-19 10:01:13,582 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.029, Acc: 0.923, Base Lr: 2.11e-04
2022-04-19 10:01:33,722 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.273[s] Speed: 58.6[samples/s]
2022-04-19 10:01:59,228 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.689037561416626 
2022-04-19 10:01:59,230 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 10:01:59,230 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 168.9%
2022-04-19 10:02:26,671 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.037, Acc: 0.921, Base Lr: 6.51e-05
2022-04-19 10:02:51,583 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.032, Acc: 0.924, Base Lr: 6.51e-05
2022-04-19 10:03:11,496 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.265[s] Speed: 60.4[samples/s]
2022-04-19 10:03:34,411 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.658474326133728 
2022-04-19 10:03:37,514 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 10:03:37,515 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 165.8%
2022-04-19 10:04:04,214 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.014, Acc: 0.932, Base Lr: 1.60e-05
2022-04-19 10:04:28,990 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.016, Acc: 0.930, Base Lr: 1.60e-05
2022-04-19 10:04:49,985 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-19 10:05:15,542 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.7779158353805542 
2022-04-19 10:05:15,545 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 10:05:15,545 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 177.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_aug_key_8_20_10/transformer_best_model.pth
2022-04-19 10:05:41,390 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.658474326133728 
2022-04-19 10:05:41,390 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:05:41,390 reid_baseline.train INFO: Accuracy: 77.8%
2022-04-19 10:06:01,979 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.658474326133728 
2022-04-19 10:06:01,979 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:06:01,979 reid_baseline.train INFO: Shuffled Accuracy: 77.8%
2022-04-19 10:06:26,190 reid_baseline.train INFO: normal accuracy 0.9585337915234823 0.7684528827667236 
2022-04-19 10:06:26,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:06:26,191 reid_baseline.train INFO: Source Clean Accuracy: 95.9%
2022-04-19 10:06:31,262 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_8_20_10
2022-04-19 10:06:31,262 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_8_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-19 10:06:31,263 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 10:06:31,263 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 10:06:31,263 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_8_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 10:06:37,384 reid_baseline.train INFO: start training
2022-04-19 10:07:09,075 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.120, Acc: 0.255, Base Lr: 8.72e-04
2022-04-19 10:07:34,838 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.054, Acc: 0.364, Base Lr: 8.72e-04
2022-04-19 10:07:54,201 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.278[s] Speed: 57.5[samples/s]
2022-04-19 10:09:17,901 reid_baseline.train INFO: normal accuracy 0.5740188202891898 4.166970729827881 
2022-04-19 10:09:20,956 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 10:09:20,956 reid_baseline.train INFO: Accuracy: 57.4% Mean Entropy: 416.7%
2022-04-19 10:09:50,185 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.633, Acc: 0.566, Base Lr: 1.66e-03
2022-04-19 10:10:17,753 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.493, Acc: 0.554, Base Lr: 1.66e-03
2022-04-19 10:10:36,425 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.276[s] Speed: 57.9[samples/s]
2022-04-19 10:11:58,829 reid_baseline.train INFO: normal accuracy 0.6082166628414046 4.022431373596191 
2022-04-19 10:12:01,936 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 10:12:01,936 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 402.2%
2022-04-19 10:12:28,411 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.700, Acc: 0.606, Base Lr: 2.46e-03
2022-04-19 10:12:53,803 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.552, Acc: 0.614, Base Lr: 2.46e-03
2022-04-19 10:13:12,711 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.259[s] Speed: 61.7[samples/s]
2022-04-19 10:14:37,825 reid_baseline.train INFO: normal accuracy 0.6807436309387193 3.3439395427703857 
2022-04-19 10:14:40,936 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 10:14:40,937 reid_baseline.train INFO: Accuracy: 68.1% Mean Entropy: 334.4%
2022-04-19 10:15:07,841 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 1.991, Acc: 0.693, Base Lr: 3.25e-03
2022-04-19 10:15:27,566 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.924, Acc: 0.701, Base Lr: 3.25e-03
2022-04-19 10:15:46,655 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.241[s] Speed: 66.5[samples/s]
2022-04-19 10:17:07,998 reid_baseline.train INFO: normal accuracy 0.7388111085609365 2.7004106044769287 
2022-04-19 10:17:11,222 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 10:17:11,223 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 270.0%
2022-04-19 10:17:31,772 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.642, Acc: 0.759, Base Lr: 4.04e-03
2022-04-19 10:17:50,144 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.635, Acc: 0.754, Base Lr: 4.04e-03
2022-04-19 10:18:07,994 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.208[s] Speed: 77.0[samples/s]
2022-04-19 10:19:30,398 reid_baseline.train INFO: normal accuracy 0.7594675235253615 2.3238048553466797 
2022-04-19 10:19:33,520 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 10:19:33,521 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 232.4%
2022-04-19 10:19:53,626 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.443, Acc: 0.803, Base Lr: 4.83e-03
2022-04-19 10:20:13,283 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.432, Acc: 0.804, Base Lr: 4.83e-03
2022-04-19 10:20:27,593 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.198[s] Speed: 80.9[samples/s]
2022-04-19 10:21:48,140 reid_baseline.train INFO: normal accuracy 0.7762221712187285 2.0830588340759277 
2022-04-19 10:21:51,233 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 10:21:51,233 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 208.3%
2022-04-19 10:22:12,555 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.329, Acc: 0.831, Base Lr: 5.62e-03
2022-04-19 10:22:32,247 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.342, Acc: 0.827, Base Lr: 5.62e-03
2022-04-19 10:22:48,483 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.210[s] Speed: 76.4[samples/s]
2022-04-19 10:24:11,110 reid_baseline.train INFO: normal accuracy 0.7819600642644021 1.9601354598999023 
2022-04-19 10:24:14,216 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 10:24:14,216 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 196.0%
2022-04-19 10:24:35,229 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.259, Acc: 0.849, Base Lr: 6.42e-03
2022-04-19 10:24:54,638 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.250, Acc: 0.852, Base Lr: 6.42e-03
2022-04-19 10:25:09,663 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.203[s] Speed: 78.9[samples/s]
2022-04-19 10:26:32,321 reid_baseline.train INFO: normal accuracy 0.790911177415653 1.849157452583313 
2022-04-19 10:26:35,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 10:26:35,492 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 184.9%
2022-04-19 10:26:57,013 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.200, Acc: 0.870, Base Lr: 7.21e-03
2022-04-19 10:27:16,436 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.200, Acc: 0.867, Base Lr: 7.21e-03
2022-04-19 10:27:29,282 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.197[s] Speed: 81.3[samples/s]
2022-04-19 10:28:55,083 reid_baseline.train INFO: normal accuracy 0.782648611429883 1.832599401473999 
2022-04-19 10:28:58,180 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 10:28:58,181 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 183.3%
2022-04-19 10:29:19,637 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.152, Acc: 0.884, Base Lr: 4.01e-03
2022-04-19 10:29:39,096 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.129, Acc: 0.896, Base Lr: 4.01e-03
2022-04-19 10:29:54,027 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.204[s] Speed: 78.3[samples/s]
2022-04-19 10:31:22,124 reid_baseline.train INFO: normal accuracy 0.7872389258664219 1.8265330791473389 
2022-04-19 10:31:25,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 10:31:25,202 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 182.7%
2022-04-19 10:31:45,460 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.117, Acc: 0.896, Base Lr: 3.38e-03
2022-04-19 10:32:05,573 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.108, Acc: 0.896, Base Lr: 3.38e-03
2022-04-19 10:32:19,459 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.198[s] Speed: 80.6[samples/s]
2022-04-19 10:33:45,470 reid_baseline.train INFO: normal accuracy 0.7925177874684416 1.7542517185211182 
2022-04-19 10:33:48,573 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 10:33:48,574 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 175.4%
2022-04-19 10:34:10,610 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.084, Acc: 0.910, Base Lr: 2.77e-03
2022-04-19 10:34:29,714 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.087, Acc: 0.906, Base Lr: 2.77e-03
2022-04-19 10:34:46,133 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.211[s] Speed: 76.0[samples/s]
2022-04-19 10:36:07,910 reid_baseline.train INFO: normal accuracy 0.7913702088593069 1.7610933780670166 
2022-04-19 10:36:07,910 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 10:36:07,910 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 176.1%
2022-04-19 10:36:28,773 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.030, Acc: 0.930, Base Lr: 2.20e-03
2022-04-19 10:36:48,033 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.043, Acc: 0.923, Base Lr: 2.20e-03
2022-04-19 10:37:03,148 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.202[s] Speed: 79.2[samples/s]
2022-04-19 10:38:23,192 reid_baseline.train INFO: normal accuracy 0.7925177874684416 1.7641136646270752 
2022-04-19 10:38:23,192 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 10:38:23,192 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 176.4%
2022-04-19 10:38:45,967 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.060, Acc: 0.914, Base Lr: 1.66e-03
2022-04-19 10:39:05,262 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.054, Acc: 0.915, Base Lr: 1.66e-03
2022-04-19 10:39:18,541 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.202[s] Speed: 79.0[samples/s]
2022-04-19 10:40:40,664 reid_baseline.train INFO: normal accuracy 0.7941243975212302 1.730520248413086 
2022-04-19 10:40:43,757 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 10:40:43,758 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 173.1%
2022-04-19 10:41:06,374 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.999, Acc: 0.929, Base Lr: 1.19e-03
2022-04-19 10:41:26,019 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.023, Acc: 0.923, Base Lr: 1.19e-03
2022-04-19 10:41:40,482 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.207[s] Speed: 77.1[samples/s]
2022-04-19 10:43:01,256 reid_baseline.train INFO: normal accuracy 0.794812944686711 1.6926727294921875 
2022-04-19 10:43:04,366 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 10:43:04,367 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 169.3%
2022-04-19 10:43:25,867 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.023, Acc: 0.925, Base Lr: 7.78e-04
2022-04-19 10:43:44,549 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.027, Acc: 0.930, Base Lr: 7.78e-04
2022-04-19 10:43:58,669 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.199[s] Speed: 80.6[samples/s]
2022-04-19 10:45:21,568 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.73934006690979 
2022-04-19 10:45:21,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 10:45:21,568 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 173.9%
2022-04-19 10:45:42,413 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.039, Acc: 0.919, Base Lr: 4.51e-04
2022-04-19 10:46:02,336 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.032, Acc: 0.923, Base Lr: 4.51e-04
2022-04-19 10:46:17,861 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.206[s] Speed: 77.7[samples/s]
2022-04-19 10:47:41,056 reid_baseline.train INFO: normal accuracy 0.7934358503557494 1.7324386835098267 
2022-04-19 10:47:41,056 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 10:47:41,056 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 173.2%
2022-04-19 10:48:02,314 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.023, Acc: 0.926, Base Lr: 2.11e-04
2022-04-19 10:48:22,102 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.029, Acc: 0.924, Base Lr: 2.11e-04
2022-04-19 10:48:35,915 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.201[s] Speed: 79.7[samples/s]
2022-04-19 10:49:58,938 reid_baseline.train INFO: normal accuracy 0.7968785861831535 1.7011780738830566 
2022-04-19 10:49:58,939 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 10:49:58,939 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 170.1%
2022-04-19 10:50:20,762 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.037, Acc: 0.923, Base Lr: 6.51e-05
2022-04-19 10:50:40,665 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.032, Acc: 0.926, Base Lr: 6.51e-05
2022-04-19 10:50:53,435 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.199[s] Speed: 80.3[samples/s]
2022-04-19 10:52:14,303 reid_baseline.train INFO: normal accuracy 0.795042460408538 1.6748943328857422 
2022-04-19 10:52:17,416 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 10:52:17,416 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 167.5%
2022-04-19 10:52:38,146 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.014, Acc: 0.932, Base Lr: 1.60e-05
2022-04-19 10:52:56,796 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.016, Acc: 0.930, Base Lr: 1.60e-05
2022-04-19 10:53:10,781 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.195[s] Speed: 82.0[samples/s]
2022-04-19 10:54:36,007 reid_baseline.train INFO: normal accuracy 0.7929768189120955 1.7959743738174438 
2022-04-19 10:54:36,007 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 10:54:36,007 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 179.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_aug_key_8_20_10/transformer_best_model.pth
2022-04-19 10:56:03,837 reid_baseline.train INFO: normal accuracy 0.795042460408538 1.6748943328857422 
2022-04-19 10:56:03,837 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:56:03,837 reid_baseline.train INFO: Accuracy: 79.5%
2022-04-19 10:57:27,501 reid_baseline.train INFO: normal accuracy 0.795042460408538 1.6748943328857422 
2022-04-19 10:57:27,501 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:57:27,501 reid_baseline.train INFO: Shuffled Accuracy: 79.5%
2022-04-19 10:57:52,227 reid_baseline.train INFO: normal accuracy 0.9585337915234823 0.7679342031478882 
2022-04-19 10:57:52,227 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:57:52,227 reid_baseline.train INFO: Source Clean Accuracy: 95.9%
