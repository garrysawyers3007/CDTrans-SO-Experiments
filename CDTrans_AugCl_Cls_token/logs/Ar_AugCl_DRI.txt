2022-05-02 17:22:20,933 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Art_2_Clipart_Key_AugCl_DRI
2022-05-02 17:22:20,934 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Art_2_Clipart_Key_AugCl_DRI', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, augcl_path='../logs/pretrain/deit_base/office-home/Art_AugCl_DRI/transformer_best_model.pth')
2022-05-02 17:22:20,934 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-02 17:22:20,934 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-02 17:22:20,934 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Art_2_Clipart_Key_AugCl_DRI
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_AugCl_DRI/transformer_best_model.pth
pretrain train
2022-05-02 17:22:34,878 reid_baseline.train INFO: start training
2022-05-02 17:23:32,977 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.154, Acc: 0.075, Base Lr: 8.72e-04
2022-05-02 17:23:55,542 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.522[s] Speed: 30.7[samples/s]
2022-05-02 17:25:04,637 reid_baseline.train INFO: normal accuracy 0.06964490263459336 4.172163963317871 
2022-05-02 17:25:05,460 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-02 17:25:05,460 reid_baseline.train INFO: Accuracy: 7.0% Mean Entropy: 417.2%
2022-05-02 17:25:49,552 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 4.038, Acc: 0.171, Base Lr: 1.66e-03
2022-05-02 17:26:09,781 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.423[s] Speed: 37.8[samples/s]
2022-05-02 17:27:22,098 reid_baseline.train INFO: normal accuracy 0.0829324169530355 4.166345119476318 
2022-05-02 17:27:23,015 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-02 17:27:23,015 reid_baseline.train INFO: Accuracy: 8.3% Mean Entropy: 416.6%
2022-05-02 17:28:07,059 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.867, Acc: 0.168, Base Lr: 2.46e-03
2022-05-02 17:28:27,151 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.422[s] Speed: 38.0[samples/s]
2022-05-02 17:29:38,914 reid_baseline.train INFO: normal accuracy 0.09232531500572738 4.142265796661377 
2022-05-02 17:29:39,731 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-02 17:29:39,731 reid_baseline.train INFO: Accuracy: 9.2% Mean Entropy: 414.2%
2022-05-02 17:30:24,786 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 3.663, Acc: 0.208, Base Lr: 3.25e-03
2022-05-02 17:30:44,735 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.427[s] Speed: 37.5[samples/s]
2022-05-02 17:31:51,615 reid_baseline.train INFO: normal accuracy 0.09621993127147767 4.099143981933594 
2022-05-02 17:31:52,508 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-02 17:31:52,509 reid_baseline.train INFO: Accuracy: 9.6% Mean Entropy: 409.9%
2022-05-02 17:32:37,392 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.469, Acc: 0.221, Base Lr: 4.04e-03
2022-05-02 17:32:57,367 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.426[s] Speed: 37.5[samples/s]
2022-05-02 17:34:06,672 reid_baseline.train INFO: normal accuracy 0.09186712485681559 4.025845050811768 
2022-05-02 17:34:07,528 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-02 17:34:07,528 reid_baseline.train INFO: Accuracy: 9.2% Mean Entropy: 402.6%
2022-05-02 17:34:51,708 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.265, Acc: 0.297, Base Lr: 4.83e-03
2022-05-02 17:35:12,397 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.426[s] Speed: 37.5[samples/s]
2022-05-02 17:36:22,774 reid_baseline.train INFO: normal accuracy 0.10836197021764032 3.9145524501800537 
2022-05-02 17:36:23,619 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-02 17:36:23,619 reid_baseline.train INFO: Accuracy: 10.8% Mean Entropy: 391.5%
2022-05-02 17:37:08,160 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.015, Acc: 0.348, Base Lr: 5.62e-03
2022-05-02 17:37:29,170 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.431[s] Speed: 37.1[samples/s]
2022-05-02 17:38:39,467 reid_baseline.train INFO: normal accuracy 0.14845360824742268 3.8202104568481445 
2022-05-02 17:38:40,265 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-02 17:38:40,266 reid_baseline.train INFO: Accuracy: 14.8% Mean Entropy: 382.0%
2022-05-02 17:39:23,659 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 2.844, Acc: 0.369, Base Lr: 6.42e-03
2022-05-02 17:39:43,957 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.419[s] Speed: 38.2[samples/s]
2022-05-02 17:40:51,497 reid_baseline.train INFO: normal accuracy 0.1967926689576174 3.6655795574188232 
2022-05-02 17:40:52,286 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-02 17:40:52,287 reid_baseline.train INFO: Accuracy: 19.7% Mean Entropy: 366.6%
2022-05-02 17:41:35,833 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 2.771, Acc: 0.395, Base Lr: 7.21e-03
2022-05-02 17:41:56,131 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.420[s] Speed: 38.1[samples/s]
2022-05-02 17:43:04,506 reid_baseline.train INFO: normal accuracy 0.2625429553264605 3.6259894371032715 
2022-05-02 17:43:05,320 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-02 17:43:05,320 reid_baseline.train INFO: Accuracy: 26.3% Mean Entropy: 362.6%
2022-05-02 17:43:49,461 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.598, Acc: 0.433, Base Lr: 4.01e-03
2022-05-02 17:44:10,016 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.426[s] Speed: 37.6[samples/s]
2022-05-02 17:45:21,383 reid_baseline.train INFO: normal accuracy 0.26804123711340205 3.5473341941833496 
2022-05-02 17:45:22,249 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-02 17:45:22,249 reid_baseline.train INFO: Accuracy: 26.8% Mean Entropy: 354.7%
2022-05-02 17:46:05,682 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.467, Acc: 0.482, Base Lr: 3.38e-03
2022-05-02 17:46:25,902 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.419[s] Speed: 38.2[samples/s]
2022-05-02 17:47:34,758 reid_baseline.train INFO: normal accuracy 0.29759450171821306 3.5431041717529297 
2022-05-02 17:47:35,524 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-02 17:47:35,524 reid_baseline.train INFO: Accuracy: 29.8% Mean Entropy: 354.3%
2022-05-02 17:48:19,271 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.388, Acc: 0.518, Base Lr: 2.77e-03
2022-05-02 17:48:39,636 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.421[s] Speed: 38.0[samples/s]
2022-05-02 17:49:47,485 reid_baseline.train INFO: normal accuracy 0.30652920962199315 3.5075955390930176 
2022-05-02 17:49:48,266 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-02 17:49:48,267 reid_baseline.train INFO: Accuracy: 30.7% Mean Entropy: 350.8%
2022-05-02 17:50:32,135 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.326, Acc: 0.529, Base Lr: 2.20e-03
2022-05-02 17:50:53,458 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.428[s] Speed: 37.3[samples/s]
2022-05-02 17:52:00,417 reid_baseline.train INFO: normal accuracy 0.30469644902634596 3.4873738288879395 
2022-05-02 17:52:01,234 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-02 17:52:01,234 reid_baseline.train INFO: Accuracy: 30.5% Mean Entropy: 348.7%
2022-05-02 17:52:44,594 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.295, Acc: 0.535, Base Lr: 1.66e-03
2022-05-02 17:53:05,839 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.424[s] Speed: 37.8[samples/s]
2022-05-02 17:54:15,230 reid_baseline.train INFO: normal accuracy 0.32004581901489115 3.4544837474823 
2022-05-02 17:54:16,091 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-02 17:54:16,091 reid_baseline.train INFO: Accuracy: 32.0% Mean Entropy: 345.4%
2022-05-02 17:55:00,926 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.215, Acc: 0.565, Base Lr: 1.19e-03
2022-05-02 17:55:20,251 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.421[s] Speed: 38.0[samples/s]
2022-05-02 17:56:27,553 reid_baseline.train INFO: normal accuracy 0.3163802978235968 3.4029862880706787 
2022-05-02 17:56:28,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-02 17:56:28,455 reid_baseline.train INFO: Accuracy: 31.6% Mean Entropy: 340.3%
2022-05-02 17:57:12,205 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.233, Acc: 0.546, Base Lr: 7.78e-04
2022-05-02 17:57:32,585 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.422[s] Speed: 37.9[samples/s]
2022-05-02 17:58:42,933 reid_baseline.train INFO: normal accuracy 0.32783505154639175 3.4499149322509766 
2022-05-02 17:58:42,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-02 17:58:42,934 reid_baseline.train INFO: Accuracy: 32.8% Mean Entropy: 345.0%
2022-05-02 17:59:27,819 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.249, Acc: 0.556, Base Lr: 4.51e-04
2022-05-02 17:59:47,435 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.424[s] Speed: 37.7[samples/s]
2022-05-02 18:00:56,200 reid_baseline.train INFO: normal accuracy 0.3319587628865979 3.4443118572235107 
2022-05-02 18:00:56,201 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-02 18:00:56,201 reid_baseline.train INFO: Accuracy: 33.2% Mean Entropy: 344.4%
2022-05-02 18:01:40,618 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.198, Acc: 0.591, Base Lr: 2.11e-04
2022-05-02 18:02:00,773 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.424[s] Speed: 37.7[samples/s]
2022-05-02 18:03:09,035 reid_baseline.train INFO: normal accuracy 0.32668957617411226 3.4274685382843018 
2022-05-02 18:03:09,035 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-02 18:03:09,035 reid_baseline.train INFO: Accuracy: 32.7% Mean Entropy: 342.7%
2022-05-02 18:03:52,904 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.192, Acc: 0.562, Base Lr: 6.51e-05
2022-05-02 18:04:13,048 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.421[s] Speed: 38.0[samples/s]
2022-05-02 18:05:20,852 reid_baseline.train INFO: normal accuracy 0.3223367697594502 3.4280083179473877 
2022-05-02 18:05:20,852 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-02 18:05:20,852 reid_baseline.train INFO: Accuracy: 32.2% Mean Entropy: 342.8%
2022-05-02 18:06:04,762 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.159, Acc: 0.572, Base Lr: 1.60e-05
2022-05-02 18:06:24,808 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.421[s] Speed: 38.0[samples/s]
2022-05-02 18:07:33,772 reid_baseline.train INFO: normal accuracy 0.3218785796105384 3.420607566833496 
2022-05-02 18:07:33,772 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-02 18:07:33,772 reid_baseline.train INFO: Accuracy: 32.2% Mean Entropy: 342.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Art_2_Clipart_Key_AugCl_DRI/transformer_best_model.pth
2022-05-02 18:08:44,436 reid_baseline.train INFO: normal accuracy 0.3163802978235968 3.4029862880706787 
2022-05-02 18:08:44,436 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 18:08:44,436 reid_baseline.train INFO: Accuracy: 31.6%
2022-05-02 18:09:53,580 reid_baseline.train INFO: normal accuracy 0.3163802978235968 3.4029862880706787 
2022-05-02 18:09:53,581 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 18:09:53,581 reid_baseline.train INFO: Shuffled Accuracy: 31.6%
2022-05-02 18:10:52,772 reid_baseline.train INFO: normal accuracy 0.6777915121549237 2.9410593509674072 
2022-05-02 18:10:52,772 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 18:10:52,772 reid_baseline.train INFO: Source Clean Accuracy: 67.8%
2022-05-02 18:10:58,282 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Art_2_Product_Key_AugCl_DRI
2022-05-02 18:10:58,283 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Art_2_Product_Key_AugCl_DRI', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, augcl_path='../logs/pretrain/deit_base/office-home/Art_AugCl_DRI/transformer_best_model.pth')
2022-05-02 18:10:58,283 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-02 18:10:58,283 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-02 18:10:58,283 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Art_2_Product_Key_AugCl_DRI
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_AugCl_DRI/transformer_best_model.pth
pretrain train
2022-05-02 18:11:12,199 reid_baseline.train INFO: start training
2022-05-02 18:12:10,208 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.154, Acc: 0.075, Base Lr: 8.72e-04
2022-05-02 18:12:32,792 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.521[s] Speed: 30.7[samples/s]
2022-05-02 18:13:44,900 reid_baseline.train INFO: normal accuracy 0.0820004505519261 4.172502517700195 
2022-05-02 18:13:45,636 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-02 18:13:45,636 reid_baseline.train INFO: Accuracy: 8.2% Mean Entropy: 417.3%
2022-05-02 18:14:30,584 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 4.038, Acc: 0.171, Base Lr: 1.66e-03
2022-05-02 18:14:50,715 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.428[s] Speed: 37.4[samples/s]
2022-05-02 18:16:01,862 reid_baseline.train INFO: normal accuracy 0.0948411804460464 4.16793155670166 
2022-05-02 18:16:02,717 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-02 18:16:02,718 reid_baseline.train INFO: Accuracy: 9.5% Mean Entropy: 416.8%
2022-05-02 18:16:46,681 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.867, Acc: 0.168, Base Lr: 2.46e-03
2022-05-02 18:17:07,513 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.426[s] Speed: 37.5[samples/s]
2022-05-02 18:18:22,668 reid_baseline.train INFO: normal accuracy 0.11061049785987835 4.147068500518799 
2022-05-02 18:18:23,536 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-02 18:18:23,536 reid_baseline.train INFO: Accuracy: 11.1% Mean Entropy: 414.7%
2022-05-02 18:19:14,550 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 3.663, Acc: 0.208, Base Lr: 3.25e-03
2022-05-02 18:19:35,989 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.477[s] Speed: 33.6[samples/s]
2022-05-02 18:20:50,267 reid_baseline.train INFO: normal accuracy 0.13719306150033792 4.106380939483643 
2022-05-02 18:20:51,048 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-02 18:20:51,049 reid_baseline.train INFO: Accuracy: 13.7% Mean Entropy: 410.6%
2022-05-02 18:21:40,662 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.469, Acc: 0.221, Base Lr: 4.04e-03
2022-05-02 18:22:01,117 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.461[s] Speed: 34.7[samples/s]
2022-05-02 18:23:12,129 reid_baseline.train INFO: normal accuracy 0.1220995719756702 4.03477144241333 
2022-05-02 18:23:12,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-02 18:23:12,947 reid_baseline.train INFO: Accuracy: 12.2% Mean Entropy: 403.5%
2022-05-02 18:24:00,915 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.265, Acc: 0.297, Base Lr: 4.83e-03
2022-05-02 18:24:22,353 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.456[s] Speed: 35.1[samples/s]
2022-05-02 18:25:37,316 reid_baseline.train INFO: normal accuracy 0.16107231358414056 3.9283814430236816 
2022-05-02 18:25:38,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-02 18:25:38,155 reid_baseline.train INFO: Accuracy: 16.1% Mean Entropy: 392.8%
2022-05-02 18:26:27,851 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.015, Acc: 0.348, Base Lr: 5.62e-03
2022-05-02 18:26:50,217 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.474[s] Speed: 33.8[samples/s]
2022-05-02 18:28:07,631 reid_baseline.train INFO: normal accuracy 0.21671547645866185 3.8351032733917236 
2022-05-02 18:28:08,501 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-02 18:28:08,502 reid_baseline.train INFO: Accuracy: 21.7% Mean Entropy: 383.5%
2022-05-02 18:28:57,540 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 2.844, Acc: 0.369, Base Lr: 6.42e-03
2022-05-02 18:29:19,340 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.466[s] Speed: 34.4[samples/s]
2022-05-02 18:30:31,005 reid_baseline.train INFO: normal accuracy 0.2755125028159495 3.682790994644165 
2022-05-02 18:30:31,840 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-02 18:30:31,840 reid_baseline.train INFO: Accuracy: 27.6% Mean Entropy: 368.3%
2022-05-02 18:31:20,714 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 2.771, Acc: 0.395, Base Lr: 7.21e-03
2022-05-02 18:31:43,878 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.474[s] Speed: 33.8[samples/s]
2022-05-02 18:32:55,445 reid_baseline.train INFO: normal accuracy 0.3338589772471277 3.6169328689575195 
2022-05-02 18:32:56,420 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-02 18:32:56,420 reid_baseline.train INFO: Accuracy: 33.4% Mean Entropy: 361.7%
2022-05-02 18:33:44,531 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.598, Acc: 0.433, Base Lr: 4.01e-03
2022-05-02 18:34:06,306 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.459[s] Speed: 34.9[samples/s]
2022-05-02 18:35:25,342 reid_baseline.train INFO: normal accuracy 0.34669970714124804 3.525080442428589 
2022-05-02 18:35:26,193 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-02 18:35:26,194 reid_baseline.train INFO: Accuracy: 34.7% Mean Entropy: 352.5%
2022-05-02 18:36:14,393 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.467, Acc: 0.482, Base Lr: 3.38e-03
2022-05-02 18:36:36,684 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.464[s] Speed: 34.5[samples/s]
2022-05-02 18:37:49,492 reid_baseline.train INFO: normal accuracy 0.38161748141473306 3.504748821258545 
2022-05-02 18:37:50,305 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-02 18:37:50,305 reid_baseline.train INFO: Accuracy: 38.2% Mean Entropy: 350.5%
2022-05-02 18:38:39,428 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.388, Acc: 0.518, Base Lr: 2.77e-03
2022-05-02 18:39:01,440 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.468[s] Speed: 34.2[samples/s]
2022-05-02 18:40:13,748 reid_baseline.train INFO: normal accuracy 0.3996395584591124 3.4615638256073 
2022-05-02 18:40:14,589 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-02 18:40:14,589 reid_baseline.train INFO: Accuracy: 40.0% Mean Entropy: 346.2%
2022-05-02 18:41:04,749 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.326, Acc: 0.529, Base Lr: 2.20e-03
2022-05-02 18:41:28,046 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.483[s] Speed: 33.1[samples/s]
2022-05-02 18:42:40,435 reid_baseline.train INFO: normal accuracy 0.4023428700157693 3.4445955753326416 
2022-05-02 18:42:41,253 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-02 18:42:41,254 reid_baseline.train INFO: Accuracy: 40.2% Mean Entropy: 344.5%
2022-05-02 18:43:28,855 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.295, Acc: 0.535, Base Lr: 1.66e-03
2022-05-02 18:43:50,746 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.457[s] Speed: 35.0[samples/s]
2022-05-02 18:45:04,076 reid_baseline.train INFO: normal accuracy 0.4050461815724262 3.3942770957946777 
2022-05-02 18:45:04,954 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-02 18:45:04,955 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 339.4%
2022-05-02 18:45:52,443 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.215, Acc: 0.565, Base Lr: 1.19e-03
2022-05-02 18:46:13,304 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.449[s] Speed: 35.6[samples/s]
2022-05-02 18:47:24,679 reid_baseline.train INFO: normal accuracy 0.41338139220545167 3.335601329803467 
2022-05-02 18:47:25,485 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-02 18:47:25,485 reid_baseline.train INFO: Accuracy: 41.3% Mean Entropy: 333.6%
2022-05-02 18:48:13,426 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.233, Acc: 0.546, Base Lr: 7.78e-04
2022-05-02 18:48:34,812 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.455[s] Speed: 35.1[samples/s]
2022-05-02 18:49:47,851 reid_baseline.train INFO: normal accuracy 0.41923856724487496 3.405269145965576 
2022-05-02 18:49:47,852 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-02 18:49:47,852 reid_baseline.train INFO: Accuracy: 41.9% Mean Entropy: 340.5%
2022-05-02 18:50:37,542 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.249, Acc: 0.556, Base Lr: 4.51e-04
2022-05-02 18:50:59,999 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.474[s] Speed: 33.7[samples/s]
2022-05-02 18:52:12,192 reid_baseline.train INFO: normal accuracy 0.4318540211759405 3.3877065181732178 
2022-05-02 18:52:12,192 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-02 18:52:12,192 reid_baseline.train INFO: Accuracy: 43.2% Mean Entropy: 338.8%
2022-05-02 18:53:02,016 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.198, Acc: 0.591, Base Lr: 2.11e-04
2022-05-02 18:53:24,466 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.475[s] Speed: 33.7[samples/s]
2022-05-02 18:54:40,945 reid_baseline.train INFO: normal accuracy 0.4266726740256815 3.3692333698272705 
2022-05-02 18:54:40,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-02 18:54:40,946 reid_baseline.train INFO: Accuracy: 42.7% Mean Entropy: 336.9%
2022-05-02 18:55:32,432 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.192, Acc: 0.562, Base Lr: 6.51e-05
2022-05-02 18:55:54,645 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.484[s] Speed: 33.1[samples/s]
2022-05-02 18:57:09,543 reid_baseline.train INFO: normal accuracy 0.4217166028384771 3.3767592906951904 
2022-05-02 18:57:09,544 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-02 18:57:09,544 reid_baseline.train INFO: Accuracy: 42.2% Mean Entropy: 337.7%
2022-05-02 18:58:02,459 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.159, Acc: 0.572, Base Lr: 1.60e-05
2022-05-02 18:58:25,037 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.496[s] Speed: 32.3[samples/s]
2022-05-02 18:59:43,482 reid_baseline.train INFO: normal accuracy 0.42487046632124353 3.3575758934020996 
2022-05-02 18:59:43,483 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-02 18:59:43,483 reid_baseline.train INFO: Accuracy: 42.5% Mean Entropy: 335.8%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Art_2_Product_Key_AugCl_DRI/transformer_best_model.pth
2022-05-02 19:01:02,729 reid_baseline.train INFO: normal accuracy 0.41338139220545167 3.335601329803467 
2022-05-02 19:01:02,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 19:01:02,729 reid_baseline.train INFO: Accuracy: 41.3%
2022-05-02 19:02:21,431 reid_baseline.train INFO: normal accuracy 0.41338139220545167 3.335601329803467 
2022-05-02 19:02:21,431 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 19:02:21,431 reid_baseline.train INFO: Shuffled Accuracy: 41.3%
2022-05-02 19:03:25,973 reid_baseline.train INFO: normal accuracy 0.6777915121549237 2.9410593509674072 
2022-05-02 19:03:25,974 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 19:03:25,974 reid_baseline.train INFO: Source Clean Accuracy: 67.8%
2022-05-02 19:03:31,256 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Art_2_Real_World_Key_AugCl_DRI
2022-05-02 19:03:31,256 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Art_2_Real_World_Key_AugCl_DRI', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, augcl_path='../logs/pretrain/deit_base/office-home/Art_AugCl_DRI/transformer_best_model.pth')
2022-05-02 19:03:31,256 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-02 19:03:31,256 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-02 19:03:31,256 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Art_2_Real_World_Key_AugCl_DRI
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_AugCl_DRI/transformer_best_model.pth
pretrain train
2022-05-02 19:03:42,852 reid_baseline.train INFO: start training
2022-05-02 19:04:44,638 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.154, Acc: 0.075, Base Lr: 8.72e-04
2022-05-02 19:05:07,960 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.553[s] Speed: 28.9[samples/s]
2022-05-02 19:08:38,762 reid_baseline.train INFO: normal accuracy 0.09387193022722057 4.172487258911133 
2022-05-02 19:08:39,550 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-02 19:08:39,551 reid_baseline.train INFO: Accuracy: 9.4% Mean Entropy: 417.2%
2022-05-02 19:09:31,785 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 4.038, Acc: 0.171, Base Lr: 1.66e-03
2022-05-02 19:09:54,147 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.490[s] Speed: 32.6[samples/s]
2022-05-02 19:13:25,331 reid_baseline.train INFO: normal accuracy 0.1276107413357815 4.167791843414307 
2022-05-02 19:13:26,234 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-02 19:13:26,235 reid_baseline.train INFO: Accuracy: 12.8% Mean Entropy: 416.8%
2022-05-02 19:14:18,250 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.867, Acc: 0.168, Base Lr: 2.46e-03
2022-05-02 19:14:41,644 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.495[s] Speed: 32.3[samples/s]
