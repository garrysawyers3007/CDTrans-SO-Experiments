2022-04-19 03:35:37,687 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_1_20_10
2022-04-19 03:35:37,688 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_1_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-19 03:35:37,688 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 03:35:37,688 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 03:35:37,688 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_1_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 03:35:54,038 reid_baseline.train INFO: start training
2022-04-19 03:37:24,272 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.282, Base Lr: 8.72e-04
2022-04-19 03:37:58,745 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.786[s] Speed: 20.4[samples/s]
2022-04-19 03:39:01,736 reid_baseline.train INFO: normal accuracy 0.38579610538373427 4.171739101409912 
2022-04-19 03:39:05,250 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 03:39:05,250 reid_baseline.train INFO: Accuracy: 38.6% Mean Entropy: 417.2%
2022-04-19 03:40:10,531 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.810, Acc: 0.591, Base Lr: 1.66e-03
2022-04-19 03:40:46,840 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.668[s] Speed: 23.9[samples/s]
2022-04-19 03:41:51,230 reid_baseline.train INFO: normal accuracy 0.41809851088201605 4.150990009307861 
2022-04-19 03:41:52,141 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 03:41:52,142 reid_baseline.train INFO: Accuracy: 41.8% Mean Entropy: 415.1%
2022-04-19 03:42:57,737 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.212, Acc: 0.625, Base Lr: 2.46e-03
2022-04-19 03:43:31,986 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.656[s] Speed: 24.4[samples/s]
2022-04-19 03:44:37,323 reid_baseline.train INFO: normal accuracy 0.4355097365406644 3.986576557159424 
2022-04-19 03:44:38,222 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 03:44:38,222 reid_baseline.train INFO: Accuracy: 43.6% Mean Entropy: 398.7%
2022-04-19 03:45:44,273 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.465, Acc: 0.674, Base Lr: 3.25e-03
2022-04-19 03:46:19,385 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.666[s] Speed: 24.0[samples/s]
2022-04-19 03:47:22,714 reid_baseline.train INFO: normal accuracy 0.49095074455899196 3.496351957321167 
2022-04-19 03:47:24,030 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 03:47:24,030 reid_baseline.train INFO: Accuracy: 49.1% Mean Entropy: 349.6%
2022-04-19 03:48:28,953 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.939, Acc: 0.726, Base Lr: 4.04e-03
2022-04-19 03:49:03,513 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.654[s] Speed: 24.4[samples/s]
2022-04-19 03:50:06,754 reid_baseline.train INFO: normal accuracy 0.5482245131729668 3.0405755043029785 
2022-04-19 03:50:07,670 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 03:50:07,671 reid_baseline.train INFO: Accuracy: 54.8% Mean Entropy: 304.1%
2022-04-19 03:51:14,263 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.648, Acc: 0.772, Base Lr: 4.83e-03
2022-04-19 03:51:48,368 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.662[s] Speed: 24.2[samples/s]
2022-04-19 03:52:51,850 reid_baseline.train INFO: normal accuracy 0.5928980526918671 2.665125608444214 
2022-04-19 03:52:52,734 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 03:52:52,734 reid_baseline.train INFO: Accuracy: 59.3% Mean Entropy: 266.5%
2022-04-19 03:53:59,102 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.468, Acc: 0.814, Base Lr: 5.62e-03
2022-04-19 03:54:30,998 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.646[s] Speed: 24.8[samples/s]
2022-04-19 03:55:33,978 reid_baseline.train INFO: normal accuracy 0.6018327605956472 2.4065351486206055 
2022-04-19 03:55:34,876 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 03:55:34,876 reid_baseline.train INFO: Accuracy: 60.2% Mean Entropy: 240.7%
2022-04-19 03:56:38,477 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.336, Acc: 0.846, Base Lr: 6.42e-03
2022-04-19 03:57:10,516 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.629[s] Speed: 25.4[samples/s]
2022-04-19 03:58:12,253 reid_baseline.train INFO: normal accuracy 0.611454753722795 2.131505012512207 
2022-04-19 03:58:13,158 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 03:58:13,158 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 213.2%
2022-04-19 03:59:21,613 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.243, Acc: 0.872, Base Lr: 7.21e-03
2022-04-19 03:59:55,266 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.671[s] Speed: 23.9[samples/s]
2022-04-19 04:00:58,504 reid_baseline.train INFO: normal accuracy 0.616036655211913 2.090919017791748 
2022-04-19 04:01:00,350 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 04:01:00,350 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 209.1%
2022-04-19 04:02:04,672 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.155, Acc: 0.891, Base Lr: 4.01e-03
2022-04-19 04:02:36,027 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.629[s] Speed: 25.4[samples/s]
2022-04-19 04:03:40,276 reid_baseline.train INFO: normal accuracy 0.6185567010309279 2.016319990158081 
2022-04-19 04:03:41,201 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 04:03:41,201 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 201.6%
2022-04-19 04:04:48,081 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.136, Acc: 0.892, Base Lr: 3.38e-03
2022-04-19 04:05:21,625 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.661[s] Speed: 24.2[samples/s]
2022-04-19 04:06:25,852 reid_baseline.train INFO: normal accuracy 0.6224513172966781 1.8859001398086548 
2022-04-19 04:06:26,791 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 04:06:26,791 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 188.6%
2022-04-19 04:07:35,180 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.116, Acc: 0.912, Base Lr: 2.77e-03
2022-04-19 04:08:10,661 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.683[s] Speed: 23.4[samples/s]
2022-04-19 04:09:14,878 reid_baseline.train INFO: normal accuracy 0.6256586483390607 1.8517162799835205 
2022-04-19 04:09:15,951 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 04:09:15,951 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 185.2%
2022-04-19 04:10:28,463 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.083, Acc: 0.923, Base Lr: 2.20e-03
2022-04-19 04:11:05,145 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.718[s] Speed: 22.3[samples/s]
2022-04-19 04:12:07,939 reid_baseline.train INFO: normal accuracy 0.6268041237113402 1.8280718326568604 
2022-04-19 04:12:09,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 04:12:09,365 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 182.8%
2022-04-19 04:13:21,099 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.078, Acc: 0.922, Base Lr: 1.66e-03
2022-04-19 04:13:55,526 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.698[s] Speed: 22.9[samples/s]
2022-04-19 04:15:00,031 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.863274097442627 
2022-04-19 04:15:00,035 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 04:15:00,036 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.3%
2022-04-19 04:16:14,879 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.051, Acc: 0.931, Base Lr: 1.19e-03
2022-04-19 04:16:48,310 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.712[s] Speed: 22.5[samples/s]
2022-04-19 04:17:51,910 reid_baseline.train INFO: normal accuracy 0.6311569301260023 1.8887768983840942 
2022-04-19 04:17:51,915 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 04:17:51,915 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 188.9%
2022-04-19 04:19:04,352 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.048, Acc: 0.933, Base Lr: 7.78e-04
2022-04-19 04:19:40,262 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.713[s] Speed: 22.4[samples/s]
2022-04-19 04:20:43,972 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.856577754020691 
2022-04-19 04:20:43,976 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 04:20:43,976 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 185.7%
2022-04-19 04:21:56,101 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.050, Acc: 0.926, Base Lr: 4.51e-04
2022-04-19 04:22:34,916 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.729[s] Speed: 22.0[samples/s]
2022-04-19 04:23:40,328 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.890058159828186 
2022-04-19 04:23:40,332 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 04:23:40,333 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 189.0%
2022-04-19 04:24:50,519 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.049, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 04:25:26,733 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.700[s] Speed: 22.9[samples/s]
2022-04-19 04:26:30,173 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.8677048683166504 
2022-04-19 04:26:30,175 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 04:26:30,175 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.8%
2022-04-19 04:27:43,827 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.050, Acc: 0.925, Base Lr: 6.51e-05
2022-04-19 04:28:17,862 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.708[s] Speed: 22.6[samples/s]
2022-04-19 04:29:22,979 reid_baseline.train INFO: normal accuracy 0.6311569301260023 1.8225667476654053 
2022-04-19 04:29:23,980 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 04:29:23,980 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 182.3%
2022-04-19 04:30:33,079 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.041, Acc: 0.937, Base Lr: 1.60e-05
2022-04-19 04:31:08,761 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.689[s] Speed: 23.2[samples/s]
2022-04-19 04:32:12,164 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.8199362754821777 
2022-04-19 04:32:13,589 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 04:32:13,590 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 182.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_1_20_10/transformer_best_model.pth
2022-04-19 04:33:18,905 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.8199362754821777 
2022-04-19 04:33:18,905 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:33:18,905 reid_baseline.train INFO: Accuracy: 63.1%
2022-04-19 04:34:21,841 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.8199362754821777 
2022-04-19 04:34:21,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:34:21,842 reid_baseline.train INFO: Shuffled Accuracy: 63.1%
2022-04-19 04:35:03,037 reid_baseline.train INFO: normal accuracy 0.9723939019365472 0.8669106364250183 
2022-04-19 04:35:03,038 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:35:03,038 reid_baseline.train INFO: Source Clean Accuracy: 97.2%
2022-04-19 04:35:10,068 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_1_20_10
2022-04-19 04:35:10,068 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_1_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-19 04:35:10,069 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 04:35:10,069 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 04:35:10,069 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_1_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 04:35:26,149 reid_baseline.train INFO: start training
2022-04-19 04:36:54,347 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.283, Base Lr: 8.72e-04
2022-04-19 04:37:31,061 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.789[s] Speed: 20.3[samples/s]
2022-04-19 04:38:34,521 reid_baseline.train INFO: normal accuracy 0.48186528497409326 4.171886444091797 
2022-04-19 04:38:35,464 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 04:38:35,464 reid_baseline.train INFO: Accuracy: 48.2% Mean Entropy: 417.2%
2022-04-19 04:39:48,457 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.810, Acc: 0.591, Base Lr: 1.66e-03
2022-04-19 04:40:27,021 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.733[s] Speed: 21.8[samples/s]
2022-04-19 04:41:33,279 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.149710655212402 
2022-04-19 04:41:34,325 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 04:41:34,325 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-19 04:42:47,961 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.212, Acc: 0.625, Base Lr: 2.46e-03
2022-04-19 04:43:27,078 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.742[s] Speed: 21.6[samples/s]
2022-04-19 04:44:32,228 reid_baseline.train INFO: normal accuracy 0.5442667267402568 3.9767515659332275 
2022-04-19 04:44:33,294 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 04:44:33,294 reid_baseline.train INFO: Accuracy: 54.4% Mean Entropy: 397.7%
2022-04-19 04:45:44,187 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.465, Acc: 0.674, Base Lr: 3.25e-03
2022-04-19 04:46:19,448 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.698[s] Speed: 22.9[samples/s]
2022-04-19 04:47:25,079 reid_baseline.train INFO: normal accuracy 0.5933768866861906 3.4297409057617188 
2022-04-19 04:47:26,178 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 04:47:26,178 reid_baseline.train INFO: Accuracy: 59.3% Mean Entropy: 343.0%
2022-04-19 04:48:35,180 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.939, Acc: 0.726, Base Lr: 4.04e-03
2022-04-19 04:49:13,752 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.708[s] Speed: 22.6[samples/s]
2022-04-19 04:50:18,767 reid_baseline.train INFO: normal accuracy 0.6661410227528722 2.8646509647369385 
2022-04-19 04:50:19,731 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 04:50:19,731 reid_baseline.train INFO: Accuracy: 66.6% Mean Entropy: 286.5%
2022-04-19 04:51:32,471 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.648, Acc: 0.772, Base Lr: 4.83e-03
2022-04-19 04:52:10,708 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.730[s] Speed: 21.9[samples/s]
2022-04-19 04:53:17,611 reid_baseline.train INFO: normal accuracy 0.7186303221446272 2.4325597286224365 
2022-04-19 04:53:18,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 04:53:18,688 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 243.3%
2022-04-19 04:54:32,655 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.468, Acc: 0.814, Base Lr: 5.62e-03
2022-04-19 04:55:06,088 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.706[s] Speed: 22.7[samples/s]
2022-04-19 04:56:05,477 reid_baseline.train INFO: normal accuracy 0.7517458887136742 2.1814398765563965 
2022-04-19 04:56:06,506 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 04:56:06,507 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 218.1%
2022-04-19 04:57:14,508 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.336, Acc: 0.847, Base Lr: 6.42e-03
2022-04-19 04:57:50,977 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.687[s] Speed: 23.3[samples/s]
2022-04-19 04:58:55,077 reid_baseline.train INFO: normal accuracy 0.7609822031989186 1.9249650239944458 
2022-04-19 04:58:56,039 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 04:58:56,039 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 192.5%
2022-04-19 05:00:14,309 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.243, Acc: 0.875, Base Lr: 7.21e-03
2022-04-19 05:00:50,289 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.751[s] Speed: 21.3[samples/s]
2022-04-19 05:01:56,005 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.877009391784668 
2022-04-19 05:01:58,383 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 05:01:58,383 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 187.7%
2022-04-19 05:03:09,411 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.154, Acc: 0.893, Base Lr: 4.01e-03
2022-04-19 05:03:45,053 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.702[s] Speed: 22.8[samples/s]
2022-04-19 05:04:51,271 reid_baseline.train INFO: normal accuracy 0.7758504167605317 1.801357626914978 
2022-04-19 05:04:52,328 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 05:04:52,328 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 180.1%
2022-04-19 05:06:05,841 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.135, Acc: 0.896, Base Lr: 3.38e-03
2022-04-19 05:06:42,602 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.724[s] Speed: 22.1[samples/s]
2022-04-19 05:07:43,373 reid_baseline.train INFO: normal accuracy 0.7769767965758053 1.6856104135513306 
2022-04-19 05:07:44,324 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 05:07:44,324 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 168.6%
2022-04-19 05:08:58,308 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.115, Acc: 0.912, Base Lr: 2.77e-03
2022-04-19 05:09:36,026 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.735[s] Speed: 21.8[samples/s]
2022-04-19 05:10:39,631 reid_baseline.train INFO: normal accuracy 0.7753998648344221 1.6748219728469849 
2022-04-19 05:10:40,804 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 05:10:40,805 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 167.5%
2022-04-19 05:11:55,017 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.083, Acc: 0.920, Base Lr: 2.20e-03
2022-04-19 05:12:31,786 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.729[s] Speed: 21.9[samples/s]
2022-04-19 05:13:38,690 reid_baseline.train INFO: normal accuracy 0.7787790042802433 1.6422090530395508 
2022-04-19 05:13:39,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 05:13:39,783 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 164.2%
2022-04-19 05:14:50,710 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.078, Acc: 0.923, Base Lr: 1.66e-03
2022-04-19 05:15:26,360 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.700[s] Speed: 22.9[samples/s]
2022-04-19 05:16:29,868 reid_baseline.train INFO: normal accuracy 0.7803559360216265 1.6817598342895508 
2022-04-19 05:16:29,872 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 05:16:29,873 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 168.2%
2022-04-19 05:17:47,181 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.051, Acc: 0.931, Base Lr: 1.19e-03
2022-04-19 05:18:18,821 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.717[s] Speed: 22.3[samples/s]
2022-04-19 05:19:24,214 reid_baseline.train INFO: normal accuracy 0.780806487947736 1.7236578464508057 
2022-04-19 05:19:24,219 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 05:19:24,219 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.4%
2022-04-19 05:20:32,356 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.048, Acc: 0.933, Base Lr: 7.78e-04
2022-04-19 05:21:06,604 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.673[s] Speed: 23.8[samples/s]
2022-04-19 05:22:12,948 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.6910412311553955 
2022-04-19 05:22:12,953 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 05:22:12,953 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 169.1%
2022-04-19 05:23:28,485 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.051, Acc: 0.926, Base Lr: 4.51e-04
2022-04-19 05:24:03,485 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.727[s] Speed: 22.0[samples/s]
2022-04-19 05:25:08,327 reid_baseline.train INFO: normal accuracy 0.7801306600585718 1.7239882946014404 
2022-04-19 05:25:08,331 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 05:25:08,332 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 172.4%
2022-04-19 05:26:22,615 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.049, Acc: 0.928, Base Lr: 2.11e-04
2022-04-19 05:26:58,220 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.723[s] Speed: 22.1[samples/s]
2022-04-19 05:28:03,204 reid_baseline.train INFO: normal accuracy 0.7805812119846812 1.6973775625228882 
2022-04-19 05:28:03,209 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 05:28:03,209 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 169.7%
2022-04-19 05:29:13,871 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.050, Acc: 0.925, Base Lr: 6.51e-05
2022-04-19 05:29:50,609 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.706[s] Speed: 22.7[samples/s]
2022-04-19 05:30:54,633 reid_baseline.train INFO: normal accuracy 0.7812570398738454 1.6460282802581787 
2022-04-19 05:30:54,638 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 05:30:54,638 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 164.6%
2022-04-19 05:32:08,942 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.041, Acc: 0.936, Base Lr: 1.60e-05
2022-04-19 05:32:44,694 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.724[s] Speed: 22.1[samples/s]
2022-04-19 05:33:50,963 reid_baseline.train INFO: normal accuracy 0.7832845235413382 1.644765019416809 
2022-04-19 05:33:50,968 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 05:33:50,968 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 164.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_1_20_10/transformer_best_model.pth
2022-04-19 05:34:55,085 reid_baseline.train INFO: normal accuracy 0.7787790042802433 1.6422090530395508 
2022-04-19 05:34:55,085 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:34:55,086 reid_baseline.train INFO: Accuracy: 77.9%
2022-04-19 05:35:55,658 reid_baseline.train INFO: normal accuracy 0.7787790042802433 1.6422090530395508 
2022-04-19 05:35:55,659 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:35:55,659 reid_baseline.train INFO: Shuffled Accuracy: 77.9%
2022-04-19 05:36:36,819 reid_baseline.train INFO: normal accuracy 0.9707457766790276 0.888654887676239 
2022-04-19 05:36:36,819 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:36:36,819 reid_baseline.train INFO: Source Clean Accuracy: 97.1%
2022-04-19 05:36:44,898 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_1_20_10
2022-04-19 05:36:44,898 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_1_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-19 05:36:44,898 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 05:36:44,899 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 05:36:44,899 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_1_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 05:37:00,828 reid_baseline.train INFO: start training
2022-04-19 05:38:30,546 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.282, Base Lr: 8.72e-04
2022-04-19 05:39:10,309 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.822[s] Speed: 19.5[samples/s]
2022-04-19 05:41:17,330 reid_baseline.train INFO: normal accuracy 0.5717236630709204 4.171636581420898 
2022-04-19 05:41:18,660 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 05:41:18,660 reid_baseline.train INFO: Accuracy: 57.2% Mean Entropy: 417.2%
2022-04-19 05:42:05,706 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.810, Acc: 0.591, Base Lr: 1.66e-03
2022-04-19 05:42:31,796 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.480[s] Speed: 33.3[samples/s]
2022-04-19 05:44:24,928 reid_baseline.train INFO: normal accuracy 0.6263484048657333 4.141607761383057 
2022-04-19 05:44:25,869 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 05:44:25,869 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 414.2%
2022-04-19 05:45:11,444 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.212, Acc: 0.625, Base Lr: 2.46e-03
2022-04-19 05:45:34,945 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.454[s] Speed: 35.2[samples/s]
2022-04-19 05:47:35,056 reid_baseline.train INFO: normal accuracy 0.6265779205875602 3.8723702430725098 
2022-04-19 05:47:36,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 05:47:36,162 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 387.2%
2022-04-19 05:48:24,774 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.465, Acc: 0.674, Base Lr: 3.25e-03
2022-04-19 05:48:49,184 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.480[s] Speed: 33.3[samples/s]
2022-04-19 05:50:39,378 reid_baseline.train INFO: normal accuracy 0.6782189579986229 3.180769681930542 
2022-04-19 05:50:40,316 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 05:50:40,316 reid_baseline.train INFO: Accuracy: 67.8% Mean Entropy: 318.1%
2022-04-19 05:51:28,440 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.939, Acc: 0.726, Base Lr: 4.04e-03
2022-04-19 05:51:53,208 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.479[s] Speed: 33.4[samples/s]
2022-04-19 05:53:46,972 reid_baseline.train INFO: normal accuracy 0.7374340142299748 2.5690574645996094 
2022-04-19 05:53:48,138 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 05:53:48,138 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 256.9%
2022-04-19 05:54:35,403 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.648, Acc: 0.772, Base Lr: 4.83e-03
2022-04-19 05:55:01,888 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.484[s] Speed: 33.1[samples/s]
2022-04-19 05:56:55,701 reid_baseline.train INFO: normal accuracy 0.7895340830846913 2.129290819168091 
2022-04-19 05:56:56,677 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 05:56:56,677 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 212.9%
2022-04-19 05:57:43,772 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.468, Acc: 0.815, Base Lr: 5.62e-03
2022-04-19 05:58:07,472 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.466[s] Speed: 34.4[samples/s]
2022-04-19 05:59:56,742 reid_baseline.train INFO: normal accuracy 0.8090429194399816 1.9019081592559814 
2022-04-19 05:59:58,124 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 05:59:58,124 reid_baseline.train INFO: Accuracy: 80.9% Mean Entropy: 190.2%
2022-04-19 06:00:47,337 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.336, Acc: 0.846, Base Lr: 6.42e-03
2022-04-19 06:01:11,505 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.483[s] Speed: 33.1[samples/s]
2022-04-19 06:03:06,792 reid_baseline.train INFO: normal accuracy 0.8140922653201744 1.662901759147644 
2022-04-19 06:03:09,269 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 06:03:09,269 reid_baseline.train INFO: Accuracy: 81.4% Mean Entropy: 166.3%
2022-04-19 06:03:55,933 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.243, Acc: 0.874, Base Lr: 7.21e-03
2022-04-19 06:04:17,220 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.447[s] Speed: 35.8[samples/s]
2022-04-19 06:06:13,680 reid_baseline.train INFO: normal accuracy 0.8228138627495983 1.6135262250900269 
2022-04-19 06:06:14,750 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 06:06:14,750 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 161.4%
2022-04-19 06:07:01,163 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.154, Acc: 0.892, Base Lr: 4.01e-03
2022-04-19 06:07:25,646 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.465[s] Speed: 34.4[samples/s]
2022-04-19 06:09:21,929 reid_baseline.train INFO: normal accuracy 0.8296993344044067 1.5641288757324219 
2022-04-19 06:09:22,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 06:09:22,848 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 156.4%
2022-04-19 06:10:10,270 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.135, Acc: 0.892, Base Lr: 3.38e-03
2022-04-19 06:10:33,685 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.466[s] Speed: 34.3[samples/s]
2022-04-19 06:12:25,824 reid_baseline.train INFO: normal accuracy 0.8253385356896947 1.4596197605133057 
2022-04-19 06:12:26,765 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 06:12:26,766 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 146.0%
2022-04-19 06:13:15,304 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.116, Acc: 0.910, Base Lr: 2.77e-03
2022-04-19 06:13:39,983 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.481[s] Speed: 33.2[samples/s]
2022-04-19 06:15:57,791 reid_baseline.train INFO: normal accuracy 0.8246499885242139 1.4588418006896973 
2022-04-19 06:15:58,775 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 06:15:58,775 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 145.9%
2022-04-19 06:16:47,400 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.083, Acc: 0.922, Base Lr: 2.20e-03
2022-04-19 06:17:11,268 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.477[s] Speed: 33.6[samples/s]
2022-04-19 06:19:10,285 reid_baseline.train INFO: normal accuracy 0.828322240073445 1.4244054555892944 
2022-04-19 06:19:11,233 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 06:19:11,234 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 142.4%
2022-04-19 06:19:57,401 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.077, Acc: 0.921, Base Lr: 1.66e-03
2022-04-19 06:20:22,424 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.468[s] Speed: 34.2[samples/s]
2022-04-19 06:22:16,930 reid_baseline.train INFO: normal accuracy 0.828322240073445 1.4768661260604858 
2022-04-19 06:22:16,932 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 06:22:16,932 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 147.7%
2022-04-19 06:23:07,360 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.051, Acc: 0.931, Base Lr: 1.19e-03
2022-04-19 06:23:31,183 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.488[s] Speed: 32.8[samples/s]
2022-04-19 06:25:41,159 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.5123196840286255 
2022-04-19 06:25:41,160 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 06:25:41,160 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 151.2%
2022-04-19 06:26:28,402 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.047, Acc: 0.934, Base Lr: 7.78e-04
2022-04-19 06:26:52,642 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.470[s] Speed: 34.1[samples/s]
2022-04-19 06:28:37,060 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4743177890777588 
2022-04-19 06:28:37,063 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 06:28:37,063 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 147.4%
2022-04-19 06:29:25,812 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.050, Acc: 0.926, Base Lr: 4.51e-04
2022-04-19 06:29:48,362 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.469[s] Speed: 34.1[samples/s]
2022-04-19 06:31:48,573 reid_baseline.train INFO: normal accuracy 0.8322240073445031 1.509873867034912 
2022-04-19 06:31:48,573 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 06:31:48,573 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 151.0%
2022-04-19 06:32:38,579 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.049, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 06:33:03,942 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.496[s] Speed: 32.3[samples/s]
2022-04-19 06:35:13,972 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.485521674156189 
2022-04-19 06:35:13,975 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 06:35:13,975 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 148.6%
2022-04-19 06:36:02,767 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.050, Acc: 0.927, Base Lr: 6.51e-05
2022-04-19 06:36:25,117 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.468[s] Speed: 34.2[samples/s]
2022-04-19 06:38:17,316 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.438664436340332 
2022-04-19 06:38:17,316 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 06:38:17,316 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 143.9%
2022-04-19 06:39:03,001 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.041, Acc: 0.937, Base Lr: 1.60e-05
2022-04-19 06:39:25,273 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.447[s] Speed: 35.8[samples/s]
2022-04-19 06:41:23,011 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.4339123964309692 
2022-04-19 06:41:23,014 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 06:41:23,014 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 143.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_1_20_10/transformer_best_model.pth
2022-04-19 06:43:39,147 reid_baseline.train INFO: normal accuracy 0.828322240073445 1.4244054555892944 
2022-04-19 06:43:39,148 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:43:39,148 reid_baseline.train INFO: Accuracy: 82.8%
2022-04-19 06:45:53,039 reid_baseline.train INFO: normal accuracy 0.828322240073445 1.4244054555892944 
2022-04-19 06:45:53,040 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:45:53,040 reid_baseline.train INFO: Shuffled Accuracy: 82.8%
2022-04-19 06:46:36,265 reid_baseline.train INFO: normal accuracy 0.9707457766790276 0.8858669400215149 
2022-04-19 06:46:36,265 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:46:36,265 reid_baseline.train INFO: Source Clean Accuracy: 97.1%
2022-04-19 06:46:43,698 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_2_20_10
2022-04-19 06:46:43,698 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_2_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-19 06:46:43,699 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 06:46:43,699 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 06:46:43,699 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_2_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 06:46:57,510 reid_baseline.train INFO: start training
2022-04-19 06:47:54,270 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.119, Acc: 0.289, Base Lr: 8.72e-04
2022-04-19 06:48:18,834 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.527[s] Speed: 30.4[samples/s]
2022-04-19 06:49:07,823 reid_baseline.train INFO: normal accuracy 0.38854524627720505 4.171764850616455 
2022-04-19 06:49:09,125 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 06:49:09,125 reid_baseline.train INFO: Accuracy: 38.9% Mean Entropy: 417.2%
2022-04-19 06:49:53,646 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.804, Acc: 0.577, Base Lr: 1.66e-03
2022-04-19 06:50:14,022 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.427[s] Speed: 37.5[samples/s]
2022-04-19 06:51:00,823 reid_baseline.train INFO: normal accuracy 0.41603665521191296 4.152195453643799 
2022-04-19 06:51:01,817 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 06:51:01,817 reid_baseline.train INFO: Accuracy: 41.6% Mean Entropy: 415.2%
2022-04-19 06:51:45,285 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.215, Acc: 0.622, Base Lr: 2.46e-03
2022-04-19 06:52:08,145 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.436[s] Speed: 36.7[samples/s]
2022-04-19 06:52:55,321 reid_baseline.train INFO: normal accuracy 0.43711340206185567 3.9871819019317627 
2022-04-19 06:52:56,435 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 06:52:56,435 reid_baseline.train INFO: Accuracy: 43.7% Mean Entropy: 398.7%
2022-04-19 06:53:41,981 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.479, Acc: 0.644, Base Lr: 3.25e-03
2022-04-19 06:54:04,429 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.446[s] Speed: 35.8[samples/s]
2022-04-19 06:54:48,819 reid_baseline.train INFO: normal accuracy 0.47949599083619704 3.5055429935455322 
2022-04-19 06:54:50,170 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 06:54:50,171 reid_baseline.train INFO: Accuracy: 47.9% Mean Entropy: 350.6%
2022-04-19 06:55:38,139 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.976, Acc: 0.718, Base Lr: 4.04e-03
2022-04-19 06:55:59,799 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.458[s] Speed: 34.9[samples/s]
2022-04-19 06:56:48,714 reid_baseline.train INFO: normal accuracy 0.5427262313860252 3.0491511821746826 
2022-04-19 06:56:49,884 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 06:56:49,884 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 304.9%
2022-04-19 06:57:33,709 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.694, Acc: 0.757, Base Lr: 4.83e-03
2022-04-19 06:57:55,248 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.430[s] Speed: 37.2[samples/s]
2022-04-19 06:58:42,532 reid_baseline.train INFO: normal accuracy 0.581901489117984 2.6678247451782227 
2022-04-19 06:58:43,527 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 06:58:43,527 reid_baseline.train INFO: Accuracy: 58.2% Mean Entropy: 266.8%
2022-04-19 06:59:30,262 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.471, Acc: 0.818, Base Lr: 5.62e-03
2022-04-19 06:59:51,671 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.448[s] Speed: 35.7[samples/s]
2022-04-19 07:00:35,971 reid_baseline.train INFO: normal accuracy 0.604352806414662 2.366239070892334 
2022-04-19 07:00:36,945 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 07:00:36,946 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 236.6%
2022-04-19 07:01:17,702 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.319, Acc: 0.853, Base Lr: 6.42e-03
2022-04-19 07:01:40,112 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.416[s] Speed: 38.5[samples/s]
2022-04-19 07:02:27,384 reid_baseline.train INFO: normal accuracy 0.6116838487972509 2.1593239307403564 
2022-04-19 07:02:28,559 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 07:02:28,559 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 215.9%
2022-04-19 07:03:15,180 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.284, Acc: 0.854, Base Lr: 7.21e-03
2022-04-19 07:03:39,199 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.464[s] Speed: 34.5[samples/s]
2022-04-19 07:04:29,996 reid_baseline.train INFO: normal accuracy 0.6208476517754868 2.062779188156128 
2022-04-19 07:04:31,260 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 07:04:31,261 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 206.3%
2022-04-19 07:05:20,738 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.177, Acc: 0.883, Base Lr: 4.01e-03
2022-04-19 07:05:42,560 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.469[s] Speed: 34.1[samples/s]
2022-04-19 07:06:26,450 reid_baseline.train INFO: normal accuracy 0.6190148911798397 1.967160701751709 
2022-04-19 07:06:27,438 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 07:06:27,438 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 196.7%
2022-04-19 07:07:14,464 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.119, Acc: 0.905, Base Lr: 3.38e-03
2022-04-19 07:07:36,834 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.455[s] Speed: 35.1[samples/s]
2022-04-19 07:08:26,078 reid_baseline.train INFO: normal accuracy 0.620389461626575 1.9789832830429077 
2022-04-19 07:08:26,081 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 07:08:26,081 reid_baseline.train INFO: Accuracy: 62.0% Mean Entropy: 197.9%
2022-04-19 07:09:08,475 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.119, Acc: 0.910, Base Lr: 2.77e-03
2022-04-19 07:09:30,469 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.422[s] Speed: 37.9[samples/s]
2022-04-19 07:10:14,942 reid_baseline.train INFO: normal accuracy 0.618327605956472 1.9502276182174683 
2022-04-19 07:10:15,913 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 07:10:15,914 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 195.0%
2022-04-19 07:11:02,004 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.108, Acc: 0.906, Base Lr: 2.20e-03
2022-04-19 07:11:25,905 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.460[s] Speed: 34.8[samples/s]
2022-04-19 07:12:10,548 reid_baseline.train INFO: normal accuracy 0.622680412371134 1.9473059177398682 
2022-04-19 07:12:11,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 07:12:11,899 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 194.7%
2022-04-19 07:13:01,125 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.076, Acc: 0.917, Base Lr: 1.66e-03
2022-04-19 07:13:23,508 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.471[s] Speed: 34.0[samples/s]
2022-04-19 07:14:13,013 reid_baseline.train INFO: normal accuracy 0.6247422680412371 1.9363276958465576 
2022-04-19 07:14:14,214 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 07:14:14,215 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 193.6%
2022-04-19 07:14:58,312 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.054, Acc: 0.930, Base Lr: 1.19e-03
2022-04-19 07:15:18,252 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.421[s] Speed: 38.0[samples/s]
2022-04-19 07:16:01,573 reid_baseline.train INFO: normal accuracy 0.6263459335624284 1.9197531938552856 
2022-04-19 07:16:03,995 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 07:16:03,995 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 192.0%
2022-04-19 07:16:50,359 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.052, Acc: 0.931, Base Lr: 7.78e-04
2022-04-19 07:17:15,422 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.469[s] Speed: 34.1[samples/s]
2022-04-19 07:18:07,411 reid_baseline.train INFO: normal accuracy 0.6254295532646048 1.8970309495925903 
2022-04-19 07:18:08,772 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 07:18:08,773 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 189.7%
2022-04-19 07:18:55,397 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.059, Acc: 0.926, Base Lr: 4.51e-04
2022-04-19 07:19:17,749 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.454[s] Speed: 35.3[samples/s]
2022-04-19 07:20:00,323 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.851712942123413 
2022-04-19 07:20:01,342 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 07:20:01,343 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 185.2%
2022-04-19 07:20:47,279 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.040, Acc: 0.931, Base Lr: 2.11e-04
2022-04-19 07:21:07,672 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.435[s] Speed: 36.8[samples/s]
2022-04-19 07:21:54,824 reid_baseline.train INFO: normal accuracy 0.6270332187857961 1.8695306777954102 
2022-04-19 07:21:54,827 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 07:21:54,827 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 187.0%
2022-04-19 07:22:38,894 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.031, Acc: 0.939, Base Lr: 6.51e-05
2022-04-19 07:22:59,661 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.426[s] Speed: 37.5[samples/s]
2022-04-19 07:23:49,567 reid_baseline.train INFO: normal accuracy 0.6265750286368843 1.8766158819198608 
2022-04-19 07:23:49,569 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 07:23:49,570 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 187.7%
2022-04-19 07:24:32,634 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.041, Acc: 0.938, Base Lr: 1.60e-05
2022-04-19 07:24:54,819 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.429[s] Speed: 37.3[samples/s]
2022-04-19 07:25:41,908 reid_baseline.train INFO: normal accuracy 0.627262313860252 1.9077883958816528 
2022-04-19 07:25:41,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 07:25:41,909 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 190.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_2_20_10/transformer_best_model.pth
2022-04-19 07:26:26,404 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.851712942123413 
2022-04-19 07:26:26,405 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:26:26,405 reid_baseline.train INFO: Accuracy: 62.8%
2022-04-19 07:27:09,664 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.851712942123413 
2022-04-19 07:27:09,664 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:27:09,664 reid_baseline.train INFO: Shuffled Accuracy: 62.8%
2022-04-19 07:27:42,487 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.8559888005256653 
2022-04-19 07:27:42,487 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:27:42,487 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-19 07:27:48,810 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_2_20_10
2022-04-19 07:27:48,810 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_2_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-19 07:27:48,810 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 07:27:48,810 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 07:27:48,810 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_2_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 07:27:59,853 reid_baseline.train INFO: start training
2022-04-19 07:28:54,755 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.119, Acc: 0.288, Base Lr: 8.72e-04
2022-04-19 07:29:14,985 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.482[s] Speed: 33.2[samples/s]
2022-04-19 07:29:59,689 reid_baseline.train INFO: normal accuracy 0.4879477359765713 4.171899795532227 
2022-04-19 07:30:01,000 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 07:30:01,001 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 417.2%
2022-04-19 07:30:48,626 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.804, Acc: 0.577, Base Lr: 1.66e-03
2022-04-19 07:31:12,386 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.470[s] Speed: 34.1[samples/s]
2022-04-19 07:32:06,147 reid_baseline.train INFO: normal accuracy 0.5275963054742059 4.148911952972412 
2022-04-19 07:32:07,436 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 07:32:07,437 reid_baseline.train INFO: Accuracy: 52.8% Mean Entropy: 414.9%
2022-04-19 07:32:55,411 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.215, Acc: 0.622, Base Lr: 2.46e-03
2022-04-19 07:33:19,242 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.472[s] Speed: 33.9[samples/s]
2022-04-19 07:34:02,545 reid_baseline.train INFO: normal accuracy 0.5237666141022753 3.963155746459961 
2022-04-19 07:34:03,835 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 07:34:03,835 reid_baseline.train INFO: Accuracy: 52.4% Mean Entropy: 396.3%
2022-04-19 07:34:48,269 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.479, Acc: 0.644, Base Lr: 3.25e-03
2022-04-19 07:35:11,034 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.442[s] Speed: 36.2[samples/s]
2022-04-19 07:35:56,785 reid_baseline.train INFO: normal accuracy 0.5740031538634828 3.4261977672576904 
2022-04-19 07:35:58,860 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 07:35:58,860 reid_baseline.train INFO: Accuracy: 57.4% Mean Entropy: 342.6%
2022-04-19 07:36:45,708 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.975, Acc: 0.717, Base Lr: 4.04e-03
2022-04-19 07:37:07,562 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.452[s] Speed: 35.4[samples/s]
2022-04-19 07:37:52,180 reid_baseline.train INFO: normal accuracy 0.6530750168956972 2.872711658477783 
2022-04-19 07:37:53,336 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 07:37:53,336 reid_baseline.train INFO: Accuracy: 65.3% Mean Entropy: 287.3%
2022-04-19 07:38:36,837 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.694, Acc: 0.759, Base Lr: 4.83e-03
2022-04-19 07:38:58,580 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.429[s] Speed: 37.3[samples/s]
2022-04-19 07:39:50,316 reid_baseline.train INFO: normal accuracy 0.7148006307726965 2.478320837020874 
2022-04-19 07:39:51,644 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 07:39:51,645 reid_baseline.train INFO: Accuracy: 71.5% Mean Entropy: 247.8%
2022-04-19 07:40:36,674 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.472, Acc: 0.818, Base Lr: 5.62e-03
2022-04-19 07:40:58,743 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.441[s] Speed: 36.3[samples/s]
2022-04-19 07:41:44,036 reid_baseline.train INFO: normal accuracy 0.7499436810092364 2.159696340560913 
2022-04-19 07:41:45,216 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 07:41:45,217 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 216.0%
2022-04-19 07:42:28,292 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.318, Acc: 0.853, Base Lr: 6.42e-03
2022-04-19 07:42:48,858 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.418[s] Speed: 38.2[samples/s]
2022-04-19 07:43:37,935 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.9343726634979248 
2022-04-19 07:43:38,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 07:43:38,899 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 193.4%
2022-04-19 07:44:20,884 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.285, Acc: 0.853, Base Lr: 7.21e-03
2022-04-19 07:44:43,091 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.422[s] Speed: 37.9[samples/s]
2022-04-19 07:45:27,963 reid_baseline.train INFO: normal accuracy 0.7697679657580536 1.8538689613342285 
2022-04-19 07:45:29,076 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 07:45:29,076 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 185.4%
2022-04-19 07:46:16,000 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.179, Acc: 0.883, Base Lr: 4.01e-03
2022-04-19 07:46:36,782 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.445[s] Speed: 35.9[samples/s]
2022-04-19 07:47:23,003 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7487374544143677 
2022-04-19 07:47:25,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 07:47:25,335 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 174.9%
2022-04-19 07:48:10,546 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.119, Acc: 0.902, Base Lr: 3.38e-03
2022-04-19 07:48:31,825 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.437[s] Speed: 36.6[samples/s]
2022-04-19 07:49:17,334 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.78367280960083 
2022-04-19 07:49:17,337 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 07:49:17,337 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 178.4%
2022-04-19 07:49:59,696 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.120, Acc: 0.909, Base Lr: 2.77e-03
2022-04-19 07:50:21,182 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.420[s] Speed: 38.1[samples/s]
2022-04-19 07:51:04,239 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.7442960739135742 
2022-04-19 07:51:06,333 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 07:51:06,333 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 174.4%
2022-04-19 07:51:51,227 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.109, Acc: 0.906, Base Lr: 2.20e-03
2022-04-19 07:52:15,456 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.455[s] Speed: 35.2[samples/s]
2022-04-19 07:53:00,186 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.7457231283187866 
2022-04-19 07:53:00,188 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 07:53:00,189 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 174.6%
2022-04-19 07:53:45,237 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.076, Acc: 0.917, Base Lr: 1.66e-03
2022-04-19 07:54:04,674 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.424[s] Speed: 37.7[samples/s]
2022-04-19 07:54:51,678 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.7547460794448853 
2022-04-19 07:54:51,680 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 07:54:51,680 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 175.5%
2022-04-19 07:55:35,445 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.055, Acc: 0.928, Base Lr: 1.19e-03
2022-04-19 07:55:57,883 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.436[s] Speed: 36.7[samples/s]
2022-04-19 07:56:41,793 reid_baseline.train INFO: normal accuracy 0.7776526244649696 1.737522840499878 
2022-04-19 07:56:43,214 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 07:56:43,215 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 173.8%
2022-04-19 07:57:25,297 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.052, Acc: 0.932, Base Lr: 7.78e-04
2022-04-19 07:57:45,239 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.407[s] Speed: 39.3[samples/s]
2022-04-19 07:58:30,175 reid_baseline.train INFO: normal accuracy 0.7760756927235863 1.7191460132598877 
2022-04-19 07:58:31,140 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 07:58:31,140 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 171.9%
2022-04-19 07:59:16,786 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.059, Acc: 0.926, Base Lr: 4.51e-04
2022-04-19 07:59:38,335 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.442[s] Speed: 36.2[samples/s]
2022-04-19 08:00:26,931 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6738054752349854 
2022-04-19 08:00:28,802 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 08:00:28,802 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 167.4%
2022-04-19 08:01:12,707 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.040, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 08:01:35,908 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.441[s] Speed: 36.2[samples/s]
2022-04-19 08:02:22,339 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.6928431987762451 
2022-04-19 08:02:22,341 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 08:02:22,341 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 169.3%
2022-04-19 08:03:05,082 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.031, Acc: 0.936, Base Lr: 6.51e-05
2022-04-19 08:03:27,198 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.427[s] Speed: 37.5[samples/s]
2022-04-19 08:04:11,419 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.6997579336166382 
2022-04-19 08:04:11,422 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 08:04:11,422 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 170.0%
2022-04-19 08:04:56,543 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.042, Acc: 0.938, Base Lr: 1.60e-05
2022-04-19 08:05:16,065 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.424[s] Speed: 37.7[samples/s]
2022-04-19 08:06:02,602 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.729973554611206 
2022-04-19 08:06:02,605 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 08:06:02,605 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 173.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_2_20_10/transformer_best_model.pth
2022-04-19 08:06:48,676 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6738054752349854 
2022-04-19 08:06:48,676 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:06:48,676 reid_baseline.train INFO: Accuracy: 77.9%
2022-04-19 08:07:32,831 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6738054752349854 
2022-04-19 08:07:33,249 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:07:33,249 reid_baseline.train INFO: Shuffled Accuracy: 77.9%
2022-04-19 08:08:08,298 reid_baseline.train INFO: normal accuracy 0.9744540585084467 0.8587018251419067 
2022-04-19 08:08:08,299 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:08:08,299 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-19 08:08:14,490 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_2_20_10
2022-04-19 08:08:14,490 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_2_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-19 08:08:14,490 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 08:08:14,491 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 08:08:14,491 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_2_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 08:08:24,500 reid_baseline.train INFO: start training
2022-04-19 08:09:18,475 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.119, Acc: 0.289, Base Lr: 8.72e-04
2022-04-19 08:09:40,780 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.496[s] Speed: 32.3[samples/s]
2022-04-19 08:11:31,489 reid_baseline.train INFO: normal accuracy 0.5717236630709204 4.171640872955322 
2022-04-19 08:11:33,866 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 08:11:33,866 reid_baseline.train INFO: Accuracy: 57.2% Mean Entropy: 417.2%
2022-04-19 08:12:18,477 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.804, Acc: 0.577, Base Lr: 1.66e-03
2022-04-19 08:12:40,023 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.435[s] Speed: 36.8[samples/s]
2022-04-19 08:14:31,147 reid_baseline.train INFO: normal accuracy 0.6123479458342896 4.139636993408203 
2022-04-19 08:14:32,151 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 08:14:32,152 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 414.0%
2022-04-19 08:15:15,853 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.215, Acc: 0.622, Base Lr: 2.46e-03
2022-04-19 08:15:38,215 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.434[s] Speed: 36.9[samples/s]
2022-04-19 08:17:24,911 reid_baseline.train INFO: normal accuracy 0.62359421620381 3.862863779067993 
2022-04-19 08:17:25,824 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 08:17:25,824 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 386.3%
2022-04-19 08:18:10,377 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.479, Acc: 0.644, Base Lr: 3.25e-03
2022-04-19 08:18:32,725 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.440[s] Speed: 36.4[samples/s]
2022-04-19 08:20:26,528 reid_baseline.train INFO: normal accuracy 0.6701859077346798 3.1644303798675537 
2022-04-19 08:20:27,572 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 08:20:27,572 reid_baseline.train INFO: Accuracy: 67.0% Mean Entropy: 316.4%
2022-04-19 08:21:13,248 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.975, Acc: 0.717, Base Lr: 4.04e-03
2022-04-19 08:21:34,343 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.439[s] Speed: 36.4[samples/s]
2022-04-19 08:23:22,251 reid_baseline.train INFO: normal accuracy 0.7312370897406473 2.577993631362915 
2022-04-19 08:23:23,587 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 08:23:23,587 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 257.8%
2022-04-19 08:24:07,802 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.694, Acc: 0.759, Base Lr: 4.83e-03
2022-04-19 08:24:25,440 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.407[s] Speed: 39.3[samples/s]
2022-04-19 08:26:16,872 reid_baseline.train INFO: normal accuracy 0.7787468441588249 2.18386173248291 
2022-04-19 08:26:17,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 08:26:17,853 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 218.4%
2022-04-19 08:27:04,836 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.471, Acc: 0.819, Base Lr: 5.62e-03
2022-04-19 08:27:26,920 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.454[s] Speed: 35.3[samples/s]
2022-04-19 08:29:12,585 reid_baseline.train INFO: normal accuracy 0.8056001836125775 1.8890976905822754 
2022-04-19 08:29:13,601 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 08:29:13,601 reid_baseline.train INFO: Accuracy: 80.6% Mean Entropy: 188.9%
2022-04-19 08:29:56,848 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.319, Acc: 0.851, Base Lr: 6.42e-03
2022-04-19 08:30:19,094 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.431[s] Speed: 37.1[samples/s]
2022-04-19 08:32:09,104 reid_baseline.train INFO: normal accuracy 0.8163874225384439 1.6916310787200928 
2022-04-19 08:32:09,994 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 08:32:09,994 reid_baseline.train INFO: Accuracy: 81.6% Mean Entropy: 169.2%
2022-04-19 08:32:50,321 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.285, Acc: 0.855, Base Lr: 7.21e-03
2022-04-19 08:33:11,935 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.407[s] Speed: 39.4[samples/s]
2022-04-19 08:35:08,335 reid_baseline.train INFO: normal accuracy 0.8161579068166169 1.6029304265975952 
2022-04-19 08:35:09,314 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 08:35:09,315 reid_baseline.train INFO: Accuracy: 81.6% Mean Entropy: 160.3%
2022-04-19 08:35:52,789 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.178, Acc: 0.886, Base Lr: 4.01e-03
2022-04-19 08:36:13,276 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.420[s] Speed: 38.1[samples/s]
2022-04-19 08:38:08,309 reid_baseline.train INFO: normal accuracy 0.82419095708056 1.5117827653884888 
2022-04-19 08:38:09,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 08:38:09,203 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 151.2%
2022-04-19 08:38:56,032 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.120, Acc: 0.902, Base Lr: 3.38e-03
2022-04-19 08:39:17,540 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.448[s] Speed: 35.7[samples/s]
2022-04-19 08:41:13,800 reid_baseline.train INFO: normal accuracy 0.8278632086297911 1.5501658916473389 
2022-04-19 08:41:13,802 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 08:41:13,803 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 155.0%
2022-04-19 08:42:01,746 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.120, Acc: 0.908, Base Lr: 2.77e-03
2022-04-19 08:42:23,928 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.460[s] Speed: 34.8[samples/s]
2022-04-19 08:44:31,934 reid_baseline.train INFO: normal accuracy 0.8292403029607528 1.5172936916351318 
2022-04-19 08:44:31,936 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 08:44:31,937 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 151.7%
2022-04-19 08:45:18,035 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.109, Acc: 0.904, Base Lr: 2.20e-03
2022-04-19 08:45:42,364 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.462[s] Speed: 34.6[samples/s]
2022-04-19 08:47:37,198 reid_baseline.train INFO: normal accuracy 0.828551755795272 1.5234884023666382 
2022-04-19 08:47:37,200 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 08:47:37,200 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 152.3%
2022-04-19 08:48:21,859 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.076, Acc: 0.917, Base Lr: 1.66e-03
2022-04-19 08:48:44,015 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.440[s] Speed: 36.4[samples/s]
2022-04-19 08:50:36,188 reid_baseline.train INFO: normal accuracy 0.8294698186825797 1.5288270711898804 
2022-04-19 08:50:36,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 08:50:36,191 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 152.9%
2022-04-19 08:51:19,037 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.055, Acc: 0.927, Base Lr: 1.19e-03
2022-04-19 08:51:39,122 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.413[s] Speed: 38.7[samples/s]
2022-04-19 08:53:25,390 reid_baseline.train INFO: normal accuracy 0.8292403029607528 1.52109694480896 
2022-04-19 08:53:25,392 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 08:53:25,393 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 152.1%
2022-04-19 08:54:08,804 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.052, Acc: 0.932, Base Lr: 7.78e-04
2022-04-19 08:54:29,985 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.424[s] Speed: 37.8[samples/s]
2022-04-19 08:56:10,508 reid_baseline.train INFO: normal accuracy 0.828551755795272 1.4980705976486206 
2022-04-19 08:56:11,449 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 08:56:11,449 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 149.8%
2022-04-19 08:56:55,601 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.060, Acc: 0.926, Base Lr: 4.51e-04
2022-04-19 08:57:17,511 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.435[s] Speed: 36.8[samples/s]
2022-04-19 08:58:59,322 reid_baseline.train INFO: normal accuracy 0.8310764287353684 1.4501179456710815 
2022-04-19 08:59:00,512 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 08:59:00,512 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 145.0%
2022-04-19 08:59:44,832 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.040, Acc: 0.931, Base Lr: 2.11e-04
2022-04-19 09:00:06,181 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.432[s] Speed: 37.0[samples/s]
2022-04-19 09:01:47,248 reid_baseline.train INFO: normal accuracy 0.8310764287353684 1.468535304069519 
2022-04-19 09:01:47,250 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 09:01:47,250 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 146.9%
2022-04-19 09:02:29,859 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.031, Acc: 0.937, Base Lr: 6.51e-05
2022-04-19 09:02:50,832 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.418[s] Speed: 38.3[samples/s]
2022-04-19 09:04:41,827 reid_baseline.train INFO: normal accuracy 0.8306173972917145 1.4776947498321533 
2022-04-19 09:04:41,827 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 09:04:41,828 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 147.8%
2022-04-19 09:05:25,280 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.042, Acc: 0.939, Base Lr: 1.60e-05
2022-04-19 09:05:46,010 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.422[s] Speed: 37.9[samples/s]
2022-04-19 09:07:56,711 reid_baseline.train INFO: normal accuracy 0.8280927243516181 1.516748309135437 
2022-04-19 09:07:56,713 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 09:07:56,714 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 151.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_2_20_10/transformer_best_model.pth
2022-04-19 09:10:03,293 reid_baseline.train INFO: normal accuracy 0.8310764287353684 1.4501179456710815 
2022-04-19 09:10:03,293 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:10:03,293 reid_baseline.train INFO: Accuracy: 83.1%
2022-04-19 09:11:44,101 reid_baseline.train INFO: normal accuracy 0.8310764287353684 1.4501179456710815 
2022-04-19 09:11:44,102 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:11:44,102 reid_baseline.train INFO: Shuffled Accuracy: 83.1%
2022-04-19 09:12:17,899 reid_baseline.train INFO: normal accuracy 0.9744540585084467 0.8578803539276123 
2022-04-19 09:12:17,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:12:17,899 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-19 09:12:23,775 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_3_20_10
2022-04-19 09:12:23,776 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_3_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-19 09:12:23,776 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 09:12:23,776 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 09:12:23,776 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_3_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 09:12:34,266 reid_baseline.train INFO: start training
2022-04-19 09:13:30,457 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.120, Acc: 0.273, Base Lr: 8.72e-04
2022-04-19 09:13:52,648 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.508[s] Speed: 31.5[samples/s]
2022-04-19 09:14:35,326 reid_baseline.train INFO: normal accuracy 0.384192439862543 4.171777725219727 
2022-04-19 09:14:36,475 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 09:14:36,476 reid_baseline.train INFO: Accuracy: 38.4% Mean Entropy: 417.2%
2022-04-19 09:15:21,653 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.804, Acc: 0.593, Base Lr: 1.66e-03
2022-04-19 09:15:44,317 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.446[s] Speed: 35.8[samples/s]
2022-04-19 09:16:28,297 reid_baseline.train INFO: normal accuracy 0.41237113402061853 4.153308391571045 
2022-04-19 09:16:29,432 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 09:16:29,432 reid_baseline.train INFO: Accuracy: 41.2% Mean Entropy: 415.3%
2022-04-19 09:17:13,299 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.209, Acc: 0.637, Base Lr: 2.46e-03
2022-04-19 09:17:35,527 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.435[s] Speed: 36.8[samples/s]
2022-04-19 09:18:17,160 reid_baseline.train INFO: normal accuracy 0.4339060710194731 3.9947524070739746 
2022-04-19 09:18:18,119 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 09:18:18,119 reid_baseline.train INFO: Accuracy: 43.4% Mean Entropy: 399.5%
2022-04-19 09:19:00,305 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.501, Acc: 0.646, Base Lr: 3.25e-03
2022-04-19 09:19:21,568 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.417[s] Speed: 38.3[samples/s]
2022-04-19 09:20:06,698 reid_baseline.train INFO: normal accuracy 0.4849942726231386 3.538844585418701 
2022-04-19 09:20:07,604 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 09:20:07,605 reid_baseline.train INFO: Accuracy: 48.5% Mean Entropy: 353.9%
2022-04-19 09:20:51,575 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.981, Acc: 0.707, Base Lr: 4.04e-03
2022-04-19 09:21:12,774 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.429[s] Speed: 37.3[samples/s]
2022-04-19 09:21:57,072 reid_baseline.train INFO: normal accuracy 0.5413516609392898 3.08790922164917 
2022-04-19 09:21:58,037 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 09:21:58,038 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 308.8%
2022-04-19 09:22:43,138 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.647, Acc: 0.768, Base Lr: 4.83e-03
2022-04-19 09:23:05,703 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.445[s] Speed: 35.9[samples/s]
2022-04-19 09:23:50,557 reid_baseline.train INFO: normal accuracy 0.5855670103092784 2.6556878089904785 
2022-04-19 09:23:51,575 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 09:23:51,576 reid_baseline.train INFO: Accuracy: 58.6% Mean Entropy: 265.6%
2022-04-19 09:24:35,453 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.507, Acc: 0.807, Base Lr: 5.62e-03
2022-04-19 09:24:56,374 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.426[s] Speed: 37.5[samples/s]
2022-04-19 09:25:40,546 reid_baseline.train INFO: normal accuracy 0.6006872852233677 2.3833982944488525 
2022-04-19 09:25:41,510 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 09:25:41,510 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 238.3%
2022-04-19 09:26:26,103 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.349, Acc: 0.836, Base Lr: 6.42e-03
2022-04-19 09:26:47,253 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.432[s] Speed: 37.0[samples/s]
2022-04-19 09:27:30,668 reid_baseline.train INFO: normal accuracy 0.6050400916380297 2.1845943927764893 
2022-04-19 09:27:31,665 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 09:27:31,665 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 218.5%
2022-04-19 09:28:14,865 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.236, Acc: 0.873, Base Lr: 7.21e-03
2022-04-19 09:28:37,497 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.433[s] Speed: 36.9[samples/s]
2022-04-19 09:29:22,472 reid_baseline.train INFO: normal accuracy 0.6132875143184422 2.07099986076355 
2022-04-19 09:29:23,468 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 09:29:23,468 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 207.1%
2022-04-19 09:30:07,306 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.186, Acc: 0.887, Base Lr: 4.01e-03
2022-04-19 09:30:26,851 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.417[s] Speed: 38.4[samples/s]
2022-04-19 09:31:10,490 reid_baseline.train INFO: normal accuracy 0.6158075601374571 1.903983235359192 
2022-04-19 09:31:11,847 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 09:31:11,847 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 190.4%
2022-04-19 09:31:56,872 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.136, Acc: 0.902, Base Lr: 3.38e-03
2022-04-19 09:32:19,001 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.441[s] Speed: 36.3[samples/s]
2022-04-19 09:33:02,635 reid_baseline.train INFO: normal accuracy 0.6238258877434135 1.8582825660705566 
2022-04-19 09:33:03,671 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 09:33:03,672 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 185.8%
2022-04-19 09:33:46,459 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.110, Acc: 0.913, Base Lr: 2.77e-03
2022-04-19 09:34:07,583 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.420[s] Speed: 38.1[samples/s]
2022-04-19 09:34:49,059 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.8175008296966553 
2022-04-19 09:34:50,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 09:34:50,001 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 181.8%
2022-04-19 09:35:34,018 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.101, Acc: 0.910, Base Lr: 2.20e-03
2022-04-19 09:35:57,104 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.441[s] Speed: 36.3[samples/s]
2022-04-19 09:36:40,440 reid_baseline.train INFO: normal accuracy 0.6345933562428407 1.8979666233062744 
2022-04-19 09:36:40,442 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 09:36:40,443 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 189.8%
2022-04-19 09:37:24,111 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.062, Acc: 0.927, Base Lr: 1.66e-03
2022-04-19 09:37:46,781 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.436[s] Speed: 36.7[samples/s]
2022-04-19 09:38:31,551 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.8744547367095947 
2022-04-19 09:38:31,553 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 09:38:31,553 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.4%
2022-04-19 09:39:14,745 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.062, Acc: 0.923, Base Lr: 1.19e-03
2022-04-19 09:39:36,438 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.426[s] Speed: 37.6[samples/s]
2022-04-19 09:40:20,552 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.8568071126937866 
2022-04-19 09:40:20,555 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 09:40:20,555 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 185.7%
2022-04-19 09:41:04,300 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.036, Acc: 0.930, Base Lr: 7.78e-04
2022-04-19 09:41:24,838 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.423[s] Speed: 37.8[samples/s]
2022-04-19 09:42:09,363 reid_baseline.train INFO: normal accuracy 0.6320733104238259 1.8175063133239746 
2022-04-19 09:42:09,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 09:42:09,365 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 181.8%
2022-04-19 09:42:52,481 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.044, Acc: 0.933, Base Lr: 4.51e-04
2022-04-19 09:43:13,366 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.420[s] Speed: 38.1[samples/s]
2022-04-19 09:43:57,362 reid_baseline.train INFO: normal accuracy 0.6313860252004582 1.8483288288116455 
2022-04-19 09:43:57,364 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 09:43:57,365 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 184.8%
2022-04-19 09:44:38,288 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.048, Acc: 0.931, Base Lr: 2.11e-04
2022-04-19 09:44:59,940 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.411[s] Speed: 39.0[samples/s]
2022-04-19 09:45:43,228 reid_baseline.train INFO: normal accuracy 0.6332187857961054 1.8680177927017212 
2022-04-19 09:45:43,228 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 09:45:43,229 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 186.8%
2022-04-19 09:46:27,327 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.053, Acc: 0.926, Base Lr: 6.51e-05
2022-04-19 09:46:49,902 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.438[s] Speed: 36.5[samples/s]
2022-04-19 09:47:32,429 reid_baseline.train INFO: normal accuracy 0.6270332187857961 1.8320348262786865 
2022-04-19 09:47:32,431 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 09:47:32,431 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 183.2%
2022-04-19 09:48:14,462 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.027, Acc: 0.934, Base Lr: 1.60e-05
2022-04-19 09:48:34,752 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.410[s] Speed: 39.0[samples/s]
2022-04-19 09:49:21,669 reid_baseline.train INFO: normal accuracy 0.6290950744558992 1.846799373626709 
2022-04-19 09:49:21,671 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 09:49:21,671 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 184.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_aug_key_3_20_10/transformer_best_model.pth
2022-04-19 09:50:04,822 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.8175008296966553 
2022-04-19 09:50:04,823 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:50:04,823 reid_baseline.train INFO: Accuracy: 63.0%
2022-04-19 09:50:48,623 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.8175008296966553 
2022-04-19 09:50:48,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:50:48,624 reid_baseline.train INFO: Shuffled Accuracy: 63.0%
2022-04-19 09:51:27,122 reid_baseline.train INFO: normal accuracy 0.9612690564482901 0.8908321857452393 
2022-04-19 09:51:27,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:51:27,122 reid_baseline.train INFO: Source Clean Accuracy: 96.1%
2022-04-19 09:51:32,620 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_3_20_10
2022-04-19 09:51:32,620 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_3_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-19 09:51:32,620 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 09:51:32,620 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 09:51:32,621 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_3_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 09:51:43,561 reid_baseline.train INFO: start training
2022-04-19 09:52:39,247 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.120, Acc: 0.273, Base Lr: 8.72e-04
2022-04-19 09:53:01,996 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.506[s] Speed: 31.6[samples/s]
2022-04-19 09:53:52,439 reid_baseline.train INFO: normal accuracy 0.4906510475332282 4.171938896179199 
2022-04-19 09:53:54,642 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 09:53:54,642 reid_baseline.train INFO: Accuracy: 49.1% Mean Entropy: 417.2%
2022-04-19 09:54:37,199 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.804, Acc: 0.593, Base Lr: 1.66e-03
2022-04-19 09:54:59,518 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.427[s] Speed: 37.5[samples/s]
2022-04-19 09:55:47,823 reid_baseline.train INFO: normal accuracy 0.5341293084027934 4.151447772979736 
2022-04-19 09:55:50,460 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 09:55:50,460 reid_baseline.train INFO: Accuracy: 53.4% Mean Entropy: 415.1%
2022-04-19 09:56:32,858 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.209, Acc: 0.637, Base Lr: 2.46e-03
2022-04-19 09:56:54,486 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.421[s] Speed: 38.0[samples/s]
2022-04-19 09:57:39,477 reid_baseline.train INFO: normal accuracy 0.5440414507772021 3.973551034927368 
2022-04-19 09:57:40,550 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 09:57:40,551 reid_baseline.train INFO: Accuracy: 54.4% Mean Entropy: 397.4%
2022-04-19 09:58:24,366 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.501, Acc: 0.646, Base Lr: 3.25e-03
2022-04-19 09:58:45,826 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.429[s] Speed: 37.3[samples/s]
2022-04-19 09:59:30,461 reid_baseline.train INFO: normal accuracy 0.6028384771344898 3.46610951423645 
2022-04-19 09:59:31,404 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 09:59:31,405 reid_baseline.train INFO: Accuracy: 60.3% Mean Entropy: 346.6%
2022-04-19 10:00:16,363 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.981, Acc: 0.707, Base Lr: 4.04e-03
2022-04-19 10:00:36,389 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.428[s] Speed: 37.4[samples/s]
2022-04-19 10:01:21,012 reid_baseline.train INFO: normal accuracy 0.6650146429375986 2.9092745780944824 
2022-04-19 10:01:22,025 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 10:01:22,025 reid_baseline.train INFO: Accuracy: 66.5% Mean Entropy: 290.9%
2022-04-19 10:02:05,738 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.647, Acc: 0.769, Base Lr: 4.83e-03
2022-04-19 10:02:29,750 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.445[s] Speed: 35.9[samples/s]
2022-04-19 10:03:13,893 reid_baseline.train INFO: normal accuracy 0.7208830817751746 2.4252378940582275 
2022-04-19 10:03:14,823 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 10:03:14,824 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 242.5%
2022-04-19 10:03:58,934 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.507, Acc: 0.807, Base Lr: 5.62e-03
2022-04-19 10:04:20,267 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.430[s] Speed: 37.2[samples/s]
2022-04-19 10:05:06,729 reid_baseline.train INFO: normal accuracy 0.7463392656003605 2.1709630489349365 
2022-04-19 10:05:07,644 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 10:05:07,644 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 217.1%
2022-04-19 10:05:49,466 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.350, Acc: 0.835, Base Lr: 6.42e-03
2022-04-19 10:06:11,265 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.418[s] Speed: 38.2[samples/s]
2022-04-19 10:06:56,296 reid_baseline.train INFO: normal accuracy 0.7582788916422618 1.9838694334030151 
2022-04-19 10:06:57,233 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 10:06:57,233 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 198.4%
2022-04-19 10:07:41,222 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.237, Acc: 0.871, Base Lr: 7.21e-03
2022-04-19 10:08:02,685 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.431[s] Speed: 37.2[samples/s]
2022-04-19 10:08:47,267 reid_baseline.train INFO: normal accuracy 0.7684163099797252 1.8878875970840454 
2022-04-19 10:08:48,648 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 10:08:48,649 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 188.8%
2022-04-19 10:09:33,575 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.186, Acc: 0.888, Base Lr: 4.01e-03
2022-04-19 10:09:54,068 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.430[s] Speed: 37.2[samples/s]
2022-04-19 10:10:35,993 reid_baseline.train INFO: normal accuracy 0.7722460013516558 1.7166740894317627 
2022-04-19 10:10:36,886 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 10:10:36,886 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 171.7%
2022-04-19 10:11:20,661 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.137, Acc: 0.899, Base Lr: 3.38e-03
2022-04-19 10:11:42,462 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.431[s] Speed: 37.1[samples/s]
2022-04-19 10:12:27,205 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.6764878034591675 
2022-04-19 10:12:28,166 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 10:12:28,167 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 167.6%
2022-04-19 10:13:12,740 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.112, Acc: 0.910, Base Lr: 2.77e-03
2022-04-19 10:13:34,519 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.436[s] Speed: 36.7[samples/s]
2022-04-19 10:14:17,098 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.6399791240692139 
2022-04-19 10:14:18,074 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 10:14:18,074 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 164.0%
2022-04-19 10:15:01,306 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.100, Acc: 0.911, Base Lr: 2.20e-03
2022-04-19 10:15:23,701 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.431[s] Speed: 37.1[samples/s]
2022-04-19 10:16:10,571 reid_baseline.train INFO: normal accuracy 0.7823834196891192 1.72337007522583 
2022-04-19 10:16:10,573 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 10:16:10,574 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 172.3%
2022-04-19 10:16:53,851 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.063, Acc: 0.927, Base Lr: 1.66e-03
2022-04-19 10:17:15,233 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.424[s] Speed: 37.7[samples/s]
2022-04-19 10:17:59,179 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.7088439464569092 
2022-04-19 10:17:59,181 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 10:17:59,181 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 170.9%
2022-04-19 10:18:44,966 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.063, Acc: 0.923, Base Lr: 1.19e-03
2022-04-19 10:19:05,948 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.439[s] Speed: 36.4[samples/s]
2022-04-19 10:19:51,019 reid_baseline.train INFO: normal accuracy 0.7803559360216265 1.701269507408142 
2022-04-19 10:19:51,020 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 10:19:51,020 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 170.1%
2022-04-19 10:20:32,850 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.036, Acc: 0.931, Base Lr: 7.78e-04
2022-04-19 10:20:54,180 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.415[s] Speed: 38.6[samples/s]
2022-04-19 10:21:41,596 reid_baseline.train INFO: normal accuracy 0.780806487947736 1.6600761413574219 
2022-04-19 10:21:41,599 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 10:21:41,599 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 166.0%
2022-04-19 10:22:23,532 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.044, Acc: 0.933, Base Lr: 4.51e-04
2022-04-19 10:22:43,897 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.409[s] Speed: 39.1[samples/s]
2022-04-19 10:23:24,952 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6877856254577637 
2022-04-19 10:23:24,952 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 10:23:24,952 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 168.8%
2022-04-19 10:23:51,903 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.049, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 10:24:04,126 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.258[s] Speed: 62.1[samples/s]
2022-04-19 10:24:39,821 reid_baseline.train INFO: normal accuracy 0.782608695652174 1.7080297470092773 
2022-04-19 10:24:39,822 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 10:24:39,822 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 170.8%
2022-04-19 10:25:06,163 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.053, Acc: 0.927, Base Lr: 6.51e-05
2022-04-19 10:25:18,288 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.252[s] Speed: 63.4[samples/s]
2022-04-19 10:25:53,260 reid_baseline.train INFO: normal accuracy 0.7832845235413382 1.6774340867996216 
2022-04-19 10:25:53,261 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 10:25:53,261 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 167.7%
2022-04-19 10:26:18,557 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.027, Acc: 0.934, Base Lr: 1.60e-05
2022-04-19 10:26:30,505 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.244[s] Speed: 65.6[samples/s]
2022-04-19 10:27:06,194 reid_baseline.train INFO: normal accuracy 0.7812570398738454 1.6878130435943604 
2022-04-19 10:27:06,195 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 10:27:06,195 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 168.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_aug_key_3_20_10/transformer_best_model.pth
2022-04-19 10:27:43,111 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.6399791240692139 
2022-04-19 10:27:43,112 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:27:43,112 reid_baseline.train INFO: Accuracy: 77.5%
2022-04-19 10:28:12,369 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.6399791240692139 
2022-04-19 10:28:12,370 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:28:12,370 reid_baseline.train INFO: Shuffled Accuracy: 77.5%
2022-04-19 10:28:40,672 reid_baseline.train INFO: normal accuracy 0.9629171817058096 0.8934935331344604 
2022-04-19 10:28:40,672 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:28:40,672 reid_baseline.train INFO: Source Clean Accuracy: 96.3%
2022-04-19 10:28:45,906 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_3_20_10
2022-04-19 10:28:45,906 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_3_20_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-19 10:28:45,907 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 10:28:45,907 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 10:28:45,907 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_3_20_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 10:28:54,464 reid_baseline.train INFO: start training
2022-04-19 10:29:26,770 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.120, Acc: 0.273, Base Lr: 8.72e-04
2022-04-19 10:29:39,425 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-19 10:31:11,214 reid_baseline.train INFO: normal accuracy 0.5776910718384209 4.17169189453125 
2022-04-19 10:31:12,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 10:31:12,009 reid_baseline.train INFO: Accuracy: 57.8% Mean Entropy: 417.2%
2022-04-19 10:31:36,686 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.804, Acc: 0.593, Base Lr: 1.66e-03
2022-04-19 10:31:48,956 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.243[s] Speed: 65.8[samples/s]
2022-04-19 10:33:16,458 reid_baseline.train INFO: normal accuracy 0.6146431030525591 4.1429595947265625 
2022-04-19 10:33:17,323 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 10:33:17,323 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 414.3%
2022-04-19 10:33:41,594 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.209, Acc: 0.637, Base Lr: 2.46e-03
2022-04-19 10:33:53,823 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.240[s] Speed: 66.6[samples/s]
2022-04-19 10:35:26,305 reid_baseline.train INFO: normal accuracy 0.6311682350240991 3.869480848312378 
2022-04-19 10:35:27,188 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 10:35:27,188 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 386.9%
2022-04-19 10:35:52,484 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.501, Acc: 0.646, Base Lr: 3.25e-03
2022-04-19 10:36:04,052 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.243[s] Speed: 66.0[samples/s]
2022-04-19 10:37:32,158 reid_baseline.train INFO: normal accuracy 0.6837273353224695 3.201321840286255 
2022-04-19 10:37:33,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 10:37:33,021 reid_baseline.train INFO: Accuracy: 68.4% Mean Entropy: 320.1%
2022-04-19 10:37:59,559 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.981, Acc: 0.706, Base Lr: 4.04e-03
2022-04-19 10:38:11,116 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.251[s] Speed: 63.8[samples/s]
2022-04-19 10:39:37,521 reid_baseline.train INFO: normal accuracy 0.7378930456736287 2.6147398948669434 
2022-04-19 10:39:38,387 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 10:39:38,387 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 261.5%
2022-04-19 10:40:03,554 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.647, Acc: 0.769, Base Lr: 4.83e-03
2022-04-19 10:40:15,687 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.245[s] Speed: 65.2[samples/s]
2022-04-19 10:41:47,961 reid_baseline.train INFO: normal accuracy 0.7810420013770943 2.136929988861084 
2022-04-19 10:41:48,816 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 10:41:48,816 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 213.7%
2022-04-19 10:42:13,762 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.507, Acc: 0.806, Base Lr: 5.62e-03
2022-04-19 10:42:25,477 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.241[s] Speed: 66.5[samples/s]
2022-04-19 10:44:02,787 reid_baseline.train INFO: normal accuracy 0.7980261647922883 1.9078431129455566 
2022-04-19 10:44:03,675 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 10:44:03,675 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 190.8%
2022-04-19 10:44:28,554 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.350, Acc: 0.836, Base Lr: 6.42e-03
2022-04-19 10:44:40,120 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.240[s] Speed: 66.7[samples/s]
2022-04-19 10:46:09,987 reid_baseline.train INFO: normal accuracy 0.8191416112003672 1.705832600593567 
2022-04-19 10:46:10,995 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 10:46:10,995 reid_baseline.train INFO: Accuracy: 81.9% Mean Entropy: 170.6%
2022-04-19 10:46:36,470 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.237, Acc: 0.873, Base Lr: 7.21e-03
2022-04-19 10:46:48,081 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.244[s] Speed: 65.6[samples/s]
2022-04-19 10:48:19,269 reid_baseline.train INFO: normal accuracy 0.8209777369749828 1.6065459251403809 
2022-04-19 10:48:20,165 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 10:48:20,165 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 160.7%
2022-04-19 10:48:45,143 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.187, Acc: 0.885, Base Lr: 4.01e-03
2022-04-19 10:48:57,939 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.248[s] Speed: 64.5[samples/s]
2022-04-19 10:50:28,050 reid_baseline.train INFO: normal accuracy 0.8257975671333486 1.4672837257385254 
2022-04-19 10:50:28,897 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 10:50:28,897 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 146.7%
2022-04-19 10:50:53,495 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.136, Acc: 0.900, Base Lr: 3.38e-03
2022-04-19 10:51:05,621 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.241[s] Speed: 66.3[samples/s]
2022-04-19 10:52:38,976 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.4473893642425537 
2022-04-19 10:52:39,831 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 10:52:39,831 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 144.7%
2022-04-19 10:53:05,474 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.111, Acc: 0.910, Base Lr: 2.77e-03
2022-04-19 10:53:17,452 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.247[s] Speed: 64.7[samples/s]
2022-04-19 10:54:47,254 reid_baseline.train INFO: normal accuracy 0.8280927243516181 1.4262354373931885 
2022-04-19 10:54:48,099 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 10:54:48,099 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 142.6%
2022-04-19 10:55:14,246 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.100, Acc: 0.911, Base Lr: 2.20e-03
2022-04-19 10:55:26,923 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.254[s] Speed: 62.9[samples/s]
2022-04-19 10:56:57,343 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.502260684967041 
2022-04-19 10:56:57,344 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 10:56:57,344 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 150.2%
2022-04-19 10:57:22,089 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.063, Acc: 0.927, Base Lr: 1.66e-03
2022-04-19 10:57:33,867 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.239[s] Speed: 66.9[samples/s]
2022-04-19 10:59:04,426 reid_baseline.train INFO: normal accuracy 0.8287812715170989 1.492899775505066 
2022-04-19 10:59:04,426 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 10:59:04,426 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 149.3%
2022-04-19 10:59:29,813 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.062, Acc: 0.925, Base Lr: 1.19e-03
2022-04-19 10:59:41,626 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.245[s] Speed: 65.4[samples/s]
2022-04-19 11:01:09,260 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.479567289352417 
2022-04-19 11:01:09,260 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 11:01:09,260 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 148.0%
2022-04-19 11:01:33,597 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.036, Acc: 0.933, Base Lr: 7.78e-04
2022-04-19 11:01:45,875 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.240[s] Speed: 66.6[samples/s]
2022-04-19 11:03:14,796 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4383658170700073 
2022-04-19 11:03:14,797 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 11:03:14,797 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 143.8%
2022-04-19 11:03:39,301 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.044, Acc: 0.934, Base Lr: 4.51e-04
2022-04-19 11:03:50,766 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.237[s] Speed: 67.6[samples/s]
2022-04-19 11:05:15,641 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4680731296539307 
2022-04-19 11:05:15,642 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 11:05:15,642 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.8%
2022-04-19 11:05:39,546 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.049, Acc: 0.927, Base Lr: 2.11e-04
2022-04-19 11:05:51,076 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.232[s] Speed: 68.8[samples/s]
2022-04-19 11:07:20,930 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4891854524612427 
2022-04-19 11:07:20,931 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 11:07:20,931 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 148.9%
2022-04-19 11:07:45,628 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.053, Acc: 0.927, Base Lr: 6.51e-05
2022-04-19 11:07:56,996 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.236[s] Speed: 67.8[samples/s]
2022-04-19 11:09:23,791 reid_baseline.train INFO: normal accuracy 0.8329125545099839 1.4550857543945312 
2022-04-19 11:09:23,791 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 11:09:23,792 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 145.5%
2022-04-19 11:09:48,403 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.027, Acc: 0.933, Base Lr: 1.60e-05
2022-04-19 11:10:00,017 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.238[s] Speed: 67.2[samples/s]
2022-04-19 11:11:29,418 reid_baseline.train INFO: normal accuracy 0.8354372274500803 1.4689260721206665 
2022-04-19 11:11:29,418 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 11:11:29,419 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_aug_key_3_20_10/transformer_best_model.pth
2022-04-19 11:13:03,749 reid_baseline.train INFO: normal accuracy 0.8280927243516181 1.4262354373931885 
2022-04-19 11:13:03,749 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 11:13:03,749 reid_baseline.train INFO: Accuracy: 82.8%
2022-04-19 11:14:26,449 reid_baseline.train INFO: normal accuracy 0.8280927243516181 1.4262354373931885 
2022-04-19 11:14:26,449 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 11:14:26,449 reid_baseline.train INFO: Shuffled Accuracy: 82.8%
2022-04-19 11:14:54,619 reid_baseline.train INFO: normal accuracy 0.9633292130201896 0.8966494202613831 
2022-04-19 11:14:54,619 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 11:14:54,619 reid_baseline.train INFO: Source Clean Accuracy: 96.3%
