2022-04-26 13:18:37,836 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1
2022-04-26 13:18:37,836 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-26 13:18:37,836 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 13:18:37,836 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 13:18:37,837 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 13:18:49,500 reid_baseline.train INFO: start training
2022-04-26 13:19:21,940 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.995, Acc: 0.288, Base Lr: 8.72e-04
Aug Cl acc: 0.16651080784044767
2022-04-26 13:19:34,871 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-26 13:20:11,372 reid_baseline.train INFO: normal accuracy 0.39885452462772053 4.171774864196777 
2022-04-26 13:20:12,150 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 13:20:12,150 reid_baseline.train INFO: Accuracy: 39.9% Mean Entropy: 417.2%
2022-04-26 13:20:50,363 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.676, Acc: 0.593, Base Lr: 1.66e-03
Aug Cl acc: 0.18438560084292763
2022-04-26 13:21:08,980 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.373[s] Speed: 42.8[samples/s]
2022-04-26 13:21:48,123 reid_baseline.train INFO: normal accuracy 0.427262313860252 4.154052257537842 
2022-04-26 13:21:48,908 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 13:21:48,908 reid_baseline.train INFO: Accuracy: 42.7% Mean Entropy: 415.4%
2022-04-26 13:22:17,043 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.111, Acc: 0.621, Base Lr: 2.46e-03
Aug Cl acc: 0.19094006638777883
2022-04-26 13:22:29,640 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.267[s] Speed: 60.0[samples/s]
2022-04-26 13:23:10,389 reid_baseline.train INFO: normal accuracy 0.44788087056128295 4.000300407409668 
2022-04-26 13:23:11,245 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 13:23:11,246 reid_baseline.train INFO: Accuracy: 44.8% Mean Entropy: 400.0%
2022-04-26 13:23:36,830 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.325, Acc: 0.663, Base Lr: 3.25e-03
Aug Cl acc: 0.17014332821494654
2022-04-26 13:23:48,883 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.248[s] Speed: 64.6[samples/s]
2022-04-26 13:24:25,185 reid_baseline.train INFO: normal accuracy 0.4820160366552119 3.4808053970336914 
2022-04-26 13:24:26,020 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 13:24:26,020 reid_baseline.train INFO: Accuracy: 48.2% Mean Entropy: 348.1%
2022-04-26 13:24:53,193 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.803, Acc: 0.698, Base Lr: 4.04e-03
Aug Cl acc: 0.16698962763736122
2022-04-26 13:25:05,371 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.259[s] Speed: 61.8[samples/s]
2022-04-26 13:25:44,138 reid_baseline.train INFO: normal accuracy 0.5482245131729668 3.005464792251587 
2022-04-26 13:25:44,907 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 13:25:44,907 reid_baseline.train INFO: Accuracy: 54.8% Mean Entropy: 300.5%
2022-04-26 13:26:11,513 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.494, Acc: 0.763, Base Lr: 4.83e-03
Aug Cl acc: 0.18740150803013852
2022-04-26 13:26:24,225 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-26 13:27:01,256 reid_baseline.train INFO: normal accuracy 0.6036655211912944 2.6592159271240234 
2022-04-26 13:27:02,089 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 13:27:02,090 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 265.9%
2022-04-26 13:27:30,158 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.325, Acc: 0.790, Base Lr: 5.62e-03
Aug Cl acc: 0.1853327751159668
2022-04-26 13:27:43,430 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.271[s] Speed: 59.1[samples/s]
2022-04-26 13:28:19,482 reid_baseline.train INFO: normal accuracy 0.6052691867124856 2.359349489212036 
2022-04-26 13:28:20,258 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 13:28:20,258 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 235.9%
2022-04-26 13:28:47,370 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.120, Acc: 0.852, Base Lr: 6.42e-03
Aug Cl acc: 0.18868869229366905
2022-04-26 13:28:59,789 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.260[s] Speed: 61.6[samples/s]
2022-04-26 13:29:39,035 reid_baseline.train INFO: normal accuracy 0.6107674684994273 2.1234233379364014 
2022-04-26 13:29:39,809 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 13:29:39,809 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 212.3%
2022-04-26 13:30:10,320 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.077, Acc: 0.875, Base Lr: 7.21e-03
Aug Cl acc: 0.16137741741381192
2022-04-26 13:30:21,575 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.273[s] Speed: 58.5[samples/s]
2022-04-26 13:30:56,880 reid_baseline.train INFO: normal accuracy 0.6073310423825887 2.0052390098571777 
2022-04-26 13:30:57,751 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 13:30:57,752 reid_baseline.train INFO: Accuracy: 60.7% Mean Entropy: 200.5%
2022-04-26 13:31:26,319 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.992, Acc: 0.890, Base Lr: 4.01e-03
Aug Cl acc: 0.1787536897157368
2022-04-26 13:31:38,476 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.268[s] Speed: 59.8[samples/s]
2022-04-26 13:32:19,387 reid_baseline.train INFO: normal accuracy 0.6192439862542956 1.946865439414978 
2022-04-26 13:32:20,176 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 13:32:20,177 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 194.7%
2022-04-26 13:32:45,220 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.955, Acc: 0.914, Base Lr: 3.38e-03
Aug Cl acc: 0.1671738624572754
2022-04-26 13:32:56,624 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.240[s] Speed: 66.8[samples/s]
2022-04-26 13:33:34,323 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.8955000638961792 
2022-04-26 13:33:35,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 13:33:35,155 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 189.6%
2022-04-26 13:34:03,028 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.920, Acc: 0.917, Base Lr: 2.77e-03
Aug Cl acc: 0.18653234682585063
2022-04-26 13:34:15,780 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-26 13:34:54,237 reid_baseline.train INFO: normal accuracy 0.6254295532646048 1.889373540878296 
2022-04-26 13:34:55,006 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 13:34:55,006 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.9%
2022-04-26 13:35:20,084 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.924, Acc: 0.907, Base Lr: 2.20e-03
Aug Cl acc: 0.18239628641228928
2022-04-26 13:35:33,563 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.251[s] Speed: 63.7[samples/s]
2022-04-26 13:36:12,163 reid_baseline.train INFO: normal accuracy 0.6224513172966781 1.9277523756027222 
2022-04-26 13:36:12,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 13:36:12,163 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 192.8%
2022-04-26 13:36:39,441 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.897, Acc: 0.915, Base Lr: 1.66e-03
Aug Cl acc: 0.18418861690320468
2022-04-26 13:36:53,324 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.270[s] Speed: 59.2[samples/s]
2022-04-26 13:37:29,830 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.8802285194396973 
2022-04-26 13:37:30,587 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 13:37:30,587 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 188.0%
2022-04-26 13:37:57,609 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.875, Acc: 0.928, Base Lr: 1.19e-03
Aug Cl acc: 0.18166567149915194
2022-04-26 13:38:10,329 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.258[s] Speed: 61.9[samples/s]
2022-04-26 13:38:47,619 reid_baseline.train INFO: normal accuracy 0.633906071019473 1.8785254955291748 
2022-04-26 13:38:48,436 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 13:38:48,436 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 187.9%
2022-04-26 13:39:16,939 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.880, Acc: 0.918, Base Lr: 7.78e-04
Aug Cl acc: 0.18626393769916735
2022-04-26 13:39:29,682 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-26 13:40:04,539 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.7738112211227417 
2022-04-26 13:40:05,327 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 13:40:05,328 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 177.4%
2022-04-26 13:40:32,234 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.861, Acc: 0.933, Base Lr: 4.51e-04
Aug Cl acc: 0.1882371275048507
2022-04-26 13:40:44,756 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.259[s] Speed: 61.7[samples/s]
2022-04-26 13:41:21,255 reid_baseline.train INFO: normal accuracy 0.63184421534937 1.8850802183151245 
2022-04-26 13:41:21,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 13:41:21,256 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 188.5%
2022-04-26 13:41:48,462 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.863, Acc: 0.928, Base Lr: 2.11e-04
Aug Cl acc: 0.20133974677638003
2022-04-26 13:41:59,434 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.250[s] Speed: 64.0[samples/s]
2022-04-26 13:42:36,022 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.8452051877975464 
2022-04-26 13:42:36,022 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 13:42:36,022 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 184.5%
2022-04-26 13:43:03,801 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.866, Acc: 0.920, Base Lr: 6.51e-05
Aug Cl acc: 0.18360377612866854
2022-04-26 13:43:16,365 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.265[s] Speed: 60.4[samples/s]
2022-04-26 13:43:51,333 reid_baseline.train INFO: normal accuracy 0.6284077892325315 1.881064772605896 
2022-04-26 13:43:51,334 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 13:43:51,334 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 188.1%
2022-04-26 13:44:20,178 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.872, Acc: 0.921, Base Lr: 1.60e-05
Aug Cl acc: 0.17736133776212992
2022-04-26 13:44:31,523 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.264[s] Speed: 60.5[samples/s]
2022-04-26 13:45:06,867 reid_baseline.train INFO: normal accuracy 0.6306987399770905 1.8684760332107544 
2022-04-26 13:45:06,867 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 13:45:06,867 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-26 13:45:44,718 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.7738112211227417 
2022-04-26 13:45:44,718 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 13:45:44,718 reid_baseline.train INFO: Accuracy: 63.0%
2022-04-26 13:46:23,193 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.7738112211227417 
2022-04-26 13:46:23,193 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 13:46:23,193 reid_baseline.train INFO: Shuffled Accuracy: 63.0%
2022-04-26 13:46:52,955 reid_baseline.train INFO: normal accuracy 0.9736299958796869 0.7965866923332214 
2022-04-26 13:46:52,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 13:46:52,955 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-26 13:46:58,596 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1
2022-04-26 13:46:58,596 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-26 13:46:58,596 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 13:46:58,596 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 13:46:58,597 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 13:47:08,080 reid_baseline.train INFO: start training
2022-04-26 13:47:42,040 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.995, Acc: 0.289, Base Lr: 8.72e-04
Aug Cl acc: 0.16651080784044767
2022-04-26 13:47:56,118 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.7[samples/s]
2022-04-26 13:48:34,888 reid_baseline.train INFO: normal accuracy 0.5172336111736877 4.171998023986816 
2022-04-26 13:48:35,665 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 13:48:35,665 reid_baseline.train INFO: Accuracy: 51.7% Mean Entropy: 417.2%
2022-04-26 13:49:05,328 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.676, Acc: 0.593, Base Lr: 1.66e-03
Aug Cl acc: 0.18438560084292763
2022-04-26 13:49:16,749 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.270[s] Speed: 59.2[samples/s]
2022-04-26 13:49:52,870 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.153152942657471 
2022-04-26 13:49:53,686 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 13:49:53,687 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 415.3%
2022-04-26 13:50:22,260 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.111, Acc: 0.620, Base Lr: 2.46e-03
Aug Cl acc: 0.19094006638777883
2022-04-26 13:50:34,772 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.270[s] Speed: 59.3[samples/s]
2022-04-26 13:51:15,790 reid_baseline.train INFO: normal accuracy 0.5485469700382969 3.992236375808716 
2022-04-26 13:51:16,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 13:51:16,620 reid_baseline.train INFO: Accuracy: 54.9% Mean Entropy: 399.2%
2022-04-26 13:51:44,750 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.325, Acc: 0.664, Base Lr: 3.25e-03
Aug Cl acc: 0.17014332821494654
2022-04-26 13:51:57,808 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-26 13:52:35,683 reid_baseline.train INFO: normal accuracy 0.5893219193512053 3.4318699836730957 
2022-04-26 13:52:36,488 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 13:52:36,488 reid_baseline.train INFO: Accuracy: 58.9% Mean Entropy: 343.2%
2022-04-26 13:53:06,371 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.804, Acc: 0.698, Base Lr: 4.04e-03
Aug Cl acc: 0.16740081184788755
2022-04-26 13:53:19,609 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.284[s] Speed: 56.4[samples/s]
2022-04-26 13:53:58,676 reid_baseline.train INFO: normal accuracy 0.6634377111962154 2.8322596549987793 
2022-04-26 13:53:59,490 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 13:53:59,491 reid_baseline.train INFO: Accuracy: 66.3% Mean Entropy: 283.2%
2022-04-26 13:54:26,874 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.494, Acc: 0.763, Base Lr: 4.83e-03
Aug Cl acc: 0.18740150803013852
2022-04-26 13:54:39,820 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-26 13:55:19,673 reid_baseline.train INFO: normal accuracy 0.7256138769993242 2.44071102142334 
2022-04-26 13:55:20,471 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 13:55:20,471 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 244.1%
2022-04-26 13:55:48,381 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.325, Acc: 0.792, Base Lr: 5.62e-03
Aug Cl acc: 0.18574395932649312
2022-04-26 13:56:00,498 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.263[s] Speed: 60.8[samples/s]
2022-04-26 13:56:41,230 reid_baseline.train INFO: normal accuracy 0.7537733723811669 2.1201674938201904 
2022-04-26 13:56:42,016 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 13:56:42,016 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 212.0%
2022-04-26 13:57:08,857 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.120, Acc: 0.852, Base Lr: 6.42e-03
Aug Cl acc: 0.18866128670541862
2022-04-26 13:57:21,160 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.258[s] Speed: 62.1[samples/s]
2022-04-26 13:58:00,208 reid_baseline.train INFO: normal accuracy 0.7670646542013967 1.887108325958252 
2022-04-26 13:58:01,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 13:58:01,065 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 188.7%
2022-04-26 13:58:30,679 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.076, Acc: 0.873, Base Lr: 7.21e-03
Aug Cl acc: 0.1614361562226948
2022-04-26 13:58:43,408 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.278[s] Speed: 57.6[samples/s]
2022-04-26 13:59:21,791 reid_baseline.train INFO: normal accuracy 0.7722460013516558 1.7840118408203125 
2022-04-26 13:59:22,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 13:59:22,599 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 178.4%
2022-04-26 13:59:50,382 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.992, Acc: 0.891, Base Lr: 4.01e-03
Aug Cl acc: 0.1791648739262631
2022-04-26 14:00:03,029 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.266[s] Speed: 60.2[samples/s]
2022-04-26 14:00:43,533 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.74587881565094 
2022-04-26 14:00:44,345 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 14:00:44,345 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 174.6%
2022-04-26 14:01:10,604 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.955, Acc: 0.913, Base Lr: 3.38e-03
Aug Cl acc: 0.16758504666780172
2022-04-26 14:01:23,350 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-26 14:02:01,659 reid_baseline.train INFO: normal accuracy 0.7796801081324622 1.7067468166351318 
2022-04-26 14:02:02,530 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 14:02:02,530 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 170.7%
2022-04-26 14:02:32,546 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.920, Acc: 0.917, Base Lr: 2.77e-03
Aug Cl acc: 0.1885882678784822
2022-04-26 14:02:45,089 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.279[s] Speed: 57.4[samples/s]
2022-04-26 14:03:20,204 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.6861457824707031 
2022-04-26 14:03:21,057 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 14:03:21,057 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 168.6%
2022-04-26 14:03:48,535 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.924, Acc: 0.907, Base Lr: 2.20e-03
Aug Cl acc: 0.18116273378071032
2022-04-26 14:04:01,783 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-26 14:04:38,689 reid_baseline.train INFO: normal accuracy 0.7839603514305024 1.7428944110870361 
2022-04-26 14:04:38,689 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 14:04:38,690 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 174.3%
2022-04-26 14:05:03,217 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.897, Acc: 0.915, Base Lr: 1.66e-03
Aug Cl acc: 0.18418861690320468
2022-04-26 14:05:17,077 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.252[s] Speed: 63.4[samples/s]
2022-04-26 14:05:54,034 reid_baseline.train INFO: normal accuracy 0.7821581437260644 1.6817466020584106 
2022-04-26 14:05:54,837 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 14:05:54,838 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 168.2%
2022-04-26 14:06:19,044 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.875, Acc: 0.928, Base Lr: 1.19e-03
Aug Cl acc: 0.18078455172087016
2022-04-26 14:06:31,422 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.239[s] Speed: 66.8[samples/s]
2022-04-26 14:07:10,433 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.6923489570617676 
2022-04-26 14:07:10,433 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 14:07:10,434 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 169.2%
2022-04-26 14:07:39,826 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.880, Acc: 0.918, Base Lr: 7.78e-04
Aug Cl acc: 0.18626393769916735
2022-04-26 14:07:53,167 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-26 14:08:30,041 reid_baseline.train INFO: normal accuracy 0.7823834196891192 1.5746575593948364 
2022-04-26 14:08:30,846 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 14:08:30,846 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 157.5%
2022-04-26 14:08:57,729 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.861, Acc: 0.933, Base Lr: 4.51e-04
Aug Cl acc: 0.18864829916703074
2022-04-26 14:09:09,755 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-26 14:09:47,351 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.6806542873382568 
2022-04-26 14:09:47,352 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 14:09:47,352 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.1%
2022-04-26 14:10:15,635 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.863, Acc: 0.928, Base Lr: 2.11e-04
Aug Cl acc: 0.20175093098690636
2022-04-26 14:10:28,700 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.271[s] Speed: 59.1[samples/s]
2022-04-26 14:11:04,639 reid_baseline.train INFO: normal accuracy 0.7857625591349403 1.6457158327102661 
2022-04-26 14:11:04,640 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 14:11:04,640 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 164.6%
2022-04-26 14:11:30,420 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.866, Acc: 0.920, Base Lr: 6.51e-05
Aug Cl acc: 0.18442614454972117
2022-04-26 14:11:43,036 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.252[s] Speed: 63.6[samples/s]
2022-04-26 14:12:22,430 reid_baseline.train INFO: normal accuracy 0.7855372831718855 1.6873211860656738 
2022-04-26 14:12:22,431 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 14:12:22,431 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 168.7%
2022-04-26 14:12:51,105 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.872, Acc: 0.920, Base Lr: 1.60e-05
Aug Cl acc: 0.1765389693410773
2022-04-26 14:13:04,287 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.275[s] Speed: 58.1[samples/s]
2022-04-26 14:13:39,669 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.6739579439163208 
2022-04-26 14:13:39,669 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 14:13:39,669 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 167.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-26 14:14:18,703 reid_baseline.train INFO: normal accuracy 0.7823834196891192 1.5746575593948364 
2022-04-26 14:14:18,703 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 14:14:18,703 reid_baseline.train INFO: Accuracy: 78.2%
2022-04-26 14:14:58,225 reid_baseline.train INFO: normal accuracy 0.7823834196891192 1.5746575593948364 
2022-04-26 14:14:58,226 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 14:14:58,226 reid_baseline.train INFO: Shuffled Accuracy: 78.2%
2022-04-26 14:15:31,250 reid_baseline.train INFO: normal accuracy 0.9736299958796869 0.7962384223937988 
2022-04-26 14:15:31,251 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 14:15:31,251 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-26 14:15:37,015 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1
2022-04-26 14:15:37,015 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-26 14:15:37,016 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 14:15:37,016 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 14:15:37,016 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 14:15:47,775 reid_baseline.train INFO: start training
2022-04-26 14:16:20,857 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.995, Acc: 0.288, Base Lr: 8.72e-04
Aug Cl acc: 0.16651080784044767
2022-04-26 14:16:34,769 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-26 14:18:11,393 reid_baseline.train INFO: normal accuracy 0.5965113610282304 4.171725273132324 
2022-04-26 14:18:12,145 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 14:18:12,145 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 417.2%
2022-04-26 14:18:36,850 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.676, Acc: 0.593, Base Lr: 1.66e-03
Aug Cl acc: 0.18438560084292763
2022-04-26 14:18:48,582 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.239[s] Speed: 66.8[samples/s]
2022-04-26 14:20:21,019 reid_baseline.train INFO: normal accuracy 0.6217580904291944 4.144161701202393 
2022-04-26 14:20:21,835 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 14:20:21,836 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 414.4%
2022-04-26 14:20:49,535 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.111, Acc: 0.621, Base Lr: 2.46e-03
Aug Cl acc: 0.19135125059830516
2022-04-26 14:21:00,811 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.256[s] Speed: 62.4[samples/s]
2022-04-26 14:22:37,782 reid_baseline.train INFO: normal accuracy 0.6307092035804452 3.8939027786254883 
2022-04-26 14:22:38,647 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 14:22:38,647 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 389.4%
2022-04-26 14:23:08,953 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.325, Acc: 0.664, Base Lr: 3.25e-03
Aug Cl acc: 0.17014332821494654
2022-04-26 14:23:20,457 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.274[s] Speed: 58.4[samples/s]
2022-04-26 14:24:51,073 reid_baseline.train INFO: normal accuracy 0.6750057378930456 3.1663894653320312 
2022-04-26 14:24:51,874 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 14:24:51,874 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 316.6%
2022-04-26 14:25:19,934 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.803, Acc: 0.698, Base Lr: 4.04e-03
Aug Cl acc: 0.16698962763736122
2022-04-26 14:25:33,676 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.275[s] Speed: 58.2[samples/s]
2022-04-26 14:27:04,507 reid_baseline.train INFO: normal accuracy 0.7385815928391095 2.5120203495025635 
2022-04-26 14:27:05,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 14:27:05,302 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 251.2%
2022-04-26 14:27:35,006 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.494, Acc: 0.763, Base Lr: 4.83e-03
Aug Cl acc: 0.18740150803013852
2022-04-26 14:27:48,456 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.283[s] Speed: 56.5[samples/s]
2022-04-26 14:29:19,693 reid_baseline.train INFO: normal accuracy 0.782648611429883 2.1212313175201416 
2022-04-26 14:29:20,526 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 14:29:20,526 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 212.1%
2022-04-26 14:29:48,092 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.325, Acc: 0.790, Base Lr: 5.62e-03
Aug Cl acc: 0.18574395932649312
2022-04-26 14:30:00,293 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.261[s] Speed: 61.2[samples/s]
2022-04-26 14:31:30,036 reid_baseline.train INFO: normal accuracy 0.8069772779435391 1.8520387411117554 
2022-04-26 14:31:30,858 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 14:31:30,859 reid_baseline.train INFO: Accuracy: 80.7% Mean Entropy: 185.2%
2022-04-26 14:31:58,105 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.120, Acc: 0.852, Base Lr: 6.42e-03
Aug Cl acc: 0.18909987650419535
2022-04-26 14:32:10,918 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.263[s] Speed: 60.8[samples/s]
2022-04-26 14:33:42,418 reid_baseline.train INFO: normal accuracy 0.8154693596511361 1.6351838111877441 
2022-04-26 14:33:43,268 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 14:33:43,268 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 163.5%
2022-04-26 14:34:10,653 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.077, Acc: 0.874, Base Lr: 7.21e-03
Aug Cl acc: 0.16266970885427376
2022-04-26 14:34:22,809 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.260[s] Speed: 61.7[samples/s]
2022-04-26 14:35:56,643 reid_baseline.train INFO: normal accuracy 0.8225843470277714 1.5252623558044434 
2022-04-26 14:35:57,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 14:35:57,394 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 152.5%
2022-04-26 14:36:25,460 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.992, Acc: 0.890, Base Lr: 4.01e-03
Aug Cl acc: 0.17834250550521047
2022-04-26 14:36:37,644 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.263[s] Speed: 60.7[samples/s]
2022-04-26 14:38:15,113 reid_baseline.train INFO: normal accuracy 0.8264861142988295 1.4983547925949097 
2022-04-26 14:38:15,873 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 14:38:15,873 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 149.8%
2022-04-26 14:38:42,160 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.955, Acc: 0.913, Base Lr: 3.38e-03
Aug Cl acc: 0.16799623087832802
2022-04-26 14:38:54,661 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.254[s] Speed: 62.9[samples/s]
2022-04-26 14:40:31,542 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.45350980758667 
2022-04-26 14:40:32,370 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 14:40:32,371 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 145.4%
2022-04-26 14:41:00,018 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.920, Acc: 0.917, Base Lr: 2.77e-03
Aug Cl acc: 0.18565123959591515
2022-04-26 14:41:11,922 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.259[s] Speed: 61.7[samples/s]
2022-04-26 14:42:45,664 reid_baseline.train INFO: normal accuracy 0.8299288501262336 1.440391182899475 
2022-04-26 14:42:46,473 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 14:42:46,474 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 144.0%
2022-04-26 14:43:13,576 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.923, Acc: 0.909, Base Lr: 2.20e-03
Aug Cl acc: 0.1832186548333419
2022-04-26 14:43:27,039 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.266[s] Speed: 60.2[samples/s]
2022-04-26 14:45:01,986 reid_baseline.train INFO: normal accuracy 0.8306173972917145 1.4927330017089844 
2022-04-26 14:45:01,987 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 14:45:01,987 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 149.3%
2022-04-26 14:45:28,728 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.897, Acc: 0.916, Base Lr: 1.66e-03
Aug Cl acc: 0.18377743269267835
2022-04-26 14:45:41,253 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-26 14:47:21,460 reid_baseline.train INFO: normal accuracy 0.8315354601790222 1.4548696279525757 
2022-04-26 14:47:21,461 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 14:47:21,461 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 145.5%
2022-04-26 14:47:49,543 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.875, Acc: 0.928, Base Lr: 1.19e-03
Aug Cl acc: 0.18166567149915194
2022-04-26 14:48:03,372 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.274[s] Speed: 58.4[samples/s]
2022-04-26 14:49:39,827 reid_baseline.train INFO: normal accuracy 0.8333715859536378 1.4676939249038696 
2022-04-26 14:49:39,828 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 14:49:39,828 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 146.8%
2022-04-26 14:50:09,429 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.880, Acc: 0.918, Base Lr: 7.78e-04
Aug Cl acc: 0.18667512190969368
2022-04-26 14:50:22,064 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.278[s] Speed: 57.6[samples/s]
2022-04-26 14:51:57,470 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.36043119430542 
2022-04-26 14:51:58,279 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 14:51:58,279 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 136.0%
2022-04-26 14:52:23,448 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.861, Acc: 0.933, Base Lr: 4.51e-04
Aug Cl acc: 0.18864829916703074
2022-04-26 14:52:34,672 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.239[s] Speed: 66.9[samples/s]
2022-04-26 14:54:08,583 reid_baseline.train INFO: normal accuracy 0.8331420702318109 1.4671525955200195 
2022-04-26 14:54:08,583 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 14:54:08,583 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 146.7%
2022-04-26 14:54:33,257 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.863, Acc: 0.928, Base Lr: 2.11e-04
Aug Cl acc: 0.20175093098690636
2022-04-26 14:54:46,473 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.249[s] Speed: 64.2[samples/s]
2022-04-26 14:56:14,088 reid_baseline.train INFO: normal accuracy 0.8315354601790222 1.4325963258743286 
2022-04-26 14:56:14,089 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 14:56:14,089 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.3%
2022-04-26 14:56:43,634 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.866, Acc: 0.920, Base Lr: 6.51e-05
Aug Cl acc: 0.18442614454972117
2022-04-26 14:56:56,030 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.275[s] Speed: 58.1[samples/s]
2022-04-26 14:58:32,377 reid_baseline.train INFO: normal accuracy 0.8331420702318109 1.4690757989883423 
2022-04-26 14:58:32,378 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 14:58:32,379 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 146.9%
2022-04-26 14:58:58,846 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.872, Acc: 0.920, Base Lr: 1.60e-05
Aug Cl acc: 0.17736133776212992
2022-04-26 14:59:10,640 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.250[s] Speed: 63.9[samples/s]
2022-04-26 15:00:47,035 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4559803009033203 
2022-04-26 15:00:47,035 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 15:00:47,036 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 145.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-26 15:02:20,963 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.36043119430542 
2022-04-26 15:02:20,963 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 15:02:20,964 reid_baseline.train INFO: Accuracy: 83.6%
2022-04-26 15:03:54,274 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.36043119430542 
2022-04-26 15:03:54,275 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 15:03:54,275 reid_baseline.train INFO: Shuffled Accuracy: 83.6%
2022-04-26 15:04:24,707 reid_baseline.train INFO: normal accuracy 0.9736299958796869 0.796470582485199 
2022-04-26 15:04:24,707 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 15:04:24,707 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-26 15:04:30,588 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2
2022-04-26 15:04:30,588 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-26 15:04:30,588 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 15:04:30,588 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 15:04:30,589 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 15:04:40,397 reid_baseline.train INFO: start training
2022-04-26 15:05:14,786 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.986, Acc: 0.295, Base Lr: 8.72e-04
Aug Cl acc: 0.15526122795908073
2022-04-26 15:05:27,330 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-26 15:06:06,894 reid_baseline.train INFO: normal accuracy 0.39885452462772053 4.171752452850342 
2022-04-26 15:06:07,679 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 15:06:07,680 reid_baseline.train INFO: Accuracy: 39.9% Mean Entropy: 417.2%
2022-04-26 15:06:35,967 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.650, Acc: 0.591, Base Lr: 1.66e-03
Aug Cl acc: 0.166575783177426
2022-04-26 15:06:48,401 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.268[s] Speed: 59.7[samples/s]
2022-04-26 15:07:30,003 reid_baseline.train INFO: normal accuracy 0.424971363115693 4.153237819671631 
2022-04-26 15:07:30,806 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 15:07:30,806 reid_baseline.train INFO: Accuracy: 42.5% Mean Entropy: 415.3%
2022-04-26 15:08:01,628 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.066, Acc: 0.630, Base Lr: 2.46e-03
Aug Cl acc: 0.1843660128744025
2022-04-26 15:08:15,007 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-26 15:08:52,545 reid_baseline.train INFO: normal accuracy 0.44581901489117987 3.9936320781707764 
2022-04-26 15:08:53,372 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 15:08:53,372 reid_baseline.train INFO: Accuracy: 44.6% Mean Entropy: 399.4%
2022-04-26 15:09:21,451 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.296, Acc: 0.655, Base Lr: 3.25e-03
Aug Cl acc: 0.16553429553383275
2022-04-26 15:09:33,627 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.264[s] Speed: 60.5[samples/s]
2022-04-26 15:10:09,293 reid_baseline.train INFO: normal accuracy 0.4765177548682703 3.4776790142059326 
2022-04-26 15:10:10,047 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 15:10:10,047 reid_baseline.train INFO: Accuracy: 47.7% Mean Entropy: 347.8%
2022-04-26 15:10:35,203 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.781, Acc: 0.700, Base Lr: 4.04e-03
Aug Cl acc: 0.16271512131941945
2022-04-26 15:10:47,164 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.244[s] Speed: 65.5[samples/s]
2022-04-26 15:11:22,540 reid_baseline.train INFO: normal accuracy 0.5450171821305841 2.9990992546081543 
2022-04-26 15:11:23,359 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 15:11:23,360 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 299.9%
2022-04-26 15:11:49,122 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.466, Acc: 0.757, Base Lr: 4.83e-03
Aug Cl acc: 0.18459503274214895
2022-04-26 15:12:00,059 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.240[s] Speed: 66.6[samples/s]
2022-04-26 15:12:34,809 reid_baseline.train INFO: normal accuracy 0.6006872852233677 2.6573781967163086 
2022-04-26 15:12:35,626 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 15:12:35,627 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 265.7%
2022-04-26 15:13:01,235 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.312, Acc: 0.793, Base Lr: 5.62e-03
Aug Cl acc: 0.17846350920827767
2022-04-26 15:13:12,497 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.242[s] Speed: 66.0[samples/s]
2022-04-26 15:13:47,961 reid_baseline.train INFO: normal accuracy 0.6087056128293241 2.3525030612945557 
2022-04-26 15:13:48,821 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 15:13:48,821 reid_baseline.train INFO: Accuracy: 60.9% Mean Entropy: 235.3%
2022-04-26 15:14:14,013 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.120, Acc: 0.849, Base Lr: 6.42e-03
Aug Cl acc: 0.18391818749277214
2022-04-26 15:14:25,492 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.240[s] Speed: 66.6[samples/s]
2022-04-26 15:15:00,572 reid_baseline.train INFO: normal accuracy 0.6169530355097366 2.1358001232147217 
2022-04-26 15:15:01,318 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 15:15:01,318 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 213.6%
2022-04-26 15:15:26,155 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.065, Acc: 0.868, Base Lr: 7.21e-03
Aug Cl acc: 0.1754862383792275
2022-04-26 15:15:37,831 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.240[s] Speed: 66.7[samples/s]
2022-04-26 15:16:12,717 reid_baseline.train INFO: normal accuracy 0.6153493699885453 2.0019357204437256 
2022-04-26 15:16:13,523 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 15:16:13,524 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 200.2%
2022-04-26 15:16:39,288 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.974, Acc: 0.889, Base Lr: 4.01e-03
Aug Cl acc: 0.16604826324864438
2022-04-26 15:16:51,103 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.245[s] Speed: 65.2[samples/s]
2022-04-26 15:17:27,651 reid_baseline.train INFO: normal accuracy 0.6240549828178694 1.9508631229400635 
2022-04-26 15:17:28,458 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 15:17:28,458 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 195.1%
2022-04-26 15:17:52,658 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.938, Acc: 0.912, Base Lr: 3.38e-03
Aug Cl acc: 0.17288348549290708
2022-04-26 15:18:03,756 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.231[s] Speed: 69.1[samples/s]
2022-04-26 15:18:38,703 reid_baseline.train INFO: normal accuracy 0.6238258877434135 1.8974496126174927 
2022-04-26 15:18:39,464 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 15:18:39,464 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 189.7%
2022-04-26 15:19:04,852 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.913, Acc: 0.909, Base Lr: 2.77e-03
Aug Cl acc: 0.19611943395514236
2022-04-26 15:19:16,509 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.243[s] Speed: 65.8[samples/s]
2022-04-26 15:19:52,195 reid_baseline.train INFO: normal accuracy 0.6277205040091638 1.900673508644104 
2022-04-26 15:19:52,195 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 15:19:52,196 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 190.1%
2022-04-26 15:20:17,940 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.901, Acc: 0.913, Base Lr: 2.20e-03
Aug Cl acc: 0.17587827381334806
2022-04-26 15:20:30,409 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.250[s] Speed: 63.9[samples/s]
2022-04-26 15:21:05,529 reid_baseline.train INFO: normal accuracy 0.6219931271477663 1.8990570306777954 
2022-04-26 15:21:05,529 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 15:21:05,529 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 189.9%
2022-04-26 15:21:29,176 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.879, Acc: 0.919, Base Lr: 1.66e-03
Aug Cl acc: 0.1782242875350149
2022-04-26 15:21:41,093 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.233[s] Speed: 68.6[samples/s]
2022-04-26 15:22:17,319 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.8628305196762085 
2022-04-26 15:22:18,093 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 15:22:18,093 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.3%
2022-04-26 15:22:42,695 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.863, Acc: 0.931, Base Lr: 1.19e-03
Aug Cl acc: 0.1757079425610994
2022-04-26 15:22:54,942 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.242[s] Speed: 66.2[samples/s]
2022-04-26 15:23:29,891 reid_baseline.train INFO: normal accuracy 0.6332187857961054 1.8598523139953613 
2022-04-26 15:23:30,688 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 15:23:30,689 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 186.0%
2022-04-26 15:23:54,940 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.864, Acc: 0.922, Base Lr: 7.78e-04
Aug Cl acc: 0.19125269588671232
2022-04-26 15:24:06,020 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.232[s] Speed: 69.0[samples/s]
2022-04-26 15:24:40,228 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.7732219696044922 
2022-04-26 15:24:41,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 15:24:41,065 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 177.3%
2022-04-26 15:25:05,825 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.837, Acc: 0.931, Base Lr: 4.51e-04
Aug Cl acc: 0.17994668609217593
2022-04-26 15:25:17,326 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.237[s] Speed: 67.4[samples/s]
2022-04-26 15:25:52,974 reid_baseline.train INFO: normal accuracy 0.6323024054982818 1.8862371444702148 
2022-04-26 15:25:52,974 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 15:25:52,975 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 188.6%
2022-04-26 15:26:18,119 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.853, Acc: 0.930, Base Lr: 2.11e-04
Aug Cl acc: 0.18964882900840357
2022-04-26 15:26:29,363 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.239[s] Speed: 66.9[samples/s]
2022-04-26 15:27:03,532 reid_baseline.train INFO: normal accuracy 0.6316151202749141 1.8455349206924438 
2022-04-26 15:27:03,532 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 15:27:03,532 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 184.6%
2022-04-26 15:27:27,426 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.852, Acc: 0.919, Base Lr: 6.51e-05
Aug Cl acc: 0.19079057793868215
2022-04-26 15:27:39,000 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.233[s] Speed: 68.7[samples/s]
2022-04-26 15:28:14,538 reid_baseline.train INFO: normal accuracy 0.6323024054982818 1.879256010055542 
2022-04-26 15:28:14,538 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 15:28:14,538 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 187.9%
2022-04-26 15:28:38,717 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.847, Acc: 0.921, Base Lr: 1.60e-05
Aug Cl acc: 0.19099297021564685
2022-04-26 15:28:49,463 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.230[s] Speed: 69.7[samples/s]
2022-04-26 15:29:24,013 reid_baseline.train INFO: normal accuracy 0.63184421534937 1.8747221231460571 
2022-04-26 15:29:24,014 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 15:29:24,014 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 187.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-26 15:30:00,196 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.7732219696044922 
2022-04-26 15:30:00,196 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 15:30:00,196 reid_baseline.train INFO: Accuracy: 62.9%
2022-04-26 15:30:35,935 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.7732219696044922 
2022-04-26 15:30:35,936 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 15:30:35,936 reid_baseline.train INFO: Shuffled Accuracy: 62.9%
2022-04-26 15:31:04,719 reid_baseline.train INFO: normal accuracy 0.9723939019365472 0.7964731454849243 
2022-04-26 15:31:04,719 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 15:31:04,719 reid_baseline.train INFO: Source Clean Accuracy: 97.2%
2022-04-26 15:31:10,505 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2
2022-04-26 15:31:10,505 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-26 15:31:10,505 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 15:31:10,505 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 15:31:10,505 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 15:31:21,072 reid_baseline.train INFO: start training
2022-04-26 15:31:54,603 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.986, Acc: 0.295, Base Lr: 8.72e-04
Aug Cl acc: 0.15567241216960706
2022-04-26 15:32:07,808 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-26 15:32:43,682 reid_baseline.train INFO: normal accuracy 0.5244424419914395 4.1719794273376465 
2022-04-26 15:32:44,475 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 15:32:44,475 reid_baseline.train INFO: Accuracy: 52.4% Mean Entropy: 417.2%
2022-04-26 15:33:10,049 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.650, Acc: 0.592, Base Lr: 1.66e-03
Aug Cl acc: 0.166575783177426
2022-04-26 15:33:21,406 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.243[s] Speed: 65.9[samples/s]
2022-04-26 15:33:56,336 reid_baseline.train INFO: normal accuracy 0.540662311331381 4.1522088050842285 
2022-04-26 15:33:57,143 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 15:33:57,143 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 415.2%
2022-04-26 15:34:22,575 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.066, Acc: 0.630, Base Lr: 2.46e-03
Aug Cl acc: 0.1843660128744025
2022-04-26 15:34:34,302 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.244[s] Speed: 65.7[samples/s]
2022-04-26 15:35:18,026 reid_baseline.train INFO: normal accuracy 0.5449425546294211 3.981687068939209 
2022-04-26 15:35:18,976 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 15:35:18,977 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 398.2%
2022-04-26 15:36:13,418 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.296, Acc: 0.655, Base Lr: 3.25e-03
Aug Cl acc: 0.167179032375938
2022-04-26 15:36:47,452 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.582[s] Speed: 27.5[samples/s]
2022-04-26 15:37:53,987 reid_baseline.train INFO: normal accuracy 0.5850416760531651 3.4200634956359863 
2022-04-26 15:37:54,796 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 15:37:54,797 reid_baseline.train INFO: Accuracy: 58.5% Mean Entropy: 342.0%
2022-04-26 15:39:01,709 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.781, Acc: 0.700, Base Lr: 4.04e-03
Aug Cl acc: 0.16189275289836683
2022-04-26 15:39:35,864 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.665[s] Speed: 24.1[samples/s]
2022-04-26 15:40:41,585 reid_baseline.train INFO: normal accuracy 0.6636629871592701 2.8214287757873535 
2022-04-26 15:40:42,863 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 15:40:42,863 reid_baseline.train INFO: Accuracy: 66.4% Mean Entropy: 282.1%
2022-04-26 15:41:59,572 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.466, Acc: 0.757, Base Lr: 4.83e-03
Aug Cl acc: 0.18541740116320157
2022-04-26 15:42:31,485 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.715[s] Speed: 22.4[samples/s]
2022-04-26 15:43:34,553 reid_baseline.train INFO: normal accuracy 0.7265149808515431 2.433112382888794 
2022-04-26 15:43:35,409 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 15:43:35,409 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 243.3%
2022-04-26 15:44:46,348 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.311, Acc: 0.796, Base Lr: 5.62e-03
Aug Cl acc: 0.17788785382321007
2022-04-26 15:45:17,031 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.669[s] Speed: 23.9[samples/s]
2022-04-26 15:46:24,407 reid_baseline.train INFO: normal accuracy 0.7524217166028385 2.1045045852661133 
2022-04-26 15:46:25,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 15:46:25,594 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 210.5%
2022-04-26 15:47:37,367 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.120, Acc: 0.850, Base Lr: 6.42e-03
Aug Cl acc: 0.18341211268776342
2022-04-26 15:48:10,142 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.688[s] Speed: 23.3[samples/s]
2022-04-26 15:49:18,454 reid_baseline.train INFO: normal accuracy 0.7657129984230683 1.911909580230713 
2022-04-26 15:49:19,270 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 15:49:19,270 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 191.2%
2022-04-26 15:50:28,748 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.065, Acc: 0.868, Base Lr: 7.21e-03
Aug Cl acc: 0.1778661326358193
2022-04-26 15:51:03,649 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.686[s] Speed: 23.3[samples/s]
2022-04-26 15:52:10,159 reid_baseline.train INFO: normal accuracy 0.7753998648344221 1.7876535654067993 
2022-04-26 15:52:11,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 15:52:11,156 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 178.8%
2022-04-26 15:53:19,998 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.974, Acc: 0.889, Base Lr: 4.01e-03
Aug Cl acc: 0.16645944745917068
2022-04-26 15:53:52,550 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.667[s] Speed: 24.0[samples/s]
2022-04-26 15:54:56,930 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.7501766681671143 
2022-04-26 15:54:57,730 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 15:54:57,730 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 175.0%
2022-04-26 15:56:08,691 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.938, Acc: 0.914, Base Lr: 3.38e-03
Aug Cl acc: 0.1737058539139597
2022-04-26 15:56:42,583 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.690[s] Speed: 23.2[samples/s]
2022-04-26 15:57:51,091 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.709525227546692 
2022-04-26 15:57:51,973 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 15:57:51,973 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 171.0%
2022-04-26 15:59:01,544 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.913, Acc: 0.911, Base Lr: 2.77e-03
Aug Cl acc: 0.19488588132356344
2022-04-26 15:59:33,984 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-26 16:00:39,874 reid_baseline.train INFO: normal accuracy 0.7830592475782834 1.7056844234466553 
2022-04-26 16:00:41,174 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 16:00:41,174 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 170.6%
2022-04-26 16:01:54,783 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.902, Acc: 0.914, Base Lr: 2.20e-03
Aug Cl acc: 0.177111826444927
2022-04-26 16:02:29,372 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.712[s] Speed: 22.5[samples/s]
2022-04-26 16:03:32,593 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.7082315683364868 
2022-04-26 16:03:32,597 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 16:03:32,598 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 170.8%
2022-04-26 16:04:40,056 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.879, Acc: 0.919, Base Lr: 1.66e-03
Aug Cl acc: 0.1778131033244886
2022-04-26 16:05:12,242 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.654[s] Speed: 24.5[samples/s]
2022-04-26 16:06:20,768 reid_baseline.train INFO: normal accuracy 0.7864383870241045 1.668291687965393 
2022-04-26 16:06:21,647 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 16:06:21,648 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 166.8%
2022-04-26 16:07:33,710 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.863, Acc: 0.931, Base Lr: 1.19e-03
Aug Cl acc: 0.17589485017876877
2022-04-26 16:08:09,668 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.711[s] Speed: 22.5[samples/s]
2022-04-26 16:09:15,442 reid_baseline.train INFO: normal accuracy 0.7859878350979951 1.6814967393875122 
2022-04-26 16:09:15,446 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 16:09:15,447 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 168.1%
2022-04-26 16:10:22,334 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.864, Acc: 0.922, Base Lr: 7.78e-04
Aug Cl acc: 0.1921699549022474
2022-04-26 16:10:55,182 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.656[s] Speed: 24.4[samples/s]
2022-04-26 16:12:03,927 reid_baseline.train INFO: normal accuracy 0.7864383870241045 1.5831186771392822 
2022-04-26 16:12:04,798 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 16:12:04,798 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 158.3%
2022-04-26 16:13:09,980 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.837, Acc: 0.932, Base Lr: 4.51e-04
Aug Cl acc: 0.17967255491959422
2022-04-26 16:13:43,268 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.648[s] Speed: 24.7[samples/s]
2022-04-26 16:14:50,895 reid_baseline.train INFO: normal accuracy 0.7868889389502141 1.6901744604110718 
2022-04-26 16:14:50,900 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 16:14:50,900 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 169.0%
2022-04-26 16:15:58,968 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.853, Acc: 0.930, Base Lr: 2.11e-04
Aug Cl acc: 0.18964882900840357
2022-04-26 16:16:30,845 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.657[s] Speed: 24.3[samples/s]
2022-04-26 16:17:35,864 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.6556209325790405 
2022-04-26 16:17:35,869 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 16:17:35,869 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 165.6%
2022-04-26 16:18:48,533 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.852, Acc: 0.919, Base Lr: 6.51e-05
Aug Cl acc: 0.19037939372815585
2022-04-26 16:19:21,262 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.693[s] Speed: 23.1[samples/s]
2022-04-26 16:20:25,625 reid_baseline.train INFO: normal accuracy 0.7871142149132687 1.6956149339675903 
2022-04-26 16:20:25,630 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 16:20:25,630 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 169.6%
2022-04-26 16:21:35,420 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.847, Acc: 0.922, Base Lr: 1.60e-05
Aug Cl acc: 0.19140415442617317
2022-04-26 16:22:09,885 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.685[s] Speed: 23.3[samples/s]
2022-04-26 16:23:18,020 reid_baseline.train INFO: normal accuracy 0.7866636629871593 1.6907155513763428 
2022-04-26 16:23:18,022 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 16:23:18,023 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 169.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-26 16:24:27,600 reid_baseline.train INFO: normal accuracy 0.7864383870241045 1.5831186771392822 
2022-04-26 16:24:27,601 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 16:24:27,601 reid_baseline.train INFO: Accuracy: 78.6%
2022-04-26 16:25:34,448 reid_baseline.train INFO: normal accuracy 0.7864383870241045 1.5831186771392822 
2022-04-26 16:25:34,448 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 16:25:34,448 reid_baseline.train INFO: Shuffled Accuracy: 78.6%
2022-04-26 16:26:15,560 reid_baseline.train INFO: normal accuracy 0.9723939019365472 0.7963618636131287 
2022-04-26 16:26:15,560 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 16:26:15,560 reid_baseline.train INFO: Source Clean Accuracy: 97.2%
2022-04-26 16:26:21,801 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2
2022-04-26 16:26:21,801 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-26 16:26:21,802 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 16:26:21,802 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 16:26:21,802 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 16:26:36,540 reid_baseline.train INFO: start training
2022-04-26 16:28:08,003 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.986, Acc: 0.295, Base Lr: 8.72e-04
Aug Cl acc: 0.15526122795908073
2022-04-26 16:28:42,926 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.794[s] Speed: 20.2[samples/s]
2022-04-26 16:30:47,326 reid_baseline.train INFO: normal accuracy 0.5914620151480376 4.1716814041137695 
2022-04-26 16:30:48,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 16:30:48,174 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 417.2%
2022-04-26 16:31:57,356 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.650, Acc: 0.592, Base Lr: 1.66e-03
Aug Cl acc: 0.166575783177426
2022-04-26 16:32:30,715 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.675[s] Speed: 23.7[samples/s]
2022-04-26 16:34:32,672 reid_baseline.train INFO: normal accuracy 0.6201514803764058 4.142411708831787 
2022-04-26 16:34:33,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 16:34:33,594 reid_baseline.train INFO: Accuracy: 62.0% Mean Entropy: 414.2%
2022-04-26 16:35:44,484 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.066, Acc: 0.629, Base Lr: 2.46e-03
Aug Cl acc: 0.1843660128744025
2022-04-26 16:36:16,932 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.679[s] Speed: 23.5[samples/s]
2022-04-26 16:38:23,031 reid_baseline.train INFO: normal accuracy 0.6330043607987147 3.8741374015808105 
2022-04-26 16:38:24,182 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 16:38:24,182 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 387.4%
2022-04-26 16:39:36,161 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.296, Acc: 0.656, Base Lr: 3.25e-03
Aug Cl acc: 0.167179032375938
2022-04-26 16:40:10,508 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.698[s] Speed: 22.9[samples/s]
2022-04-26 16:42:09,570 reid_baseline.train INFO: normal accuracy 0.6711039706219876 3.1577508449554443 
2022-04-26 16:42:10,445 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 16:42:10,446 reid_baseline.train INFO: Accuracy: 67.1% Mean Entropy: 315.8%
2022-04-26 16:43:19,666 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.781, Acc: 0.701, Base Lr: 4.04e-03
Aug Cl acc: 0.1614815686878405
2022-04-26 16:43:53,849 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.680[s] Speed: 23.5[samples/s]
2022-04-26 16:45:52,144 reid_baseline.train INFO: normal accuracy 0.7372044985081478 2.5058155059814453 
2022-04-26 16:45:52,951 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 16:45:52,951 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 250.6%
2022-04-26 16:47:02,832 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.466, Acc: 0.757, Base Lr: 4.83e-03
Aug Cl acc: 0.18459503274214895
2022-04-26 16:47:35,414 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.673[s] Speed: 23.8[samples/s]
2022-04-26 16:49:33,979 reid_baseline.train INFO: normal accuracy 0.7849437686481524 2.1195836067199707 
2022-04-26 16:49:34,950 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 16:49:34,950 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 212.0%
2022-04-26 16:50:47,505 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.311, Acc: 0.795, Base Lr: 5.62e-03
Aug Cl acc: 0.17802490686115466
2022-04-26 16:51:19,980 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.691[s] Speed: 23.2[samples/s]
2022-04-26 16:53:18,685 reid_baseline.train INFO: normal accuracy 0.8060592150562313 1.8396695852279663 
2022-04-26 16:53:19,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 16:53:19,668 reid_baseline.train INFO: Accuracy: 80.6% Mean Entropy: 184.0%
2022-04-26 16:54:25,622 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.120, Acc: 0.849, Base Lr: 6.42e-03
Aug Cl acc: 0.18385070248654015
2022-04-26 16:54:57,673 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.645[s] Speed: 24.8[samples/s]
2022-04-26 16:56:54,630 reid_baseline.train INFO: normal accuracy 0.8154693596511361 1.6518839597702026 
2022-04-26 16:56:55,430 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 16:56:55,430 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 165.2%
2022-04-26 16:58:04,323 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.064, Acc: 0.868, Base Lr: 7.21e-03
Aug Cl acc: 0.1778661326358193
2022-04-26 16:58:37,930 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.674[s] Speed: 23.7[samples/s]
2022-04-26 17:00:39,870 reid_baseline.train INFO: normal accuracy 0.8221253155841175 1.5254087448120117 
2022-04-26 17:00:40,831 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 17:00:40,832 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 152.5%
2022-04-26 17:01:51,672 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.974, Acc: 0.888, Base Lr: 4.01e-03
Aug Cl acc: 0.16645944745917068
2022-04-26 17:02:23,741 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.677[s] Speed: 23.6[samples/s]
2022-04-26 17:04:27,312 reid_baseline.train INFO: normal accuracy 0.8267156300206564 1.495608925819397 
2022-04-26 17:04:28,156 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 17:04:28,157 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 149.6%
2022-04-26 17:05:35,305 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.938, Acc: 0.913, Base Lr: 3.38e-03
Aug Cl acc: 0.17192405148556358
2022-04-26 17:06:09,202 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.665[s] Speed: 24.1[samples/s]
2022-04-26 17:08:10,701 reid_baseline.train INFO: normal accuracy 0.8299288501262336 1.4509979486465454 
2022-04-26 17:08:11,695 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 17:08:11,695 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 145.1%
2022-04-26 17:09:22,708 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.913, Acc: 0.910, Base Lr: 2.77e-03
Aug Cl acc: 0.19570824974461606
2022-04-26 17:09:56,911 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.690[s] Speed: 23.2[samples/s]
2022-04-26 17:11:56,179 reid_baseline.train INFO: normal accuracy 0.8303878815698875 1.4596608877182007 
2022-04-26 17:11:56,182 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 17:11:56,182 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 146.0%
2022-04-26 17:13:06,615 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.902, Acc: 0.914, Base Lr: 2.20e-03
Aug Cl acc: 0.17752301065545334
2022-04-26 17:13:41,458 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.691[s] Speed: 23.2[samples/s]
2022-04-26 17:15:45,115 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4703866243362427 
2022-04-26 17:15:45,120 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 17:15:45,120 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 147.0%
2022-04-26 17:16:53,435 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.879, Acc: 0.919, Base Lr: 1.66e-03
Aug Cl acc: 0.1778131033244886
2022-04-26 17:17:27,890 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.675[s] Speed: 23.7[samples/s]
2022-04-26 17:19:32,755 reid_baseline.train INFO: normal accuracy 0.8306173972917145 1.4424151182174683 
2022-04-26 17:19:33,707 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 17:19:33,707 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 144.2%
2022-04-26 17:20:42,574 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.863, Acc: 0.930, Base Lr: 1.19e-03
Aug Cl acc: 0.17589485017876877
2022-04-26 17:21:18,260 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.687[s] Speed: 23.3[samples/s]
2022-04-26 17:23:20,131 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4541481733322144 
2022-04-26 17:23:20,135 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 17:23:20,136 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.4%
2022-04-26 17:24:30,234 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.864, Acc: 0.922, Base Lr: 7.78e-04
Aug Cl acc: 0.19175877069172106
2022-04-26 17:25:03,740 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.681[s] Speed: 23.5[samples/s]
2022-04-26 17:27:03,841 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.363579511642456 
2022-04-26 17:27:04,674 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 17:27:04,674 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 136.4%
2022-04-26 17:28:10,872 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.837, Acc: 0.933, Base Lr: 4.51e-04
Aug Cl acc: 0.17953550188164963
2022-04-26 17:28:44,480 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.656[s] Speed: 24.4[samples/s]
2022-04-26 17:30:43,153 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4707111120224 
2022-04-26 17:30:43,157 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 17:30:43,158 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 147.1%
2022-04-26 17:31:54,068 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.853, Acc: 0.929, Base Lr: 2.11e-04
Aug Cl acc: 0.1900600132189299
2022-04-26 17:32:25,831 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.675[s] Speed: 23.7[samples/s]
2022-04-26 17:34:25,441 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4370317459106445 
2022-04-26 17:34:25,444 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 17:34:25,444 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 143.7%
2022-04-26 17:35:34,054 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.852, Acc: 0.919, Base Lr: 6.51e-05
Aug Cl acc: 0.19079057793868215
2022-04-26 17:36:08,062 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.675[s] Speed: 23.7[samples/s]
2022-04-26 17:38:15,466 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4709081649780273 
2022-04-26 17:38:15,468 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 17:38:15,468 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 147.1%
2022-04-26 17:39:24,085 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.847, Acc: 0.921, Base Lr: 1.60e-05
Aug Cl acc: 0.19140415442617317
2022-04-26 17:39:58,256 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.676[s] Speed: 23.7[samples/s]
2022-04-26 17:42:05,732 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4675512313842773 
2022-04-26 17:42:05,737 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 17:42:05,737 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-26 17:44:29,664 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.363579511642456 
2022-04-26 17:44:29,664 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 17:44:29,664 reid_baseline.train INFO: Accuracy: 83.7%
2022-04-26 17:46:45,225 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.363579511642456 
2022-04-26 17:46:45,225 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 17:46:45,225 reid_baseline.train INFO: Shuffled Accuracy: 83.7%
2022-04-26 17:47:29,691 reid_baseline.train INFO: normal accuracy 0.9723939019365472 0.7963349223136902 
2022-04-26 17:47:29,692 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 17:47:29,692 reid_baseline.train INFO: Source Clean Accuracy: 97.2%
2022-04-26 17:47:35,991 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3
2022-04-26 17:47:35,991 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-26 17:47:35,991 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 17:47:35,991 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 17:47:35,992 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 17:47:51,615 reid_baseline.train INFO: start training
2022-04-26 17:49:23,238 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.998, Acc: 0.269, Base Lr: 8.72e-04
Aug Cl acc: 0.173725730494449
2022-04-26 17:49:59,578 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.822[s] Speed: 19.5[samples/s]
2022-04-26 17:51:05,277 reid_baseline.train INFO: normal accuracy 0.38121420389461624 4.171881198883057 
2022-04-26 17:51:06,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 17:51:06,302 reid_baseline.train INFO: Accuracy: 38.1% Mean Entropy: 417.2%
2022-04-26 17:52:19,281 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.670, Acc: 0.578, Base Lr: 1.66e-03
Aug Cl acc: 0.1808184448041414
2022-04-26 17:52:56,756 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.726[s] Speed: 22.0[samples/s]
2022-04-26 17:53:58,369 reid_baseline.train INFO: normal accuracy 0.41924398625429554 4.1560282707214355 
2022-04-26 17:53:59,161 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 17:53:59,161 reid_baseline.train INFO: Accuracy: 41.9% Mean Entropy: 415.6%
2022-04-26 17:55:08,360 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.141, Acc: 0.614, Base Lr: 2.46e-03
Aug Cl acc: 0.186401881669697
2022-04-26 17:55:41,560 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.673[s] Speed: 23.8[samples/s]
2022-04-26 17:56:48,932 reid_baseline.train INFO: normal accuracy 0.43757159221076747 4.027157783508301 
2022-04-26 17:56:50,158 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 17:56:50,158 reid_baseline.train INFO: Accuracy: 43.8% Mean Entropy: 402.7%
2022-04-26 17:58:02,173 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.381, Acc: 0.642, Base Lr: 3.25e-03
Aug Cl acc: 0.170418802060579
2022-04-26 17:58:35,934 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.695[s] Speed: 23.0[samples/s]
2022-04-26 17:59:41,026 reid_baseline.train INFO: normal accuracy 0.4668957617411226 3.543734312057495 
2022-04-26 17:59:41,860 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 17:59:41,861 reid_baseline.train INFO: Accuracy: 46.7% Mean Entropy: 354.4%
2022-04-26 18:00:49,830 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.848, Acc: 0.688, Base Lr: 4.04e-03
Aug Cl acc: 0.1691628757276033
2022-04-26 18:01:23,232 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.667[s] Speed: 24.0[samples/s]
2022-04-26 18:02:28,197 reid_baseline.train INFO: normal accuracy 0.5337915234822451 3.068056583404541 
2022-04-26 18:02:29,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 18:02:29,065 reid_baseline.train INFO: Accuracy: 53.4% Mean Entropy: 306.8%
2022-04-26 18:03:37,255 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.532, Acc: 0.748, Base Lr: 4.83e-03
Aug Cl acc: 0.18060114509180972
2022-04-26 18:04:10,534 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.667[s] Speed: 24.0[samples/s]
2022-04-26 18:05:17,404 reid_baseline.train INFO: normal accuracy 0.5903780068728522 2.7066071033477783 
2022-04-26 18:05:18,636 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 18:05:18,637 reid_baseline.train INFO: Accuracy: 59.0% Mean Entropy: 270.7%
2022-04-26 18:06:28,417 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.355, Acc: 0.790, Base Lr: 5.62e-03
Aug Cl acc: 0.17122948797125565
2022-04-26 18:07:03,412 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.689[s] Speed: 23.2[samples/s]
2022-04-26 18:08:09,406 reid_baseline.train INFO: normal accuracy 0.5951890034364261 2.3847246170043945 
2022-04-26 18:08:10,298 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 18:08:10,298 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 238.5%
2022-04-26 18:09:17,769 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.166, Acc: 0.842, Base Lr: 6.42e-03
Aug Cl acc: 0.17606412736993088
2022-04-26 18:09:51,613 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.666[s] Speed: 24.0[samples/s]
2022-04-26 18:10:54,557 reid_baseline.train INFO: normal accuracy 0.6002290950744559 2.191415309906006 
2022-04-26 18:10:55,375 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 18:10:55,375 reid_baseline.train INFO: Accuracy: 60.0% Mean Entropy: 219.1%
2022-04-26 18:12:02,948 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.090, Acc: 0.863, Base Lr: 7.21e-03
Aug Cl acc: 0.16782093048095703
2022-04-26 18:12:34,594 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.653[s] Speed: 24.5[samples/s]
2022-04-26 18:13:40,738 reid_baseline.train INFO: normal accuracy 0.5945017182130584 2.0426747798919678 
2022-04-26 18:13:41,648 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 18:13:41,648 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 204.3%
2022-04-26 18:14:51,232 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.003, Acc: 0.887, Base Lr: 4.01e-03
Aug Cl acc: 0.1855510159542686
2022-04-26 18:15:25,005 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.680[s] Speed: 23.5[samples/s]
2022-04-26 18:16:31,473 reid_baseline.train INFO: normal accuracy 0.6080183276059564 1.9995946884155273 
2022-04-26 18:16:32,260 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 18:16:32,260 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 200.0%
2022-04-26 18:17:40,382 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.956, Acc: 0.900, Base Lr: 3.38e-03
Aug Cl acc: 0.1981429049843236
2022-04-26 18:18:14,468 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.672[s] Speed: 23.8[samples/s]
2022-04-26 18:19:21,309 reid_baseline.train INFO: normal accuracy 0.6112256586483391 1.9170842170715332 
2022-04-26 18:19:22,164 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 18:19:22,164 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 191.7%
2022-04-26 18:20:29,561 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.926, Acc: 0.909, Base Lr: 2.77e-03
Aug Cl acc: 0.19355598248933492
2022-04-26 18:21:01,960 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.657[s] Speed: 24.4[samples/s]
2022-04-26 18:22:09,208 reid_baseline.train INFO: normal accuracy 0.6192439862542956 1.9213676452636719 
2022-04-26 18:22:09,213 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 18:22:09,213 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 192.1%
2022-04-26 18:23:17,106 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.927, Acc: 0.902, Base Lr: 2.20e-03
Aug Cl acc: 0.18299903367695056
2022-04-26 18:23:52,207 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.678[s] Speed: 23.6[samples/s]
2022-04-26 18:24:56,527 reid_baseline.train INFO: normal accuracy 0.6148911798396335 1.9474663734436035 
2022-04-26 18:24:56,532 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 18:24:56,532 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 194.7%
2022-04-26 18:26:02,388 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.902, Acc: 0.910, Base Lr: 1.66e-03
Aug Cl acc: 0.1921667550739489
2022-04-26 18:26:37,098 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.662[s] Speed: 24.2[samples/s]
2022-04-26 18:27:43,232 reid_baseline.train INFO: normal accuracy 0.6176403207331043 1.9061905145645142 
2022-04-26 18:27:44,188 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 18:27:44,188 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 190.6%
2022-04-26 18:28:51,335 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.900, Acc: 0.918, Base Lr: 1.19e-03
Aug Cl acc: 0.17575887629860326
2022-04-26 18:29:25,265 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.665[s] Speed: 24.1[samples/s]
2022-04-26 18:30:29,242 reid_baseline.train INFO: normal accuracy 0.6210767468499427 1.8980860710144043 
2022-04-26 18:30:30,113 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 18:30:30,113 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 189.8%
2022-04-26 18:31:36,679 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.896, Acc: 0.911, Base Lr: 7.78e-04
Aug Cl acc: 0.18595405628806666
2022-04-26 18:32:10,145 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.657[s] Speed: 24.3[samples/s]
2022-04-26 18:33:15,524 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.8081308603286743 
2022-04-26 18:33:16,320 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 18:33:16,320 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 180.8%
2022-04-26 18:34:24,495 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.863, Acc: 0.926, Base Lr: 4.51e-04
Aug Cl acc: 0.1782234216991224
2022-04-26 18:34:57,926 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.668[s] Speed: 23.9[samples/s]
2022-04-26 18:36:03,368 reid_baseline.train INFO: normal accuracy 0.622680412371134 1.9075342416763306 
2022-04-26 18:36:03,372 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 18:36:03,373 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 190.8%
2022-04-26 18:37:11,683 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.889, Acc: 0.925, Base Lr: 2.11e-04
Aug Cl acc: 0.17954186389320775
2022-04-26 18:37:44,168 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.662[s] Speed: 24.2[samples/s]
2022-04-26 18:38:47,341 reid_baseline.train INFO: normal accuracy 0.6197021764032073 1.8764636516571045 
2022-04-26 18:38:47,346 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 18:38:47,346 reid_baseline.train INFO: Accuracy: 62.0% Mean Entropy: 187.6%
2022-04-26 18:39:57,822 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.879, Acc: 0.911, Base Lr: 6.51e-05
Aug Cl acc: 0.17657433058086194
2022-04-26 18:40:31,887 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.688[s] Speed: 23.3[samples/s]
2022-04-26 18:41:35,854 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.905480146408081 
2022-04-26 18:41:35,856 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 18:41:35,856 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 190.5%
2022-04-26 18:42:43,644 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.872, Acc: 0.918, Base Lr: 1.60e-05
Aug Cl acc: 0.17837654916863693
2022-04-26 18:43:16,056 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.659[s] Speed: 24.3[samples/s]
2022-04-26 18:44:24,375 reid_baseline.train INFO: normal accuracy 0.6219931271477663 1.8975701332092285 
2022-04-26 18:44:24,380 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 18:44:24,380 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 189.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-26 18:45:29,311 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.8081308603286743 
2022-04-26 18:45:29,312 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 18:45:29,312 reid_baseline.train INFO: Accuracy: 62.1%
2022-04-26 18:46:35,173 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.8081308603286743 
2022-04-26 18:46:35,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 18:46:35,173 reid_baseline.train INFO: Shuffled Accuracy: 62.1%
2022-04-26 18:47:16,870 reid_baseline.train INFO: normal accuracy 0.9662134322208488 0.8228999376296997 
2022-04-26 18:47:16,870 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 18:47:16,870 reid_baseline.train INFO: Source Clean Accuracy: 96.6%
2022-04-26 18:47:23,030 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3
2022-04-26 18:47:23,030 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-26 18:47:23,030 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 18:47:23,030 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 18:47:23,030 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 18:47:37,096 reid_baseline.train INFO: start training
2022-04-26 18:49:02,640 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.998, Acc: 0.270, Base Lr: 8.72e-04
Aug Cl acc: 0.173725730494449
2022-04-26 18:49:39,738 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.797[s] Speed: 20.1[samples/s]
2022-04-26 18:50:44,666 reid_baseline.train INFO: normal accuracy 0.4987609822031989 4.1721038818359375 
2022-04-26 18:50:45,741 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 18:50:45,741 reid_baseline.train INFO: Accuracy: 49.9% Mean Entropy: 417.2%
2022-04-26 18:51:54,432 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.670, Acc: 0.579, Base Lr: 1.66e-03
Aug Cl acc: 0.18122962901466771
2022-04-26 18:52:29,036 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.680[s] Speed: 23.5[samples/s]
2022-04-26 18:53:34,552 reid_baseline.train INFO: normal accuracy 0.5393106555530525 4.155222415924072 
2022-04-26 18:53:35,391 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 18:53:35,391 reid_baseline.train INFO: Accuracy: 53.9% Mean Entropy: 415.5%
2022-04-26 18:54:46,422 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.141, Acc: 0.613, Base Lr: 2.46e-03
Aug Cl acc: 0.186401881669697
2022-04-26 18:55:19,710 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.686[s] Speed: 23.3[samples/s]
2022-04-26 18:56:25,825 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.013247013092041 
2022-04-26 18:56:27,047 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 18:56:27,048 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 401.3%
2022-04-26 18:57:37,880 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.381, Acc: 0.642, Base Lr: 3.25e-03
Aug Cl acc: 0.16959643363952637
2022-04-26 18:58:13,123 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.698[s] Speed: 22.9[samples/s]
2022-04-26 18:59:18,268 reid_baseline.train INFO: normal accuracy 0.5744537057895922 3.4868810176849365 
2022-04-26 18:59:19,310 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 18:59:19,310 reid_baseline.train INFO: Accuracy: 57.4% Mean Entropy: 348.7%
2022-04-26 19:00:29,053 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.848, Acc: 0.688, Base Lr: 4.04e-03
Aug Cl acc: 0.16957405993812963
2022-04-26 19:01:04,408 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.691[s] Speed: 23.2[samples/s]
2022-04-26 19:02:08,750 reid_baseline.train INFO: normal accuracy 0.6487947735976571 2.894878387451172 
2022-04-26 19:02:09,652 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 19:02:09,652 reid_baseline.train INFO: Accuracy: 64.9% Mean Entropy: 289.5%
2022-04-26 19:03:19,960 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.532, Acc: 0.747, Base Lr: 4.83e-03
Aug Cl acc: 0.18060114509180972
2022-04-26 19:03:53,867 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.685[s] Speed: 23.4[samples/s]
2022-04-26 19:05:01,114 reid_baseline.train INFO: normal accuracy 0.7175039423293534 2.4957215785980225 
2022-04-26 19:05:02,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 19:05:02,191 reid_baseline.train INFO: Accuracy: 71.8% Mean Entropy: 249.6%
2022-04-26 19:06:09,399 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.355, Acc: 0.790, Base Lr: 5.62e-03
Aug Cl acc: 0.17040711955020302
2022-04-26 19:06:42,564 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.660[s] Speed: 24.2[samples/s]
2022-04-26 19:07:47,831 reid_baseline.train INFO: normal accuracy 0.7434106780806488 2.1394577026367188 
2022-04-26 19:07:48,861 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 19:07:48,862 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 213.9%
2022-04-26 19:08:58,251 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.166, Acc: 0.842, Base Lr: 6.42e-03
Aug Cl acc: 0.1768864957909835
2022-04-26 19:09:30,767 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-26 19:10:36,885 reid_baseline.train INFO: normal accuracy 0.7576030637530975 1.9552329778671265 
2022-04-26 19:10:37,730 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 19:10:37,730 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 195.5%
2022-04-26 19:11:47,950 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.090, Acc: 0.863, Base Lr: 7.21e-03
Aug Cl acc: 0.16763403541163394
2022-04-26 19:12:22,609 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.690[s] Speed: 23.2[samples/s]
2022-04-26 19:13:28,113 reid_baseline.train INFO: normal accuracy 0.7677404820905609 1.8097482919692993 
2022-04-26 19:13:29,120 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 19:13:29,121 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 181.0%
2022-04-26 19:14:38,421 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.003, Acc: 0.888, Base Lr: 4.01e-03
Aug Cl acc: 0.18523472233822472
2022-04-26 19:15:09,977 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.663[s] Speed: 24.1[samples/s]
2022-04-26 19:16:15,301 reid_baseline.train INFO: normal accuracy 0.7697679657580536 1.7889105081558228 
2022-04-26 19:16:16,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 19:16:16,123 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 178.9%
2022-04-26 19:17:27,306 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.956, Acc: 0.900, Base Lr: 3.38e-03
Aug Cl acc: 0.1981429049843236
2022-04-26 19:17:59,331 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.679[s] Speed: 23.6[samples/s]
2022-04-26 19:19:05,908 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.7119084596633911 
2022-04-26 19:19:06,778 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 19:19:06,778 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 171.2%
2022-04-26 19:20:15,594 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.926, Acc: 0.909, Base Lr: 2.77e-03
Aug Cl acc: 0.19320353708769145
2022-04-26 19:20:49,557 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.676[s] Speed: 23.7[samples/s]
2022-04-26 19:21:56,379 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.7014062404632568 
2022-04-26 19:21:57,627 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 19:21:57,627 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 170.1%
2022-04-26 19:23:08,956 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.927, Acc: 0.901, Base Lr: 2.20e-03
Aug Cl acc: 0.18217666525589793
2022-04-26 19:23:40,590 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.677[s] Speed: 23.6[samples/s]
2022-04-26 19:24:45,244 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.7442457675933838 
2022-04-26 19:24:45,248 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 19:24:45,249 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 174.4%
2022-04-26 19:25:52,687 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.902, Acc: 0.910, Base Lr: 1.66e-03
Aug Cl acc: 0.1921667550739489
2022-04-26 19:26:28,513 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.678[s] Speed: 23.6[samples/s]
2022-04-26 19:27:36,031 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.688421368598938 
2022-04-26 19:27:36,999 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 19:27:36,999 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 168.8%
2022-04-26 19:28:46,487 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.900, Acc: 0.918, Base Lr: 1.19e-03
Aug Cl acc: 0.17534769208807693
2022-04-26 19:29:22,147 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.691[s] Speed: 23.2[samples/s]
2022-04-26 19:30:27,639 reid_baseline.train INFO: normal accuracy 0.780806487947736 1.6990152597427368 
2022-04-26 19:30:27,644 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 19:30:27,644 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 169.9%
2022-04-26 19:31:39,408 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.896, Acc: 0.912, Base Lr: 7.78e-04
Aug Cl acc: 0.18623708423815274
2022-04-26 19:32:12,902 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.692[s] Speed: 23.1[samples/s]
2022-04-26 19:33:13,971 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6015615463256836 
2022-04-26 19:33:14,767 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 19:33:14,768 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 160.2%
2022-04-26 19:34:23,167 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.863, Acc: 0.926, Base Lr: 4.51e-04
Aug Cl acc: 0.17904579012017502
2022-04-26 19:34:56,752 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.671[s] Speed: 23.8[samples/s]
2022-04-26 19:36:02,392 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6931208372116089 
2022-04-26 19:36:02,397 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 19:36:02,397 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 169.3%
2022-04-26 19:37:15,393 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.889, Acc: 0.924, Base Lr: 2.11e-04
Aug Cl acc: 0.17913067968268143
2022-04-26 19:37:48,989 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.700[s] Speed: 22.8[samples/s]
2022-04-26 19:38:57,562 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.6693905591964722 
2022-04-26 19:38:57,567 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 19:38:57,567 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 166.9%
2022-04-26 19:40:07,785 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.879, Acc: 0.911, Base Lr: 6.51e-05
Aug Cl acc: 0.17616314637033562
2022-04-26 19:40:40,766 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.679[s] Speed: 23.6[samples/s]
2022-04-26 19:41:46,857 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.7037297487258911 
2022-04-26 19:41:46,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 19:41:46,860 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 170.4%
2022-04-26 19:42:54,299 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.872, Acc: 0.919, Base Lr: 1.60e-05
Aug Cl acc: 0.17933598317598043
2022-04-26 19:43:28,263 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.667[s] Speed: 24.0[samples/s]
2022-04-26 19:44:36,228 reid_baseline.train INFO: normal accuracy 0.779004280243298 1.6960294246673584 
2022-04-26 19:44:36,232 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 19:44:36,233 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 169.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-26 19:45:44,741 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6015615463256836 
2022-04-26 19:45:44,742 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 19:45:44,742 reid_baseline.train INFO: Accuracy: 77.9%
2022-04-26 19:46:50,671 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6015615463256836 
2022-04-26 19:46:50,671 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 19:46:50,671 reid_baseline.train INFO: Shuffled Accuracy: 77.9%
2022-04-26 19:47:32,014 reid_baseline.train INFO: normal accuracy 0.9662134322208488 0.8229243159294128 
2022-04-26 19:47:32,014 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 19:47:32,014 reid_baseline.train INFO: Source Clean Accuracy: 96.6%
2022-04-26 19:47:37,865 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3
2022-04-26 19:47:37,866 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-26 19:47:37,866 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 19:47:37,866 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 19:47:37,866 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 19:47:52,012 reid_baseline.train INFO: start training
2022-04-26 19:49:29,758 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.998, Acc: 0.269, Base Lr: 8.72e-04
Aug Cl acc: 0.173725730494449
2022-04-26 19:50:05,341 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.836[s] Speed: 19.1[samples/s]
2022-04-26 19:52:08,517 reid_baseline.train INFO: normal accuracy 0.5747073674546707 4.171863555908203 
2022-04-26 19:52:09,523 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 19:52:09,523 reid_baseline.train INFO: Accuracy: 57.5% Mean Entropy: 417.2%
2022-04-26 19:53:20,364 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.670, Acc: 0.580, Base Lr: 1.66e-03
Aug Cl acc: 0.1804072605936151
2022-04-26 19:53:56,571 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.703[s] Speed: 22.7[samples/s]
2022-04-26 19:56:06,898 reid_baseline.train INFO: normal accuracy 0.6089052100068855 4.147670745849609 
2022-04-26 19:56:07,780 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 19:56:07,780 reid_baseline.train INFO: Accuracy: 60.9% Mean Entropy: 414.8%
2022-04-26 19:57:15,802 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.141, Acc: 0.613, Base Lr: 2.46e-03
Aug Cl acc: 0.186401881669697
2022-04-26 19:57:49,511 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.669[s] Speed: 23.9[samples/s]
2022-04-26 20:00:00,342 reid_baseline.train INFO: normal accuracy 0.6224466375946752 3.9273760318756104 
2022-04-26 20:00:01,349 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 20:00:01,349 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 392.7%
2022-04-26 20:01:17,081 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.381, Acc: 0.642, Base Lr: 3.25e-03
Aug Cl acc: 0.170418802060579
2022-04-26 20:01:50,924 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.720[s] Speed: 22.2[samples/s]
2022-04-26 20:03:48,347 reid_baseline.train INFO: normal accuracy 0.6623823731925637 3.231323003768921 
2022-04-26 20:03:49,390 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 20:03:49,390 reid_baseline.train INFO: Accuracy: 66.2% Mean Entropy: 323.1%
2022-04-26 20:04:56,892 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.848, Acc: 0.689, Base Lr: 4.04e-03
Aug Cl acc: 0.1691628757276033
2022-04-26 20:05:34,278 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.690[s] Speed: 23.2[samples/s]
2022-04-26 20:07:44,908 reid_baseline.train INFO: normal accuracy 0.7245811338076659 2.576695442199707 
2022-04-26 20:07:45,862 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 20:07:45,863 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 257.7%
2022-04-26 20:08:57,087 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.532, Acc: 0.748, Base Lr: 4.83e-03
Aug Cl acc: 0.18060114509180972
2022-04-26 20:09:29,572 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.682[s] Speed: 23.5[samples/s]
2022-04-26 20:11:39,068 reid_baseline.train INFO: normal accuracy 0.7736974982786321 2.1721975803375244 
2022-04-26 20:11:40,328 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 20:11:40,328 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 217.2%
2022-04-26 20:12:54,840 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.355, Acc: 0.789, Base Lr: 5.62e-03
Aug Cl acc: 0.17122948797125565
2022-04-26 20:13:27,884 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.707[s] Speed: 22.6[samples/s]
2022-04-26 20:15:25,257 reid_baseline.train INFO: normal accuracy 0.7977966490704613 1.8694661855697632 
2022-04-26 20:15:26,145 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 20:15:26,145 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 186.9%
2022-04-26 20:16:33,516 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.166, Acc: 0.841, Base Lr: 6.42e-03
Aug Cl acc: 0.17647529903211093
2022-04-26 20:17:08,532 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.674[s] Speed: 23.8[samples/s]
2022-04-26 20:19:15,913 reid_baseline.train INFO: normal accuracy 0.8056001836125775 1.7030738592147827 
2022-04-26 20:19:16,699 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 20:19:16,700 reid_baseline.train INFO: Accuracy: 80.6% Mean Entropy: 170.3%
2022-04-26 20:20:24,189 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.090, Acc: 0.865, Base Lr: 7.21e-03
Aug Cl acc: 0.16823211469148336
2022-04-26 20:20:57,593 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.664[s] Speed: 24.1[samples/s]
2022-04-26 20:22:58,335 reid_baseline.train INFO: normal accuracy 0.8150103282074822 1.5547856092453003 
2022-04-26 20:22:59,608 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 20:22:59,608 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 155.5%
2022-04-26 20:24:13,253 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.003, Acc: 0.887, Base Lr: 4.01e-03
Aug Cl acc: 0.18349509490163704
2022-04-26 20:24:47,623 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.710[s] Speed: 22.5[samples/s]
2022-04-26 20:26:52,203 reid_baseline.train INFO: normal accuracy 0.8218957998622906 1.5233302116394043 
2022-04-26 20:26:53,076 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 20:26:53,077 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 152.3%
2022-04-26 20:27:58,176 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.956, Acc: 0.900, Base Lr: 3.38e-03
Aug Cl acc: 0.19773172077379728
2022-04-26 20:28:34,780 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.669[s] Speed: 23.9[samples/s]
2022-04-26 20:30:47,043 reid_baseline.train INFO: normal accuracy 0.8278632086297911 1.4487565755844116 
2022-04-26 20:30:47,988 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 20:30:47,988 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 144.9%
2022-04-26 20:31:55,893 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.926, Acc: 0.909, Base Lr: 2.77e-03
Aug Cl acc: 0.1940259055087441
2022-04-26 20:32:28,270 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.659[s] Speed: 24.3[samples/s]
2022-04-26 20:34:32,377 reid_baseline.train INFO: normal accuracy 0.824420472802387 1.457440972328186 
2022-04-26 20:34:32,382 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 20:34:32,382 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 145.7%
2022-04-26 20:35:46,080 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.927, Acc: 0.901, Base Lr: 2.20e-03
Aug Cl acc: 0.18299903367695056
2022-04-26 20:36:20,479 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.711[s] Speed: 22.5[samples/s]
2022-04-26 20:38:21,921 reid_baseline.train INFO: normal accuracy 0.828551755795272 1.4941627979278564 
2022-04-26 20:38:21,923 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 20:38:21,923 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 149.4%
2022-04-26 20:39:30,045 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.902, Acc: 0.910, Base Lr: 1.66e-03
Aug Cl acc: 0.1921667550739489
2022-04-26 20:40:02,769 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.663[s] Speed: 24.1[samples/s]
2022-04-26 20:42:19,558 reid_baseline.train INFO: normal accuracy 0.8255680514115217 1.4545297622680664 
2022-04-26 20:42:19,562 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 20:42:19,563 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 145.5%
2022-04-26 20:43:28,721 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.900, Acc: 0.918, Base Lr: 1.19e-03
Aug Cl acc: 0.17575887629860326
2022-04-26 20:44:02,275 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.676[s] Speed: 23.7[samples/s]
2022-04-26 20:46:17,659 reid_baseline.train INFO: normal accuracy 0.8287812715170989 1.4635382890701294 
2022-04-26 20:46:17,663 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 20:46:17,664 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 146.4%
2022-04-26 20:47:26,727 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.896, Acc: 0.911, Base Lr: 7.78e-04
Aug Cl acc: 0.186365240498593
2022-04-26 20:48:00,087 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.673[s] Speed: 23.8[samples/s]
2022-04-26 20:50:00,821 reid_baseline.train INFO: normal accuracy 0.8310764287353684 1.3758858442306519 
2022-04-26 20:50:02,127 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 20:50:02,127 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 137.6%
2022-04-26 20:51:16,348 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.863, Acc: 0.925, Base Lr: 4.51e-04
Aug Cl acc: 0.1786346059096487
2022-04-26 20:51:51,267 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.718[s] Speed: 22.3[samples/s]
2022-04-26 20:53:53,555 reid_baseline.train INFO: normal accuracy 0.8264861142988295 1.4698766469955444 
2022-04-26 20:53:53,559 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 20:53:53,560 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 147.0%
2022-04-26 20:55:00,673 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.889, Acc: 0.925, Base Lr: 2.11e-04
Aug Cl acc: 0.17913067968268143
2022-04-26 20:55:35,387 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-26 20:57:48,269 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.4454923868179321 
2022-04-26 20:57:48,273 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 20:57:48,274 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 144.5%
2022-04-26 20:58:56,482 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.879, Acc: 0.911, Base Lr: 6.51e-05
Aug Cl acc: 0.17616314637033562
2022-04-26 20:59:31,192 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.677[s] Speed: 23.6[samples/s]
2022-04-26 21:01:46,683 reid_baseline.train INFO: normal accuracy 0.828322240073445 1.475900411605835 
2022-04-26 21:01:46,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 21:01:46,688 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 147.6%
2022-04-26 21:02:55,967 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.872, Acc: 0.918, Base Lr: 1.60e-05
Aug Cl acc: 0.17837654916863693
2022-04-26 21:03:29,610 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.676[s] Speed: 23.7[samples/s]
2022-04-26 21:05:32,629 reid_baseline.train INFO: normal accuracy 0.8294698186825797 1.4680105447769165 
2022-04-26 21:05:32,633 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 21:05:32,633 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 146.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-26 21:07:43,642 reid_baseline.train INFO: normal accuracy 0.8310764287353684 1.3758858442306519 
2022-04-26 21:07:43,643 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 21:07:43,643 reid_baseline.train INFO: Accuracy: 83.1%
2022-04-26 21:09:38,726 reid_baseline.train INFO: normal accuracy 0.8310764287353684 1.3758858442306519 
2022-04-26 21:09:38,726 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 21:09:38,726 reid_baseline.train INFO: Shuffled Accuracy: 83.1%
2022-04-26 21:10:21,680 reid_baseline.train INFO: normal accuracy 0.9662134322208488 0.8227818608283997 
2022-04-26 21:10:21,680 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 21:10:21,680 reid_baseline.train INFO: Source Clean Accuracy: 96.6%
2022-04-26 21:10:28,927 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4
2022-04-26 21:10:28,927 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-26 21:10:28,927 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 21:10:28,927 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 21:10:28,928 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 21:10:48,705 reid_baseline.train INFO: start training
2022-04-26 21:12:22,708 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.047, Acc: 0.247, Base Lr: 8.72e-04
Aug Cl acc: 0.17107853136564555
2022-04-26 21:12:55,441 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.793[s] Speed: 20.2[samples/s]
2022-04-26 21:13:57,544 reid_baseline.train INFO: normal accuracy 0.3660939289805269 4.1721673011779785 
2022-04-26 21:13:58,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 21:13:58,365 reid_baseline.train INFO: Accuracy: 36.6% Mean Entropy: 417.2%
2022-04-26 21:15:08,883 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.701, Acc: 0.558, Base Lr: 1.66e-03
Aug Cl acc: 0.18190618565208033
2022-04-26 21:15:42,889 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.688[s] Speed: 23.3[samples/s]
2022-04-26 21:16:50,660 reid_baseline.train INFO: normal accuracy 0.3970217640320733 4.159658432006836 
2022-04-26 21:16:51,493 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 21:16:51,493 reid_baseline.train INFO: Accuracy: 39.7% Mean Entropy: 416.0%
2022-04-26 21:17:59,936 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.233, Acc: 0.601, Base Lr: 2.46e-03
Aug Cl acc: 0.18015807553341515
2022-04-26 21:18:34,924 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.678[s] Speed: 23.6[samples/s]
2022-04-26 21:19:39,685 reid_baseline.train INFO: normal accuracy 0.4215349369988545 4.051730155944824 
2022-04-26 21:19:40,776 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 21:19:40,776 reid_baseline.train INFO: Accuracy: 42.2% Mean Entropy: 405.2%
2022-04-26 21:20:54,480 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.478, Acc: 0.629, Base Lr: 3.25e-03
Aug Cl acc: 0.18919964840537623
2022-04-26 21:21:29,017 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.711[s] Speed: 22.5[samples/s]
2022-04-26 21:22:14,338 reid_baseline.train INFO: normal accuracy 0.44650630011454756 3.602224826812744 
2022-04-26 21:22:15,154 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 21:22:15,154 reid_baseline.train INFO: Accuracy: 44.7% Mean Entropy: 360.2%
2022-04-26 21:22:42,813 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.925, Acc: 0.673, Base Lr: 4.04e-03
Aug Cl acc: 0.1675412152942858
2022-04-26 21:22:54,618 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.259[s] Speed: 61.9[samples/s]
2022-04-26 21:23:29,949 reid_baseline.train INFO: normal accuracy 0.5138602520045819 3.1240196228027344 
2022-04-26 21:23:30,714 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 21:23:30,715 reid_baseline.train INFO: Accuracy: 51.4% Mean Entropy: 312.4%
2022-04-26 21:23:55,631 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.590, Acc: 0.736, Base Lr: 4.83e-03
Aug Cl acc: 0.18683886528015137
2022-04-26 21:24:06,807 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.235[s] Speed: 68.0[samples/s]
2022-04-26 21:24:41,818 reid_baseline.train INFO: normal accuracy 0.5693012600229095 2.8069374561309814 
2022-04-26 21:24:42,596 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 21:24:42,597 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 280.7%
2022-04-26 21:25:07,991 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.420, Acc: 0.776, Base Lr: 5.62e-03
Aug Cl acc: 0.16549717752557053
2022-04-26 21:25:19,355 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.242[s] Speed: 66.2[samples/s]
2022-04-26 21:25:53,637 reid_baseline.train INFO: normal accuracy 0.581901489117984 2.471834897994995 
2022-04-26 21:25:54,418 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 21:25:54,419 reid_baseline.train INFO: Accuracy: 58.2% Mean Entropy: 247.2%
2022-04-26 21:26:18,711 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.214, Acc: 0.831, Base Lr: 6.42e-03
Aug Cl acc: 0.17685010558680483
2022-04-26 21:26:30,196 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.235[s] Speed: 68.1[samples/s]
2022-04-26 21:27:06,468 reid_baseline.train INFO: normal accuracy 0.5928980526918671 2.2385611534118652 
2022-04-26 21:27:07,244 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 21:27:07,245 reid_baseline.train INFO: Accuracy: 59.3% Mean Entropy: 223.9%
2022-04-26 21:27:32,545 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.141, Acc: 0.848, Base Lr: 7.21e-03
Aug Cl acc: 0.1614787453099301
2022-04-26 21:27:43,912 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.240[s] Speed: 66.6[samples/s]
2022-04-26 21:28:17,596 reid_baseline.train INFO: normal accuracy 0.5940435280641466 2.080697774887085 
2022-04-26 21:28:18,369 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 21:28:18,369 reid_baseline.train INFO: Accuracy: 59.4% Mean Entropy: 208.1%
2022-04-26 21:28:44,259 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.053, Acc: 0.877, Base Lr: 4.01e-03
Aug Cl acc: 0.16254859221609017
2022-04-26 21:28:56,002 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.247[s] Speed: 64.7[samples/s]
2022-04-26 21:29:33,151 reid_baseline.train INFO: normal accuracy 0.6038946162657503 2.0350327491760254 
2022-04-26 21:29:33,931 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 21:29:33,931 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 203.5%
2022-04-26 21:29:58,183 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.003, Acc: 0.898, Base Lr: 3.38e-03
Aug Cl acc: 0.18298036173770302
2022-04-26 21:30:09,395 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.233[s] Speed: 68.6[samples/s]
2022-04-26 21:30:45,034 reid_baseline.train INFO: normal accuracy 0.6073310423825887 1.94779634475708 
2022-04-26 21:30:45,818 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 21:30:45,819 reid_baseline.train INFO: Accuracy: 60.7% Mean Entropy: 194.8%
2022-04-26 21:31:11,096 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.971, Acc: 0.902, Base Lr: 2.77e-03
Aug Cl acc: 0.17999193542882017
2022-04-26 21:31:22,954 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.244[s] Speed: 65.5[samples/s]
2022-04-26 21:31:57,487 reid_baseline.train INFO: normal accuracy 0.6077892325315005 1.9345455169677734 
2022-04-26 21:31:58,223 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 21:31:58,223 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 193.5%
2022-04-26 21:32:22,812 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.961, Acc: 0.888, Base Lr: 2.20e-03
Aug Cl acc: 0.17421069898103414
2022-04-26 21:32:35,069 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.242[s] Speed: 66.0[samples/s]
2022-04-26 21:33:10,936 reid_baseline.train INFO: normal accuracy 0.6098510882016037 1.9820117950439453 
2022-04-26 21:33:10,936 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 21:33:10,937 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 198.2%
2022-04-26 21:33:35,937 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.926, Acc: 0.902, Base Lr: 1.66e-03
Aug Cl acc: 0.1827415667082134
2022-04-26 21:33:47,690 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.241[s] Speed: 66.5[samples/s]
2022-04-26 21:34:22,276 reid_baseline.train INFO: normal accuracy 0.6107674684994273 1.9308699369430542 
2022-04-26 21:34:23,074 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 21:34:23,074 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 193.1%
2022-04-26 21:34:47,914 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.926, Acc: 0.917, Base Lr: 1.19e-03
Aug Cl acc: 0.18948460880078768
2022-04-26 21:35:00,536 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.246[s] Speed: 65.1[samples/s]
2022-04-26 21:35:34,974 reid_baseline.train INFO: normal accuracy 0.6148911798396335 1.9373953342437744 
2022-04-26 21:35:34,975 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 21:35:34,975 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 193.7%
2022-04-26 21:35:59,187 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.918, Acc: 0.914, Base Lr: 7.78e-04
Aug Cl acc: 0.19304421073512026
2022-04-26 21:36:10,445 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.233[s] Speed: 68.6[samples/s]
2022-04-26 21:36:45,639 reid_baseline.train INFO: normal accuracy 0.6171821305841925 1.8282591104507446 
2022-04-26 21:36:46,433 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 21:36:46,433 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 182.8%
2022-04-26 21:37:11,886 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.899, Acc: 0.921, Base Lr: 4.51e-04
Aug Cl acc: 0.18808797786110326
2022-04-26 21:37:23,445 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.243[s] Speed: 65.8[samples/s]
2022-04-26 21:37:58,589 reid_baseline.train INFO: normal accuracy 0.6190148911798397 1.929013729095459 
2022-04-26 21:37:58,590 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 21:37:58,590 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 192.9%
2022-04-26 21:38:22,409 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.910, Acc: 0.914, Base Lr: 2.11e-04
Aug Cl acc: 0.18854262954310366
2022-04-26 21:38:33,564 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.230[s] Speed: 69.5[samples/s]
2022-04-26 21:39:08,464 reid_baseline.train INFO: normal accuracy 0.620389461626575 1.875148892402649 
2022-04-26 21:39:08,464 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 21:39:08,464 reid_baseline.train INFO: Accuracy: 62.0% Mean Entropy: 187.5%
2022-04-26 21:39:33,670 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.897, Acc: 0.915, Base Lr: 6.51e-05
Aug Cl acc: 0.19077961068404348
2022-04-26 21:39:45,415 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.242[s] Speed: 66.1[samples/s]
2022-04-26 21:40:19,417 reid_baseline.train INFO: normal accuracy 0.6176403207331043 1.9082492589950562 
2022-04-26 21:40:19,418 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 21:40:19,418 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 190.8%
2022-04-26 21:40:44,287 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.910, Acc: 0.913, Base Lr: 1.60e-05
Aug Cl acc: 0.18611217799939608
2022-04-26 21:40:55,682 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.238[s] Speed: 67.2[samples/s]
2022-04-26 21:41:30,914 reid_baseline.train INFO: normal accuracy 0.6190148911798397 1.9018851518630981 
2022-04-26 21:41:30,915 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 21:41:30,915 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 190.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-26 21:42:05,437 reid_baseline.train INFO: normal accuracy 0.6171821305841925 1.8282591104507446 
2022-04-26 21:42:05,438 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 21:42:05,438 reid_baseline.train INFO: Accuracy: 61.7%
2022-04-26 21:42:41,256 reid_baseline.train INFO: normal accuracy 0.6171821305841925 1.8282591104507446 
2022-04-26 21:42:41,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 21:42:41,256 reid_baseline.train INFO: Shuffled Accuracy: 61.7%
2022-04-26 21:43:10,108 reid_baseline.train INFO: normal accuracy 0.9645653069633292 0.8665198683738708 
2022-04-26 21:43:10,108 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 21:43:10,108 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-26 21:43:15,721 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4
2022-04-26 21:43:15,721 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-26 21:43:15,721 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 21:43:15,721 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 21:43:15,722 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 21:43:26,179 reid_baseline.train INFO: start training
2022-04-26 21:43:58,791 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.047, Acc: 0.247, Base Lr: 8.72e-04
Aug Cl acc: 0.17107853136564555
2022-04-26 21:44:11,598 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-26 21:44:47,510 reid_baseline.train INFO: normal accuracy 0.48772246001351655 4.172343730926514 
2022-04-26 21:44:48,345 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 21:44:48,346 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 417.2%
2022-04-26 21:45:14,023 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.701, Acc: 0.558, Base Lr: 1.66e-03
Aug Cl acc: 0.18231736986260666
2022-04-26 21:45:25,598 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.244[s] Speed: 65.5[samples/s]
2022-04-26 21:46:00,481 reid_baseline.train INFO: normal accuracy 0.517008335210633 4.158664703369141 
2022-04-26 21:46:01,243 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 21:46:01,243 reid_baseline.train INFO: Accuracy: 51.7% Mean Entropy: 415.9%
2022-04-26 21:46:25,944 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.233, Acc: 0.601, Base Lr: 2.46e-03
Aug Cl acc: 0.17933570711236252
2022-04-26 21:46:37,448 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.238[s] Speed: 67.2[samples/s]
2022-04-26 21:47:13,898 reid_baseline.train INFO: normal accuracy 0.52399189006533 4.039224147796631 
2022-04-26 21:47:14,727 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 21:47:14,727 reid_baseline.train INFO: Accuracy: 52.4% Mean Entropy: 403.9%
2022-04-26 21:47:40,282 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.478, Acc: 0.629, Base Lr: 3.25e-03
Aug Cl acc: 0.18961083261590256
2022-04-26 21:47:51,923 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.245[s] Speed: 65.4[samples/s]
2022-04-26 21:48:27,124 reid_baseline.train INFO: normal accuracy 0.5496733498535706 3.5609381198883057 
2022-04-26 21:48:27,902 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 21:48:27,902 reid_baseline.train INFO: Accuracy: 55.0% Mean Entropy: 356.1%
2022-04-26 21:48:52,426 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.925, Acc: 0.673, Base Lr: 4.04e-03
Aug Cl acc: 0.1675412152942858
2022-04-26 21:49:04,269 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.238[s] Speed: 67.1[samples/s]
2022-04-26 21:49:39,414 reid_baseline.train INFO: normal accuracy 0.6255913494030187 2.966625452041626 
2022-04-26 21:49:40,253 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 21:49:40,253 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 296.7%
2022-04-26 21:50:05,776 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.590, Acc: 0.737, Base Lr: 4.83e-03
Aug Cl acc: 0.1872500494906777
2022-04-26 21:50:17,204 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.243[s] Speed: 65.9[samples/s]
2022-04-26 21:50:52,934 reid_baseline.train INFO: normal accuracy 0.6994818652849741 2.579019546508789 
2022-04-26 21:50:53,724 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 21:50:53,725 reid_baseline.train INFO: Accuracy: 69.9% Mean Entropy: 257.9%
2022-04-26 21:51:19,320 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.420, Acc: 0.776, Base Lr: 5.62e-03
Aug Cl acc: 0.16549717752557053
2022-04-26 21:51:30,700 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.243[s] Speed: 65.8[samples/s]
2022-04-26 21:52:07,107 reid_baseline.train INFO: normal accuracy 0.7321468799279117 2.2145016193389893 
2022-04-26 21:52:07,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 21:52:07,890 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 221.5%
2022-04-26 21:52:32,276 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.214, Acc: 0.831, Base Lr: 6.42e-03
Aug Cl acc: 0.17726128979733116
2022-04-26 21:52:43,345 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.232[s] Speed: 68.9[samples/s]
2022-04-26 21:53:19,488 reid_baseline.train INFO: normal accuracy 0.7490425771570174 1.9916704893112183 
2022-04-26 21:53:20,310 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 21:53:20,310 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 199.2%
2022-04-26 21:53:45,174 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.141, Acc: 0.848, Base Lr: 7.21e-03
Aug Cl acc: 0.1614787453099301
2022-04-26 21:53:56,718 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.239[s] Speed: 67.0[samples/s]
2022-04-26 21:54:32,856 reid_baseline.train INFO: normal accuracy 0.7641360666816851 1.8421392440795898 
2022-04-26 21:54:33,646 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 21:54:33,647 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 184.2%
2022-04-26 21:54:59,366 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.053, Acc: 0.877, Base Lr: 4.01e-03
Aug Cl acc: 0.16295977642661647
2022-04-26 21:55:10,896 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.245[s] Speed: 65.4[samples/s]
2022-04-26 21:55:48,736 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.8340458869934082 
2022-04-26 21:55:49,510 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 21:55:49,510 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 183.4%
2022-04-26 21:56:14,253 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.003, Acc: 0.896, Base Lr: 3.38e-03
Aug Cl acc: 0.18203570968226382
2022-04-26 21:56:25,705 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.237[s] Speed: 67.6[samples/s]
2022-04-26 21:57:02,235 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.7365612983703613 
2022-04-26 21:57:03,055 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 21:57:03,055 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 173.7%
2022-04-26 21:57:27,906 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.971, Acc: 0.902, Base Lr: 2.77e-03
Aug Cl acc: 0.17944368563200297
2022-04-26 21:57:39,246 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.238[s] Speed: 67.3[samples/s]
2022-04-26 21:58:13,933 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.722177505493164 
2022-04-26 21:58:14,761 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 21:58:14,761 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 172.2%
2022-04-26 21:58:39,785 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.961, Acc: 0.888, Base Lr: 2.20e-03
Aug Cl acc: 0.17421069898103414
2022-04-26 21:58:52,094 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.246[s] Speed: 65.2[samples/s]
2022-04-26 21:59:26,745 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.7877473831176758 
2022-04-26 21:59:26,745 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 21:59:26,745 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 178.8%
2022-04-26 21:59:51,596 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.926, Acc: 0.902, Base Lr: 1.66e-03
Aug Cl acc: 0.1827415667082134
2022-04-26 22:00:03,197 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.240[s] Speed: 66.7[samples/s]
2022-04-26 22:00:37,578 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7291624546051025 
2022-04-26 22:00:37,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 22:00:37,579 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.9%
2022-04-26 22:01:01,636 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.926, Acc: 0.917, Base Lr: 1.19e-03
Aug Cl acc: 0.19112934564289294
2022-04-26 22:01:14,380 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.241[s] Speed: 66.4[samples/s]
2022-04-26 22:01:50,309 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.7441740036010742 
2022-04-26 22:01:50,310 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 22:01:50,310 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 174.4%
2022-04-26 22:02:14,667 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.918, Acc: 0.913, Base Lr: 7.78e-04
Aug Cl acc: 0.1934553949456466
2022-04-26 22:02:26,170 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.236[s] Speed: 67.8[samples/s]
2022-04-26 22:03:01,090 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.6257411241531372 
2022-04-26 22:03:01,855 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 22:03:01,856 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 162.6%
2022-04-26 22:03:27,018 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.899, Acc: 0.921, Base Lr: 4.51e-04
Aug Cl acc: 0.18849916207162956
2022-04-26 22:03:38,514 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.241[s] Speed: 66.4[samples/s]
2022-04-26 22:04:14,322 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.7236844301223755 
2022-04-26 22:04:14,323 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 22:04:14,323 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 172.4%
2022-04-26 22:04:38,714 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.910, Acc: 0.913, Base Lr: 2.11e-04
Aug Cl acc: 0.18895381375363
2022-04-26 22:04:49,445 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.230[s] Speed: 69.5[samples/s]
2022-04-26 22:05:25,028 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.6753500699996948 
2022-04-26 22:05:25,028 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 22:05:25,028 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 167.5%
2022-04-26 22:05:50,166 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.896, Acc: 0.915, Base Lr: 6.51e-05
Aug Cl acc: 0.19036842647351718
2022-04-26 22:06:01,876 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.241[s] Speed: 66.5[samples/s]
2022-04-26 22:06:38,895 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.713175654411316 
2022-04-26 22:06:38,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 22:06:38,896 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 171.3%
2022-04-26 22:07:02,939 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.910, Acc: 0.913, Base Lr: 1.60e-05
Aug Cl acc: 0.18570099378886976
2022-04-26 22:07:13,840 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.230[s] Speed: 69.6[samples/s]
2022-04-26 22:07:49,919 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.7072420120239258 
2022-04-26 22:07:49,919 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 22:07:49,919 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 170.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-26 22:08:25,510 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.6257411241531372 
2022-04-26 22:08:25,510 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:08:25,510 reid_baseline.train INFO: Accuracy: 77.4%
2022-04-26 22:09:00,999 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.6257411241531372 
2022-04-26 22:09:00,999 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:09:01,000 reid_baseline.train INFO: Shuffled Accuracy: 77.4%
2022-04-26 22:09:28,646 reid_baseline.train INFO: normal accuracy 0.9649773382777092 0.8665481209754944 
2022-04-26 22:09:28,646 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:09:28,647 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-26 22:09:34,221 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4
2022-04-26 22:09:34,221 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-26 22:09:34,221 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 22:09:34,221 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 22:09:34,221 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 22:09:44,854 reid_baseline.train INFO: start training
2022-04-26 22:10:18,063 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.047, Acc: 0.247, Base Lr: 8.72e-04
Aug Cl acc: 0.17107853136564555
2022-04-26 22:10:31,539 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-26 22:11:59,641 reid_baseline.train INFO: normal accuracy 0.5630020656414965 4.172154426574707 
2022-04-26 22:12:00,430 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 22:12:00,430 reid_baseline.train INFO: Accuracy: 56.3% Mean Entropy: 417.2%
2022-04-26 22:12:26,030 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.701, Acc: 0.557, Base Lr: 1.66e-03
Aug Cl acc: 0.18190618565208033
2022-04-26 22:12:37,678 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.245[s] Speed: 65.3[samples/s]
2022-04-26 22:14:02,896 reid_baseline.train INFO: normal accuracy 0.5962818453064035 4.152458190917969 
2022-04-26 22:14:03,802 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 22:14:03,802 reid_baseline.train INFO: Accuracy: 59.6% Mean Entropy: 415.2%
2022-04-26 22:14:29,218 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.233, Acc: 0.601, Base Lr: 2.46e-03
Aug Cl acc: 0.17974689132288882
2022-04-26 22:14:40,843 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.244[s] Speed: 65.7[samples/s]
2022-04-26 22:16:11,447 reid_baseline.train INFO: normal accuracy 0.6056919899013082 3.9734177589416504 
2022-04-26 22:16:12,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 22:16:12,242 reid_baseline.train INFO: Accuracy: 60.6% Mean Entropy: 397.3%
2022-04-26 22:16:38,186 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.478, Acc: 0.628, Base Lr: 3.25e-03
Aug Cl acc: 0.18919964840537623
2022-04-26 22:16:49,832 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.247[s] Speed: 64.7[samples/s]
2022-04-26 22:18:13,546 reid_baseline.train INFO: normal accuracy 0.6385127381225614 3.327486991882324 
2022-04-26 22:18:14,364 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 22:18:14,365 reid_baseline.train INFO: Accuracy: 63.9% Mean Entropy: 332.7%
2022-04-26 22:18:39,372 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.925, Acc: 0.673, Base Lr: 4.04e-03
Aug Cl acc: 0.1675412152942858
2022-04-26 22:18:51,256 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.242[s] Speed: 66.2[samples/s]
2022-04-26 22:20:18,203 reid_baseline.train INFO: normal accuracy 0.71149873766353 2.6645519733428955 
2022-04-26 22:20:19,061 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 22:20:19,061 reid_baseline.train INFO: Accuracy: 71.1% Mean Entropy: 266.5%
2022-04-26 22:20:45,113 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.590, Acc: 0.736, Base Lr: 4.83e-03
Aug Cl acc: 0.1872500494906777
2022-04-26 22:20:56,897 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.249[s] Speed: 64.3[samples/s]
2022-04-26 22:22:24,581 reid_baseline.train INFO: normal accuracy 0.7599265549690154 2.2606000900268555 
2022-04-26 22:22:25,368 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 22:22:25,368 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 226.1%
2022-04-26 22:22:50,790 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.420, Acc: 0.776, Base Lr: 5.62e-03
Aug Cl acc: 0.16549717752557053
2022-04-26 22:23:02,285 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.243[s] Speed: 65.9[samples/s]
2022-04-26 22:24:27,264 reid_baseline.train INFO: normal accuracy 0.7874684415882488 1.9583141803741455 
2022-04-26 22:24:28,005 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 22:24:28,005 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 195.8%
2022-04-26 22:24:52,721 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.214, Acc: 0.831, Base Lr: 6.42e-03
Aug Cl acc: 0.17685010558680483
2022-04-26 22:25:04,285 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.238[s] Speed: 67.2[samples/s]
2022-04-26 22:26:30,196 reid_baseline.train INFO: normal accuracy 0.8060592150562313 1.728087067604065 
2022-04-26 22:26:30,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 22:26:30,956 reid_baseline.train INFO: Accuracy: 80.6% Mean Entropy: 172.8%
2022-04-26 22:26:55,796 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.141, Acc: 0.848, Base Lr: 7.21e-03
Aug Cl acc: 0.1614787453099301
2022-04-26 22:27:07,414 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.240[s] Speed: 66.8[samples/s]
2022-04-26 22:28:36,755 reid_baseline.train INFO: normal accuracy 0.8134037181546936 1.5804624557495117 
2022-04-26 22:28:37,497 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 22:28:37,497 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 158.0%
2022-04-26 22:29:02,776 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.053, Acc: 0.877, Base Lr: 4.01e-03
Aug Cl acc: 0.16213740800556384
2022-04-26 22:29:14,441 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.243[s] Speed: 65.8[samples/s]
2022-04-26 22:30:45,508 reid_baseline.train INFO: normal accuracy 0.8221253155841175 1.569549560546875 
2022-04-26 22:30:46,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 22:30:46,343 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 157.0%
2022-04-26 22:31:11,123 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.003, Acc: 0.897, Base Lr: 3.38e-03
Aug Cl acc: 0.18203569713391757
2022-04-26 22:31:22,854 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.240[s] Speed: 66.8[samples/s]
2022-04-26 22:32:53,431 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.4846007823944092 
2022-04-26 22:32:54,216 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 22:32:54,216 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 148.5%
2022-04-26 22:33:19,528 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.971, Acc: 0.903, Base Lr: 2.77e-03
Aug Cl acc: 0.17999193542882017
2022-04-26 22:33:31,684 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.246[s] Speed: 64.9[samples/s]
2022-04-26 22:34:55,963 reid_baseline.train INFO: normal accuracy 0.8278632086297911 1.4838917255401611 
2022-04-26 22:34:56,759 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 22:34:56,759 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 148.4%
2022-04-26 22:35:22,331 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.961, Acc: 0.888, Base Lr: 2.20e-03
Aug Cl acc: 0.17462188319156044
2022-04-26 22:35:35,111 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.252[s] Speed: 63.5[samples/s]
2022-04-26 22:37:03,863 reid_baseline.train INFO: normal accuracy 0.8271746614643103 1.5403975248336792 
2022-04-26 22:37:03,863 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 22:37:03,863 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 154.0%
2022-04-26 22:37:28,849 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.926, Acc: 0.902, Base Lr: 1.66e-03
Aug Cl acc: 0.18315275091873973
2022-04-26 22:37:40,809 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.242[s] Speed: 66.2[samples/s]
2022-04-26 22:39:14,273 reid_baseline.train INFO: normal accuracy 0.8278632086297911 1.4916715621948242 
2022-04-26 22:39:14,273 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 22:39:14,273 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 149.2%
2022-04-26 22:39:39,039 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.926, Acc: 0.917, Base Lr: 1.19e-03
Aug Cl acc: 0.1907181614323666
2022-04-26 22:39:51,982 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.248[s] Speed: 64.6[samples/s]
2022-04-26 22:41:21,738 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.506143569946289 
2022-04-26 22:41:21,739 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 22:41:21,740 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 150.6%
2022-04-26 22:41:46,914 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.918, Acc: 0.914, Base Lr: 7.78e-04
Aug Cl acc: 0.19263302652459396
2022-04-26 22:41:58,068 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.239[s] Speed: 67.0[samples/s]
2022-04-26 22:43:25,112 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4000914096832275 
2022-04-26 22:43:25,861 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 22:43:25,862 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 140.0%
2022-04-26 22:43:50,494 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.899, Acc: 0.921, Base Lr: 4.51e-04
Aug Cl acc: 0.18849916207162956
2022-04-26 22:44:01,947 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.237[s] Speed: 67.4[samples/s]
2022-04-26 22:45:31,852 reid_baseline.train INFO: normal accuracy 0.8292403029607528 1.5039830207824707 
2022-04-26 22:45:31,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 22:45:31,853 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 150.4%
2022-04-26 22:45:56,294 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.910, Acc: 0.913, Base Lr: 2.11e-04
Aug Cl acc: 0.18854262954310366
2022-04-26 22:46:07,443 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.233[s] Speed: 68.7[samples/s]
2022-04-26 22:47:35,155 reid_baseline.train INFO: normal accuracy 0.8306173972917145 1.4550749063491821 
2022-04-26 22:47:35,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 22:47:35,155 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 145.5%
2022-04-26 22:48:01,079 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.896, Acc: 0.915, Base Lr: 6.51e-05
Aug Cl acc: 0.19077961068404348
2022-04-26 22:48:12,990 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.248[s] Speed: 64.4[samples/s]
2022-04-26 22:49:42,624 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.489200234413147 
2022-04-26 22:49:42,625 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 22:49:42,625 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 148.9%
2022-04-26 22:50:07,740 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.910, Acc: 0.913, Base Lr: 1.60e-05
Aug Cl acc: 0.18570099378886976
2022-04-26 22:50:18,970 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.237[s] Speed: 67.4[samples/s]
2022-04-26 22:51:51,845 reid_baseline.train INFO: normal accuracy 0.8310764287353684 1.482392430305481 
2022-04-26 22:51:51,846 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 22:51:51,846 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 148.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-26 22:53:23,087 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4000914096832275 
2022-04-26 22:53:23,087 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:53:23,087 reid_baseline.train INFO: Accuracy: 83.1%
2022-04-26 22:54:52,774 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4000914096832275 
2022-04-26 22:54:52,774 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:54:52,774 reid_baseline.train INFO: Shuffled Accuracy: 83.1%
2022-04-26 22:55:20,087 reid_baseline.train INFO: normal accuracy 0.9645653069633292 0.8665449023246765 
2022-04-26 22:55:20,098 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:55:20,098 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-26 22:55:25,576 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5
2022-04-26 22:55:25,576 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-26 22:55:25,576 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 22:55:25,576 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 22:55:25,577 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 22:55:35,868 reid_baseline.train INFO: start training
2022-04-26 22:56:08,712 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.085, Acc: 0.247, Base Lr: 8.72e-04
Aug Cl acc: 0.15945184858221756
2022-04-26 22:56:21,960 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-26 22:56:59,145 reid_baseline.train INFO: normal accuracy 0.38006872852233675 4.172243118286133 
2022-04-26 22:56:59,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 22:56:59,955 reid_baseline.train INFO: Accuracy: 38.0% Mean Entropy: 417.2%
2022-04-26 22:57:26,524 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.694, Acc: 0.574, Base Lr: 1.66e-03
Aug Cl acc: 0.17307321648848684
2022-04-26 22:57:38,112 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.251[s] Speed: 63.7[samples/s]
2022-04-26 22:58:11,658 reid_baseline.train INFO: normal accuracy 0.41764032073310425 4.159690856933594 
2022-04-26 22:58:12,404 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 22:58:12,404 reid_baseline.train INFO: Accuracy: 41.8% Mean Entropy: 416.0%
2022-04-26 22:58:37,838 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.208, Acc: 0.614, Base Lr: 2.46e-03
Aug Cl acc: 0.17060719038310804
2022-04-26 22:58:49,447 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.244[s] Speed: 65.7[samples/s]
2022-04-26 22:59:26,157 reid_baseline.train INFO: normal accuracy 0.4316151202749141 4.058378219604492 
2022-04-26 22:59:26,941 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 22:59:26,942 reid_baseline.train INFO: Accuracy: 43.2% Mean Entropy: 405.8%
2022-04-26 22:59:52,916 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.461, Acc: 0.641, Base Lr: 3.25e-03
Aug Cl acc: 0.18045031396966232
2022-04-26 23:00:04,818 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.248[s] Speed: 64.5[samples/s]
2022-04-26 23:00:39,019 reid_baseline.train INFO: normal accuracy 0.45933562428407787 3.5927627086639404 
2022-04-26 23:00:39,794 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 23:00:39,794 reid_baseline.train INFO: Accuracy: 45.9% Mean Entropy: 359.3%
2022-04-26 23:01:03,828 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.916, Acc: 0.672, Base Lr: 4.04e-03
Aug Cl acc: 0.17293684106124074
2022-04-26 23:01:15,316 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.231[s] Speed: 69.1[samples/s]
2022-04-26 23:01:50,667 reid_baseline.train INFO: normal accuracy 0.5143184421534936 3.118652582168579 
2022-04-26 23:01:51,448 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 23:01:51,448 reid_baseline.train INFO: Accuracy: 51.4% Mean Entropy: 311.9%
2022-04-26 23:02:17,236 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.577, Acc: 0.736, Base Lr: 4.83e-03
Aug Cl acc: 0.1839280002995541
2022-04-26 23:02:28,660 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.244[s] Speed: 65.5[samples/s]
2022-04-26 23:03:04,216 reid_baseline.train INFO: normal accuracy 0.5699885452462772 2.7904162406921387 
2022-04-26 23:03:05,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 23:03:05,001 reid_baseline.train INFO: Accuracy: 57.0% Mean Entropy: 279.0%
2022-04-26 23:03:30,663 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.411, Acc: 0.781, Base Lr: 5.62e-03
Aug Cl acc: 0.187821112181011
2022-04-26 23:03:42,288 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.244[s] Speed: 65.5[samples/s]
2022-04-26 23:04:15,978 reid_baseline.train INFO: normal accuracy 0.5814432989690722 2.478161096572876 
2022-04-26 23:04:16,727 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 23:04:16,728 reid_baseline.train INFO: Accuracy: 58.1% Mean Entropy: 247.8%
2022-04-26 23:04:40,855 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.201, Acc: 0.835, Base Lr: 6.42e-03
Aug Cl acc: 0.18283756155716746
2022-04-26 23:04:52,258 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.233[s] Speed: 68.7[samples/s]
2022-04-26 23:05:28,619 reid_baseline.train INFO: normal accuracy 0.5951890034364261 2.232163667678833 
2022-04-26 23:05:29,412 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 23:05:29,412 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 223.2%
2022-04-26 23:05:54,911 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.141, Acc: 0.852, Base Lr: 7.21e-03
Aug Cl acc: 0.1743514286844354
2022-04-26 23:06:06,673 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.245[s] Speed: 65.3[samples/s]
2022-04-26 23:06:41,787 reid_baseline.train INFO: normal accuracy 0.5933562428407789 2.1075122356414795 
2022-04-26 23:06:42,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 23:06:42,578 reid_baseline.train INFO: Accuracy: 59.3% Mean Entropy: 210.8%
2022-04-26 23:07:07,463 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.045, Acc: 0.882, Base Lr: 4.01e-03
Aug Cl acc: 0.17772675815381503
2022-04-26 23:07:18,729 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.237[s] Speed: 67.5[samples/s]
2022-04-26 23:07:54,919 reid_baseline.train INFO: normal accuracy 0.6048109965635738 2.0279059410095215 
2022-04-26 23:07:55,719 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 23:07:55,719 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 202.8%
2022-04-26 23:08:20,587 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.005, Acc: 0.893, Base Lr: 3.38e-03
Aug Cl acc: 0.18442496500517191
2022-04-26 23:08:32,147 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.239[s] Speed: 66.9[samples/s]
2022-04-26 23:09:08,150 reid_baseline.train INFO: normal accuracy 0.6093928980526919 1.935951828956604 
2022-04-26 23:09:08,953 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 23:09:08,954 reid_baseline.train INFO: Accuracy: 60.9% Mean Entropy: 193.6%
2022-04-26 23:09:33,972 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.968, Acc: 0.901, Base Lr: 2.77e-03
Aug Cl acc: 0.18577295855471962
2022-04-26 23:09:46,052 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.244[s] Speed: 65.6[samples/s]
2022-04-26 23:10:20,300 reid_baseline.train INFO: normal accuracy 0.6162657502863689 1.9354082345962524 
2022-04-26 23:10:21,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 23:10:21,066 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 193.5%
2022-04-26 23:10:46,185 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.964, Acc: 0.885, Base Lr: 2.20e-03
Aug Cl acc: 0.177891028554816
2022-04-26 23:10:58,560 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.245[s] Speed: 65.2[samples/s]
2022-04-26 23:11:34,625 reid_baseline.train INFO: normal accuracy 0.6103092783505155 1.9720879793167114 
2022-04-26 23:11:34,626 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 23:11:34,626 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 197.2%
2022-04-26 23:11:59,877 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.929, Acc: 0.906, Base Lr: 1.66e-03
Aug Cl acc: 0.17739834283527575
2022-04-26 23:12:11,832 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.245[s] Speed: 65.4[samples/s]
2022-04-26 23:12:47,728 reid_baseline.train INFO: normal accuracy 0.611454753722795 1.907104253768921 
2022-04-26 23:12:48,540 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 23:12:48,540 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 190.7%
2022-04-26 23:13:12,974 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.913, Acc: 0.918, Base Lr: 1.19e-03
Aug Cl acc: 0.179697501031976
2022-04-26 23:13:24,952 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.238[s] Speed: 67.3[samples/s]
2022-04-26 23:13:59,296 reid_baseline.train INFO: normal accuracy 0.6148911798396335 1.9058396816253662 
2022-04-26 23:14:00,088 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 23:14:00,088 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 190.6%
2022-04-26 23:14:24,658 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.920, Acc: 0.912, Base Lr: 7.78e-04
Aug Cl acc: 0.17770582751223915
2022-04-26 23:14:35,968 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.236[s] Speed: 67.8[samples/s]
2022-04-26 23:15:10,063 reid_baseline.train INFO: normal accuracy 0.6155784650630012 1.823894739151001 
2022-04-26 23:15:10,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 23:15:10,857 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 182.4%
2022-04-26 23:15:36,168 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.892, Acc: 0.921, Base Lr: 4.51e-04
Aug Cl acc: 0.18928746173256322
2022-04-26 23:15:47,750 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.242[s] Speed: 66.1[samples/s]
2022-04-26 23:16:23,540 reid_baseline.train INFO: normal accuracy 0.6153493699885453 1.9062520265579224 
2022-04-26 23:16:23,540 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 23:16:23,540 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 190.6%
2022-04-26 23:16:47,752 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.904, Acc: 0.920, Base Lr: 2.11e-04
Aug Cl acc: 0.19041661212318822
2022-04-26 23:16:58,923 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.233[s] Speed: 68.7[samples/s]
2022-04-26 23:17:33,558 reid_baseline.train INFO: normal accuracy 0.6126002290950745 1.8698076009750366 
2022-04-26 23:17:33,559 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 23:17:33,559 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 187.0%
2022-04-26 23:17:58,797 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.908, Acc: 0.908, Base Lr: 6.51e-05
Aug Cl acc: 0.18198207805031225
2022-04-26 23:18:10,732 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.245[s] Speed: 65.4[samples/s]
2022-04-26 23:18:46,339 reid_baseline.train INFO: normal accuracy 0.6128293241695304 1.8937863111495972 
2022-04-26 23:18:46,340 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 23:18:46,340 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 189.4%
2022-04-26 23:19:10,307 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.902, Acc: 0.914, Base Lr: 1.60e-05
Aug Cl acc: 0.17888446858054713
2022-04-26 23:19:21,339 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-26 23:19:55,830 reid_baseline.train INFO: normal accuracy 0.613745704467354 1.901277780532837 
2022-04-26 23:19:55,831 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 23:19:55,831 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 190.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-26 23:20:31,180 reid_baseline.train INFO: normal accuracy 0.6155784650630012 1.823894739151001 
2022-04-26 23:20:31,180 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 23:20:31,180 reid_baseline.train INFO: Accuracy: 61.6%
2022-04-26 23:21:07,578 reid_baseline.train INFO: normal accuracy 0.6155784650630012 1.823894739151001 
2022-04-26 23:21:07,579 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 23:21:07,579 reid_baseline.train INFO: Shuffled Accuracy: 61.6%
2022-04-26 23:21:36,356 reid_baseline.train INFO: normal accuracy 0.9666254635352287 0.8702616095542908 
2022-04-26 23:21:36,357 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 23:21:36,357 reid_baseline.train INFO: Source Clean Accuracy: 96.7%
2022-04-26 23:21:41,779 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5
2022-04-26 23:21:41,779 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-26 23:21:41,779 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 23:21:41,779 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 23:21:41,780 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 23:21:52,581 reid_baseline.train INFO: start training
2022-04-26 23:22:24,925 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.085, Acc: 0.247, Base Lr: 8.72e-04
Aug Cl acc: 0.15945184858221756
2022-04-26 23:22:38,097 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-26 23:23:13,812 reid_baseline.train INFO: normal accuracy 0.5041676053165127 4.172399044036865 
2022-04-26 23:23:14,651 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 23:23:14,652 reid_baseline.train INFO: Accuracy: 50.4% Mean Entropy: 417.2%
2022-04-26 23:23:40,306 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.694, Acc: 0.574, Base Lr: 1.66e-03
Aug Cl acc: 0.17307321648848684
2022-04-26 23:23:51,911 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.245[s] Speed: 65.3[samples/s]
2022-04-26 23:24:27,831 reid_baseline.train INFO: normal accuracy 0.5330029285875197 4.158859729766846 
2022-04-26 23:24:28,625 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 23:24:28,625 reid_baseline.train INFO: Accuracy: 53.3% Mean Entropy: 415.9%
2022-04-26 23:24:54,339 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.208, Acc: 0.615, Base Lr: 2.46e-03
Aug Cl acc: 0.17060719038310804
2022-04-26 23:25:05,916 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.245[s] Speed: 65.4[samples/s]
2022-04-26 23:25:41,916 reid_baseline.train INFO: normal accuracy 0.5370578959225051 4.052762508392334 
2022-04-26 23:25:42,692 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 23:25:42,692 reid_baseline.train INFO: Accuracy: 53.7% Mean Entropy: 405.3%
2022-04-26 23:26:08,959 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.461, Acc: 0.641, Base Lr: 3.25e-03
Aug Cl acc: 0.18050905277854518
2022-04-26 23:26:20,643 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.249[s] Speed: 64.1[samples/s]
2022-04-26 23:26:56,483 reid_baseline.train INFO: normal accuracy 0.5580085604865961 3.5635106563568115 
2022-04-26 23:26:57,310 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 23:26:57,310 reid_baseline.train INFO: Accuracy: 55.8% Mean Entropy: 356.4%
2022-04-26 23:27:22,210 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.916, Acc: 0.672, Base Lr: 4.04e-03
Aug Cl acc: 0.17293684106124074
2022-04-26 23:27:34,205 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.243[s] Speed: 66.0[samples/s]
2022-04-26 23:28:09,452 reid_baseline.train INFO: normal accuracy 0.6332507321468799 2.9779508113861084 
2022-04-26 23:28:10,244 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 23:28:10,244 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 297.8%
2022-04-26 23:28:35,971 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.577, Acc: 0.736, Base Lr: 4.83e-03
Aug Cl acc: 0.18304688052127235
2022-04-26 23:28:47,376 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.244[s] Speed: 65.5[samples/s]
2022-04-26 23:29:23,482 reid_baseline.train INFO: normal accuracy 0.7051137643613427 2.574882745742798 
2022-04-26 23:29:24,287 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 23:29:24,287 reid_baseline.train INFO: Accuracy: 70.5% Mean Entropy: 257.5%
2022-04-26 23:29:49,950 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.411, Acc: 0.781, Base Lr: 5.62e-03
Aug Cl acc: 0.1874099279704847
2022-04-26 23:30:01,389 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.243[s] Speed: 65.7[samples/s]
2022-04-26 23:30:37,004 reid_baseline.train INFO: normal accuracy 0.737102951115116 2.228971242904663 
2022-04-26 23:30:37,822 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 23:30:37,823 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 222.9%
2022-04-26 23:31:02,537 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.201, Acc: 0.835, Base Lr: 6.42e-03
Aug Cl acc: 0.18242637734664113
2022-04-26 23:31:14,165 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.238[s] Speed: 67.2[samples/s]
2022-04-26 23:31:50,374 reid_baseline.train INFO: normal accuracy 0.7585041676053165 1.991491436958313 
2022-04-26 23:31:51,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 23:31:51,173 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 199.1%
2022-04-26 23:32:16,838 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.141, Acc: 0.851, Base Lr: 7.21e-03
Aug Cl acc: 0.1743514286844354
2022-04-26 23:32:28,625 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.246[s] Speed: 65.1[samples/s]
2022-04-26 23:33:03,843 reid_baseline.train INFO: normal accuracy 0.7596305474205902 1.8700034618377686 
2022-04-26 23:33:04,678 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 23:33:04,679 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 187.0%
2022-04-26 23:33:30,193 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.045, Acc: 0.882, Base Lr: 4.01e-03
Aug Cl acc: 0.17813794236434133
2022-04-26 23:33:41,751 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.244[s] Speed: 65.6[samples/s]
2022-04-26 23:34:19,526 reid_baseline.train INFO: normal accuracy 0.7708943455733274 1.8171135187149048 
2022-04-26 23:34:20,374 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 23:34:20,374 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 181.7%
2022-04-26 23:34:45,581 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.005, Acc: 0.892, Base Lr: 3.38e-03
Aug Cl acc: 0.18442496500517191
2022-04-26 23:34:57,323 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.242[s] Speed: 66.0[samples/s]
2022-04-26 23:35:33,660 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7262848615646362 
2022-04-26 23:35:34,447 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 23:35:34,447 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.6%
2022-04-26 23:35:59,357 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.968, Acc: 0.901, Base Lr: 2.77e-03
Aug Cl acc: 0.18659532697577225
2022-04-26 23:36:11,370 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.243[s] Speed: 65.9[samples/s]
2022-04-26 23:36:47,334 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.7241262197494507 
2022-04-26 23:36:48,128 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 23:36:48,128 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 172.4%
2022-04-26 23:37:13,843 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.964, Acc: 0.884, Base Lr: 2.20e-03
Aug Cl acc: 0.17747984434428968
2022-04-26 23:37:26,350 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.251[s] Speed: 63.6[samples/s]
2022-04-26 23:38:01,731 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.767319917678833 
2022-04-26 23:38:01,732 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 23:38:01,732 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 176.7%
2022-04-26 23:38:32,733 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.929, Acc: 0.906, Base Lr: 1.66e-03
Aug Cl acc: 0.17780952704580208
2022-04-26 23:38:50,055 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-26 23:39:36,092 reid_baseline.train INFO: normal accuracy 0.7769767965758053 1.7027477025985718 
2022-04-26 23:39:37,061 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 23:39:37,061 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 170.3%
2022-04-26 23:40:16,592 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.913, Acc: 0.917, Base Lr: 1.19e-03
Aug Cl acc: 0.18010868524250231
2022-04-26 23:40:34,789 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-26 23:41:39,655 reid_baseline.train INFO: normal accuracy 0.7769767965758053 1.7078443765640259 
2022-04-26 23:41:39,660 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 23:41:39,660 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 170.8%
2022-04-26 23:42:45,871 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.920, Acc: 0.912, Base Lr: 7.78e-04
Aug Cl acc: 0.17688345909118652
2022-04-26 23:43:14,318 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.623[s] Speed: 25.7[samples/s]
2022-04-26 23:44:19,754 reid_baseline.train INFO: normal accuracy 0.7753998648344221 1.6181957721710205 
2022-04-26 23:44:20,918 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 23:44:20,918 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 161.8%
2022-04-26 23:45:25,181 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.892, Acc: 0.921, Base Lr: 4.51e-04
Aug Cl acc: 0.19010983015361585
2022-04-26 23:46:00,065 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.651[s] Speed: 24.6[samples/s]
2022-04-26 23:47:00,554 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6941114664077759 
2022-04-26 23:47:00,557 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 23:47:00,557 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 169.4%
2022-04-26 23:48:07,295 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.904, Acc: 0.920, Base Lr: 2.11e-04
Aug Cl acc: 0.19082779633371452
2022-04-26 23:48:37,636 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.639[s] Speed: 25.1[samples/s]
2022-04-26 23:49:38,880 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.6650289297103882 
2022-04-26 23:49:38,885 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 23:49:38,885 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 166.5%
2022-04-26 23:50:46,460 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.908, Acc: 0.908, Base Lr: 6.51e-05
Aug Cl acc: 0.18239326226083855
2022-04-26 23:51:20,659 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.669[s] Speed: 23.9[samples/s]
2022-04-26 23:52:25,306 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.6938976049423218 
2022-04-26 23:52:25,310 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 23:52:25,311 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 169.4%
2022-04-26 23:53:29,775 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.902, Acc: 0.913, Base Lr: 1.60e-05
Aug Cl acc: 0.17929565279107346
2022-04-26 23:54:01,426 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.632[s] Speed: 25.3[samples/s]
2022-04-26 23:55:03,795 reid_baseline.train INFO: normal accuracy 0.7785537283171886 1.7005083560943604 
2022-04-26 23:55:03,799 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 23:55:03,800 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 170.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-26 23:56:07,954 reid_baseline.train INFO: normal accuracy 0.7753998648344221 1.6181957721710205 
2022-04-26 23:56:07,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 23:56:07,955 reid_baseline.train INFO: Accuracy: 77.5%
2022-04-26 23:57:11,985 reid_baseline.train INFO: normal accuracy 0.7753998648344221 1.6181957721710205 
2022-04-26 23:57:11,985 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 23:57:11,986 reid_baseline.train INFO: Shuffled Accuracy: 77.5%
2022-04-26 23:57:54,368 reid_baseline.train INFO: normal accuracy 0.9666254635352287 0.8703259825706482 
2022-04-26 23:57:54,368 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 23:57:54,368 reid_baseline.train INFO: Source Clean Accuracy: 96.7%
2022-04-26 23:58:00,517 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5
2022-04-26 23:58:00,517 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-26 23:58:00,517 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 23:58:00,517 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 23:58:00,517 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 23:58:15,279 reid_baseline.train INFO: start training
2022-04-26 23:59:37,205 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.085, Acc: 0.248, Base Lr: 8.72e-04
Aug Cl acc: 0.15945184858221756
2022-04-27 00:00:10,311 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.744[s] Speed: 21.5[samples/s]
2022-04-27 00:02:20,327 reid_baseline.train INFO: normal accuracy 0.5662152857470737 4.172185897827148 
2022-04-27 00:02:21,481 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 00:02:21,481 reid_baseline.train INFO: Accuracy: 56.6% Mean Entropy: 417.2%
2022-04-27 00:03:29,975 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.694, Acc: 0.574, Base Lr: 1.66e-03
Aug Cl acc: 0.17307321648848684
2022-04-27 00:04:01,891 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.660[s] Speed: 24.3[samples/s]
2022-04-27 00:06:06,204 reid_baseline.train INFO: normal accuracy 0.6054624741794813 4.1532673835754395 
2022-04-27 00:06:07,268 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 00:06:07,268 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 415.3%
2022-04-27 00:07:17,345 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.208, Acc: 0.614, Base Lr: 2.46e-03
Aug Cl acc: 0.17101837459363436
2022-04-27 00:07:47,846 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.662[s] Speed: 24.2[samples/s]
2022-04-27 00:10:02,046 reid_baseline.train INFO: normal accuracy 0.6180858388799633 3.9854013919830322 
2022-04-27 00:10:03,184 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 00:10:03,184 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 398.5%
2022-04-27 00:11:08,902 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.461, Acc: 0.641, Base Lr: 3.25e-03
Aug Cl acc: 0.1796279455486097
2022-04-27 00:11:44,413 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.666[s] Speed: 24.0[samples/s]
2022-04-27 00:13:49,198 reid_baseline.train INFO: normal accuracy 0.64838191416112 3.313248634338379 
2022-04-27 00:13:50,372 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 00:13:50,372 reid_baseline.train INFO: Accuracy: 64.8% Mean Entropy: 331.3%
2022-04-27 00:14:55,563 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.916, Acc: 0.672, Base Lr: 4.04e-03
Aug Cl acc: 0.17293684106124074
2022-04-27 00:15:28,278 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.644[s] Speed: 24.8[samples/s]
2022-04-27 00:17:36,596 reid_baseline.train INFO: normal accuracy 0.7094330961670875 2.661550283432007 
2022-04-27 00:17:37,731 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 00:17:37,731 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 266.2%
2022-04-27 00:18:44,645 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.577, Acc: 0.736, Base Lr: 4.83e-03
Aug Cl acc: 0.18345806473179868
2022-04-27 00:19:17,635 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.657[s] Speed: 24.3[samples/s]
2022-04-27 00:21:27,063 reid_baseline.train INFO: normal accuracy 0.7633692907964196 2.259828805923462 
2022-04-27 00:21:27,928 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 00:21:27,928 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 226.0%
2022-04-27 00:22:37,762 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.411, Acc: 0.780, Base Lr: 5.62e-03
Aug Cl acc: 0.187821112181011
2022-04-27 00:23:09,719 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-27 00:25:20,384 reid_baseline.train INFO: normal accuracy 0.7911406931374799 1.9617328643798828 
2022-04-27 00:25:21,341 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 00:25:21,341 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 196.2%
2022-04-27 00:26:28,537 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.201, Acc: 0.835, Base Lr: 6.42e-03
Aug Cl acc: 0.18283756155716746
2022-04-27 00:26:59,666 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.647[s] Speed: 24.7[samples/s]
2022-04-27 00:29:08,942 reid_baseline.train INFO: normal accuracy 0.8078953408308469 1.7385579347610474 
2022-04-27 00:29:09,790 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 00:29:09,790 reid_baseline.train INFO: Accuracy: 80.8% Mean Entropy: 173.9%
2022-04-27 00:30:17,926 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.141, Acc: 0.852, Base Lr: 7.21e-03
Aug Cl acc: 0.1747626128949617
2022-04-27 00:30:48,999 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.653[s] Speed: 24.5[samples/s]
2022-04-27 00:32:59,783 reid_baseline.train INFO: normal accuracy 0.8138627495983475 1.6156370639801025 
2022-04-27 00:33:00,828 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 00:33:00,829 reid_baseline.train INFO: Accuracy: 81.4% Mean Entropy: 161.6%
2022-04-27 00:34:11,442 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.045, Acc: 0.881, Base Lr: 4.01e-03
Aug Cl acc: 0.17813794236434133
2022-04-27 00:34:45,012 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.685[s] Speed: 23.4[samples/s]
2022-04-27 00:36:53,812 reid_baseline.train INFO: normal accuracy 0.8218957998622906 1.566011905670166 
2022-04-27 00:36:54,844 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 00:36:54,844 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 156.6%
2022-04-27 00:37:56,739 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.005, Acc: 0.893, Base Lr: 3.38e-03
Aug Cl acc: 0.18442496500517191
2022-04-27 00:38:30,484 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.628[s] Speed: 25.5[samples/s]
2022-04-27 00:40:41,652 reid_baseline.train INFO: normal accuracy 0.8246499885242139 1.4801074266433716 
2022-04-27 00:40:42,695 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 00:40:42,696 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 148.0%
2022-04-27 00:41:47,838 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.968, Acc: 0.901, Base Lr: 2.77e-03
Aug Cl acc: 0.18618414276524595
2022-04-27 00:42:20,047 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.639[s] Speed: 25.0[samples/s]
2022-04-27 00:44:28,320 reid_baseline.train INFO: normal accuracy 0.8257975671333486 1.4845706224441528 
2022-04-27 00:44:28,324 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 00:44:28,325 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 148.5%
2022-04-27 00:45:34,315 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.964, Acc: 0.884, Base Lr: 2.20e-03
Aug Cl acc: 0.17706866013376335
2022-04-27 00:46:09,598 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.666[s] Speed: 24.0[samples/s]
2022-04-27 00:48:25,498 reid_baseline.train INFO: normal accuracy 0.8257975671333486 1.5299705266952515 
2022-04-27 00:48:25,500 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 00:48:25,501 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 153.0%
2022-04-27 00:49:32,378 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.929, Acc: 0.906, Base Lr: 1.66e-03
Aug Cl acc: 0.17739834283527575
2022-04-27 00:50:02,825 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.640[s] Speed: 25.0[samples/s]
2022-04-27 00:52:20,512 reid_baseline.train INFO: normal accuracy 0.8255680514115217 1.4793980121612549 
2022-04-27 00:52:21,535 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 00:52:21,536 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 147.9%
2022-04-27 00:53:28,681 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.913, Acc: 0.918, Base Lr: 1.19e-03
Aug Cl acc: 0.179697501031976
2022-04-27 00:54:01,819 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.660[s] Speed: 24.3[samples/s]
2022-04-27 00:56:17,054 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.4916458129882812 
2022-04-27 00:56:17,058 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 00:56:17,058 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 149.2%
2022-04-27 00:57:21,059 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.920, Acc: 0.912, Base Lr: 7.78e-04
Aug Cl acc: 0.17729464330171285
2022-04-27 00:57:51,558 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.622[s] Speed: 25.7[samples/s]
2022-04-27 01:00:02,415 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4065327644348145 
2022-04-27 01:00:03,646 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 01:00:03,646 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 140.7%
2022-04-27 01:01:05,478 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.892, Acc: 0.922, Base Lr: 4.51e-04
Aug Cl acc: 0.19010983015361585
2022-04-27 01:01:38,519 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.623[s] Speed: 25.7[samples/s]
2022-04-27 01:03:52,098 reid_baseline.train INFO: normal accuracy 0.8287812715170989 1.484344720840454 
2022-04-27 01:03:52,100 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 01:03:52,100 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 148.4%
2022-04-27 01:04:59,211 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.904, Acc: 0.920, Base Lr: 2.11e-04
Aug Cl acc: 0.19123898054424085
2022-04-27 01:05:29,747 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.642[s] Speed: 24.9[samples/s]
2022-04-27 01:07:41,262 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.4540719985961914 
2022-04-27 01:07:41,263 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 01:07:41,263 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 145.4%
2022-04-27 01:08:46,710 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.908, Acc: 0.909, Base Lr: 6.51e-05
Aug Cl acc: 0.18239326226083855
2022-04-27 01:09:17,872 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.635[s] Speed: 25.2[samples/s]
2022-04-27 01:11:36,335 reid_baseline.train INFO: normal accuracy 0.8287812715170989 1.4789133071899414 
2022-04-27 01:11:36,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 01:11:36,335 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 147.9%
2022-04-27 01:12:43,047 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.902, Acc: 0.914, Base Lr: 1.60e-05
Aug Cl acc: 0.17929565279107346
2022-04-27 01:13:15,024 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.648[s] Speed: 24.7[samples/s]
2022-04-27 01:15:26,339 reid_baseline.train INFO: normal accuracy 0.8292403029607528 1.486039638519287 
2022-04-27 01:15:26,342 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 01:15:26,342 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 148.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-27 01:17:40,555 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4065327644348145 
2022-04-27 01:17:40,556 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 01:17:40,556 reid_baseline.train INFO: Accuracy: 83.1%
2022-04-27 01:19:50,639 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4065327644348145 
2022-04-27 01:19:50,640 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 01:19:50,640 reid_baseline.train INFO: Shuffled Accuracy: 83.1%
2022-04-27 01:20:31,432 reid_baseline.train INFO: normal accuracy 0.9666254635352287 0.8701584935188293 
2022-04-27 01:20:31,433 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 01:20:31,433 reid_baseline.train INFO: Source Clean Accuracy: 96.7%
2022-04-27 01:20:39,143 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6
2022-04-27 01:20:39,143 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-27 01:20:39,143 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 01:20:39,143 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 01:20:39,144 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 01:20:54,515 reid_baseline.train INFO: start training
2022-04-27 01:22:23,422 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.056, Acc: 0.252, Base Lr: 8.72e-04
Aug Cl acc: 0.17531095053020276
2022-04-27 01:22:58,609 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.792[s] Speed: 20.2[samples/s]
2022-04-27 01:23:59,634 reid_baseline.train INFO: normal accuracy 0.3670103092783505 4.172114849090576 
2022-04-27 01:24:00,892 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 01:24:00,892 reid_baseline.train INFO: Accuracy: 36.7% Mean Entropy: 417.2%
2022-04-27 01:25:07,826 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.703, Acc: 0.562, Base Lr: 1.66e-03
Aug Cl acc: 0.17426746769955284
2022-04-27 01:25:40,906 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.658[s] Speed: 24.3[samples/s]
2022-04-27 01:26:43,407 reid_baseline.train INFO: normal accuracy 0.4004581901489118 4.157769203186035 
2022-04-27 01:26:44,314 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 01:26:44,315 reid_baseline.train INFO: Accuracy: 40.0% Mean Entropy: 415.8%
2022-04-27 01:27:49,192 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.201, Acc: 0.594, Base Lr: 2.46e-03
Aug Cl acc: 0.18725644914727463
2022-04-27 01:28:21,444 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.639[s] Speed: 25.0[samples/s]
2022-04-27 01:29:20,931 reid_baseline.train INFO: normal accuracy 0.41741122565864835 4.04318904876709 
2022-04-27 01:29:21,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 01:29:21,853 reid_baseline.train INFO: Accuracy: 41.7% Mean Entropy: 404.3%
2022-04-27 01:30:31,408 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.474, Acc: 0.630, Base Lr: 3.25e-03
Aug Cl acc: 0.17852542274876645
2022-04-27 01:31:04,203 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.673[s] Speed: 23.8[samples/s]
2022-04-27 01:32:07,971 reid_baseline.train INFO: normal accuracy 0.44742268041237115 3.6218810081481934 
2022-04-27 01:32:08,815 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 01:32:08,816 reid_baseline.train INFO: Accuracy: 44.7% Mean Entropy: 362.2%
2022-04-27 01:33:12,233 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.930, Acc: 0.675, Base Lr: 4.04e-03
Aug Cl acc: 0.17265490481728002
2022-04-27 01:33:47,403 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.649[s] Speed: 24.7[samples/s]
2022-04-27 01:34:49,654 reid_baseline.train INFO: normal accuracy 0.5120274914089347 3.1189684867858887 
2022-04-27 01:34:50,749 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 01:34:50,749 reid_baseline.train INFO: Accuracy: 51.2% Mean Entropy: 311.9%
2022-04-27 01:35:57,278 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.612, Acc: 0.731, Base Lr: 4.83e-03
Aug Cl acc: 0.1835684525339227
2022-04-27 01:36:29,614 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.650[s] Speed: 24.6[samples/s]
2022-04-27 01:37:23,721 reid_baseline.train INFO: normal accuracy 0.5644902634593356 2.7994771003723145 
2022-04-27 01:37:24,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 01:37:24,934 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 279.9%
2022-04-27 01:38:37,304 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.426, Acc: 0.768, Base Lr: 5.62e-03
Aug Cl acc: 0.1790754669591
2022-04-27 01:39:08,282 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.679[s] Speed: 23.6[samples/s]
2022-04-27 01:40:07,297 reid_baseline.train INFO: normal accuracy 0.5777777777777777 2.489689350128174 
2022-04-27 01:40:08,445 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 01:40:08,445 reid_baseline.train INFO: Accuracy: 57.8% Mean Entropy: 249.0%
2022-04-27 01:41:13,598 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.216, Acc: 0.833, Base Lr: 6.42e-03
Aug Cl acc: 0.17659479693362587
2022-04-27 01:41:45,673 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.640[s] Speed: 25.0[samples/s]
2022-04-27 01:42:47,849 reid_baseline.train INFO: normal accuracy 0.6002290950744559 2.276705026626587 
2022-04-27 01:42:49,079 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 01:42:49,079 reid_baseline.train INFO: Accuracy: 60.0% Mean Entropy: 227.7%
2022-04-27 01:43:59,740 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.145, Acc: 0.847, Base Lr: 7.21e-03
Aug Cl acc: 0.1705046578457481
2022-04-27 01:44:31,330 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.672[s] Speed: 23.8[samples/s]
2022-04-27 01:45:33,173 reid_baseline.train INFO: normal accuracy 0.5906071019473081 2.0858798027038574 
2022-04-27 01:45:34,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 01:45:34,001 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 208.6%
2022-04-27 01:46:41,169 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.055, Acc: 0.879, Base Lr: 4.01e-03
Aug Cl acc: 0.1634488858674702
2022-04-27 01:47:13,581 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.655[s] Speed: 24.4[samples/s]
2022-04-27 01:48:17,266 reid_baseline.train INFO: normal accuracy 0.6071019473081328 2.031116247177124 
2022-04-27 01:48:18,166 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 01:48:18,166 reid_baseline.train INFO: Accuracy: 60.7% Mean Entropy: 203.1%
2022-04-27 01:49:19,481 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.008, Acc: 0.901, Base Lr: 3.38e-03
Aug Cl acc: 0.17675611847325376
2022-04-27 01:49:53,023 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.623[s] Speed: 25.7[samples/s]
2022-04-27 01:50:52,919 reid_baseline.train INFO: normal accuracy 0.6116838487972509 1.98789644241333 
2022-04-27 01:50:53,965 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 01:50:53,965 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 198.8%
2022-04-27 01:52:01,269 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.984, Acc: 0.893, Base Lr: 2.77e-03
Aug Cl acc: 0.17244983974256015
2022-04-27 01:52:32,490 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.648[s] Speed: 24.7[samples/s]
2022-04-27 01:53:35,731 reid_baseline.train INFO: normal accuracy 0.613745704467354 1.9565218687057495 
2022-04-27 01:53:36,526 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 01:53:36,526 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 195.7%
2022-04-27 01:54:37,958 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.963, Acc: 0.896, Base Lr: 2.20e-03
Aug Cl acc: 0.18266623898556358
2022-04-27 01:55:11,557 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.625[s] Speed: 25.6[samples/s]
2022-04-27 01:56:13,855 reid_baseline.train INFO: normal accuracy 0.6100801832760596 1.9694138765335083 
2022-04-27 01:56:13,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 01:56:13,858 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 196.9%
2022-04-27 01:57:18,360 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.940, Acc: 0.910, Base Lr: 1.66e-03
Aug Cl acc: 0.18315779535393967
2022-04-27 01:57:52,078 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.645[s] Speed: 24.8[samples/s]
2022-04-27 01:58:51,238 reid_baseline.train INFO: normal accuracy 0.613745704467354 1.9319661855697632 
2022-04-27 01:58:52,241 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 01:58:52,241 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 193.2%
2022-04-27 02:00:00,300 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.928, Acc: 0.913, Base Lr: 1.19e-03
Aug Cl acc: 0.17834647078263133
2022-04-27 02:00:34,362 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-27 02:01:34,709 reid_baseline.train INFO: normal accuracy 0.6146620847651776 1.9037147760391235 
2022-04-27 02:01:35,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 02:01:35,956 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 190.4%
2022-04-27 02:02:37,646 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.934, Acc: 0.906, Base Lr: 7.78e-04
Aug Cl acc: 0.18637433804963766
2022-04-27 02:03:11,089 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.626[s] Speed: 25.6[samples/s]
2022-04-27 02:04:15,734 reid_baseline.train INFO: normal accuracy 0.6187857961053838 1.834421992301941 
2022-04-27 02:04:16,685 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 02:04:16,685 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 183.4%
2022-04-27 02:05:23,207 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.898, Acc: 0.924, Base Lr: 4.51e-04
Aug Cl acc: 0.17714190483093262
2022-04-27 02:05:54,654 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.645[s] Speed: 24.8[samples/s]
2022-04-27 02:06:52,575 reid_baseline.train INFO: normal accuracy 0.6194730813287515 1.9423993825912476 
2022-04-27 02:06:52,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 02:06:52,578 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 194.2%
2022-04-27 02:08:00,922 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.916, Acc: 0.920, Base Lr: 2.11e-04
Aug Cl acc: 0.1823338458412572
2022-04-27 02:08:31,940 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.654[s] Speed: 24.5[samples/s]
2022-04-27 02:09:36,395 reid_baseline.train INFO: normal accuracy 0.6158075601374571 1.8836318254470825 
2022-04-27 02:09:36,400 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 02:09:36,400 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 188.4%
2022-04-27 02:10:35,663 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.905, Acc: 0.906, Base Lr: 6.51e-05
Aug Cl acc: 0.18127358587164627
2022-04-27 02:11:05,857 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.589[s] Speed: 27.2[samples/s]
2022-04-27 02:12:08,730 reid_baseline.train INFO: normal accuracy 0.6151202749140894 1.9094470739364624 
2022-04-27 02:12:08,735 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 02:12:08,735 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 190.9%
2022-04-27 02:13:10,961 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.904, Acc: 0.907, Base Lr: 1.60e-05
Aug Cl acc: 0.18467723695855393
2022-04-27 02:13:43,749 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.625[s] Speed: 25.6[samples/s]
2022-04-27 02:14:43,641 reid_baseline.train INFO: normal accuracy 0.6167239404352807 1.9173593521118164 
2022-04-27 02:14:43,646 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 02:14:43,646 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 191.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-27 02:15:46,118 reid_baseline.train INFO: normal accuracy 0.6187857961053838 1.834421992301941 
2022-04-27 02:15:46,119 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 02:15:46,119 reid_baseline.train INFO: Accuracy: 61.9%
2022-04-27 02:16:48,029 reid_baseline.train INFO: normal accuracy 0.6187857961053838 1.834421992301941 
2022-04-27 02:16:48,029 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 02:16:48,029 reid_baseline.train INFO: Shuffled Accuracy: 61.9%
2022-04-27 02:17:29,834 reid_baseline.train INFO: normal accuracy 0.9649773382777092 0.8637098670005798 
2022-04-27 02:17:29,834 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 02:17:29,834 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-27 02:17:36,600 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6
2022-04-27 02:17:36,600 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-27 02:17:36,601 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 02:17:36,601 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 02:17:36,601 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 02:17:50,639 reid_baseline.train INFO: start training
2022-04-27 02:19:14,184 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.056, Acc: 0.252, Base Lr: 8.72e-04
Aug Cl acc: 0.17531095053020276
2022-04-27 02:19:49,504 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.754[s] Speed: 21.2[samples/s]
2022-04-27 02:20:51,580 reid_baseline.train INFO: normal accuracy 0.48546970038296916 4.172311782836914 
2022-04-27 02:20:52,793 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 02:20:52,794 reid_baseline.train INFO: Accuracy: 48.5% Mean Entropy: 417.2%
2022-04-27 02:22:00,406 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.703, Acc: 0.562, Base Lr: 1.66e-03
Aug Cl acc: 0.17426746769955284
2022-04-27 02:22:30,851 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.644[s] Speed: 24.8[samples/s]
2022-04-27 02:23:34,830 reid_baseline.train INFO: normal accuracy 0.5221896823608921 4.157041072845459 
2022-04-27 02:23:35,784 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 02:23:35,784 reid_baseline.train INFO: Accuracy: 52.2% Mean Entropy: 415.7%
2022-04-27 02:24:42,739 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.201, Acc: 0.594, Base Lr: 2.46e-03
Aug Cl acc: 0.18725644914727463
2022-04-27 02:25:14,549 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.650[s] Speed: 24.6[samples/s]
2022-04-27 02:26:19,398 reid_baseline.train INFO: normal accuracy 0.518810542915071 4.03030252456665 
2022-04-27 02:26:20,332 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 02:26:20,332 reid_baseline.train INFO: Accuracy: 51.9% Mean Entropy: 403.0%
2022-04-27 02:27:25,439 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.474, Acc: 0.629, Base Lr: 3.25e-03
Aug Cl acc: 0.17852542274876645
2022-04-27 02:27:57,985 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.642[s] Speed: 24.9[samples/s]
2022-04-27 02:29:02,370 reid_baseline.train INFO: normal accuracy 0.5408875872944356 3.592127561569214 
2022-04-27 02:29:03,334 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 02:29:03,334 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 359.2%
2022-04-27 02:30:09,380 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.930, Acc: 0.675, Base Lr: 4.04e-03
Aug Cl acc: 0.17265490481728002
2022-04-27 02:30:42,953 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.655[s] Speed: 24.4[samples/s]
2022-04-27 02:31:42,117 reid_baseline.train INFO: normal accuracy 0.623563865735526 2.99397611618042 
2022-04-27 02:31:43,333 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 02:31:43,333 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 299.4%
2022-04-27 02:32:51,706 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.612, Acc: 0.731, Base Lr: 4.83e-03
Aug Cl acc: 0.1835684525339227
2022-04-27 02:33:24,360 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.665[s] Speed: 24.1[samples/s]
2022-04-27 02:34:30,837 reid_baseline.train INFO: normal accuracy 0.7080423518810542 2.6047096252441406 
2022-04-27 02:34:31,718 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 02:34:31,718 reid_baseline.train INFO: Accuracy: 70.8% Mean Entropy: 260.5%
2022-04-27 02:35:34,457 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.426, Acc: 0.769, Base Lr: 5.62e-03
Aug Cl acc: 0.17948665116962634
2022-04-27 02:36:04,282 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.609[s] Speed: 26.3[samples/s]
2022-04-27 02:37:05,751 reid_baseline.train INFO: normal accuracy 0.7364271232259518 2.2517995834350586 
2022-04-27 02:37:06,551 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 02:37:06,552 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 225.2%
2022-04-27 02:38:13,352 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.216, Acc: 0.833, Base Lr: 6.42e-03
Aug Cl acc: 0.17659479693362587
2022-04-27 02:38:46,213 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.654[s] Speed: 24.5[samples/s]
2022-04-27 02:39:44,284 reid_baseline.train INFO: normal accuracy 0.7553503041225501 2.0565707683563232 
2022-04-27 02:39:45,320 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 02:39:45,320 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 205.7%
2022-04-27 02:40:54,075 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.145, Acc: 0.848, Base Lr: 7.21e-03
Aug Cl acc: 0.16968228942469546
2022-04-27 02:41:24,251 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.651[s] Speed: 24.6[samples/s]
2022-04-27 02:42:23,669 reid_baseline.train INFO: normal accuracy 0.7616580310880829 1.8504793643951416 
2022-04-27 02:42:24,886 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 02:42:24,887 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 185.0%
2022-04-27 02:43:32,895 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.055, Acc: 0.879, Base Lr: 4.01e-03
Aug Cl acc: 0.16427125428852282
2022-04-27 02:43:59,445 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.622[s] Speed: 25.7[samples/s]
2022-04-27 02:45:02,448 reid_baseline.train INFO: normal accuracy 0.7681910340166704 1.8257100582122803 
2022-04-27 02:45:03,355 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 02:45:03,356 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 182.6%
2022-04-27 02:46:10,949 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.008, Acc: 0.900, Base Lr: 3.38e-03
Aug Cl acc: 0.17716730268378006
2022-04-27 02:46:44,043 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.662[s] Speed: 24.2[samples/s]
2022-04-27 02:47:46,179 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.7839082479476929 
2022-04-27 02:47:47,059 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 02:47:47,059 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 178.4%
2022-04-27 02:48:55,685 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.984, Acc: 0.893, Base Lr: 2.77e-03
Aug Cl acc: 0.1716274713215075
2022-04-27 02:49:24,572 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.640[s] Speed: 25.0[samples/s]
2022-04-27 02:50:27,570 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.7357791662216187 
2022-04-27 02:50:28,532 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 02:50:28,533 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 173.6%
2022-04-27 02:51:36,243 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.963, Acc: 0.895, Base Lr: 2.20e-03
Aug Cl acc: 0.18225505477503726
2022-04-27 02:52:08,723 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.659[s] Speed: 24.3[samples/s]
2022-04-27 02:53:11,076 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.7695928812026978 
2022-04-27 02:53:11,076 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 02:53:11,076 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 177.0%
2022-04-27 02:54:17,437 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.940, Acc: 0.911, Base Lr: 1.66e-03
Aug Cl acc: 0.18315779535393967
2022-04-27 02:54:51,374 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.660[s] Speed: 24.3[samples/s]
2022-04-27 02:55:52,396 reid_baseline.train INFO: normal accuracy 0.7769767965758053 1.7228416204452515 
2022-04-27 02:55:53,418 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 02:55:53,418 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 172.3%
2022-04-27 02:56:59,345 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.928, Acc: 0.913, Base Lr: 1.19e-03
Aug Cl acc: 0.17834647078263133
2022-04-27 02:57:32,550 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.652[s] Speed: 24.5[samples/s]
2022-04-27 02:58:35,351 reid_baseline.train INFO: normal accuracy 0.7760756927235863 1.699933648109436 
2022-04-27 02:58:36,190 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 02:58:36,191 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 170.0%
2022-04-27 02:59:42,200 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.934, Acc: 0.906, Base Lr: 7.78e-04
Aug Cl acc: 0.18678552226016396
2022-04-27 03:00:16,811 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.661[s] Speed: 24.2[samples/s]
2022-04-27 03:01:14,569 reid_baseline.train INFO: normal accuracy 0.7760756927235863 1.6288905143737793 
2022-04-27 03:01:15,487 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 03:01:15,487 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 162.9%
2022-04-27 03:02:22,159 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.898, Acc: 0.924, Base Lr: 4.51e-04
Aug Cl acc: 0.17755308904145894
2022-04-27 03:02:53,950 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.647[s] Speed: 24.7[samples/s]
2022-04-27 03:03:54,153 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.7329936027526855 
2022-04-27 03:03:54,153 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 03:03:54,153 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 173.3%
2022-04-27 03:05:01,169 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.916, Acc: 0.921, Base Lr: 2.11e-04
Aug Cl acc: 0.18151147742020457
2022-04-27 03:05:34,962 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.663[s] Speed: 24.1[samples/s]
2022-04-27 03:06:37,155 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6786903142929077 
2022-04-27 03:06:37,160 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 03:06:37,160 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 167.9%
2022-04-27 03:07:43,864 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.905, Acc: 0.906, Base Lr: 6.51e-05
Aug Cl acc: 0.1816847700821726
2022-04-27 03:08:17,635 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.660[s] Speed: 24.2[samples/s]
2022-04-27 03:09:12,983 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.709641456604004 
2022-04-27 03:09:12,988 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 03:09:12,988 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 171.0%
2022-04-27 03:10:20,266 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.904, Acc: 0.907, Base Lr: 1.60e-05
Aug Cl acc: 0.18467723695855393
2022-04-27 03:10:51,177 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.645[s] Speed: 24.8[samples/s]
2022-04-27 03:11:55,865 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.7176623344421387 
2022-04-27 03:11:55,870 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 03:11:55,870 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 171.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-27 03:12:57,904 reid_baseline.train INFO: normal accuracy 0.7760756927235863 1.6288905143737793 
2022-04-27 03:12:57,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 03:12:57,904 reid_baseline.train INFO: Accuracy: 77.6%
2022-04-27 03:14:00,388 reid_baseline.train INFO: normal accuracy 0.7760756927235863 1.6288905143737793 
2022-04-27 03:14:00,389 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 03:14:00,389 reid_baseline.train INFO: Shuffled Accuracy: 77.6%
2022-04-27 03:14:41,437 reid_baseline.train INFO: normal accuracy 0.9649773382777092 0.8637405633926392 
2022-04-27 03:14:41,437 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 03:14:41,437 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-27 03:14:48,686 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6
2022-04-27 03:14:48,686 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-27 03:14:48,686 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 03:14:48,686 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 03:14:48,687 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 03:15:02,500 reid_baseline.train INFO: start training
2022-04-27 03:16:28,816 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.056, Acc: 0.252, Base Lr: 8.72e-04
Aug Cl acc: 0.17531095053020276
2022-04-27 03:17:03,171 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.757[s] Speed: 21.1[samples/s]
2022-04-27 03:19:23,425 reid_baseline.train INFO: normal accuracy 0.5671333486343815 4.172108173370361 
2022-04-27 03:19:24,469 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 03:19:24,470 reid_baseline.train INFO: Accuracy: 56.7% Mean Entropy: 417.2%
2022-04-27 03:20:30,425 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.703, Acc: 0.562, Base Lr: 1.66e-03
Aug Cl acc: 0.17426746769955284
2022-04-27 03:21:03,192 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.649[s] Speed: 24.6[samples/s]
2022-04-27 03:23:17,311 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.150995254516602 
2022-04-27 03:23:18,642 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 03:23:18,642 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 415.1%
2022-04-27 03:24:24,788 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.201, Acc: 0.594, Base Lr: 2.46e-03
Aug Cl acc: 0.18725644914727463
2022-04-27 03:24:52,302 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.616[s] Speed: 26.0[samples/s]
2022-04-27 03:27:03,569 reid_baseline.train INFO: normal accuracy 0.6125774615561166 3.956868886947632 
2022-04-27 03:27:04,471 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 03:27:04,472 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 395.7%
2022-04-27 03:28:15,106 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.474, Acc: 0.630, Base Lr: 3.25e-03
Aug Cl acc: 0.17852542274876645
2022-04-27 03:28:50,480 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.697[s] Speed: 23.0[samples/s]
2022-04-27 03:31:02,044 reid_baseline.train INFO: normal accuracy 0.6371356437915997 3.387341260910034 
2022-04-27 03:31:03,004 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 03:31:03,005 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 338.7%
2022-04-27 03:32:10,984 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.930, Acc: 0.675, Base Lr: 4.04e-03
Aug Cl acc: 0.17265490481728002
2022-04-27 03:32:40,001 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.637[s] Speed: 25.1[samples/s]
2022-04-27 03:34:52,130 reid_baseline.train INFO: normal accuracy 0.7034656873995869 2.7073020935058594 
2022-04-27 03:34:53,369 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 03:34:53,369 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 270.7%
2022-04-27 03:36:03,505 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.612, Acc: 0.731, Base Lr: 4.83e-03
Aug Cl acc: 0.1835684525339227
2022-04-27 03:36:33,482 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.658[s] Speed: 24.3[samples/s]
2022-04-27 03:38:44,131 reid_baseline.train INFO: normal accuracy 0.757631397750746 2.3103203773498535 
2022-04-27 03:38:45,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 03:38:45,162 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 231.0%
2022-04-27 03:39:50,081 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.426, Acc: 0.769, Base Lr: 5.62e-03
Aug Cl acc: 0.17948665116962634
2022-04-27 03:40:18,364 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.613[s] Speed: 26.1[samples/s]
2022-04-27 03:42:38,729 reid_baseline.train INFO: normal accuracy 0.7842552214826716 1.9894781112670898 
2022-04-27 03:42:39,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 03:42:39,687 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 198.9%
2022-04-27 03:43:44,909 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.216, Acc: 0.834, Base Lr: 6.42e-03
Aug Cl acc: 0.17545262135957418
2022-04-27 03:44:15,648 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.631[s] Speed: 25.4[samples/s]
2022-04-27 03:46:22,945 reid_baseline.train INFO: normal accuracy 0.8019279320633463 1.79701566696167 
2022-04-27 03:46:23,748 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 03:46:23,748 reid_baseline.train INFO: Accuracy: 80.2% Mean Entropy: 179.7%
2022-04-27 03:47:31,361 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.144, Acc: 0.847, Base Lr: 7.21e-03
Aug Cl acc: 0.1705046578457481
2022-04-27 03:48:00,618 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.637[s] Speed: 25.1[samples/s]
2022-04-27 03:50:12,728 reid_baseline.train INFO: normal accuracy 0.8101904980491164 1.6102797985076904 
2022-04-27 03:50:13,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 03:50:13,729 reid_baseline.train INFO: Accuracy: 81.0% Mean Entropy: 161.0%
2022-04-27 03:51:21,970 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.055, Acc: 0.879, Base Lr: 4.01e-03
Aug Cl acc: 0.1638600700779965
2022-04-27 03:51:53,465 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.655[s] Speed: 24.4[samples/s]
2022-04-27 03:54:20,393 reid_baseline.train INFO: normal accuracy 0.8170759697039247 1.582194209098816 
2022-04-27 03:54:21,354 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 03:54:21,354 reid_baseline.train INFO: Accuracy: 81.7% Mean Entropy: 158.2%
2022-04-27 03:55:25,008 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.008, Acc: 0.901, Base Lr: 3.38e-03
Aug Cl acc: 0.17675611847325376
2022-04-27 03:55:57,217 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.631[s] Speed: 25.4[samples/s]
2022-04-27 03:58:09,775 reid_baseline.train INFO: normal accuracy 0.8232728941932522 1.5431941747665405 
2022-04-27 03:58:10,978 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 03:58:10,979 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 154.3%
2022-04-27 03:59:18,438 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.984, Acc: 0.892, Base Lr: 2.77e-03
Aug Cl acc: 0.1716274713215075
2022-04-27 03:59:50,721 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.656[s] Speed: 24.4[samples/s]
2022-04-27 04:02:05,579 reid_baseline.train INFO: normal accuracy 0.8239614413587331 1.5074973106384277 
2022-04-27 04:02:06,466 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 04:02:06,467 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 150.7%
2022-04-27 04:03:07,898 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.963, Acc: 0.895, Base Lr: 2.20e-03
Aug Cl acc: 0.18184385801616468
2022-04-27 04:03:42,355 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.631[s] Speed: 25.4[samples/s]
2022-04-27 04:06:04,629 reid_baseline.train INFO: normal accuracy 0.8251090199678678 1.5416284799575806 
2022-04-27 04:06:04,633 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 04:06:04,633 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 154.2%
2022-04-27 04:07:06,731 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.940, Acc: 0.911, Base Lr: 1.66e-03
Aug Cl acc: 0.18274661114341334
2022-04-27 04:07:42,566 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.644[s] Speed: 24.8[samples/s]
2022-04-27 04:09:57,356 reid_baseline.train INFO: normal accuracy 0.8218957998622906 1.5038542747497559 
2022-04-27 04:09:58,152 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 04:09:58,152 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 150.4%
2022-04-27 04:11:01,024 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.928, Acc: 0.913, Base Lr: 1.19e-03
Aug Cl acc: 0.17958002341421028
2022-04-27 04:11:37,550 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.653[s] Speed: 24.5[samples/s]
2022-04-27 04:13:50,495 reid_baseline.train INFO: normal accuracy 0.8264861142988295 1.487085223197937 
2022-04-27 04:13:51,560 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 04:13:51,561 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 148.7%
2022-04-27 04:14:56,324 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.934, Acc: 0.906, Base Lr: 7.78e-04
Aug Cl acc: 0.185551969628585
2022-04-27 04:15:28,207 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.635[s] Speed: 25.2[samples/s]
2022-04-27 04:17:44,900 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.4208078384399414 
2022-04-27 04:17:46,148 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 04:17:46,148 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 142.1%
2022-04-27 04:18:47,860 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.898, Acc: 0.924, Base Lr: 4.51e-04
Aug Cl acc: 0.17796427325198524
2022-04-27 04:19:20,611 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.621[s] Speed: 25.7[samples/s]
2022-04-27 04:21:32,930 reid_baseline.train INFO: normal accuracy 0.8264861142988295 1.527427315711975 
2022-04-27 04:21:32,935 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 04:21:32,935 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 152.7%
2022-04-27 04:22:42,353 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.916, Acc: 0.921, Base Lr: 2.11e-04
Aug Cl acc: 0.1813744118339137
2022-04-27 04:23:14,438 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.666[s] Speed: 24.0[samples/s]
2022-04-27 04:25:28,241 reid_baseline.train INFO: normal accuracy 0.8267156300206564 1.4725028276443481 
2022-04-27 04:25:28,243 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 04:25:28,244 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 147.3%
2022-04-27 04:26:28,301 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.905, Acc: 0.906, Base Lr: 6.51e-05
Aug Cl acc: 0.18127358587164627
2022-04-27 04:27:00,010 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.603[s] Speed: 26.5[samples/s]
2022-04-27 04:29:26,382 reid_baseline.train INFO: normal accuracy 0.8274041771861372 1.4977041482925415 
2022-04-27 04:29:26,386 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 04:29:26,387 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 149.8%
2022-04-27 04:30:31,244 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.904, Acc: 0.907, Base Lr: 1.60e-05
Aug Cl acc: 0.18508842116908023
2022-04-27 04:31:03,142 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.636[s] Speed: 25.2[samples/s]
2022-04-27 04:33:18,184 reid_baseline.train INFO: normal accuracy 0.8276336929079642 1.506116509437561 
2022-04-27 04:33:18,186 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 04:33:18,187 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 150.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-27 04:35:42,327 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.4208078384399414 
2022-04-27 04:35:42,328 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 04:35:42,328 reid_baseline.train INFO: Accuracy: 82.9%
2022-04-27 04:37:51,707 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.4208078384399414 
2022-04-27 04:37:51,707 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 04:37:51,707 reid_baseline.train INFO: Shuffled Accuracy: 82.9%
2022-04-27 04:38:34,395 reid_baseline.train INFO: normal accuracy 0.9649773382777092 0.8637612462043762 
2022-04-27 04:38:34,395 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 04:38:34,395 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
