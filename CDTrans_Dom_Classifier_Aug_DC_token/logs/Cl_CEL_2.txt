2022-04-19 16:13:00,007 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_1
2022-04-19 16:13:00,008 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-19 16:13:00,008 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 16:13:00,010 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 16:13:00,010 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 16:13:06,001 reid_baseline.train INFO: start training
2022-04-19 16:13:35,051 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.307, Acc: 0.219, Base Lr: 8.72e-04
2022-04-19 16:13:58,147 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.227, Acc: 0.299, Base Lr: 8.72e-04
2022-04-19 16:14:20,239 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.271[s] Speed: 59.1[samples/s]
2022-04-19 16:15:11,318 reid_baseline.train INFO: normal accuracy 0.5067985166872683 4.168853282928467 
2022-04-19 16:15:14,710 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 16:15:14,710 reid_baseline.train INFO: Accuracy: 50.7% Mean Entropy: 416.9%
2022-04-19 16:15:43,866 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.953, Acc: 0.473, Base Lr: 1.66e-03
2022-04-19 16:16:14,236 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.814, Acc: 0.484, Base Lr: 1.66e-03
2022-04-19 16:16:35,243 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-19 16:17:28,434 reid_baseline.train INFO: normal accuracy 0.5488257107540173 4.097784042358398 
2022-04-19 16:17:35,215 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 16:17:35,215 reid_baseline.train INFO: Accuracy: 54.9% Mean Entropy: 409.8%
2022-04-19 16:18:08,664 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 5.252, Acc: 0.520, Base Lr: 2.46e-03
2022-04-19 16:18:37,736 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 5.152, Acc: 0.513, Base Lr: 2.46e-03
2022-04-19 16:19:00,332 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-19 16:19:33,239 reid_baseline.train INFO: normal accuracy 0.6098063452822414 3.8573358058929443 
2022-04-19 16:19:36,453 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 16:19:36,453 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 385.7%
2022-04-19 16:20:02,309 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.657, Acc: 0.557, Base Lr: 3.25e-03
2022-04-19 16:20:22,149 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.567, Acc: 0.583, Base Lr: 3.25e-03
2022-04-19 16:20:37,277 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.223[s] Speed: 71.8[samples/s]
2022-04-19 16:20:59,899 reid_baseline.train INFO: normal accuracy 0.6658426040379068 3.7362966537475586 
2022-04-19 16:21:03,305 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 16:21:03,305 reid_baseline.train INFO: Accuracy: 66.6% Mean Entropy: 373.6%
2022-04-19 16:21:23,478 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 4.284, Acc: 0.644, Base Lr: 4.04e-03
2022-04-19 16:21:52,929 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 4.267, Acc: 0.633, Base Lr: 4.04e-03
2022-04-19 16:22:13,321 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.256[s] Speed: 62.4[samples/s]
2022-04-19 16:22:34,926 reid_baseline.train INFO: normal accuracy 0.6468891635764318 3.838022470474243 
2022-04-19 16:22:34,926 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 16:22:34,926 reid_baseline.train INFO: Accuracy: 64.7% Mean Entropy: 383.8%
2022-04-19 16:22:56,232 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 4.173, Acc: 0.666, Base Lr: 4.83e-03
2022-04-19 16:23:16,545 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 4.166, Acc: 0.666, Base Lr: 4.83e-03
2022-04-19 16:23:30,843 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.205[s] Speed: 78.1[samples/s]
2022-04-19 16:23:54,978 reid_baseline.train INFO: normal accuracy 0.7058096415327565 3.3259479999542236 
2022-04-19 16:23:58,088 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 16:23:58,088 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 332.6%
2022-04-19 16:24:23,903 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 4.100, Acc: 0.691, Base Lr: 5.62e-03
2022-04-19 16:24:44,162 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 4.061, Acc: 0.693, Base Lr: 5.62e-03
2022-04-19 16:24:59,449 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.225[s] Speed: 71.2[samples/s]
2022-04-19 16:25:22,990 reid_baseline.train INFO: normal accuracy 0.6440049443757726 3.5872371196746826 
2022-04-19 16:25:22,990 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 16:25:22,991 reid_baseline.train INFO: Accuracy: 64.4% Mean Entropy: 358.7%
2022-04-19 16:25:44,086 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.968, Acc: 0.722, Base Lr: 6.42e-03
2022-04-19 16:26:11,775 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.971, Acc: 0.715, Base Lr: 6.42e-03
2022-04-19 16:26:31,414 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.251[s] Speed: 63.8[samples/s]
2022-04-19 16:26:53,444 reid_baseline.train INFO: normal accuracy 0.6802637000412032 3.4400570392608643 
2022-04-19 16:26:53,445 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 16:26:53,445 reid_baseline.train INFO: Accuracy: 68.0% Mean Entropy: 344.0%
2022-04-19 16:27:14,756 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.951, Acc: 0.710, Base Lr: 7.21e-03
2022-04-19 16:27:34,466 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.939, Acc: 0.722, Base Lr: 7.21e-03
2022-04-19 16:27:49,275 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.204[s] Speed: 78.2[samples/s]
2022-04-19 16:28:10,334 reid_baseline.train INFO: normal accuracy 0.6588380716934487 3.458120107650757 
2022-04-19 16:28:10,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 16:28:10,335 reid_baseline.train INFO: Accuracy: 65.9% Mean Entropy: 345.8%
2022-04-19 16:28:38,639 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.835, Acc: 0.747, Base Lr: 4.01e-03
2022-04-19 16:28:57,721 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.845, Acc: 0.760, Base Lr: 4.01e-03
2022-04-19 16:29:12,374 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.227[s] Speed: 70.4[samples/s]
2022-04-19 16:29:38,265 reid_baseline.train INFO: normal accuracy 0.5875566543057272 3.4510550498962402 
2022-04-19 16:29:38,265 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 16:29:38,265 reid_baseline.train INFO: Accuracy: 58.8% Mean Entropy: 345.1%
2022-04-19 16:29:58,519 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.796, Acc: 0.761, Base Lr: 3.38e-03
2022-04-19 16:30:25,801 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.827, Acc: 0.754, Base Lr: 3.38e-03
2022-04-19 16:30:46,577 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.250[s] Speed: 63.9[samples/s]
2022-04-19 16:31:08,566 reid_baseline.train INFO: normal accuracy 0.5517099299546766 3.699909210205078 
2022-04-19 16:31:08,567 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 16:31:08,567 reid_baseline.train INFO: Accuracy: 55.2% Mean Entropy: 370.0%
2022-04-19 16:31:30,244 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.847, Acc: 0.749, Base Lr: 2.77e-03
2022-04-19 16:31:49,964 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.804, Acc: 0.767, Base Lr: 2.77e-03
2022-04-19 16:32:04,414 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.205[s] Speed: 78.2[samples/s]
2022-04-19 16:32:25,285 reid_baseline.train INFO: normal accuracy 0.6238154099711578 3.3878397941589355 
2022-04-19 16:32:25,286 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 16:32:25,286 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 338.8%
2022-04-19 16:32:55,139 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.767, Acc: 0.770, Base Lr: 2.20e-03
2022-04-19 16:33:14,160 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.759, Acc: 0.777, Base Lr: 2.20e-03
2022-04-19 16:33:28,631 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.232[s] Speed: 69.0[samples/s]
2022-04-19 16:33:53,738 reid_baseline.train INFO: normal accuracy 0.5282241450350227 3.6307361125946045 
2022-04-19 16:33:53,739 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 16:33:53,739 reid_baseline.train INFO: Accuracy: 52.8% Mean Entropy: 363.1%
2022-04-19 16:34:15,621 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.742, Acc: 0.776, Base Lr: 1.66e-03
2022-04-19 16:34:40,448 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.747, Acc: 0.779, Base Lr: 1.66e-03
2022-04-19 16:35:02,694 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.253[s] Speed: 63.3[samples/s]
2022-04-19 16:35:38,218 reid_baseline.train INFO: normal accuracy 0.5241038318912238 3.672366142272949 
2022-04-19 16:35:38,219 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 16:35:38,219 reid_baseline.train INFO: Accuracy: 52.4% Mean Entropy: 367.2%
2022-04-19 16:36:10,909 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.763, Acc: 0.777, Base Lr: 1.19e-03
2022-04-19 16:36:41,645 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.787, Acc: 0.770, Base Lr: 1.19e-03
2022-04-19 16:37:04,758 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-19 16:38:00,935 reid_baseline.train INFO: normal accuracy 0.5356407086938607 3.6296980381011963 
2022-04-19 16:38:00,935 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 16:38:00,935 reid_baseline.train INFO: Accuracy: 53.6% Mean Entropy: 363.0%
2022-04-19 16:38:33,861 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.754, Acc: 0.781, Base Lr: 7.78e-04
2022-04-19 16:39:03,633 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.776, Acc: 0.778, Base Lr: 7.78e-04
2022-04-19 16:39:26,350 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-19 16:40:21,447 reid_baseline.train INFO: normal accuracy 0.5657189946435929 3.539926767349243 
2022-04-19 16:40:21,447 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 16:40:21,448 reid_baseline.train INFO: Accuracy: 56.6% Mean Entropy: 354.0%
2022-04-19 16:40:55,637 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.748, Acc: 0.777, Base Lr: 4.51e-04
2022-04-19 16:41:26,327 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.742, Acc: 0.780, Base Lr: 4.51e-04
2022-04-19 16:41:47,201 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.314[s] Speed: 50.9[samples/s]
2022-04-19 16:42:42,842 reid_baseline.train INFO: normal accuracy 0.5063864853728883 3.6434919834136963 
2022-04-19 16:42:42,843 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 16:42:42,843 reid_baseline.train INFO: Accuracy: 50.6% Mean Entropy: 364.3%
2022-04-19 16:43:16,827 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.714, Acc: 0.782, Base Lr: 2.11e-04
2022-04-19 16:43:43,585 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.689, Acc: 0.788, Base Lr: 2.11e-04
2022-04-19 16:43:58,327 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.276[s] Speed: 57.9[samples/s]
2022-04-19 16:44:52,138 reid_baseline.train INFO: normal accuracy 0.5212196126905645 3.6032376289367676 
2022-04-19 16:44:52,139 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 16:44:52,139 reid_baseline.train INFO: Accuracy: 52.1% Mean Entropy: 360.3%
2022-04-19 16:45:26,060 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.691, Acc: 0.796, Base Lr: 6.51e-05
2022-04-19 16:45:54,918 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.738, Acc: 0.787, Base Lr: 6.51e-05
2022-04-19 16:46:17,505 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-19 16:47:14,838 reid_baseline.train INFO: normal accuracy 0.5405850844664194 3.5970394611358643 
2022-04-19 16:47:14,840 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 16:47:14,840 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 359.7%
2022-04-19 16:47:48,888 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.752, Acc: 0.788, Base Lr: 1.60e-05
2022-04-19 16:48:18,813 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.781, Acc: 0.775, Base Lr: 1.60e-05
2022-04-19 16:48:41,193 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-19 16:49:42,695 reid_baseline.train INFO: normal accuracy 0.5265760197775031 3.5847766399383545 
2022-04-19 16:49:42,695 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 16:49:42,695 reid_baseline.train INFO: Accuracy: 52.7% Mean Entropy: 358.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_1/transformer_best_model.pth
2022-04-19 16:50:16,710 reid_baseline.train INFO: normal accuracy 0.7058096415327565 3.3259479999542236 
2022-04-19 16:50:16,710 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 16:50:16,710 reid_baseline.train INFO: Accuracy: 70.6%
2022-04-19 16:50:39,869 reid_baseline.train INFO: normal accuracy 0.7058096415327565 3.3259479999542236 
2022-04-19 16:50:39,869 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 16:50:39,869 reid_baseline.train INFO: Shuffled Accuracy: 70.6%
2022-04-19 16:51:03,756 reid_baseline.train INFO: normal accuracy 0.8400916380297824 2.8684511184692383 
2022-04-19 16:51:03,757 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 16:51:03,757 reid_baseline.train INFO: Source Clean Accuracy: 84.0%
2022-04-19 16:51:07,403 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_2
2022-04-19 16:51:07,404 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-19 16:51:07,404 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 16:51:07,404 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 16:51:07,404 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 16:51:12,267 reid_baseline.train INFO: start training
2022-04-19 16:51:35,796 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.276, Acc: 0.221, Base Lr: 8.72e-04
2022-04-19 16:51:56,609 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.199, Acc: 0.302, Base Lr: 8.72e-04
2022-04-19 16:52:10,830 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.213[s] Speed: 75.0[samples/s]
2022-04-19 16:52:34,539 reid_baseline.train INFO: normal accuracy 0.4956736711990111 4.168959140777588 
2022-04-19 16:52:37,762 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 16:52:37,762 reid_baseline.train INFO: Accuracy: 49.6% Mean Entropy: 416.9%
2022-04-19 16:53:05,693 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.879, Acc: 0.472, Base Lr: 1.66e-03
2022-04-19 16:53:34,443 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.802, Acc: 0.477, Base Lr: 1.66e-03
2022-04-19 16:53:56,226 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.287[s] Speed: 55.7[samples/s]
2022-04-19 16:54:53,380 reid_baseline.train INFO: normal accuracy 0.5488257107540173 4.092137336730957 
2022-04-19 16:54:56,545 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 16:54:56,546 reid_baseline.train INFO: Accuracy: 54.9% Mean Entropy: 409.2%
2022-04-19 16:55:18,060 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 5.252, Acc: 0.512, Base Lr: 2.46e-03
2022-04-19 16:55:42,718 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 5.124, Acc: 0.521, Base Lr: 2.46e-03
2022-04-19 16:56:03,172 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.244[s] Speed: 65.6[samples/s]
2022-04-19 16:56:27,004 reid_baseline.train INFO: normal accuracy 0.61516275236918 3.630643606185913 
2022-04-19 16:56:30,216 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 16:56:30,216 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 363.1%
2022-04-19 16:56:51,757 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.687, Acc: 0.572, Base Lr: 3.25e-03
2022-04-19 16:57:11,936 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.612, Acc: 0.576, Base Lr: 3.25e-03
2022-04-19 16:57:27,215 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.209[s] Speed: 76.6[samples/s]
2022-04-19 16:57:51,051 reid_baseline.train INFO: normal accuracy 0.6625463535228677 3.1143012046813965 
2022-04-19 16:57:54,275 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 16:57:54,275 reid_baseline.train INFO: Accuracy: 66.3% Mean Entropy: 311.4%
2022-04-19 16:58:18,983 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 4.316, Acc: 0.634, Base Lr: 4.04e-03
2022-04-19 16:58:37,785 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 4.326, Acc: 0.636, Base Lr: 4.04e-03
2022-04-19 16:58:52,490 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.213[s] Speed: 75.0[samples/s]
2022-04-19 16:59:17,475 reid_baseline.train INFO: normal accuracy 0.6983930778739185 2.797356605529785 
2022-04-19 16:59:20,622 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 16:59:20,623 reid_baseline.train INFO: Accuracy: 69.8% Mean Entropy: 279.7%
2022-04-19 16:59:41,148 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 4.195, Acc: 0.670, Base Lr: 4.83e-03
2022-04-19 17:00:07,675 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 4.219, Acc: 0.668, Base Lr: 4.83e-03
2022-04-19 17:00:26,569 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.242[s] Speed: 66.2[samples/s]
2022-04-19 17:00:51,042 reid_baseline.train INFO: normal accuracy 0.715286361763494 2.683117389678955 
2022-04-19 17:00:54,332 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 17:00:54,333 reid_baseline.train INFO: Accuracy: 71.5% Mean Entropy: 268.3%
2022-04-19 17:01:16,159 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 4.060, Acc: 0.702, Base Lr: 5.62e-03
2022-04-19 17:01:36,127 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 4.026, Acc: 0.707, Base Lr: 5.62e-03
2022-04-19 17:01:50,092 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.204[s] Speed: 78.3[samples/s]
2022-04-19 17:02:12,149 reid_baseline.train INFO: normal accuracy 0.7189946435929131 2.513381004333496 
2022-04-19 17:02:15,330 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 17:02:15,330 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 251.3%
2022-04-19 17:02:42,015 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 4.000, Acc: 0.698, Base Lr: 6.42e-03
2022-04-19 17:03:01,031 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.986, Acc: 0.704, Base Lr: 6.42e-03
2022-04-19 17:03:15,582 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-19 17:03:39,912 reid_baseline.train INFO: normal accuracy 0.7284713638236506 2.47922420501709 
2022-04-19 17:03:43,138 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 17:03:43,138 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 247.9%
2022-04-19 17:04:03,969 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.882, Acc: 0.740, Base Lr: 7.21e-03
2022-04-19 17:04:21,257 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.845, Acc: 0.745, Base Lr: 7.21e-03
2022-04-19 17:04:36,720 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.196[s] Speed: 81.5[samples/s]
2022-04-19 17:05:01,571 reid_baseline.train INFO: normal accuracy 0.723114956736712 2.2551677227020264 
2022-04-19 17:05:04,686 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 17:05:04,687 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 225.5%
2022-04-19 17:05:26,526 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.833, Acc: 0.753, Base Lr: 4.01e-03
2022-04-19 17:05:44,492 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.850, Acc: 0.753, Base Lr: 4.01e-03
2022-04-19 17:05:58,162 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.196[s] Speed: 81.7[samples/s]
2022-04-19 17:06:26,815 reid_baseline.train INFO: normal accuracy 0.73094355170993 2.087057590484619 
2022-04-19 17:06:29,935 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 17:06:29,935 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 208.7%
2022-04-19 17:06:50,416 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.853, Acc: 0.752, Base Lr: 3.38e-03
2022-04-19 17:07:09,677 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.853, Acc: 0.754, Base Lr: 3.38e-03
2022-04-19 17:07:25,700 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.204[s] Speed: 78.3[samples/s]
2022-04-19 17:07:48,699 reid_baseline.train INFO: normal accuracy 0.7362999587968686 2.1838791370391846 
2022-04-19 17:07:48,700 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 17:07:48,700 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 218.4%
2022-04-19 17:08:16,003 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.734, Acc: 0.785, Base Lr: 2.77e-03
2022-04-19 17:08:38,863 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.778, Acc: 0.767, Base Lr: 2.77e-03
2022-04-19 17:08:53,291 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.237[s] Speed: 67.6[samples/s]
2022-04-19 17:09:18,583 reid_baseline.train INFO: normal accuracy 0.7284713638236506 2.2040774822235107 
2022-04-19 17:09:18,583 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 17:09:18,583 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 220.4%
2022-04-19 17:09:39,680 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.810, Acc: 0.767, Base Lr: 2.20e-03
2022-04-19 17:09:58,967 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.824, Acc: 0.768, Base Lr: 2.20e-03
2022-04-19 17:10:18,123 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.218[s] Speed: 73.4[samples/s]
2022-04-19 17:10:55,881 reid_baseline.train INFO: normal accuracy 0.7301194890811702 2.144047260284424 
2022-04-19 17:10:55,881 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 17:10:55,881 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 214.4%
2022-04-19 17:11:30,155 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.779, Acc: 0.768, Base Lr: 1.66e-03
2022-04-19 17:11:59,035 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.786, Acc: 0.770, Base Lr: 1.66e-03
2022-04-19 17:12:21,380 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-19 17:12:44,553 reid_baseline.train INFO: normal accuracy 0.7313555830243098 2.2533135414123535 
2022-04-19 17:12:44,553 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 17:12:44,553 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 225.3%
2022-04-19 17:13:11,482 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.694, Acc: 0.789, Base Lr: 1.19e-03
2022-04-19 17:13:35,898 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.746, Acc: 0.779, Base Lr: 1.19e-03
2022-04-19 17:13:50,504 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.242[s] Speed: 66.2[samples/s]
2022-04-19 17:14:17,216 reid_baseline.train INFO: normal accuracy 0.7379480840543882 2.1784534454345703 
2022-04-19 17:14:17,216 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 17:14:17,217 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 217.8%
2022-04-19 17:14:37,643 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.834, Acc: 0.770, Base Lr: 7.78e-04
2022-04-19 17:14:56,330 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.764, Acc: 0.780, Base Lr: 7.78e-04
2022-04-19 17:15:15,266 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.213[s] Speed: 75.2[samples/s]
2022-04-19 17:15:40,557 reid_baseline.train INFO: normal accuracy 0.7391841779975278 2.175377130508423 
2022-04-19 17:15:40,557 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 17:15:40,557 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 217.5%
2022-04-19 17:16:00,752 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.723, Acc: 0.784, Base Lr: 4.51e-04
2022-04-19 17:16:21,322 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.754, Acc: 0.780, Base Lr: 4.51e-04
2022-04-19 17:16:35,534 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.201[s] Speed: 79.5[samples/s]
2022-04-19 17:16:59,853 reid_baseline.train INFO: normal accuracy 0.7371240214256284 2.2270009517669678 
2022-04-19 17:16:59,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 17:16:59,853 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 222.7%
2022-04-19 17:17:26,567 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.754, Acc: 0.775, Base Lr: 2.11e-04
2022-04-19 17:17:52,570 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.741, Acc: 0.781, Base Lr: 2.11e-04
2022-04-19 17:18:07,070 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.246[s] Speed: 65.0[samples/s]
2022-04-19 17:18:32,648 reid_baseline.train INFO: normal accuracy 0.7395962093119077 2.126898765563965 
2022-04-19 17:18:32,648 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 17:18:32,648 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 212.7%
2022-04-19 17:18:53,409 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.775, Acc: 0.772, Base Lr: 6.51e-05
2022-04-19 17:19:14,185 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.765, Acc: 0.780, Base Lr: 6.51e-05
2022-04-19 17:19:29,307 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.208[s] Speed: 77.1[samples/s]
2022-04-19 17:19:53,484 reid_baseline.train INFO: normal accuracy 0.734651833539349 2.159214735031128 
2022-04-19 17:19:53,485 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 17:19:53,485 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 215.9%
2022-04-19 17:20:14,879 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.768, Acc: 0.770, Base Lr: 1.60e-05
2022-04-19 17:20:35,054 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.756, Acc: 0.777, Base Lr: 1.60e-05
2022-04-19 17:20:49,748 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.206[s] Speed: 77.6[samples/s]
2022-04-19 17:21:17,563 reid_baseline.train INFO: normal accuracy 0.7362999587968686 2.19425630569458 
2022-04-19 17:21:17,563 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 17:21:17,563 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 219.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_2/transformer_best_model.pth
2022-04-19 17:21:47,944 reid_baseline.train INFO: normal accuracy 0.73094355170993 2.087057590484619 
2022-04-19 17:21:47,944 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:21:47,944 reid_baseline.train INFO: Accuracy: 73.1%
2022-04-19 17:22:09,848 reid_baseline.train INFO: normal accuracy 0.73094355170993 2.087057590484619 
2022-04-19 17:22:09,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:22:09,849 reid_baseline.train INFO: Shuffled Accuracy: 73.1%
2022-04-19 17:22:38,895 reid_baseline.train INFO: normal accuracy 0.9328751431844216 0.8534253239631653 
2022-04-19 17:22:38,896 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:22:38,896 reid_baseline.train INFO: Source Clean Accuracy: 93.3%
2022-04-19 17:22:43,091 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_3
2022-04-19 17:22:43,091 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-19 17:22:43,091 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 17:22:43,092 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 17:22:43,092 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 17:22:48,592 reid_baseline.train INFO: start training
2022-04-19 17:23:13,192 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.277, Acc: 0.214, Base Lr: 8.72e-04
2022-04-19 17:23:33,380 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.202, Acc: 0.302, Base Lr: 8.72e-04
2022-04-19 17:23:53,184 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.236[s] Speed: 67.9[samples/s]
2022-04-19 17:24:16,360 reid_baseline.train INFO: normal accuracy 0.5043263288009888 4.169018268585205 
2022-04-19 17:24:19,479 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 17:24:19,480 reid_baseline.train INFO: Accuracy: 50.4% Mean Entropy: 416.9%
2022-04-19 17:24:41,439 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.893, Acc: 0.490, Base Lr: 1.66e-03
2022-04-19 17:25:01,894 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.777, Acc: 0.504, Base Lr: 1.66e-03
2022-04-19 17:25:16,959 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.211[s] Speed: 76.0[samples/s]
2022-04-19 17:25:40,350 reid_baseline.train INFO: normal accuracy 0.5389369592088998 4.089772701263428 
2022-04-19 17:25:43,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 17:25:43,687 reid_baseline.train INFO: Accuracy: 53.9% Mean Entropy: 409.0%
2022-04-19 17:26:09,223 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 5.248, Acc: 0.511, Base Lr: 2.46e-03
2022-04-19 17:26:34,513 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 5.145, Acc: 0.513, Base Lr: 2.46e-03
2022-04-19 17:26:48,163 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.236[s] Speed: 67.7[samples/s]
2022-04-19 17:27:13,097 reid_baseline.train INFO: normal accuracy 0.6126905644829007 3.6006946563720703 
2022-04-19 17:27:16,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 17:27:16,277 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 360.1%
2022-04-19 17:27:38,076 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.636, Acc: 0.560, Base Lr: 3.25e-03
2022-04-19 17:27:57,578 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.566, Acc: 0.564, Base Lr: 3.25e-03
2022-04-19 17:28:15,183 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.216[s] Speed: 74.2[samples/s]
2022-04-19 17:28:40,145 reid_baseline.train INFO: normal accuracy 0.6695508858673259 3.02579665184021 
2022-04-19 17:28:45,861 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 17:28:45,862 reid_baseline.train INFO: Accuracy: 67.0% Mean Entropy: 302.6%
2022-04-19 17:29:06,019 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 4.311, Acc: 0.639, Base Lr: 4.04e-03
2022-04-19 17:29:27,076 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 4.330, Acc: 0.637, Base Lr: 4.04e-03
2022-04-19 17:29:41,866 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.205[s] Speed: 78.0[samples/s]
2022-04-19 17:30:06,436 reid_baseline.train INFO: normal accuracy 0.6971569839307787 2.7099342346191406 
2022-04-19 17:30:09,562 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 17:30:09,562 reid_baseline.train INFO: Accuracy: 69.7% Mean Entropy: 271.0%
2022-04-19 17:30:36,785 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 4.129, Acc: 0.677, Base Lr: 4.83e-03
2022-04-19 17:31:04,628 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 4.134, Acc: 0.675, Base Lr: 4.83e-03
2022-04-19 17:31:26,354 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-19 17:32:13,120 reid_baseline.train INFO: normal accuracy 0.7086938607334158 2.476760149002075 
2022-04-19 17:32:16,286 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 17:32:16,287 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 247.7%
2022-04-19 17:32:38,108 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 4.077, Acc: 0.673, Base Lr: 5.62e-03
2022-04-19 17:32:56,282 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 4.045, Acc: 0.693, Base Lr: 5.62e-03
2022-04-19 17:33:12,951 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.208[s] Speed: 77.1[samples/s]
2022-04-19 17:33:36,967 reid_baseline.train INFO: normal accuracy 0.7239390193654718 2.3431098461151123 
2022-04-19 17:33:40,265 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 17:33:40,265 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 234.3%
2022-04-19 17:34:01,034 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.910, Acc: 0.713, Base Lr: 6.42e-03
2022-04-19 17:34:21,743 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.935, Acc: 0.716, Base Lr: 6.42e-03
2022-04-19 17:34:36,237 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.205[s] Speed: 78.0[samples/s]
2022-04-19 17:34:58,956 reid_baseline.train INFO: normal accuracy 0.723114956736712 2.198908805847168 
2022-04-19 17:35:02,133 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 17:35:02,133 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 219.9%
2022-04-19 17:35:27,200 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.800, Acc: 0.749, Base Lr: 7.21e-03
2022-04-19 17:35:52,431 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.844, Acc: 0.748, Base Lr: 7.21e-03
2022-04-19 17:36:05,930 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.234[s] Speed: 68.5[samples/s]
2022-04-19 17:36:31,829 reid_baseline.train INFO: normal accuracy 0.7177585496497734 2.0560145378112793 
2022-04-19 17:36:35,033 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 17:36:35,034 reid_baseline.train INFO: Accuracy: 71.8% Mean Entropy: 205.6%
2022-04-19 17:36:56,787 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.904, Acc: 0.741, Base Lr: 4.01e-03
2022-04-19 17:37:16,499 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.902, Acc: 0.743, Base Lr: 4.01e-03
2022-04-19 17:37:35,446 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.221[s] Speed: 72.3[samples/s]
2022-04-19 17:38:01,797 reid_baseline.train INFO: normal accuracy 0.7288833951380305 2.071027994155884 
2022-04-19 17:38:01,797 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 17:38:01,797 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 207.1%
2022-04-19 17:38:23,724 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.857, Acc: 0.751, Base Lr: 3.38e-03
2022-04-19 17:38:43,857 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.832, Acc: 0.753, Base Lr: 3.38e-03
2022-04-19 17:38:59,310 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.211[s] Speed: 76.0[samples/s]
2022-04-19 17:39:21,169 reid_baseline.train INFO: normal accuracy 0.7395962093119077 2.054307699203491 
2022-04-19 17:39:26,453 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 17:39:26,453 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 205.4%
2022-04-19 17:39:54,446 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.773, Acc: 0.765, Base Lr: 2.77e-03
2022-04-19 17:40:17,544 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.777, Acc: 0.759, Base Lr: 2.77e-03
2022-04-19 17:40:32,147 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.241[s] Speed: 66.5[samples/s]
2022-04-19 17:40:55,980 reid_baseline.train INFO: normal accuracy 0.7362999587968686 2.0412087440490723 
2022-04-19 17:40:59,495 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 17:40:59,496 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 204.1%
2022-04-19 17:41:21,710 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.815, Acc: 0.777, Base Lr: 2.20e-03
2022-04-19 17:41:41,310 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.808, Acc: 0.776, Base Lr: 2.20e-03
2022-04-19 17:41:59,850 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.221[s] Speed: 72.4[samples/s]
2022-04-19 17:42:22,833 reid_baseline.train INFO: normal accuracy 0.7404202719406675 1.9686753749847412 
2022-04-19 17:42:26,266 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 17:42:26,267 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 196.9%
2022-04-19 17:42:48,150 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.790, Acc: 0.758, Base Lr: 1.66e-03
2022-04-19 17:43:07,813 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.771, Acc: 0.768, Base Lr: 1.66e-03
2022-04-19 17:43:22,441 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.206[s] Speed: 77.8[samples/s]
2022-04-19 17:43:48,007 reid_baseline.train INFO: normal accuracy 0.7391841779975278 2.0914008617401123 
2022-04-19 17:43:48,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 17:43:48,010 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 209.1%
2022-04-19 17:44:17,413 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.744, Acc: 0.788, Base Lr: 1.19e-03
2022-04-19 17:44:38,575 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.728, Acc: 0.793, Base Lr: 1.19e-03
2022-04-19 17:44:54,190 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.242[s] Speed: 66.0[samples/s]
2022-04-19 17:45:19,113 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.9666666984558105 
2022-04-19 17:45:22,223 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 17:45:22,223 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 196.7%
2022-04-19 17:45:43,468 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.728, Acc: 0.790, Base Lr: 7.78e-04
2022-04-19 17:46:01,665 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.734, Acc: 0.781, Base Lr: 7.78e-04
2022-04-19 17:46:20,725 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.214[s] Speed: 74.7[samples/s]
2022-04-19 17:46:43,813 reid_baseline.train INFO: normal accuracy 0.7478368355995055 2.019986152648926 
2022-04-19 17:46:43,814 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 17:46:43,814 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 202.0%
2022-04-19 17:47:05,366 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.831, Acc: 0.776, Base Lr: 4.51e-04
2022-04-19 17:47:25,378 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.834, Acc: 0.766, Base Lr: 4.51e-04
2022-04-19 17:47:40,136 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.206[s] Speed: 77.6[samples/s]
2022-04-19 17:48:02,994 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.9910306930541992 
2022-04-19 17:48:02,994 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 17:48:02,994 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 199.1%
2022-04-19 17:48:30,539 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.752, Acc: 0.786, Base Lr: 2.11e-04
2022-04-19 17:48:54,219 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.732, Acc: 0.789, Base Lr: 2.11e-04
2022-04-19 17:49:08,526 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.240[s] Speed: 66.7[samples/s]
2022-04-19 17:49:33,807 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.9785208702087402 
2022-04-19 17:49:33,809 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 17:49:33,809 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 197.9%
2022-04-19 17:49:54,290 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.812, Acc: 0.773, Base Lr: 6.51e-05
2022-04-19 17:50:13,544 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.793, Acc: 0.781, Base Lr: 6.51e-05
2022-04-19 17:50:33,907 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.220[s] Speed: 72.7[samples/s]
2022-04-19 17:51:26,120 reid_baseline.train INFO: normal accuracy 0.7412443345694273 2.045006275177002 
2022-04-19 17:51:26,120 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 17:51:26,120 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 204.5%
2022-04-19 17:51:53,011 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.767, Acc: 0.792, Base Lr: 1.60e-05
2022-04-19 17:52:12,765 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.758, Acc: 0.787, Base Lr: 1.60e-05
2022-04-19 17:52:28,049 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-19 17:52:53,307 reid_baseline.train INFO: normal accuracy 0.7441285537700866 1.9862675666809082 
2022-04-19 17:52:53,307 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 17:52:53,307 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 198.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_3/transformer_best_model.pth
2022-04-19 17:53:20,687 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.9666666984558105 
2022-04-19 17:53:20,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:53:20,687 reid_baseline.train INFO: Accuracy: 74.7%
2022-04-19 17:53:45,455 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.9666666984558105 
2022-04-19 17:53:45,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:53:45,456 reid_baseline.train INFO: Shuffled Accuracy: 74.7%
2022-04-19 17:54:12,949 reid_baseline.train INFO: normal accuracy 0.9525773195876288 0.8061791062355042 
2022-04-19 17:54:12,949 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:54:12,949 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-19 17:54:16,679 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_4
2022-04-19 17:54:16,680 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-19 17:54:16,680 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 17:54:16,680 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 17:54:16,680 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 17:54:21,268 reid_baseline.train INFO: start training
2022-04-19 17:54:43,077 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.256, Acc: 0.222, Base Lr: 8.72e-04
2022-04-19 17:55:03,434 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.192, Acc: 0.304, Base Lr: 8.72e-04
2022-04-19 17:55:18,458 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.209[s] Speed: 76.7[samples/s]
2022-04-19 17:55:42,944 reid_baseline.train INFO: normal accuracy 0.5014421096003296 4.168971538543701 
2022-04-19 17:55:46,000 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 17:55:46,000 reid_baseline.train INFO: Accuracy: 50.1% Mean Entropy: 416.9%
2022-04-19 17:56:07,652 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.927, Acc: 0.466, Base Lr: 1.66e-03
2022-04-19 17:56:26,392 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.802, Acc: 0.481, Base Lr: 1.66e-03
2022-04-19 17:56:45,812 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.219[s] Speed: 73.0[samples/s]
2022-04-19 17:57:08,147 reid_baseline.train INFO: normal accuracy 0.5566543057272353 4.091125011444092 
2022-04-19 17:57:11,416 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 17:57:11,417 reid_baseline.train INFO: Accuracy: 55.7% Mean Entropy: 409.1%
2022-04-19 17:57:32,904 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 5.251, Acc: 0.516, Base Lr: 2.46e-03
2022-04-19 17:57:52,891 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 5.112, Acc: 0.524, Base Lr: 2.46e-03
2022-04-19 17:58:08,629 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.210[s] Speed: 76.3[samples/s]
2022-04-19 17:58:30,342 reid_baseline.train INFO: normal accuracy 0.6131025957972805 3.601102113723755 
2022-04-19 17:59:55,391 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 17:59:55,397 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 360.1%
2022-04-19 18:00:25,198 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.657, Acc: 0.578, Base Lr: 3.25e-03
2022-04-19 18:00:48,773 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.592, Acc: 0.581, Base Lr: 3.25e-03
2022-04-19 18:01:03,404 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.249[s] Speed: 64.2[samples/s]
2022-04-19 18:01:28,011 reid_baseline.train INFO: normal accuracy 0.6740832303255048 3.0349326133728027 
2022-04-19 18:01:58,104 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 18:01:58,104 reid_baseline.train INFO: Accuracy: 67.4% Mean Entropy: 303.5%
2022-04-19 18:02:19,111 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 4.339, Acc: 0.635, Base Lr: 4.04e-03
2022-04-19 18:02:38,344 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 4.320, Acc: 0.640, Base Lr: 4.04e-03
2022-04-19 18:03:22,530 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-19 18:03:45,787 reid_baseline.train INFO: normal accuracy 0.6938607334157396 2.683943748474121 
2022-04-19 18:04:15,817 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 18:04:15,819 reid_baseline.train INFO: Accuracy: 69.4% Mean Entropy: 268.4%
2022-04-19 18:04:36,518 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 4.158, Acc: 0.661, Base Lr: 4.83e-03
2022-04-19 18:04:57,198 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 4.180, Acc: 0.655, Base Lr: 4.83e-03
2022-04-19 18:05:11,417 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.204[s] Speed: 78.6[samples/s]
2022-04-19 18:05:36,422 reid_baseline.train INFO: normal accuracy 0.7169344870210136 2.376417636871338 
2022-04-19 18:06:06,460 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 18:06:06,460 reid_baseline.train INFO: Accuracy: 71.7% Mean Entropy: 237.6%
2022-04-19 18:06:58,706 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 4.010, Acc: 0.694, Base Lr: 5.62e-03
2022-04-19 18:07:23,008 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 4.011, Acc: 0.696, Base Lr: 5.62e-03
2022-04-19 18:07:44,815 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.360[s] Speed: 44.4[samples/s]
2022-04-19 18:08:42,184 reid_baseline.train INFO: normal accuracy 0.7243510506798516 2.2999885082244873 
2022-04-19 18:09:12,265 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 18:09:12,266 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 230.0%
2022-04-19 18:09:32,165 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 4.022, Acc: 0.723, Base Lr: 6.42e-03
2022-04-19 18:09:56,785 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.991, Acc: 0.725, Base Lr: 6.42e-03
2022-04-19 18:10:36,375 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-19 18:10:59,937 reid_baseline.train INFO: normal accuracy 0.7358879274824887 2.265735149383545 
2022-04-19 18:11:29,990 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 18:11:29,992 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 226.6%
2022-04-19 18:11:51,398 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.936, Acc: 0.730, Base Lr: 7.21e-03
2022-04-19 18:12:10,787 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.928, Acc: 0.739, Base Lr: 7.21e-03
2022-04-19 18:12:25,382 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.203[s] Speed: 78.9[samples/s]
2022-04-19 18:13:17,920 reid_baseline.train INFO: normal accuracy 0.73053152039555 2.07598876953125 
2022-04-19 18:13:47,980 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 18:13:47,982 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 207.6%
2022-04-19 18:14:15,528 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.862, Acc: 0.755, Base Lr: 4.01e-03
2022-04-19 18:14:36,516 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.839, Acc: 0.755, Base Lr: 4.01e-03
2022-04-19 18:14:50,531 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-19 18:15:44,697 reid_baseline.train INFO: normal accuracy 0.7321796456530696 1.9890440702438354 
2022-04-19 18:16:14,731 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 18:16:14,732 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 198.9%
2022-04-19 18:16:34,345 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.779, Acc: 0.773, Base Lr: 3.38e-03
2022-04-19 18:17:21,355 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.826, Acc: 0.761, Base Lr: 3.38e-03
2022-04-19 18:17:40,904 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.316[s] Speed: 50.7[samples/s]
2022-04-19 18:18:03,390 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.9197866916656494 
2022-04-19 18:18:33,438 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 18:18:33,440 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 192.0%
2022-04-19 18:18:54,053 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.823, Acc: 0.765, Base Lr: 2.77e-03
2022-04-19 18:19:12,684 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.800, Acc: 0.773, Base Lr: 2.77e-03
2022-04-19 18:19:27,916 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.200[s] Speed: 80.2[samples/s]
2022-04-19 18:19:49,549 reid_baseline.train INFO: normal accuracy 0.7391841779975278 1.9705156087875366 
2022-04-19 18:19:49,549 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 18:19:49,549 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 197.1%
2022-04-19 18:20:43,610 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.836, Acc: 0.759, Base Lr: 2.20e-03
2022-04-19 18:21:07,594 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.826, Acc: 0.766, Base Lr: 2.20e-03
2022-04-19 18:21:20,310 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.332[s] Speed: 48.1[samples/s]
2022-04-19 18:21:45,069 reid_baseline.train INFO: normal accuracy 0.7404202719406675 2.0628535747528076 
2022-04-19 18:21:45,070 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 18:21:45,070 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 206.3%
2022-04-19 18:22:06,639 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.764, Acc: 0.781, Base Lr: 1.66e-03
2022-04-19 18:22:26,110 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.776, Acc: 0.781, Base Lr: 1.66e-03
2022-04-19 18:23:11,520 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-19 18:23:34,666 reid_baseline.train INFO: normal accuracy 0.7420683971981871 2.073855400085449 
2022-04-19 18:23:34,668 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 18:23:34,669 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 207.4%
2022-04-19 18:23:55,000 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.821, Acc: 0.777, Base Lr: 1.19e-03
2022-04-19 18:24:14,946 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.839, Acc: 0.781, Base Lr: 1.19e-03
2022-04-19 18:24:29,637 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.201[s] Speed: 79.5[samples/s]
2022-04-19 18:24:52,547 reid_baseline.train INFO: normal accuracy 0.7412443345694273 1.9463272094726562 
2022-04-19 18:24:52,547 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 18:24:52,547 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 194.6%
2022-04-19 18:25:43,955 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.851, Acc: 0.771, Base Lr: 7.78e-04
2022-04-19 18:26:10,672 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.850, Acc: 0.770, Base Lr: 7.78e-04
2022-04-19 18:27:00,525 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.469[s] Speed: 34.1[samples/s]
2022-04-19 18:27:55,390 reid_baseline.train INFO: normal accuracy 0.7433044911413268 2.107404947280884 
2022-04-19 18:27:55,390 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 18:27:55,390 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 210.7%
2022-04-19 18:28:16,771 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.787, Acc: 0.784, Base Lr: 4.51e-04
2022-04-19 18:28:36,357 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.778, Acc: 0.779, Base Lr: 4.51e-04
2022-04-19 18:28:54,196 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.215[s] Speed: 74.3[samples/s]
2022-04-19 18:29:16,302 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.9927042722702026 
2022-04-19 18:29:16,302 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 18:29:16,302 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 199.3%
2022-04-19 18:29:36,257 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.779, Acc: 0.777, Base Lr: 2.11e-04
2022-04-19 18:29:56,195 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.797, Acc: 0.778, Base Lr: 2.11e-04
2022-04-19 18:30:10,681 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.199[s] Speed: 80.3[samples/s]
2022-04-19 18:30:34,741 reid_baseline.train INFO: normal accuracy 0.7424804285125669 2.0505495071411133 
2022-04-19 18:30:34,742 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 18:30:34,742 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 205.1%
2022-04-19 18:31:25,712 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.771, Acc: 0.773, Base Lr: 6.51e-05
2022-04-19 18:31:53,218 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.750, Acc: 0.786, Base Lr: 6.51e-05
2022-04-19 18:32:07,242 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-19 18:32:32,680 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.932039499282837 
2022-04-19 18:32:32,683 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 18:32:32,683 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 193.2%
2022-04-19 18:32:53,274 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.770, Acc: 0.796, Base Lr: 1.60e-05
2022-04-19 18:33:12,452 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.798, Acc: 0.786, Base Lr: 1.60e-05
2022-04-19 18:33:26,475 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.197[s] Speed: 81.2[samples/s]
2022-04-19 18:34:20,280 reid_baseline.train INFO: normal accuracy 0.7404202719406675 1.9615933895111084 
2022-04-19 18:34:20,282 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 18:34:20,283 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 196.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_4/transformer_best_model.pth
2022-04-19 18:35:15,560 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.9197866916656494 
2022-04-19 18:35:15,561 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 18:35:15,561 reid_baseline.train INFO: Accuracy: 73.9%
2022-04-19 18:35:40,442 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.9197866916656494 
2022-04-19 18:35:40,443 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 18:35:40,443 reid_baseline.train INFO: Shuffled Accuracy: 73.9%
2022-04-19 18:36:05,086 reid_baseline.train INFO: normal accuracy 0.9422680412371134 0.8134724497795105 
2022-04-19 18:36:05,087 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 18:36:05,087 reid_baseline.train INFO: Source Clean Accuracy: 94.2%
2022-04-19 18:36:09,550 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_6
2022-04-19 18:36:09,551 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-19 18:36:09,551 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 18:36:09,552 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 18:36:09,552 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 18:36:16,092 reid_baseline.train INFO: start training
2022-04-19 18:36:44,911 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.263, Acc: 0.213, Base Lr: 8.72e-04
2022-04-19 18:37:04,964 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.186, Acc: 0.306, Base Lr: 8.72e-04
2022-04-19 18:37:19,151 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.228[s] Speed: 70.2[samples/s]
2022-04-19 18:37:43,248 reid_baseline.train INFO: normal accuracy 0.5002060156571899 4.168996334075928 
2022-04-19 18:38:13,212 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 18:38:13,213 reid_baseline.train INFO: Accuracy: 50.0% Mean Entropy: 416.9%
2022-04-19 18:38:33,755 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.897, Acc: 0.486, Base Lr: 1.66e-03
2022-04-19 18:38:58,458 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.800, Acc: 0.474, Base Lr: 1.66e-03
2022-04-19 18:39:17,363 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.235[s] Speed: 68.1[samples/s]
2022-04-19 18:39:42,046 reid_baseline.train INFO: normal accuracy 0.5405850844664194 4.092192649841309 
2022-04-19 18:40:12,124 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 18:40:12,124 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 409.2%
2022-04-19 18:40:32,827 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 5.246, Acc: 0.518, Base Lr: 2.46e-03
2022-04-19 18:40:53,674 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 5.125, Acc: 0.522, Base Lr: 2.46e-03
2022-04-19 18:41:08,559 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.207[s] Speed: 77.4[samples/s]
2022-04-19 18:41:31,486 reid_baseline.train INFO: normal accuracy 0.6122785331685208 3.6096670627593994 
2022-04-19 18:42:01,524 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 18:42:01,525 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 361.0%
2022-04-19 18:42:26,323 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.555, Acc: 0.593, Base Lr: 3.25e-03
2022-04-19 18:42:46,040 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.517, Acc: 0.588, Base Lr: 3.25e-03
2022-04-19 18:43:00,717 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.217[s] Speed: 73.8[samples/s]
2022-04-19 18:43:26,060 reid_baseline.train INFO: normal accuracy 0.6744952616398846 3.0628457069396973 
2022-04-19 18:43:56,113 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 18:43:56,113 reid_baseline.train INFO: Accuracy: 67.4% Mean Entropy: 306.3%
2022-04-19 18:44:15,910 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 4.330, Acc: 0.630, Base Lr: 4.04e-03
2022-04-19 18:45:11,133 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 4.282, Acc: 0.640, Base Lr: 4.04e-03
2022-04-19 18:45:28,698 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-19 18:46:22,707 reid_baseline.train INFO: normal accuracy 0.7021013597033374 2.642850399017334 
2022-04-19 18:46:52,836 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 18:46:52,837 reid_baseline.train INFO: Accuracy: 70.2% Mean Entropy: 264.3%
2022-04-19 18:47:16,496 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 4.124, Acc: 0.669, Base Lr: 4.83e-03
2022-04-19 18:47:36,031 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 4.120, Acc: 0.672, Base Lr: 4.83e-03
2022-04-19 18:47:50,913 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.213[s] Speed: 75.2[samples/s]
2022-04-19 18:48:15,246 reid_baseline.train INFO: normal accuracy 0.7189946435929131 2.407768487930298 
2022-04-19 18:48:45,396 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 18:48:45,397 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 240.8%
2022-04-19 18:49:05,828 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.988, Acc: 0.710, Base Lr: 5.62e-03
2022-04-19 18:49:25,526 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 4.039, Acc: 0.699, Base Lr: 5.62e-03
2022-04-19 18:49:40,547 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.202[s] Speed: 79.2[samples/s]
2022-04-19 18:50:04,246 reid_baseline.train INFO: normal accuracy 0.7259991759373713 2.3854103088378906 
2022-04-19 18:50:34,280 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 18:50:34,280 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 238.5%
2022-04-19 18:50:58,485 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.990, Acc: 0.744, Base Lr: 6.42e-03
2022-04-19 18:51:24,307 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 4.026, Acc: 0.719, Base Lr: 6.42e-03
2022-04-19 18:51:38,784 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.236[s] Speed: 67.7[samples/s]
2022-04-19 18:52:02,242 reid_baseline.train INFO: normal accuracy 0.73053152039555 2.320533275604248 
2022-04-19 18:52:32,306 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 18:52:32,306 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 232.1%
2022-04-19 18:52:53,439 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.951, Acc: 0.729, Base Lr: 7.21e-03
2022-04-19 18:53:12,999 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.926, Acc: 0.735, Base Lr: 7.21e-03
2022-04-19 18:53:31,289 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.216[s] Speed: 74.1[samples/s]
2022-04-19 18:54:23,405 reid_baseline.train INFO: normal accuracy 0.7371240214256284 2.125866174697876 
2022-04-19 18:54:53,475 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 18:54:53,476 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 212.6%
2022-04-19 18:55:14,808 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.890, Acc: 0.752, Base Lr: 4.01e-03
2022-04-19 18:55:33,624 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.901, Acc: 0.756, Base Lr: 4.01e-03
2022-04-19 18:55:48,816 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.203[s] Speed: 78.9[samples/s]
2022-04-19 18:56:44,307 reid_baseline.train INFO: normal accuracy 0.7412443345694273 2.0647287368774414 
2022-04-19 18:57:14,505 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 18:57:14,506 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 206.5%
2022-04-19 18:57:44,263 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.916, Acc: 0.752, Base Lr: 3.38e-03
2022-04-19 18:58:03,924 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.852, Acc: 0.755, Base Lr: 3.38e-03
2022-04-19 18:58:18,365 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.234[s] Speed: 68.4[samples/s]
2022-04-19 18:58:42,083 reid_baseline.train INFO: normal accuracy 0.738772146683148 2.11138653755188 
2022-04-19 18:58:42,083 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 18:58:42,083 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 211.1%
2022-04-19 18:59:02,922 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.805, Acc: 0.770, Base Lr: 2.77e-03
2022-04-19 18:59:21,853 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.832, Acc: 0.761, Base Lr: 2.77e-03
2022-04-19 18:59:36,914 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.201[s] Speed: 79.7[samples/s]
2022-04-19 19:00:00,915 reid_baseline.train INFO: normal accuracy 0.7408323032550473 1.9581046104431152 
2022-04-19 19:00:30,960 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 19:00:30,960 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 195.8%
2022-04-19 19:00:51,101 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.806, Acc: 0.765, Base Lr: 2.20e-03
2022-04-19 19:01:10,580 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.810, Acc: 0.769, Base Lr: 2.20e-03
2022-04-19 19:01:22,635 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.189[s] Speed: 84.5[samples/s]
2022-04-19 19:01:46,297 reid_baseline.train INFO: normal accuracy 0.7395962093119077 1.9157699346542358 
2022-04-19 19:02:16,345 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 19:02:16,345 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 191.6%
2022-04-19 19:02:42,076 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.785, Acc: 0.781, Base Lr: 1.66e-03
2022-04-19 19:03:02,195 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.805, Acc: 0.770, Base Lr: 1.66e-03
2022-04-19 19:03:16,908 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.222[s] Speed: 72.1[samples/s]
2022-04-19 19:03:41,570 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.9791399240493774 
2022-04-19 19:03:41,570 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 19:03:41,570 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 197.9%
2022-04-19 19:04:02,347 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.785, Acc: 0.789, Base Lr: 1.19e-03
2022-04-19 19:04:54,239 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.757, Acc: 0.781, Base Lr: 1.19e-03
2022-04-19 19:05:13,049 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-19 19:05:36,782 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.883785367012024 
2022-04-19 19:06:06,836 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 19:06:06,836 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 188.4%
2022-04-19 19:06:27,841 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.779, Acc: 0.772, Base Lr: 7.78e-04
2022-04-19 19:06:47,455 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.743, Acc: 0.780, Base Lr: 7.78e-04
2022-04-19 19:07:02,212 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.203[s] Speed: 78.9[samples/s]
2022-04-19 19:07:55,176 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.9749566316604614 
2022-04-19 19:07:55,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 19:07:55,177 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 197.5%
2022-04-19 19:08:20,947 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.863, Acc: 0.767, Base Lr: 4.51e-04
2022-04-19 19:08:41,041 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.794, Acc: 0.783, Base Lr: 4.51e-04
2022-04-19 19:08:55,039 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.219[s] Speed: 73.0[samples/s]
2022-04-19 19:09:18,213 reid_baseline.train INFO: normal accuracy 0.7412443345694273 1.9835166931152344 
2022-04-19 19:09:18,213 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 19:09:18,214 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 198.4%
2022-04-19 19:09:38,553 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.702, Acc: 0.796, Base Lr: 2.11e-04
2022-04-19 19:10:30,125 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.760, Acc: 0.786, Base Lr: 2.11e-04
2022-04-19 19:10:49,762 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.335[s] Speed: 47.7[samples/s]
2022-04-19 19:11:13,539 reid_baseline.train INFO: normal accuracy 0.7424804285125669 1.9788134098052979 
2022-04-19 19:11:13,539 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 19:11:13,539 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 197.9%
2022-04-19 19:11:34,552 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.778, Acc: 0.787, Base Lr: 6.51e-05
2022-04-19 19:11:55,044 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.821, Acc: 0.778, Base Lr: 6.51e-05
2022-04-19 19:12:08,941 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.203[s] Speed: 78.8[samples/s]
2022-04-19 19:13:01,252 reid_baseline.train INFO: normal accuracy 0.7412443345694273 1.9926772117614746 
2022-04-19 19:13:01,254 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 19:13:01,254 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 199.3%
2022-04-19 19:13:29,799 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.742, Acc: 0.802, Base Lr: 1.60e-05
2022-04-19 19:13:48,691 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.751, Acc: 0.796, Base Lr: 1.60e-05
2022-04-19 19:14:04,193 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.231[s] Speed: 69.4[samples/s]
2022-04-19 19:14:57,924 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.963595986366272 
2022-04-19 19:14:57,924 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 19:14:57,924 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 196.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_6/transformer_best_model.pth
2022-04-19 19:16:18,777 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.883785367012024 
2022-04-19 19:16:18,777 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 19:16:18,777 reid_baseline.train INFO: Accuracy: 74.3%
2022-04-19 19:16:41,582 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.883785367012024 
2022-04-19 19:16:41,583 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 19:16:41,583 reid_baseline.train INFO: Shuffled Accuracy: 74.3%
2022-04-19 19:17:08,077 reid_baseline.train INFO: normal accuracy 0.952119129438717 0.7795308828353882 
2022-04-19 19:17:08,078 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 19:17:08,078 reid_baseline.train INFO: Source Clean Accuracy: 95.2%
2022-04-19 19:17:12,302 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_8
2022-04-19 19:17:12,302 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-19 19:17:12,302 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 19:17:12,303 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 19:17:12,303 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 19:17:17,931 reid_baseline.train INFO: start training
2022-04-19 19:17:41,497 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.266, Acc: 0.220, Base Lr: 8.72e-04
2022-04-19 19:18:02,065 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.189, Acc: 0.301, Base Lr: 8.72e-04
2022-04-19 19:18:44,655 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-19 19:19:09,218 reid_baseline.train INFO: normal accuracy 0.5109188298310672 4.169007778167725 
2022-04-19 19:19:39,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 19:19:39,194 reid_baseline.train INFO: Accuracy: 51.1% Mean Entropy: 416.9%
2022-04-19 19:19:59,215 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.869, Acc: 0.486, Base Lr: 1.66e-03
2022-04-19 19:20:18,926 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.749, Acc: 0.481, Base Lr: 1.66e-03
2022-04-19 19:20:33,310 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.198[s] Speed: 80.7[samples/s]
2022-04-19 19:20:58,394 reid_baseline.train INFO: normal accuracy 0.5401730531520396 4.089057445526123 
2022-04-19 19:21:28,427 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 19:21:28,427 reid_baseline.train INFO: Accuracy: 54.0% Mean Entropy: 408.9%
2022-04-19 19:22:18,543 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 5.198, Acc: 0.517, Base Lr: 2.46e-03
2022-04-19 19:22:44,558 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 5.081, Acc: 0.522, Base Lr: 2.46e-03
2022-04-19 19:22:58,947 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.332[s] Speed: 48.3[samples/s]
2022-04-19 19:23:25,344 reid_baseline.train INFO: normal accuracy 0.6176349402554594 3.6311893463134766 
2022-04-19 19:23:55,380 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 19:23:55,381 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 363.1%
2022-04-19 19:24:29,059 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.614, Acc: 0.582, Base Lr: 3.25e-03
2022-04-19 19:24:57,746 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.590, Acc: 0.579, Base Lr: 3.25e-03
2022-04-19 19:25:17,452 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-19 19:26:09,124 reid_baseline.train INFO: normal accuracy 0.6880922950144212 3.1049487590789795 
2022-04-19 19:26:39,297 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 19:26:39,298 reid_baseline.train INFO: Accuracy: 68.8% Mean Entropy: 310.5%
2022-04-19 19:27:02,340 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 4.376, Acc: 0.623, Base Lr: 4.04e-03
2022-04-19 19:27:22,352 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 4.282, Acc: 0.641, Base Lr: 4.04e-03
2022-04-19 19:27:36,671 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.210[s] Speed: 76.1[samples/s]
2022-04-19 19:28:01,187 reid_baseline.train INFO: normal accuracy 0.7058096415327565 2.689358949661255 
2022-04-19 19:28:31,214 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 19:28:31,215 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 268.9%
2022-04-19 19:29:21,888 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 4.221, Acc: 0.661, Base Lr: 4.83e-03
2022-04-19 19:29:47,899 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 4.164, Acc: 0.668, Base Lr: 4.83e-03
2022-04-19 19:30:30,282 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.436[s] Speed: 36.7[samples/s]
2022-04-19 19:30:54,941 reid_baseline.train INFO: normal accuracy 0.723114956736712 2.540478467941284 
2022-04-19 19:31:24,985 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 19:31:24,985 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 254.0%
2022-04-19 19:31:45,866 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 4.092, Acc: 0.688, Base Lr: 5.62e-03
2022-04-19 19:32:05,225 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 4.072, Acc: 0.692, Base Lr: 5.62e-03
2022-04-19 19:32:24,105 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.217[s] Speed: 73.9[samples/s]
2022-04-19 19:33:08,979 reid_baseline.train INFO: normal accuracy 0.7243510506798516 2.2949867248535156 
2022-04-19 19:33:39,057 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 19:33:39,057 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 229.5%
2022-04-19 19:34:01,357 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.957, Acc: 0.722, Base Lr: 6.42e-03
2022-04-19 19:34:21,779 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 4.002, Acc: 0.712, Base Lr: 6.42e-03
2022-04-19 19:34:35,671 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.207[s] Speed: 77.2[samples/s]
2022-04-19 19:34:59,082 reid_baseline.train INFO: normal accuracy 0.7412443345694273 2.1945109367370605 
2022-04-19 19:35:29,132 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 19:35:29,133 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 219.5%
2022-04-19 19:35:50,256 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.924, Acc: 0.739, Base Lr: 7.21e-03
2022-04-19 19:36:17,233 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.957, Acc: 0.732, Base Lr: 7.21e-03
2022-04-19 19:36:33,893 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.237[s] Speed: 67.5[samples/s]
2022-04-19 19:36:59,215 reid_baseline.train INFO: normal accuracy 0.7280593325092707 2.1248459815979004 
2022-04-19 19:37:29,253 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 19:37:29,253 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 212.5%
2022-04-19 19:37:50,401 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.780, Acc: 0.758, Base Lr: 4.01e-03
2022-04-19 19:38:08,942 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.855, Acc: 0.750, Base Lr: 4.01e-03
2022-04-19 19:38:25,662 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.207[s] Speed: 77.4[samples/s]
2022-04-19 19:39:45,955 reid_baseline.train INFO: normal accuracy 0.738360115368768 2.1028523445129395 
2022-04-19 19:40:15,999 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 19:40:15,999 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 210.3%
2022-04-19 19:40:37,702 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.835, Acc: 0.768, Base Lr: 3.38e-03
2022-04-19 19:40:58,494 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.821, Acc: 0.772, Base Lr: 3.38e-03
2022-04-19 19:41:12,743 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.208[s] Speed: 77.0[samples/s]
2022-04-19 19:41:37,319 reid_baseline.train INFO: normal accuracy 0.7412443345694273 2.116354465484619 
2022-04-19 19:41:37,319 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 19:41:37,319 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 211.6%
2022-04-19 19:41:58,465 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.817, Acc: 0.772, Base Lr: 2.77e-03
2022-04-19 19:42:25,030 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.809, Acc: 0.771, Base Lr: 2.77e-03
2022-04-19 19:42:40,593 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.232[s] Speed: 69.0[samples/s]
2022-04-19 19:43:05,259 reid_baseline.train INFO: normal accuracy 0.7404202719406675 2.046292304992676 
2022-04-19 19:43:35,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 19:43:35,335 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 204.6%
2022-04-19 19:43:56,006 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.712, Acc: 0.777, Base Lr: 2.20e-03
2022-04-19 19:44:15,105 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.785, Acc: 0.774, Base Lr: 2.20e-03
2022-04-19 19:44:28,587 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.195[s] Speed: 82.0[samples/s]
2022-04-19 19:44:51,907 reid_baseline.train INFO: normal accuracy 0.7453646477132262 2.059138298034668 
2022-04-19 19:44:51,908 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 19:44:51,908 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 205.9%
2022-04-19 19:45:14,143 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.743, Acc: 0.786, Base Lr: 1.66e-03
2022-04-19 19:45:33,763 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.754, Acc: 0.786, Base Lr: 1.66e-03
2022-04-19 19:45:48,881 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.209[s] Speed: 76.7[samples/s]
2022-04-19 19:46:12,222 reid_baseline.train INFO: normal accuracy 0.7416563658838071 2.02496337890625 
2022-04-19 19:46:42,281 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 19:46:42,282 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 202.5%
2022-04-19 19:47:02,232 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.766, Acc: 0.790, Base Lr: 1.19e-03
2022-04-19 19:47:28,277 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.806, Acc: 0.778, Base Lr: 1.19e-03
2022-04-19 19:47:44,945 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.230[s] Speed: 69.7[samples/s]
2022-04-19 19:48:08,887 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.9403109550476074 
2022-04-19 19:48:38,951 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 19:48:38,952 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 194.0%
2022-04-19 19:48:59,925 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.832, Acc: 0.762, Base Lr: 7.78e-04
2022-04-19 19:49:19,156 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.821, Acc: 0.770, Base Lr: 7.78e-04
2022-04-19 19:49:32,304 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.195[s] Speed: 81.9[samples/s]
2022-04-19 19:50:24,804 reid_baseline.train INFO: normal accuracy 0.7470127729707458 1.9787288904190063 
2022-04-19 19:50:24,807 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 19:50:24,807 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 197.9%
2022-04-19 19:50:50,295 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.767, Acc: 0.785, Base Lr: 4.51e-04
2022-04-19 19:51:08,621 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.733, Acc: 0.798, Base Lr: 4.51e-04
2022-04-19 19:51:23,884 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.216[s] Speed: 73.9[samples/s]
2022-04-19 19:51:48,858 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.9997323751449585 
2022-04-19 19:51:48,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 19:51:48,859 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 200.0%
2022-04-19 19:52:08,938 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.830, Acc: 0.774, Base Lr: 2.11e-04
2022-04-19 19:52:35,217 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.788, Acc: 0.780, Base Lr: 2.11e-04
2022-04-19 19:52:56,348 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.247[s] Speed: 64.7[samples/s]
2022-04-19 19:53:20,313 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.954207420349121 
2022-04-19 19:53:20,314 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 19:53:20,314 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 195.4%
2022-04-19 19:53:41,989 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.729, Acc: 0.797, Base Lr: 6.51e-05
2022-04-19 19:54:01,953 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.728, Acc: 0.790, Base Lr: 6.51e-05
2022-04-19 19:54:16,476 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.206[s] Speed: 77.8[samples/s]
2022-04-19 19:54:39,777 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.9902255535125732 
2022-04-19 19:54:39,778 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 19:54:39,778 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 199.0%
2022-04-19 19:55:05,694 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.728, Acc: 0.797, Base Lr: 1.60e-05
2022-04-19 19:55:24,387 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.760, Acc: 0.789, Base Lr: 1.60e-05
2022-04-19 19:55:39,632 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.219[s] Speed: 73.0[samples/s]
2022-04-19 19:56:33,462 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.990513801574707 
2022-04-19 19:56:33,462 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 19:56:33,462 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 199.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_8/transformer_best_model.pth
2022-04-19 19:57:24,993 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.9403109550476074 
2022-04-19 19:57:24,993 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 19:57:24,993 reid_baseline.train INFO: Accuracy: 74.6%
2022-04-19 19:57:48,649 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.9403109550476074 
2022-04-19 19:57:48,652 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 19:57:48,652 reid_baseline.train INFO: Shuffled Accuracy: 74.6%
2022-04-19 19:58:44,663 reid_baseline.train INFO: normal accuracy 0.9505154639175257 0.8077541589736938 
2022-04-19 19:58:44,663 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 19:58:44,663 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
