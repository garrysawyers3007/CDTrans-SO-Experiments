2022-04-20 02:41:29,275 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_1
2022-04-20 02:41:29,275 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-20 02:41:29,275 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 02:41:29,275 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 02:41:29,275 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 02:41:38,529 reid_baseline.train INFO: start training
2022-04-20 02:42:10,172 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.280, Acc: 0.280, Base Lr: 8.72e-04
2022-04-20 02:42:32,641 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.192, Acc: 0.377, Base Lr: 8.72e-04
2022-04-20 02:42:48,766 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.254[s] Speed: 63.0[samples/s]
2022-04-20 02:43:17,229 reid_baseline.train INFO: normal accuracy 0.5088586732591677 4.166680335998535 
2022-04-20 02:43:17,968 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 02:43:17,968 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-20 02:43:43,804 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.786, Acc: 0.551, Base Lr: 1.66e-03
2022-04-20 02:44:14,173 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.609, Acc: 0.555, Base Lr: 1.66e-03
2022-04-20 02:44:43,199 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.312[s] Speed: 51.2[samples/s]
2022-04-20 02:45:17,813 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.029125213623047 
2022-04-20 02:45:18,703 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 02:45:18,704 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-20 02:45:57,309 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.831, Acc: 0.601, Base Lr: 2.46e-03
2022-04-20 02:46:32,581 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.699, Acc: 0.610, Base Lr: 2.46e-03
2022-04-20 02:47:03,246 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-04-20 02:47:35,426 reid_baseline.train INFO: normal accuracy 0.6258755665430573 3.461359977722168 
2022-04-20 02:47:36,305 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 02:47:36,306 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 346.1%
2022-04-20 02:48:12,339 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.135, Acc: 0.683, Base Lr: 3.25e-03
2022-04-20 02:48:52,303 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.060, Acc: 0.709, Base Lr: 3.25e-03
2022-04-20 02:49:19,030 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-04-20 02:49:51,221 reid_baseline.train INFO: normal accuracy 0.6831479192418624 2.8139641284942627 
2022-04-20 02:49:52,130 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 02:49:52,131 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 281.4%
2022-04-20 02:50:30,817 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.812, Acc: 0.773, Base Lr: 4.04e-03
2022-04-20 02:51:06,238 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.787, Acc: 0.765, Base Lr: 4.04e-03
2022-04-20 02:51:31,456 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.363[s] Speed: 44.0[samples/s]
2022-04-20 02:52:03,879 reid_baseline.train INFO: normal accuracy 0.7070457354758962 2.510563373565674 
2022-04-20 02:52:04,737 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 02:52:04,738 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 251.1%
2022-04-20 02:52:42,913 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.635, Acc: 0.805, Base Lr: 4.83e-03
2022-04-20 02:53:16,467 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.655, Acc: 0.800, Base Lr: 4.83e-03
2022-04-20 02:53:45,667 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.370[s] Speed: 43.3[samples/s]
2022-04-20 02:54:18,736 reid_baseline.train INFO: normal accuracy 0.7218788627935723 2.2836742401123047 
2022-04-20 02:54:19,561 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 02:54:19,561 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 228.4%
2022-04-20 02:54:59,686 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.557, Acc: 0.824, Base Lr: 5.62e-03
2022-04-20 02:55:36,904 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.518, Acc: 0.837, Base Lr: 5.62e-03
2022-04-20 02:56:03,811 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.382[s] Speed: 41.9[samples/s]
2022-04-20 02:56:37,817 reid_baseline.train INFO: normal accuracy 0.7317676143386898 2.15857195854187 
2022-04-20 02:56:38,711 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 02:56:38,711 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 215.9%
2022-04-20 02:57:14,992 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.451, Acc: 0.861, Base Lr: 6.42e-03
2022-04-20 02:57:50,520 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.455, Acc: 0.855, Base Lr: 6.42e-03
2022-04-20 02:58:19,973 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.371[s] Speed: 43.2[samples/s]
2022-04-20 02:58:50,689 reid_baseline.train INFO: normal accuracy 0.7441285537700866 2.0123634338378906 
2022-04-20 02:58:51,530 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 02:58:51,531 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 201.2%
2022-04-20 02:59:30,367 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.377, Acc: 0.873, Base Lr: 7.21e-03
2022-04-20 03:00:08,742 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.395, Acc: 0.880, Base Lr: 7.21e-03
2022-04-20 03:00:35,021 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.379[s] Speed: 42.2[samples/s]
2022-04-20 03:01:05,645 reid_baseline.train INFO: normal accuracy 0.7362999587968686 1.946234941482544 
2022-04-20 03:01:06,497 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 03:01:06,497 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 194.6%
2022-04-20 03:01:48,420 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.356, Acc: 0.894, Base Lr: 4.01e-03
2022-04-20 03:02:24,908 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.338, Acc: 0.905, Base Lr: 4.01e-03
2022-04-20 03:02:48,495 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-20 03:03:22,151 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.9444421529769897 
2022-04-20 03:03:22,976 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 03:03:22,976 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 194.4%
2022-04-20 03:04:01,226 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.292, Acc: 0.915, Base Lr: 3.38e-03
2022-04-20 03:04:36,704 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.287, Acc: 0.914, Base Lr: 3.38e-03
2022-04-20 03:05:06,064 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.378[s] Speed: 42.4[samples/s]
2022-04-20 03:05:37,450 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.8585271835327148 
2022-04-20 03:05:38,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 03:05:38,296 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 185.9%
2022-04-20 03:06:16,068 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.286, Acc: 0.899, Base Lr: 2.77e-03
2022-04-20 03:06:54,128 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.268, Acc: 0.912, Base Lr: 2.77e-03
2022-04-20 03:07:22,696 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.382[s] Speed: 41.8[samples/s]
2022-04-20 03:07:55,488 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.83991539478302 
2022-04-20 03:07:56,372 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 03:07:56,372 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 184.0%
2022-04-20 03:08:34,865 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.271, Acc: 0.914, Base Lr: 2.20e-03
2022-04-20 03:09:09,061 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.260, Acc: 0.920, Base Lr: 2.20e-03
2022-04-20 03:09:37,376 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.369[s] Speed: 43.3[samples/s]
2022-04-20 03:10:10,163 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.9034770727157593 
2022-04-20 03:10:10,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 03:10:10,163 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 190.3%
2022-04-20 03:10:45,050 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.258, Acc: 0.914, Base Lr: 1.66e-03
2022-04-20 03:11:24,529 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.251, Acc: 0.924, Base Lr: 1.66e-03
2022-04-20 03:11:51,646 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.372[s] Speed: 43.1[samples/s]
2022-04-20 03:12:25,074 reid_baseline.train INFO: normal accuracy 0.7482488669138855 1.8683825731277466 
2022-04-20 03:12:25,077 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 03:12:25,077 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 186.8%
2022-04-20 03:13:05,267 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.218, Acc: 0.933, Base Lr: 1.19e-03
2022-04-20 03:13:41,690 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.224, Acc: 0.928, Base Lr: 1.19e-03
2022-04-20 03:14:07,295 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-20 03:14:41,577 reid_baseline.train INFO: normal accuracy 0.7507210548001648 1.8821220397949219 
2022-04-20 03:14:41,577 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 03:14:41,577 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 188.2%
2022-04-20 03:15:19,911 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.244, Acc: 0.932, Base Lr: 7.78e-04
2022-04-20 03:15:58,672 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.249, Acc: 0.929, Base Lr: 7.78e-04
2022-04-20 03:16:25,871 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.381[s] Speed: 42.0[samples/s]
2022-04-20 03:16:56,547 reid_baseline.train INFO: normal accuracy 0.7507210548001648 1.8504873514175415 
2022-04-20 03:16:56,549 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 03:16:56,549 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 185.0%
2022-04-20 03:17:36,063 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.231, Acc: 0.921, Base Lr: 4.51e-04
2022-04-20 03:18:06,270 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.221, Acc: 0.924, Base Lr: 4.51e-04
2022-04-20 03:18:25,073 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-20 03:18:57,007 reid_baseline.train INFO: normal accuracy 0.7503090234857849 1.8704026937484741 
2022-04-20 03:18:57,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 03:18:57,008 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 187.0%
2022-04-20 03:19:29,603 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.195, Acc: 0.937, Base Lr: 2.11e-04
2022-04-20 03:19:59,012 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.190, Acc: 0.935, Base Lr: 2.11e-04
2022-04-20 03:20:18,039 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-20 03:20:51,280 reid_baseline.train INFO: normal accuracy 0.7478368355995055 1.8456391096115112 
2022-04-20 03:20:51,282 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 03:20:51,282 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 184.6%
2022-04-20 03:21:23,629 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.197, Acc: 0.934, Base Lr: 6.51e-05
2022-04-20 03:21:59,254 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.217, Acc: 0.927, Base Lr: 6.51e-05
2022-04-20 03:22:18,408 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.319[s] Speed: 50.1[samples/s]
2022-04-20 03:22:50,729 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8322839736938477 
2022-04-20 03:22:51,557 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 03:22:51,557 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.2%
2022-04-20 03:23:21,898 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.208, Acc: 0.939, Base Lr: 1.60e-05
2022-04-20 03:23:50,789 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.212, Acc: 0.936, Base Lr: 1.60e-05
2022-04-20 03:24:17,121 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-20 03:24:49,220 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.794347882270813 
2022-04-20 03:24:50,143 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 03:24:50,144 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 179.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_1/transformer_best_model.pth
2022-04-20 03:25:23,440 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.794347882270813 
2022-04-20 03:25:23,441 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 03:25:23,441 reid_baseline.train INFO: Accuracy: 75.2%
2022-04-20 03:25:55,614 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.794347882270813 
2022-04-20 03:25:55,614 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 03:25:55,614 reid_baseline.train INFO: Shuffled Accuracy: 75.2%
2022-04-20 03:26:34,994 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7764007449150085 
2022-04-20 03:26:34,994 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 03:26:34,994 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-20 03:26:40,573 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_1
2022-04-20 03:26:40,573 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-20 03:26:40,573 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 03:26:40,573 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 03:26:40,573 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 03:26:52,063 reid_baseline.train INFO: start training
2022-04-20 03:27:33,327 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.280, Acc: 0.280, Base Lr: 8.72e-04
2022-04-20 03:28:03,097 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.192, Acc: 0.376, Base Lr: 8.72e-04
2022-04-20 03:28:23,952 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.331[s] Speed: 48.3[samples/s]
2022-04-20 03:29:04,411 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.16417932510376 
2022-04-20 03:29:05,243 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 03:29:05,243 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-20 03:29:41,928 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.786, Acc: 0.551, Base Lr: 1.66e-03
2022-04-20 03:30:06,636 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.609, Acc: 0.555, Base Lr: 1.66e-03
2022-04-20 03:30:28,244 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-20 03:31:04,532 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.9683566093444824 
2022-04-20 03:31:05,275 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 03:31:05,275 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-20 03:31:44,365 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.831, Acc: 0.602, Base Lr: 2.46e-03
2022-04-20 03:32:15,441 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.699, Acc: 0.610, Base Lr: 2.46e-03
2022-04-20 03:32:36,231 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.333[s] Speed: 48.1[samples/s]
2022-04-20 03:33:17,922 reid_baseline.train INFO: normal accuracy 0.6451903581887812 3.2464406490325928 
2022-04-20 03:33:18,886 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 03:33:18,887 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.6%
2022-04-20 03:33:48,730 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.135, Acc: 0.684, Base Lr: 3.25e-03
2022-04-20 03:34:24,374 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.061, Acc: 0.710, Base Lr: 3.25e-03
2022-04-20 03:34:48,352 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-20 03:35:31,023 reid_baseline.train INFO: normal accuracy 0.7087181797702186 2.5373916625976562 
2022-04-20 03:35:31,935 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 03:35:31,935 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 253.7%
2022-04-20 03:36:03,557 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.812, Acc: 0.773, Base Lr: 4.04e-03
2022-04-20 03:36:31,425 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.787, Acc: 0.765, Base Lr: 4.04e-03
2022-04-20 03:36:58,602 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.317[s] Speed: 50.4[samples/s]
2022-04-20 03:37:39,261 reid_baseline.train INFO: normal accuracy 0.7251633250732147 2.2066731452941895 
2022-04-20 03:37:40,135 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 03:37:40,135 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 220.7%
2022-04-20 03:38:12,472 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.635, Acc: 0.805, Base Lr: 4.83e-03
2022-04-20 03:38:42,030 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.655, Acc: 0.800, Base Lr: 4.83e-03
2022-04-20 03:39:04,654 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-20 03:39:47,765 reid_baseline.train INFO: normal accuracy 0.7382293309303898 1.9953579902648926 
2022-04-20 03:39:48,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 03:39:48,687 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 199.5%
2022-04-20 03:40:18,635 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.557, Acc: 0.824, Base Lr: 5.62e-03
2022-04-20 03:40:48,702 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.519, Acc: 0.836, Base Lr: 5.62e-03
2022-04-20 03:41:10,567 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-20 03:41:52,233 reid_baseline.train INFO: normal accuracy 0.7558008560486597 1.8886295557022095 
2022-04-20 03:41:53,216 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 03:41:53,216 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 188.9%
2022-04-20 03:42:32,188 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.451, Acc: 0.861, Base Lr: 6.42e-03
2022-04-20 03:42:59,079 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.455, Acc: 0.855, Base Lr: 6.42e-03
2022-04-20 03:43:20,230 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-20 03:44:00,435 reid_baseline.train INFO: normal accuracy 0.7594052714575354 1.8227293491363525 
2022-04-20 03:44:01,293 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 03:44:01,294 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 182.3%
2022-04-20 03:44:34,043 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.376, Acc: 0.873, Base Lr: 7.21e-03
2022-04-20 03:45:09,694 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.395, Acc: 0.879, Base Lr: 7.21e-03
2022-04-20 03:45:29,442 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.323[s] Speed: 49.6[samples/s]
2022-04-20 03:46:09,626 reid_baseline.train INFO: normal accuracy 0.7614327551250282 1.749456524848938 
2022-04-20 03:46:10,548 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 03:46:10,548 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 174.9%
2022-04-20 03:46:39,656 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.356, Acc: 0.894, Base Lr: 4.01e-03
2022-04-20 03:47:09,866 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.338, Acc: 0.904, Base Lr: 4.01e-03
2022-04-20 03:47:36,109 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-20 03:48:16,246 reid_baseline.train INFO: normal accuracy 0.765938274386123 1.7933619022369385 
2022-04-20 03:48:16,246 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 03:48:16,247 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 179.3%
2022-04-20 03:48:45,583 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.292, Acc: 0.915, Base Lr: 3.38e-03
2022-04-20 03:49:14,448 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.286, Acc: 0.914, Base Lr: 3.38e-03
2022-04-20 03:49:38,519 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-20 03:50:17,941 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.6994282007217407 
2022-04-20 03:50:18,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 03:50:18,800 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 169.9%
2022-04-20 03:50:48,432 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.286, Acc: 0.898, Base Lr: 2.77e-03
2022-04-20 03:51:18,659 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.268, Acc: 0.911, Base Lr: 2.77e-03
2022-04-20 03:51:40,014 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-20 03:52:20,916 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.6852896213531494 
2022-04-20 03:52:21,802 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 03:52:21,802 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.5%
2022-04-20 03:53:02,399 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.271, Acc: 0.913, Base Lr: 2.20e-03
2022-04-20 03:53:27,831 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.260, Acc: 0.921, Base Lr: 2.20e-03
2022-04-20 03:53:48,341 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-20 03:54:31,577 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.756201982498169 
2022-04-20 03:54:31,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 03:54:31,578 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.6%
2022-04-20 03:55:05,598 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.258, Acc: 0.914, Base Lr: 1.66e-03
2022-04-20 03:55:41,508 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.251, Acc: 0.925, Base Lr: 1.66e-03
2022-04-20 03:56:01,549 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-20 03:56:42,652 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.724202036857605 
2022-04-20 03:56:42,653 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 03:56:42,653 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.4%
2022-04-20 03:57:14,319 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.218, Acc: 0.933, Base Lr: 1.19e-03
2022-04-20 03:57:45,271 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.224, Acc: 0.928, Base Lr: 1.19e-03
2022-04-20 03:58:11,452 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-20 03:58:53,033 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.7536609172821045 
2022-04-20 03:58:53,035 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 03:58:53,035 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 175.4%
2022-04-20 03:59:23,447 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.244, Acc: 0.932, Base Lr: 7.78e-04
2022-04-20 03:59:53,786 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.249, Acc: 0.929, Base Lr: 7.78e-04
2022-04-20 04:00:15,339 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-20 04:00:54,546 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7086764574050903 
2022-04-20 04:00:54,549 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 04:00:54,549 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.9%
2022-04-20 04:01:25,221 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.231, Acc: 0.922, Base Lr: 4.51e-04
2022-04-20 04:01:54,908 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.221, Acc: 0.924, Base Lr: 4.51e-04
2022-04-20 04:02:16,633 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-20 04:02:56,605 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.7307052612304688 
2022-04-20 04:02:56,607 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 04:02:56,607 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 173.1%
2022-04-20 04:03:34,811 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.195, Acc: 0.938, Base Lr: 2.11e-04
2022-04-20 04:04:01,492 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.190, Acc: 0.935, Base Lr: 2.11e-04
2022-04-20 04:04:22,681 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.315[s] Speed: 50.8[samples/s]
2022-04-20 04:05:04,018 reid_baseline.train INFO: normal accuracy 0.7769767965758053 1.7128716707229614 
2022-04-20 04:05:04,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 04:05:04,021 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 171.3%
2022-04-20 04:05:35,199 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.197, Acc: 0.934, Base Lr: 6.51e-05
2022-04-20 04:06:11,009 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.216, Acc: 0.927, Base Lr: 6.51e-05
2022-04-20 04:06:30,494 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-20 04:07:11,160 reid_baseline.train INFO: normal accuracy 0.7735976571299842 1.6839399337768555 
2022-04-20 04:07:12,062 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 04:07:12,063 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.4%
2022-04-20 04:07:43,686 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.207, Acc: 0.939, Base Lr: 1.60e-05
2022-04-20 04:08:13,758 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.212, Acc: 0.936, Base Lr: 1.60e-05
2022-04-20 04:08:39,941 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-20 04:09:20,430 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6504542827606201 
2022-04-20 04:09:21,314 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 04:09:21,314 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_1/transformer_best_model.pth
2022-04-20 04:10:01,820 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6504542827606201 
2022-04-20 04:10:01,820 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:10:01,820 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-20 04:10:36,502 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6504542827606201 
2022-04-20 04:10:36,502 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:10:36,502 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-20 04:11:16,097 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7760656476020813 
2022-04-20 04:11:16,097 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:11:16,097 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-20 04:11:21,732 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_2
2022-04-20 04:11:21,733 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-20 04:11:21,733 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 04:11:21,733 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 04:11:21,733 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 04:11:32,305 reid_baseline.train INFO: start training
2022-04-20 04:12:08,621 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.263, Acc: 0.280, Base Lr: 8.72e-04
2022-04-20 04:12:35,675 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.186, Acc: 0.374, Base Lr: 8.72e-04
2022-04-20 04:12:54,197 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-20 04:13:28,192 reid_baseline.train INFO: normal accuracy 0.5129789864029666 4.166750907897949 
2022-04-20 04:13:29,031 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 04:13:29,031 reid_baseline.train INFO: Accuracy: 51.3% Mean Entropy: 416.7%
2022-04-20 04:13:57,697 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.728, Acc: 0.553, Base Lr: 1.66e-03
2022-04-20 04:14:27,222 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.593, Acc: 0.569, Base Lr: 1.66e-03
2022-04-20 04:14:43,350 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.272[s] Speed: 58.8[samples/s]
2022-04-20 04:15:16,171 reid_baseline.train INFO: normal accuracy 0.5545941491553358 4.028618812561035 
2022-04-20 04:15:17,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 04:15:17,065 reid_baseline.train INFO: Accuracy: 55.5% Mean Entropy: 402.9%
2022-04-20 04:15:53,148 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.827, Acc: 0.611, Base Lr: 2.46e-03
2022-04-20 04:16:28,343 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.687, Acc: 0.628, Base Lr: 2.46e-03
2022-04-20 04:16:52,856 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-20 04:17:26,165 reid_baseline.train INFO: normal accuracy 0.6258755665430573 3.4082682132720947 
2022-04-20 04:17:27,083 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 04:17:27,083 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 340.8%
2022-04-20 04:18:03,328 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.143, Acc: 0.699, Base Lr: 3.25e-03
2022-04-20 04:18:38,812 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.083, Acc: 0.701, Base Lr: 3.25e-03
2022-04-20 04:19:03,067 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.352[s] Speed: 45.5[samples/s]
2022-04-20 04:19:34,631 reid_baseline.train INFO: normal accuracy 0.681087762669963 2.8606042861938477 
2022-04-20 04:19:35,515 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 04:19:35,515 reid_baseline.train INFO: Accuracy: 68.1% Mean Entropy: 286.1%
2022-04-20 04:20:12,590 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.797, Acc: 0.766, Base Lr: 4.04e-03
2022-04-20 04:20:48,212 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.791, Acc: 0.775, Base Lr: 4.04e-03
2022-04-20 04:21:13,331 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.358[s] Speed: 44.7[samples/s]
2022-04-20 04:21:44,998 reid_baseline.train INFO: normal accuracy 0.703749484960857 2.461808919906616 
2022-04-20 04:21:45,830 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 04:21:45,830 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 246.2%
2022-04-20 04:22:23,142 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.659, Acc: 0.800, Base Lr: 4.83e-03
2022-04-20 04:22:55,956 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.657, Acc: 0.807, Base Lr: 4.83e-03
2022-04-20 04:23:20,313 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.346[s] Speed: 46.2[samples/s]
2022-04-20 04:23:53,731 reid_baseline.train INFO: normal accuracy 0.722702925422332 2.2858190536499023 
2022-04-20 04:23:54,579 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 04:23:54,579 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 228.6%
2022-04-20 04:24:29,764 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.574, Acc: 0.833, Base Lr: 5.62e-03
2022-04-20 04:25:03,133 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.531, Acc: 0.840, Base Lr: 5.62e-03
2022-04-20 04:25:33,127 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-20 04:26:04,418 reid_baseline.train INFO: normal accuracy 0.7321796456530696 2.140144109725952 
2022-04-20 04:26:05,312 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 04:26:05,312 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 214.0%
2022-04-20 04:26:41,340 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.484, Acc: 0.836, Base Lr: 6.42e-03
2022-04-20 04:27:20,106 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.471, Acc: 0.848, Base Lr: 6.42e-03
2022-04-20 04:27:45,658 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.368[s] Speed: 43.5[samples/s]
2022-04-20 04:28:19,104 reid_baseline.train INFO: normal accuracy 0.738772146683148 2.0772738456726074 
2022-04-20 04:28:19,973 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 04:28:19,973 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 207.7%
2022-04-20 04:28:57,592 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.380, Acc: 0.885, Base Lr: 7.21e-03
2022-04-20 04:29:32,967 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.360, Acc: 0.880, Base Lr: 7.21e-03
2022-04-20 04:29:57,769 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.358[s] Speed: 44.7[samples/s]
2022-04-20 04:30:31,466 reid_baseline.train INFO: normal accuracy 0.7375360527400082 1.9670547246932983 
2022-04-20 04:30:32,296 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 04:30:32,296 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 196.7%
2022-04-20 04:31:10,104 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.328, Acc: 0.899, Base Lr: 4.01e-03
2022-04-20 04:31:48,567 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.343, Acc: 0.897, Base Lr: 4.01e-03
2022-04-20 04:32:14,086 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-20 04:32:47,673 reid_baseline.train INFO: normal accuracy 0.7408323032550473 1.9211422204971313 
2022-04-20 04:32:48,521 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 04:32:48,522 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 192.1%
2022-04-20 04:33:29,612 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.305, Acc: 0.898, Base Lr: 3.38e-03
2022-04-20 04:34:03,550 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.311, Acc: 0.901, Base Lr: 3.38e-03
2022-04-20 04:34:28,262 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.365[s] Speed: 43.9[samples/s]
2022-04-20 04:35:03,907 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.9095747470855713 
2022-04-20 04:35:04,673 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 04:35:04,673 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 191.0%
2022-04-20 04:35:39,332 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.285, Acc: 0.925, Base Lr: 2.77e-03
2022-04-20 04:36:12,489 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.272, Acc: 0.916, Base Lr: 2.77e-03
2022-04-20 04:36:44,454 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-20 04:37:17,973 reid_baseline.train INFO: normal accuracy 0.7400082406262876 1.8804646730422974 
2022-04-20 04:37:18,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 04:37:18,860 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 188.0%
2022-04-20 04:37:54,498 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.276, Acc: 0.919, Base Lr: 2.20e-03
2022-04-20 04:38:34,854 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.290, Acc: 0.919, Base Lr: 2.20e-03
2022-04-20 04:39:00,739 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-04-20 04:39:34,129 reid_baseline.train INFO: normal accuracy 0.746188710341986 1.9045745134353638 
2022-04-20 04:39:34,131 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 04:39:34,132 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 190.5%
2022-04-20 04:40:13,585 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.286, Acc: 0.920, Base Lr: 1.66e-03
2022-04-20 04:40:48,684 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.270, Acc: 0.926, Base Lr: 1.66e-03
2022-04-20 04:41:15,336 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.371[s] Speed: 43.2[samples/s]
2022-04-20 04:41:49,690 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.9386845827102661 
2022-04-20 04:41:49,693 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 04:41:49,693 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 193.9%
2022-04-20 04:42:27,389 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.185, Acc: 0.936, Base Lr: 1.19e-03
2022-04-20 04:43:05,851 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.217, Acc: 0.930, Base Lr: 1.19e-03
2022-04-20 04:43:32,370 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-04-20 04:44:05,885 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.8559242486953735 
2022-04-20 04:44:06,742 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 04:44:06,742 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 185.6%
2022-04-20 04:44:47,524 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.254, Acc: 0.941, Base Lr: 7.78e-04
2022-04-20 04:45:21,404 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.235, Acc: 0.931, Base Lr: 7.78e-04
2022-04-20 04:45:46,463 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.365[s] Speed: 43.9[samples/s]
2022-04-20 04:46:21,196 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.8674958944320679 
2022-04-20 04:46:21,196 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 04:46:21,196 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 186.7%
2022-04-20 04:47:00,143 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.212, Acc: 0.937, Base Lr: 4.51e-04
2022-04-20 04:47:40,424 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.231, Acc: 0.932, Base Lr: 4.51e-04
2022-04-20 04:48:04,649 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.379[s] Speed: 42.3[samples/s]
2022-04-20 04:48:34,659 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.80885648727417 
2022-04-20 04:48:35,406 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 04:48:35,406 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 180.9%
2022-04-20 04:49:04,891 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.229, Acc: 0.931, Base Lr: 2.11e-04
2022-04-20 04:49:38,884 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.216, Acc: 0.933, Base Lr: 2.11e-04
2022-04-20 04:49:58,936 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-20 04:50:32,631 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8326529264450073 
2022-04-20 04:50:32,632 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 04:50:32,632 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.3%
2022-04-20 04:51:03,954 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.228, Acc: 0.933, Base Lr: 6.51e-05
2022-04-20 04:51:32,040 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.230, Acc: 0.931, Base Lr: 6.51e-05
2022-04-20 04:51:57,302 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.310[s] Speed: 51.7[samples/s]
2022-04-20 04:52:29,651 reid_baseline.train INFO: normal accuracy 0.7470127729707458 1.8416532278060913 
2022-04-20 04:52:29,651 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 04:52:29,652 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 184.2%
2022-04-20 04:53:00,873 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.229, Acc: 0.929, Base Lr: 1.60e-05
2022-04-20 04:53:31,725 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.230, Acc: 0.930, Base Lr: 1.60e-05
2022-04-20 04:53:52,851 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-20 04:54:25,888 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.856704592704773 
2022-04-20 04:54:25,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 04:54:25,890 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 185.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_2/transformer_best_model.pth
2022-04-20 04:55:00,504 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.80885648727417 
2022-04-20 04:55:00,505 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:55:00,505 reid_baseline.train INFO: Accuracy: 74.7%
2022-04-20 04:55:31,898 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.80885648727417 
2022-04-20 04:55:31,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:55:31,899 reid_baseline.train INFO: Shuffled Accuracy: 74.7%
2022-04-20 04:56:15,273 reid_baseline.train INFO: normal accuracy 0.9589919816723941 0.7798940539360046 
2022-04-20 04:56:15,273 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:56:15,274 reid_baseline.train INFO: Source Clean Accuracy: 95.9%
2022-04-20 04:56:21,311 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_2
2022-04-20 04:56:21,312 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-20 04:56:21,312 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 04:56:21,312 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 04:56:21,312 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 04:56:32,027 reid_baseline.train INFO: start training
2022-04-20 04:57:19,895 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.263, Acc: 0.280, Base Lr: 8.72e-04
2022-04-20 04:57:50,159 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.186, Acc: 0.373, Base Lr: 8.72e-04
2022-04-20 04:58:11,812 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-20 04:58:54,820 reid_baseline.train INFO: normal accuracy 0.5411128632574904 4.164280891418457 
2022-04-20 04:58:55,649 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 04:58:55,649 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 416.4%
2022-04-20 04:59:28,667 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.728, Acc: 0.554, Base Lr: 1.66e-03
2022-04-20 05:00:04,222 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.593, Acc: 0.569, Base Lr: 1.66e-03
2022-04-20 05:00:24,519 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.326[s] Speed: 49.2[samples/s]
2022-04-20 05:01:10,145 reid_baseline.train INFO: normal accuracy 0.5917999549448074 3.974043369293213 
2022-04-20 05:01:11,037 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 05:01:11,037 reid_baseline.train INFO: Accuracy: 59.2% Mean Entropy: 397.4%
2022-04-20 05:01:41,346 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.827, Acc: 0.610, Base Lr: 2.46e-03
2022-04-20 05:02:10,247 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.687, Acc: 0.628, Base Lr: 2.46e-03
2022-04-20 05:02:37,692 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.317[s] Speed: 50.4[samples/s]
2022-04-20 05:03:20,406 reid_baseline.train INFO: normal accuracy 0.653300292858752 3.17940616607666 
2022-04-20 05:03:21,276 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 05:03:21,277 reid_baseline.train INFO: Accuracy: 65.3% Mean Entropy: 317.9%
2022-04-20 05:03:52,280 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.142, Acc: 0.699, Base Lr: 3.25e-03
2022-04-20 05:04:22,414 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.083, Acc: 0.701, Base Lr: 3.25e-03
2022-04-20 05:04:40,956 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-20 05:05:22,885 reid_baseline.train INFO: normal accuracy 0.7015093489524667 2.5760304927825928 
2022-04-20 05:05:23,772 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 05:05:23,772 reid_baseline.train INFO: Accuracy: 70.2% Mean Entropy: 257.6%
2022-04-20 05:05:51,667 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.797, Acc: 0.766, Base Lr: 4.04e-03
2022-04-20 05:06:18,817 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.791, Acc: 0.775, Base Lr: 4.04e-03
2022-04-20 05:06:38,065 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.272[s] Speed: 58.8[samples/s]
2022-04-20 05:07:17,738 reid_baseline.train INFO: normal accuracy 0.7208830817751746 2.197275400161743 
2022-04-20 05:07:18,646 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 05:07:18,647 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 219.7%
2022-04-20 05:07:53,111 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.659, Acc: 0.800, Base Lr: 4.83e-03
2022-04-20 05:08:19,362 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.657, Acc: 0.807, Base Lr: 4.83e-03
2022-04-20 05:08:39,177 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-20 05:09:18,871 reid_baseline.train INFO: normal accuracy 0.7434106780806488 2.0078959465026855 
2022-04-20 05:09:19,759 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 05:09:19,760 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 200.8%
2022-04-20 05:09:47,221 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.574, Acc: 0.833, Base Lr: 5.62e-03
2022-04-20 05:10:19,539 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.531, Acc: 0.840, Base Lr: 5.62e-03
2022-04-20 05:10:42,941 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.305[s] Speed: 52.5[samples/s]
2022-04-20 05:11:23,431 reid_baseline.train INFO: normal accuracy 0.7467898175264699 1.9175355434417725 
2022-04-20 05:11:24,312 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 05:11:24,312 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 191.8%
2022-04-20 05:11:53,918 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.484, Acc: 0.836, Base Lr: 6.42e-03
2022-04-20 05:12:20,128 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.471, Acc: 0.848, Base Lr: 6.42e-03
2022-04-20 05:12:43,410 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-20 05:13:22,150 reid_baseline.train INFO: normal accuracy 0.7553503041225501 1.8505597114562988 
2022-04-20 05:13:23,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 05:13:23,021 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 185.1%
2022-04-20 05:13:49,282 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.381, Acc: 0.884, Base Lr: 7.21e-03
2022-04-20 05:14:14,631 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.361, Acc: 0.881, Base Lr: 7.21e-03
2022-04-20 05:14:35,554 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.266[s] Speed: 60.2[samples/s]
2022-04-20 05:15:14,336 reid_baseline.train INFO: normal accuracy 0.759855823383645 1.8380903005599976 
2022-04-20 05:15:15,175 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 05:15:15,175 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 183.8%
2022-04-20 05:15:50,555 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.328, Acc: 0.900, Base Lr: 4.01e-03
2022-04-20 05:16:14,404 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.343, Acc: 0.897, Base Lr: 4.01e-03
2022-04-20 05:16:34,119 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-20 05:17:15,060 reid_baseline.train INFO: normal accuracy 0.7645866186077945 1.7573472261428833 
2022-04-20 05:17:15,901 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 05:17:15,901 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 175.7%
2022-04-20 05:17:44,656 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.305, Acc: 0.899, Base Lr: 3.38e-03
2022-04-20 05:18:17,959 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.311, Acc: 0.902, Base Lr: 3.38e-03
2022-04-20 05:18:37,988 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-20 05:19:20,025 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.7454545497894287 
2022-04-20 05:19:20,872 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 05:19:20,873 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 174.5%
2022-04-20 05:19:49,780 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.284, Acc: 0.924, Base Lr: 2.77e-03
2022-04-20 05:20:15,527 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.271, Acc: 0.916, Base Lr: 2.77e-03
2022-04-20 05:20:40,237 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-20 05:21:19,274 reid_baseline.train INFO: normal accuracy 0.7686415859427799 1.7271333932876587 
2022-04-20 05:21:20,093 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 05:21:20,093 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 172.7%
2022-04-20 05:21:49,708 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.277, Acc: 0.918, Base Lr: 2.20e-03
2022-04-20 05:22:18,933 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.291, Acc: 0.918, Base Lr: 2.20e-03
2022-04-20 05:22:37,333 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.283[s] Speed: 56.6[samples/s]
2022-04-20 05:23:17,802 reid_baseline.train INFO: normal accuracy 0.7684163099797252 1.747103214263916 
2022-04-20 05:23:17,805 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 05:23:17,805 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 174.7%
2022-04-20 05:23:47,953 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.287, Acc: 0.920, Base Lr: 1.66e-03
2022-04-20 05:24:14,881 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.270, Acc: 0.925, Base Lr: 1.66e-03
2022-04-20 05:24:33,468 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.277[s] Speed: 57.7[samples/s]
2022-04-20 05:25:14,029 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.7935470342636108 
2022-04-20 05:25:14,030 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 05:25:14,030 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 179.4%
2022-04-20 05:25:47,298 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.186, Acc: 0.936, Base Lr: 1.19e-03
2022-04-20 05:26:18,492 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.218, Acc: 0.930, Base Lr: 1.19e-03
2022-04-20 05:26:36,981 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-20 05:27:18,783 reid_baseline.train INFO: normal accuracy 0.7672899301644515 1.7304537296295166 
2022-04-20 05:27:18,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 05:27:18,784 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 173.0%
2022-04-20 05:27:48,690 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.255, Acc: 0.942, Base Lr: 7.78e-04
2022-04-20 05:28:19,876 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.236, Acc: 0.932, Base Lr: 7.78e-04
2022-04-20 05:28:44,994 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.316[s] Speed: 50.7[samples/s]
2022-04-20 05:29:22,172 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.7276864051818848 
2022-04-20 05:29:22,175 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 05:29:22,175 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 172.8%
2022-04-20 05:29:47,878 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.212, Acc: 0.936, Base Lr: 4.51e-04
2022-04-20 05:30:15,640 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.232, Acc: 0.932, Base Lr: 4.51e-04
2022-04-20 05:30:39,685 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.283[s] Speed: 56.5[samples/s]
2022-04-20 05:31:18,995 reid_baseline.train INFO: normal accuracy 0.771119621536382 1.6770482063293457 
2022-04-20 05:31:19,862 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 05:31:19,862 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 167.7%
2022-04-20 05:31:48,409 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.229, Acc: 0.930, Base Lr: 2.11e-04
2022-04-20 05:32:15,764 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.216, Acc: 0.933, Base Lr: 2.11e-04
2022-04-20 05:32:36,057 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.279[s] Speed: 57.3[samples/s]
2022-04-20 05:33:15,838 reid_baseline.train INFO: normal accuracy 0.7706690696102726 1.7009223699569702 
2022-04-20 05:33:15,840 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 05:33:15,841 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 170.1%
2022-04-20 05:33:52,417 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.228, Acc: 0.935, Base Lr: 6.51e-05
2022-04-20 05:34:16,614 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.230, Acc: 0.931, Base Lr: 6.51e-05
2022-04-20 05:34:36,686 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-20 05:35:18,073 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.7142804861068726 
2022-04-20 05:35:18,074 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 05:35:18,074 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 171.4%
2022-04-20 05:35:47,710 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.229, Acc: 0.930, Base Lr: 1.60e-05
2022-04-20 05:36:21,747 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.230, Acc: 0.930, Base Lr: 1.60e-05
2022-04-20 05:36:39,788 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-20 05:37:21,867 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.7259430885314941 
2022-04-20 05:37:21,869 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 05:37:21,870 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 172.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_2/transformer_best_model.pth
2022-04-20 05:38:03,009 reid_baseline.train INFO: normal accuracy 0.771119621536382 1.6770482063293457 
2022-04-20 05:38:03,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 05:38:03,010 reid_baseline.train INFO: Accuracy: 77.1%
2022-04-20 05:38:39,713 reid_baseline.train INFO: normal accuracy 0.771119621536382 1.6770482063293457 
2022-04-20 05:38:39,713 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 05:38:39,713 reid_baseline.train INFO: Shuffled Accuracy: 77.1%
2022-04-20 05:39:19,375 reid_baseline.train INFO: normal accuracy 0.9589919816723941 0.7802925109863281 
2022-04-20 05:39:19,375 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 05:39:19,375 reid_baseline.train INFO: Source Clean Accuracy: 95.9%
2022-04-20 05:39:25,065 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_3
2022-04-20 05:39:25,065 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-20 05:39:25,065 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 05:39:25,065 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 05:39:25,066 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 05:39:35,658 reid_baseline.train INFO: start training
2022-04-20 05:40:13,320 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.279, Acc: 0.288, Base Lr: 8.72e-04
2022-04-20 05:40:40,210 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.186, Acc: 0.384, Base Lr: 8.72e-04
2022-04-20 05:40:57,051 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-20 05:41:28,226 reid_baseline.train INFO: normal accuracy 0.5199835187474248 4.166664123535156 
2022-04-20 05:41:29,032 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 05:41:29,033 reid_baseline.train INFO: Accuracy: 52.0% Mean Entropy: 416.7%
2022-04-20 05:41:57,728 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.746, Acc: 0.574, Base Lr: 1.66e-03
2022-04-20 05:42:25,509 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.574, Acc: 0.583, Base Lr: 1.66e-03
2022-04-20 05:42:43,363 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.272[s] Speed: 58.8[samples/s]
2022-04-20 05:43:15,770 reid_baseline.train INFO: normal accuracy 0.5492377420683972 4.029966354370117 
2022-04-20 05:43:16,613 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 05:43:16,614 reid_baseline.train INFO: Accuracy: 54.9% Mean Entropy: 403.0%
2022-04-20 05:43:43,846 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.848, Acc: 0.614, Base Lr: 2.46e-03
2022-04-20 05:44:09,756 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.708, Acc: 0.620, Base Lr: 2.46e-03
2022-04-20 05:44:31,996 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.276[s] Speed: 58.0[samples/s]
2022-04-20 05:45:01,195 reid_baseline.train INFO: normal accuracy 0.6299958796868562 3.4359471797943115 
2022-04-20 05:45:02,077 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 05:45:02,078 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 343.6%
2022-04-20 05:45:33,943 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.153, Acc: 0.700, Base Lr: 3.25e-03
2022-04-20 05:46:04,590 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.072, Acc: 0.708, Base Lr: 3.25e-03
2022-04-20 05:46:32,898 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.332[s] Speed: 48.1[samples/s]
2022-04-20 05:47:05,135 reid_baseline.train INFO: normal accuracy 0.6794396374124434 2.8432023525238037 
2022-04-20 05:47:06,031 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 05:47:06,031 reid_baseline.train INFO: Accuracy: 67.9% Mean Entropy: 284.3%
2022-04-20 05:47:39,495 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.811, Acc: 0.770, Base Lr: 4.04e-03
2022-04-20 05:48:16,117 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.826, Acc: 0.768, Base Lr: 4.04e-03
2022-04-20 05:48:40,039 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-20 05:49:13,121 reid_baseline.train INFO: normal accuracy 0.707457766790276 2.476489305496216 
2022-04-20 05:49:14,025 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 05:49:14,026 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 247.6%
2022-04-20 05:49:50,859 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.642, Acc: 0.809, Base Lr: 4.83e-03
2022-04-20 05:50:23,492 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.636, Acc: 0.806, Base Lr: 4.83e-03
2022-04-20 05:50:45,755 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.336[s] Speed: 47.7[samples/s]
2022-04-20 05:51:17,267 reid_baseline.train INFO: normal accuracy 0.7198187062216729 2.2702436447143555 
2022-04-20 05:51:18,144 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 05:51:18,144 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 227.0%
2022-04-20 05:51:56,185 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.536, Acc: 0.827, Base Lr: 5.62e-03
2022-04-20 05:52:29,251 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.541, Acc: 0.829, Base Lr: 5.62e-03
2022-04-20 05:52:56,897 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-20 05:53:30,172 reid_baseline.train INFO: normal accuracy 0.73094355170993 2.105473041534424 
2022-04-20 05:53:31,013 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 05:53:31,014 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 210.5%
2022-04-20 05:54:08,920 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.410, Acc: 0.857, Base Lr: 6.42e-03
2022-04-20 05:54:42,737 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.415, Acc: 0.859, Base Lr: 6.42e-03
2022-04-20 05:55:07,807 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.354[s] Speed: 45.1[samples/s]
2022-04-20 05:55:39,304 reid_baseline.train INFO: normal accuracy 0.7358879274824887 2.0379831790924072 
2022-04-20 05:55:40,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 05:55:40,194 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 203.8%
2022-04-20 05:56:13,479 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.290, Acc: 0.886, Base Lr: 7.21e-03
2022-04-20 05:56:46,530 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.347, Acc: 0.886, Base Lr: 7.21e-03
2022-04-20 05:57:13,497 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-20 05:57:46,302 reid_baseline.train INFO: normal accuracy 0.722702925422332 1.9534395933151245 
2022-04-20 05:57:47,241 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 05:57:47,241 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 195.3%
2022-04-20 05:58:20,292 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.347, Acc: 0.893, Base Lr: 4.01e-03
2022-04-20 05:58:58,312 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.352, Acc: 0.889, Base Lr: 4.01e-03
2022-04-20 05:59:22,498 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-04-20 05:59:54,915 reid_baseline.train INFO: normal accuracy 0.734651833539349 1.938908338546753 
2022-04-20 05:59:56,583 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 05:59:56,584 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 193.9%
2022-04-20 06:00:33,963 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.301, Acc: 0.899, Base Lr: 3.38e-03
2022-04-20 06:01:07,504 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.297, Acc: 0.902, Base Lr: 3.38e-03
2022-04-20 06:01:31,611 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-20 06:02:04,394 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.9004292488098145 
2022-04-20 06:02:05,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 06:02:05,322 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 190.0%
2022-04-20 06:02:41,700 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.217, Acc: 0.913, Base Lr: 2.77e-03
2022-04-20 06:03:14,896 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.237, Acc: 0.910, Base Lr: 2.77e-03
2022-04-20 06:03:41,049 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.351[s] Speed: 45.6[samples/s]
2022-04-20 06:04:14,416 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.8840773105621338 
2022-04-20 06:04:15,279 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 06:04:15,280 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 188.4%
2022-04-20 06:04:50,042 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.302, Acc: 0.923, Base Lr: 2.20e-03
2022-04-20 06:05:25,226 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.280, Acc: 0.920, Base Lr: 2.20e-03
2022-04-20 06:05:48,263 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.341[s] Speed: 47.0[samples/s]
2022-04-20 06:06:21,812 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.8099044561386108 
2022-04-20 06:06:22,706 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 06:06:22,706 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 181.0%
2022-04-20 06:06:57,704 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.244, Acc: 0.915, Base Lr: 1.66e-03
2022-04-20 06:07:29,176 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.226, Acc: 0.927, Base Lr: 1.66e-03
2022-04-20 06:07:56,678 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-20 06:08:25,851 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.9161648750305176 
2022-04-20 06:08:25,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 06:08:25,851 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 191.6%
2022-04-20 06:08:57,891 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.247, Acc: 0.923, Base Lr: 1.19e-03
2022-04-20 06:09:35,339 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.219, Acc: 0.932, Base Lr: 1.19e-03
2022-04-20 06:10:00,062 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-20 06:10:33,186 reid_baseline.train INFO: normal accuracy 0.7482488669138855 1.8266615867614746 
2022-04-20 06:10:33,187 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 06:10:33,187 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 182.7%
2022-04-20 06:11:12,246 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.235, Acc: 0.923, Base Lr: 7.78e-04
2022-04-20 06:11:45,320 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.211, Acc: 0.925, Base Lr: 7.78e-04
2022-04-20 06:12:07,754 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.346[s] Speed: 46.3[samples/s]
2022-04-20 06:12:39,589 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.892606258392334 
2022-04-20 06:12:39,590 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 06:12:39,590 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 189.3%
2022-04-20 06:13:16,844 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.265, Acc: 0.934, Base Lr: 4.51e-04
2022-04-20 06:13:51,677 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.254, Acc: 0.928, Base Lr: 4.51e-04
2022-04-20 06:14:18,330 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-20 06:14:49,917 reid_baseline.train INFO: normal accuracy 0.7441285537700866 1.8221676349639893 
2022-04-20 06:14:49,918 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 06:14:49,918 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 182.2%
2022-04-20 06:15:24,390 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.222, Acc: 0.928, Base Lr: 2.11e-04
2022-04-20 06:15:58,704 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.199, Acc: 0.931, Base Lr: 2.11e-04
2022-04-20 06:16:26,521 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-20 06:17:00,812 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.8024485111236572 
2022-04-20 06:17:01,626 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 06:17:01,627 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 180.2%
2022-04-20 06:17:33,254 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.237, Acc: 0.934, Base Lr: 6.51e-05
2022-04-20 06:17:55,970 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.234, Acc: 0.933, Base Lr: 6.51e-05
2022-04-20 06:18:15,423 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.270[s] Speed: 59.2[samples/s]
2022-04-20 06:18:47,191 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8837085962295532 
2022-04-20 06:18:47,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 06:18:47,191 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 188.4%
2022-04-20 06:19:16,163 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.252, Acc: 0.932, Base Lr: 1.60e-05
2022-04-20 06:19:42,507 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.233, Acc: 0.933, Base Lr: 1.60e-05
2022-04-20 06:20:01,970 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.273[s] Speed: 58.5[samples/s]
2022-04-20 06:20:35,248 reid_baseline.train INFO: normal accuracy 0.7478368355995055 1.818090558052063 
2022-04-20 06:20:35,248 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 06:20:35,248 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 181.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_3/transformer_best_model.pth
2022-04-20 06:21:07,944 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.8024485111236572 
2022-04-20 06:21:07,944 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 06:21:07,944 reid_baseline.train INFO: Accuracy: 74.3%
2022-04-20 06:21:35,987 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.8024485111236572 
2022-04-20 06:21:35,988 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 06:21:35,988 reid_baseline.train INFO: Shuffled Accuracy: 74.3%
2022-04-20 06:22:18,457 reid_baseline.train INFO: normal accuracy 0.9631156930126002 0.7794095873832703 
2022-04-20 06:22:18,457 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 06:22:18,457 reid_baseline.train INFO: Source Clean Accuracy: 96.3%
2022-04-20 06:22:24,140 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_3
2022-04-20 06:22:24,140 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-20 06:22:24,141 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 06:22:24,141 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 06:22:24,141 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 06:22:34,947 reid_baseline.train INFO: start training
2022-04-20 06:23:12,241 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.279, Acc: 0.288, Base Lr: 8.72e-04
2022-04-20 06:23:41,924 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.186, Acc: 0.384, Base Lr: 8.72e-04
2022-04-20 06:24:05,972 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-20 06:24:45,935 reid_baseline.train INFO: normal accuracy 0.5435908988510926 4.164173603057861 
2022-04-20 06:24:46,855 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 06:24:46,856 reid_baseline.train INFO: Accuracy: 54.4% Mean Entropy: 416.4%
2022-04-20 06:25:15,172 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.746, Acc: 0.574, Base Lr: 1.66e-03
2022-04-20 06:25:43,685 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.574, Acc: 0.583, Base Lr: 1.66e-03
2022-04-20 06:26:03,155 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.279[s] Speed: 57.3[samples/s]
2022-04-20 06:26:43,174 reid_baseline.train INFO: normal accuracy 0.5782833971615229 3.971245527267456 
2022-04-20 06:26:44,025 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 06:26:44,025 reid_baseline.train INFO: Accuracy: 57.8% Mean Entropy: 397.1%
2022-04-20 06:27:10,105 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.848, Acc: 0.614, Base Lr: 2.46e-03
2022-04-20 06:27:36,294 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.708, Acc: 0.620, Base Lr: 2.46e-03
2022-04-20 06:27:54,926 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.260[s] Speed: 61.6[samples/s]
2022-04-20 06:28:34,732 reid_baseline.train INFO: normal accuracy 0.6519486370804235 3.2205867767333984 
2022-04-20 06:28:35,554 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 06:28:35,554 reid_baseline.train INFO: Accuracy: 65.2% Mean Entropy: 322.1%
2022-04-20 06:29:09,915 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.153, Acc: 0.701, Base Lr: 3.25e-03
2022-04-20 06:29:36,651 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.072, Acc: 0.708, Base Lr: 3.25e-03
2022-04-20 06:29:56,709 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-20 06:30:37,511 reid_baseline.train INFO: normal accuracy 0.7042126605091237 2.525552272796631 
2022-04-20 06:30:38,498 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 06:30:38,498 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 252.6%
2022-04-20 06:31:05,968 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.812, Acc: 0.770, Base Lr: 4.04e-03
2022-04-20 06:31:40,879 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.827, Acc: 0.768, Base Lr: 4.04e-03
2022-04-20 06:32:00,955 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-20 06:32:45,428 reid_baseline.train INFO: normal accuracy 0.7204325298490651 2.189185619354248 
2022-04-20 06:32:46,311 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 06:32:46,311 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 218.9%
2022-04-20 06:33:15,433 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.642, Acc: 0.809, Base Lr: 4.83e-03
2022-04-20 06:33:42,716 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.636, Acc: 0.806, Base Lr: 4.83e-03
2022-04-20 06:34:06,623 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-20 06:34:46,757 reid_baseline.train INFO: normal accuracy 0.7373282270781708 1.9715806245803833 
2022-04-20 06:34:47,630 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 06:34:47,631 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 197.2%
2022-04-20 06:35:18,470 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.536, Acc: 0.827, Base Lr: 5.62e-03
2022-04-20 06:35:44,736 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.541, Acc: 0.829, Base Lr: 5.62e-03
2022-04-20 06:36:04,655 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.282[s] Speed: 56.8[samples/s]
2022-04-20 06:36:45,452 reid_baseline.train INFO: normal accuracy 0.7546744762333859 1.8722350597381592 
2022-04-20 06:36:46,318 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 06:36:46,318 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 187.2%
2022-04-20 06:37:16,315 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.409, Acc: 0.857, Base Lr: 6.42e-03
2022-04-20 06:37:44,598 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.416, Acc: 0.859, Base Lr: 6.42e-03
2022-04-20 06:38:03,825 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.283[s] Speed: 56.5[samples/s]
2022-04-20 06:38:45,168 reid_baseline.train INFO: normal accuracy 0.7609822031989186 1.8727859258651733 
2022-04-20 06:38:45,168 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 06:38:45,168 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 187.3%
2022-04-20 06:39:20,317 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.290, Acc: 0.886, Base Lr: 7.21e-03
2022-04-20 06:39:50,185 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.347, Acc: 0.886, Base Lr: 7.21e-03
2022-04-20 06:40:09,915 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.310[s] Speed: 51.5[samples/s]
2022-04-20 06:40:51,302 reid_baseline.train INFO: normal accuracy 0.7632349628294661 1.7682255506515503 
2022-04-20 06:40:52,216 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 06:40:52,217 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 176.8%
2022-04-20 06:41:20,185 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.348, Acc: 0.893, Base Lr: 4.01e-03
2022-04-20 06:41:52,679 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.353, Acc: 0.888, Base Lr: 4.01e-03
2022-04-20 06:42:16,804 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-20 06:42:57,826 reid_baseline.train INFO: normal accuracy 0.7625591349403019 1.760399580001831 
2022-04-20 06:42:58,721 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 06:42:58,721 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 176.0%
2022-04-20 06:43:27,762 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.300, Acc: 0.901, Base Lr: 3.38e-03
2022-04-20 06:43:53,623 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.296, Acc: 0.903, Base Lr: 3.38e-03
2022-04-20 06:44:16,270 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.284[s] Speed: 56.4[samples/s]
2022-04-20 06:44:55,683 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.7673755884170532 
2022-04-20 06:44:55,683 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 06:44:55,684 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 176.7%
2022-04-20 06:45:22,387 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.217, Acc: 0.913, Base Lr: 2.77e-03
2022-04-20 06:45:49,932 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.237, Acc: 0.909, Base Lr: 2.77e-03
2022-04-20 06:46:09,462 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.270[s] Speed: 59.2[samples/s]
2022-04-20 06:46:49,161 reid_baseline.train INFO: normal accuracy 0.7684163099797252 1.752008318901062 
2022-04-20 06:46:50,118 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 06:46:50,118 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 175.2%
2022-04-20 06:47:23,688 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.301, Acc: 0.924, Base Lr: 2.20e-03
2022-04-20 06:47:48,517 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.279, Acc: 0.921, Base Lr: 2.20e-03
2022-04-20 06:48:06,805 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.281[s] Speed: 57.0[samples/s]
2022-04-20 06:48:49,472 reid_baseline.train INFO: normal accuracy 0.771119621536382 1.675339937210083 
2022-04-20 06:48:50,333 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 06:48:50,333 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 167.5%
2022-04-20 06:49:21,892 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.243, Acc: 0.916, Base Lr: 1.66e-03
2022-04-20 06:49:54,695 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.226, Acc: 0.927, Base Lr: 1.66e-03
2022-04-20 06:50:12,657 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-20 06:50:55,381 reid_baseline.train INFO: normal accuracy 0.7652624464969587 1.7746942043304443 
2022-04-20 06:50:55,381 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 06:50:55,381 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 177.5%
2022-04-20 06:51:23,069 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.247, Acc: 0.922, Base Lr: 1.19e-03
2022-04-20 06:51:51,256 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.219, Acc: 0.931, Base Lr: 1.19e-03
2022-04-20 06:52:15,550 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-20 06:52:56,225 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.686956524848938 
2022-04-20 06:52:56,226 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 06:52:56,226 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 168.7%
2022-04-20 06:53:25,970 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.234, Acc: 0.924, Base Lr: 7.78e-04
2022-04-20 06:53:51,308 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.210, Acc: 0.926, Base Lr: 7.78e-04
2022-04-20 06:54:10,734 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.273[s] Speed: 58.7[samples/s]
2022-04-20 06:54:51,830 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7583976984024048 
2022-04-20 06:54:51,831 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 06:54:51,831 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 175.8%
2022-04-20 06:55:22,037 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.265, Acc: 0.934, Base Lr: 4.51e-04
2022-04-20 06:55:48,328 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.253, Acc: 0.928, Base Lr: 4.51e-04
2022-04-20 06:56:07,796 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.278[s] Speed: 57.5[samples/s]
2022-04-20 06:56:48,276 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.6893390417099 
2022-04-20 06:56:48,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 06:56:48,277 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 168.9%
2022-04-20 06:57:21,721 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.221, Acc: 0.928, Base Lr: 2.11e-04
2022-04-20 06:57:51,588 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.199, Acc: 0.931, Base Lr: 2.11e-04
2022-04-20 06:58:10,288 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-20 06:58:51,730 reid_baseline.train INFO: normal accuracy 0.7706690696102726 1.6701946258544922 
2022-04-20 06:58:52,599 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 06:58:52,599 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 167.0%
2022-04-20 06:59:20,382 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.236, Acc: 0.935, Base Lr: 6.51e-05
2022-04-20 06:59:50,444 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.234, Acc: 0.933, Base Lr: 6.51e-05
2022-04-20 07:00:13,956 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.298[s] Speed: 53.8[samples/s]
2022-04-20 07:00:56,636 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.7456581592559814 
2022-04-20 07:00:56,638 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 07:00:56,638 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 174.6%
2022-04-20 07:01:25,391 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.252, Acc: 0.931, Base Lr: 1.60e-05
2022-04-20 07:01:51,623 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.233, Acc: 0.933, Base Lr: 1.60e-05
2022-04-20 07:02:13,028 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-20 07:02:56,722 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.6867527961730957 
2022-04-20 07:02:56,722 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 07:02:56,723 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 168.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_3/transformer_best_model.pth
2022-04-20 07:03:38,225 reid_baseline.train INFO: normal accuracy 0.7706690696102726 1.6701946258544922 
2022-04-20 07:03:38,226 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:03:38,226 reid_baseline.train INFO: Accuracy: 77.1%
2022-04-20 07:04:11,544 reid_baseline.train INFO: normal accuracy 0.7706690696102726 1.6701946258544922 
2022-04-20 07:04:11,544 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:04:11,545 reid_baseline.train INFO: Shuffled Accuracy: 77.1%
2022-04-20 07:04:52,823 reid_baseline.train INFO: normal accuracy 0.9633447880870561 0.7799597978591919 
2022-04-20 07:04:52,823 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:04:52,823 reid_baseline.train INFO: Source Clean Accuracy: 96.3%
2022-04-20 07:04:58,458 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_4
2022-04-20 07:04:58,458 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-20 07:04:58,458 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 07:04:58,458 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 07:04:58,459 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 07:05:09,651 reid_baseline.train INFO: start training
2022-04-20 07:05:45,595 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.255, Acc: 0.291, Base Lr: 8.72e-04
2022-04-20 07:06:10,736 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.171, Acc: 0.382, Base Lr: 8.72e-04
2022-04-20 07:06:30,579 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-20 07:07:03,194 reid_baseline.train INFO: normal accuracy 0.5179233621755254 4.1665873527526855 
2022-04-20 07:07:04,093 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 07:07:04,093 reid_baseline.train INFO: Accuracy: 51.8% Mean Entropy: 416.7%
2022-04-20 07:07:39,041 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.765, Acc: 0.561, Base Lr: 1.66e-03
2022-04-20 07:08:05,164 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.600, Acc: 0.566, Base Lr: 1.66e-03
2022-04-20 07:08:25,970 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-20 07:08:58,622 reid_baseline.train INFO: normal accuracy 0.5640708693860733 4.03226375579834 
2022-04-20 07:08:59,508 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 07:08:59,509 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 403.2%
2022-04-20 07:09:27,092 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.845, Acc: 0.622, Base Lr: 2.46e-03
2022-04-20 07:09:52,564 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.690, Acc: 0.633, Base Lr: 2.46e-03
2022-04-20 07:10:12,378 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.267[s] Speed: 60.0[samples/s]
2022-04-20 07:10:44,792 reid_baseline.train INFO: normal accuracy 0.6234033786567779 3.4401440620422363 
2022-04-20 07:10:45,789 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 07:10:45,789 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 344.0%
2022-04-20 07:11:13,562 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.202, Acc: 0.694, Base Lr: 3.25e-03
2022-04-20 07:11:40,030 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.121, Acc: 0.703, Base Lr: 3.25e-03
2022-04-20 07:12:00,691 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.274[s] Speed: 58.3[samples/s]
2022-04-20 07:12:33,862 reid_baseline.train INFO: normal accuracy 0.6794396374124434 2.8735806941986084 
2022-04-20 07:12:34,732 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 07:12:34,732 reid_baseline.train INFO: Accuracy: 67.9% Mean Entropy: 287.4%
2022-04-20 07:13:05,868 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.853, Acc: 0.753, Base Lr: 4.04e-03
2022-04-20 07:13:29,698 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.827, Acc: 0.773, Base Lr: 4.04e-03
2022-04-20 07:13:47,840 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.267[s] Speed: 59.8[samples/s]
2022-04-20 07:14:21,054 reid_baseline.train INFO: normal accuracy 0.7012772970745776 2.5165798664093018 
2022-04-20 07:14:21,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 07:14:21,859 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 251.7%
2022-04-20 07:14:54,534 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.657, Acc: 0.805, Base Lr: 4.83e-03
2022-04-20 07:15:30,061 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.665, Acc: 0.805, Base Lr: 4.83e-03
2022-04-20 07:15:54,863 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.341[s] Speed: 47.0[samples/s]
2022-04-20 07:16:30,109 reid_baseline.train INFO: normal accuracy 0.7214668314791924 2.290735960006714 
2022-04-20 07:16:30,924 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 07:16:30,924 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 229.1%
2022-04-20 07:17:05,300 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.514, Acc: 0.832, Base Lr: 5.62e-03
2022-04-20 07:17:37,469 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.518, Acc: 0.828, Base Lr: 5.62e-03
2022-04-20 07:18:00,727 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.329[s] Speed: 48.7[samples/s]
2022-04-20 07:18:32,269 reid_baseline.train INFO: normal accuracy 0.7297074577667902 2.162607192993164 
2022-04-20 07:18:33,106 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 07:18:33,106 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 216.3%
2022-04-20 07:19:07,337 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.500, Acc: 0.859, Base Lr: 6.42e-03
2022-04-20 07:19:41,467 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.473, Acc: 0.857, Base Lr: 6.42e-03
2022-04-20 07:20:06,030 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.340[s] Speed: 47.0[samples/s]
2022-04-20 07:20:39,318 reid_baseline.train INFO: normal accuracy 0.7317676143386898 2.034858465194702 
2022-04-20 07:20:40,161 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 07:20:40,162 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 203.5%
2022-04-20 07:21:16,593 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.417, Acc: 0.869, Base Lr: 7.21e-03
2022-04-20 07:21:49,941 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.413, Acc: 0.877, Base Lr: 7.21e-03
2022-04-20 07:22:13,634 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.342[s] Speed: 46.7[samples/s]
2022-04-20 07:22:47,326 reid_baseline.train INFO: normal accuracy 0.7408323032550473 1.9532649517059326 
2022-04-20 07:22:48,183 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 07:22:48,184 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 195.3%
2022-04-20 07:23:21,689 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.351, Acc: 0.894, Base Lr: 4.01e-03
2022-04-20 07:23:52,637 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.335, Acc: 0.892, Base Lr: 4.01e-03
2022-04-20 07:24:19,595 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-20 07:24:52,653 reid_baseline.train INFO: normal accuracy 0.7400082406262876 1.8650568723678589 
2022-04-20 07:24:54,509 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 07:24:54,509 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 186.5%
2022-04-20 07:25:26,206 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.266, Acc: 0.914, Base Lr: 3.38e-03
2022-04-20 07:26:01,664 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.295, Acc: 0.907, Base Lr: 3.38e-03
2022-04-20 07:26:26,319 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.336[s] Speed: 47.6[samples/s]
2022-04-20 07:26:56,716 reid_baseline.train INFO: normal accuracy 0.7412443345694273 1.874717354774475 
2022-04-20 07:26:56,718 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 07:26:56,718 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 187.5%
2022-04-20 07:27:33,443 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.291, Acc: 0.915, Base Lr: 2.77e-03
2022-04-20 07:28:06,022 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.274, Acc: 0.916, Base Lr: 2.77e-03
2022-04-20 07:28:29,223 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-20 07:29:02,163 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.9057670831680298 
2022-04-20 07:29:02,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 07:29:02,164 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 190.6%
2022-04-20 07:29:36,587 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.274, Acc: 0.908, Base Lr: 2.20e-03
2022-04-20 07:30:11,290 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.261, Acc: 0.917, Base Lr: 2.20e-03
2022-04-20 07:30:34,738 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-20 07:31:06,969 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.8489514589309692 
2022-04-20 07:31:07,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 07:31:07,852 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 184.9%
2022-04-20 07:31:43,226 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.235, Acc: 0.923, Base Lr: 1.66e-03
2022-04-20 07:32:17,865 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.245, Acc: 0.923, Base Lr: 1.66e-03
2022-04-20 07:32:42,018 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-20 07:33:14,380 reid_baseline.train INFO: normal accuracy 0.7507210548001648 1.9395745992660522 
2022-04-20 07:33:14,382 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 07:33:14,382 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 194.0%
2022-04-20 07:33:50,304 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.263, Acc: 0.923, Base Lr: 1.19e-03
2022-04-20 07:34:22,418 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.278, Acc: 0.924, Base Lr: 1.19e-03
2022-04-20 07:34:47,099 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-20 07:35:19,561 reid_baseline.train INFO: normal accuracy 0.7511330861145447 1.8194477558135986 
2022-04-20 07:35:20,431 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 07:35:20,431 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 181.9%
2022-04-20 07:35:54,566 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.257, Acc: 0.931, Base Lr: 7.78e-04
2022-04-20 07:36:30,865 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.252, Acc: 0.933, Base Lr: 7.78e-04
2022-04-20 07:36:52,514 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.337[s] Speed: 47.4[samples/s]
2022-04-20 07:37:23,942 reid_baseline.train INFO: normal accuracy 0.7544293366295839 1.870605707168579 
2022-04-20 07:37:23,944 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 07:37:23,945 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 187.1%
2022-04-20 07:38:01,492 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.242, Acc: 0.924, Base Lr: 4.51e-04
2022-04-20 07:38:32,593 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.221, Acc: 0.925, Base Lr: 4.51e-04
2022-04-20 07:38:56,565 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-20 07:39:30,121 reid_baseline.train INFO: normal accuracy 0.7478368355995055 1.8364311456680298 
2022-04-20 07:39:30,123 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 07:39:30,123 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 183.6%
2022-04-20 07:40:02,631 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.226, Acc: 0.926, Base Lr: 2.11e-04
2022-04-20 07:40:33,724 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.235, Acc: 0.927, Base Lr: 2.11e-04
2022-04-20 07:41:00,012 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-20 07:41:33,029 reid_baseline.train INFO: normal accuracy 0.7527812113720643 1.8409502506256104 
2022-04-20 07:41:33,030 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 07:41:33,030 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 184.1%
2022-04-20 07:42:05,077 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.196, Acc: 0.929, Base Lr: 6.51e-05
2022-04-20 07:42:41,277 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.197, Acc: 0.933, Base Lr: 6.51e-05
2022-04-20 07:43:03,891 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.333[s] Speed: 48.1[samples/s]
2022-04-20 07:43:35,778 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.785855770111084 
2022-04-20 07:43:36,635 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 07:43:36,636 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 178.6%
2022-04-20 07:44:13,671 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.222, Acc: 0.941, Base Lr: 1.60e-05
2022-04-20 07:44:50,531 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.230, Acc: 0.932, Base Lr: 1.60e-05
2022-04-20 07:45:18,961 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.375[s] Speed: 42.7[samples/s]
2022-04-20 07:45:51,546 reid_baseline.train INFO: normal accuracy 0.7531932426864442 1.8323267698287964 
2022-04-20 07:45:51,547 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 07:45:51,547 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 183.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_4/transformer_best_model.pth
2022-04-20 07:46:23,034 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.785855770111084 
2022-04-20 07:46:23,034 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:46:23,034 reid_baseline.train INFO: Accuracy: 75.2%
2022-04-20 07:46:50,592 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.785855770111084 
2022-04-20 07:46:50,592 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:46:50,593 reid_baseline.train INFO: Shuffled Accuracy: 75.2%
2022-04-20 07:47:30,568 reid_baseline.train INFO: normal accuracy 0.95922107674685 0.7782778143882751 
2022-04-20 07:47:30,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:47:30,568 reid_baseline.train INFO: Source Clean Accuracy: 95.9%
2022-04-20 07:47:36,442 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_4
2022-04-20 07:47:36,442 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-20 07:47:36,442 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 07:47:36,442 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 07:47:36,443 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 07:47:47,121 reid_baseline.train INFO: start training
2022-04-20 07:48:27,050 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.255, Acc: 0.291, Base Lr: 8.72e-04
2022-04-20 07:48:53,374 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.171, Acc: 0.382, Base Lr: 8.72e-04
2022-04-20 07:49:18,170 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.330[s] Speed: 48.4[samples/s]
2022-04-20 07:49:57,337 reid_baseline.train INFO: normal accuracy 0.5465194863708043 4.16407585144043 
2022-04-20 07:49:58,186 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 07:49:58,187 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 416.4%
2022-04-20 07:50:28,666 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.765, Acc: 0.561, Base Lr: 1.66e-03
2022-04-20 07:50:54,253 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.600, Acc: 0.566, Base Lr: 1.66e-03
2022-04-20 07:51:14,374 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.278[s] Speed: 57.5[samples/s]
2022-04-20 07:51:53,331 reid_baseline.train INFO: normal accuracy 0.5794097769767966 3.972433090209961 
2022-04-20 07:51:54,214 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 07:51:54,214 reid_baseline.train INFO: Accuracy: 57.9% Mean Entropy: 397.2%
2022-04-20 07:52:28,144 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.845, Acc: 0.622, Base Lr: 2.46e-03
2022-04-20 07:52:53,444 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.690, Acc: 0.633, Base Lr: 2.46e-03
2022-04-20 07:53:13,124 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-20 07:53:57,025 reid_baseline.train INFO: normal accuracy 0.6456409101148908 3.2208051681518555 
2022-04-20 07:53:57,934 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 07:53:57,935 reid_baseline.train INFO: Accuracy: 64.6% Mean Entropy: 322.1%
2022-04-20 07:54:29,634 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.201, Acc: 0.694, Base Lr: 3.25e-03
2022-04-20 07:55:01,010 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.121, Acc: 0.703, Base Lr: 3.25e-03
2022-04-20 07:55:20,108 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-20 07:56:03,304 reid_baseline.train INFO: normal accuracy 0.7026357287677405 2.5965070724487305 
2022-04-20 07:56:04,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 07:56:04,268 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 259.7%
2022-04-20 07:56:32,343 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.853, Acc: 0.753, Base Lr: 4.04e-03
2022-04-20 07:57:02,867 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.827, Acc: 0.773, Base Lr: 4.04e-03
2022-04-20 07:57:27,005 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-20 07:58:10,564 reid_baseline.train INFO: normal accuracy 0.7242622212209957 2.2419097423553467 
2022-04-20 07:58:11,417 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 07:58:11,417 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 224.2%
2022-04-20 07:58:39,300 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.657, Acc: 0.805, Base Lr: 4.83e-03
2022-04-20 07:59:05,246 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.665, Acc: 0.805, Base Lr: 4.83e-03
2022-04-20 07:59:25,965 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.272[s] Speed: 58.7[samples/s]
2022-04-20 08:00:06,960 reid_baseline.train INFO: normal accuracy 0.738004054967335 2.043419599533081 
2022-04-20 08:00:07,875 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 08:00:07,875 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 204.3%
2022-04-20 08:00:33,155 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.514, Acc: 0.832, Base Lr: 5.62e-03
2022-04-20 08:00:59,564 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.518, Acc: 0.828, Base Lr: 5.62e-03
2022-04-20 08:01:17,165 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.254[s] Speed: 63.0[samples/s]
2022-04-20 08:01:56,947 reid_baseline.train INFO: normal accuracy 0.7479161973417436 1.9381533861160278 
2022-04-20 08:01:57,875 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 08:01:57,875 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 193.8%
2022-04-20 08:02:34,983 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.500, Acc: 0.859, Base Lr: 6.42e-03
2022-04-20 08:03:01,645 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.473, Acc: 0.856, Base Lr: 6.42e-03
2022-04-20 08:03:19,337 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-20 08:04:00,535 reid_baseline.train INFO: normal accuracy 0.7544492002703311 1.8623830080032349 
2022-04-20 08:04:01,395 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 08:04:01,395 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 186.2%
2022-04-20 08:04:27,140 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.419, Acc: 0.868, Base Lr: 7.21e-03
2022-04-20 08:04:59,685 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.414, Acc: 0.876, Base Lr: 7.21e-03
2022-04-20 08:05:22,344 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-20 08:06:01,325 reid_baseline.train INFO: normal accuracy 0.7517458887136742 1.7480534315109253 
2022-04-20 08:06:02,220 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 08:06:02,220 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 174.8%
2022-04-20 08:06:31,617 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.352, Acc: 0.894, Base Lr: 4.01e-03
2022-04-20 08:06:57,799 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.335, Acc: 0.891, Base Lr: 4.01e-03
2022-04-20 08:07:20,147 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.285[s] Speed: 56.2[samples/s]
2022-04-20 08:08:01,388 reid_baseline.train INFO: normal accuracy 0.7630096868664114 1.6714946031570435 
2022-04-20 08:08:02,316 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 08:08:02,316 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 167.1%
2022-04-20 08:08:31,259 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.266, Acc: 0.912, Base Lr: 3.38e-03
2022-04-20 08:08:58,399 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.295, Acc: 0.906, Base Lr: 3.38e-03
2022-04-20 08:09:20,514 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.286[s] Speed: 55.9[samples/s]
2022-04-20 08:10:01,692 reid_baseline.train INFO: normal accuracy 0.7636855147555756 1.6935303211212158 
2022-04-20 08:10:01,693 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 08:10:01,693 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 169.4%
2022-04-20 08:10:32,323 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.290, Acc: 0.916, Base Lr: 2.77e-03
2022-04-20 08:10:58,392 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.274, Acc: 0.916, Base Lr: 2.77e-03
2022-04-20 08:11:18,736 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.282[s] Speed: 56.7[samples/s]
2022-04-20 08:12:00,475 reid_baseline.train INFO: normal accuracy 0.7666141022752873 1.720423698425293 
2022-04-20 08:12:00,476 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 08:12:00,476 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 172.0%
2022-04-20 08:12:34,285 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.275, Acc: 0.907, Base Lr: 2.20e-03
2022-04-20 08:13:03,511 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.262, Acc: 0.917, Base Lr: 2.20e-03
2022-04-20 08:13:21,327 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-20 08:14:02,856 reid_baseline.train INFO: normal accuracy 0.7697679657580536 1.6824806928634644 
2022-04-20 08:14:02,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 08:14:02,857 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.2%
2022-04-20 08:14:30,336 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.233, Acc: 0.922, Base Lr: 1.66e-03
2022-04-20 08:14:58,200 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.244, Acc: 0.922, Base Lr: 1.66e-03
2022-04-20 08:15:22,441 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-20 08:16:03,365 reid_baseline.train INFO: normal accuracy 0.7672899301644515 1.7932982444763184 
2022-04-20 08:16:03,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 08:16:03,365 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 179.3%
2022-04-20 08:16:33,719 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.262, Acc: 0.922, Base Lr: 1.19e-03
2022-04-20 08:16:59,825 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.277, Acc: 0.924, Base Lr: 1.19e-03
2022-04-20 08:17:19,232 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.278[s] Speed: 57.6[samples/s]
2022-04-20 08:17:58,108 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.678769588470459 
2022-04-20 08:17:58,110 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 08:17:58,110 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 167.9%
2022-04-20 08:18:26,824 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.257, Acc: 0.930, Base Lr: 7.78e-04
2022-04-20 08:18:53,653 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.251, Acc: 0.933, Base Lr: 7.78e-04
2022-04-20 08:19:12,562 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.273[s] Speed: 58.7[samples/s]
2022-04-20 08:19:52,239 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.73414945602417 
2022-04-20 08:19:52,240 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 08:19:52,240 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 173.4%
2022-04-20 08:20:25,965 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.242, Acc: 0.925, Base Lr: 4.51e-04
2022-04-20 08:20:53,762 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.220, Acc: 0.926, Base Lr: 4.51e-04
2022-04-20 08:21:12,993 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-20 08:21:55,636 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.7034052610397339 
2022-04-20 08:21:55,637 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 08:21:55,637 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 170.3%
2022-04-20 08:22:23,046 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.226, Acc: 0.926, Base Lr: 2.11e-04
2022-04-20 08:22:55,039 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.235, Acc: 0.928, Base Lr: 2.11e-04
2022-04-20 08:23:16,338 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-20 08:23:56,625 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.712132453918457 
2022-04-20 08:23:56,626 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 08:23:56,626 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 171.2%
2022-04-20 08:24:25,813 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.196, Acc: 0.931, Base Lr: 6.51e-05
2022-04-20 08:24:51,628 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.197, Acc: 0.934, Base Lr: 6.51e-05
2022-04-20 08:25:13,824 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.282[s] Speed: 56.7[samples/s]
2022-04-20 08:25:52,953 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.6547704935073853 
2022-04-20 08:25:53,908 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 08:25:53,908 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 165.5%
2022-04-20 08:26:21,287 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.221, Acc: 0.941, Base Lr: 1.60e-05
2022-04-20 08:26:47,840 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.230, Acc: 0.931, Base Lr: 1.60e-05
2022-04-20 08:27:07,919 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-20 08:27:49,176 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.7060325145721436 
2022-04-20 08:27:49,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 08:27:49,177 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 170.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_4/transformer_best_model.pth
2022-04-20 08:28:29,598 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.6547704935073853 
2022-04-20 08:28:29,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 08:28:29,599 reid_baseline.train INFO: Accuracy: 77.8%
2022-04-20 08:29:05,187 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.6547704935073853 
2022-04-20 08:29:05,187 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 08:29:05,187 reid_baseline.train INFO: Shuffled Accuracy: 77.8%
2022-04-20 08:29:45,536 reid_baseline.train INFO: normal accuracy 0.95922107674685 0.7777293920516968 
2022-04-20 08:29:45,536 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 08:29:45,536 reid_baseline.train INFO: Source Clean Accuracy: 95.9%
2022-04-20 08:29:51,434 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_6
2022-04-20 08:29:51,434 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-20 08:29:51,434 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 08:29:51,434 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 08:29:51,434 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 08:30:01,748 reid_baseline.train INFO: start training
2022-04-20 08:30:44,828 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.273, Acc: 0.287, Base Lr: 8.72e-04
2022-04-20 08:31:11,674 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.174, Acc: 0.386, Base Lr: 8.72e-04
2022-04-20 08:31:30,969 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-20 08:32:03,153 reid_baseline.train INFO: normal accuracy 0.515451174289246 4.166694164276123 
2022-04-20 08:32:03,956 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 08:32:03,956 reid_baseline.train INFO: Accuracy: 51.5% Mean Entropy: 416.7%
2022-04-20 08:32:31,755 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.746, Acc: 0.573, Base Lr: 1.66e-03
2022-04-20 08:33:02,249 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.598, Acc: 0.566, Base Lr: 1.66e-03
2022-04-20 08:33:27,630 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.306[s] Speed: 52.2[samples/s]
2022-04-20 08:34:00,821 reid_baseline.train INFO: normal accuracy 0.5496497733827771 4.032219886779785 
2022-04-20 08:34:01,682 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 08:34:01,684 reid_baseline.train INFO: Accuracy: 55.0% Mean Entropy: 403.2%
2022-04-20 08:34:30,945 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.849, Acc: 0.632, Base Lr: 2.46e-03
2022-04-20 08:34:59,222 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.719, Acc: 0.625, Base Lr: 2.46e-03
2022-04-20 08:35:17,369 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.277[s] Speed: 57.7[samples/s]
2022-04-20 08:35:50,092 reid_baseline.train INFO: normal accuracy 0.6266996291718171 3.4115793704986572 
2022-04-20 08:35:50,948 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 08:35:50,948 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 341.2%
2022-04-20 08:36:19,045 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.101, Acc: 0.721, Base Lr: 3.25e-03
2022-04-20 08:36:47,164 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.056, Acc: 0.712, Base Lr: 3.25e-03
2022-04-20 08:37:07,276 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-20 08:37:38,825 reid_baseline.train INFO: normal accuracy 0.6798516687268232 2.8798887729644775 
2022-04-20 08:37:39,606 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 08:37:39,606 reid_baseline.train INFO: Accuracy: 68.0% Mean Entropy: 288.0%
2022-04-20 08:38:03,868 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.832, Acc: 0.772, Base Lr: 4.04e-03
2022-04-20 08:38:31,742 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.798, Acc: 0.778, Base Lr: 4.04e-03
2022-04-20 08:38:50,834 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.261[s] Speed: 61.3[samples/s]
2022-04-20 08:39:23,767 reid_baseline.train INFO: normal accuracy 0.7124021425628347 2.4546749591827393 
2022-04-20 08:39:24,563 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 08:39:24,563 reid_baseline.train INFO: Accuracy: 71.2% Mean Entropy: 245.5%
2022-04-20 08:39:50,478 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.611, Acc: 0.817, Base Lr: 4.83e-03
2022-04-20 08:40:18,626 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.607, Acc: 0.818, Base Lr: 4.83e-03
2022-04-20 08:40:35,914 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.261[s] Speed: 61.2[samples/s]
2022-04-20 08:41:07,449 reid_baseline.train INFO: normal accuracy 0.7292954264524104 2.2795963287353516 
2022-04-20 08:41:08,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 08:41:08,335 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 228.0%
2022-04-20 08:41:39,161 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.511, Acc: 0.839, Base Lr: 5.62e-03
2022-04-20 08:42:00,507 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.538, Acc: 0.831, Base Lr: 5.62e-03
2022-04-20 08:42:21,608 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.268[s] Speed: 59.6[samples/s]
2022-04-20 08:42:52,224 reid_baseline.train INFO: normal accuracy 0.7321796456530696 2.245819330215454 
2022-04-20 08:42:53,096 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 08:42:53,096 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 224.6%
2022-04-20 08:43:29,085 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.474, Acc: 0.874, Base Lr: 6.42e-03
2022-04-20 08:44:01,435 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.460, Acc: 0.863, Base Lr: 6.42e-03
2022-04-20 08:44:24,570 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-20 08:44:54,667 reid_baseline.train INFO: normal accuracy 0.7391841779975278 2.0673179626464844 
2022-04-20 08:44:55,441 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 08:44:55,441 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 206.7%
2022-04-20 08:45:30,088 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.382, Acc: 0.883, Base Lr: 7.21e-03
2022-04-20 08:46:00,971 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.382, Acc: 0.879, Base Lr: 7.21e-03
2022-04-20 08:46:27,725 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.337[s] Speed: 47.4[samples/s]
2022-04-20 08:47:00,877 reid_baseline.train INFO: normal accuracy 0.7362999587968686 1.998183250427246 
2022-04-20 08:47:01,682 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 08:47:01,683 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 199.8%
2022-04-20 08:47:34,273 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.302, Acc: 0.898, Base Lr: 4.01e-03
2022-04-20 08:48:11,168 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.318, Acc: 0.902, Base Lr: 4.01e-03
2022-04-20 08:48:34,522 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.340[s] Speed: 47.0[samples/s]
2022-04-20 08:49:08,743 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.9060841798782349 
2022-04-20 08:49:09,672 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 08:49:09,673 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 190.6%
2022-04-20 08:49:47,675 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.318, Acc: 0.903, Base Lr: 3.38e-03
2022-04-20 08:50:22,176 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.284, Acc: 0.901, Base Lr: 3.38e-03
2022-04-20 08:50:46,151 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.353[s] Speed: 45.3[samples/s]
2022-04-20 08:51:19,297 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.9360346794128418 
2022-04-20 08:51:19,298 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 08:51:19,298 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 193.6%
2022-04-20 08:51:52,464 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.290, Acc: 0.908, Base Lr: 2.77e-03
2022-04-20 08:52:23,808 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.291, Acc: 0.907, Base Lr: 2.77e-03
2022-04-20 08:52:50,140 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.333[s] Speed: 48.1[samples/s]
2022-04-20 08:53:22,984 reid_baseline.train INFO: normal accuracy 0.7503090234857849 1.8685014247894287 
2022-04-20 08:53:23,887 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 08:53:23,887 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 186.9%
2022-04-20 08:53:57,865 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.249, Acc: 0.908, Base Lr: 2.20e-03
2022-04-20 08:54:32,180 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.258, Acc: 0.912, Base Lr: 2.20e-03
2022-04-20 08:54:55,170 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.334[s] Speed: 47.9[samples/s]
2022-04-20 08:55:29,236 reid_baseline.train INFO: normal accuracy 0.7531932426864442 1.9112290143966675 
2022-04-20 08:55:29,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 08:55:29,238 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 191.1%
2022-04-20 08:56:04,597 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.241, Acc: 0.927, Base Lr: 1.66e-03
2022-04-20 08:56:37,158 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.231, Acc: 0.921, Base Lr: 1.66e-03
2022-04-20 08:57:01,467 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-20 08:57:34,059 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8906631469726562 
2022-04-20 08:57:34,061 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 08:57:34,062 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 189.1%
2022-04-20 08:58:08,065 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.213, Acc: 0.934, Base Lr: 1.19e-03
2022-04-20 08:58:41,725 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.195, Acc: 0.929, Base Lr: 1.19e-03
2022-04-20 08:59:05,773 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.336[s] Speed: 47.7[samples/s]
2022-04-20 08:59:36,933 reid_baseline.train INFO: normal accuracy 0.7507210548001648 1.8472900390625 
2022-04-20 08:59:37,777 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 08:59:37,778 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 184.7%
2022-04-20 09:00:14,290 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.204, Acc: 0.926, Base Lr: 7.78e-04
2022-04-20 09:00:47,127 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.204, Acc: 0.926, Base Lr: 7.78e-04
2022-04-20 09:01:11,485 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-20 09:01:44,604 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.853672981262207 
2022-04-20 09:01:44,606 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 09:01:44,607 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 185.4%
2022-04-20 09:02:19,212 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.265, Acc: 0.916, Base Lr: 4.51e-04
2022-04-20 09:02:49,587 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.224, Acc: 0.925, Base Lr: 4.51e-04
2022-04-20 09:03:16,578 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.336[s] Speed: 47.6[samples/s]
2022-04-20 09:03:47,574 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.8715928792953491 
2022-04-20 09:03:47,576 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 09:03:47,577 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 187.2%
2022-04-20 09:04:19,441 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.178, Acc: 0.925, Base Lr: 2.11e-04
2022-04-20 09:04:56,029 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.193, Acc: 0.930, Base Lr: 2.11e-04
2022-04-20 09:05:19,874 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-20 09:05:52,873 reid_baseline.train INFO: normal accuracy 0.7503090234857849 1.9328571557998657 
2022-04-20 09:05:52,875 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 09:05:52,876 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 193.3%
2022-04-20 09:06:29,532 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.191, Acc: 0.943, Base Lr: 6.51e-05
2022-04-20 09:07:02,036 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.235, Acc: 0.935, Base Lr: 6.51e-05
2022-04-20 09:07:23,064 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-20 09:07:54,683 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.8320674896240234 
2022-04-20 09:07:55,556 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 09:07:55,557 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.2%
2022-04-20 09:08:31,033 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.192, Acc: 0.941, Base Lr: 1.60e-05
2022-04-20 09:09:02,889 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.212, Acc: 0.935, Base Lr: 1.60e-05
2022-04-20 09:09:28,866 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-20 09:10:03,068 reid_baseline.train INFO: normal accuracy 0.7507210548001648 1.8673005104064941 
2022-04-20 09:10:03,069 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 09:10:03,069 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 186.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_6/transformer_best_model.pth
2022-04-20 09:10:37,578 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.8320674896240234 
2022-04-20 09:10:37,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 09:10:37,578 reid_baseline.train INFO: Accuracy: 74.9%
2022-04-20 09:11:05,040 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.8320674896240234 
2022-04-20 09:11:05,040 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 09:11:05,040 reid_baseline.train INFO: Shuffled Accuracy: 74.9%
2022-04-20 09:11:44,717 reid_baseline.train INFO: normal accuracy 0.9612829324169531 0.7923797965049744 
2022-04-20 09:11:44,717 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 09:11:44,717 reid_baseline.train INFO: Source Clean Accuracy: 96.1%
2022-04-20 09:11:50,038 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_6
2022-04-20 09:11:50,038 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-20 09:11:50,039 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 09:11:50,039 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 09:11:50,039 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 09:12:01,235 reid_baseline.train INFO: start training
2022-04-20 09:12:50,635 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.273, Acc: 0.287, Base Lr: 8.72e-04
2022-04-20 09:13:27,858 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.174, Acc: 0.386, Base Lr: 8.72e-04
2022-04-20 09:13:52,822 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.401[s] Speed: 39.9[samples/s]
2022-04-20 09:14:32,336 reid_baseline.train INFO: normal accuracy 0.5451678305924758 4.164215564727783 
2022-04-20 09:14:33,076 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 09:14:33,076 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 416.4%
2022-04-20 09:15:00,598 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.746, Acc: 0.573, Base Lr: 1.66e-03
2022-04-20 09:15:32,428 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.598, Acc: 0.566, Base Lr: 1.66e-03
2022-04-20 09:15:51,234 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.286[s] Speed: 55.9[samples/s]
2022-04-20 09:16:34,844 reid_baseline.train INFO: normal accuracy 0.5809867087181798 3.971303701400757 
2022-04-20 09:16:35,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 09:16:35,842 reid_baseline.train INFO: Accuracy: 58.1% Mean Entropy: 397.1%
2022-04-20 09:17:04,611 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.849, Acc: 0.631, Base Lr: 2.46e-03
2022-04-20 09:17:31,223 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.719, Acc: 0.624, Base Lr: 2.46e-03
2022-04-20 09:17:56,655 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-20 09:18:37,118 reid_baseline.train INFO: normal accuracy 0.6456409101148908 3.204843044281006 
2022-04-20 09:18:38,093 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 09:18:38,094 reid_baseline.train INFO: Accuracy: 64.6% Mean Entropy: 320.5%
2022-04-20 09:19:07,684 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.101, Acc: 0.721, Base Lr: 3.25e-03
2022-04-20 09:19:33,683 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.056, Acc: 0.712, Base Lr: 3.25e-03
2022-04-20 09:19:51,863 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.270[s] Speed: 59.3[samples/s]
2022-04-20 09:20:32,577 reid_baseline.train INFO: normal accuracy 0.7010587970263573 2.596759796142578 
2022-04-20 09:20:33,510 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 09:20:33,510 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 259.7%
2022-04-20 09:21:01,944 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.832, Acc: 0.772, Base Lr: 4.04e-03
2022-04-20 09:21:28,615 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.798, Acc: 0.777, Base Lr: 4.04e-03
2022-04-20 09:21:46,071 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.266[s] Speed: 60.2[samples/s]
2022-04-20 09:22:26,577 reid_baseline.train INFO: normal accuracy 0.728317188555981 2.1847317218780518 
2022-04-20 09:22:27,421 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 09:22:27,421 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 218.5%
2022-04-20 09:22:58,039 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.611, Acc: 0.817, Base Lr: 4.83e-03
2022-04-20 09:23:27,401 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.607, Acc: 0.818, Base Lr: 4.83e-03
2022-04-20 09:23:44,699 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.283[s] Speed: 56.5[samples/s]
2022-04-20 09:24:23,893 reid_baseline.train INFO: normal accuracy 0.7373282270781708 1.986183524131775 
2022-04-20 09:24:24,767 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 09:24:24,767 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 198.6%
2022-04-20 09:24:52,689 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.511, Acc: 0.839, Base Lr: 5.62e-03
2022-04-20 09:25:22,543 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.538, Acc: 0.831, Base Lr: 5.62e-03
2022-04-20 09:25:46,400 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-20 09:26:26,022 reid_baseline.train INFO: normal accuracy 0.7548997521964407 1.9551726579666138 
2022-04-20 09:26:26,922 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 09:26:26,922 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 195.5%
2022-04-20 09:26:56,888 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.474, Acc: 0.875, Base Lr: 6.42e-03
2022-04-20 09:27:22,359 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.460, Acc: 0.863, Base Lr: 6.42e-03
2022-04-20 09:27:41,604 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.274[s] Speed: 58.5[samples/s]
2022-04-20 09:28:22,094 reid_baseline.train INFO: normal accuracy 0.7567019599008786 1.871593952178955 
2022-04-20 09:28:23,050 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 09:28:23,050 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 187.2%
2022-04-20 09:28:50,097 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.382, Acc: 0.883, Base Lr: 7.21e-03
2022-04-20 09:29:17,925 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.382, Acc: 0.879, Base Lr: 7.21e-03
2022-04-20 09:29:38,102 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.274[s] Speed: 58.3[samples/s]
2022-04-20 09:30:19,274 reid_baseline.train INFO: normal accuracy 0.7603063753097544 1.846276879310608 
2022-04-20 09:30:20,161 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 09:30:20,161 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 184.6%
2022-04-20 09:30:54,123 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.302, Acc: 0.898, Base Lr: 4.01e-03
2022-04-20 09:31:20,366 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.318, Acc: 0.902, Base Lr: 4.01e-03
2022-04-20 09:31:40,483 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-20 09:32:23,335 reid_baseline.train INFO: normal accuracy 0.7582788916422618 1.7309750318527222 
2022-04-20 09:32:24,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 09:32:24,122 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 173.1%
2022-04-20 09:32:53,761 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.317, Acc: 0.903, Base Lr: 3.38e-03
2022-04-20 09:33:25,502 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.284, Acc: 0.901, Base Lr: 3.38e-03
2022-04-20 09:33:43,722 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-20 09:34:25,259 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7551758289337158 
2022-04-20 09:34:25,260 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 09:34:25,260 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 175.5%
2022-04-20 09:34:51,626 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.289, Acc: 0.908, Base Lr: 2.77e-03
2022-04-20 09:35:16,122 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.290, Acc: 0.906, Base Lr: 2.77e-03
2022-04-20 09:35:40,000 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.273[s] Speed: 58.6[samples/s]
2022-04-20 09:36:20,131 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.6858245134353638 
2022-04-20 09:36:20,956 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 09:36:20,956 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.6%
2022-04-20 09:36:49,257 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.248, Acc: 0.908, Base Lr: 2.20e-03
2022-04-20 09:37:14,830 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.257, Acc: 0.911, Base Lr: 2.20e-03
2022-04-20 09:37:32,790 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.263[s] Speed: 60.8[samples/s]
2022-04-20 09:38:12,658 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.7590842247009277 
2022-04-20 09:38:12,658 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 09:38:12,658 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 175.9%
2022-04-20 09:38:44,366 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.241, Acc: 0.926, Base Lr: 1.66e-03
2022-04-20 09:39:09,001 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.230, Acc: 0.921, Base Lr: 1.66e-03
2022-04-20 09:39:27,498 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.274[s] Speed: 58.4[samples/s]
2022-04-20 09:40:09,811 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7379127740859985 
2022-04-20 09:40:09,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 09:40:09,812 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 173.8%
2022-04-20 09:40:39,361 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.213, Acc: 0.934, Base Lr: 1.19e-03
2022-04-20 09:41:11,723 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.195, Acc: 0.929, Base Lr: 1.19e-03
2022-04-20 09:41:28,972 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-20 09:42:09,346 reid_baseline.train INFO: normal accuracy 0.7706690696102726 1.7140761613845825 
2022-04-20 09:42:09,347 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 09:42:09,347 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 171.4%
2022-04-20 09:42:37,151 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.204, Acc: 0.928, Base Lr: 7.78e-04
2022-04-20 09:43:01,069 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.204, Acc: 0.928, Base Lr: 7.78e-04
2022-04-20 09:43:25,070 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.277[s] Speed: 57.7[samples/s]
2022-04-20 09:44:04,857 reid_baseline.train INFO: normal accuracy 0.7767515206127507 1.7276588678359985 
2022-04-20 09:44:04,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 09:44:04,857 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 172.8%
2022-04-20 09:44:33,242 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.264, Acc: 0.916, Base Lr: 4.51e-04
2022-04-20 09:45:01,901 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.224, Acc: 0.925, Base Lr: 4.51e-04
2022-04-20 09:45:21,617 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-20 09:46:02,368 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7365775108337402 
2022-04-20 09:46:02,369 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 09:46:02,369 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 173.7%
2022-04-20 09:46:32,115 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.177, Acc: 0.925, Base Lr: 2.11e-04
2022-04-20 09:46:58,759 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.192, Acc: 0.930, Base Lr: 2.11e-04
2022-04-20 09:47:18,097 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.277[s] Speed: 57.7[samples/s]
2022-04-20 09:47:58,210 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.79929518699646 
2022-04-20 09:47:58,210 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 09:47:58,210 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 179.9%
2022-04-20 09:48:30,349 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.191, Acc: 0.943, Base Lr: 6.51e-05
2022-04-20 09:49:00,122 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.234, Acc: 0.935, Base Lr: 6.51e-05
2022-04-20 09:49:18,717 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-20 09:49:58,888 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.6947362422943115 
2022-04-20 09:49:58,889 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 09:49:58,889 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 169.5%
2022-04-20 09:50:27,368 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.191, Acc: 0.941, Base Lr: 1.60e-05
2022-04-20 09:50:56,730 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.211, Acc: 0.935, Base Lr: 1.60e-05
2022-04-20 09:51:20,295 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-20 09:52:03,029 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.731537938117981 
2022-04-20 09:52:03,030 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 09:52:03,030 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 173.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_6/transformer_best_model.pth
2022-04-20 09:52:45,500 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.6858245134353638 
2022-04-20 09:52:45,500 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 09:52:45,500 reid_baseline.train INFO: Accuracy: 77.0%
2022-04-20 09:53:18,559 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.6858245134353638 
2022-04-20 09:53:18,560 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 09:53:18,560 reid_baseline.train INFO: Shuffled Accuracy: 77.0%
2022-04-20 09:53:57,796 reid_baseline.train INFO: normal accuracy 0.9532646048109966 0.8368048071861267 
2022-04-20 09:53:57,796 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 09:53:57,796 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-20 09:54:03,018 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_8
2022-04-20 09:54:03,018 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-20 09:54:03,018 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 09:54:03,018 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 09:54:03,019 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 09:54:12,824 reid_baseline.train INFO: start training
2022-04-20 09:54:51,526 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.268, Acc: 0.279, Base Lr: 8.72e-04
2022-04-20 09:55:18,064 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.175, Acc: 0.378, Base Lr: 8.72e-04
2022-04-20 09:55:37,335 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-20 09:56:06,390 reid_baseline.train INFO: normal accuracy 0.5282241450350227 4.166714191436768 
2022-04-20 09:56:07,175 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 09:56:07,175 reid_baseline.train INFO: Accuracy: 52.8% Mean Entropy: 416.7%
2022-04-20 09:56:33,220 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.726, Acc: 0.572, Base Lr: 1.66e-03
2022-04-20 09:56:59,080 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.562, Acc: 0.561, Base Lr: 1.66e-03
2022-04-20 09:57:17,463 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.257[s] Speed: 62.2[samples/s]
2022-04-20 09:57:45,717 reid_baseline.train INFO: normal accuracy 0.5554182117840956 4.029383182525635 
2022-04-20 09:57:46,454 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 09:57:46,454 reid_baseline.train INFO: Accuracy: 55.5% Mean Entropy: 402.9%
2022-04-20 09:58:16,524 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.835, Acc: 0.615, Base Lr: 2.46e-03
2022-04-20 09:58:46,744 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.680, Acc: 0.625, Base Lr: 2.46e-03
2022-04-20 09:59:03,402 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-20 09:59:33,397 reid_baseline.train INFO: normal accuracy 0.6246394725999176 3.4316394329071045 
2022-04-20 09:59:34,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 09:59:34,177 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 343.2%
2022-04-20 09:59:59,835 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.157, Acc: 0.701, Base Lr: 3.25e-03
2022-04-20 10:00:27,340 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.109, Acc: 0.707, Base Lr: 3.25e-03
2022-04-20 10:00:51,799 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.284[s] Speed: 56.4[samples/s]
2022-04-20 10:01:19,818 reid_baseline.train INFO: normal accuracy 0.6827358879274825 2.8748342990875244 
2022-04-20 10:01:20,605 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 10:01:20,606 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 287.5%
2022-04-20 10:01:45,906 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.859, Acc: 0.766, Base Lr: 4.04e-03
2022-04-20 10:02:09,962 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.790, Acc: 0.768, Base Lr: 4.04e-03
2022-04-20 10:02:26,698 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.242[s] Speed: 66.2[samples/s]
2022-04-20 10:02:55,837 reid_baseline.train INFO: normal accuracy 0.7045735475896168 2.515603542327881 
2022-04-20 10:02:56,611 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 10:02:56,612 reid_baseline.train INFO: Accuracy: 70.5% Mean Entropy: 251.6%
2022-04-20 10:03:27,067 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.717, Acc: 0.796, Base Lr: 4.83e-03
2022-04-20 10:03:51,700 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.656, Acc: 0.804, Base Lr: 4.83e-03
2022-04-20 10:04:09,997 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.268[s] Speed: 59.6[samples/s]
2022-04-20 10:04:38,639 reid_baseline.train INFO: normal accuracy 0.7255871446229913 2.296407699584961 
2022-04-20 10:04:39,412 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 10:04:39,412 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 229.6%
2022-04-20 10:05:03,898 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.519, Acc: 0.840, Base Lr: 5.62e-03
2022-04-20 10:05:30,070 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.534, Acc: 0.834, Base Lr: 5.62e-03
2022-04-20 10:05:49,139 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.255[s] Speed: 62.7[samples/s]
2022-04-20 10:06:16,847 reid_baseline.train INFO: normal accuracy 0.7342398022249691 2.0885751247406006 
2022-04-20 10:06:17,627 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 10:06:17,627 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 208.9%
2022-04-20 10:06:42,539 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.461, Acc: 0.856, Base Lr: 6.42e-03
2022-04-20 10:07:07,819 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.477, Acc: 0.854, Base Lr: 6.42e-03
2022-04-20 10:07:25,777 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.250[s] Speed: 64.1[samples/s]
2022-04-20 10:07:54,265 reid_baseline.train INFO: normal accuracy 0.7288833951380305 2.070566177368164 
2022-04-20 10:07:55,042 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 10:07:55,042 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 207.1%
2022-04-20 10:08:22,453 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.384, Acc: 0.881, Base Lr: 7.21e-03
2022-04-20 10:08:45,222 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.411, Acc: 0.874, Base Lr: 7.21e-03
2022-04-20 10:09:07,306 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.264[s] Speed: 60.6[samples/s]
2022-04-20 10:09:37,397 reid_baseline.train INFO: normal accuracy 0.722702925422332 1.9807419776916504 
2022-04-20 10:09:38,187 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 10:09:38,188 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 198.1%
2022-04-20 10:10:14,314 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.282, Acc: 0.900, Base Lr: 4.01e-03
2022-04-20 10:10:45,134 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.341, Acc: 0.895, Base Lr: 4.01e-03
2022-04-20 10:11:05,048 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-20 10:11:36,753 reid_baseline.train INFO: normal accuracy 0.7424804285125669 1.9405388832092285 
2022-04-20 10:11:37,484 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 10:11:37,484 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 194.1%
2022-04-20 10:12:08,307 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.286, Acc: 0.903, Base Lr: 3.38e-03
2022-04-20 10:12:37,756 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.294, Acc: 0.909, Base Lr: 3.38e-03
2022-04-20 10:13:06,493 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-20 10:13:35,439 reid_baseline.train INFO: normal accuracy 0.7367119901112484 1.954985499382019 
2022-04-20 10:13:35,441 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 10:13:35,441 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 195.5%
2022-04-20 10:14:08,341 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.272, Acc: 0.923, Base Lr: 2.77e-03
2022-04-20 10:14:43,296 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.268, Acc: 0.920, Base Lr: 2.77e-03
2022-04-20 10:15:06,754 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.334[s] Speed: 47.9[samples/s]
2022-04-20 10:15:35,991 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.8962184190750122 
2022-04-20 10:15:36,775 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 10:15:36,776 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 189.6%
2022-04-20 10:16:11,494 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.234, Acc: 0.914, Base Lr: 2.20e-03
2022-04-20 10:16:42,938 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.247, Acc: 0.919, Base Lr: 2.20e-03
2022-04-20 10:17:03,945 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-20 10:17:31,709 reid_baseline.train INFO: normal accuracy 0.746188710341986 1.8779010772705078 
2022-04-20 10:17:32,520 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 10:17:32,520 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 187.8%
2022-04-20 10:18:04,185 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.224, Acc: 0.931, Base Lr: 1.66e-03
2022-04-20 10:18:34,196 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.218, Acc: 0.931, Base Lr: 1.66e-03
2022-04-20 10:19:00,787 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.323[s] Speed: 49.5[samples/s]
2022-04-20 10:19:29,032 reid_baseline.train INFO: normal accuracy 0.7362999587968686 1.8645042181015015 
2022-04-20 10:19:29,850 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 10:19:29,850 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 186.5%
2022-04-20 10:20:01,542 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.233, Acc: 0.928, Base Lr: 1.19e-03
2022-04-20 10:20:36,090 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.254, Acc: 0.924, Base Lr: 1.19e-03
2022-04-20 10:20:58,735 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.326[s] Speed: 49.1[samples/s]
2022-04-20 10:21:27,401 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.8258877992630005 
2022-04-20 10:21:28,260 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 10:21:28,260 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 182.6%
2022-04-20 10:22:03,670 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.233, Acc: 0.918, Base Lr: 7.78e-04
2022-04-20 10:22:34,869 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.232, Acc: 0.924, Base Lr: 7.78e-04
2022-04-20 10:22:56,337 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.322[s] Speed: 49.6[samples/s]
2022-04-20 10:23:25,588 reid_baseline.train INFO: normal accuracy 0.7437165224557066 1.828368067741394 
2022-04-20 10:23:25,588 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 10:23:25,588 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 182.8%
2022-04-20 10:23:57,429 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.212, Acc: 0.932, Base Lr: 4.51e-04
2022-04-20 10:24:28,602 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.199, Acc: 0.933, Base Lr: 4.51e-04
2022-04-20 10:24:54,188 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-20 10:25:23,743 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.8451753854751587 
2022-04-20 10:25:23,744 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 10:25:23,744 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 184.5%
2022-04-20 10:26:00,097 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.229, Acc: 0.931, Base Lr: 2.11e-04
2022-04-20 10:26:31,433 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.227, Acc: 0.928, Base Lr: 2.11e-04
2022-04-20 10:26:54,265 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.331[s] Speed: 48.3[samples/s]
2022-04-20 10:27:23,914 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.907711148262024 
2022-04-20 10:27:23,917 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 10:27:23,917 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 190.8%
2022-04-20 10:27:57,554 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.212, Acc: 0.935, Base Lr: 6.51e-05
2022-04-20 10:28:28,660 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.191, Acc: 0.934, Base Lr: 6.51e-05
2022-04-20 10:28:51,775 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-20 10:29:21,248 reid_baseline.train INFO: normal accuracy 0.7437165224557066 1.8684636354446411 
2022-04-20 10:29:21,250 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 10:29:21,250 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 186.8%
2022-04-20 10:29:52,918 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.220, Acc: 0.934, Base Lr: 1.60e-05
2022-04-20 10:30:27,132 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.229, Acc: 0.931, Base Lr: 1.60e-05
2022-04-20 10:30:49,926 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.325[s] Speed: 49.3[samples/s]
2022-04-20 10:31:19,881 reid_baseline.train INFO: normal accuracy 0.7437165224557066 1.8598881959915161 
2022-04-20 10:31:19,883 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 10:31:19,883 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 186.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_8/transformer_best_model.pth
2022-04-20 10:31:50,288 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.8258877992630005 
2022-04-20 10:31:50,289 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 10:31:50,289 reid_baseline.train INFO: Accuracy: 74.3%
2022-04-20 10:32:15,503 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.8258877992630005 
2022-04-20 10:32:15,503 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 10:32:15,503 reid_baseline.train INFO: Shuffled Accuracy: 74.3%
2022-04-20 10:32:53,465 reid_baseline.train INFO: normal accuracy 0.9601374570446736 0.7881863713264465 
2022-04-20 10:32:53,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 10:32:53,465 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-20 10:32:58,474 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_8
2022-04-20 10:32:58,474 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-20 10:32:58,474 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 10:32:58,474 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 10:32:58,474 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 10:33:10,426 reid_baseline.train INFO: start training
2022-04-20 10:33:55,936 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.268, Acc: 0.280, Base Lr: 8.72e-04
2022-04-20 10:34:25,752 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.175, Acc: 0.378, Base Lr: 8.72e-04
2022-04-20 10:34:54,244 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.378[s] Speed: 42.3[samples/s]
2022-04-20 10:35:32,469 reid_baseline.train INFO: normal accuracy 0.5514755575580086 4.164370059967041 
2022-04-20 10:35:33,212 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 10:35:33,212 reid_baseline.train INFO: Accuracy: 55.1% Mean Entropy: 416.4%
2022-04-20 10:36:05,902 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.726, Acc: 0.572, Base Lr: 1.66e-03
2022-04-20 10:36:39,827 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.562, Acc: 0.561, Base Lr: 1.66e-03
2022-04-20 10:37:03,877 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-20 10:37:45,502 reid_baseline.train INFO: normal accuracy 0.5857175039423294 3.973210573196411 
2022-04-20 10:37:46,272 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 10:37:46,272 reid_baseline.train INFO: Accuracy: 58.6% Mean Entropy: 397.3%
2022-04-20 10:38:20,878 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.834, Acc: 0.616, Base Lr: 2.46e-03
2022-04-20 10:38:59,639 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.680, Acc: 0.625, Base Lr: 2.46e-03
2022-04-20 10:39:23,047 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-20 10:39:59,046 reid_baseline.train INFO: normal accuracy 0.6508222572651499 3.2073400020599365 
2022-04-20 10:39:59,804 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 10:39:59,804 reid_baseline.train INFO: Accuracy: 65.1% Mean Entropy: 320.7%
2022-04-20 10:40:27,745 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.157, Acc: 0.701, Base Lr: 3.25e-03
2022-04-20 10:40:59,004 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.109, Acc: 0.707, Base Lr: 3.25e-03
2022-04-20 10:41:15,806 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.278[s] Speed: 57.5[samples/s]
2022-04-20 10:41:52,499 reid_baseline.train INFO: normal accuracy 0.7066906961027258 2.5886473655700684 
2022-04-20 10:41:53,292 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 10:41:53,292 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 258.9%
2022-04-20 10:42:20,528 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.859, Acc: 0.766, Base Lr: 4.04e-03
2022-04-20 10:42:46,061 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.790, Acc: 0.768, Base Lr: 4.04e-03
2022-04-20 10:43:09,144 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.278[s] Speed: 57.6[samples/s]
2022-04-20 10:43:45,638 reid_baseline.train INFO: normal accuracy 0.738905158819554 2.2252938747406006 
2022-04-20 10:43:46,422 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 10:43:46,422 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 222.5%
2022-04-20 10:44:12,364 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.717, Acc: 0.795, Base Lr: 4.83e-03
2022-04-20 10:44:37,850 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.656, Acc: 0.803, Base Lr: 4.83e-03
2022-04-20 10:44:55,673 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.254[s] Speed: 63.1[samples/s]
2022-04-20 10:45:34,362 reid_baseline.train INFO: normal accuracy 0.7375535030412255 2.0155680179595947 
2022-04-20 10:45:35,133 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 10:45:35,134 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 201.6%
2022-04-20 10:46:01,692 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.519, Acc: 0.841, Base Lr: 5.62e-03
2022-04-20 10:46:27,027 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.534, Acc: 0.834, Base Lr: 5.62e-03
2022-04-20 10:46:46,165 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.260[s] Speed: 61.5[samples/s]
2022-04-20 10:47:22,475 reid_baseline.train INFO: normal accuracy 0.7485920252309078 1.8341511487960815 
2022-04-20 10:47:23,247 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 10:47:23,247 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.4%
2022-04-20 10:47:56,735 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.461, Acc: 0.856, Base Lr: 6.42e-03
2022-04-20 10:48:21,084 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.477, Acc: 0.854, Base Lr: 6.42e-03
2022-04-20 10:48:38,556 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.276[s] Speed: 58.0[samples/s]
2022-04-20 10:49:15,450 reid_baseline.train INFO: normal accuracy 0.7555755800856049 1.8290742635726929 
2022-04-20 10:49:16,219 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 10:49:16,219 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 182.9%
2022-04-20 10:49:42,952 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.382, Acc: 0.882, Base Lr: 7.21e-03
2022-04-20 10:50:16,501 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.410, Acc: 0.874, Base Lr: 7.21e-03
2022-04-20 10:50:33,915 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.284[s] Speed: 56.3[samples/s]
2022-04-20 10:51:10,534 reid_baseline.train INFO: normal accuracy 0.7623338589772471 1.7638477087020874 
2022-04-20 10:51:11,318 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 10:51:11,318 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 176.4%
2022-04-20 10:51:37,685 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.284, Acc: 0.901, Base Lr: 4.01e-03
2022-04-20 10:52:04,416 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.342, Acc: 0.895, Base Lr: 4.01e-03
2022-04-20 10:52:27,795 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.280[s] Speed: 57.1[samples/s]
2022-04-20 10:53:06,187 reid_baseline.train INFO: normal accuracy 0.7639107907186303 1.7244101762771606 
2022-04-20 10:53:06,968 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 10:53:06,968 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 172.4%
2022-04-20 10:53:33,174 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.285, Acc: 0.904, Base Lr: 3.38e-03
2022-04-20 10:53:57,873 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.292, Acc: 0.909, Base Lr: 3.38e-03
2022-04-20 10:54:15,836 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.252[s] Speed: 63.6[samples/s]
2022-04-20 10:54:53,610 reid_baseline.train INFO: normal accuracy 0.7666141022752873 1.755768060684204 
2022-04-20 10:54:53,611 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 10:54:53,611 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 175.6%
2022-04-20 10:55:20,030 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.271, Acc: 0.923, Base Lr: 2.77e-03
2022-04-20 10:55:44,782 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.267, Acc: 0.920, Base Lr: 2.77e-03
2022-04-20 10:56:03,145 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.254[s] Speed: 63.0[samples/s]
2022-04-20 10:56:38,611 reid_baseline.train INFO: normal accuracy 0.7677404820905609 1.7344144582748413 
2022-04-20 10:56:38,613 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 10:56:38,613 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 173.4%
2022-04-20 10:57:10,671 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.234, Acc: 0.914, Base Lr: 2.20e-03
2022-04-20 10:57:36,696 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.247, Acc: 0.919, Base Lr: 2.20e-03
2022-04-20 10:57:54,973 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-20 10:58:33,335 reid_baseline.train INFO: normal accuracy 0.7693174138319442 1.7098537683486938 
2022-04-20 10:58:34,116 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 10:58:34,117 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 171.0%
2022-04-20 10:59:00,661 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.224, Acc: 0.930, Base Lr: 1.66e-03
2022-04-20 10:59:32,685 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.218, Acc: 0.931, Base Lr: 1.66e-03
2022-04-20 10:59:52,856 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-20 11:00:29,602 reid_baseline.train INFO: normal accuracy 0.7681910340166704 1.7146837711334229 
2022-04-20 11:00:29,605 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 11:00:29,605 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 171.5%
2022-04-20 11:00:54,996 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.234, Acc: 0.928, Base Lr: 1.19e-03
2022-04-20 11:01:19,659 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.254, Acc: 0.923, Base Lr: 1.19e-03
2022-04-20 11:01:41,731 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.264[s] Speed: 60.6[samples/s]
2022-04-20 11:02:17,552 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.6787221431732178 
2022-04-20 11:02:18,344 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 11:02:18,344 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 167.9%
2022-04-20 11:02:43,216 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.234, Acc: 0.919, Base Lr: 7.78e-04
2022-04-20 11:03:10,020 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.232, Acc: 0.924, Base Lr: 7.78e-04
2022-04-20 11:03:28,133 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.255[s] Speed: 62.7[samples/s]
2022-04-20 11:04:06,274 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.6926295757293701 
2022-04-20 11:04:06,274 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 11:04:06,274 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 169.3%
2022-04-20 11:04:37,328 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.212, Acc: 0.932, Base Lr: 4.51e-04
2022-04-20 11:04:59,334 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.199, Acc: 0.933, Base Lr: 4.51e-04
2022-04-20 11:05:18,671 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.264[s] Speed: 60.5[samples/s]
2022-04-20 11:05:56,839 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.701255202293396 
2022-04-20 11:05:56,841 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 11:05:56,841 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.1%
2022-04-20 11:06:26,480 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.229, Acc: 0.931, Base Lr: 2.11e-04
2022-04-20 11:06:56,450 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.227, Acc: 0.928, Base Lr: 2.11e-04
2022-04-20 11:07:13,132 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.279[s] Speed: 57.4[samples/s]
2022-04-20 11:07:49,916 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.7583402395248413 
2022-04-20 11:07:49,918 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 11:07:49,918 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 175.8%
2022-04-20 11:08:16,903 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.212, Acc: 0.935, Base Lr: 6.51e-05
2022-04-20 11:08:44,958 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.190, Acc: 0.934, Base Lr: 6.51e-05
2022-04-20 11:09:07,203 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.283[s] Speed: 56.6[samples/s]
2022-04-20 11:09:42,428 reid_baseline.train INFO: normal accuracy 0.7735976571299842 1.7234793901443481 
2022-04-20 11:09:42,428 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 11:09:42,428 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.3%
2022-04-20 11:10:08,955 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.219, Acc: 0.934, Base Lr: 1.60e-05
2022-04-20 11:10:33,455 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.229, Acc: 0.931, Base Lr: 1.60e-05
2022-04-20 11:10:53,075 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.259[s] Speed: 61.9[samples/s]
2022-04-20 11:11:32,532 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.720076560974121 
2022-04-20 11:11:32,535 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 11:11:32,535 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_8/transformer_best_model.pth
2022-04-20 11:12:10,050 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.6787221431732178 
2022-04-20 11:12:10,050 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 11:12:10,051 reid_baseline.train INFO: Accuracy: 77.1%
2022-04-20 11:12:40,385 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.6787221431732178 
2022-04-20 11:12:40,385 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 11:12:40,385 reid_baseline.train INFO: Shuffled Accuracy: 77.1%
2022-04-20 11:13:17,415 reid_baseline.train INFO: normal accuracy 0.9601374570446736 0.7882569432258606 
2022-04-20 11:13:17,415 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 11:13:17,415 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
