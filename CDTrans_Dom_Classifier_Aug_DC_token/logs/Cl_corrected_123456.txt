2022-04-26 13:21:02,668 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1
2022-04-26 13:21:02,669 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-26 13:21:02,669 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 13:21:02,669 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 13:21:02,669 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 13:21:14,827 reid_baseline.train INFO: start training
2022-04-26 13:21:55,368 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.008, Acc: 0.274, Base Lr: 8.72e-04
2022-04-26 13:22:22,545 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.945, Acc: 0.375, Base Lr: 8.72e-04
Aug Cl acc: 0.17542979481456045
2022-04-26 13:22:41,367 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.309[s] Speed: 51.9[samples/s]
2022-04-26 13:23:12,738 reid_baseline.train INFO: normal accuracy 0.5063864853728883 4.167745113372803 
2022-04-26 13:23:42,677 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 13:23:42,678 reid_baseline.train INFO: Accuracy: 50.6% Mean Entropy: 416.8%
2022-04-26 13:24:14,381 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.530, Acc: 0.540, Base Lr: 1.66e-03
2022-04-26 13:24:41,863 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.369, Acc: 0.548, Base Lr: 1.66e-03
Aug Cl acc: 0.1607432103419042
2022-04-26 13:25:02,421 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-26 13:25:34,541 reid_baseline.train INFO: normal accuracy 0.53811289658014 4.055413246154785 
2022-04-26 13:26:04,514 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 13:26:04,515 reid_baseline.train INFO: Accuracy: 53.8% Mean Entropy: 405.5%
2022-04-26 13:26:35,638 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.606, Acc: 0.594, Base Lr: 2.46e-03
2022-04-26 13:27:04,982 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.462, Acc: 0.603, Base Lr: 2.46e-03
Aug Cl acc: 0.16802777300824176
2022-04-26 13:27:25,382 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-26 13:27:56,780 reid_baseline.train INFO: normal accuracy 0.6093943139678616 3.539389133453369 
2022-04-26 13:28:26,733 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 13:28:26,734 reid_baseline.train INFO: Accuracy: 60.9% Mean Entropy: 353.9%
2022-04-26 13:28:54,576 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.865, Acc: 0.670, Base Lr: 3.25e-03
2022-04-26 13:29:22,069 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.766, Acc: 0.698, Base Lr: 3.25e-03
Aug Cl acc: 0.16620545160202754
2022-04-26 13:29:41,856 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.275[s] Speed: 58.2[samples/s]
2022-04-26 13:30:14,375 reid_baseline.train INFO: normal accuracy 0.6744952616398846 2.900036096572876 
2022-04-26 13:30:44,325 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 13:30:44,326 reid_baseline.train INFO: Accuracy: 67.4% Mean Entropy: 290.0%
2022-04-26 13:31:11,716 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.500, Acc: 0.761, Base Lr: 4.04e-03
2022-04-26 13:31:37,632 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.460, Acc: 0.753, Base Lr: 4.04e-03
Aug Cl acc: 0.16742359762226705
2022-04-26 13:31:57,863 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.269[s] Speed: 59.4[samples/s]
2022-04-26 13:32:30,492 reid_baseline.train INFO: normal accuracy 0.7004532344458179 2.578277587890625 
2022-04-26 13:33:00,456 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 13:33:00,457 reid_baseline.train INFO: Accuracy: 70.0% Mean Entropy: 257.8%
2022-04-26 13:33:29,769 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.278, Acc: 0.795, Base Lr: 4.83e-03
2022-04-26 13:33:56,659 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.277, Acc: 0.792, Base Lr: 4.83e-03
Aug Cl acc: 0.17528765891497824
2022-04-26 13:34:16,813 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-26 13:34:49,710 reid_baseline.train INFO: normal accuracy 0.7165224557066338 2.3198578357696533 
2022-04-26 13:35:19,676 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 13:35:19,676 reid_baseline.train INFO: Accuracy: 71.7% Mean Entropy: 232.0%
2022-04-26 13:35:48,484 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.200, Acc: 0.815, Base Lr: 5.62e-03
2022-04-26 13:36:16,512 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.169, Acc: 0.827, Base Lr: 5.62e-03
Aug Cl acc: 0.17099052121787717
2022-04-26 13:36:36,743 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.282[s] Speed: 56.7[samples/s]
2022-04-26 13:37:08,657 reid_baseline.train INFO: normal accuracy 0.7202307375360527 2.2082302570343018 
2022-04-26 13:37:38,650 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 13:37:38,651 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 220.8%
2022-04-26 13:38:08,768 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.076, Acc: 0.851, Base Lr: 6.42e-03
2022-04-26 13:38:35,806 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.079, Acc: 0.847, Base Lr: 6.42e-03
Aug Cl acc: 0.16912499452248597
2022-04-26 13:38:54,738 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.279[s] Speed: 57.4[samples/s]
2022-04-26 13:39:26,161 reid_baseline.train INFO: normal accuracy 0.7457766790276061 2.035726308822632 
2022-04-26 13:39:56,137 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 13:39:56,137 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 203.6%
2022-04-26 13:40:22,263 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.018, Acc: 0.870, Base Lr: 7.21e-03
2022-04-26 13:40:50,590 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.012, Acc: 0.873, Base Lr: 7.21e-03
Aug Cl acc: 0.17884788932381096
2022-04-26 13:41:09,622 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.269[s] Speed: 59.4[samples/s]
2022-04-26 13:41:39,968 reid_baseline.train INFO: normal accuracy 0.7330037082818294 1.9665590524673462 
2022-04-26 13:42:09,924 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 13:42:09,924 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 196.7%
2022-04-26 13:42:37,036 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.943, Acc: 0.890, Base Lr: 4.01e-03
2022-04-26 13:43:04,994 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.931, Acc: 0.899, Base Lr: 4.01e-03
Aug Cl acc: 0.1889186481853108
2022-04-26 13:43:24,085 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.272[s] Speed: 58.9[samples/s]
2022-04-26 13:44:27,206 reid_baseline.train INFO: normal accuracy 0.7338277709105891 1.9491897821426392 
2022-04-26 13:44:57,171 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 13:44:57,172 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 194.9%
2022-04-26 13:45:26,893 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.898, Acc: 0.908, Base Lr: 3.38e-03
2022-04-26 13:45:54,188 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.914, Acc: 0.904, Base Lr: 3.38e-03
Aug Cl acc: 0.1738376687297891
2022-04-26 13:46:14,331 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.283[s] Speed: 56.6[samples/s]
2022-04-26 13:46:45,088 reid_baseline.train INFO: normal accuracy 0.7400082406262876 1.8889213800430298 
2022-04-26 13:47:15,041 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 13:47:15,042 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 188.9%
2022-04-26 13:47:43,845 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.930, Acc: 0.890, Base Lr: 2.77e-03
2022-04-26 13:48:11,871 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.896, Acc: 0.904, Base Lr: 2.77e-03
Aug Cl acc: 0.1687293419471154
2022-04-26 13:48:31,207 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.279[s] Speed: 57.4[samples/s]
2022-04-26 13:49:02,268 reid_baseline.train INFO: normal accuracy 0.7395962093119077 1.853035569190979 
2022-04-26 13:49:32,212 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 13:49:32,213 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 185.3%
2022-04-26 13:50:00,759 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.897, Acc: 0.904, Base Lr: 2.20e-03
2022-04-26 13:50:28,266 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.881, Acc: 0.914, Base Lr: 2.20e-03
Aug Cl acc: 0.18268224695226648
2022-04-26 13:50:46,464 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.272[s] Speed: 58.9[samples/s]
2022-04-26 13:51:19,826 reid_baseline.train INFO: normal accuracy 0.7404202719406675 1.9081352949142456 
2022-04-26 13:51:19,828 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 13:51:19,829 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 190.8%
2022-04-26 13:51:49,076 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.875, Acc: 0.907, Base Lr: 1.66e-03
2022-04-26 13:52:17,231 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.852, Acc: 0.920, Base Lr: 1.66e-03
Aug Cl acc: 0.19220236194876086
2022-04-26 13:52:37,413 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.284[s] Speed: 56.3[samples/s]
2022-04-26 13:53:10,756 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8943794965744019 
2022-04-26 13:53:10,756 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 13:53:10,757 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 189.4%
2022-04-26 13:53:41,161 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.829, Acc: 0.932, Base Lr: 1.19e-03
2022-04-26 13:54:08,749 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.846, Acc: 0.926, Base Lr: 1.19e-03
Aug Cl acc: 0.17405126383016398
2022-04-26 13:54:29,104 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.287[s] Speed: 55.8[samples/s]
2022-04-26 13:55:03,362 reid_baseline.train INFO: normal accuracy 0.7424804285125669 1.8876540660858154 
2022-04-26 13:55:03,362 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 13:55:03,362 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 188.8%
2022-04-26 13:55:31,952 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.842, Acc: 0.924, Base Lr: 7.78e-04
2022-04-26 13:55:59,830 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.844, Acc: 0.921, Base Lr: 7.78e-04
Aug Cl acc: 0.1894721425933279
2022-04-26 13:56:18,661 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.276[s] Speed: 58.0[samples/s]
2022-04-26 13:56:50,162 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.854295015335083 
2022-04-26 13:56:50,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 13:56:50,163 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 185.4%
2022-04-26 13:57:19,258 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.851, Acc: 0.919, Base Lr: 4.51e-04
2022-04-26 13:57:47,619 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.842, Acc: 0.921, Base Lr: 4.51e-04
Aug Cl acc: 0.18404662303435496
2022-04-26 13:58:06,996 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-26 13:58:38,481 reid_baseline.train INFO: normal accuracy 0.7424804285125669 1.8714746236801147 
2022-04-26 13:58:38,481 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 13:58:38,482 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 187.1%
2022-04-26 13:59:09,253 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.814, Acc: 0.932, Base Lr: 2.11e-04
2022-04-26 13:59:35,803 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.817, Acc: 0.928, Base Lr: 2.11e-04
Aug Cl acc: 0.18250637962704613
2022-04-26 13:59:55,849 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.283[s] Speed: 56.5[samples/s]
2022-04-26 14:00:26,139 reid_baseline.train INFO: normal accuracy 0.7441285537700866 1.8438431024551392 
2022-04-26 14:00:56,108 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 14:00:56,108 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 184.4%
2022-04-26 14:01:24,385 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.826, Acc: 0.932, Base Lr: 6.51e-05
2022-04-26 14:01:52,538 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.841, Acc: 0.925, Base Lr: 6.51e-05
Aug Cl acc: 0.17321307842548078
2022-04-26 14:02:12,982 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.282[s] Speed: 56.8[samples/s]
2022-04-26 14:02:45,483 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.8378242254257202 
2022-04-26 14:03:15,435 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 14:03:15,435 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 183.8%
2022-04-26 14:03:43,678 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.818, Acc: 0.932, Base Lr: 1.60e-05
2022-04-26 14:04:09,475 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.831, Acc: 0.929, Base Lr: 1.60e-05
Aug Cl acc: 0.17777464590666495
2022-04-26 14:04:29,003 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.269[s] Speed: 59.5[samples/s]
2022-04-26 14:05:30,624 reid_baseline.train INFO: normal accuracy 0.7441285537700866 1.7922412157058716 
2022-04-26 14:06:00,580 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 14:06:00,580 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 179.2%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-26 14:07:02,934 reid_baseline.train INFO: normal accuracy 0.7441285537700866 1.7922412157058716 
2022-04-26 14:07:02,935 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 14:07:02,935 reid_baseline.train INFO: Accuracy: 74.4%
2022-04-26 14:07:34,268 reid_baseline.train INFO: normal accuracy 0.7441285537700866 1.7922412157058716 
2022-04-26 14:07:34,268 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 14:07:34,269 reid_baseline.train INFO: Shuffled Accuracy: 74.4%
2022-04-26 14:08:14,848 reid_baseline.train INFO: normal accuracy 0.9573883161512028 0.7879392504692078 
2022-04-26 14:08:14,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 14:08:14,849 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-04-26 14:08:20,234 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1
2022-04-26 14:08:20,234 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-26 14:08:20,234 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 14:08:20,234 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 14:08:20,235 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 14:08:31,340 reid_baseline.train INFO: start training
2022-04-26 14:09:12,243 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.008, Acc: 0.274, Base Lr: 8.72e-04
2022-04-26 14:09:40,819 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.945, Acc: 0.375, Base Lr: 8.72e-04
Aug Cl acc: 0.17542979481456045
2022-04-26 14:10:00,177 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-26 14:10:40,671 reid_baseline.train INFO: normal accuracy 0.5469700382969137 4.165709972381592 
2022-04-26 14:11:10,606 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 14:11:10,606 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 416.6%
2022-04-26 14:11:39,523 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.530, Acc: 0.538, Base Lr: 1.66e-03
2022-04-26 14:12:06,650 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.369, Acc: 0.547, Base Lr: 1.66e-03
Aug Cl acc: 0.16051427261296647
2022-04-26 14:12:27,004 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-26 14:13:08,685 reid_baseline.train INFO: normal accuracy 0.5717503942329354 4.0087175369262695 
2022-04-26 14:13:38,640 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 14:13:38,641 reid_baseline.train INFO: Accuracy: 57.2% Mean Entropy: 400.9%
2022-04-26 14:14:09,950 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.606, Acc: 0.594, Base Lr: 2.46e-03
2022-04-26 14:14:38,174 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.462, Acc: 0.603, Base Lr: 2.46e-03
Aug Cl acc: 0.16802777300824176
2022-04-26 14:14:58,803 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-26 14:15:40,877 reid_baseline.train INFO: normal accuracy 0.6348276638882632 3.332562208175659 
2022-04-26 14:16:10,818 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 14:16:10,819 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 333.3%
2022-04-26 14:16:40,526 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.865, Acc: 0.670, Base Lr: 3.25e-03
2022-04-26 14:17:08,710 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.766, Acc: 0.698, Base Lr: 3.25e-03
Aug Cl acc: 0.16620545160202754
2022-04-26 14:17:29,516 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-26 14:18:10,216 reid_baseline.train INFO: normal accuracy 0.6992565893219194 2.623584032058716 
2022-04-26 14:18:40,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 14:18:40,194 reid_baseline.train INFO: Accuracy: 69.9% Mean Entropy: 262.4%
2022-04-26 14:19:08,983 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.500, Acc: 0.760, Base Lr: 4.04e-03
2022-04-26 14:19:38,469 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.459, Acc: 0.753, Base Lr: 4.04e-03
Aug Cl acc: 0.16742359762226705
2022-04-26 14:19:58,884 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-26 14:20:41,301 reid_baseline.train INFO: normal accuracy 0.7224600135165578 2.251316547393799 
2022-04-26 14:21:11,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 14:21:11,243 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 225.1%
2022-04-26 14:21:41,727 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.278, Acc: 0.796, Base Lr: 4.83e-03
2022-04-26 14:22:10,339 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.277, Acc: 0.793, Base Lr: 4.83e-03
Aug Cl acc: 0.17505872118604052
2022-04-26 14:22:30,669 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-26 14:23:12,581 reid_baseline.train INFO: normal accuracy 0.7292182924082 2.0478262901306152 
2022-04-26 14:23:42,558 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 14:23:42,559 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 204.8%
2022-04-26 14:24:13,491 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.200, Acc: 0.815, Base Lr: 5.62e-03
2022-04-26 14:24:40,464 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.169, Acc: 0.827, Base Lr: 5.62e-03
Aug Cl acc: 0.17076158348893944
2022-04-26 14:24:57,839 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.275[s] Speed: 58.1[samples/s]
2022-04-26 14:25:39,656 reid_baseline.train INFO: normal accuracy 0.751971164676729 1.9171043634414673 
2022-04-26 14:26:09,634 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 14:26:09,635 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 191.7%
2022-04-26 14:26:40,586 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.076, Acc: 0.852, Base Lr: 6.42e-03
2022-04-26 14:27:05,822 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.079, Acc: 0.848, Base Lr: 6.42e-03
Aug Cl acc: 0.16917781340770233
2022-04-26 14:27:24,985 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.276[s] Speed: 58.0[samples/s]
2022-04-26 14:28:05,191 reid_baseline.train INFO: normal accuracy 0.7573777877900428 1.8302603960037231 
2022-04-26 14:28:35,145 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 14:28:35,145 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 183.0%
2022-04-26 14:29:06,119 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.018, Acc: 0.870, Base Lr: 7.21e-03
2022-04-26 14:29:32,506 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.012, Acc: 0.873, Base Lr: 7.21e-03
Aug Cl acc: 0.17865164900000716
2022-04-26 14:29:51,965 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-26 14:30:33,252 reid_baseline.train INFO: normal accuracy 0.758053615679207 1.760668396949768 
2022-04-26 14:31:03,201 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 14:31:03,202 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 176.1%
2022-04-26 14:31:29,933 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.943, Acc: 0.889, Base Lr: 4.01e-03
2022-04-26 14:31:58,676 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.931, Acc: 0.899, Base Lr: 4.01e-03
Aug Cl acc: 0.18846077272743533
2022-04-26 14:32:18,948 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.277[s] Speed: 57.8[samples/s]
2022-04-26 14:33:30,498 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.7840139865875244 
2022-04-26 14:33:30,499 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 14:33:30,499 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 178.4%
2022-04-26 14:33:56,495 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.898, Acc: 0.908, Base Lr: 3.38e-03
2022-04-26 14:34:24,469 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.914, Acc: 0.904, Base Lr: 3.38e-03
Aug Cl acc: 0.17429554418766455
2022-04-26 14:34:45,870 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.276[s] Speed: 58.0[samples/s]
2022-04-26 14:35:27,922 reid_baseline.train INFO: normal accuracy 0.7634602387925208 1.7038487195968628 
2022-04-26 14:35:57,872 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 14:35:57,873 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 170.4%
2022-04-26 14:36:29,177 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.930, Acc: 0.890, Base Lr: 2.77e-03
2022-04-26 14:36:55,919 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.896, Acc: 0.904, Base Lr: 2.77e-03
Aug Cl acc: 0.1680425287603022
2022-04-26 14:37:16,511 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-26 14:37:58,608 reid_baseline.train INFO: normal accuracy 0.7666141022752873 1.6894891262054443 
2022-04-26 14:38:28,573 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 14:38:28,574 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 168.9%
2022-04-26 14:38:58,510 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.897, Acc: 0.904, Base Lr: 2.20e-03
2022-04-26 14:39:27,486 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.881, Acc: 0.914, Base Lr: 2.20e-03
Aug Cl acc: 0.18336906013907966
2022-04-26 14:39:46,085 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.284[s] Speed: 56.4[samples/s]
2022-04-26 14:40:27,062 reid_baseline.train INFO: normal accuracy 0.7677404820905609 1.7521060705184937 
2022-04-26 14:40:27,063 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 14:40:27,063 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 175.2%
2022-04-26 14:40:57,421 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.875, Acc: 0.907, Base Lr: 1.66e-03
2022-04-26 14:41:21,896 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.852, Acc: 0.920, Base Lr: 1.66e-03
Aug Cl acc: 0.1924312996776986
2022-04-26 14:41:42,867 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.277[s] Speed: 57.8[samples/s]
2022-04-26 14:42:25,326 reid_baseline.train INFO: normal accuracy 0.7654877224600135 1.731468677520752 
2022-04-26 14:42:25,329 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 14:42:25,329 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 173.1%
2022-04-26 14:42:52,810 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.829, Acc: 0.932, Base Lr: 1.19e-03
2022-04-26 14:43:21,372 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.846, Acc: 0.926, Base Lr: 1.19e-03
Aug Cl acc: 0.17405126383016398
2022-04-26 14:43:41,362 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.278[s] Speed: 57.5[samples/s]
2022-04-26 14:44:23,213 reid_baseline.train INFO: normal accuracy 0.7677404820905609 1.7358002662658691 
2022-04-26 14:44:23,213 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 14:44:23,214 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 173.6%
2022-04-26 14:44:52,236 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.842, Acc: 0.924, Base Lr: 7.78e-04
2022-04-26 14:45:18,490 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.844, Acc: 0.921, Base Lr: 7.78e-04
Aug Cl acc: 0.1892431908911401
2022-04-26 14:45:38,883 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.277[s] Speed: 57.8[samples/s]
2022-04-26 14:46:17,970 reid_baseline.train INFO: normal accuracy 0.7695426897949988 1.7021468877792358 
2022-04-26 14:46:17,971 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 14:46:17,971 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 170.2%
2022-04-26 14:46:48,553 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.851, Acc: 0.919, Base Lr: 4.51e-04
2022-04-26 14:47:13,030 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.842, Acc: 0.921, Base Lr: 4.51e-04
Aug Cl acc: 0.1843082721416767
2022-04-26 14:47:33,943 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.278[s] Speed: 57.6[samples/s]
2022-04-26 14:48:14,268 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.7233250141143799 
2022-04-26 14:48:14,271 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 14:48:14,271 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 172.3%
2022-04-26 14:48:45,681 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.814, Acc: 0.932, Base Lr: 2.11e-04
2022-04-26 14:49:13,490 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.817, Acc: 0.928, Base Lr: 2.11e-04
Aug Cl acc: 0.1829642550849216
2022-04-26 14:49:31,673 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.284[s] Speed: 56.4[samples/s]
2022-04-26 14:50:10,476 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.7036211490631104 
2022-04-26 14:50:10,477 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 14:50:10,477 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 170.4%
2022-04-26 14:50:40,258 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.826, Acc: 0.931, Base Lr: 6.51e-05
2022-04-26 14:51:09,284 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.841, Acc: 0.924, Base Lr: 6.51e-05
Aug Cl acc: 0.1734420161544185
2022-04-26 14:51:29,268 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-26 14:52:09,560 reid_baseline.train INFO: normal accuracy 0.7686415859427799 1.6796146631240845 
2022-04-26 14:52:39,534 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 14:52:39,535 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 168.0%
2022-04-26 14:53:08,989 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.818, Acc: 0.932, Base Lr: 1.60e-05
2022-04-26 14:53:37,220 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.831, Acc: 0.929, Base Lr: 1.60e-05
Aug Cl acc: 0.17777464590666495
2022-04-26 14:53:58,966 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-26 14:55:07,999 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.6389578580856323 
2022-04-26 14:55:37,958 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 14:55:37,959 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 163.9%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-26 14:56:48,338 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.6389578580856323 
2022-04-26 14:56:48,339 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 14:56:48,339 reid_baseline.train INFO: Accuracy: 77.3%
2022-04-26 14:57:28,201 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.6389578580856323 
2022-04-26 14:57:28,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 14:57:28,202 reid_baseline.train INFO: Shuffled Accuracy: 77.3%
2022-04-26 14:58:09,064 reid_baseline.train INFO: normal accuracy 0.9573883161512028 0.7879299521446228 
2022-04-26 14:58:09,074 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 14:58:09,075 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-04-26 14:58:14,477 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1
2022-04-26 14:58:14,477 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-26 14:58:14,477 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 14:58:14,477 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 14:58:14,477 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 14:58:24,990 reid_baseline.train INFO: start training
2022-04-26 14:59:02,364 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.008, Acc: 0.273, Base Lr: 8.72e-04
2022-04-26 14:59:30,456 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.945, Acc: 0.375, Base Lr: 8.72e-04
Aug Cl acc: 0.17542979481456045
2022-04-26 14:59:50,937 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-26 15:01:35,617 reid_baseline.train INFO: normal accuracy 0.5673628643562084 4.167020320892334 
2022-04-26 15:02:05,589 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 15:02:05,590 reid_baseline.train INFO: Accuracy: 56.7% Mean Entropy: 416.7%
2022-04-26 15:02:36,205 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.530, Acc: 0.538, Base Lr: 1.66e-03
2022-04-26 15:03:03,466 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.369, Acc: 0.547, Base Lr: 1.66e-03
Aug Cl acc: 0.16051427261296647
2022-04-26 15:03:26,131 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-26 15:05:02,483 reid_baseline.train INFO: normal accuracy 0.5923800780353454 4.028823375701904 
2022-04-26 15:05:32,437 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 15:05:32,437 reid_baseline.train INFO: Accuracy: 59.2% Mean Entropy: 402.9%
2022-04-26 15:06:03,903 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.606, Acc: 0.594, Base Lr: 2.46e-03
2022-04-26 15:06:33,189 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.462, Acc: 0.603, Base Lr: 2.46e-03
Aug Cl acc: 0.16802777300824176
2022-04-26 15:06:53,165 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-26 15:08:30,460 reid_baseline.train INFO: normal accuracy 0.6639889832453523 3.3879504203796387 
2022-04-26 15:09:00,410 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 15:09:00,410 reid_baseline.train INFO: Accuracy: 66.4% Mean Entropy: 338.8%
2022-04-26 15:09:29,550 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.865, Acc: 0.669, Base Lr: 3.25e-03
2022-04-26 15:09:55,065 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.766, Acc: 0.697, Base Lr: 3.25e-03
Aug Cl acc: 0.16648722218943166
2022-04-26 15:10:12,339 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.263[s] Speed: 60.7[samples/s]
2022-04-26 15:11:38,725 reid_baseline.train INFO: normal accuracy 0.7254991966949736 2.671823740005493 
2022-04-26 15:12:08,695 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 15:12:08,696 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 267.2%
2022-04-26 15:12:32,569 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.501, Acc: 0.760, Base Lr: 4.04e-03
2022-04-26 15:12:55,319 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.460, Acc: 0.753, Base Lr: 4.04e-03
Aug Cl acc: 0.16719465989332932
2022-04-26 15:13:11,823 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.231[s] Speed: 69.2[samples/s]
2022-04-26 15:14:42,905 reid_baseline.train INFO: normal accuracy 0.7535001147578609 2.3207037448883057 
2022-04-26 15:15:14,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 15:15:14,289 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 232.1%
2022-04-26 15:15:38,755 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.278, Acc: 0.795, Base Lr: 4.83e-03
2022-04-26 15:16:01,631 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.278, Acc: 0.792, Base Lr: 4.83e-03
Aug Cl acc: 0.17528765891497824
2022-04-26 15:16:17,833 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.233[s] Speed: 68.8[samples/s]
2022-04-26 15:17:54,442 reid_baseline.train INFO: normal accuracy 0.7691071838420932 2.0855817794799805 
2022-04-26 15:18:24,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 15:18:24,394 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 208.6%
2022-04-26 15:18:49,555 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.200, Acc: 0.816, Base Lr: 5.62e-03
2022-04-26 15:19:12,349 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.169, Acc: 0.828, Base Lr: 5.62e-03
Aug Cl acc: 0.17099052121787717
2022-04-26 15:19:28,472 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.234[s] Speed: 68.2[samples/s]
2022-04-26 15:20:55,454 reid_baseline.train INFO: normal accuracy 0.7757631397750746 1.9777333736419678 
2022-04-26 15:21:25,432 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 15:21:25,432 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 197.8%
2022-04-26 15:21:50,601 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.076, Acc: 0.852, Base Lr: 6.42e-03
2022-04-26 15:22:12,822 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.079, Acc: 0.847, Base Lr: 6.42e-03
Aug Cl acc: 0.1693539322514237
2022-04-26 15:22:29,009 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.233[s] Speed: 68.7[samples/s]
2022-04-26 15:23:55,986 reid_baseline.train INFO: normal accuracy 0.782648611429883 1.8440601825714111 
2022-04-26 15:24:25,993 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 15:24:25,994 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 184.4%
2022-04-26 15:24:50,455 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.018, Acc: 0.871, Base Lr: 7.21e-03
2022-04-26 15:25:12,860 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.012, Acc: 0.873, Base Lr: 7.21e-03
Aug Cl acc: 0.17865164900000716
2022-04-26 15:25:29,228 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.231[s] Speed: 69.4[samples/s]
2022-04-26 15:27:00,143 reid_baseline.train INFO: normal accuracy 0.7844847372044985 1.7756513357162476 
2022-04-26 15:27:30,127 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 15:27:30,127 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 177.6%
2022-04-26 15:27:54,606 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.943, Acc: 0.890, Base Lr: 4.01e-03
2022-04-26 15:28:16,558 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.931, Acc: 0.899, Base Lr: 4.01e-03
Aug Cl acc: 0.18846077272743533
2022-04-26 15:28:32,706 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.228[s] Speed: 70.0[samples/s]
2022-04-26 15:30:31,588 reid_baseline.train INFO: normal accuracy 0.7837961900390177 1.7878280878067017 
2022-04-26 15:30:31,588 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 15:30:31,589 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 178.8%
2022-04-26 15:30:55,941 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.898, Acc: 0.908, Base Lr: 3.38e-03
2022-04-26 15:31:17,840 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.914, Acc: 0.904, Base Lr: 3.38e-03
Aug Cl acc: 0.17360873100085136
2022-04-26 15:31:33,842 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-26 15:33:05,571 reid_baseline.train INFO: normal accuracy 0.7874684415882488 1.7283743619918823 
2022-04-26 15:33:35,569 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 15:33:35,570 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 172.8%
2022-04-26 15:34:00,854 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.930, Acc: 0.889, Base Lr: 2.77e-03
2022-04-26 15:34:23,570 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.896, Acc: 0.903, Base Lr: 2.77e-03
Aug Cl acc: 0.16827146648923993
2022-04-26 15:34:45,469 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-26 15:36:44,950 reid_baseline.train INFO: normal accuracy 0.7879274730319027 1.6980668306350708 
2022-04-26 15:37:14,939 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 15:37:14,940 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 169.8%
2022-04-26 15:38:21,360 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.897, Acc: 0.904, Base Lr: 2.20e-03
2022-04-26 15:39:27,426 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.881, Acc: 0.914, Base Lr: 2.20e-03
Aug Cl acc: 0.18314012241014194
2022-04-26 15:40:14,138 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.656[s] Speed: 24.4[samples/s]
2022-04-26 15:42:19,270 reid_baseline.train INFO: normal accuracy 0.7888455359192105 1.7612634897232056 
2022-04-26 15:42:19,272 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 15:42:19,273 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 176.1%
2022-04-26 15:43:26,770 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.875, Acc: 0.906, Base Lr: 1.66e-03
2022-04-26 15:44:30,017 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.852, Acc: 0.920, Base Lr: 1.66e-03
Aug Cl acc: 0.1924312996776986
2022-04-26 15:45:18,326 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.656[s] Speed: 24.4[samples/s]
2022-04-26 15:47:22,112 reid_baseline.train INFO: normal accuracy 0.7856323158136332 1.7395858764648438 
2022-04-26 15:47:22,115 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 15:47:22,115 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 174.0%
2022-04-26 15:48:30,442 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.829, Acc: 0.932, Base Lr: 1.19e-03
2022-04-26 15:49:35,039 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.846, Acc: 0.926, Base Lr: 1.19e-03
Aug Cl acc: 0.17450913928803943
2022-04-26 15:50:20,969 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.654[s] Speed: 24.5[samples/s]
2022-04-26 15:52:27,640 reid_baseline.train INFO: normal accuracy 0.7883865044755566 1.7419803142547607 
2022-04-26 15:52:27,644 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 15:52:27,645 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 174.2%
2022-04-26 15:53:31,671 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.842, Acc: 0.924, Base Lr: 7.78e-04
2022-04-26 15:54:37,833 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.844, Acc: 0.921, Base Lr: 7.78e-04
Aug Cl acc: 0.1892431908911401
2022-04-26 15:55:25,652 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.652[s] Speed: 24.5[samples/s]
2022-04-26 15:57:28,551 reid_baseline.train INFO: normal accuracy 0.7895340830846913 1.7059301137924194 
2022-04-26 15:57:28,556 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 15:57:28,556 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 170.6%
2022-04-26 15:58:35,750 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.851, Acc: 0.919, Base Lr: 4.51e-04
2022-04-26 15:59:38,194 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.842, Acc: 0.921, Base Lr: 4.51e-04
Aug Cl acc: 0.18381768530541723
2022-04-26 16:00:27,348 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.655[s] Speed: 24.4[samples/s]
2022-04-26 16:02:30,071 reid_baseline.train INFO: normal accuracy 0.7904521459719991 1.726948857307434 
2022-04-26 16:02:30,076 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 16:02:30,076 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 172.7%
2022-04-26 16:03:39,532 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.814, Acc: 0.932, Base Lr: 2.11e-04
2022-04-26 16:04:43,180 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.817, Acc: 0.928, Base Lr: 2.11e-04
Aug Cl acc: 0.1829642550849216
2022-04-26 16:05:29,107 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.655[s] Speed: 24.4[samples/s]
2022-04-26 16:07:31,582 reid_baseline.train INFO: normal accuracy 0.790911177415653 1.7086248397827148 
2022-04-26 16:07:31,584 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 16:07:31,584 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 170.9%
2022-04-26 16:08:39,607 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.826, Acc: 0.932, Base Lr: 6.51e-05
2022-04-26 16:09:45,635 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.841, Acc: 0.925, Base Lr: 6.51e-05
Aug Cl acc: 0.17321307842548078
2022-04-26 16:10:30,974 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.656[s] Speed: 24.4[samples/s]
2022-04-26 16:12:36,595 reid_baseline.train INFO: normal accuracy 0.7888455359192105 1.6884336471557617 
2022-04-26 16:13:06,610 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 16:13:06,611 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 168.8%
2022-04-26 16:14:14,391 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.818, Acc: 0.933, Base Lr: 1.60e-05
2022-04-26 16:15:19,450 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.831, Acc: 0.929, Base Lr: 1.60e-05
Aug Cl acc: 0.17800358363560267
2022-04-26 16:16:03,913 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.649[s] Speed: 24.6[samples/s]
2022-04-26 16:18:42,773 reid_baseline.train INFO: normal accuracy 0.7904521459719991 1.6428591012954712 
2022-04-26 16:19:12,788 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 16:19:12,789 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 164.3%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-26 16:21:51,514 reid_baseline.train INFO: normal accuracy 0.7904521459719991 1.6428591012954712 
2022-04-26 16:21:51,515 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 16:21:51,515 reid_baseline.train INFO: Accuracy: 79.0%
2022-04-26 16:23:57,129 reid_baseline.train INFO: normal accuracy 0.7904521459719991 1.6428591012954712 
2022-04-26 16:23:57,129 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 16:23:57,130 reid_baseline.train INFO: Shuffled Accuracy: 79.0%
2022-04-26 16:25:03,875 reid_baseline.train INFO: normal accuracy 0.9573883161512028 0.7879544496536255 
2022-04-26 16:25:03,876 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 16:25:03,876 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-04-26 16:25:09,669 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2
2022-04-26 16:25:09,669 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-26 16:25:09,669 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 16:25:09,669 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 16:25:09,670 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 16:25:23,078 reid_baseline.train INFO: start training
2022-04-26 16:26:58,343 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.986, Acc: 0.268, Base Lr: 8.72e-04
2022-04-26 16:28:01,279 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.913, Acc: 0.375, Base Lr: 8.72e-04
Aug Cl acc: 0.15531074607765283
2022-04-26 16:28:46,792 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.727[s] Speed: 22.0[samples/s]
2022-04-26 16:29:31,960 reid_baseline.train INFO: normal accuracy 0.5063864853728883 4.167529106140137 
2022-04-26 16:30:01,921 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 16:30:01,921 reid_baseline.train INFO: Accuracy: 50.6% Mean Entropy: 416.8%
2022-04-26 16:31:10,802 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.482, Acc: 0.550, Base Lr: 1.66e-03
2022-04-26 16:32:15,556 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.316, Acc: 0.551, Base Lr: 1.66e-03
Aug Cl acc: 0.17348028888632527
2022-04-26 16:33:07,242 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.679[s] Speed: 23.6[samples/s]
2022-04-26 16:33:53,792 reid_baseline.train INFO: normal accuracy 0.53852492789452 4.048968315124512 
2022-04-26 16:34:23,768 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 16:34:23,768 reid_baseline.train INFO: Accuracy: 53.9% Mean Entropy: 404.9%
2022-04-26 16:35:32,357 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.577, Acc: 0.602, Base Lr: 2.46e-03
2022-04-26 16:36:37,006 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.429, Acc: 0.607, Base Lr: 2.46e-03
Aug Cl acc: 0.1601994832356771
2022-04-26 16:37:27,671 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.674[s] Speed: 23.8[samples/s]
2022-04-26 16:38:12,922 reid_baseline.train INFO: normal accuracy 0.6172229089410796 3.5392303466796875 
2022-04-26 16:38:42,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 16:38:42,900 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 353.9%
2022-04-26 16:39:47,674 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.842, Acc: 0.674, Base Lr: 3.25e-03
2022-04-26 16:40:55,297 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.754, Acc: 0.702, Base Lr: 3.25e-03
Aug Cl acc: 0.16792370024181547
2022-04-26 16:41:44,644 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.666[s] Speed: 24.0[samples/s]
2022-04-26 16:42:26,658 reid_baseline.train INFO: normal accuracy 0.6724351050679852 2.8785953521728516 
2022-04-26 16:42:56,656 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 16:42:56,657 reid_baseline.train INFO: Accuracy: 67.2% Mean Entropy: 287.9%
2022-04-26 16:44:02,542 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.479, Acc: 0.760, Base Lr: 4.04e-03
2022-04-26 16:45:07,774 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.433, Acc: 0.757, Base Lr: 4.04e-03
Aug Cl acc: 0.1738608643248841
2022-04-26 16:45:56,562 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.659[s] Speed: 24.3[samples/s]
2022-04-26 16:46:38,439 reid_baseline.train INFO: normal accuracy 0.7008652657601978 2.5593228340148926 
2022-04-26 16:47:08,421 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 16:47:08,422 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 255.9%
2022-04-26 16:48:19,286 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.269, Acc: 0.796, Base Lr: 4.83e-03
2022-04-26 16:49:28,977 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.262, Acc: 0.797, Base Lr: 4.83e-03
Aug Cl acc: 0.17296617109696943
2022-04-26 16:50:15,053 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.683[s] Speed: 23.4[samples/s]
2022-04-26 16:50:58,065 reid_baseline.train INFO: normal accuracy 0.7235269880510918 2.3150217533111572 
2022-04-26 16:51:28,036 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 16:51:28,036 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 231.5%
2022-04-26 16:52:38,748 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.175, Acc: 0.825, Base Lr: 5.62e-03
2022-04-26 16:53:42,444 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.142, Acc: 0.834, Base Lr: 5.62e-03
Aug Cl acc: 0.1726068349984976
2022-04-26 16:54:29,210 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.663[s] Speed: 24.1[samples/s]
2022-04-26 16:55:12,081 reid_baseline.train INFO: normal accuracy 0.73053152039555 2.172656297683716 
2022-04-26 16:55:42,095 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 16:55:42,096 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 217.3%
2022-04-26 16:56:53,861 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.070, Acc: 0.855, Base Lr: 6.42e-03
2022-04-26 16:57:58,507 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.075, Acc: 0.852, Base Lr: 6.42e-03
Aug Cl acc: 0.15832669045025613
2022-04-26 16:58:46,051 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.674[s] Speed: 23.7[samples/s]
2022-04-26 16:59:30,374 reid_baseline.train INFO: normal accuracy 0.7358879274824887 2.0067896842956543 
2022-04-26 17:00:00,378 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 17:00:00,378 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 200.7%
2022-04-26 17:01:10,423 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.003, Acc: 0.863, Base Lr: 7.21e-03
2022-04-26 17:02:14,588 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 2.998, Acc: 0.868, Base Lr: 7.21e-03
Aug Cl acc: 0.1859020051502046
2022-04-26 17:03:02,627 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.668[s] Speed: 24.0[samples/s]
2022-04-26 17:03:47,891 reid_baseline.train INFO: normal accuracy 0.7321796456530696 1.9582399129867554 
2022-04-26 17:04:17,889 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 17:04:17,889 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 195.8%
2022-04-26 17:05:25,682 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.932, Acc: 0.896, Base Lr: 4.01e-03
2022-04-26 17:06:30,296 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.919, Acc: 0.903, Base Lr: 4.01e-03
Aug Cl acc: 0.1698229723360949
2022-04-26 17:07:19,755 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.666[s] Speed: 24.0[samples/s]
2022-04-26 17:08:30,590 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.9654288291931152 
2022-04-26 17:08:30,595 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 17:08:30,595 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 196.5%
2022-04-26 17:09:37,466 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.890, Acc: 0.907, Base Lr: 3.38e-03
2022-04-26 17:10:44,878 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.900, Acc: 0.903, Base Lr: 3.38e-03
Aug Cl acc: 0.16833511464325063
2022-04-26 17:11:33,171 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.668[s] Speed: 23.9[samples/s]
2022-04-26 17:12:14,389 reid_baseline.train INFO: normal accuracy 0.7424804285125669 1.8820834159851074 
2022-04-26 17:12:44,358 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 17:12:44,359 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 188.2%
2022-04-26 17:13:51,261 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.923, Acc: 0.890, Base Lr: 2.77e-03
2022-04-26 17:15:00,701 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.887, Acc: 0.905, Base Lr: 2.77e-03
Aug Cl acc: 0.1680378896412832
2022-04-26 17:15:50,871 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.683[s] Speed: 23.4[samples/s]
2022-04-26 17:16:31,868 reid_baseline.train INFO: normal accuracy 0.7424804285125669 1.8505537509918213 
2022-04-26 17:17:01,865 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 17:17:01,866 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 185.1%
2022-04-26 17:18:12,632 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.878, Acc: 0.905, Base Lr: 2.20e-03
2022-04-26 17:19:19,260 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.867, Acc: 0.915, Base Lr: 2.20e-03
Aug Cl acc: 0.16847968188834278
2022-04-26 17:20:04,244 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.668[s] Speed: 24.0[samples/s]
2022-04-26 17:20:47,207 reid_baseline.train INFO: normal accuracy 0.7404202719406675 1.9117714166641235 
2022-04-26 17:20:47,212 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 17:20:47,212 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 191.2%
2022-04-26 17:21:54,736 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.861, Acc: 0.906, Base Lr: 1.66e-03
2022-04-26 17:23:03,302 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.846, Acc: 0.920, Base Lr: 1.66e-03
Aug Cl acc: 0.18378850915929773
2022-04-26 17:23:52,160 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.677[s] Speed: 23.6[samples/s]
2022-04-26 17:24:34,942 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.8737472295761108 
2022-04-26 17:24:34,947 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 17:24:34,947 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 187.4%
2022-04-26 17:25:45,299 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.822, Acc: 0.929, Base Lr: 1.19e-03
2022-04-26 17:26:54,589 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.837, Acc: 0.924, Base Lr: 1.19e-03
Aug Cl acc: 0.17253892500321943
2022-04-26 17:27:41,842 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.684[s] Speed: 23.4[samples/s]
2022-04-26 17:28:24,837 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.875656008720398 
2022-04-26 17:28:24,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 17:28:24,842 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 187.6%
2022-04-26 17:29:32,591 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.845, Acc: 0.924, Base Lr: 7.78e-04
2022-04-26 17:30:39,761 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.838, Acc: 0.923, Base Lr: 7.78e-04
Aug Cl acc: 0.17701327145754636
2022-04-26 17:31:27,793 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-26 17:32:09,687 reid_baseline.train INFO: normal accuracy 0.7412443345694273 1.849623203277588 
2022-04-26 17:32:39,675 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 17:32:39,675 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 185.0%
2022-04-26 17:33:52,434 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.831, Acc: 0.923, Base Lr: 4.51e-04
2022-04-26 17:35:00,310 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.829, Acc: 0.924, Base Lr: 4.51e-04
Aug Cl acc: 0.1756944341973944
2022-04-26 17:35:46,074 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.683[s] Speed: 23.4[samples/s]
2022-04-26 17:36:29,082 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.8674075603485107 
2022-04-26 17:36:29,087 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 17:36:29,087 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 186.7%
2022-04-26 17:37:38,957 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.806, Acc: 0.936, Base Lr: 2.11e-04
2022-04-26 17:38:42,102 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.813, Acc: 0.930, Base Lr: 2.11e-04
Aug Cl acc: 0.17173272436791723
2022-04-26 17:39:28,785 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.658[s] Speed: 24.3[samples/s]
2022-04-26 17:40:11,237 reid_baseline.train INFO: normal accuracy 0.7441285537700866 1.8434771299362183 
2022-04-26 17:40:41,255 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 17:40:41,261 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 184.3%
2022-04-26 17:41:56,696 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.806, Acc: 0.934, Base Lr: 6.51e-05
2022-04-26 17:43:10,590 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.820, Acc: 0.927, Base Lr: 6.51e-05
Aug Cl acc: 0.18683731861603567
2022-04-26 17:44:03,918 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.742[s] Speed: 21.6[samples/s]
2022-04-26 17:44:50,517 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.8345617055892944 
2022-04-26 17:45:20,728 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 17:45:20,728 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 183.5%
2022-04-26 17:46:36,008 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.804, Acc: 0.937, Base Lr: 1.60e-05
2022-04-26 17:47:44,444 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.814, Acc: 0.932, Base Lr: 1.60e-05
Aug Cl acc: 0.1786160172123612
2022-04-26 17:48:30,605 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.696[s] Speed: 23.0[samples/s]
2022-04-26 17:49:42,705 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.7972280979156494 
2022-04-26 17:50:12,712 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 17:50:12,712 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 179.7%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-26 17:51:25,744 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.7972280979156494 
2022-04-26 17:51:25,744 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 17:51:25,744 reid_baseline.train INFO: Accuracy: 74.2%
2022-04-26 17:52:07,829 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.7972280979156494 
2022-04-26 17:52:07,829 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 17:52:07,830 reid_baseline.train INFO: Shuffled Accuracy: 74.2%
2022-04-26 17:53:15,692 reid_baseline.train INFO: normal accuracy 0.9562428407789233 0.7894497513771057 
2022-04-26 17:53:15,693 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 17:53:15,693 reid_baseline.train INFO: Source Clean Accuracy: 95.6%
2022-04-26 17:53:24,345 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2
2022-04-26 17:53:24,345 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-26 17:53:24,345 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 17:53:24,345 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 17:53:24,346 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 17:53:43,992 reid_baseline.train INFO: start training
2022-04-26 17:55:12,681 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.986, Acc: 0.268, Base Lr: 8.72e-04
2022-04-26 17:56:18,303 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.913, Acc: 0.375, Base Lr: 8.72e-04
Aug Cl acc: 0.15553968380659056
2022-04-26 17:57:05,517 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.726[s] Speed: 22.0[samples/s]
2022-04-26 17:58:11,939 reid_baseline.train INFO: normal accuracy 0.54584365848164 4.165533065795898 
2022-04-26 17:58:41,903 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 17:58:41,903 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 416.6%
2022-04-26 17:59:49,641 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.482, Acc: 0.550, Base Lr: 1.66e-03
2022-04-26 18:00:54,053 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.316, Acc: 0.551, Base Lr: 1.66e-03
Aug Cl acc: 0.17348028888632527
2022-04-26 18:01:45,900 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.674[s] Speed: 23.7[samples/s]
2022-04-26 18:02:51,962 reid_baseline.train INFO: normal accuracy 0.5740031538634828 4.000432014465332 
2022-04-26 18:03:21,930 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 18:03:21,931 reid_baseline.train INFO: Accuracy: 57.4% Mean Entropy: 400.0%
2022-04-26 18:04:28,807 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.577, Acc: 0.602, Base Lr: 2.46e-03
2022-04-26 18:05:35,224 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.429, Acc: 0.607, Base Lr: 2.46e-03
Aug Cl acc: 0.1604812538230812
2022-04-26 18:06:23,537 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.665[s] Speed: 24.1[samples/s]
2022-04-26 18:07:30,097 reid_baseline.train INFO: normal accuracy 0.6370804235188106 3.329213857650757 
2022-04-26 18:08:00,084 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 18:08:00,084 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 332.9%
2022-04-26 18:09:06,362 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.842, Acc: 0.674, Base Lr: 3.25e-03
2022-04-26 18:10:11,505 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.754, Acc: 0.702, Base Lr: 3.25e-03
Aug Cl acc: 0.16723688705500228
2022-04-26 18:10:58,635 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.654[s] Speed: 24.5[samples/s]
2022-04-26 18:12:04,369 reid_baseline.train INFO: normal accuracy 0.6979049335435908 2.606658935546875 
2022-04-26 18:12:34,345 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 18:12:34,346 reid_baseline.train INFO: Accuracy: 69.8% Mean Entropy: 260.7%
2022-04-26 18:13:37,865 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.479, Acc: 0.761, Base Lr: 4.04e-03
2022-04-26 18:14:43,354 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.433, Acc: 0.757, Base Lr: 4.04e-03
Aug Cl acc: 0.1738608643248841
2022-04-26 18:15:32,159 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.651[s] Speed: 24.6[samples/s]
2022-04-26 18:16:37,429 reid_baseline.train INFO: normal accuracy 0.7224600135165578 2.2437288761138916 
2022-04-26 18:17:07,403 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 18:17:07,403 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 224.4%
2022-04-26 18:18:15,326 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.269, Acc: 0.795, Base Lr: 4.83e-03
2022-04-26 18:19:22,048 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.262, Acc: 0.796, Base Lr: 4.83e-03
Aug Cl acc: 0.17240422287266768
2022-04-26 18:20:10,536 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.671[s] Speed: 23.9[samples/s]
2022-04-26 18:21:16,090 reid_baseline.train INFO: normal accuracy 0.7330479837801307 2.024571180343628 
2022-04-26 18:21:46,113 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 18:21:46,113 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 202.5%
2022-04-26 18:22:53,266 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.175, Acc: 0.825, Base Lr: 5.62e-03
2022-04-26 18:23:59,311 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.142, Acc: 0.835, Base Lr: 5.62e-03
Aug Cl acc: 0.1735552972926325
2022-04-26 18:24:45,327 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.656[s] Speed: 24.4[samples/s]
2022-04-26 18:25:51,844 reid_baseline.train INFO: normal accuracy 0.7517458887136742 1.8921087980270386 
2022-04-26 18:26:21,810 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 18:26:21,810 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 189.2%
2022-04-26 18:27:31,130 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.070, Acc: 0.855, Base Lr: 6.42e-03
2022-04-26 18:28:35,234 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.075, Acc: 0.852, Base Lr: 6.42e-03
Aug Cl acc: 0.1587845659081316
2022-04-26 18:29:21,556 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.658[s] Speed: 24.3[samples/s]
2022-04-26 18:30:26,923 reid_baseline.train INFO: normal accuracy 0.7521964406397837 1.813833475112915 
2022-04-26 18:30:56,888 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 18:30:56,888 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 181.4%
2022-04-26 18:32:05,455 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.003, Acc: 0.863, Base Lr: 7.21e-03
2022-04-26 18:33:10,105 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 2.998, Acc: 0.868, Base Lr: 7.21e-03
Aug Cl acc: 0.1849363278119992
2022-04-26 18:33:59,629 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.669[s] Speed: 23.9[samples/s]
2022-04-26 18:35:05,936 reid_baseline.train INFO: normal accuracy 0.7591799954944808 1.7416681051254272 
2022-04-26 18:35:35,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 18:35:35,947 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 174.2%
2022-04-26 18:36:43,051 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.932, Acc: 0.895, Base Lr: 4.01e-03
2022-04-26 18:37:47,874 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.919, Acc: 0.903, Base Lr: 4.01e-03
Aug Cl acc: 0.1691361591492817
2022-04-26 18:38:33,925 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.652[s] Speed: 24.5[samples/s]
2022-04-26 18:40:07,140 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.8017302751541138 
2022-04-26 18:40:07,145 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 18:40:07,145 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 180.2%
2022-04-26 18:41:13,612 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.890, Acc: 0.908, Base Lr: 3.38e-03
2022-04-26 18:42:19,593 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.900, Acc: 0.903, Base Lr: 3.38e-03
Aug Cl acc: 0.16925086555900154
2022-04-26 18:43:08,087 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.663[s] Speed: 24.1[samples/s]
2022-04-26 18:44:10,953 reid_baseline.train INFO: normal accuracy 0.7643613426447398 1.7191122770309448 
2022-04-26 18:44:40,930 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 18:44:40,930 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 171.9%
2022-04-26 18:45:50,672 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.923, Acc: 0.891, Base Lr: 2.77e-03
2022-04-26 18:46:53,191 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.887, Acc: 0.905, Base Lr: 2.77e-03
Aug Cl acc: 0.1675473167782738
2022-04-26 18:47:43,561 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.669[s] Speed: 23.9[samples/s]
2022-04-26 18:48:48,378 reid_baseline.train INFO: normal accuracy 0.7697679657580536 1.6932765245437622 
2022-04-26 18:49:18,369 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 18:49:18,369 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 169.3%
2022-04-26 18:50:27,367 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.877, Acc: 0.906, Base Lr: 2.20e-03
2022-04-26 18:51:30,849 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.867, Acc: 0.916, Base Lr: 2.20e-03
Aug Cl acc: 0.1687086196172805
2022-04-26 18:52:15,857 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.650[s] Speed: 24.6[samples/s]
2022-04-26 18:53:22,795 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.7541019916534424 
2022-04-26 18:53:22,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 18:53:22,800 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 175.4%
2022-04-26 18:54:26,672 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.861, Acc: 0.907, Base Lr: 1.66e-03
2022-04-26 18:55:30,597 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.846, Acc: 0.921, Base Lr: 1.66e-03
Aug Cl acc: 0.18471954681061126
2022-04-26 18:56:19,066 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.646[s] Speed: 24.8[samples/s]
2022-04-26 18:57:20,538 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.720942735671997 
2022-04-26 18:57:20,540 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 18:57:20,540 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 172.1%
2022-04-26 18:58:27,660 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.822, Acc: 0.929, Base Lr: 1.19e-03
2022-04-26 18:59:34,130 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.837, Acc: 0.924, Base Lr: 1.19e-03
Aug Cl acc: 0.17322573819003262
2022-04-26 19:00:20,155 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.657[s] Speed: 24.3[samples/s]
2022-04-26 19:01:27,447 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.7334617376327515 
2022-04-26 19:01:27,452 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 19:01:27,452 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 173.3%
2022-04-26 19:02:34,577 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.845, Acc: 0.924, Base Lr: 7.78e-04
2022-04-26 19:03:39,598 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.838, Acc: 0.923, Base Lr: 7.78e-04
Aug Cl acc: 0.17773278204949347
2022-04-26 19:04:27,782 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.661[s] Speed: 24.2[samples/s]
2022-04-26 19:05:29,762 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.6995726823806763 
2022-04-26 19:05:29,765 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 19:05:29,765 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.0%
2022-04-26 19:06:37,943 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.831, Acc: 0.922, Base Lr: 4.51e-04
2022-04-26 19:07:44,070 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.829, Acc: 0.923, Base Lr: 4.51e-04
Aug Cl acc: 0.1750076210105812
2022-04-26 19:08:31,550 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.666[s] Speed: 24.0[samples/s]
2022-04-26 19:09:36,444 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.7214027643203735 
2022-04-26 19:09:36,449 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 19:09:36,449 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 172.1%
2022-04-26 19:10:45,258 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.806, Acc: 0.937, Base Lr: 2.11e-04
2022-04-26 19:11:48,115 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.813, Acc: 0.931, Base Lr: 2.11e-04
Aug Cl acc: 0.1714601761255509
2022-04-26 19:12:35,988 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.658[s] Speed: 24.3[samples/s]
2022-04-26 19:13:42,027 reid_baseline.train INFO: normal accuracy 0.7767515206127507 1.7042959928512573 
2022-04-26 19:13:42,030 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 19:13:42,030 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 170.4%
2022-04-26 19:14:45,659 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.806, Acc: 0.933, Base Lr: 6.51e-05
2022-04-26 19:15:51,633 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.820, Acc: 0.927, Base Lr: 6.51e-05
Aug Cl acc: 0.1870662563449734
2022-04-26 19:16:37,624 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.643[s] Speed: 24.9[samples/s]
2022-04-26 19:17:44,581 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.6776313781738281 
2022-04-26 19:18:14,604 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 19:18:14,605 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 167.8%
2022-04-26 19:19:21,001 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.804, Acc: 0.936, Base Lr: 1.60e-05
2022-04-26 19:20:27,554 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.814, Acc: 0.931, Base Lr: 1.60e-05
Aug Cl acc: 0.17884495494129893
2022-04-26 19:21:15,179 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.661[s] Speed: 24.2[samples/s]
2022-04-26 19:22:46,271 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.6462006568908691 
2022-04-26 19:23:16,279 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 19:23:16,280 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 164.6%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-26 19:24:49,259 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.6462006568908691 
2022-04-26 19:24:49,259 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 19:24:49,259 reid_baseline.train INFO: Accuracy: 77.5%
2022-04-26 19:25:56,447 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.6462006568908691 
2022-04-26 19:25:56,448 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 19:25:56,448 reid_baseline.train INFO: Shuffled Accuracy: 77.5%
2022-04-26 19:27:03,256 reid_baseline.train INFO: normal accuracy 0.9564719358533792 0.789466917514801 
2022-04-26 19:27:03,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 19:27:03,256 reid_baseline.train INFO: Source Clean Accuracy: 95.6%
2022-04-26 19:27:09,561 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2
2022-04-26 19:27:09,562 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-26 19:27:09,562 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 19:27:09,562 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 19:27:09,562 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 19:27:23,952 reid_baseline.train INFO: start training
2022-04-26 19:28:58,267 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.986, Acc: 0.268, Base Lr: 8.72e-04
2022-04-26 19:30:02,319 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.913, Acc: 0.375, Base Lr: 8.72e-04
Aug Cl acc: 0.15531074607765283
2022-04-26 19:30:47,564 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.732[s] Speed: 21.9[samples/s]
2022-04-26 19:32:53,394 reid_baseline.train INFO: normal accuracy 0.5685104429653431 4.16679573059082 
2022-04-26 19:33:23,379 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 19:33:23,379 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 416.7%
2022-04-26 19:34:33,421 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.482, Acc: 0.550, Base Lr: 1.66e-03
2022-04-26 19:35:37,446 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.316, Acc: 0.551, Base Lr: 1.66e-03
Aug Cl acc: 0.17348028888632527
2022-04-26 19:36:29,143 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.680[s] Speed: 23.5[samples/s]
2022-04-26 19:38:35,094 reid_baseline.train INFO: normal accuracy 0.5951342666972688 4.020593643188477 
2022-04-26 19:39:05,093 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 19:39:05,093 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 402.1%
2022-04-26 19:40:14,273 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.577, Acc: 0.602, Base Lr: 2.46e-03
2022-04-26 19:41:22,115 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.429, Acc: 0.607, Base Lr: 2.46e-03
Aug Cl acc: 0.15997054550673936
2022-04-26 19:42:07,449 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.668[s] Speed: 24.0[samples/s]
2022-04-26 19:44:12,537 reid_baseline.train INFO: normal accuracy 0.6665136561854487 3.3887431621551514 
2022-04-26 19:44:42,555 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 19:44:42,555 reid_baseline.train INFO: Accuracy: 66.7% Mean Entropy: 338.9%
2022-04-26 19:45:50,453 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.842, Acc: 0.674, Base Lr: 3.25e-03
2022-04-26 19:46:52,862 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.754, Acc: 0.702, Base Lr: 3.25e-03
Aug Cl acc: 0.16838157569969092
2022-04-26 19:47:42,490 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.659[s] Speed: 24.3[samples/s]
2022-04-26 19:49:41,453 reid_baseline.train INFO: normal accuracy 0.7236630709203581 2.654674768447876 
2022-04-26 19:50:11,440 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 19:50:11,441 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 265.5%
2022-04-26 19:51:21,904 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.479, Acc: 0.761, Base Lr: 4.04e-03
2022-04-26 19:52:29,784 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.433, Acc: 0.757, Base Lr: 4.04e-03
Aug Cl acc: 0.17431873978275955
2022-04-26 19:53:18,132 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.682[s] Speed: 23.5[samples/s]
2022-04-26 19:55:35,710 reid_baseline.train INFO: normal accuracy 0.7583199449162268 2.3108959197998047 
2022-04-26 19:56:05,682 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 19:56:05,682 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 231.1%
2022-04-26 19:57:13,315 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.269, Acc: 0.796, Base Lr: 4.83e-03
2022-04-26 19:58:22,875 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.262, Acc: 0.796, Base Lr: 4.83e-03
Aug Cl acc: 0.1726331606016054
2022-04-26 19:59:08,675 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-26 20:01:22,104 reid_baseline.train INFO: normal accuracy 0.7725499196694974 2.076075792312622 
2022-04-26 20:01:52,093 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 20:01:52,094 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 207.6%
2022-04-26 20:03:05,041 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.175, Acc: 0.824, Base Lr: 5.62e-03
2022-04-26 20:04:11,403 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.142, Acc: 0.834, Base Lr: 5.62e-03
Aug Cl acc: 0.17375152364318625
2022-04-26 20:04:59,176 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.685[s] Speed: 23.4[samples/s]
2022-04-26 20:07:12,784 reid_baseline.train INFO: normal accuracy 0.7766812026623824 1.946787714958191 
2022-04-26 20:07:42,785 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 20:07:42,786 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 194.7%
2022-04-26 20:08:51,991 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.070, Acc: 0.857, Base Lr: 6.42e-03
2022-04-26 20:09:57,989 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.075, Acc: 0.852, Base Lr: 6.42e-03
Aug Cl acc: 0.15860846103766027
2022-04-26 20:10:45,777 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-26 20:12:51,943 reid_baseline.train INFO: normal accuracy 0.7778287812715171 1.8191417455673218 
2022-04-26 20:13:21,977 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 20:13:21,977 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 181.9%
2022-04-26 20:14:32,337 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.003, Acc: 0.862, Base Lr: 7.21e-03
2022-04-26 20:15:38,778 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 2.998, Acc: 0.867, Base Lr: 7.21e-03
Aug Cl acc: 0.18496903919038318
2022-04-26 20:16:25,304 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-26 20:18:39,001 reid_baseline.train INFO: normal accuracy 0.7847142529263255 1.7623776197433472 
2022-04-26 20:19:09,041 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 20:19:09,042 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 176.2%
2022-04-26 20:20:15,906 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.933, Acc: 0.895, Base Lr: 4.01e-03
2022-04-26 20:21:22,405 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.920, Acc: 0.902, Base Lr: 4.01e-03
Aug Cl acc: 0.1692402039692079
2022-04-26 20:22:12,017 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-26 20:24:44,229 reid_baseline.train INFO: normal accuracy 0.7854028000918063 1.8062242269515991 
2022-04-26 20:24:44,234 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 20:24:44,234 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 180.6%
2022-04-26 20:25:52,761 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.891, Acc: 0.908, Base Lr: 3.38e-03
2022-04-26 20:27:00,579 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.900, Acc: 0.903, Base Lr: 3.38e-03
Aug Cl acc: 0.16856405237218836
2022-04-26 20:27:48,085 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.673[s] Speed: 23.8[samples/s]
2022-04-26 20:30:03,221 reid_baseline.train INFO: normal accuracy 0.7876979573100757 1.724345088005066 
2022-04-26 20:30:33,200 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 20:30:33,201 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 172.4%
2022-04-26 20:31:43,248 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.923, Acc: 0.891, Base Lr: 2.77e-03
2022-04-26 20:32:49,097 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.887, Acc: 0.906, Base Lr: 2.77e-03
Aug Cl acc: 0.16637915307348902
2022-04-26 20:33:37,412 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.674[s] Speed: 23.7[samples/s]
2022-04-26 20:35:47,916 reid_baseline.train INFO: normal accuracy 0.7854028000918063 1.6966692209243774 
2022-04-26 20:36:17,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 20:36:17,934 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 169.7%
2022-04-26 20:37:30,726 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.877, Acc: 0.905, Base Lr: 2.20e-03
2022-04-26 20:38:36,977 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.867, Acc: 0.915, Base Lr: 2.20e-03
Aug Cl acc: 0.1677928687015296
2022-04-26 20:39:23,653 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.680[s] Speed: 23.5[samples/s]
2022-04-26 20:41:40,371 reid_baseline.train INFO: normal accuracy 0.7927473031902685 1.7598437070846558 
2022-04-26 20:41:40,376 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 20:41:40,376 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 176.0%
2022-04-26 20:42:45,185 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.862, Acc: 0.906, Base Lr: 1.66e-03
2022-04-26 20:43:48,373 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.846, Acc: 0.919, Base Lr: 1.66e-03
Aug Cl acc: 0.1841520512060368
2022-04-26 20:44:38,817 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.653[s] Speed: 24.5[samples/s]
2022-04-26 20:46:47,799 reid_baseline.train INFO: normal accuracy 0.7893045673628644 1.7194263935089111 
2022-04-26 20:46:47,804 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 20:46:47,804 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 171.9%
2022-04-26 20:47:56,183 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.822, Acc: 0.928, Base Lr: 1.19e-03
2022-04-26 20:49:05,806 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.837, Acc: 0.923, Base Lr: 1.19e-03
Aug Cl acc: 0.1729968004610949
2022-04-26 20:49:54,860 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.685[s] Speed: 23.4[samples/s]
2022-04-26 20:52:01,187 reid_baseline.train INFO: normal accuracy 0.7888455359192105 1.7331247329711914 
2022-04-26 20:52:01,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 20:52:01,192 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 173.3%
2022-04-26 20:53:13,485 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.846, Acc: 0.924, Base Lr: 7.78e-04
2022-04-26 20:54:21,001 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.838, Acc: 0.923, Base Lr: 7.78e-04
Aug Cl acc: 0.17766469040196456
2022-04-26 20:55:07,165 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.681[s] Speed: 23.5[samples/s]
2022-04-26 20:57:19,330 reid_baseline.train INFO: normal accuracy 0.7888455359192105 1.703114628791809 
2022-04-26 20:57:19,332 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 20:57:19,332 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 170.3%
2022-04-26 20:58:28,271 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.831, Acc: 0.922, Base Lr: 4.51e-04
2022-04-26 20:59:32,219 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.830, Acc: 0.923, Base Lr: 4.51e-04
Aug Cl acc: 0.17477868328164348
2022-04-26 21:00:18,707 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.657[s] Speed: 24.4[samples/s]
2022-04-26 21:02:29,192 reid_baseline.train INFO: normal accuracy 0.7913702088593069 1.725735068321228 
2022-04-26 21:02:29,196 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 21:02:29,196 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 172.6%
2022-04-26 21:03:35,653 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.806, Acc: 0.935, Base Lr: 2.11e-04
2022-04-26 21:04:45,067 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.813, Acc: 0.930, Base Lr: 2.11e-04
Aug Cl acc: 0.17063660674042755
2022-04-26 21:05:31,148 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.666[s] Speed: 24.0[samples/s]
2022-04-26 21:07:41,025 reid_baseline.train INFO: normal accuracy 0.7938948817994033 1.7105218172073364 
2022-04-26 21:07:41,026 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 21:07:41,026 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 171.1%
2022-04-26 21:08:22,045 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.806, Acc: 0.934, Base Lr: 6.51e-05
2022-04-26 21:09:05,074 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.820, Acc: 0.927, Base Lr: 6.51e-05
Aug Cl acc: 0.18658329890324518
2022-04-26 21:09:33,769 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.412[s] Speed: 38.8[samples/s]
2022-04-26 21:11:23,284 reid_baseline.train INFO: normal accuracy 0.790681661693826 1.6859548091888428 
2022-04-26 21:11:53,248 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 21:11:53,248 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 168.6%
2022-04-26 21:12:34,114 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.804, Acc: 0.936, Base Lr: 1.60e-05
2022-04-26 21:13:14,071 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.814, Acc: 0.931, Base Lr: 1.60e-05
Aug Cl acc: 0.17907389267023666
2022-04-26 21:13:44,289 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.407[s] Speed: 39.3[samples/s]
2022-04-26 21:16:06,574 reid_baseline.train INFO: normal accuracy 0.7925177874684416 1.6500763893127441 
2022-04-26 21:16:36,582 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 21:16:36,583 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 165.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-26 21:18:58,109 reid_baseline.train INFO: normal accuracy 0.7925177874684416 1.6500763893127441 
2022-04-26 21:18:58,110 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 21:18:58,110 reid_baseline.train INFO: Accuracy: 79.3%
2022-04-26 21:20:47,798 reid_baseline.train INFO: normal accuracy 0.7925177874684416 1.6500763893127441 
2022-04-26 21:20:47,798 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 21:20:47,798 reid_baseline.train INFO: Shuffled Accuracy: 79.3%
2022-04-26 21:21:36,262 reid_baseline.train INFO: normal accuracy 0.9567010309278351 0.7897436618804932 
2022-04-26 21:21:36,262 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 21:21:36,263 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-04-26 21:21:42,786 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3
2022-04-26 21:21:42,786 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-26 21:21:42,786 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 21:21:42,786 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 21:21:42,787 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 21:21:56,646 reid_baseline.train INFO: start training
2022-04-26 21:22:30,229 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.020, Acc: 0.256, Base Lr: 8.72e-04
2022-04-26 21:22:52,316 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.939, Acc: 0.357, Base Lr: 8.72e-04
Aug Cl acc: 0.17430364867269774
2022-04-26 21:23:08,446 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-26 21:23:35,650 reid_baseline.train INFO: normal accuracy 0.5018541409147095 4.168362140655518 
2022-04-26 21:24:05,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 21:24:05,595 reid_baseline.train INFO: Accuracy: 50.2% Mean Entropy: 416.8%
2022-04-26 21:24:30,182 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.543, Acc: 0.542, Base Lr: 1.66e-03
2022-04-26 21:24:52,186 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.381, Acc: 0.544, Base Lr: 1.66e-03
Aug Cl acc: 0.16725568107632927
2022-04-26 21:25:09,944 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.236[s] Speed: 67.9[samples/s]
2022-04-26 21:25:38,982 reid_baseline.train INFO: normal accuracy 0.5236918005768438 4.072710037231445 
2022-04-26 21:26:08,947 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 21:26:08,947 reid_baseline.train INFO: Accuracy: 52.4% Mean Entropy: 407.3%
2022-04-26 21:26:34,483 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.668, Acc: 0.585, Base Lr: 2.46e-03
2022-04-26 21:26:57,151 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.518, Acc: 0.593, Base Lr: 2.46e-03
Aug Cl acc: 0.16323084010309352
2022-04-26 21:27:13,719 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.237[s] Speed: 67.5[samples/s]
2022-04-26 21:27:42,147 reid_baseline.train INFO: normal accuracy 0.5970333745364648 3.6015431880950928 
2022-04-26 21:28:12,127 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 21:28:12,127 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 360.2%
2022-04-26 21:28:36,365 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.915, Acc: 0.647, Base Lr: 3.25e-03
2022-04-26 21:28:58,418 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.822, Acc: 0.681, Base Lr: 3.25e-03
Aug Cl acc: 0.17630125052762993
2022-04-26 21:29:14,699 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-26 21:29:43,064 reid_baseline.train INFO: normal accuracy 0.6613102595797281 2.9517059326171875 
2022-04-26 21:30:13,031 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 21:30:13,032 reid_baseline.train INFO: Accuracy: 66.1% Mean Entropy: 295.2%
2022-04-26 21:30:37,403 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.522, Acc: 0.764, Base Lr: 4.04e-03
2022-04-26 21:30:59,676 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.485, Acc: 0.754, Base Lr: 4.04e-03
Aug Cl acc: 0.17145960322229853
2022-04-26 21:31:15,993 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.230[s] Speed: 69.5[samples/s]
2022-04-26 21:31:43,323 reid_baseline.train INFO: normal accuracy 0.6975690152451587 2.623295545578003 
2022-04-26 21:32:13,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 21:32:13,289 reid_baseline.train INFO: Accuracy: 69.8% Mean Entropy: 262.3%
2022-04-26 21:32:37,292 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.301, Acc: 0.800, Base Lr: 4.83e-03
2022-04-26 21:33:00,038 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.302, Acc: 0.795, Base Lr: 4.83e-03
Aug Cl acc: 0.16636251093267085
2022-04-26 21:33:16,258 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.231[s] Speed: 69.4[samples/s]
2022-04-26 21:33:45,127 reid_baseline.train INFO: normal accuracy 0.7194066749072929 2.3694326877593994 
2022-04-26 21:34:15,126 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 21:34:15,127 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 236.9%
2022-04-26 21:34:39,296 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.218, Acc: 0.811, Base Lr: 5.62e-03
2022-04-26 21:35:01,746 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.178, Acc: 0.824, Base Lr: 5.62e-03
Aug Cl acc: 0.17456219571850676
2022-04-26 21:35:17,580 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.229[s] Speed: 70.0[samples/s]
2022-04-26 21:35:46,497 reid_baseline.train INFO: normal accuracy 0.7214668314791924 2.196603775024414 
2022-04-26 21:36:16,486 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 21:36:16,486 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 219.7%
2022-04-26 21:36:41,487 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.109, Acc: 0.847, Base Lr: 6.42e-03
2022-04-26 21:37:03,694 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.107, Acc: 0.845, Base Lr: 6.42e-03
Aug Cl acc: 0.1694303519559867
2022-04-26 21:37:20,332 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.234[s] Speed: 68.4[samples/s]
2022-04-26 21:37:47,423 reid_baseline.train INFO: normal accuracy 0.7358879274824887 2.046290636062622 
2022-04-26 21:38:17,399 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 21:38:17,400 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 204.6%
2022-04-26 21:38:41,626 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.030, Acc: 0.866, Base Lr: 7.21e-03
2022-04-26 21:39:03,590 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.026, Acc: 0.868, Base Lr: 7.21e-03
Aug Cl acc: 0.17485881987072172
2022-04-26 21:39:20,015 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-26 21:39:48,469 reid_baseline.train INFO: normal accuracy 0.7325916769674495 1.9908902645111084 
2022-04-26 21:40:18,439 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 21:40:18,440 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 199.1%
2022-04-26 21:40:42,625 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.955, Acc: 0.890, Base Lr: 4.01e-03
2022-04-26 21:41:04,714 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.943, Acc: 0.898, Base Lr: 4.01e-03
Aug Cl acc: 0.18270595955761362
2022-04-26 21:41:20,663 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.228[s] Speed: 70.2[samples/s]
2022-04-26 21:42:18,424 reid_baseline.train INFO: normal accuracy 0.7367119901112484 1.9931026697158813 
2022-04-26 21:42:18,425 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 21:42:18,425 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 199.3%
2022-04-26 21:42:42,115 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.912, Acc: 0.906, Base Lr: 3.38e-03
2022-04-26 21:43:04,301 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.930, Acc: 0.902, Base Lr: 3.38e-03
Aug Cl acc: 0.16833918085901728
2022-04-26 21:43:20,297 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.227[s] Speed: 70.6[samples/s]
2022-04-26 21:43:47,557 reid_baseline.train INFO: normal accuracy 0.7412443345694273 1.9206137657165527 
2022-04-26 21:44:17,517 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 21:44:17,517 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 192.1%
2022-04-26 21:44:42,149 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.945, Acc: 0.890, Base Lr: 2.77e-03
2022-04-26 21:45:04,655 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.909, Acc: 0.903, Base Lr: 2.77e-03
Aug Cl acc: 0.16510841174003404
2022-04-26 21:45:21,216 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.233[s] Speed: 68.8[samples/s]
2022-04-26 21:45:48,924 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.892730951309204 
2022-04-26 21:46:18,901 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 21:46:18,901 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 189.3%
2022-04-26 21:46:43,229 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.897, Acc: 0.907, Base Lr: 2.20e-03
2022-04-26 21:47:05,482 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.887, Acc: 0.913, Base Lr: 2.20e-03
Aug Cl acc: 0.17515141972692022
2022-04-26 21:47:20,653 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-26 21:47:49,754 reid_baseline.train INFO: normal accuracy 0.7379480840543882 1.94647216796875 
2022-04-26 21:47:49,756 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 21:47:49,756 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 194.6%
2022-04-26 21:48:13,452 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.888, Acc: 0.899, Base Lr: 1.66e-03
2022-04-26 21:48:35,384 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.871, Acc: 0.910, Base Lr: 1.66e-03
Aug Cl acc: 0.17951309986603567
2022-04-26 21:48:51,828 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.227[s] Speed: 70.4[samples/s]
2022-04-26 21:49:19,998 reid_baseline.train INFO: normal accuracy 0.7412443345694273 1.9004839658737183 
2022-04-26 21:49:19,999 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 21:49:19,999 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 190.0%
2022-04-26 21:49:44,203 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.850, Acc: 0.920, Base Lr: 1.19e-03
2022-04-26 21:50:06,865 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.859, Acc: 0.917, Base Lr: 1.19e-03
Aug Cl acc: 0.17900955982697317
2022-04-26 21:50:23,152 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.231[s] Speed: 69.2[samples/s]
2022-04-26 21:50:53,016 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.9114192724227905 
2022-04-26 21:50:53,016 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 21:50:53,016 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 191.1%
2022-04-26 21:51:17,110 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.856, Acc: 0.926, Base Lr: 7.78e-04
2022-04-26 21:51:39,247 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.856, Acc: 0.921, Base Lr: 7.78e-04
Aug Cl acc: 0.17725510649628692
2022-04-26 21:51:55,559 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-26 21:52:23,458 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.8831404447555542 
2022-04-26 21:52:53,445 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 21:52:53,445 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 188.3%
2022-04-26 21:53:17,416 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.852, Acc: 0.916, Base Lr: 4.51e-04
2022-04-26 21:53:39,557 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.847, Acc: 0.920, Base Lr: 4.51e-04
Aug Cl acc: 0.17447525415665063
2022-04-26 21:53:56,415 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.231[s] Speed: 69.4[samples/s]
2022-04-26 21:54:23,838 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.8916932344436646 
2022-04-26 21:54:23,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 21:54:23,839 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 189.2%
2022-04-26 21:54:47,783 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.832, Acc: 0.926, Base Lr: 2.11e-04
2022-04-26 21:55:09,703 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.835, Acc: 0.922, Base Lr: 2.11e-04
Aug Cl acc: 0.17905653789366557
2022-04-26 21:55:25,563 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-26 21:55:54,807 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.8851491212844849 
2022-04-26 21:55:54,807 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 21:55:54,813 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 188.5%
2022-04-26 21:56:19,370 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.829, Acc: 0.923, Base Lr: 6.51e-05
2022-04-26 21:56:41,415 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.845, Acc: 0.919, Base Lr: 6.51e-05
Aug Cl acc: 0.17856614668290693
2022-04-26 21:56:57,490 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-26 21:57:25,668 reid_baseline.train INFO: normal accuracy 0.7470127729707458 1.860925555229187 
2022-04-26 21:57:55,638 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 21:57:55,639 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 186.1%
2022-04-26 21:58:19,497 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.826, Acc: 0.929, Base Lr: 1.60e-05
2022-04-26 21:58:42,354 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.833, Acc: 0.926, Base Lr: 1.60e-05
Aug Cl acc: 0.1793999305138221
2022-04-26 21:58:58,911 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.232[s] Speed: 69.0[samples/s]
2022-04-26 21:59:57,618 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.8188339471817017 
2022-04-26 22:00:27,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 22:00:27,595 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 181.9%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-26 22:01:25,684 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.8188339471817017 
2022-04-26 22:01:25,685 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:01:25,685 reid_baseline.train INFO: Accuracy: 74.5%
2022-04-26 22:01:53,262 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.8188339471817017 
2022-04-26 22:01:53,262 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:01:53,263 reid_baseline.train INFO: Shuffled Accuracy: 74.5%
2022-04-26 22:02:29,446 reid_baseline.train INFO: normal accuracy 0.9532646048109966 0.8035104870796204 
2022-04-26 22:02:29,447 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:02:29,447 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-26 22:02:34,824 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3
2022-04-26 22:02:34,825 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-26 22:02:34,825 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 22:02:34,825 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 22:02:34,825 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 22:02:45,319 reid_baseline.train INFO: start training
2022-04-26 22:03:19,184 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.020, Acc: 0.256, Base Lr: 8.72e-04
2022-04-26 22:03:41,443 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.939, Acc: 0.357, Base Lr: 8.72e-04
Aug Cl acc: 0.17453258640163546
2022-04-26 22:03:57,544 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.261[s] Speed: 61.3[samples/s]
2022-04-26 22:04:34,672 reid_baseline.train INFO: normal accuracy 0.5379589997747241 4.166522026062012 
2022-04-26 22:05:04,610 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 22:05:04,610 reid_baseline.train INFO: Accuracy: 53.8% Mean Entropy: 416.7%
2022-04-26 22:05:29,697 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.543, Acc: 0.542, Base Lr: 1.66e-03
2022-04-26 22:05:52,208 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.381, Acc: 0.544, Base Lr: 1.66e-03
Aug Cl acc: 0.167484618805267
2022-04-26 22:06:10,493 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.241[s] Speed: 66.3[samples/s]
2022-04-26 22:06:46,208 reid_baseline.train INFO: normal accuracy 0.5676954268979499 4.032092094421387 
2022-04-26 22:07:16,176 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 22:07:16,176 reid_baseline.train INFO: Accuracy: 56.8% Mean Entropy: 403.2%
2022-04-26 22:07:41,245 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.668, Acc: 0.585, Base Lr: 2.46e-03
2022-04-26 22:08:03,739 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.518, Acc: 0.594, Base Lr: 2.46e-03
Aug Cl acc: 0.1630019023741558
2022-04-26 22:08:20,273 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.234[s] Speed: 68.3[samples/s]
2022-04-26 22:08:56,440 reid_baseline.train INFO: normal accuracy 0.6249155215138544 3.408048629760742 
2022-04-26 22:09:26,413 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 22:09:26,414 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 340.8%
2022-04-26 22:09:50,472 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.915, Acc: 0.647, Base Lr: 3.25e-03
2022-04-26 22:10:12,191 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.822, Acc: 0.681, Base Lr: 3.25e-03
Aug Cl acc: 0.17630125052762993
2022-04-26 22:10:28,705 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.227[s] Speed: 70.3[samples/s]
2022-04-26 22:11:04,239 reid_baseline.train INFO: normal accuracy 0.6904708267627844 2.6822431087493896 
2022-04-26 22:11:34,215 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 22:11:34,215 reid_baseline.train INFO: Accuracy: 69.0% Mean Entropy: 268.2%
2022-04-26 22:11:57,919 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.522, Acc: 0.764, Base Lr: 4.04e-03
2022-04-26 22:12:20,392 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.485, Acc: 0.754, Base Lr: 4.04e-03
Aug Cl acc: 0.17145960322229853
2022-04-26 22:12:36,902 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-26 22:13:13,040 reid_baseline.train INFO: normal accuracy 0.7138995269204775 2.2875800132751465 
2022-04-26 22:13:43,005 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 22:13:43,005 reid_baseline.train INFO: Accuracy: 71.4% Mean Entropy: 228.8%
2022-04-26 22:14:06,712 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.301, Acc: 0.800, Base Lr: 4.83e-03
2022-04-26 22:14:29,805 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.302, Acc: 0.795, Base Lr: 4.83e-03
Aug Cl acc: 0.16659144866160858
2022-04-26 22:14:46,072 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.231[s] Speed: 69.3[samples/s]
2022-04-26 22:15:25,182 reid_baseline.train INFO: normal accuracy 0.7267402568145979 2.066415786743164 
2022-04-26 22:15:55,166 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 22:15:55,167 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 206.6%
2022-04-26 22:16:18,702 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.218, Acc: 0.812, Base Lr: 5.62e-03
2022-04-26 22:16:41,032 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.178, Acc: 0.824, Base Lr: 5.62e-03
Aug Cl acc: 0.17433325798956903
2022-04-26 22:16:57,019 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.226[s] Speed: 70.6[samples/s]
2022-04-26 22:17:33,615 reid_baseline.train INFO: normal accuracy 0.7470150934895247 1.905219316482544 
2022-04-26 22:18:03,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 22:18:03,586 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 190.5%
2022-04-26 22:18:28,706 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.109, Acc: 0.848, Base Lr: 6.42e-03
2022-04-26 22:18:50,882 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.107, Acc: 0.846, Base Lr: 6.42e-03
Aug Cl acc: 0.16994106027232858
2022-04-26 22:19:07,307 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.233[s] Speed: 68.7[samples/s]
2022-04-26 22:19:43,092 reid_baseline.train INFO: normal accuracy 0.7476909213786889 1.8340026140213013 
2022-04-26 22:20:13,067 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 22:20:13,067 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 183.4%
2022-04-26 22:20:36,934 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.030, Acc: 0.866, Base Lr: 7.21e-03
2022-04-26 22:20:59,129 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.026, Acc: 0.869, Base Lr: 7.21e-03
Aug Cl acc: 0.17473394093496022
2022-04-26 22:21:15,419 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-26 22:21:50,939 reid_baseline.train INFO: normal accuracy 0.7585041676053165 1.755082607269287 
2022-04-26 22:22:20,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 22:22:20,934 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 175.5%
2022-04-26 22:22:44,568 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.955, Acc: 0.890, Base Lr: 4.01e-03
2022-04-26 22:23:06,810 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.943, Acc: 0.897, Base Lr: 4.01e-03
Aug Cl acc: 0.18242418897020948
2022-04-26 22:23:22,668 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-26 22:24:28,105 reid_baseline.train INFO: normal accuracy 0.752872268528948 1.8073689937591553 
2022-04-26 22:24:28,106 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 22:24:28,107 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 180.7%
2022-04-26 22:24:52,487 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.912, Acc: 0.906, Base Lr: 3.38e-03
2022-04-26 22:25:14,655 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.930, Acc: 0.901, Base Lr: 3.38e-03
Aug Cl acc: 0.16833918085901728
2022-04-26 22:25:30,967 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.230[s] Speed: 69.5[samples/s]
2022-04-26 22:26:06,495 reid_baseline.train INFO: normal accuracy 0.7623338589772471 1.7257035970687866 
2022-04-26 22:26:36,460 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 22:26:36,460 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 172.6%
2022-04-26 22:27:01,514 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.945, Acc: 0.890, Base Lr: 2.77e-03
2022-04-26 22:27:23,569 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.909, Acc: 0.903, Base Lr: 2.77e-03
Aug Cl acc: 0.16533734946897177
2022-04-26 22:27:40,084 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.232[s] Speed: 68.8[samples/s]
2022-04-26 22:28:16,050 reid_baseline.train INFO: normal accuracy 0.7663888263122325 1.71047842502594 
2022-04-26 22:28:46,035 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 22:28:46,035 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 171.0%
2022-04-26 22:29:10,914 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.897, Acc: 0.906, Base Lr: 2.20e-03
2022-04-26 22:29:33,129 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.887, Acc: 0.912, Base Lr: 2.20e-03
Aug Cl acc: 0.17560929518479568
2022-04-26 22:29:48,427 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-26 22:30:26,272 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.761813759803772 
2022-04-26 22:30:26,272 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 22:30:26,272 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 176.2%
2022-04-26 22:30:49,965 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.888, Acc: 0.899, Base Lr: 1.66e-03
2022-04-26 22:31:12,133 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.871, Acc: 0.910, Base Lr: 1.66e-03
Aug Cl acc: 0.17928416213709794
2022-04-26 22:31:28,315 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.226[s] Speed: 70.7[samples/s]
2022-04-26 22:32:04,811 reid_baseline.train INFO: normal accuracy 0.7663888263122325 1.719001293182373 
2022-04-26 22:32:04,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 22:32:04,812 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 171.9%
2022-04-26 22:32:28,957 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.850, Acc: 0.920, Base Lr: 1.19e-03
2022-04-26 22:32:50,687 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.859, Acc: 0.917, Base Lr: 1.19e-03
Aug Cl acc: 0.17900955982697317
2022-04-26 22:33:07,103 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.228[s] Speed: 70.3[samples/s]
2022-04-26 22:33:43,283 reid_baseline.train INFO: normal accuracy 0.7686415859427799 1.752893090248108 
2022-04-26 22:33:43,283 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 22:33:43,283 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 175.3%
2022-04-26 22:34:07,444 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.856, Acc: 0.926, Base Lr: 7.78e-04
2022-04-26 22:34:29,847 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.856, Acc: 0.921, Base Lr: 7.78e-04
Aug Cl acc: 0.1774687714629121
2022-04-26 22:34:46,021 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-26 22:35:21,033 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7191176414489746 
2022-04-26 22:35:21,034 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 22:35:21,034 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 171.9%
2022-04-26 22:35:45,140 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.852, Acc: 0.916, Base Lr: 4.51e-04
2022-04-26 22:36:07,298 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.847, Acc: 0.920, Base Lr: 4.51e-04
Aug Cl acc: 0.17401737869877518
2022-04-26 22:36:24,188 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.231[s] Speed: 69.4[samples/s]
2022-04-26 22:36:59,317 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.7283949851989746 
2022-04-26 22:36:59,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 22:36:59,317 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 172.8%
2022-04-26 22:37:23,329 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.832, Acc: 0.926, Base Lr: 2.11e-04
2022-04-26 22:37:45,038 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.835, Acc: 0.922, Base Lr: 2.11e-04
Aug Cl acc: 0.17882760016472785
2022-04-26 22:38:01,247 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-26 22:38:36,945 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7300386428833008 
2022-04-26 22:38:36,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 22:38:36,946 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 173.0%
2022-04-26 22:39:00,787 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.829, Acc: 0.923, Base Lr: 6.51e-05
2022-04-26 22:39:22,480 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.845, Acc: 0.919, Base Lr: 6.51e-05
Aug Cl acc: 0.17879508441184466
2022-04-26 22:39:38,770 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.226[s] Speed: 70.7[samples/s]
2022-04-26 22:40:14,283 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.687648057937622 
2022-04-26 22:40:44,286 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 22:40:44,287 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 168.8%
2022-04-26 22:41:08,494 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.826, Acc: 0.929, Base Lr: 1.60e-05
2022-04-26 22:41:30,572 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.833, Acc: 0.926, Base Lr: 1.60e-05
Aug Cl acc: 0.17934709765535573
2022-04-26 22:41:47,504 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.232[s] Speed: 69.1[samples/s]
2022-04-26 22:42:53,093 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.6509065628051758 
2022-04-26 22:43:23,102 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 22:43:23,103 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 165.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-26 22:44:30,011 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.6509065628051758 
2022-04-26 22:44:30,011 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:44:30,012 reid_baseline.train INFO: Accuracy: 76.9%
2022-04-26 22:45:05,521 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.6509065628051758 
2022-04-26 22:45:05,521 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:45:05,521 reid_baseline.train INFO: Shuffled Accuracy: 76.9%
2022-04-26 22:45:40,743 reid_baseline.train INFO: normal accuracy 0.9530355097365406 0.8036045432090759 
2022-04-26 22:45:40,743 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 22:45:40,744 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-26 22:45:45,785 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3
2022-04-26 22:45:45,785 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-26 22:45:45,786 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 22:45:45,786 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 22:45:45,786 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 22:45:55,470 reid_baseline.train INFO: start training
2022-04-26 22:46:28,733 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.020, Acc: 0.256, Base Lr: 8.72e-04
2022-04-26 22:46:50,931 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.939, Acc: 0.357, Base Lr: 8.72e-04
Aug Cl acc: 0.17453258640163546
2022-04-26 22:47:06,949 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.257[s] Speed: 62.1[samples/s]
2022-04-26 22:48:36,849 reid_baseline.train INFO: normal accuracy 0.5595593298140923 4.167706489562988 
2022-04-26 22:49:06,824 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 22:49:06,824 reid_baseline.train INFO: Accuracy: 56.0% Mean Entropy: 416.8%
2022-04-26 22:49:31,752 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.543, Acc: 0.542, Base Lr: 1.66e-03
2022-04-26 22:49:53,560 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.381, Acc: 0.544, Base Lr: 1.66e-03
Aug Cl acc: 0.167484618805267
2022-04-26 22:50:11,319 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.236[s] Speed: 67.7[samples/s]
2022-04-26 22:51:43,785 reid_baseline.train INFO: normal accuracy 0.5871012164333257 4.049771785736084 
2022-04-26 22:52:14,306 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-26 22:52:14,307 reid_baseline.train INFO: Accuracy: 58.7% Mean Entropy: 405.0%
2022-04-26 22:52:39,023 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.668, Acc: 0.585, Base Lr: 2.46e-03
2022-04-26 22:53:01,666 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.518, Acc: 0.594, Base Lr: 2.46e-03
Aug Cl acc: 0.16345977783203125
2022-04-26 22:53:18,142 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.234[s] Speed: 68.5[samples/s]
2022-04-26 22:54:49,783 reid_baseline.train INFO: normal accuracy 0.6564149644250631 3.4647817611694336 
2022-04-26 22:55:19,801 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-26 22:55:19,802 reid_baseline.train INFO: Accuracy: 65.6% Mean Entropy: 346.5%
2022-04-26 22:55:43,422 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.915, Acc: 0.647, Base Lr: 3.25e-03
2022-04-26 22:56:05,367 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.822, Acc: 0.681, Base Lr: 3.25e-03
Aug Cl acc: 0.1761763715918684
2022-04-26 22:56:21,591 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.226[s] Speed: 70.7[samples/s]
2022-04-26 22:57:48,155 reid_baseline.train INFO: normal accuracy 0.719990819371127 2.7326607704162598 
2022-04-26 22:58:18,143 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-26 22:58:18,144 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 273.3%
2022-04-26 22:58:42,150 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.523, Acc: 0.764, Base Lr: 4.04e-03
2022-04-26 22:59:04,392 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.485, Acc: 0.754, Base Lr: 4.04e-03
Aug Cl acc: 0.17145960322229853
2022-04-26 22:59:20,513 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.228[s] Speed: 70.0[samples/s]
2022-04-26 23:00:50,809 reid_baseline.train INFO: normal accuracy 0.7498278632086298 2.359757661819458 
2022-04-26 23:01:20,803 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-26 23:01:20,804 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 236.0%
2022-04-26 23:01:44,881 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.301, Acc: 0.800, Base Lr: 4.83e-03
2022-04-26 23:02:07,498 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.302, Acc: 0.795, Base Lr: 4.83e-03
Aug Cl acc: 0.16634725214360835
2022-04-26 23:02:23,923 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.230[s] Speed: 69.5[samples/s]
2022-04-26 23:04:00,624 reid_baseline.train INFO: normal accuracy 0.7649759008492082 2.1233878135681152 
2022-04-26 23:04:30,627 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-26 23:04:30,627 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 212.3%
2022-04-26 23:04:55,108 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.218, Acc: 0.812, Base Lr: 5.62e-03
2022-04-26 23:05:17,342 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.178, Acc: 0.825, Base Lr: 5.62e-03
Aug Cl acc: 0.17387538253169357
2022-04-26 23:05:33,103 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-26 23:07:00,056 reid_baseline.train INFO: normal accuracy 0.7693366995639201 1.9574507474899292 
2022-04-26 23:07:30,051 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-26 23:07:30,052 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 195.7%
2022-04-26 23:07:55,181 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.109, Acc: 0.848, Base Lr: 6.42e-03
2022-04-26 23:08:17,649 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.107, Acc: 0.846, Base Lr: 6.42e-03
Aug Cl acc: 0.1693976545508528
2022-04-26 23:08:34,135 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.235[s] Speed: 68.2[samples/s]
2022-04-26 23:10:01,294 reid_baseline.train INFO: normal accuracy 0.7792058756024788 1.8422181606292725 
2022-04-26 23:10:31,285 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-26 23:10:31,286 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 184.2%
2022-04-26 23:10:55,271 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.030, Acc: 0.866, Base Lr: 7.21e-03
2022-04-26 23:11:17,163 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.026, Acc: 0.868, Base Lr: 7.21e-03
Aug Cl acc: 0.17445218432080614
2022-04-26 23:11:33,331 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.227[s] Speed: 70.4[samples/s]
2022-04-26 23:13:03,027 reid_baseline.train INFO: normal accuracy 0.7812715170989213 1.7798045873641968 
2022-04-26 23:13:33,060 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-26 23:13:33,060 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 178.0%
2022-04-26 23:13:56,920 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.955, Acc: 0.890, Base Lr: 4.01e-03
2022-04-26 23:14:19,304 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.943, Acc: 0.897, Base Lr: 4.01e-03
Aug Cl acc: 0.18270595955761362
2022-04-26 23:14:35,390 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.228[s] Speed: 70.3[samples/s]
2022-04-26 23:16:33,016 reid_baseline.train INFO: normal accuracy 0.7849437686481524 1.8143314123153687 
2022-04-26 23:16:33,016 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-26 23:16:33,017 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 181.4%
2022-04-26 23:16:56,796 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.912, Acc: 0.906, Base Lr: 3.38e-03
2022-04-26 23:17:18,959 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.930, Acc: 0.902, Base Lr: 3.38e-03
Aug Cl acc: 0.168568118587955
2022-04-26 23:17:35,241 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.228[s] Speed: 70.2[samples/s]
2022-04-26 23:19:07,283 reid_baseline.train INFO: normal accuracy 0.7844847372044985 1.7400003671646118 
2022-04-26 23:19:37,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-26 23:19:37,268 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 174.0%
2022-04-26 23:20:02,278 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.945, Acc: 0.890, Base Lr: 2.77e-03
2022-04-26 23:20:24,471 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.909, Acc: 0.903, Base Lr: 2.77e-03
Aug Cl acc: 0.16533734946897177
2022-04-26 23:20:40,687 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.232[s] Speed: 69.1[samples/s]
2022-04-26 23:22:12,145 reid_baseline.train INFO: normal accuracy 0.7893045673628644 1.7199004888534546 
2022-04-26 23:22:42,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-26 23:22:42,163 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 172.0%
2022-04-26 23:23:06,816 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.897, Acc: 0.908, Base Lr: 2.20e-03
2022-04-26 23:23:28,892 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.887, Acc: 0.913, Base Lr: 2.20e-03
Aug Cl acc: 0.1749224819979825
2022-04-26 23:23:44,242 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.227[s] Speed: 70.4[samples/s]
2022-04-26 23:25:16,619 reid_baseline.train INFO: normal accuracy 0.7881569887537296 1.7780417203903198 
2022-04-26 23:25:16,619 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-26 23:25:16,620 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 177.8%
2022-04-26 23:25:40,769 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.888, Acc: 0.899, Base Lr: 1.66e-03
2022-04-26 23:26:03,044 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.871, Acc: 0.910, Base Lr: 1.66e-03
Aug Cl acc: 0.17928416213709794
2022-04-26 23:26:19,336 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-26 23:27:47,509 reid_baseline.train INFO: normal accuracy 0.7888455359192105 1.7300355434417725 
2022-04-26 23:27:47,510 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-26 23:27:47,510 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 173.0%
2022-04-26 23:28:12,015 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.850, Acc: 0.920, Base Lr: 1.19e-03
2022-04-26 23:28:34,372 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.859, Acc: 0.917, Base Lr: 1.19e-03
Aug Cl acc: 0.17900955982697317
2022-04-26 23:28:50,450 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.230[s] Speed: 69.7[samples/s]
2022-04-26 23:30:20,967 reid_baseline.train INFO: normal accuracy 0.7899931145283452 1.7540690898895264 
2022-04-26 23:30:20,968 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-26 23:30:20,968 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 175.4%
2022-04-26 23:30:45,061 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.856, Acc: 0.925, Base Lr: 7.78e-04
2022-04-26 23:31:07,691 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.856, Acc: 0.920, Base Lr: 7.78e-04
Aug Cl acc: 0.17769770919184982
2022-04-26 23:31:23,910 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.230[s] Speed: 69.6[samples/s]
2022-04-26 23:32:51,046 reid_baseline.train INFO: normal accuracy 0.7899931145283452 1.7222164869308472 
2022-04-26 23:32:51,047 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-26 23:32:51,047 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 172.2%
2022-04-26 23:33:15,731 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.852, Acc: 0.916, Base Lr: 4.51e-04
2022-04-26 23:33:38,175 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.847, Acc: 0.920, Base Lr: 4.51e-04
Aug Cl acc: 0.1742463164277129
2022-04-26 23:33:54,953 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.234[s] Speed: 68.5[samples/s]
2022-04-26 23:35:25,122 reid_baseline.train INFO: normal accuracy 0.7874684415882488 1.7330113649368286 
2022-04-26 23:35:25,123 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-26 23:35:25,123 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 173.3%
2022-04-26 23:35:49,754 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.832, Acc: 0.925, Base Lr: 2.11e-04
2022-04-26 23:36:12,053 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.835, Acc: 0.921, Base Lr: 2.11e-04
Aug Cl acc: 0.17905653789366557
2022-04-26 23:36:27,792 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-26 23:37:55,287 reid_baseline.train INFO: normal accuracy 0.790911177415653 1.7376805543899536 
2022-04-26 23:37:55,287 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-26 23:37:55,288 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 173.8%
2022-04-26 23:38:21,142 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.829, Acc: 0.923, Base Lr: 6.51e-05
2022-04-26 23:38:45,000 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.845, Acc: 0.919, Base Lr: 6.51e-05
Aug Cl acc: 0.17879508441184466
2022-04-26 23:39:03,282 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.248[s] Speed: 64.6[samples/s]
2022-04-26 23:41:01,014 reid_baseline.train INFO: normal accuracy 0.790911177415653 1.6978179216384888 
2022-04-26 23:41:31,032 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-26 23:41:31,033 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 169.8%
2022-04-26 23:42:39,812 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.826, Acc: 0.929, Base Lr: 1.60e-05
2022-04-26 23:43:51,983 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.833, Acc: 0.926, Base Lr: 1.60e-05
Aug Cl acc: 0.1797051761613224
2022-04-26 23:44:39,187 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.688[s] Speed: 23.2[samples/s]
2022-04-26 23:47:32,293 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.6570791006088257 
2022-04-26 23:48:02,291 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-26 23:48:02,291 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 165.7%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-26 23:50:50,489 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.6570791006088257 
2022-04-26 23:50:50,490 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 23:50:50,490 reid_baseline.train INFO: Accuracy: 79.2%
2022-04-26 23:53:05,164 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.6570791006088257 
2022-04-26 23:53:05,164 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 23:53:05,164 reid_baseline.train INFO: Shuffled Accuracy: 79.2%
2022-04-26 23:54:11,912 reid_baseline.train INFO: normal accuracy 0.9534936998854525 0.8034629821777344 
2022-04-26 23:54:11,913 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-26 23:54:11,913 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-26 23:54:19,272 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4
2022-04-26 23:54:19,272 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-26 23:54:19,272 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-26 23:54:19,273 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-26 23:54:19,273 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-26 23:54:35,272 reid_baseline.train INFO: start training
2022-04-26 23:56:02,934 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.044, Acc: 0.235, Base Lr: 8.72e-04
2022-04-26 23:57:12,252 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.964, Acc: 0.339, Base Lr: 8.72e-04
Aug Cl acc: 0.1749006138616429
2022-04-26 23:58:03,394 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.749[s] Speed: 21.4[samples/s]
2022-04-26 23:58:45,762 reid_baseline.train INFO: normal accuracy 0.4791924186238154 4.169203758239746 
2022-04-26 23:59:15,749 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-26 23:59:15,750 reid_baseline.train INFO: Accuracy: 47.9% Mean Entropy: 416.9%
2022-04-27 00:00:28,804 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.591, Acc: 0.524, Base Lr: 1.66e-03
2022-04-27 00:01:40,755 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.446, Acc: 0.527, Base Lr: 1.66e-03
Aug Cl acc: 0.16763205056662087
2022-04-27 00:02:35,026 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.730[s] Speed: 21.9[samples/s]
2022-04-27 00:03:20,808 reid_baseline.train INFO: normal accuracy 0.5084466419447878 4.092096328735352 
2022-04-27 00:03:50,798 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 00:03:50,798 reid_baseline.train INFO: Accuracy: 50.8% Mean Entropy: 409.2%
2022-04-27 00:05:05,640 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.763, Acc: 0.568, Base Lr: 2.46e-03
2022-04-27 00:06:17,870 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.618, Acc: 0.579, Base Lr: 2.46e-03
Aug Cl acc: 0.17191193129990126
2022-04-27 00:07:05,813 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.714[s] Speed: 22.4[samples/s]
2022-04-27 00:07:50,369 reid_baseline.train INFO: normal accuracy 0.5817882159044088 3.674147129058838 
2022-04-27 00:08:20,410 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 00:08:20,411 reid_baseline.train INFO: Accuracy: 58.2% Mean Entropy: 367.4%
2022-04-27 00:09:34,861 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.009, Acc: 0.631, Base Lr: 3.25e-03
2022-04-27 00:10:40,632 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.901, Acc: 0.660, Base Lr: 3.25e-03
Aug Cl acc: 0.168924073159913
2022-04-27 00:11:30,311 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.695[s] Speed: 23.0[samples/s]
2022-04-27 00:12:14,693 reid_baseline.train INFO: normal accuracy 0.6510094767202307 3.055269479751587 
2022-04-27 00:12:44,708 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 00:12:44,709 reid_baseline.train INFO: Accuracy: 65.1% Mean Entropy: 305.5%
2022-04-27 00:13:57,732 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.583, Acc: 0.741, Base Lr: 4.04e-03
2022-04-27 00:15:04,599 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.541, Acc: 0.734, Base Lr: 4.04e-03
Aug Cl acc: 0.1740465268983946
2022-04-27 00:15:55,352 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.698[s] Speed: 22.9[samples/s]
2022-04-27 00:16:41,497 reid_baseline.train INFO: normal accuracy 0.6827358879274825 2.7072978019714355 
2022-04-27 00:17:11,484 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 00:17:11,484 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 270.7%
2022-04-27 00:18:21,367 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.350, Acc: 0.782, Base Lr: 4.83e-03
2022-04-27 00:19:30,742 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.342, Acc: 0.779, Base Lr: 4.83e-03
Aug Cl acc: 0.1706849122658754
2022-04-27 00:20:20,579 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.692[s] Speed: 23.1[samples/s]
2022-04-27 00:21:09,382 reid_baseline.train INFO: normal accuracy 0.7004532344458179 2.4162495136260986 
2022-04-27 00:21:39,391 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 00:21:39,392 reid_baseline.train INFO: Accuracy: 70.0% Mean Entropy: 241.6%
2022-04-27 00:22:48,314 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.253, Acc: 0.809, Base Lr: 5.62e-03
2022-04-27 00:23:59,416 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.213, Acc: 0.821, Base Lr: 5.62e-03
Aug Cl acc: 0.16920862442407852
2022-04-27 00:24:51,738 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.705[s] Speed: 22.7[samples/s]
2022-04-27 00:25:35,597 reid_baseline.train INFO: normal accuracy 0.707457766790276 2.2515032291412354 
2022-04-27 00:26:05,617 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 00:26:05,617 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 225.2%
2022-04-27 00:27:18,843 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.134, Acc: 0.844, Base Lr: 6.42e-03
2022-04-27 00:28:31,068 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.140, Acc: 0.838, Base Lr: 6.42e-03
Aug Cl acc: 0.16808999589074664
2022-04-27 00:29:16,413 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.698[s] Speed: 22.9[samples/s]
2022-04-27 00:30:00,375 reid_baseline.train INFO: normal accuracy 0.7280593325092707 2.089489698410034 
2022-04-27 00:30:30,367 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 00:30:30,368 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 208.9%
2022-04-27 00:31:46,179 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.068, Acc: 0.850, Base Lr: 7.21e-03
2022-04-27 00:32:57,168 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.063, Acc: 0.855, Base Lr: 7.21e-03
Aug Cl acc: 0.1609812446566292
2022-04-27 00:33:46,968 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.720[s] Speed: 22.2[samples/s]
2022-04-27 00:34:32,371 reid_baseline.train INFO: normal accuracy 0.7189946435929131 2.03236985206604 
2022-04-27 00:35:02,390 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 00:35:02,391 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 203.2%
2022-04-27 00:36:16,164 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.983, Acc: 0.880, Base Lr: 4.01e-03
2022-04-27 00:37:22,963 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.966, Acc: 0.887, Base Lr: 4.01e-03
Aug Cl acc: 0.18306308788257641
2022-04-27 00:38:07,883 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.679[s] Speed: 23.6[samples/s]
2022-04-27 00:39:24,334 reid_baseline.train INFO: normal accuracy 0.7301194890811702 2.0421173572540283 
2022-04-27 00:39:24,339 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 00:39:24,339 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 204.2%
2022-04-27 00:40:36,782 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.937, Acc: 0.896, Base Lr: 3.38e-03
2022-04-27 00:41:44,698 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.947, Acc: 0.891, Base Lr: 3.38e-03
Aug Cl acc: 0.16988343458909255
2022-04-27 00:42:35,083 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.699[s] Speed: 22.9[samples/s]
2022-04-27 00:43:21,951 reid_baseline.train INFO: normal accuracy 0.7342398022249691 1.9320701360702515 
2022-04-27 00:43:51,954 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 00:43:51,955 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 193.2%
2022-04-27 00:45:04,841 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.971, Acc: 0.882, Base Lr: 2.77e-03
2022-04-27 00:46:06,715 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.937, Acc: 0.897, Base Lr: 2.77e-03
Aug Cl acc: 0.1729068825969766
2022-04-27 00:46:57,667 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.680[s] Speed: 23.5[samples/s]
2022-04-27 00:47:43,909 reid_baseline.train INFO: normal accuracy 0.7338277709105891 1.9153363704681396 
2022-04-27 00:48:13,929 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 00:48:13,929 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 191.5%
2022-04-27 00:49:24,912 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.925, Acc: 0.896, Base Lr: 2.20e-03
2022-04-27 00:50:34,824 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.913, Acc: 0.901, Base Lr: 2.20e-03
Aug Cl acc: 0.17779679350800567
2022-04-27 00:51:24,064 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.696[s] Speed: 23.0[samples/s]
2022-04-27 00:52:09,682 reid_baseline.train INFO: normal accuracy 0.7321796456530696 1.963566780090332 
2022-04-27 00:52:09,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 00:52:09,687 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 196.4%
2022-04-27 00:53:18,052 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.929, Acc: 0.890, Base Lr: 1.66e-03
2022-04-27 00:54:26,229 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.899, Acc: 0.906, Base Lr: 1.66e-03
Aug Cl acc: 0.17893252529940762
2022-04-27 00:55:12,540 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-27 00:56:00,259 reid_baseline.train INFO: normal accuracy 0.7325916769674495 1.935836911201477 
2022-04-27 00:56:00,264 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 00:56:00,264 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 193.6%
2022-04-27 00:57:09,310 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.872, Acc: 0.920, Base Lr: 1.19e-03
2022-04-27 00:58:19,082 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.879, Acc: 0.914, Base Lr: 1.19e-03
Aug Cl acc: 0.1775265648251488
2022-04-27 00:59:10,086 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.695[s] Speed: 23.0[samples/s]
2022-04-27 01:00:00,165 reid_baseline.train INFO: normal accuracy 0.7334157395962093 1.9326637983322144 
2022-04-27 01:00:00,170 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 01:00:00,170 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 193.3%
2022-04-27 01:01:08,770 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.877, Acc: 0.916, Base Lr: 7.78e-04
2022-04-27 01:02:17,541 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.876, Acc: 0.916, Base Lr: 7.78e-04
Aug Cl acc: 0.17231602371830643
2022-04-27 01:03:07,929 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.688[s] Speed: 23.3[samples/s]
2022-04-27 01:03:52,230 reid_baseline.train INFO: normal accuracy 0.7362999587968686 1.9213653802871704 
2022-04-27 01:03:52,232 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 01:03:52,233 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 192.1%
2022-04-27 01:05:02,023 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.869, Acc: 0.909, Base Lr: 4.51e-04
2022-04-27 01:06:12,096 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.861, Acc: 0.914, Base Lr: 4.51e-04
Aug Cl acc: 0.18804838019849618
2022-04-27 01:07:05,001 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.706[s] Speed: 22.7[samples/s]
2022-04-27 01:07:49,273 reid_baseline.train INFO: normal accuracy 0.738360115368768 1.9251748323440552 
2022-04-27 01:07:49,276 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 01:07:49,276 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 192.5%
2022-04-27 01:08:59,074 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.845, Acc: 0.922, Base Lr: 2.11e-04
2022-04-27 01:10:08,323 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.849, Acc: 0.917, Base Lr: 2.11e-04
Aug Cl acc: 0.19965215829702523
2022-04-27 01:10:54,228 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.677[s] Speed: 23.6[samples/s]
2022-04-27 01:11:40,731 reid_baseline.train INFO: normal accuracy 0.7354758961681088 1.9089635610580444 
2022-04-27 01:12:12,026 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 01:12:12,027 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 190.9%
2022-04-27 01:13:17,551 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.842, Acc: 0.920, Base Lr: 6.51e-05
2022-04-27 01:14:31,541 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.859, Acc: 0.917, Base Lr: 6.51e-05
Aug Cl acc: 0.1832046648521563
2022-04-27 01:15:19,689 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.687[s] Speed: 23.3[samples/s]
2022-04-27 01:16:05,160 reid_baseline.train INFO: normal accuracy 0.7358879274824887 1.8954929113388062 
2022-04-27 01:16:35,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 01:16:35,174 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 189.5%
2022-04-27 01:17:48,179 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.843, Acc: 0.926, Base Lr: 1.60e-05
2022-04-27 01:18:57,968 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.855, Acc: 0.920, Base Lr: 1.60e-05
Aug Cl acc: 0.17109949859507353
2022-04-27 01:19:48,106 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.707[s] Speed: 22.6[samples/s]
2022-04-27 01:21:00,504 reid_baseline.train INFO: normal accuracy 0.7354758961681088 1.8587923049926758 
2022-04-27 01:21:30,532 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 01:21:30,532 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 185.9%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-27 01:22:44,087 reid_baseline.train INFO: normal accuracy 0.7354758961681088 1.8587923049926758 
2022-04-27 01:22:44,087 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 01:22:44,087 reid_baseline.train INFO: Accuracy: 73.5%
2022-04-27 01:23:28,150 reid_baseline.train INFO: normal accuracy 0.7354758961681088 1.8587923049926758 
2022-04-27 01:23:28,151 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 01:23:28,151 reid_baseline.train INFO: Shuffled Accuracy: 73.5%
2022-04-27 01:24:34,646 reid_baseline.train INFO: normal accuracy 0.9489117983963344 0.8282445073127747 
2022-04-27 01:24:34,647 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 01:24:34,647 reid_baseline.train INFO: Source Clean Accuracy: 94.9%
2022-04-27 01:24:41,604 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4
2022-04-27 01:24:41,605 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-27 01:24:41,605 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 01:24:41,605 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 01:24:41,605 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 01:24:57,979 reid_baseline.train INFO: start training
2022-04-27 01:26:39,540 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.044, Acc: 0.235, Base Lr: 8.72e-04
2022-04-27 01:27:45,953 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.964, Acc: 0.339, Base Lr: 8.72e-04
Aug Cl acc: 0.1749006138616429
2022-04-27 01:28:32,416 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.763[s] Speed: 21.0[samples/s]
2022-04-27 01:29:35,372 reid_baseline.train INFO: normal accuracy 0.5271457535480965 4.16762638092041 
2022-04-27 01:30:05,336 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 01:30:05,337 reid_baseline.train INFO: Accuracy: 52.7% Mean Entropy: 416.8%
2022-04-27 01:31:18,408 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.591, Acc: 0.523, Base Lr: 1.66e-03
2022-04-27 01:32:24,555 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.446, Acc: 0.527, Base Lr: 1.66e-03
Aug Cl acc: 0.16737040145929916
2022-04-27 01:33:18,401 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.707[s] Speed: 22.6[samples/s]
2022-04-27 01:34:23,168 reid_baseline.train INFO: normal accuracy 0.5595854922279793 4.060008525848389 
2022-04-27 01:34:53,189 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 01:34:53,190 reid_baseline.train INFO: Accuracy: 56.0% Mean Entropy: 406.0%
2022-04-27 01:36:01,632 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.763, Acc: 0.568, Base Lr: 2.46e-03
2022-04-27 01:37:14,797 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.618, Acc: 0.579, Base Lr: 2.46e-03
Aug Cl acc: 0.17168299357096353
2022-04-27 01:38:00,140 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.685[s] Speed: 23.4[samples/s]
2022-04-27 01:39:07,077 reid_baseline.train INFO: normal accuracy 0.6143275512502816 3.4929428100585938 
2022-04-27 01:39:37,075 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 01:39:37,076 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 349.3%
2022-04-27 01:40:44,842 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.009, Acc: 0.631, Base Lr: 3.25e-03
2022-04-27 01:41:48,726 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.901, Acc: 0.659, Base Lr: 3.25e-03
Aug Cl acc: 0.16869513543097528
2022-04-27 01:42:41,642 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.675[s] Speed: 23.7[samples/s]
2022-04-27 01:43:48,099 reid_baseline.train INFO: normal accuracy 0.6771795449425546 2.7740836143493652 
2022-04-27 01:44:18,111 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 01:44:18,111 reid_baseline.train INFO: Accuracy: 67.7% Mean Entropy: 277.4%
2022-04-27 01:45:30,087 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.583, Acc: 0.741, Base Lr: 4.04e-03
2022-04-27 01:46:33,224 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.541, Acc: 0.734, Base Lr: 4.04e-03
Aug Cl acc: 0.17381758916945683
2022-04-27 01:47:23,812 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.680[s] Speed: 23.5[samples/s]
2022-04-27 01:48:27,926 reid_baseline.train INFO: normal accuracy 0.7064654201396711 2.365049123764038 
2022-04-27 01:48:57,924 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 01:48:57,924 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 236.5%
2022-04-27 01:50:07,929 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.350, Acc: 0.782, Base Lr: 4.83e-03
2022-04-27 01:51:18,210 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.341, Acc: 0.780, Base Lr: 4.83e-03
Aug Cl acc: 0.17114278772375086
2022-04-27 01:52:06,321 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.690[s] Speed: 23.2[samples/s]
2022-04-27 01:53:07,719 reid_baseline.train INFO: normal accuracy 0.7172786663662987 2.107086181640625 
2022-04-27 01:53:37,769 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 01:53:37,770 reid_baseline.train INFO: Accuracy: 71.7% Mean Entropy: 210.7%
2022-04-27 01:54:49,048 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.253, Acc: 0.810, Base Lr: 5.62e-03
2022-04-27 01:55:54,719 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.213, Acc: 0.821, Base Lr: 5.62e-03
Aug Cl acc: 0.1689796866951408
2022-04-27 01:56:44,830 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.685[s] Speed: 23.4[samples/s]
2022-04-27 01:57:51,236 reid_baseline.train INFO: normal accuracy 0.7276413606668168 1.9356341361999512 
2022-04-27 01:58:21,217 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 01:58:21,218 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 193.6%
2022-04-27 01:59:32,358 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.134, Acc: 0.843, Base Lr: 6.42e-03
2022-04-27 02:00:41,335 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.140, Acc: 0.838, Base Lr: 6.42e-03
Aug Cl acc: 0.16808999589074664
2022-04-27 02:01:27,909 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.684[s] Speed: 23.4[samples/s]
2022-04-27 02:02:34,834 reid_baseline.train INFO: normal accuracy 0.7409326424870466 1.8497904539108276 
2022-04-27 02:03:04,843 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 02:03:04,843 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 185.0%
2022-04-27 02:04:11,045 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.068, Acc: 0.850, Base Lr: 7.21e-03
2022-04-27 02:05:19,911 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.063, Acc: 0.855, Base Lr: 7.21e-03
Aug Cl acc: 0.16121018238556692
2022-04-27 02:06:08,819 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.674[s] Speed: 23.8[samples/s]
2022-04-27 02:07:16,319 reid_baseline.train INFO: normal accuracy 0.7449876098220319 1.7692070007324219 
2022-04-27 02:07:46,361 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 02:07:46,361 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 176.9%
2022-04-27 02:08:58,465 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.983, Acc: 0.880, Base Lr: 4.01e-03
2022-04-27 02:10:01,796 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.966, Acc: 0.887, Base Lr: 4.01e-03
Aug Cl acc: 0.18283415015363869
2022-04-27 02:10:49,746 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.672[s] Speed: 23.8[samples/s]
2022-04-27 02:12:25,801 reid_baseline.train INFO: normal accuracy 0.7463392656003605 1.821570634841919 
2022-04-27 02:12:25,806 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 02:12:25,806 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 182.2%
2022-04-27 02:13:31,859 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.937, Acc: 0.896, Base Lr: 3.38e-03
2022-04-27 02:14:42,845 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.947, Acc: 0.891, Base Lr: 3.38e-03
Aug Cl acc: 0.16988343458909255
2022-04-27 02:15:33,513 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.688[s] Speed: 23.3[samples/s]
2022-04-27 02:16:40,483 reid_baseline.train INFO: normal accuracy 0.7512953367875648 1.719892144203186 
2022-04-27 02:17:10,456 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 02:17:10,456 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 172.0%
2022-04-27 02:18:17,846 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.971, Acc: 0.883, Base Lr: 2.77e-03
2022-04-27 02:19:24,766 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.937, Acc: 0.898, Base Lr: 2.77e-03
Aug Cl acc: 0.1729068825969766
2022-04-27 02:20:16,554 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.682[s] Speed: 23.5[samples/s]
2022-04-27 02:21:21,255 reid_baseline.train INFO: normal accuracy 0.7594052714575354 1.7187585830688477 
2022-04-27 02:21:51,280 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 02:21:51,280 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 171.9%
2022-04-27 02:23:03,147 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.925, Acc: 0.896, Base Lr: 2.20e-03
2022-04-27 02:24:10,723 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.913, Acc: 0.901, Base Lr: 2.20e-03
Aug Cl acc: 0.17733891805013022
2022-04-27 02:24:58,260 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.684[s] Speed: 23.4[samples/s]
2022-04-27 02:26:03,564 reid_baseline.train INFO: normal accuracy 0.7643613426447398 1.7761564254760742 
2022-04-27 02:26:03,569 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 02:26:03,569 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 177.6%
2022-04-27 02:27:09,560 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.929, Acc: 0.890, Base Lr: 1.66e-03
2022-04-27 02:28:17,208 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.899, Acc: 0.906, Base Lr: 1.66e-03
Aug Cl acc: 0.1792142819135617
2022-04-27 02:29:07,412 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.673[s] Speed: 23.8[samples/s]
2022-04-27 02:30:11,698 reid_baseline.train INFO: normal accuracy 0.7623338589772471 1.7367662191390991 
2022-04-27 02:30:11,702 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 02:30:11,702 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 173.7%
2022-04-27 02:31:21,538 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.872, Acc: 0.920, Base Lr: 1.19e-03
2022-04-27 02:32:28,818 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.879, Acc: 0.915, Base Lr: 1.19e-03
Aug Cl acc: 0.1775265648251488
2022-04-27 02:33:16,786 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.678[s] Speed: 23.6[samples/s]
2022-04-27 02:34:22,365 reid_baseline.train INFO: normal accuracy 0.7639107907186303 1.7524549961090088 
2022-04-27 02:34:22,370 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 02:34:22,370 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 175.2%
2022-04-27 02:35:28,229 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.877, Acc: 0.916, Base Lr: 7.78e-04
2022-04-27 02:36:37,956 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.876, Acc: 0.916, Base Lr: 7.78e-04
Aug Cl acc: 0.17259779430571057
2022-04-27 02:37:27,086 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.676[s] Speed: 23.7[samples/s]
2022-04-27 02:38:31,700 reid_baseline.train INFO: normal accuracy 0.7672899301644515 1.728322982788086 
2022-04-27 02:38:31,704 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 02:38:31,705 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 172.8%
2022-04-27 02:39:40,563 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.869, Acc: 0.909, Base Lr: 4.51e-04
2022-04-27 02:40:48,623 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.861, Acc: 0.914, Base Lr: 4.51e-04
Aug Cl acc: 0.1882773179274339
2022-04-27 02:41:38,271 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.683[s] Speed: 23.4[samples/s]
2022-04-27 02:42:44,536 reid_baseline.train INFO: normal accuracy 0.7648118945708493 1.7362253665924072 
2022-04-27 02:42:44,541 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 02:42:44,541 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 173.6%
2022-04-27 02:43:54,154 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.845, Acc: 0.922, Base Lr: 2.11e-04
2022-04-27 02:44:59,567 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.849, Acc: 0.916, Base Lr: 2.11e-04
Aug Cl acc: 0.1994232205680875
2022-04-27 02:45:47,480 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.670[s] Speed: 23.9[samples/s]
2022-04-27 02:46:54,263 reid_baseline.train INFO: normal accuracy 0.7686415859427799 1.7308741807937622 
2022-04-27 02:46:54,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 02:46:54,268 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 173.1%
2022-04-27 02:48:04,157 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.842, Acc: 0.920, Base Lr: 6.51e-05
2022-04-27 02:49:08,215 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.859, Acc: 0.917, Base Lr: 6.51e-05
Aug Cl acc: 0.18297572712321858
2022-04-27 02:49:57,980 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.673[s] Speed: 23.8[samples/s]
2022-04-27 02:51:05,309 reid_baseline.train INFO: normal accuracy 0.7645866186077945 1.6949479579925537 
2022-04-27 02:51:35,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 02:51:35,323 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 169.5%
2022-04-27 02:52:45,730 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.843, Acc: 0.927, Base Lr: 1.60e-05
2022-04-27 02:53:52,414 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.855, Acc: 0.920, Base Lr: 1.60e-05
Aug Cl acc: 0.17132843632401126
2022-04-27 02:54:40,537 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.678[s] Speed: 23.6[samples/s]
2022-04-27 02:56:17,139 reid_baseline.train INFO: normal accuracy 0.7668393782383419 1.667020559310913 
2022-04-27 02:56:47,158 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 02:56:47,158 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 166.7%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-27 02:58:23,104 reid_baseline.train INFO: normal accuracy 0.7668393782383419 1.667020559310913 
2022-04-27 02:58:23,104 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 02:58:23,105 reid_baseline.train INFO: Accuracy: 76.7%
2022-04-27 02:59:27,812 reid_baseline.train INFO: normal accuracy 0.7668393782383419 1.667020559310913 
2022-04-27 02:59:27,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 02:59:27,813 reid_baseline.train INFO: Shuffled Accuracy: 76.7%
2022-04-27 03:00:32,721 reid_baseline.train INFO: normal accuracy 0.9489117983963344 0.8282385468482971 
2022-04-27 03:00:32,721 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 03:00:32,722 reid_baseline.train INFO: Source Clean Accuracy: 94.9%
2022-04-27 03:00:39,703 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4
2022-04-27 03:00:39,703 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-27 03:00:39,704 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 03:00:39,704 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 03:00:39,705 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 03:00:56,621 reid_baseline.train INFO: start training
2022-04-27 03:02:24,084 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.044, Acc: 0.236, Base Lr: 8.72e-04
2022-04-27 03:03:32,928 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.964, Acc: 0.339, Base Lr: 8.72e-04
Aug Cl acc: 0.1749006138616429
2022-04-27 03:04:22,075 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.743[s] Speed: 21.5[samples/s]
2022-04-27 03:06:37,089 reid_baseline.train INFO: normal accuracy 0.5549690153775534 4.168710231781006 
2022-04-27 03:07:07,067 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 03:07:07,068 reid_baseline.train INFO: Accuracy: 55.5% Mean Entropy: 416.9%
2022-04-27 03:08:18,093 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.591, Acc: 0.524, Base Lr: 1.66e-03
2022-04-27 03:09:21,872 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.446, Acc: 0.527, Base Lr: 1.66e-03
Aug Cl acc: 0.16763205056662087
2022-04-27 03:10:14,314 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.686[s] Speed: 23.3[samples/s]
2022-04-27 03:12:36,519 reid_baseline.train INFO: normal accuracy 0.5779205875602479 4.077602386474609 
2022-04-27 03:13:06,506 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 03:13:06,507 reid_baseline.train INFO: Accuracy: 57.8% Mean Entropy: 407.8%
2022-04-27 03:14:20,605 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.763, Acc: 0.569, Base Lr: 2.46e-03
2022-04-27 03:15:30,218 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.618, Acc: 0.579, Base Lr: 2.46e-03
Aug Cl acc: 0.17191193129990126
2022-04-27 03:16:19,609 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.707[s] Speed: 22.6[samples/s]
2022-04-27 03:18:43,525 reid_baseline.train INFO: normal accuracy 0.6396603167316961 3.559309720993042 
2022-04-27 03:19:13,529 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 03:19:13,530 reid_baseline.train INFO: Accuracy: 64.0% Mean Entropy: 355.9%
2022-04-27 03:20:22,332 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.009, Acc: 0.631, Base Lr: 3.25e-03
2022-04-27 03:21:31,186 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.901, Acc: 0.659, Base Lr: 3.25e-03
Aug Cl acc: 0.168924073159913
2022-04-27 03:22:19,558 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.681[s] Speed: 23.5[samples/s]
2022-04-27 03:24:31,364 reid_baseline.train INFO: normal accuracy 0.707137938948818 2.8410391807556152 
2022-04-27 03:25:01,384 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 03:25:01,384 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 284.1%
2022-04-27 03:26:14,023 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.583, Acc: 0.741, Base Lr: 4.04e-03
2022-04-27 03:27:24,134 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.541, Acc: 0.735, Base Lr: 4.04e-03
Aug Cl acc: 0.17381758916945683
2022-04-27 03:28:12,042 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.698[s] Speed: 22.9[samples/s]
2022-04-27 03:30:34,943 reid_baseline.train INFO: normal accuracy 0.7399586871700712 2.4401447772979736 
2022-04-27 03:31:04,938 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 03:31:04,938 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 244.0%
2022-04-27 03:32:14,616 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.350, Acc: 0.783, Base Lr: 4.83e-03
2022-04-27 03:33:22,891 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.341, Acc: 0.780, Base Lr: 4.83e-03
Aug Cl acc: 0.17137172545268858
2022-04-27 03:34:15,219 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.697[s] Speed: 23.0[samples/s]
2022-04-27 03:36:40,943 reid_baseline.train INFO: normal accuracy 0.7571723663070921 2.1603915691375732 
2022-04-27 03:37:10,959 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 03:37:10,960 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 216.0%
2022-04-27 03:38:27,472 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.253, Acc: 0.809, Base Lr: 5.62e-03
2022-04-27 03:39:28,532 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.213, Acc: 0.820, Base Lr: 5.62e-03
Aug Cl acc: 0.16920862442407852
2022-04-27 03:40:18,560 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.687[s] Speed: 23.3[samples/s]
2022-04-27 03:42:38,969 reid_baseline.train INFO: normal accuracy 0.7640578379619004 1.992730736732483 
2022-04-27 03:43:08,934 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 03:43:08,935 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 199.3%
2022-04-27 03:44:21,883 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.134, Acc: 0.843, Base Lr: 6.42e-03
2022-04-27 03:45:32,922 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.140, Acc: 0.838, Base Lr: 6.42e-03
Aug Cl acc: 0.16808999589074664
2022-04-27 03:46:24,570 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.716[s] Speed: 22.3[samples/s]
2022-04-27 03:48:37,818 reid_baseline.train INFO: normal accuracy 0.7727794353913243 1.8608394861221313 
2022-04-27 03:49:07,815 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 03:49:07,815 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 186.1%
2022-04-27 03:50:22,772 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.068, Acc: 0.850, Base Lr: 7.21e-03
2022-04-27 03:51:28,860 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.063, Acc: 0.855, Base Lr: 7.21e-03
Aug Cl acc: 0.16121018238556692
2022-04-27 03:52:21,237 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.708[s] Speed: 22.6[samples/s]
2022-04-27 03:54:41,584 reid_baseline.train INFO: normal accuracy 0.7773697498278632 1.7984161376953125 
2022-04-27 03:55:11,577 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 03:55:11,578 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 179.8%
2022-04-27 03:56:17,901 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.983, Acc: 0.880, Base Lr: 4.01e-03
2022-04-27 03:57:25,040 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.966, Acc: 0.887, Base Lr: 4.01e-03
Aug Cl acc: 0.18306308788257641
2022-04-27 03:58:14,092 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.669[s] Speed: 23.9[samples/s]
2022-04-27 04:01:04,644 reid_baseline.train INFO: normal accuracy 0.7808124856552674 1.8382396697998047 
2022-04-27 04:01:04,649 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 04:01:04,649 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 183.8%
2022-04-27 04:02:16,181 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.937, Acc: 0.896, Base Lr: 3.38e-03
2022-04-27 04:03:25,155 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.947, Acc: 0.891, Base Lr: 3.38e-03
Aug Cl acc: 0.16988343458909255
2022-04-27 04:04:15,232 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.698[s] Speed: 22.9[samples/s]
2022-04-27 04:06:40,794 reid_baseline.train INFO: normal accuracy 0.7821895799862291 1.7319555282592773 
2022-04-27 04:07:10,787 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 04:07:10,788 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 173.2%
2022-04-27 04:08:24,333 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.971, Acc: 0.882, Base Lr: 2.77e-03
2022-04-27 04:09:35,163 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.937, Acc: 0.898, Base Lr: 2.77e-03
Aug Cl acc: 0.17313582032591432
2022-04-27 04:10:26,104 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.715[s] Speed: 22.4[samples/s]
2022-04-27 04:12:46,222 reid_baseline.train INFO: normal accuracy 0.7842552214826716 1.7231836318969727 
2022-04-27 04:13:17,032 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 04:13:17,033 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 172.3%
2022-04-27 04:14:27,250 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.925, Acc: 0.896, Base Lr: 2.20e-03
2022-04-27 04:15:33,812 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.913, Acc: 0.901, Base Lr: 2.20e-03
Aug Cl acc: 0.17756785577906795
2022-04-27 04:16:24,843 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.688[s] Speed: 23.3[samples/s]
2022-04-27 04:18:46,032 reid_baseline.train INFO: normal accuracy 0.7849437686481524 1.7846561670303345 
2022-04-27 04:18:46,033 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 04:18:46,033 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 178.5%
2022-04-27 04:19:55,037 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.929, Acc: 0.890, Base Lr: 1.66e-03
2022-04-27 04:21:01,504 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.899, Acc: 0.906, Base Lr: 1.66e-03
Aug Cl acc: 0.17924699329194568
2022-04-27 04:21:50,990 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.677[s] Speed: 23.6[samples/s]
2022-04-27 04:24:09,307 reid_baseline.train INFO: normal accuracy 0.7860913472572871 1.7464457750320435 
2022-04-27 04:24:09,312 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 04:24:09,312 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 174.6%
2022-04-27 04:25:22,072 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.872, Acc: 0.920, Base Lr: 1.19e-03
2022-04-27 04:26:30,778 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.879, Acc: 0.914, Base Lr: 1.19e-03
Aug Cl acc: 0.1775265648251488
2022-04-27 04:27:21,394 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.704[s] Speed: 22.7[samples/s]
2022-04-27 04:29:42,568 reid_baseline.train INFO: normal accuracy 0.782419095708056 1.7581162452697754 
2022-04-27 04:29:42,570 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 04:29:42,570 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 175.8%
2022-04-27 04:30:50,946 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.877, Acc: 0.916, Base Lr: 7.78e-04
2022-04-27 04:32:03,663 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.876, Acc: 0.915, Base Lr: 7.78e-04
Aug Cl acc: 0.17231602371830643
2022-04-27 04:32:55,874 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.707[s] Speed: 22.6[samples/s]
2022-04-27 04:35:13,055 reid_baseline.train INFO: normal accuracy 0.786550378700941 1.7396756410598755 
2022-04-27 04:35:13,057 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 04:35:13,058 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 174.0%
2022-04-27 04:36:25,362 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.869, Acc: 0.909, Base Lr: 4.51e-04
2022-04-27 04:37:35,031 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.861, Acc: 0.914, Base Lr: 4.51e-04
Aug Cl acc: 0.18804838019849618
2022-04-27 04:38:26,160 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.707[s] Speed: 22.6[samples/s]
2022-04-27 04:40:25,146 reid_baseline.train INFO: normal accuracy 0.7863208629791141 1.7470111846923828 
2022-04-27 04:40:25,150 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 04:40:25,151 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 174.7%
2022-04-27 04:41:32,594 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.845, Acc: 0.922, Base Lr: 2.11e-04
2022-04-27 04:42:36,772 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.849, Acc: 0.917, Base Lr: 2.11e-04
Aug Cl acc: 0.19965215829702523
2022-04-27 04:43:23,540 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.653[s] Speed: 24.5[samples/s]
2022-04-27 04:45:22,822 reid_baseline.train INFO: normal accuracy 0.7876979573100757 1.7434892654418945 
2022-04-27 04:45:22,827 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 04:45:22,827 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 174.3%
2022-04-27 04:46:28,554 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.842, Acc: 0.920, Base Lr: 6.51e-05
2022-04-27 04:47:32,727 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.859, Acc: 0.917, Base Lr: 6.51e-05
Aug Cl acc: 0.1832046648521563
2022-04-27 04:48:20,926 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.652[s] Speed: 24.5[samples/s]
2022-04-27 04:50:19,252 reid_baseline.train INFO: normal accuracy 0.786550378700941 1.7123011350631714 
2022-04-27 04:50:49,214 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 04:50:49,215 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 171.2%
2022-04-27 04:51:56,056 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.843, Acc: 0.927, Base Lr: 1.60e-05
2022-04-27 04:53:02,188 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.855, Acc: 0.920, Base Lr: 1.60e-05
Aug Cl acc: 0.171557374052949
2022-04-27 04:53:43,691 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.639[s] Speed: 25.1[samples/s]
2022-04-27 04:55:55,518 reid_baseline.train INFO: normal accuracy 0.7879274730319027 1.6780368089675903 
2022-04-27 04:56:25,509 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 04:56:25,509 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 167.8%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-27 04:58:36,879 reid_baseline.train INFO: normal accuracy 0.7879274730319027 1.6780368089675903 
2022-04-27 04:58:36,879 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 04:58:36,879 reid_baseline.train INFO: Accuracy: 78.8%
2022-04-27 05:00:15,161 reid_baseline.train INFO: normal accuracy 0.7879274730319027 1.6780368089675903 
2022-04-27 05:00:15,161 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 05:00:15,161 reid_baseline.train INFO: Shuffled Accuracy: 78.8%
2022-04-27 05:01:19,675 reid_baseline.train INFO: normal accuracy 0.9491408934707903 0.8282119035720825 
2022-04-27 05:01:19,676 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 05:01:19,676 reid_baseline.train INFO: Source Clean Accuracy: 94.9%
2022-04-27 05:01:25,233 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5
2022-04-27 05:01:25,233 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-27 05:01:25,234 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 05:01:25,234 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 05:01:25,234 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 05:01:41,949 reid_baseline.train INFO: start training
2022-04-27 05:03:17,886 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.071, Acc: 0.239, Base Lr: 8.72e-04
2022-04-27 05:04:21,979 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.970, Acc: 0.349, Base Lr: 8.72e-04
Aug Cl acc: 0.18037740127507584
2022-04-27 05:05:06,213 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.725[s] Speed: 22.1[samples/s]
2022-04-27 05:05:45,916 reid_baseline.train INFO: normal accuracy 0.49361351462711167 4.169398784637451 
2022-04-27 05:06:15,940 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 05:06:15,941 reid_baseline.train INFO: Accuracy: 49.4% Mean Entropy: 416.9%
2022-04-27 05:07:22,543 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.584, Acc: 0.546, Base Lr: 1.66e-03
2022-04-27 05:08:24,340 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.439, Acc: 0.550, Base Lr: 1.66e-03
Aug Cl acc: 0.16980517041552198
2022-04-27 05:09:13,574 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.651[s] Speed: 24.6[samples/s]
2022-04-27 05:09:50,307 reid_baseline.train INFO: normal accuracy 0.5150391429748661 4.094681262969971 
2022-04-27 05:10:20,261 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 05:10:20,261 reid_baseline.train INFO: Accuracy: 51.5% Mean Entropy: 409.5%
2022-04-27 05:10:59,938 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.779, Acc: 0.581, Base Lr: 2.46e-03
2022-04-27 05:11:40,451 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.619, Acc: 0.586, Base Lr: 2.46e-03
Aug Cl acc: 0.16655985514322916
2022-04-27 05:12:11,122 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.406[s] Speed: 39.4[samples/s]
2022-04-27 05:12:40,754 reid_baseline.train INFO: normal accuracy 0.5842604037906881 3.683149576187134 
2022-04-27 05:13:10,714 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 05:13:10,715 reid_baseline.train INFO: Accuracy: 58.4% Mean Entropy: 368.3%
2022-04-27 05:13:51,229 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.991, Acc: 0.647, Base Lr: 3.25e-03
2022-04-27 05:14:31,596 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.892, Acc: 0.673, Base Lr: 3.25e-03
Aug Cl acc: 0.17445985563508756
2022-04-27 05:15:02,301 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.409[s] Speed: 39.2[samples/s]
2022-04-27 05:15:33,476 reid_baseline.train INFO: normal accuracy 0.6526576019777504 3.0585598945617676 
2022-04-27 05:16:03,448 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 05:16:03,449 reid_baseline.train INFO: Accuracy: 65.3% Mean Entropy: 305.9%
2022-04-27 05:16:30,964 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.586, Acc: 0.745, Base Lr: 4.04e-03
2022-04-27 05:16:52,782 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.545, Acc: 0.741, Base Lr: 4.04e-03
Aug Cl acc: 0.1682997762938559
2022-04-27 05:17:08,706 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.239[s] Speed: 67.0[samples/s]
2022-04-27 05:17:35,676 reid_baseline.train INFO: normal accuracy 0.6880922950144212 2.6683144569396973 
2022-04-27 05:18:05,636 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 05:18:05,637 reid_baseline.train INFO: Accuracy: 68.8% Mean Entropy: 266.8%
2022-04-27 05:18:28,921 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.357, Acc: 0.792, Base Lr: 4.83e-03
2022-04-27 05:18:51,243 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.345, Acc: 0.784, Base Lr: 4.83e-03
Aug Cl acc: 0.16806822556715745
2022-04-27 05:19:07,080 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.225[s] Speed: 71.1[samples/s]
2022-04-27 05:19:34,638 reid_baseline.train INFO: normal accuracy 0.6988051091882983 2.4213368892669678 
2022-04-27 05:20:04,593 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 05:20:04,593 reid_baseline.train INFO: Accuracy: 69.9% Mean Entropy: 242.1%
2022-04-27 05:20:28,286 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.249, Acc: 0.808, Base Lr: 5.62e-03
2022-04-27 05:20:50,022 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.214, Acc: 0.823, Base Lr: 5.62e-03
Aug Cl acc: 0.16556477808690334
2022-04-27 05:21:05,707 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.223[s] Speed: 71.6[samples/s]
2022-04-27 05:21:33,944 reid_baseline.train INFO: normal accuracy 0.7128141738772147 2.238624334335327 
2022-04-27 05:22:03,912 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 05:22:03,912 reid_baseline.train INFO: Accuracy: 71.3% Mean Entropy: 223.9%
2022-04-27 05:22:28,368 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.134, Acc: 0.841, Base Lr: 6.42e-03
2022-04-27 05:22:50,053 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.132, Acc: 0.837, Base Lr: 6.42e-03
Aug Cl acc: 0.1726111806792654
2022-04-27 05:23:06,141 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.228[s] Speed: 70.3[samples/s]
2022-04-27 05:23:32,913 reid_baseline.train INFO: normal accuracy 0.7297074577667902 2.1214208602905273 
2022-04-27 05:24:02,867 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 05:24:02,868 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 212.1%
2022-04-27 05:24:26,432 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.070, Acc: 0.855, Base Lr: 7.21e-03
2022-04-27 05:24:48,216 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.068, Acc: 0.858, Base Lr: 7.21e-03
Aug Cl acc: 0.17203270210014596
2022-04-27 05:25:04,335 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.225[s] Speed: 71.1[samples/s]
2022-04-27 05:25:31,506 reid_baseline.train INFO: normal accuracy 0.7198187062216729 2.0570881366729736 
2022-04-27 05:26:01,460 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 05:26:01,460 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 205.7%
2022-04-27 05:26:24,829 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.991, Acc: 0.881, Base Lr: 4.01e-03
2022-04-27 05:26:46,354 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.971, Acc: 0.889, Base Lr: 4.01e-03
Aug Cl acc: 0.18136885925963686
2022-04-27 05:27:01,792 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.220[s] Speed: 72.6[samples/s]
2022-04-27 05:27:59,367 reid_baseline.train INFO: normal accuracy 0.7292954264524104 2.027740955352783 
2022-04-27 05:28:29,319 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 05:28:29,320 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 202.8%
2022-04-27 05:28:52,635 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.931, Acc: 0.900, Base Lr: 3.38e-03
2022-04-27 05:29:14,424 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.950, Acc: 0.894, Base Lr: 3.38e-03
Aug Cl acc: 0.171238769978394
2022-04-27 05:29:30,381 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.224[s] Speed: 71.5[samples/s]
2022-04-27 05:29:57,298 reid_baseline.train INFO: normal accuracy 0.7317676143386898 1.9352879524230957 
2022-04-27 05:30:27,251 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 05:30:27,251 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 193.5%
2022-04-27 05:30:51,421 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.974, Acc: 0.884, Base Lr: 2.77e-03
2022-04-27 05:31:13,214 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.938, Acc: 0.899, Base Lr: 2.77e-03
Aug Cl acc: 0.16820802793398007
2022-04-27 05:31:29,384 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.227[s] Speed: 70.3[samples/s]
2022-04-27 05:31:56,652 reid_baseline.train INFO: normal accuracy 0.7313555830243098 1.9127922058105469 
2022-04-27 05:32:26,621 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 05:32:26,621 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 191.3%
2022-04-27 05:32:50,428 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.934, Acc: 0.894, Base Lr: 2.20e-03
2022-04-27 05:33:12,278 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.915, Acc: 0.902, Base Lr: 2.20e-03
Aug Cl acc: 0.16367035471039376
2022-04-27 05:33:27,097 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.221[s] Speed: 72.2[samples/s]
2022-04-27 05:33:55,045 reid_baseline.train INFO: normal accuracy 0.7280593325092707 1.9541043043136597 
2022-04-27 05:33:55,046 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 05:33:55,046 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 195.4%
2022-04-27 05:34:18,598 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.917, Acc: 0.898, Base Lr: 1.66e-03
2022-04-27 05:34:40,069 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.894, Acc: 0.907, Base Lr: 1.66e-03
Aug Cl acc: 0.1805034679370922
2022-04-27 05:34:56,129 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.223[s] Speed: 71.6[samples/s]
2022-04-27 05:35:23,331 reid_baseline.train INFO: normal accuracy 0.7354758961681088 1.9427225589752197 
2022-04-27 05:35:23,331 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 05:35:23,331 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 194.3%
2022-04-27 05:35:46,475 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.868, Acc: 0.913, Base Lr: 1.19e-03
2022-04-27 05:36:08,172 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.876, Acc: 0.910, Base Lr: 1.19e-03
Aug Cl acc: 0.1780580793108259
2022-04-27 05:36:24,152 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.223[s] Speed: 71.8[samples/s]
2022-04-27 05:36:53,118 reid_baseline.train INFO: normal accuracy 0.734651833539349 1.9567428827285767 
2022-04-27 05:36:53,119 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 05:36:53,119 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 195.7%
2022-04-27 05:37:16,305 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.881, Acc: 0.920, Base Lr: 7.78e-04
2022-04-27 05:37:38,038 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.878, Acc: 0.917, Base Lr: 7.78e-04
Aug Cl acc: 0.17013676961263022
2022-04-27 05:37:53,832 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.222[s] Speed: 72.0[samples/s]
2022-04-27 05:38:21,073 reid_baseline.train INFO: normal accuracy 0.7379480840543882 1.9191875457763672 
2022-04-27 05:38:21,074 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 05:38:21,074 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 191.9%
2022-04-27 05:38:44,542 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.874, Acc: 0.907, Base Lr: 4.51e-04
2022-04-27 05:39:06,165 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.873, Acc: 0.909, Base Lr: 4.51e-04
Aug Cl acc: 0.18275862473707932
2022-04-27 05:39:22,820 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-27 05:39:49,683 reid_baseline.train INFO: normal accuracy 0.7367119901112484 1.9314043521881104 
2022-04-27 05:39:49,684 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 05:39:49,684 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 193.1%
2022-04-27 05:40:12,937 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.855, Acc: 0.915, Base Lr: 2.11e-04
2022-04-27 05:40:34,505 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.850, Acc: 0.918, Base Lr: 2.11e-04
Aug Cl acc: 0.1784129160227793
2022-04-27 05:40:50,175 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.222[s] Speed: 72.2[samples/s]
2022-04-27 05:41:18,713 reid_baseline.train INFO: normal accuracy 0.7325916769674495 1.9087789058685303 
2022-04-27 05:41:48,662 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 05:41:48,662 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 190.9%
2022-04-27 05:42:11,657 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.844, Acc: 0.924, Base Lr: 6.51e-05
2022-04-27 05:42:33,127 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.859, Acc: 0.916, Base Lr: 6.51e-05
Aug Cl acc: 0.18357056837815505
2022-04-27 05:42:48,941 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-27 05:43:16,040 reid_baseline.train INFO: normal accuracy 0.7330037082818294 1.902119755744934 
2022-04-27 05:43:45,994 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 05:43:45,995 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 190.2%
2022-04-27 05:44:09,639 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.837, Acc: 0.923, Base Lr: 1.60e-05
2022-04-27 05:44:31,728 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.847, Acc: 0.921, Base Lr: 1.60e-05
Aug Cl acc: 0.17607693794446114
2022-04-27 05:44:47,790 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.226[s] Speed: 70.7[samples/s]
2022-04-27 05:45:45,116 reid_baseline.train INFO: normal accuracy 0.7375360527400082 1.8658491373062134 
2022-04-27 05:46:15,070 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 05:46:15,070 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 186.6%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-27 05:47:12,162 reid_baseline.train INFO: normal accuracy 0.7375360527400082 1.8658491373062134 
2022-04-27 05:47:12,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 05:47:12,162 reid_baseline.train INFO: Accuracy: 73.8%
2022-04-27 05:47:39,385 reid_baseline.train INFO: normal accuracy 0.7375360527400082 1.8658491373062134 
2022-04-27 05:47:39,385 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 05:47:39,385 reid_baseline.train INFO: Shuffled Accuracy: 73.8%
2022-04-27 05:48:14,043 reid_baseline.train INFO: normal accuracy 0.9505154639175257 0.8353509902954102 
2022-04-27 05:48:14,044 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 05:48:14,044 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
2022-04-27 05:48:19,320 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5
2022-04-27 05:48:19,320 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-27 05:48:19,320 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 05:48:19,320 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 05:48:19,320 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 05:48:28,704 reid_baseline.train INFO: start training
2022-04-27 05:49:01,760 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.071, Acc: 0.238, Base Lr: 8.72e-04
2022-04-27 05:49:23,482 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.970, Acc: 0.349, Base Lr: 8.72e-04
Aug Cl acc: 0.18037740127507584
2022-04-27 05:49:39,151 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.255[s] Speed: 62.8[samples/s]
2022-04-27 05:50:15,183 reid_baseline.train INFO: normal accuracy 0.5453931065555305 4.1681342124938965 
2022-04-27 05:50:45,121 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 05:50:45,122 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 416.8%
2022-04-27 05:51:09,347 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.584, Acc: 0.547, Base Lr: 1.66e-03
2022-04-27 05:51:30,861 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.439, Acc: 0.551, Base Lr: 1.66e-03
Aug Cl acc: 0.1702630598466475
2022-04-27 05:51:47,706 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-27 05:52:23,446 reid_baseline.train INFO: normal accuracy 0.5670195990087857 4.066127300262451 
2022-04-27 05:52:53,414 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 05:52:53,415 reid_baseline.train INFO: Accuracy: 56.7% Mean Entropy: 406.6%
2022-04-27 05:53:17,714 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.779, Acc: 0.581, Base Lr: 2.46e-03
2022-04-27 05:53:40,041 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.619, Acc: 0.586, Base Lr: 2.46e-03
Aug Cl acc: 0.1662982200091575
2022-04-27 05:53:56,297 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.230[s] Speed: 69.5[samples/s]
2022-04-27 05:54:31,368 reid_baseline.train INFO: normal accuracy 0.6152286551025006 3.5182290077209473 
2022-04-27 05:55:01,321 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 05:55:01,322 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 351.8%
2022-04-27 05:55:25,195 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.991, Acc: 0.647, Base Lr: 3.25e-03
2022-04-27 05:55:46,800 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.892, Acc: 0.673, Base Lr: 3.25e-03
Aug Cl acc: 0.17445985563508756
2022-04-27 05:56:02,841 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.225[s] Speed: 71.0[samples/s]
2022-04-27 05:56:37,438 reid_baseline.train INFO: normal accuracy 0.6832619959450327 2.806037425994873 
2022-04-27 05:57:07,392 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 05:57:07,392 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 280.6%
2022-04-27 05:57:31,201 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.586, Acc: 0.745, Base Lr: 4.04e-03
2022-04-27 05:57:52,831 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.545, Acc: 0.742, Base Lr: 4.04e-03
Aug Cl acc: 0.1678419008359804
2022-04-27 05:58:08,632 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.224[s] Speed: 71.5[samples/s]
2022-04-27 05:58:43,495 reid_baseline.train INFO: normal accuracy 0.7042126605091237 2.364828109741211 
2022-04-27 05:59:13,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 05:59:13,466 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 236.5%
2022-04-27 05:59:37,009 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.357, Acc: 0.791, Base Lr: 4.83e-03
2022-04-27 05:59:59,275 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.345, Acc: 0.784, Base Lr: 4.83e-03
Aug Cl acc: 0.16783928783821972
2022-04-27 06:00:15,294 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.226[s] Speed: 70.7[samples/s]
2022-04-27 06:00:52,297 reid_baseline.train INFO: normal accuracy 0.7240369452579409 2.1231391429901123 
2022-04-27 06:01:22,257 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 06:01:22,258 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 212.3%
2022-04-27 06:01:45,714 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.249, Acc: 0.808, Base Lr: 5.62e-03
2022-04-27 06:02:07,152 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.214, Acc: 0.823, Base Lr: 5.62e-03
Aug Cl acc: 0.1653358403579656
2022-04-27 06:02:22,856 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.222[s] Speed: 72.1[samples/s]
2022-04-27 06:02:58,453 reid_baseline.train INFO: normal accuracy 0.7413831944131561 1.9595272541046143 
2022-04-27 06:03:28,413 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 06:03:28,414 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 196.0%
2022-04-27 06:03:52,752 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.134, Acc: 0.841, Base Lr: 6.42e-03
2022-04-27 06:04:14,344 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.132, Acc: 0.838, Base Lr: 6.42e-03
Aug Cl acc: 0.1726111806792654
2022-04-27 06:04:30,333 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.226[s] Speed: 70.6[samples/s]
2022-04-27 06:05:04,315 reid_baseline.train INFO: normal accuracy 0.7434106780806488 1.883205771446228 
2022-04-27 06:05:34,287 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 06:05:34,288 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 188.3%
2022-04-27 06:05:57,777 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.070, Acc: 0.855, Base Lr: 7.21e-03
2022-04-27 06:06:19,241 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.068, Acc: 0.858, Base Lr: 7.21e-03
Aug Cl acc: 0.1715748266422705
2022-04-27 06:06:35,136 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.223[s] Speed: 71.8[samples/s]
2022-04-27 06:07:09,235 reid_baseline.train INFO: normal accuracy 0.7490425771570174 1.8201724290847778 
2022-04-27 06:07:39,190 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 06:07:39,190 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 182.0%
2022-04-27 06:08:02,389 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.992, Acc: 0.882, Base Lr: 4.01e-03
2022-04-27 06:08:23,718 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.972, Acc: 0.890, Base Lr: 4.01e-03
Aug Cl acc: 0.1806820320995736
2022-04-27 06:08:39,266 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.220[s] Speed: 72.7[samples/s]
2022-04-27 06:09:43,625 reid_baseline.train INFO: normal accuracy 0.7515206127506195 1.8116687536239624 
2022-04-27 06:10:13,599 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 06:10:13,600 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 181.2%
2022-04-27 06:10:36,999 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.931, Acc: 0.901, Base Lr: 3.38e-03
2022-04-27 06:10:58,685 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.950, Acc: 0.895, Base Lr: 3.38e-03
Aug Cl acc: 0.17166393405788546
2022-04-27 06:11:14,687 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.223[s] Speed: 71.7[samples/s]
2022-04-27 06:11:49,044 reid_baseline.train INFO: normal accuracy 0.759855823383645 1.7246859073638916 
2022-04-27 06:12:18,998 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 06:12:18,998 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 172.5%
2022-04-27 06:12:43,144 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.974, Acc: 0.883, Base Lr: 2.77e-03
2022-04-27 06:13:04,794 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.938, Acc: 0.899, Base Lr: 2.77e-03
Aug Cl acc: 0.16811644725310496
2022-04-27 06:13:20,789 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.226[s] Speed: 70.7[samples/s]
2022-04-27 06:13:55,215 reid_baseline.train INFO: normal accuracy 0.7600810993466998 1.7296632528305054 
2022-04-27 06:13:55,216 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 06:13:55,216 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 173.0%
2022-04-27 06:14:18,927 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.935, Acc: 0.894, Base Lr: 2.20e-03
2022-04-27 06:14:40,721 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.915, Acc: 0.902, Base Lr: 2.20e-03
Aug Cl acc: 0.1630598634153932
2022-04-27 06:14:55,569 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-27 06:15:31,394 reid_baseline.train INFO: normal accuracy 0.7621085830141924 1.7712665796279907 
2022-04-27 06:15:31,395 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 06:15:31,395 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 177.1%
2022-04-27 06:15:54,388 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.917, Acc: 0.898, Base Lr: 1.66e-03
2022-04-27 06:16:15,617 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.894, Acc: 0.907, Base Lr: 1.66e-03
Aug Cl acc: 0.17976382189181261
2022-04-27 06:16:31,542 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.220[s] Speed: 72.7[samples/s]
2022-04-27 06:17:06,053 reid_baseline.train INFO: normal accuracy 0.7621085830141924 1.7560980319976807 
2022-04-27 06:17:06,053 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 06:17:06,054 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 175.6%
2022-04-27 06:17:29,264 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.868, Acc: 0.913, Base Lr: 1.19e-03
2022-04-27 06:17:50,590 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.876, Acc: 0.910, Base Lr: 1.19e-03
Aug Cl acc: 0.17920276795551454
2022-04-27 06:18:06,353 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.220[s] Speed: 72.7[samples/s]
2022-04-27 06:18:40,493 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.7790935039520264 
2022-04-27 06:18:40,493 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 06:18:40,493 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 177.9%
2022-04-27 06:19:03,427 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.881, Acc: 0.919, Base Lr: 7.78e-04
2022-04-27 06:19:24,785 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.878, Acc: 0.917, Base Lr: 7.78e-04
Aug Cl acc: 0.17122685079609518
2022-04-27 06:19:40,520 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.220[s] Speed: 72.8[samples/s]
2022-04-27 06:20:13,543 reid_baseline.train INFO: normal accuracy 0.7648118945708493 1.7453628778457642 
2022-04-27 06:20:13,543 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 06:20:13,543 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 174.5%
2022-04-27 06:20:36,730 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.874, Acc: 0.908, Base Lr: 4.51e-04
2022-04-27 06:20:58,046 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.873, Acc: 0.909, Base Lr: 4.51e-04
Aug Cl acc: 0.182987548492767
2022-04-27 06:21:14,287 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.222[s] Speed: 71.9[samples/s]
2022-04-27 06:21:47,979 reid_baseline.train INFO: normal accuracy 0.7634602387925208 1.7574751377105713 
2022-04-27 06:21:47,979 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 06:21:47,979 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 175.7%
2022-04-27 06:22:11,065 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.855, Acc: 0.915, Base Lr: 2.11e-04
2022-04-27 06:22:32,139 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.851, Acc: 0.918, Base Lr: 2.11e-04
Aug Cl acc: 0.17818399226709164
2022-04-27 06:22:47,428 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.217[s] Speed: 73.7[samples/s]
2022-04-27 06:23:21,554 reid_baseline.train INFO: normal accuracy 0.7666141022752873 1.7447177171707153 
2022-04-27 06:23:21,555 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 06:23:21,555 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 174.5%
2022-04-27 06:23:44,338 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.844, Acc: 0.925, Base Lr: 6.51e-05
2022-04-27 06:24:05,601 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.860, Acc: 0.916, Base Lr: 6.51e-05
Aug Cl acc: 0.18305984608856313
2022-04-27 06:24:21,274 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.218[s] Speed: 73.3[samples/s]
2022-04-27 06:24:55,020 reid_baseline.train INFO: normal accuracy 0.7641360666816851 1.7177467346191406 
2022-04-27 06:25:24,973 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 06:25:24,974 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 171.8%
2022-04-27 06:25:48,032 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.837, Acc: 0.924, Base Lr: 1.60e-05
2022-04-27 06:26:09,712 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.847, Acc: 0.922, Base Lr: 1.60e-05
Aug Cl acc: 0.1765348134023366
2022-04-27 06:26:25,626 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.222[s] Speed: 72.0[samples/s]
2022-04-27 06:27:28,818 reid_baseline.train INFO: normal accuracy 0.7639107907186303 1.6897978782653809 
2022-04-27 06:27:58,780 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 06:27:58,780 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 169.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-27 06:29:03,623 reid_baseline.train INFO: normal accuracy 0.7639107907186303 1.6897978782653809 
2022-04-27 06:29:03,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 06:29:03,624 reid_baseline.train INFO: Accuracy: 76.4%
2022-04-27 06:29:37,315 reid_baseline.train INFO: normal accuracy 0.7639107907186303 1.6897978782653809 
2022-04-27 06:29:37,315 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 06:29:37,315 reid_baseline.train INFO: Shuffled Accuracy: 76.4%
2022-04-27 06:30:11,280 reid_baseline.train INFO: normal accuracy 0.9505154639175257 0.8351472616195679 
2022-04-27 06:30:11,281 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 06:30:11,281 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
2022-04-27 06:30:16,503 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5
2022-04-27 06:30:16,503 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-27 06:30:16,504 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 06:30:16,504 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 06:30:16,505 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 06:30:27,438 reid_baseline.train INFO: start training
2022-04-27 06:30:59,221 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.071, Acc: 0.239, Base Lr: 8.72e-04
2022-04-27 06:31:20,573 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.970, Acc: 0.348, Base Lr: 8.72e-04
Aug Cl acc: 0.18037740127507584
2022-04-27 06:31:35,848 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.248[s] Speed: 64.5[samples/s]
2022-04-27 06:33:00,559 reid_baseline.train INFO: normal accuracy 0.5616249713105348 4.168971538543701 
2022-04-27 06:33:30,498 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 06:33:30,499 reid_baseline.train INFO: Accuracy: 56.2% Mean Entropy: 416.9%
2022-04-27 06:33:54,486 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.584, Acc: 0.547, Base Lr: 1.66e-03
2022-04-27 06:34:15,447 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.439, Acc: 0.550, Base Lr: 1.66e-03
Aug Cl acc: 0.1702630598466475
2022-04-27 06:34:32,293 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.226[s] Speed: 70.7[samples/s]
2022-04-27 06:35:59,363 reid_baseline.train INFO: normal accuracy 0.5873307321551526 4.079861164093018 
2022-04-27 06:36:29,344 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 06:36:29,344 reid_baseline.train INFO: Accuracy: 58.7% Mean Entropy: 408.0%
2022-04-27 06:36:53,277 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.779, Acc: 0.581, Base Lr: 2.46e-03
2022-04-27 06:37:14,729 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.619, Acc: 0.586, Base Lr: 2.46e-03
Aug Cl acc: 0.16655985514322916
2022-04-27 06:37:30,678 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.224[s] Speed: 71.4[samples/s]
2022-04-27 06:38:57,763 reid_baseline.train INFO: normal accuracy 0.6431030525591003 3.569756031036377 
2022-04-27 06:39:27,718 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 06:39:27,719 reid_baseline.train INFO: Accuracy: 64.3% Mean Entropy: 357.0%
2022-04-27 06:39:50,834 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.991, Acc: 0.647, Base Lr: 3.25e-03
2022-04-27 06:40:11,818 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.892, Acc: 0.673, Base Lr: 3.25e-03
Aug Cl acc: 0.17445985563508756
2022-04-27 06:40:27,393 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.218[s] Speed: 73.3[samples/s]
2022-04-27 06:41:49,787 reid_baseline.train INFO: normal accuracy 0.7082855175579528 2.851778030395508 
2022-04-27 06:42:19,739 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 06:42:19,740 reid_baseline.train INFO: Accuracy: 70.8% Mean Entropy: 285.2%
2022-04-27 06:42:42,779 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.586, Acc: 0.745, Base Lr: 4.04e-03
2022-04-27 06:43:04,036 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.545, Acc: 0.742, Base Lr: 4.04e-03
Aug Cl acc: 0.1678419008359804
2022-04-27 06:43:19,653 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.219[s] Speed: 73.1[samples/s]
2022-04-27 06:44:45,930 reid_baseline.train INFO: normal accuracy 0.7417948129446867 2.4161064624786377 
2022-04-27 06:45:15,910 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 06:45:15,910 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 241.6%
2022-04-27 06:45:38,901 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.357, Acc: 0.793, Base Lr: 4.83e-03
2022-04-27 06:46:00,532 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.345, Acc: 0.784, Base Lr: 4.83e-03
Aug Cl acc: 0.16783928783821972
2022-04-27 06:46:16,299 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-27 06:47:48,570 reid_baseline.train INFO: normal accuracy 0.7587789763598807 2.1731009483337402 
2022-04-27 06:48:18,526 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 06:48:18,526 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 217.3%
2022-04-27 06:48:42,009 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.249, Acc: 0.808, Base Lr: 5.62e-03
2022-04-27 06:49:03,175 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.214, Acc: 0.823, Base Lr: 5.62e-03
Aug Cl acc: 0.1653358403579656
2022-04-27 06:49:18,489 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.219[s] Speed: 73.1[samples/s]
2022-04-27 06:50:42,090 reid_baseline.train INFO: normal accuracy 0.7693366995639201 2.0063962936401367 
2022-04-27 06:51:12,041 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 06:51:12,042 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 200.6%
2022-04-27 06:51:36,122 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.134, Acc: 0.841, Base Lr: 6.42e-03
2022-04-27 06:51:57,450 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.132, Acc: 0.837, Base Lr: 6.42e-03
Aug Cl acc: 0.17284011840820312
2022-04-27 06:52:13,174 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.224[s] Speed: 71.5[samples/s]
2022-04-27 06:53:35,176 reid_baseline.train INFO: normal accuracy 0.7734679825568052 1.9046435356140137 
2022-04-27 06:54:05,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 06:54:05,142 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 190.5%
2022-04-27 06:54:28,747 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.070, Acc: 0.855, Base Lr: 7.21e-03
2022-04-27 06:54:49,781 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.068, Acc: 0.858, Base Lr: 7.21e-03
Aug Cl acc: 0.17203270210014596
2022-04-27 06:55:05,562 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.221[s] Speed: 72.3[samples/s]
2022-04-27 06:56:30,867 reid_baseline.train INFO: normal accuracy 0.7819600642644021 1.8434092998504639 
2022-04-27 06:57:00,819 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 06:57:00,820 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 184.3%
2022-04-27 06:57:23,911 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.992, Acc: 0.882, Base Lr: 4.01e-03
2022-04-27 06:57:45,163 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.972, Acc: 0.890, Base Lr: 4.01e-03
Aug Cl acc: 0.1806820320995736
2022-04-27 06:58:00,319 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.218[s] Speed: 73.6[samples/s]
2022-04-27 06:59:53,779 reid_baseline.train INFO: normal accuracy 0.7792058756024788 1.8329665660858154 
2022-04-27 07:00:23,732 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 07:00:23,732 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 183.3%
2022-04-27 07:00:47,159 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.931, Acc: 0.901, Base Lr: 3.38e-03
2022-04-27 07:01:08,406 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.950, Acc: 0.895, Base Lr: 3.38e-03
Aug Cl acc: 0.17166393405788546
2022-04-27 07:01:24,129 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.221[s] Speed: 72.4[samples/s]
2022-04-27 07:02:51,770 reid_baseline.train INFO: normal accuracy 0.7844847372044985 1.740972638130188 
2022-04-27 07:03:21,737 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 07:03:21,738 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 174.1%
2022-04-27 07:03:45,940 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.974, Acc: 0.883, Base Lr: 2.77e-03
2022-04-27 07:04:07,336 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.938, Acc: 0.899, Base Lr: 2.77e-03
Aug Cl acc: 0.16834538498204268
2022-04-27 07:04:23,114 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.224[s] Speed: 71.3[samples/s]
2022-04-27 07:05:49,679 reid_baseline.train INFO: normal accuracy 0.7837961900390177 1.7342647314071655 
2022-04-27 07:06:19,635 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 07:06:19,635 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 173.4%
2022-04-27 07:06:43,356 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.935, Acc: 0.894, Base Lr: 2.20e-03
2022-04-27 07:07:04,821 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.915, Acc: 0.902, Base Lr: 2.20e-03
Aug Cl acc: 0.16351773887326865
2022-04-27 07:07:19,462 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.217[s] Speed: 73.6[samples/s]
2022-04-27 07:08:47,161 reid_baseline.train INFO: normal accuracy 0.7844847372044985 1.7798430919647217 
2022-04-27 07:08:47,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 07:08:47,162 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 178.0%
2022-04-27 07:09:10,444 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.917, Acc: 0.898, Base Lr: 1.66e-03
2022-04-27 07:09:31,600 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.894, Acc: 0.907, Base Lr: 1.66e-03
Aug Cl acc: 0.18004559247921675
2022-04-27 07:09:47,456 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.220[s] Speed: 72.6[samples/s]
2022-04-27 07:11:10,936 reid_baseline.train INFO: normal accuracy 0.7874684415882488 1.7666255235671997 
2022-04-27 07:11:10,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 07:11:10,937 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 176.7%
2022-04-27 07:11:34,412 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.868, Acc: 0.913, Base Lr: 1.19e-03
2022-04-27 07:11:55,620 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.876, Acc: 0.910, Base Lr: 1.19e-03
Aug Cl acc: 0.1789738302265768
2022-04-27 07:12:11,223 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-27 07:13:35,954 reid_baseline.train INFO: normal accuracy 0.7870094101445949 1.7906824350357056 
2022-04-27 07:13:35,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 07:13:35,955 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 179.1%
2022-04-27 07:13:58,758 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.881, Acc: 0.919, Base Lr: 7.78e-04
2022-04-27 07:14:19,939 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.878, Acc: 0.917, Base Lr: 7.78e-04
Aug Cl acc: 0.17076897533821972
2022-04-27 07:14:35,596 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.218[s] Speed: 73.3[samples/s]
2022-04-27 07:15:57,700 reid_baseline.train INFO: normal accuracy 0.7911406931374799 1.7491309642791748 
2022-04-27 07:15:57,701 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 07:15:57,701 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 174.9%
2022-04-27 07:16:21,617 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.874, Acc: 0.908, Base Lr: 4.51e-04
2022-04-27 07:16:42,751 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.873, Acc: 0.910, Base Lr: 4.51e-04
Aug Cl acc: 0.18275861076382927
2022-04-27 07:16:58,907 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.224[s] Speed: 71.5[samples/s]
2022-04-27 07:18:25,579 reid_baseline.train INFO: normal accuracy 0.786779894422768 1.7640694379806519 
2022-04-27 07:18:25,580 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 07:18:25,580 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 176.4%
2022-04-27 07:18:48,745 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.855, Acc: 0.915, Base Lr: 2.11e-04
2022-04-27 07:19:09,647 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.851, Acc: 0.918, Base Lr: 2.11e-04
Aug Cl acc: 0.17818399226709164
2022-04-27 07:19:24,931 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.217[s] Speed: 73.7[samples/s]
2022-04-27 07:20:49,765 reid_baseline.train INFO: normal accuracy 0.7929768189120955 1.7517601251602173 
2022-04-27 07:20:49,766 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 07:20:49,766 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 175.2%
2022-04-27 07:21:13,696 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.844, Acc: 0.925, Base Lr: 6.51e-05
2022-04-27 07:21:34,906 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.860, Acc: 0.916, Base Lr: 6.51e-05
Aug Cl acc: 0.1832887977907509
2022-04-27 07:21:50,693 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.222[s] Speed: 72.0[samples/s]
2022-04-27 07:23:13,661 reid_baseline.train INFO: normal accuracy 0.7895340830846913 1.7293972969055176 
2022-04-27 07:23:43,617 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 07:23:43,618 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 172.9%
2022-04-27 07:24:07,006 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.837, Acc: 0.923, Base Lr: 1.60e-05
2022-04-27 07:24:28,581 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.847, Acc: 0.921, Base Lr: 1.60e-05
Aug Cl acc: 0.1765348134023366
2022-04-27 07:24:44,361 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.222[s] Speed: 72.0[samples/s]
2022-04-27 07:26:41,262 reid_baseline.train INFO: normal accuracy 0.7922882717466146 1.6954830884933472 
2022-04-27 07:27:11,217 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 07:27:11,217 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 169.5%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-27 07:29:05,039 reid_baseline.train INFO: normal accuracy 0.7922882717466146 1.6954830884933472 
2022-04-27 07:29:05,039 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 07:29:05,039 reid_baseline.train INFO: Accuracy: 79.2%
2022-04-27 07:30:28,119 reid_baseline.train INFO: normal accuracy 0.7922882717466146 1.6954830884933472 
2022-04-27 07:30:28,119 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 07:30:28,119 reid_baseline.train INFO: Shuffled Accuracy: 79.2%
2022-04-27 07:31:02,073 reid_baseline.train INFO: normal accuracy 0.9505154639175257 0.8351551294326782 
2022-04-27 07:31:02,074 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 07:31:02,074 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
2022-04-27 07:31:07,782 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6
2022-04-27 07:31:07,782 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-27 07:31:07,782 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 07:31:07,783 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 07:31:07,783 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 07:31:18,875 reid_baseline.train INFO: start training
2022-04-27 07:31:51,490 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.056, Acc: 0.225, Base Lr: 8.72e-04
2022-04-27 07:32:12,616 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.949, Acc: 0.334, Base Lr: 8.72e-04
Aug Cl acc: 0.18135896619859632
2022-04-27 07:32:27,912 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.251[s] Speed: 63.8[samples/s]
2022-04-27 07:32:53,957 reid_baseline.train INFO: normal accuracy 0.47713226205191595 4.168735027313232 
2022-04-27 07:33:23,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 07:33:23,895 reid_baseline.train INFO: Accuracy: 47.7% Mean Entropy: 416.9%
2022-04-27 07:33:47,716 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.562, Acc: 0.520, Base Lr: 1.66e-03
2022-04-27 07:34:08,725 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.418, Acc: 0.526, Base Lr: 1.66e-03
Aug Cl acc: 0.15758937793773609
2022-04-27 07:34:25,808 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.227[s] Speed: 70.6[samples/s]
2022-04-27 07:34:53,660 reid_baseline.train INFO: normal accuracy 0.5010300782859497 4.081207275390625 
2022-04-27 07:35:23,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 07:35:23,625 reid_baseline.train INFO: Accuracy: 50.1% Mean Entropy: 408.1%
2022-04-27 07:35:47,806 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.741, Acc: 0.569, Base Lr: 2.46e-03
2022-04-27 07:36:09,532 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.602, Acc: 0.576, Base Lr: 2.46e-03
Aug Cl acc: 0.17286972772507442
2022-04-27 07:36:25,445 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-27 07:36:51,865 reid_baseline.train INFO: normal accuracy 0.5793160280181294 3.6747732162475586 
2022-04-27 07:37:21,813 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 07:37:21,814 reid_baseline.train INFO: Accuracy: 57.9% Mean Entropy: 367.5%
2022-04-27 07:37:44,787 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.007, Acc: 0.636, Base Lr: 3.25e-03
2022-04-27 07:38:05,768 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.919, Acc: 0.668, Base Lr: 3.25e-03
Aug Cl acc: 0.17034041575896433
2022-04-27 07:38:21,377 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.218[s] Speed: 73.4[samples/s]
2022-04-27 07:38:48,366 reid_baseline.train INFO: normal accuracy 0.6456530696332922 3.0846753120422363 
2022-04-27 07:39:18,311 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 07:39:18,312 reid_baseline.train INFO: Accuracy: 64.6% Mean Entropy: 308.5%
2022-04-27 07:39:41,359 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.601, Acc: 0.730, Base Lr: 4.04e-03
2022-04-27 07:40:02,628 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.553, Acc: 0.729, Base Lr: 4.04e-03
Aug Cl acc: 0.17579315520904876
2022-04-27 07:40:18,243 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.219[s] Speed: 73.1[samples/s]
2022-04-27 07:40:44,734 reid_baseline.train INFO: normal accuracy 0.6823238566131026 2.719550609588623 
2022-04-27 07:41:14,711 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 07:41:14,711 reid_baseline.train INFO: Accuracy: 68.2% Mean Entropy: 272.0%
2022-04-27 07:41:37,896 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.358, Acc: 0.776, Base Lr: 4.83e-03
2022-04-27 07:41:59,571 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.353, Acc: 0.775, Base Lr: 4.83e-03
Aug Cl acc: 0.17375311659369277
2022-04-27 07:42:15,228 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.221[s] Speed: 72.4[samples/s]
2022-04-27 07:42:42,304 reid_baseline.train INFO: normal accuracy 0.7041615162752369 2.458221673965454 
2022-04-27 07:43:12,259 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 07:43:12,259 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 245.8%
2022-04-27 07:43:35,622 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.261, Acc: 0.803, Base Lr: 5.62e-03
2022-04-27 07:43:56,800 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.231, Acc: 0.817, Base Lr: 5.62e-03
Aug Cl acc: 0.1699003142751617
2022-04-27 07:44:12,049 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.218[s] Speed: 73.3[samples/s]
2022-04-27 07:44:39,995 reid_baseline.train INFO: normal accuracy 0.7091058920477956 2.261107921600342 
2022-04-27 07:45:09,940 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 07:45:09,940 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 226.1%
2022-04-27 07:45:33,804 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.158, Acc: 0.835, Base Lr: 6.42e-03
2022-04-27 07:45:55,069 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.152, Acc: 0.833, Base Lr: 6.42e-03
Aug Cl acc: 0.16931680532602164
2022-04-27 07:46:10,624 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.222[s] Speed: 72.0[samples/s]
2022-04-27 07:46:36,694 reid_baseline.train INFO: normal accuracy 0.7206427688504327 2.145871639251709 
2022-04-27 07:47:06,661 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 07:47:06,661 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 214.6%
2022-04-27 07:47:29,583 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.071, Acc: 0.853, Base Lr: 7.21e-03
2022-04-27 07:47:50,678 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.060, Acc: 0.856, Base Lr: 7.21e-03
Aug Cl acc: 0.16983763027540494
2022-04-27 07:48:06,344 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.218[s] Speed: 73.3[samples/s]
2022-04-27 07:48:32,871 reid_baseline.train INFO: normal accuracy 0.7264112072517511 2.069019079208374 
2022-04-27 07:49:02,815 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 07:49:02,816 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 206.9%
2022-04-27 07:49:25,611 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.994, Acc: 0.872, Base Lr: 4.01e-03
2022-04-27 07:49:46,848 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.981, Acc: 0.885, Base Lr: 4.01e-03
Aug Cl acc: 0.1752463120680589
2022-04-27 07:50:02,072 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.217[s] Speed: 73.8[samples/s]
2022-04-27 07:50:58,850 reid_baseline.train INFO: normal accuracy 0.7321796456530696 2.045330286026001 
2022-04-27 07:51:28,820 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 07:51:28,821 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 204.5%
2022-04-27 07:51:51,683 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.942, Acc: 0.903, Base Lr: 3.38e-03
2022-04-27 07:52:13,160 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.962, Acc: 0.894, Base Lr: 3.38e-03
Aug Cl acc: 0.16885093716911345
2022-04-27 07:52:28,851 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.220[s] Speed: 72.8[samples/s]
2022-04-27 07:52:55,171 reid_baseline.train INFO: normal accuracy 0.738360115368768 1.9603348970413208 
2022-04-27 07:53:25,117 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 07:53:25,118 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 196.0%
2022-04-27 07:53:48,504 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.979, Acc: 0.880, Base Lr: 2.77e-03
2022-04-27 07:54:09,817 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.938, Acc: 0.898, Base Lr: 2.77e-03
Aug Cl acc: 0.17951917822981056
2022-04-27 07:54:25,708 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.222[s] Speed: 72.1[samples/s]
2022-04-27 07:54:52,011 reid_baseline.train INFO: normal accuracy 0.7342398022249691 1.9606388807296753 
2022-04-27 07:54:52,011 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 07:54:52,011 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 196.1%
2022-04-27 07:55:15,067 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.938, Acc: 0.892, Base Lr: 2.20e-03
2022-04-27 07:55:36,442 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.920, Acc: 0.902, Base Lr: 2.20e-03
Aug Cl acc: 0.17289190327291523
2022-04-27 07:55:50,998 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.216[s] Speed: 74.1[samples/s]
2022-04-27 07:56:18,411 reid_baseline.train INFO: normal accuracy 0.73094355170993 1.9891189336776733 
2022-04-27 07:56:18,412 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 07:56:18,412 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 198.9%
2022-04-27 07:56:41,268 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.911, Acc: 0.897, Base Lr: 1.66e-03
2022-04-27 07:57:02,267 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.894, Acc: 0.907, Base Lr: 1.66e-03
Aug Cl acc: 0.18043790544782365
2022-04-27 07:57:18,140 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.219[s] Speed: 73.1[samples/s]
2022-04-27 07:57:45,262 reid_baseline.train INFO: normal accuracy 0.7338277709105891 1.9589167833328247 
2022-04-27 07:58:15,214 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 07:58:15,215 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 195.9%
2022-04-27 07:58:38,032 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.881, Acc: 0.916, Base Lr: 1.19e-03
2022-04-27 07:58:59,053 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.884, Acc: 0.912, Base Lr: 1.19e-03
Aug Cl acc: 0.17342886732611465
2022-04-27 07:59:14,754 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.218[s] Speed: 73.5[samples/s]
2022-04-27 07:59:43,267 reid_baseline.train INFO: normal accuracy 0.7342398022249691 1.9602116346359253 
2022-04-27 07:59:43,268 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 07:59:43,268 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 196.0%
2022-04-27 08:00:06,234 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.887, Acc: 0.918, Base Lr: 7.78e-04
2022-04-27 08:00:27,566 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.880, Acc: 0.917, Base Lr: 7.78e-04
Aug Cl acc: 0.1715118631775126
2022-04-27 08:00:43,012 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.218[s] Speed: 73.2[samples/s]
2022-04-27 08:01:09,333 reid_baseline.train INFO: normal accuracy 0.7375360527400082 1.937904715538025 
2022-04-27 08:01:39,308 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 08:01:39,308 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 193.8%
2022-04-27 08:02:02,425 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.874, Acc: 0.910, Base Lr: 4.51e-04
2022-04-27 08:02:23,484 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.876, Acc: 0.909, Base Lr: 4.51e-04
Aug Cl acc: 0.172310546204284
2022-04-27 08:02:39,534 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-27 08:03:05,857 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.9526671171188354 
2022-04-27 08:03:05,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 08:03:05,857 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 195.3%
2022-04-27 08:03:28,650 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.852, Acc: 0.919, Base Lr: 2.11e-04
2022-04-27 08:03:49,383 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.856, Acc: 0.920, Base Lr: 2.11e-04
Aug Cl acc: 0.18040326576093177
2022-04-27 08:04:04,517 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.214[s] Speed: 74.6[samples/s]
2022-04-27 08:04:32,220 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.9260146617889404 
2022-04-27 08:05:02,170 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 08:05:02,171 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 192.6%
2022-04-27 08:05:25,270 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.853, Acc: 0.917, Base Lr: 6.51e-05
2022-04-27 08:05:46,440 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.865, Acc: 0.913, Base Lr: 6.51e-05
Aug Cl acc: 0.19150026202638507
2022-04-27 08:06:01,894 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.218[s] Speed: 73.2[samples/s]
2022-04-27 08:06:28,359 reid_baseline.train INFO: normal accuracy 0.7379480840543882 1.9154973030090332 
2022-04-27 08:06:58,306 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 08:06:58,306 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 191.5%
2022-04-27 08:07:21,251 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.834, Acc: 0.930, Base Lr: 1.60e-05
2022-04-27 08:07:42,863 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.845, Acc: 0.924, Base Lr: 1.60e-05
Aug Cl acc: 0.19707469451121795
2022-04-27 08:07:58,617 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-27 08:08:55,247 reid_baseline.train INFO: normal accuracy 0.7391841779975278 1.8729476928710938 
2022-04-27 08:09:25,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 08:09:25,202 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 187.3%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-27 08:10:21,848 reid_baseline.train INFO: normal accuracy 0.7391841779975278 1.8729476928710938 
2022-04-27 08:10:21,849 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 08:10:21,849 reid_baseline.train INFO: Accuracy: 73.9%
2022-04-27 08:10:48,298 reid_baseline.train INFO: normal accuracy 0.7391841779975278 1.8729476928710938 
2022-04-27 08:10:48,299 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 08:10:48,299 reid_baseline.train INFO: Shuffled Accuracy: 73.9%
2022-04-27 08:11:22,320 reid_baseline.train INFO: normal accuracy 0.9491408934707903 0.826745331287384 
2022-04-27 08:11:22,320 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 08:11:22,321 reid_baseline.train INFO: Source Clean Accuracy: 94.9%
2022-04-27 08:11:27,731 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6
2022-04-27 08:11:27,731 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-27 08:11:27,731 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 08:11:27,731 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 08:11:27,732 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 08:11:37,517 reid_baseline.train INFO: start training
2022-04-27 08:12:10,753 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.056, Acc: 0.225, Base Lr: 8.72e-04
2022-04-27 08:12:32,016 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.949, Acc: 0.334, Base Lr: 8.72e-04
Aug Cl acc: 0.18135896619859632
2022-04-27 08:12:47,659 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.255[s] Speed: 62.8[samples/s]
2022-04-27 08:13:22,734 reid_baseline.train INFO: normal accuracy 0.5244424419914395 4.167121410369873 
2022-04-27 08:13:52,677 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 08:13:52,677 reid_baseline.train INFO: Accuracy: 52.4% Mean Entropy: 416.7%
2022-04-27 08:14:16,481 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.562, Acc: 0.520, Base Lr: 1.66e-03
2022-04-27 08:14:37,722 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.418, Acc: 0.526, Base Lr: 1.66e-03
Aug Cl acc: 0.15736044020879836
2022-04-27 08:14:54,424 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-27 08:15:29,313 reid_baseline.train INFO: normal accuracy 0.5553052489299392 4.044690132141113 
2022-04-27 08:15:59,278 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 08:15:59,278 reid_baseline.train INFO: Accuracy: 55.5% Mean Entropy: 404.5%
2022-04-27 08:16:23,334 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.741, Acc: 0.569, Base Lr: 2.46e-03
2022-04-27 08:16:45,295 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.602, Acc: 0.576, Base Lr: 2.46e-03
Aug Cl acc: 0.17309866545401215
2022-04-27 08:17:01,392 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.227[s] Speed: 70.4[samples/s]
2022-04-27 08:17:36,276 reid_baseline.train INFO: normal accuracy 0.6071187204325299 3.489405870437622 
2022-04-27 08:18:06,220 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 08:18:06,221 reid_baseline.train INFO: Accuracy: 60.7% Mean Entropy: 348.9%
2022-04-27 08:18:29,451 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.007, Acc: 0.636, Base Lr: 3.25e-03
2022-04-27 08:18:50,685 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.919, Acc: 0.668, Base Lr: 3.25e-03
Aug Cl acc: 0.1701114780300266
2022-04-27 08:19:06,418 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.220[s] Speed: 72.7[samples/s]
2022-04-27 08:19:40,267 reid_baseline.train INFO: normal accuracy 0.6697454381617481 2.804112672805786 
2022-04-27 08:20:10,216 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 08:20:10,216 reid_baseline.train INFO: Accuracy: 67.0% Mean Entropy: 280.4%
2022-04-27 08:20:33,666 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.601, Acc: 0.730, Base Lr: 4.04e-03
2022-04-27 08:20:54,868 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.553, Acc: 0.729, Base Lr: 4.04e-03
Aug Cl acc: 0.17602209293798649
2022-04-27 08:21:10,640 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.220[s] Speed: 72.7[samples/s]
2022-04-27 08:21:44,766 reid_baseline.train INFO: normal accuracy 0.7008335210633025 2.39731764793396 
2022-04-27 08:22:14,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 08:22:14,730 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 239.7%
2022-04-27 08:22:37,979 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.358, Acc: 0.777, Base Lr: 4.83e-03
2022-04-27 08:22:59,849 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.353, Acc: 0.775, Base Lr: 4.83e-03
Aug Cl acc: 0.1739820543226305
2022-04-27 08:23:15,697 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.223[s] Speed: 71.7[samples/s]
2022-04-27 08:23:52,597 reid_baseline.train INFO: normal accuracy 0.7175039423293534 2.159015417098999 
2022-04-27 08:24:22,544 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 08:24:22,544 reid_baseline.train INFO: Accuracy: 71.8% Mean Entropy: 215.9%
2022-04-27 08:24:45,812 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.261, Acc: 0.803, Base Lr: 5.62e-03
2022-04-27 08:25:07,117 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.230, Acc: 0.817, Base Lr: 5.62e-03
Aug Cl acc: 0.1699003142751617
2022-04-27 08:25:22,472 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.219[s] Speed: 72.9[samples/s]
2022-04-27 08:25:57,843 reid_baseline.train INFO: normal accuracy 0.738004054967335 1.9748194217681885 
2022-04-27 08:26:27,802 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 08:26:27,802 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 197.5%
2022-04-27 08:26:52,074 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.158, Acc: 0.835, Base Lr: 6.42e-03
2022-04-27 08:27:13,316 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.152, Acc: 0.833, Base Lr: 6.42e-03
Aug Cl acc: 0.16954574305495937
2022-04-27 08:27:29,119 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.224[s] Speed: 71.4[samples/s]
2022-04-27 08:28:02,494 reid_baseline.train INFO: normal accuracy 0.7429601261545393 1.8939297199249268 
2022-04-27 08:28:32,457 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 08:28:32,458 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 189.4%
2022-04-27 08:28:55,504 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.071, Acc: 0.853, Base Lr: 7.21e-03
2022-04-27 08:29:16,601 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.060, Acc: 0.855, Base Lr: 7.21e-03
Aug Cl acc: 0.17006656800434267
2022-04-27 08:29:32,351 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.219[s] Speed: 72.9[samples/s]
2022-04-27 08:30:06,063 reid_baseline.train INFO: normal accuracy 0.7470150934895247 1.8139489889144897 
2022-04-27 08:30:36,015 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 08:30:36,015 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 181.4%
2022-04-27 08:30:58,797 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.994, Acc: 0.872, Base Lr: 4.01e-03
2022-04-27 08:31:20,468 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.981, Acc: 0.885, Base Lr: 4.01e-03
Aug Cl acc: 0.17547524979699664
2022-04-27 08:31:35,722 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.219[s] Speed: 73.2[samples/s]
2022-04-27 08:32:39,750 reid_baseline.train INFO: normal accuracy 0.7546744762333859 1.8304340839385986 
2022-04-27 08:32:39,750 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 08:32:39,751 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 183.0%
2022-04-27 08:33:02,862 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.942, Acc: 0.903, Base Lr: 3.38e-03
2022-04-27 08:33:24,283 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.962, Acc: 0.894, Base Lr: 3.38e-03
Aug Cl acc: 0.1686219994401757
2022-04-27 08:33:40,115 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.221[s] Speed: 72.4[samples/s]
2022-04-27 08:34:14,113 reid_baseline.train INFO: normal accuracy 0.7605316512728092 1.7665929794311523 
2022-04-27 08:34:44,088 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 08:34:44,089 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 176.7%
2022-04-27 08:35:07,795 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.979, Acc: 0.880, Base Lr: 2.77e-03
2022-04-27 08:35:29,048 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.938, Acc: 0.898, Base Lr: 2.77e-03
Aug Cl acc: 0.17929024050087283
2022-04-27 08:35:45,014 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.223[s] Speed: 71.8[samples/s]
2022-04-27 08:36:18,779 reid_baseline.train INFO: normal accuracy 0.760756927235864 1.7591947317123413 
2022-04-27 08:36:48,736 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 08:36:48,737 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 175.9%
2022-04-27 08:37:12,059 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.938, Acc: 0.892, Base Lr: 2.20e-03
2022-04-27 08:37:33,547 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.920, Acc: 0.902, Base Lr: 2.20e-03
Aug Cl acc: 0.17289190327291523
2022-04-27 08:37:48,286 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.218[s] Speed: 73.4[samples/s]
2022-04-27 08:38:24,665 reid_baseline.train INFO: normal accuracy 0.7645866186077945 1.8027417659759521 
2022-04-27 08:38:24,665 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 08:38:24,666 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 180.3%
2022-04-27 08:38:47,851 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.911, Acc: 0.897, Base Lr: 1.66e-03
2022-04-27 08:39:09,076 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.894, Acc: 0.907, Base Lr: 1.66e-03
Aug Cl acc: 0.18043790544782365
2022-04-27 08:39:24,869 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.220[s] Speed: 72.7[samples/s]
2022-04-27 08:39:59,418 reid_baseline.train INFO: normal accuracy 0.765938274386123 1.7758228778839111 
2022-04-27 08:39:59,418 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 08:39:59,419 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 177.6%
2022-04-27 08:40:22,584 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.881, Acc: 0.916, Base Lr: 1.19e-03
2022-04-27 08:40:43,981 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.884, Acc: 0.913, Base Lr: 1.19e-03
Aug Cl acc: 0.17291815900977278
2022-04-27 08:40:59,653 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.220[s] Speed: 72.6[samples/s]
2022-04-27 08:41:34,182 reid_baseline.train INFO: normal accuracy 0.7643613426447398 1.786198377609253 
2022-04-27 08:41:34,182 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 08:41:34,182 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 178.6%
2022-04-27 08:41:57,017 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.887, Acc: 0.918, Base Lr: 7.78e-04
2022-04-27 08:42:18,592 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.880, Acc: 0.917, Base Lr: 7.78e-04
Aug Cl acc: 0.17105398771963715
2022-04-27 08:42:34,235 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.220[s] Speed: 72.7[samples/s]
2022-04-27 08:43:07,432 reid_baseline.train INFO: normal accuracy 0.7706690696102726 1.761906385421753 
2022-04-27 08:43:07,433 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 08:43:07,433 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 176.2%
2022-04-27 08:43:30,746 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.874, Acc: 0.910, Base Lr: 4.51e-04
2022-04-27 08:43:52,004 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.876, Acc: 0.909, Base Lr: 4.51e-04
Aug Cl acc: 0.1716237330174708
2022-04-27 08:44:08,314 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.223[s] Speed: 71.8[samples/s]
2022-04-27 08:44:42,302 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.7818353176116943 
2022-04-27 08:44:42,302 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 08:44:42,303 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 178.2%
2022-04-27 08:45:05,463 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.852, Acc: 0.919, Base Lr: 2.11e-04
2022-04-27 08:45:26,567 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.856, Acc: 0.920, Base Lr: 2.11e-04
Aug Cl acc: 0.18007026923881783
2022-04-27 08:45:41,941 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.218[s] Speed: 73.5[samples/s]
2022-04-27 08:46:16,327 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.7651387453079224 
2022-04-27 08:46:16,327 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 08:46:16,327 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 176.5%
2022-04-27 08:46:39,054 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.853, Acc: 0.917, Base Lr: 6.51e-05
2022-04-27 08:47:00,452 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.865, Acc: 0.913, Base Lr: 6.51e-05
Aug Cl acc: 0.19113396724938472
2022-04-27 08:47:16,135 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.219[s] Speed: 73.0[samples/s]
2022-04-27 08:47:50,083 reid_baseline.train INFO: normal accuracy 0.7661635503491777 1.736859917640686 
2022-04-27 08:48:20,029 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 08:48:20,030 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 173.7%
2022-04-27 08:48:43,208 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.834, Acc: 0.930, Base Lr: 1.60e-05
2022-04-27 08:49:04,934 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.845, Acc: 0.924, Base Lr: 1.60e-05
Aug Cl acc: 0.19707469451121795
2022-04-27 08:49:20,725 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.222[s] Speed: 72.1[samples/s]
2022-04-27 08:50:24,008 reid_baseline.train INFO: normal accuracy 0.7681910340166704 1.699586272239685 
2022-04-27 08:50:53,954 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 08:50:53,955 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 170.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-27 08:51:58,232 reid_baseline.train INFO: normal accuracy 0.7681910340166704 1.699586272239685 
2022-04-27 08:51:58,233 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 08:51:58,233 reid_baseline.train INFO: Accuracy: 76.8%
2022-04-27 08:52:31,752 reid_baseline.train INFO: normal accuracy 0.7681910340166704 1.699586272239685 
2022-04-27 08:52:31,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 08:52:31,752 reid_baseline.train INFO: Shuffled Accuracy: 76.8%
2022-04-27 08:53:06,087 reid_baseline.train INFO: normal accuracy 0.9489117983963344 0.8266720175743103 
2022-04-27 08:53:06,088 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 08:53:06,088 reid_baseline.train INFO: Source Clean Accuracy: 94.9%
2022-04-27 08:53:11,441 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6
2022-04-27 08:53:11,442 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-27 08:53:11,442 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-27 08:53:11,442 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-27 08:53:11,442 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-27 08:53:21,492 reid_baseline.train INFO: start training
2022-04-27 08:53:54,575 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.056, Acc: 0.225, Base Lr: 8.72e-04
2022-04-27 08:54:16,028 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.949, Acc: 0.334, Base Lr: 8.72e-04
Aug Cl acc: 0.18135896619859632
2022-04-27 08:54:31,654 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.253[s] Speed: 63.1[samples/s]
2022-04-27 08:55:56,229 reid_baseline.train INFO: normal accuracy 0.5370667890750517 4.168224334716797 
2022-04-27 08:56:26,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-27 08:56:26,156 reid_baseline.train INFO: Accuracy: 53.7% Mean Entropy: 416.8%
2022-04-27 08:56:50,135 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.562, Acc: 0.520, Base Lr: 1.66e-03
2022-04-27 08:57:11,402 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.418, Acc: 0.526, Base Lr: 1.66e-03
Aug Cl acc: 0.15758937793773609
2022-04-27 08:57:28,448 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-27 08:58:55,680 reid_baseline.train INFO: normal accuracy 0.5646086756942851 4.063310623168945 
2022-04-27 08:59:25,645 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-27 08:59:25,646 reid_baseline.train INFO: Accuracy: 56.5% Mean Entropy: 406.3%
2022-04-27 08:59:49,906 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.741, Acc: 0.569, Base Lr: 2.46e-03
2022-04-27 09:00:11,917 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.602, Acc: 0.576, Base Lr: 2.46e-03
Aug Cl acc: 0.17332760318294987
2022-04-27 09:00:27,945 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.228[s] Speed: 70.3[samples/s]
2022-04-27 09:01:55,450 reid_baseline.train INFO: normal accuracy 0.6281845306403488 3.5507829189300537 
2022-04-27 09:02:25,398 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-27 09:02:25,399 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 355.1%
2022-04-27 09:02:48,680 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.007, Acc: 0.636, Base Lr: 3.25e-03
2022-04-27 09:03:10,010 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.919, Acc: 0.668, Base Lr: 3.25e-03
Aug Cl acc: 0.1701114780300266
2022-04-27 09:03:25,791 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.221[s] Speed: 72.3[samples/s]
2022-04-27 09:04:47,499 reid_baseline.train INFO: normal accuracy 0.7020885930686253 2.879958391189575 
2022-04-27 09:05:17,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-27 09:05:17,455 reid_baseline.train INFO: Accuracy: 70.2% Mean Entropy: 288.0%
2022-04-27 09:05:40,685 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.601, Acc: 0.730, Base Lr: 4.04e-03
2022-04-27 09:06:01,958 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.553, Acc: 0.729, Base Lr: 4.04e-03
Aug Cl acc: 0.17602209293798649
2022-04-27 09:06:17,787 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-27 09:07:44,610 reid_baseline.train INFO: normal accuracy 0.7328436997934359 2.476733684539795 
2022-04-27 09:08:14,563 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-27 09:08:14,564 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 247.7%
2022-04-27 09:08:37,954 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.358, Acc: 0.777, Base Lr: 4.83e-03
2022-04-27 09:09:00,039 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.353, Acc: 0.775, Base Lr: 4.83e-03
Aug Cl acc: 0.17375311659369277
2022-04-27 09:09:15,756 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.224[s] Speed: 71.4[samples/s]
2022-04-27 09:10:47,902 reid_baseline.train INFO: normal accuracy 0.7523525361487262 2.2230122089385986 
2022-04-27 09:11:17,869 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-27 09:11:17,869 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 222.3%
2022-04-27 09:11:41,082 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.261, Acc: 0.803, Base Lr: 5.62e-03
2022-04-27 09:12:02,395 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.230, Acc: 0.817, Base Lr: 5.62e-03
Aug Cl acc: 0.1699003142751617
2022-04-27 09:12:17,794 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.219[s] Speed: 72.9[samples/s]
2022-04-27 09:13:42,032 reid_baseline.train INFO: normal accuracy 0.7645168694055543 2.0382792949676514 
2022-04-27 09:14:11,981 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-27 09:14:11,982 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 203.8%
2022-04-27 09:14:36,116 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.158, Acc: 0.835, Base Lr: 6.42e-03
2022-04-27 09:14:57,624 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.152, Acc: 0.833, Base Lr: 6.42e-03
Aug Cl acc: 0.1698275136423635
2022-04-27 09:15:13,522 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.225[s] Speed: 71.2[samples/s]
2022-04-27 09:16:36,176 reid_baseline.train INFO: normal accuracy 0.769795731007574 1.9366658926010132 
2022-04-27 09:17:06,125 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-27 09:17:06,125 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 193.7%
2022-04-27 09:17:29,372 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.071, Acc: 0.853, Base Lr: 7.21e-03
2022-04-27 09:17:50,684 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.060, Acc: 0.856, Base Lr: 7.21e-03
Aug Cl acc: 0.16983763027540494
2022-04-27 09:18:06,396 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.220[s] Speed: 72.7[samples/s]
2022-04-27 09:19:31,636 reid_baseline.train INFO: normal accuracy 0.7693366995639201 1.8595789670944214 
2022-04-27 09:20:01,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-27 09:20:01,598 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 186.0%
2022-04-27 09:20:24,424 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.994, Acc: 0.872, Base Lr: 4.01e-03
2022-04-27 09:20:45,772 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.981, Acc: 0.885, Base Lr: 4.01e-03
Aug Cl acc: 0.1752463120680589
2022-04-27 09:21:01,061 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.217[s] Speed: 73.6[samples/s]
2022-04-27 09:22:54,542 reid_baseline.train INFO: normal accuracy 0.7753041083314207 1.8589987754821777 
2022-04-27 09:23:24,490 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-27 09:23:24,490 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 185.9%
2022-04-27 09:23:47,455 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.942, Acc: 0.902, Base Lr: 3.38e-03
2022-04-27 09:24:08,854 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.962, Acc: 0.893, Base Lr: 3.38e-03
Aug Cl acc: 0.1686219994401757
2022-04-27 09:24:24,695 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.220[s] Speed: 72.7[samples/s]
2022-04-27 09:25:52,586 reid_baseline.train INFO: normal accuracy 0.7748450768877668 1.794046401977539 
2022-04-27 09:26:22,549 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-27 09:26:22,550 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 179.4%
2022-04-27 09:26:46,414 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.979, Acc: 0.880, Base Lr: 2.77e-03
2022-04-27 09:27:07,885 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.938, Acc: 0.898, Base Lr: 2.77e-03
Aug Cl acc: 0.17929024050087283
2022-04-27 09:27:23,695 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.224[s] Speed: 71.5[samples/s]
2022-04-27 09:28:50,900 reid_baseline.train INFO: normal accuracy 0.7769107183842093 1.7891175746917725 
2022-04-27 09:29:20,850 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-27 09:29:20,851 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 178.9%
2022-04-27 09:29:44,342 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.938, Acc: 0.892, Base Lr: 2.20e-03
2022-04-27 09:30:05,721 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.920, Acc: 0.902, Base Lr: 2.20e-03
Aug Cl acc: 0.17289190327291523
2022-04-27 09:30:20,548 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.218[s] Speed: 73.4[samples/s]
2022-04-27 09:31:48,245 reid_baseline.train INFO: normal accuracy 0.7748450768877668 1.8265002965927124 
2022-04-27 09:31:48,245 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-27 09:31:48,246 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 182.7%
2022-04-27 09:32:11,200 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.911, Acc: 0.897, Base Lr: 1.66e-03
2022-04-27 09:32:32,281 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.894, Acc: 0.907, Base Lr: 1.66e-03
Aug Cl acc: 0.18069954058189533
2022-04-27 09:32:48,071 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.219[s] Speed: 73.1[samples/s]
2022-04-27 09:34:11,987 reid_baseline.train INFO: normal accuracy 0.7757631397750746 1.794514536857605 
2022-04-27 09:34:11,988 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-27 09:34:11,988 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 179.5%
2022-04-27 09:34:35,338 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.881, Acc: 0.916, Base Lr: 1.19e-03
2022-04-27 09:34:56,625 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.884, Acc: 0.912, Base Lr: 1.19e-03
Aug Cl acc: 0.1731470967387105
2022-04-27 09:35:12,588 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.221[s] Speed: 72.3[samples/s]
2022-04-27 09:36:38,362 reid_baseline.train INFO: normal accuracy 0.7771402341060363 1.8053267002105713 
2022-04-27 09:36:38,363 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-27 09:36:38,363 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 180.5%
2022-04-27 09:37:01,308 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.887, Acc: 0.918, Base Lr: 7.78e-04
2022-04-27 09:37:22,711 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.880, Acc: 0.917, Base Lr: 7.78e-04
Aug Cl acc: 0.17105398771963715
2022-04-27 09:37:38,279 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.219[s] Speed: 72.9[samples/s]
2022-04-27 09:39:01,053 reid_baseline.train INFO: normal accuracy 0.7808124856552674 1.7797784805297852 
2022-04-27 09:39:31,002 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-27 09:39:31,002 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 178.0%
2022-04-27 09:39:54,365 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.874, Acc: 0.910, Base Lr: 4.51e-04
2022-04-27 09:40:15,717 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.876, Acc: 0.909, Base Lr: 4.51e-04
Aug Cl acc: 0.17185267074640853
2022-04-27 09:40:32,055 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.223[s] Speed: 71.6[samples/s]
2022-04-27 09:41:58,419 reid_baseline.train INFO: normal accuracy 0.7801239384897866 1.799099087715149 
2022-04-27 09:41:58,420 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-27 09:41:58,420 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 179.9%
2022-04-27 09:42:21,449 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.852, Acc: 0.919, Base Lr: 2.11e-04
2022-04-27 09:42:42,482 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.856, Acc: 0.920, Base Lr: 2.11e-04
Aug Cl acc: 0.1797039744618175
2022-04-27 09:42:57,796 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.217[s] Speed: 73.6[samples/s]
2022-04-27 09:44:21,724 reid_baseline.train INFO: normal accuracy 0.7805829699334405 1.7833786010742188 
2022-04-27 09:44:21,724 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-27 09:44:21,725 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 178.3%
2022-04-27 09:44:44,897 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.853, Acc: 0.917, Base Lr: 6.51e-05
2022-04-27 09:45:06,021 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.865, Acc: 0.913, Base Lr: 6.51e-05
Aug Cl acc: 0.1912713382706974
2022-04-27 09:45:21,755 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.219[s] Speed: 72.9[samples/s]
2022-04-27 09:46:45,030 reid_baseline.train INFO: normal accuracy 0.7794353913243057 1.7591643333435059 
2022-04-27 09:47:14,995 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-27 09:47:14,996 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 175.9%
2022-04-27 09:47:37,977 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.833, Acc: 0.930, Base Lr: 1.60e-05
2022-04-27 09:47:59,636 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.845, Acc: 0.924, Base Lr: 1.60e-05
Aug Cl acc: 0.19638788132440477
2022-04-27 09:48:15,515 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.222[s] Speed: 72.2[samples/s]
2022-04-27 09:50:12,219 reid_baseline.train INFO: normal accuracy 0.7817305485425752 1.715208888053894 
2022-04-27 09:50:42,165 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-27 09:50:42,166 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 171.5%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-27 09:52:36,510 reid_baseline.train INFO: normal accuracy 0.7817305485425752 1.715208888053894 
2022-04-27 09:52:36,511 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 09:52:36,511 reid_baseline.train INFO: Accuracy: 78.2%
2022-04-27 09:53:59,905 reid_baseline.train INFO: normal accuracy 0.7817305485425752 1.715208888053894 
2022-04-27 09:53:59,906 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 09:53:59,906 reid_baseline.train INFO: Shuffled Accuracy: 78.2%
2022-04-27 09:54:33,787 reid_baseline.train INFO: normal accuracy 0.9489117983963344 0.8266660571098328 
2022-04-27 09:54:33,788 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-27 09:54:33,788 reid_baseline.train INFO: Source Clean Accuracy: 94.9%
