2022-04-19 16:12:24,100 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_1
2022-04-19 16:12:24,100 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-19 16:12:24,100 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 16:12:24,116 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 16:12:24,116 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 16:12:31,736 reid_baseline.train INFO: start training
2022-04-19 16:13:11,261 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.284, Acc: 0.240, Base Lr: 8.72e-04
2022-04-19 16:13:28,418 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-19 16:15:46,186 reid_baseline.train INFO: normal accuracy 0.5896258893734221 4.172054767608643 
2022-04-19 16:15:49,406 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 16:15:49,407 reid_baseline.train INFO: Accuracy: 59.0% Mean Entropy: 417.2%
2022-04-19 16:16:23,947 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 6.030, Acc: 0.517, Base Lr: 1.66e-03
2022-04-19 16:16:38,597 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-19 16:19:05,417 reid_baseline.train INFO: normal accuracy 0.619003901767271 4.151554584503174 
2022-04-19 16:19:09,079 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 16:19:09,080 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 415.2%
2022-04-19 16:19:39,918 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.639, Acc: 0.545, Base Lr: 2.46e-03
2022-04-19 16:19:56,264 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.310[s] Speed: 51.5[samples/s]
2022-04-19 16:21:21,490 reid_baseline.train INFO: normal accuracy 0.6334633922423686 4.000249862670898 
2022-04-19 16:21:24,658 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 16:21:24,658 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 400.0%
2022-04-19 16:21:58,867 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 5.032, Acc: 0.573, Base Lr: 3.25e-03
2022-04-19 16:22:14,247 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.326[s] Speed: 49.0[samples/s]
2022-04-19 16:23:32,458 reid_baseline.train INFO: normal accuracy 0.6633004360798714 3.6046998500823975 
2022-04-19 16:23:36,000 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 16:23:36,001 reid_baseline.train INFO: Accuracy: 66.3% Mean Entropy: 360.5%
2022-04-19 16:24:02,599 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.646, Acc: 0.604, Base Lr: 4.04e-03
2022-04-19 16:24:18,396 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.279[s] Speed: 57.4[samples/s]
2022-04-19 16:25:39,675 reid_baseline.train INFO: normal accuracy 0.7222859765893964 3.289097785949707 
2022-04-19 16:25:42,831 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 16:25:42,831 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 328.9%
2022-04-19 16:26:14,985 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 4.346, Acc: 0.651, Base Lr: 4.83e-03
2022-04-19 16:26:29,691 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-19 16:27:52,485 reid_baseline.train INFO: normal accuracy 0.7482212531558412 3.438380479812622 
2022-04-19 16:27:52,485 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 16:27:52,486 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 343.8%
2022-04-19 16:28:22,736 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 4.268, Acc: 0.661, Base Lr: 5.62e-03
2022-04-19 16:28:37,570 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.297[s] Speed: 54.0[samples/s]
2022-04-19 16:29:59,380 reid_baseline.train INFO: normal accuracy 0.7851732843699794 2.8545985221862793 
2022-04-19 16:30:02,476 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 16:30:02,476 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 285.5%
2022-04-19 16:30:34,128 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 4.055, Acc: 0.721, Base Lr: 6.42e-03
2022-04-19 16:30:48,164 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-19 16:32:08,139 reid_baseline.train INFO: normal accuracy 0.7844847372044985 2.888640880584717 
2022-04-19 16:32:08,140 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 16:32:08,140 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 288.9%
2022-04-19 16:32:39,097 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.949, Acc: 0.740, Base Lr: 7.21e-03
2022-04-19 16:32:54,515 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-19 16:34:20,277 reid_baseline.train INFO: normal accuracy 0.7564838191416112 2.905954599380493 
2022-04-19 16:34:20,279 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 16:34:20,279 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 290.6%
2022-04-19 16:34:52,430 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.931, Acc: 0.755, Base Lr: 4.01e-03
2022-04-19 16:35:07,465 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-19 16:37:32,343 reid_baseline.train INFO: normal accuracy 0.7252696809731467 3.018559217453003 
2022-04-19 16:37:32,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 16:37:32,343 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 301.9%
2022-04-19 16:38:06,817 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.866, Acc: 0.772, Base Lr: 3.38e-03
2022-04-19 16:38:23,433 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.336[s] Speed: 47.7[samples/s]
2022-04-19 16:40:52,655 reid_baseline.train INFO: normal accuracy 0.7564838191416112 2.91076397895813 
2022-04-19 16:40:52,655 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 16:40:52,656 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 291.1%
2022-04-19 16:41:30,865 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.822, Acc: 0.790, Base Lr: 2.77e-03
2022-04-19 16:41:48,128 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.364[s] Speed: 43.9[samples/s]
2022-04-19 16:43:53,758 reid_baseline.train INFO: normal accuracy 0.8129446867110397 2.409186601638794 
2022-04-19 16:43:57,140 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 16:43:57,140 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 240.9%
2022-04-19 16:44:32,635 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.845, Acc: 0.772, Base Lr: 2.20e-03
2022-04-19 16:44:49,381 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-19 16:47:15,262 reid_baseline.train INFO: normal accuracy 0.7257287124168006 3.059021234512329 
2022-04-19 16:47:15,263 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 16:47:15,263 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 305.9%
2022-04-19 16:47:53,688 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.759, Acc: 0.791, Base Lr: 1.66e-03
2022-04-19 16:48:11,764 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.371[s] Speed: 43.1[samples/s]
2022-04-19 16:50:22,557 reid_baseline.train INFO: normal accuracy 0.6713334863438145 3.344914197921753 
2022-04-19 16:50:22,557 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 16:50:22,557 reid_baseline.train INFO: Accuracy: 67.1% Mean Entropy: 334.5%
2022-04-19 16:50:48,547 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.817, Acc: 0.777, Base Lr: 1.19e-03
2022-04-19 16:51:04,247 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.274[s] Speed: 58.4[samples/s]
2022-04-19 16:52:29,921 reid_baseline.train INFO: normal accuracy 0.6167087445490016 3.4958691596984863 
2022-04-19 16:52:29,923 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 16:52:29,923 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 349.6%
2022-04-19 16:52:57,585 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.788, Acc: 0.787, Base Lr: 7.78e-04
2022-04-19 16:53:12,040 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.277[s] Speed: 57.8[samples/s]
2022-04-19 16:55:21,735 reid_baseline.train INFO: normal accuracy 0.6713334863438145 3.220547676086426 
2022-04-19 16:55:21,737 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 16:55:21,738 reid_baseline.train INFO: Accuracy: 67.1% Mean Entropy: 322.1%
2022-04-19 16:55:51,291 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.706, Acc: 0.813, Base Lr: 4.51e-04
2022-04-19 16:56:05,566 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-19 16:57:31,997 reid_baseline.train INFO: normal accuracy 0.652742712875832 3.3321800231933594 
2022-04-19 16:57:31,999 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 16:57:32,000 reid_baseline.train INFO: Accuracy: 65.3% Mean Entropy: 333.2%
2022-04-19 16:57:58,349 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.726, Acc: 0.795, Base Lr: 2.11e-04
2022-04-19 16:58:12,039 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.263[s] Speed: 60.7[samples/s]
2022-04-19 16:59:39,973 reid_baseline.train INFO: normal accuracy 0.6665136561854487 3.2958595752716064 
2022-04-19 16:59:39,975 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 16:59:39,975 reid_baseline.train INFO: Accuracy: 66.7% Mean Entropy: 329.6%
2022-04-19 17:00:10,688 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.810, Acc: 0.788, Base Lr: 6.51e-05
2022-04-19 17:00:25,808 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.302[s] Speed: 53.1[samples/s]
2022-04-19 17:01:54,118 reid_baseline.train INFO: normal accuracy 0.6515951342666972 3.2957470417022705 
2022-04-19 17:01:54,118 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 17:01:54,118 reid_baseline.train INFO: Accuracy: 65.2% Mean Entropy: 329.6%
2022-04-19 17:02:21,498 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.750, Acc: 0.780, Base Lr: 1.60e-05
2022-04-19 17:02:35,898 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.275[s] Speed: 58.2[samples/s]
2022-04-19 17:04:08,485 reid_baseline.train INFO: normal accuracy 0.6655955932981409 3.3174188137054443 
2022-04-19 17:04:08,487 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 17:04:08,487 reid_baseline.train INFO: Accuracy: 66.6% Mean Entropy: 331.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_1/transformer_best_model.pth
2022-04-19 17:05:42,516 reid_baseline.train INFO: normal accuracy 0.8129446867110397 2.409186601638794 
2022-04-19 17:05:42,516 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:05:42,516 reid_baseline.train INFO: Accuracy: 81.3%
2022-04-19 17:07:11,266 reid_baseline.train INFO: normal accuracy 0.8129446867110397 2.409186601638794 
2022-04-19 17:07:11,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:07:11,267 reid_baseline.train INFO: Shuffled Accuracy: 81.3%
2022-04-19 17:07:34,843 reid_baseline.train INFO: normal accuracy 0.9468479604449939 1.8969941139221191 
2022-04-19 17:07:34,844 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:07:34,844 reid_baseline.train INFO: Source Clean Accuracy: 94.7%
2022-04-19 17:07:38,907 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_2
2022-04-19 17:07:38,907 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-19 17:07:38,907 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 17:07:38,908 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 17:07:38,908 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 17:07:44,398 reid_baseline.train INFO: start training
2022-04-19 17:08:16,569 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.269, Acc: 0.243, Base Lr: 8.72e-04
2022-04-19 17:08:31,712 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.7[samples/s]
2022-04-19 17:09:59,435 reid_baseline.train INFO: normal accuracy 0.5751663988983245 4.172050476074219 
2022-04-19 17:10:02,466 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 17:10:02,467 reid_baseline.train INFO: Accuracy: 57.5% Mean Entropy: 417.2%
2022-04-19 17:10:29,699 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.991, Acc: 0.516, Base Lr: 1.66e-03
2022-04-19 17:10:41,597 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.257[s] Speed: 62.2[samples/s]
2022-04-19 17:12:46,855 reid_baseline.train INFO: normal accuracy 0.6001836125774616 4.150134563446045 
2022-04-19 17:12:50,032 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 17:12:50,032 reid_baseline.train INFO: Accuracy: 60.0% Mean Entropy: 415.0%
2022-04-19 17:13:19,062 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.654, Acc: 0.510, Base Lr: 2.46e-03
2022-04-19 17:13:32,866 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.282[s] Speed: 56.8[samples/s]
2022-04-19 17:14:58,740 reid_baseline.train INFO: normal accuracy 0.6252008262565986 3.9466264247894287 
2022-04-19 17:15:01,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 17:15:01,955 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 394.7%
2022-04-19 17:15:27,754 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 5.090, Acc: 0.566, Base Lr: 3.25e-03
2022-04-19 17:15:37,700 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.235[s] Speed: 68.0[samples/s]
2022-04-19 17:17:04,366 reid_baseline.train INFO: normal accuracy 0.6711039706219876 3.318960666656494 
2022-04-19 17:17:07,511 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 17:17:07,512 reid_baseline.train INFO: Accuracy: 67.1% Mean Entropy: 331.9%
2022-04-19 17:17:36,683 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.593, Acc: 0.611, Base Lr: 4.04e-03
2022-04-19 17:17:51,337 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-19 17:19:20,526 reid_baseline.train INFO: normal accuracy 0.724122102364012 2.7514376640319824 
2022-04-19 17:19:23,807 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 17:19:23,807 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 275.1%
2022-04-19 17:19:47,116 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 4.279, Acc: 0.657, Base Lr: 4.83e-03
2022-04-19 17:19:59,520 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.235[s] Speed: 68.1[samples/s]
2022-04-19 17:21:26,183 reid_baseline.train INFO: normal accuracy 0.7734679825568052 2.297513961791992 
2022-04-19 17:21:29,523 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 17:21:29,524 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 229.8%
2022-04-19 17:21:51,768 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 4.169, Acc: 0.701, Base Lr: 5.62e-03
2022-04-19 17:22:04,535 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.230[s] Speed: 69.5[samples/s]
2022-04-19 17:23:28,900 reid_baseline.train INFO: normal accuracy 0.803534542116135 1.9211174249649048 
2022-04-19 17:23:32,134 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 17:23:32,134 reid_baseline.train INFO: Accuracy: 80.4% Mean Entropy: 192.1%
2022-04-19 17:23:59,041 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 4.069, Acc: 0.720, Base Lr: 6.42e-03
2022-04-19 17:24:10,612 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.253[s] Speed: 63.2[samples/s]
2022-04-19 17:25:45,902 reid_baseline.train INFO: normal accuracy 0.8218957998622906 1.7798548936843872 
2022-04-19 17:25:49,037 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 17:25:49,038 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 178.0%
2022-04-19 17:26:17,538 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.928, Acc: 0.752, Base Lr: 7.21e-03
2022-04-19 17:26:31,570 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-19 17:28:00,720 reid_baseline.train INFO: normal accuracy 0.819830158365848 1.6506357192993164 
2022-04-19 17:28:03,833 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 17:28:03,833 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 165.1%
2022-04-19 17:28:28,814 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.969, Acc: 0.754, Base Lr: 4.01e-03
2022-04-19 17:28:39,717 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.236[s] Speed: 67.8[samples/s]
2022-04-19 17:30:13,532 reid_baseline.train INFO: normal accuracy 0.828551755795272 1.6810256242752075 
2022-04-19 17:30:13,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 17:30:13,533 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 168.1%
2022-04-19 17:30:46,051 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.869, Acc: 0.763, Base Lr: 3.38e-03
2022-04-19 17:31:03,984 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-19 17:32:58,726 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.5607845783233643 
2022-04-19 17:33:01,886 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 17:33:01,886 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 156.1%
2022-04-19 17:33:27,227 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.823, Acc: 0.781, Base Lr: 2.77e-03
2022-04-19 17:33:38,634 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.242[s] Speed: 66.2[samples/s]
2022-04-19 17:35:06,105 reid_baseline.train INFO: normal accuracy 0.8306173972917145 1.6002755165100098 
2022-04-19 17:35:06,105 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 17:35:06,105 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 160.0%
2022-04-19 17:35:34,791 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.772, Acc: 0.779, Base Lr: 2.20e-03
2022-04-19 17:35:49,275 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.284[s] Speed: 56.3[samples/s]
2022-04-19 17:37:17,407 reid_baseline.train INFO: normal accuracy 0.8370438375028689 1.587205171585083 
2022-04-19 17:37:17,408 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 17:37:17,408 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 158.7%
2022-04-19 17:37:43,108 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.807, Acc: 0.780, Base Lr: 1.66e-03
2022-04-19 17:37:55,597 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.251[s] Speed: 63.7[samples/s]
2022-04-19 17:39:22,118 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.529576063156128 
2022-04-19 17:39:27,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 17:39:27,586 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 153.0%
2022-04-19 17:39:56,997 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.827, Acc: 0.774, Base Lr: 1.19e-03
2022-04-19 17:40:10,702 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.284[s] Speed: 56.4[samples/s]
2022-04-19 17:41:37,215 reid_baseline.train INFO: normal accuracy 0.8331420702318109 1.5558090209960938 
2022-04-19 17:41:37,217 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 17:41:37,218 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 155.6%
2022-04-19 17:42:04,082 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.775, Acc: 0.786, Base Lr: 7.78e-04
2022-04-19 17:42:16,191 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.256[s] Speed: 62.4[samples/s]
2022-04-19 17:43:41,098 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.5123541355133057 
2022-04-19 17:43:44,261 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 17:43:44,261 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 151.2%
2022-04-19 17:44:13,117 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.757, Acc: 0.797, Base Lr: 4.51e-04
2022-04-19 17:44:26,891 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.280[s] Speed: 57.1[samples/s]
2022-04-19 17:46:00,568 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.5717068910598755 
2022-04-19 17:46:00,570 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 17:46:00,570 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 157.2%
2022-04-19 17:46:26,174 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.716, Acc: 0.803, Base Lr: 2.11e-04
2022-04-19 17:46:37,978 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.246[s] Speed: 65.0[samples/s]
2022-04-19 17:48:05,493 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.540481686592102 
2022-04-19 17:48:05,494 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 17:48:05,494 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 154.0%
2022-04-19 17:48:34,108 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.772, Acc: 0.796, Base Lr: 6.51e-05
2022-04-19 17:48:48,704 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.284[s] Speed: 56.3[samples/s]
2022-04-19 17:50:27,522 reid_baseline.train INFO: normal accuracy 0.8333715859536378 1.55531644821167 
2022-04-19 17:50:27,522 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 17:50:27,522 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 155.5%
2022-04-19 17:51:03,246 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.735, Acc: 0.807, Base Lr: 1.60e-05
2022-04-19 17:51:18,176 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.333[s] Speed: 48.0[samples/s]
2022-04-19 17:52:56,293 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.592566728591919 
2022-04-19 17:52:56,293 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 17:52:56,293 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 159.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_2/transformer_best_model.pth
2022-04-19 17:54:25,637 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.5123541355133057 
2022-04-19 17:54:25,637 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:54:25,637 reid_baseline.train INFO: Accuracy: 83.5%
2022-04-19 17:55:51,264 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.5123541355133057 
2022-04-19 17:55:51,264 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:55:51,264 reid_baseline.train INFO: Shuffled Accuracy: 83.5%
2022-04-19 17:56:13,223 reid_baseline.train INFO: normal accuracy 0.969097651421508 0.9243238568305969 
2022-04-19 17:56:13,223 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 17:56:13,223 reid_baseline.train INFO: Source Clean Accuracy: 96.9%
2022-04-19 17:56:16,857 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_3
2022-04-19 17:56:16,857 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-19 17:56:16,858 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 17:56:16,858 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 17:56:16,858 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 17:56:22,811 reid_baseline.train INFO: start training
2022-04-19 17:56:53,154 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.276, Acc: 0.231, Base Lr: 8.72e-04
2022-04-19 17:57:05,629 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.280[s] Speed: 57.1[samples/s]
2022-04-19 17:58:30,855 reid_baseline.train INFO: normal accuracy 0.5751663988983245 4.172060012817383 
2022-04-19 17:59:56,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 17:59:56,898 reid_baseline.train INFO: Accuracy: 57.5% Mean Entropy: 417.2%
2022-04-19 18:00:27,307 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 6.063, Acc: 0.475, Base Lr: 1.66e-03
2022-04-19 18:00:41,943 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-19 18:02:38,411 reid_baseline.train INFO: normal accuracy 0.6219876061510213 4.15095853805542 
2022-04-19 18:03:08,496 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 18:03:08,496 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 415.1%
2022-04-19 18:03:34,400 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.625, Acc: 0.521, Base Lr: 2.46e-03
2022-04-19 18:03:45,687 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.245[s] Speed: 65.4[samples/s]
2022-04-19 18:06:09,812 reid_baseline.train INFO: normal accuracy 0.6293321092494836 3.94472336769104 
2022-04-19 18:06:39,901 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 18:06:39,901 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 394.5%
2022-04-19 18:07:07,851 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 5.038, Acc: 0.550, Base Lr: 3.25e-03
2022-04-19 18:07:21,550 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.274[s] Speed: 58.4[samples/s]
2022-04-19 18:09:48,172 reid_baseline.train INFO: normal accuracy 0.686022492540739 3.3372182846069336 
2022-04-19 18:10:18,392 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 18:10:18,392 reid_baseline.train INFO: Accuracy: 68.6% Mean Entropy: 333.7%
2022-04-19 18:10:44,046 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.558, Acc: 0.626, Base Lr: 4.04e-03
2022-04-19 18:10:54,505 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.238[s] Speed: 67.4[samples/s]
2022-04-19 18:12:46,468 reid_baseline.train INFO: normal accuracy 0.7328436997934359 2.708667516708374 
2022-04-19 18:13:16,524 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 18:13:16,524 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 270.9%
2022-04-19 18:14:12,282 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 4.272, Acc: 0.679, Base Lr: 4.83e-03
2022-04-19 18:14:25,698 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.455[s] Speed: 35.2[samples/s]
2022-04-19 18:16:48,500 reid_baseline.train INFO: normal accuracy 0.7764516869405554 2.189716100692749 
2022-04-19 18:17:18,643 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 18:17:18,643 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 219.0%
2022-04-19 18:17:45,007 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 4.151, Acc: 0.703, Base Lr: 5.62e-03
2022-04-19 18:17:57,550 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-19 18:19:51,842 reid_baseline.train INFO: normal accuracy 0.8021574477851733 1.8966282606124878 
2022-04-19 18:20:21,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 18:20:21,937 reid_baseline.train INFO: Accuracy: 80.2% Mean Entropy: 189.7%
2022-04-19 18:20:49,774 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.970, Acc: 0.735, Base Lr: 6.42e-03
2022-04-19 18:21:03,192 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-19 18:22:27,939 reid_baseline.train INFO: normal accuracy 0.8124856552673858 1.6641340255737305 
2022-04-19 18:22:58,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 18:22:58,010 reid_baseline.train INFO: Accuracy: 81.2% Mean Entropy: 166.4%
2022-04-19 18:23:24,024 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.933, Acc: 0.734, Base Lr: 7.21e-03
2022-04-19 18:23:35,479 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.246[s] Speed: 64.9[samples/s]
2022-04-19 18:25:00,935 reid_baseline.train INFO: normal accuracy 0.8260270828551756 1.5539311170578003 
2022-04-19 18:25:30,998 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 18:25:30,998 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 155.4%
2022-04-19 18:25:59,040 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.857, Acc: 0.765, Base Lr: 4.01e-03
2022-04-19 18:26:12,643 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.274[s] Speed: 58.4[samples/s]
2022-04-19 18:28:36,859 reid_baseline.train INFO: normal accuracy 0.8239614413587331 1.5820574760437012 
2022-04-19 18:28:36,860 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 18:28:36,860 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 158.2%
2022-04-19 18:29:02,827 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.867, Acc: 0.762, Base Lr: 3.38e-03
2022-04-19 18:29:15,459 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.254[s] Speed: 63.0[samples/s]
2022-04-19 18:30:41,851 reid_baseline.train INFO: normal accuracy 0.8271746614643103 1.4140406847000122 
2022-04-19 18:31:11,905 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 18:31:11,905 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 141.4%
2022-04-19 18:31:42,943 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.804, Acc: 0.764, Base Lr: 2.77e-03
2022-04-19 18:31:56,881 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-19 18:33:23,655 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4809675216674805 
2022-04-19 18:33:23,657 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 18:33:23,657 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 148.1%
2022-04-19 18:34:15,618 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.863, Acc: 0.755, Base Lr: 2.20e-03
2022-04-19 18:34:28,108 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.424[s] Speed: 37.7[samples/s]
2022-04-19 18:36:02,961 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.5048739910125732 
2022-04-19 18:36:02,963 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 18:36:02,963 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 150.5%
2022-04-19 18:36:23,440 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.810, Acc: 0.781, Base Lr: 1.66e-03
2022-04-19 18:36:37,743 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-19 18:38:35,935 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.4200690984725952 
2022-04-19 18:38:35,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 18:38:35,937 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 142.0%
2022-04-19 18:39:04,517 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.749, Acc: 0.794, Base Lr: 1.19e-03
2022-04-19 18:39:17,785 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.275[s] Speed: 58.1[samples/s]
2022-04-19 18:41:10,879 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.5850073099136353 
2022-04-19 18:41:10,879 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 18:41:10,879 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 158.5%
2022-04-19 18:42:04,143 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.714, Acc: 0.796, Base Lr: 7.78e-04
2022-04-19 18:42:18,208 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.443[s] Speed: 36.1[samples/s]
2022-04-19 18:44:14,496 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.3672547340393066 
2022-04-19 18:44:44,543 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 18:44:44,544 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 136.7%
2022-04-19 18:45:13,260 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.751, Acc: 0.798, Base Lr: 4.51e-04
2022-04-19 18:45:27,036 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-19 18:47:45,448 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4205816984176636 
2022-04-19 18:47:45,450 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 18:47:45,451 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 142.1%
2022-04-19 18:48:08,417 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.697, Acc: 0.798, Base Lr: 2.11e-04
2022-04-19 18:48:46,961 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.405[s] Speed: 39.5[samples/s]
2022-04-19 18:50:40,202 reid_baseline.train INFO: normal accuracy 0.8386504475556575 1.4588813781738281 
2022-04-19 18:50:40,204 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 18:50:40,204 reid_baseline.train INFO: Accuracy: 83.9% Mean Entropy: 145.9%
2022-04-19 18:51:07,950 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.758, Acc: 0.796, Base Lr: 6.51e-05
2022-04-19 18:51:21,690 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.273[s] Speed: 58.6[samples/s]
2022-04-19 18:53:12,413 reid_baseline.train INFO: normal accuracy 0.8391094789993114 1.4634190797805786 
2022-04-19 18:53:12,416 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 18:53:12,416 reid_baseline.train INFO: Accuracy: 83.9% Mean Entropy: 146.3%
2022-04-19 18:53:39,568 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.874, Acc: 0.770, Base Lr: 1.60e-05
2022-04-19 18:53:49,440 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.244[s] Speed: 65.7[samples/s]
2022-04-19 18:56:38,053 reid_baseline.train INFO: normal accuracy 0.836584806059215 1.5090116262435913 
2022-04-19 18:56:38,054 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 18:56:38,054 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 150.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_3/transformer_best_model.pth
2022-04-19 18:59:00,939 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.3672547340393066 
2022-04-19 18:59:00,940 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 18:59:00,940 reid_baseline.train INFO: Accuracy: 83.7%
2022-04-19 19:00:54,070 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.3672547340393066 
2022-04-19 19:00:54,070 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 19:00:54,070 reid_baseline.train INFO: Shuffled Accuracy: 83.7%
2022-04-19 19:01:19,600 reid_baseline.train INFO: normal accuracy 0.9703337453646477 0.8113328814506531 
2022-04-19 19:01:19,600 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 19:01:19,600 reid_baseline.train INFO: Source Clean Accuracy: 97.0%
2022-04-19 19:01:23,093 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_4
2022-04-19 19:01:23,093 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-19 19:01:23,093 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 19:01:23,093 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 19:01:23,094 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 19:01:28,396 reid_baseline.train INFO: start training
2022-04-19 19:02:23,571 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.284, Acc: 0.243, Base Lr: 8.72e-04
2022-04-19 19:02:37,953 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.456[s] Speed: 35.1[samples/s]
2022-04-19 19:04:00,946 reid_baseline.train INFO: normal accuracy 0.5680514115216893 4.172082901000977 
2022-04-19 19:04:30,920 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 19:04:30,920 reid_baseline.train INFO: Accuracy: 56.8% Mean Entropy: 417.2%
2022-04-19 19:04:58,904 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 6.068, Acc: 0.498, Base Lr: 1.66e-03
2022-04-19 19:05:12,990 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.277[s] Speed: 57.8[samples/s]
2022-04-19 19:07:08,588 reid_baseline.train INFO: normal accuracy 0.6153316502180399 4.150522708892822 
2022-04-19 19:07:38,631 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 19:07:38,632 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 415.1%
2022-04-19 19:08:03,032 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.610, Acc: 0.522, Base Lr: 2.46e-03
2022-04-19 19:08:16,862 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.251[s] Speed: 63.6[samples/s]
2022-04-19 19:09:40,095 reid_baseline.train INFO: normal accuracy 0.6171677759926555 3.94693922996521 
2022-04-19 19:10:10,152 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 19:10:10,153 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 394.7%
2022-04-19 19:10:39,335 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.907, Acc: 0.560, Base Lr: 3.25e-03
2022-04-19 19:10:52,249 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.277[s] Speed: 57.8[samples/s]
2022-04-19 19:12:18,786 reid_baseline.train INFO: normal accuracy 0.6706449391783337 3.268131732940674 
2022-04-19 19:12:48,871 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 19:12:48,871 reid_baseline.train INFO: Accuracy: 67.1% Mean Entropy: 326.8%
2022-04-19 19:13:14,694 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.484, Acc: 0.624, Base Lr: 4.04e-03
2022-04-19 19:13:29,439 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.267[s] Speed: 60.0[samples/s]
2022-04-19 19:15:37,873 reid_baseline.train INFO: normal accuracy 0.7275648381914162 2.683774709701538 
2022-04-19 19:16:07,926 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 19:16:07,927 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 268.4%
2022-04-19 19:16:31,219 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 4.213, Acc: 0.685, Base Lr: 4.83e-03
2022-04-19 19:16:42,579 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.228[s] Speed: 70.2[samples/s]
2022-04-19 19:18:07,048 reid_baseline.train INFO: normal accuracy 0.7819600642644021 2.2000844478607178 
2022-04-19 19:18:37,118 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 19:18:37,118 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 220.0%
2022-04-19 19:19:02,168 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 4.133, Acc: 0.700, Base Lr: 5.62e-03
2022-04-19 19:19:39,691 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.412[s] Speed: 38.9[samples/s]
2022-04-19 19:21:35,095 reid_baseline.train INFO: normal accuracy 0.8019279320633463 1.898564100265503 
2022-04-19 19:22:05,156 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 19:22:05,158 reid_baseline.train INFO: Accuracy: 80.2% Mean Entropy: 189.9%
2022-04-19 19:22:32,984 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.984, Acc: 0.729, Base Lr: 6.42e-03
2022-04-19 19:22:46,289 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.271[s] Speed: 59.1[samples/s]
2022-04-19 19:25:16,140 reid_baseline.train INFO: normal accuracy 0.8127151709892128 1.8539496660232544 
2022-04-19 19:25:46,174 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 19:25:46,175 reid_baseline.train INFO: Accuracy: 81.3% Mean Entropy: 185.4%
2022-04-19 19:26:08,962 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.948, Acc: 0.745, Base Lr: 7.21e-03
2022-04-19 19:26:48,337 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.409[s] Speed: 39.1[samples/s]
2022-04-19 19:28:40,990 reid_baseline.train INFO: normal accuracy 0.8205187055313289 1.6315909624099731 
2022-04-19 19:29:11,024 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 19:29:11,024 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 163.2%
2022-04-19 19:29:38,967 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.876, Acc: 0.763, Base Lr: 4.01e-03
2022-04-19 19:29:52,268 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-19 19:32:16,356 reid_baseline.train INFO: normal accuracy 0.8239614413587331 1.4787912368774414 
2022-04-19 19:32:46,403 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 19:32:46,404 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 147.9%
2022-04-19 19:33:09,145 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.785, Acc: 0.779, Base Lr: 3.38e-03
2022-04-19 19:33:48,411 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.408[s] Speed: 39.2[samples/s]
2022-04-19 19:35:43,768 reid_baseline.train INFO: normal accuracy 0.8267156300206564 1.5610582828521729 
2022-04-19 19:35:43,769 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 19:35:43,769 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 156.1%
2022-04-19 19:36:12,442 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.839, Acc: 0.771, Base Lr: 2.77e-03
2022-04-19 19:36:26,502 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-19 19:38:21,060 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4298288822174072 
2022-04-19 19:39:15,688 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 19:39:15,695 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 143.0%
2022-04-19 19:39:43,268 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.860, Acc: 0.768, Base Lr: 2.20e-03
2022-04-19 19:40:24,607 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.453[s] Speed: 35.3[samples/s]
2022-04-19 19:41:50,908 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.5368086099624634 
2022-04-19 19:41:50,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 19:41:50,909 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 153.7%
2022-04-19 19:42:19,274 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.873, Acc: 0.778, Base Lr: 1.66e-03
2022-04-19 19:42:32,936 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.276[s] Speed: 57.9[samples/s]
2022-04-19 19:44:25,147 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.506964087486267 
2022-04-19 19:44:25,149 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 19:44:25,150 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 150.7%
2022-04-19 19:44:49,421 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.751, Acc: 0.800, Base Lr: 1.19e-03
2022-04-19 19:45:02,858 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.248[s] Speed: 64.5[samples/s]
2022-04-19 19:46:58,875 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4735655784606934 
2022-04-19 19:46:58,875 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 19:46:58,876 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 147.4%
2022-04-19 19:47:26,586 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.749, Acc: 0.803, Base Lr: 7.78e-04
2022-04-19 19:47:40,494 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.274[s] Speed: 58.4[samples/s]
2022-04-19 19:49:38,310 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4082387685775757 
2022-04-19 19:50:08,385 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 19:50:08,385 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 140.8%
2022-04-19 19:50:34,037 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.860, Acc: 0.776, Base Lr: 4.51e-04
2022-04-19 19:50:47,056 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.254[s] Speed: 62.9[samples/s]
2022-04-19 19:52:10,643 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.4451327323913574 
2022-04-19 19:52:10,644 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 19:52:10,644 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 144.5%
2022-04-19 19:52:40,740 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.689, Acc: 0.806, Base Lr: 2.11e-04
2022-04-19 19:52:55,782 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-19 19:54:23,953 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.4431674480438232 
2022-04-19 19:54:23,953 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 19:54:23,953 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 144.3%
2022-04-19 19:54:49,262 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.798, Acc: 0.792, Base Lr: 6.51e-05
2022-04-19 19:55:02,552 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.254[s] Speed: 63.0[samples/s]
2022-04-19 19:57:14,075 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4468709230422974 
2022-04-19 19:57:14,075 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 19:57:14,076 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 144.7%
2022-04-19 19:57:37,771 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.752, Acc: 0.793, Base Lr: 1.60e-05
2022-04-19 19:57:48,612 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.227[s] Speed: 70.4[samples/s]
2022-04-19 19:59:37,681 reid_baseline.train INFO: normal accuracy 0.8354372274500803 1.497059941291809 
2022-04-19 19:59:37,682 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 19:59:37,682 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 149.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_4/transformer_best_model.pth
2022-04-19 20:01:37,541 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4082387685775757 
2022-04-19 20:01:37,541 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 20:01:37,542 reid_baseline.train INFO: Accuracy: 83.4%
2022-04-19 20:03:18,872 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4082387685775757 
2022-04-19 20:03:18,872 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 20:03:18,872 reid_baseline.train INFO: Shuffled Accuracy: 83.4%
2022-04-19 20:03:37,933 reid_baseline.train INFO: normal accuracy 0.965389369592089 0.8484164476394653 
2022-04-19 20:03:37,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 20:03:37,933 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-19 20:03:41,618 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_6
2022-04-19 20:03:41,619 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-19 20:03:41,619 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 20:03:41,619 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 20:03:41,620 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 20:03:45,681 reid_baseline.train INFO: start training
2022-04-19 20:04:05,129 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.289, Acc: 0.237, Base Lr: 8.72e-04
2022-04-19 20:04:14,391 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.187[s] Speed: 85.4[samples/s]
2022-04-19 20:05:29,262 reid_baseline.train INFO: normal accuracy 0.565067707137939 4.1720452308654785 
2022-04-19 20:05:59,211 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 20:05:59,211 reid_baseline.train INFO: Accuracy: 56.5% Mean Entropy: 417.2%
2022-04-19 20:06:17,487 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 6.059, Acc: 0.482, Base Lr: 1.66e-03
2022-04-19 20:06:25,802 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.175[s] Speed: 91.5[samples/s]
2022-04-19 20:07:38,235 reid_baseline.train INFO: normal accuracy 0.6137250401652513 4.150235652923584 
2022-04-19 20:08:08,358 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 20:08:08,358 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 415.0%
2022-04-19 20:08:26,076 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.609, Acc: 0.528, Base Lr: 2.46e-03
2022-04-19 20:08:34,414 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.171[s] Speed: 93.4[samples/s]
2022-04-19 20:09:49,528 reid_baseline.train INFO: normal accuracy 0.6389717695662153 3.9545841217041016 
2022-04-19 20:10:19,551 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 20:10:19,551 reid_baseline.train INFO: Accuracy: 63.9% Mean Entropy: 395.5%
2022-04-19 20:10:37,383 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.967, Acc: 0.582, Base Lr: 3.25e-03
2022-04-19 20:10:45,732 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.172[s] Speed: 92.9[samples/s]
2022-04-19 20:12:00,252 reid_baseline.train INFO: normal accuracy 0.669267844847372 3.3040027618408203 
2022-04-19 20:12:30,325 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 20:12:30,325 reid_baseline.train INFO: Accuracy: 66.9% Mean Entropy: 330.4%
2022-04-19 20:12:48,234 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.570, Acc: 0.608, Base Lr: 4.04e-03
2022-04-19 20:12:57,063 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.176[s] Speed: 91.0[samples/s]
2022-04-19 20:14:12,424 reid_baseline.train INFO: normal accuracy 0.7296304796878587 2.671898365020752 
2022-04-19 20:14:42,475 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 20:14:42,475 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 267.2%
2022-04-19 20:15:00,750 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 4.293, Acc: 0.651, Base Lr: 4.83e-03
2022-04-19 20:15:09,063 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.175[s] Speed: 91.5[samples/s]
2022-04-19 20:16:21,287 reid_baseline.train INFO: normal accuracy 0.7842552214826716 2.274461507797241 
2022-04-19 20:16:51,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 20:16:51,317 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 227.4%
2022-04-19 20:17:09,476 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 4.064, Acc: 0.711, Base Lr: 5.62e-03
2022-04-19 20:17:17,974 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.175[s] Speed: 91.5[samples/s]
2022-04-19 20:18:30,008 reid_baseline.train INFO: normal accuracy 0.8065182464998852 1.974289059638977 
2022-04-19 20:19:00,137 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 20:19:00,137 reid_baseline.train INFO: Accuracy: 80.7% Mean Entropy: 197.4%
2022-04-19 20:19:18,544 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.969, Acc: 0.728, Base Lr: 6.42e-03
2022-04-19 20:19:27,053 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.177[s] Speed: 90.5[samples/s]
2022-04-19 20:20:42,452 reid_baseline.train INFO: normal accuracy 0.8196006426440211 1.7311331033706665 
2022-04-19 20:21:12,493 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 20:21:12,493 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 173.1%
2022-04-19 20:21:30,459 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.957, Acc: 0.742, Base Lr: 7.21e-03
2022-04-19 20:21:38,677 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.172[s] Speed: 93.2[samples/s]
2022-04-19 20:22:49,553 reid_baseline.train INFO: normal accuracy 0.8248795042460408 1.5850353240966797 
2022-04-19 20:23:19,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 20:23:19,599 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 158.5%
2022-04-19 20:23:37,703 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.946, Acc: 0.756, Base Lr: 4.01e-03
2022-04-19 20:23:45,925 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.173[s] Speed: 92.6[samples/s]
2022-04-19 20:25:29,409 reid_baseline.train INFO: normal accuracy 0.828551755795272 1.656938076019287 
2022-04-19 20:25:29,409 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 20:25:29,409 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 165.7%
2022-04-19 20:25:47,754 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.803, Acc: 0.775, Base Lr: 3.38e-03
2022-04-19 20:25:56,178 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.176[s] Speed: 91.1[samples/s]
2022-04-19 20:27:09,014 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.458329439163208 
2022-04-19 20:27:39,043 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 20:27:39,043 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 145.8%
2022-04-19 20:27:56,782 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.717, Acc: 0.805, Base Lr: 2.77e-03
2022-04-19 20:28:05,270 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.172[s] Speed: 93.0[samples/s]
2022-04-19 20:29:21,597 reid_baseline.train INFO: normal accuracy 0.8303878815698875 1.470274806022644 
2022-04-19 20:29:21,597 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 20:29:21,597 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 147.0%
2022-04-19 20:29:39,703 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.793, Acc: 0.777, Base Lr: 2.20e-03
2022-04-19 20:29:49,015 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.180[s] Speed: 88.9[samples/s]
2022-04-19 20:31:01,107 reid_baseline.train INFO: normal accuracy 0.8331420702318109 1.5299692153930664 
2022-04-19 20:31:01,107 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 20:31:01,108 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 153.0%
2022-04-19 20:31:18,800 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.718, Acc: 0.803, Base Lr: 1.66e-03
2022-04-19 20:31:27,018 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.170[s] Speed: 94.1[samples/s]
2022-04-19 20:32:40,635 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.4524757862091064 
2022-04-19 20:33:10,660 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 20:33:10,661 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 145.2%
2022-04-19 20:33:28,405 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.764, Acc: 0.801, Base Lr: 1.19e-03
2022-04-19 20:33:36,514 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.170[s] Speed: 94.3[samples/s]
2022-04-19 20:34:49,540 reid_baseline.train INFO: normal accuracy 0.8370438375028689 1.5106191635131836 
2022-04-19 20:34:49,540 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 20:34:49,541 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 151.1%
2022-04-19 20:35:07,805 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.770, Acc: 0.784, Base Lr: 7.78e-04
2022-04-19 20:35:15,994 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.174[s] Speed: 92.2[samples/s]
2022-04-19 20:36:26,045 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.507799744606018 
2022-04-19 20:36:26,045 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 20:36:26,045 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 150.8%
2022-04-19 20:36:43,760 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.710, Acc: 0.803, Base Lr: 4.51e-04
2022-04-19 20:36:52,244 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.172[s] Speed: 93.1[samples/s]
2022-04-19 20:38:25,936 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4057884216308594 
2022-04-19 20:38:56,079 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 20:38:56,080 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 140.6%
2022-04-19 20:39:25,822 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.786, Acc: 0.797, Base Lr: 2.11e-04
2022-04-19 20:39:33,951 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.249[s] Speed: 64.3[samples/s]
2022-04-19 20:40:48,687 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.4585604667663574 
2022-04-19 20:40:48,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 20:40:48,687 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 145.9%
2022-04-19 20:41:07,141 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.783, Acc: 0.792, Base Lr: 6.51e-05
2022-04-19 20:41:15,451 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.176[s] Speed: 91.1[samples/s]
2022-04-19 20:42:28,172 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.4283901453018188 
2022-04-19 20:42:28,172 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 20:42:28,172 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 142.8%
2022-04-19 20:42:46,190 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.752, Acc: 0.790, Base Lr: 1.60e-05
2022-04-19 20:42:54,659 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.174[s] Speed: 92.0[samples/s]
2022-04-19 20:44:39,166 reid_baseline.train INFO: normal accuracy 0.836584806059215 1.4222533702850342 
2022-04-19 20:44:39,166 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 20:44:39,167 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 142.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_6/transformer_best_model.pth
2022-04-19 20:46:21,840 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4057884216308594 
2022-04-19 20:46:21,840 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 20:46:21,840 reid_baseline.train INFO: Accuracy: 83.6%
2022-04-19 20:47:34,329 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4057884216308594 
2022-04-19 20:47:34,329 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 20:47:34,329 reid_baseline.train INFO: Shuffled Accuracy: 83.6%
2022-04-19 20:47:53,174 reid_baseline.train INFO: normal accuracy 0.9744540585084467 0.8352575898170471 
2022-04-19 20:47:53,180 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 20:47:53,180 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-19 20:47:56,309 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_8
2022-04-19 20:47:56,310 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-19 20:47:56,310 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 20:47:56,311 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 20:47:56,311 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 20:48:00,398 reid_baseline.train INFO: start training
2022-04-19 20:48:19,959 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.272, Acc: 0.240, Base Lr: 8.72e-04
2022-04-19 20:48:29,280 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.188[s] Speed: 84.9[samples/s]
2022-04-19 20:49:43,871 reid_baseline.train INFO: normal accuracy 0.5701170530181318 4.1720499992370605 
2022-04-19 20:50:13,827 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 20:50:13,828 reid_baseline.train INFO: Accuracy: 57.0% Mean Entropy: 417.2%
2022-04-19 20:50:31,808 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 6.007, Acc: 0.512, Base Lr: 1.66e-03
2022-04-19 20:50:40,506 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.175[s] Speed: 91.2[samples/s]
2022-04-19 20:51:53,143 reid_baseline.train INFO: normal accuracy 0.6006426440211154 4.149781227111816 
2022-04-19 20:52:23,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 20:52:23,178 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 415.0%
2022-04-19 20:52:41,086 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.598, Acc: 0.534, Base Lr: 2.46e-03
2022-04-19 20:52:49,568 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.174[s] Speed: 92.2[samples/s]
2022-04-19 20:54:03,980 reid_baseline.train INFO: normal accuracy 0.627725499196695 3.934906244277954 
2022-04-19 20:54:34,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 20:54:34,022 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 393.5%
2022-04-19 20:54:51,733 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.966, Acc: 0.585, Base Lr: 3.25e-03
2022-04-19 20:55:00,416 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.174[s] Speed: 92.2[samples/s]
2022-04-19 20:56:08,791 reid_baseline.train INFO: normal accuracy 0.6729400963966031 3.2910568714141846 
2022-04-19 20:56:38,840 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 20:56:38,840 reid_baseline.train INFO: Accuracy: 67.3% Mean Entropy: 329.1%
2022-04-19 20:56:56,658 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.535, Acc: 0.613, Base Lr: 4.04e-03
2022-04-19 20:57:04,951 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.172[s] Speed: 93.2[samples/s]
2022-04-19 20:58:16,123 reid_baseline.train INFO: normal accuracy 0.7296304796878587 2.574188232421875 
2022-04-19 20:58:46,156 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 20:58:46,157 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 257.4%
2022-04-19 20:59:03,611 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 4.224, Acc: 0.681, Base Lr: 4.83e-03
2022-04-19 20:59:12,079 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.171[s] Speed: 93.8[samples/s]
2022-04-19 21:00:28,616 reid_baseline.train INFO: normal accuracy 0.7764516869405554 2.2410213947296143 
2022-04-19 21:00:58,648 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 21:00:58,648 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 224.1%
2022-04-19 21:01:16,286 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 4.099, Acc: 0.692, Base Lr: 5.62e-03
2022-04-19 21:01:24,537 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.170[s] Speed: 94.0[samples/s]
2022-04-19 21:02:39,863 reid_baseline.train INFO: normal accuracy 0.807436309387193 2.0006136894226074 
2022-04-19 21:03:09,898 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 21:03:09,899 reid_baseline.train INFO: Accuracy: 80.7% Mean Entropy: 200.1%
2022-04-19 21:03:27,350 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.950, Acc: 0.740, Base Lr: 6.42e-03
2022-04-19 21:03:35,763 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.170[s] Speed: 94.1[samples/s]
2022-04-19 21:04:51,198 reid_baseline.train INFO: normal accuracy 0.8212072526968097 1.747807502746582 
2022-04-19 21:05:21,260 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 21:05:21,262 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 174.8%
2022-04-19 21:05:38,848 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.953, Acc: 0.747, Base Lr: 7.21e-03
2022-04-19 21:05:47,309 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.171[s] Speed: 93.4[samples/s]
2022-04-19 21:07:01,169 reid_baseline.train INFO: normal accuracy 0.8251090199678678 1.5686964988708496 
2022-04-19 21:07:31,211 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 21:07:31,212 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 156.9%
2022-04-19 21:07:48,949 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.843, Acc: 0.773, Base Lr: 4.01e-03
2022-04-19 21:07:57,359 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.172[s] Speed: 93.0[samples/s]
2022-04-19 21:09:40,393 reid_baseline.train INFO: normal accuracy 0.8315354601790222 1.557686448097229 
2022-04-19 21:10:10,419 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 21:10:10,419 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 155.8%
2022-04-19 21:10:28,156 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.817, Acc: 0.792, Base Lr: 3.38e-03
2022-04-19 21:10:36,431 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.171[s] Speed: 93.5[samples/s]
2022-04-19 21:11:50,392 reid_baseline.train INFO: normal accuracy 0.8303878815698875 1.555891513824463 
2022-04-19 21:12:20,429 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 21:12:20,429 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 155.6%
2022-04-19 21:12:38,397 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.791, Acc: 0.783, Base Lr: 2.77e-03
2022-04-19 21:12:46,797 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.173[s] Speed: 92.3[samples/s]
2022-04-19 21:14:01,353 reid_baseline.train INFO: normal accuracy 0.8296993344044067 1.5588178634643555 
2022-04-19 21:14:01,353 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 21:14:01,354 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 155.9%
2022-04-19 21:14:19,429 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.781, Acc: 0.791, Base Lr: 2.20e-03
2022-04-19 21:14:28,726 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.180[s] Speed: 88.9[samples/s]
2022-04-19 21:16:11,995 reid_baseline.train INFO: normal accuracy 0.828322240073445 1.4531291723251343 
2022-04-19 21:16:42,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 21:16:42,143 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 145.3%
2022-04-19 21:17:01,218 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.850, Acc: 0.767, Base Lr: 1.66e-03
2022-04-19 21:17:09,360 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.179[s] Speed: 89.4[samples/s]
2022-04-19 21:18:25,003 reid_baseline.train INFO: normal accuracy 0.83245352306633 1.5716428756713867 
2022-04-19 21:18:25,003 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 21:18:25,003 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 157.2%
2022-04-19 21:18:42,627 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.696, Acc: 0.800, Base Lr: 1.19e-03
2022-04-19 21:18:51,007 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.171[s] Speed: 93.5[samples/s]
2022-04-19 21:20:02,407 reid_baseline.train INFO: normal accuracy 0.8303878815698875 1.493116021156311 
2022-04-19 21:20:02,407 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 21:20:02,407 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 149.3%
2022-04-19 21:20:20,111 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.789, Acc: 0.786, Base Lr: 7.78e-04
2022-04-19 21:20:28,689 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.173[s] Speed: 92.6[samples/s]
2022-04-19 21:21:41,495 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.4917758703231812 
2022-04-19 21:21:41,495 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 21:21:41,496 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 149.2%
2022-04-19 21:21:59,670 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.812, Acc: 0.774, Base Lr: 4.51e-04
2022-04-19 21:22:07,972 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.174[s] Speed: 91.9[samples/s]
2022-04-19 21:23:22,761 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.5042661428451538 
2022-04-19 21:23:22,761 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 21:23:22,761 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 150.4%
2022-04-19 21:23:40,436 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.708, Acc: 0.799, Base Lr: 2.11e-04
2022-04-19 21:23:48,729 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.170[s] Speed: 93.9[samples/s]
2022-04-19 21:25:04,709 reid_baseline.train INFO: normal accuracy 0.8336011016754648 1.4866849184036255 
2022-04-19 21:25:04,709 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 21:25:04,709 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 148.7%
2022-04-19 21:25:22,835 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.777, Acc: 0.801, Base Lr: 6.51e-05
2022-04-19 21:25:31,504 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.176[s] Speed: 91.0[samples/s]
2022-04-19 21:26:48,696 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.365897536277771 
2022-04-19 21:27:18,725 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 21:27:18,725 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 136.6%
2022-04-19 21:27:36,761 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.776, Acc: 0.793, Base Lr: 1.60e-05
2022-04-19 21:27:45,134 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.173[s] Speed: 92.3[samples/s]
2022-04-19 21:29:30,467 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.3824107646942139 
2022-04-19 21:29:30,468 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 21:29:30,468 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 138.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_8/transformer_best_model.pth
2022-04-19 21:31:10,921 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.365897536277771 
2022-04-19 21:31:10,922 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 21:31:10,922 reid_baseline.train INFO: Accuracy: 83.5%
2022-04-19 21:32:22,905 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.365897536277771 
2022-04-19 21:32:22,905 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 21:32:22,906 reid_baseline.train INFO: Shuffled Accuracy: 83.5%
2022-04-19 21:32:41,944 reid_baseline.train INFO: normal accuracy 0.9711578079934075 0.7997542023658752 
2022-04-19 21:32:41,944 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 21:32:41,944 reid_baseline.train INFO: Source Clean Accuracy: 97.1%
