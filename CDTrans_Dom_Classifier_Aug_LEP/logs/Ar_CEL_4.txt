2022-04-21 15:46:02,202 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1
2022-04-21 15:46:02,210 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-21 15:46:02,210 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 15:46:02,211 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 15:46:02,211 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 15:46:11,292 reid_baseline.train INFO: start training
2022-04-21 15:46:56,216 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.998, Acc: 0.302, Base Lr: 8.72e-04
2022-04-21 15:47:10,851 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.7[samples/s]
2022-04-21 15:47:39,862 reid_baseline.train INFO: normal accuracy 0.4043528064146621 4.1715803146362305 
2022-04-21 15:48:12,389 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 15:48:12,389 reid_baseline.train INFO: Accuracy: 40.4% Mean Entropy: 417.2%
2022-04-21 15:48:45,100 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.688, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 15:48:59,275 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-21 15:49:30,194 reid_baseline.train INFO: normal accuracy 0.4300114547537228 4.15116548538208 
2022-04-21 15:50:10,727 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 15:50:10,728 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-21 15:50:40,439 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.112, Acc: 0.633, Base Lr: 2.46e-03
2022-04-21 15:50:58,580 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.315[s] Speed: 50.8[samples/s]
2022-04-21 15:51:32,505 reid_baseline.train INFO: normal accuracy 0.4524627720504009 3.977119207382202 
2022-04-21 15:52:03,352 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 15:52:03,352 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 397.7%
2022-04-21 15:52:32,858 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.323, Acc: 0.669, Base Lr: 3.25e-03
2022-04-21 15:52:47,098 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-21 15:53:35,294 reid_baseline.train INFO: normal accuracy 0.488659793814433 3.4523439407348633 
2022-04-21 15:54:06,351 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 15:54:06,351 reid_baseline.train INFO: Accuracy: 48.9% Mean Entropy: 345.2%
2022-04-21 15:54:42,967 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.811, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 15:55:00,893 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-21 15:55:52,239 reid_baseline.train INFO: normal accuracy 0.5541809851088202 2.9652626514434814 
2022-04-21 15:56:22,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 15:56:22,838 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.5%
2022-04-21 15:56:51,685 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.544, Acc: 0.771, Base Lr: 4.83e-03
2022-04-21 15:57:05,384 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-21 15:57:31,081 reid_baseline.train INFO: normal accuracy 0.6048109965635738 2.6267454624176025 
2022-04-21 15:58:01,617 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 15:58:01,617 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 262.7%
2022-04-21 15:58:31,163 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.377, Acc: 0.801, Base Lr: 5.62e-03
2022-04-21 15:58:44,855 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.284[s] Speed: 56.2[samples/s]
2022-04-21 15:59:10,693 reid_baseline.train INFO: normal accuracy 0.6142038946162658 2.3176627159118652 
2022-04-21 15:59:41,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 15:59:41,395 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.8%
2022-04-21 16:00:10,129 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.188, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 16:00:23,821 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.279[s] Speed: 57.3[samples/s]
2022-04-21 16:00:52,760 reid_baseline.train INFO: normal accuracy 0.6167239404352807 2.096559524536133 
2022-04-21 16:01:23,715 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 16:01:23,716 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 209.7%
2022-04-21 16:01:52,708 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.127, Acc: 0.869, Base Lr: 7.21e-03
2022-04-21 16:02:06,692 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.283[s] Speed: 56.6[samples/s]
2022-04-21 16:02:32,445 reid_baseline.train INFO: normal accuracy 0.6116838487972509 1.9750525951385498 
2022-04-21 16:03:03,034 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 16:03:03,035 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 197.5%
2022-04-21 16:03:38,637 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.059, Acc: 0.890, Base Lr: 4.01e-03
2022-04-21 16:03:56,220 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-21 16:04:54,015 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.9272916316986084 
2022-04-21 16:05:24,637 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 16:05:24,638 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.7%
2022-04-21 16:05:53,215 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.995, Acc: 0.912, Base Lr: 3.38e-03
2022-04-21 16:06:07,145 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-21 16:06:33,984 reid_baseline.train INFO: normal accuracy 0.6274914089347079 1.8661794662475586 
2022-04-21 16:07:04,791 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 16:07:04,792 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 186.6%
2022-04-21 16:07:33,757 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.012, Acc: 0.918, Base Lr: 2.77e-03
2022-04-21 16:07:47,605 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.282[s] Speed: 56.8[samples/s]
2022-04-21 16:08:35,810 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.869776964187622 
2022-04-21 16:08:35,811 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 16:08:35,811 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.0%
2022-04-21 16:09:04,629 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.005, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 16:09:19,065 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.285[s] Speed: 56.2[samples/s]
2022-04-21 16:10:01,027 reid_baseline.train INFO: normal accuracy 0.6247422680412371 1.8863829374313354 
2022-04-21 16:10:01,027 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 16:10:01,027 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.6%
2022-04-21 16:10:33,114 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.963, Acc: 0.921, Base Lr: 1.66e-03
2022-04-21 16:10:47,427 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-21 16:11:31,182 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.8602157831192017 
2022-04-21 16:12:01,808 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 16:12:01,809 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.0%
2022-04-21 16:12:35,652 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.940, Acc: 0.936, Base Lr: 1.19e-03
2022-04-21 16:12:53,744 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-21 16:13:23,443 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.8521994352340698 
2022-04-21 16:13:54,098 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 16:13:54,099 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 185.2%
2022-04-21 16:14:22,867 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.936, Acc: 0.925, Base Lr: 7.78e-04
2022-04-21 16:14:36,666 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.280[s] Speed: 57.1[samples/s]
2022-04-21 16:15:02,626 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.760260820388794 
2022-04-21 16:15:33,245 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 16:15:33,246 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.0%
2022-04-21 16:16:04,482 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.932, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 16:16:21,604 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-21 16:16:47,572 reid_baseline.train INFO: normal accuracy 0.636197021764032 1.8775455951690674 
2022-04-21 16:16:47,572 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 16:16:47,572 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 187.8%
2022-04-21 16:17:16,327 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.925, Acc: 0.934, Base Lr: 2.11e-04
2022-04-21 16:17:29,883 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.278[s] Speed: 57.5[samples/s]
2022-04-21 16:18:00,763 reid_baseline.train INFO: normal accuracy 0.633906071019473 1.8318804502487183 
2022-04-21 16:18:00,763 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 16:18:00,763 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.2%
2022-04-21 16:18:30,440 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.936, Acc: 0.923, Base Lr: 6.51e-05
2022-04-21 16:18:48,959 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-21 16:19:15,427 reid_baseline.train INFO: normal accuracy 0.6316151202749141 1.8686354160308838 
2022-04-21 16:19:15,428 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 16:19:15,428 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 186.9%
2022-04-21 16:19:43,931 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.935, Acc: 0.926, Base Lr: 1.60e-05
2022-04-21 16:19:57,343 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.276[s] Speed: 58.0[samples/s]
2022-04-21 16:21:05,549 reid_baseline.train INFO: normal accuracy 0.6350515463917525 1.8682498931884766 
2022-04-21 16:21:05,550 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 16:21:05,550 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 186.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-21 16:22:06,827 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.760260820388794 
2022-04-21 16:22:06,828 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 16:22:06,828 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-21 16:22:35,854 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.760260820388794 
2022-04-21 16:22:35,855 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 16:22:35,855 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-21 16:22:55,677 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7763981819152832 
2022-04-21 16:22:55,677 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 16:22:55,677 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 16:23:00,580 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1
2022-04-21 16:23:00,580 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-21 16:23:00,580 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 16:23:00,581 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 16:23:00,582 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 16:23:08,185 reid_baseline.train INFO: start training
2022-04-21 16:23:44,506 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.998, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 16:24:00,116 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.340[s] Speed: 47.1[samples/s]
2022-04-21 16:24:39,129 reid_baseline.train INFO: normal accuracy 0.5215138544717278 4.171815395355225 
2022-04-21 16:25:09,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 16:25:09,853 reid_baseline.train INFO: Accuracy: 52.2% Mean Entropy: 417.2%
2022-04-21 16:25:39,977 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.688, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 16:25:56,123 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-21 16:26:36,981 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.149555206298828 
2022-04-21 16:27:16,790 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 16:27:16,790 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-21 16:27:47,285 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.112, Acc: 0.632, Base Lr: 2.46e-03
2022-04-21 16:28:02,114 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-21 16:28:54,593 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.9584896564483643 
2022-04-21 16:29:25,727 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 16:29:25,727 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 395.8%
2022-04-21 16:29:56,784 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.322, Acc: 0.669, Base Lr: 3.25e-03
2022-04-21 16:30:12,245 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-21 16:30:44,476 reid_baseline.train INFO: normal accuracy 0.5913494030186979 3.378598690032959 
2022-04-21 16:31:15,739 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 16:31:15,739 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 337.9%
2022-04-21 16:31:45,945 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.811, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 16:32:00,839 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 16:32:28,709 reid_baseline.train INFO: normal accuracy 0.668168506420365 2.7769758701324463 
2022-04-21 16:32:59,774 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 16:32:59,775 reid_baseline.train INFO: Accuracy: 66.8% Mean Entropy: 277.7%
2022-04-21 16:33:31,494 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.544, Acc: 0.771, Base Lr: 4.83e-03
2022-04-21 16:33:49,558 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.328[s] Speed: 48.9[samples/s]
2022-04-21 16:34:16,981 reid_baseline.train INFO: normal accuracy 0.7328227078170759 2.407426595687866 
2022-04-21 16:34:47,574 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 16:34:47,574 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 240.7%
2022-04-21 16:35:18,438 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.376, Acc: 0.800, Base Lr: 5.62e-03
2022-04-21 16:35:32,783 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-21 16:36:22,836 reid_baseline.train INFO: normal accuracy 0.7560261320117143 2.0752336978912354 
2022-04-21 16:36:53,829 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 16:36:53,830 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.5%
2022-04-21 16:37:23,718 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.188, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 16:37:38,383 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-21 16:38:20,893 reid_baseline.train INFO: normal accuracy 0.7672899301644515 1.871497392654419 
2022-04-21 16:38:51,943 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 16:38:51,944 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 187.1%
2022-04-21 16:39:28,126 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.126, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 16:39:46,248 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-21 16:40:17,721 reid_baseline.train INFO: normal accuracy 0.779905384095517 1.7680314779281616 
2022-04-21 16:40:48,993 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 16:40:48,994 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 176.8%
2022-04-21 16:41:26,473 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.059, Acc: 0.891, Base Lr: 4.01e-03
2022-04-21 16:41:40,905 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-21 16:42:39,370 reid_baseline.train INFO: normal accuracy 0.7810317639107908 1.7268415689468384 
2022-04-21 16:43:09,959 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 16:43:09,959 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.7%
2022-04-21 16:43:42,383 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.995, Acc: 0.912, Base Lr: 3.38e-03
2022-04-21 16:43:58,811 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-21 16:44:27,680 reid_baseline.train INFO: normal accuracy 0.7821581437260644 1.67703115940094 
2022-04-21 16:44:58,367 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 16:44:58,368 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.7%
2022-04-21 16:45:28,605 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.012, Acc: 0.919, Base Lr: 2.77e-03
2022-04-21 16:45:43,038 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-21 16:46:10,112 reid_baseline.train INFO: normal accuracy 0.7821581437260644 1.6752065420150757 
2022-04-21 16:46:42,961 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 16:46:42,961 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.5%
2022-04-21 16:47:13,051 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.005, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 16:47:28,405 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 16:47:55,748 reid_baseline.train INFO: normal accuracy 0.782608695652174 1.6975051164627075 
2022-04-21 16:47:55,749 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 16:47:55,749 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 169.8%
2022-04-21 16:48:30,228 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.963, Acc: 0.920, Base Lr: 1.66e-03
2022-04-21 16:48:48,613 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-21 16:49:21,677 reid_baseline.train INFO: normal accuracy 0.7857625591349403 1.6689547300338745 
2022-04-21 16:49:52,274 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 16:49:52,275 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 166.9%
2022-04-21 16:50:22,443 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.940, Acc: 0.935, Base Lr: 1.19e-03
2022-04-21 16:50:37,386 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 16:51:05,768 reid_baseline.train INFO: normal accuracy 0.7853120072088308 1.6726963520050049 
2022-04-21 16:51:05,769 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 16:51:05,769 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 167.3%
2022-04-21 16:51:35,889 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.936, Acc: 0.926, Base Lr: 7.78e-04
2022-04-21 16:51:50,324 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-21 16:52:22,495 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5716058015823364 
2022-04-21 16:52:53,240 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 16:52:53,240 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.2%
2022-04-21 16:53:23,453 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.933, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 16:53:37,964 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-21 16:54:04,356 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.684685468673706 
2022-04-21 16:54:04,357 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 16:54:04,357 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.5%
2022-04-21 16:54:34,164 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.925, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 16:54:48,309 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-21 16:55:14,583 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.6439268589019775 
2022-04-21 16:55:14,584 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 16:55:14,584 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.4%
2022-04-21 16:55:44,737 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.937, Acc: 0.925, Base Lr: 6.51e-05
2022-04-21 16:55:59,349 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-21 16:56:27,620 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.6868749856948853 
2022-04-21 16:56:27,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 16:56:27,620 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
2022-04-21 16:56:57,614 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.935, Acc: 0.924, Base Lr: 1.60e-05
2022-04-21 16:57:11,631 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.290[s] Speed: 55.3[samples/s]
2022-04-21 16:58:12,904 reid_baseline.train INFO: normal accuracy 0.7841856273935571 1.6874748468399048 
2022-04-21 16:58:12,905 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 16:58:12,905 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 168.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-21 16:59:28,836 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5716058015823364 
2022-04-21 16:59:28,836 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 16:59:28,837 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-21 17:00:17,241 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5716058015823364 
2022-04-21 17:00:17,241 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 17:00:17,241 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-21 17:00:37,214 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7762633562088013 
2022-04-21 17:00:37,214 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 17:00:37,215 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 17:00:41,835 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1
2022-04-21 17:00:41,835 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-21 17:00:41,835 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 17:00:41,836 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 17:00:41,837 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 17:00:49,418 reid_baseline.train INFO: start training
2022-04-21 17:01:21,967 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.998, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 17:01:37,486 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.314[s] Speed: 50.9[samples/s]
2022-04-21 17:03:54,583 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.171506404876709 
2022-04-21 17:04:24,996 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 17:04:24,996 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-21 17:04:55,194 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.687, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 17:05:09,938 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-21 17:06:47,332 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.138622760772705 
2022-04-21 17:07:17,874 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 17:07:17,874 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-21 17:07:48,797 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.112, Acc: 0.632, Base Lr: 2.46e-03
2022-04-21 17:08:03,645 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-21 17:09:23,531 reid_baseline.train INFO: normal accuracy 0.6369061280697728 3.843597412109375 
2022-04-21 17:09:54,789 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 17:09:54,789 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-21 17:10:26,026 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.323, Acc: 0.669, Base Lr: 3.25e-03
2022-04-21 17:10:41,008 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-21 17:11:51,621 reid_baseline.train INFO: normal accuracy 0.6823502409915079 3.1002230644226074 
2022-04-21 17:12:22,169 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 17:12:22,170 reid_baseline.train INFO: Accuracy: 68.2% Mean Entropy: 310.0%
2022-04-21 17:12:52,183 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.811, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 17:13:07,666 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 17:14:25,673 reid_baseline.train INFO: normal accuracy 0.7438604544411292 2.4532015323638916 
2022-04-21 17:14:56,078 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 17:14:56,078 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-21 17:15:34,482 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.544, Acc: 0.771, Base Lr: 4.83e-03
2022-04-21 17:15:52,647 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-21 17:17:17,476 reid_baseline.train INFO: normal accuracy 0.7895340830846913 2.080251455307007 
2022-04-21 17:17:47,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 17:17:47,846 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 208.0%
2022-04-21 17:18:18,565 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.376, Acc: 0.801, Base Lr: 5.62e-03
2022-04-21 17:18:32,974 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 17:19:40,651 reid_baseline.train INFO: normal accuracy 0.8113380766582511 1.8068506717681885 
2022-04-21 17:20:11,108 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 17:20:11,109 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.7%
2022-04-21 17:20:41,048 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.188, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 17:20:55,382 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-21 17:21:59,348 reid_baseline.train INFO: normal accuracy 0.8205187055313289 1.622442603111267 
2022-04-21 17:22:29,887 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 17:22:29,888 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.2%
2022-04-21 17:23:00,725 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.126, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 17:23:17,635 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.314[s] Speed: 50.9[samples/s]
2022-04-21 17:24:30,172 reid_baseline.train INFO: normal accuracy 0.8235024099150792 1.5146526098251343 
2022-04-21 17:25:00,732 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 17:25:00,732 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 151.5%
2022-04-21 17:25:32,860 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.059, Acc: 0.890, Base Lr: 4.01e-03
2022-04-21 17:25:47,480 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-21 17:27:36,372 reid_baseline.train INFO: normal accuracy 0.8296993344044067 1.4832454919815063 
2022-04-21 17:28:06,950 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 17:28:06,951 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-21 17:28:37,088 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.995, Acc: 0.911, Base Lr: 3.38e-03
2022-04-21 17:28:51,633 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-21 17:30:11,721 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.4332016706466675 
2022-04-21 17:30:42,712 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 17:30:42,712 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 143.3%
2022-04-21 17:31:12,981 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.012, Acc: 0.919, Base Lr: 2.77e-03
2022-04-21 17:31:27,503 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-21 17:32:27,689 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4379621744155884 
2022-04-21 17:32:27,690 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 17:32:27,690 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 143.8%
2022-04-21 17:32:59,629 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.005, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 17:33:19,670 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-21 17:34:28,710 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4586396217346191 
2022-04-21 17:34:28,710 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 17:34:28,711 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.9%
2022-04-21 17:35:03,333 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.963, Acc: 0.920, Base Lr: 1.66e-03
2022-04-21 17:35:18,233 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-21 17:36:23,275 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.4418450593948364 
2022-04-21 17:36:23,275 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 17:36:23,276 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.2%
2022-04-21 17:36:53,633 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.940, Acc: 0.935, Base Lr: 1.19e-03
2022-04-21 17:37:08,657 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-21 17:38:10,469 reid_baseline.train INFO: normal accuracy 0.836584806059215 1.4454960823059082 
2022-04-21 17:38:10,470 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 17:38:10,470 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 144.5%
2022-04-21 17:38:40,804 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.936, Acc: 0.927, Base Lr: 7.78e-04
2022-04-21 17:38:55,376 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-21 17:40:13,046 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.3539724349975586 
2022-04-21 17:40:43,525 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 17:40:43,526 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 135.4%
2022-04-21 17:41:13,579 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.932, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 17:41:28,079 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-21 17:42:34,636 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.4680657386779785 
2022-04-21 17:42:34,636 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 17:42:34,636 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.8%
2022-04-21 17:43:12,728 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.925, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 17:43:28,057 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.351[s] Speed: 45.5[samples/s]
2022-04-21 17:44:28,989 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4282758235931396 
2022-04-21 17:44:28,990 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 17:44:28,990 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 142.8%
2022-04-21 17:44:59,515 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.937, Acc: 0.924, Base Lr: 6.51e-05
2022-04-21 17:45:14,406 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-21 17:46:17,717 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4660887718200684 
2022-04-21 17:46:17,718 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 17:46:17,718 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-21 17:46:47,868 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.935, Acc: 0.925, Base Lr: 1.60e-05
2022-04-21 17:47:02,056 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-21 17:48:37,646 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4668992757797241 
2022-04-21 17:48:37,646 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 17:48:37,646 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-21 17:50:09,864 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.3539724349975586 
2022-04-21 17:50:09,865 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 17:50:09,865 reid_baseline.train INFO: Accuracy: 83.8%
2022-04-21 17:51:11,437 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.3539724349975586 
2022-04-21 17:51:11,438 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 17:51:11,438 reid_baseline.train INFO: Shuffled Accuracy: 83.8%
2022-04-21 17:51:35,838 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.776227593421936 
2022-04-21 17:51:35,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 17:51:35,838 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 17:51:41,213 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2
2022-04-21 17:51:41,213 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-21 17:51:41,213 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 17:51:41,214 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 17:51:41,214 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 17:51:50,431 reid_baseline.train INFO: start training
2022-04-21 17:52:26,822 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.991, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 17:52:42,564 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.341[s] Speed: 47.0[samples/s]
2022-04-21 17:53:15,314 reid_baseline.train INFO: normal accuracy 0.404581901489118 4.1715803146362305 
2022-04-21 17:53:45,762 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 17:53:45,762 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 417.2%
2022-04-21 17:54:16,550 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.680, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 17:54:31,608 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-21 17:54:57,363 reid_baseline.train INFO: normal accuracy 0.4302405498281787 4.151164531707764 
2022-04-21 17:55:28,476 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 17:55:28,477 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-21 17:55:59,540 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.092, Acc: 0.632, Base Lr: 2.46e-03
2022-04-21 17:56:14,426 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-21 17:56:41,536 reid_baseline.train INFO: normal accuracy 0.4526918671248568 3.977104902267456 
2022-04-21 17:57:11,978 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 17:57:11,978 reid_baseline.train INFO: Accuracy: 45.3% Mean Entropy: 397.7%
2022-04-21 17:57:43,521 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.287, Acc: 0.669, Base Lr: 3.25e-03
2022-04-21 17:57:58,550 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-21 17:58:24,165 reid_baseline.train INFO: normal accuracy 0.4879725085910653 3.453004837036133 
2022-04-21 17:58:58,893 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 17:58:58,894 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 345.3%
2022-04-21 17:59:29,790 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.790, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 17:59:44,905 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-21 18:00:13,990 reid_baseline.train INFO: normal accuracy 0.5539518900343643 2.965855121612549 
2022-04-21 18:00:44,421 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 18:00:44,422 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.6%
2022-04-21 18:01:19,777 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.497, Acc: 0.771, Base Lr: 4.83e-03
2022-04-21 18:01:34,442 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-21 18:02:00,433 reid_baseline.train INFO: normal accuracy 0.6050400916380297 2.625887393951416 
2022-04-21 18:02:31,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 18:02:31,843 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 262.6%
2022-04-21 18:03:03,366 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.327, Acc: 0.801, Base Lr: 5.62e-03
2022-04-21 18:03:17,923 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-21 18:03:44,375 reid_baseline.train INFO: normal accuracy 0.6139747995418099 2.3180220127105713 
2022-04-21 18:04:15,856 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 18:04:15,857 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.8%
2022-04-21 18:04:47,203 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.150, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 18:05:05,481 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.326[s] Speed: 49.0[samples/s]
2022-04-21 18:05:32,827 reid_baseline.train INFO: normal accuracy 0.6158075601374571 2.0975606441497803 
2022-04-21 18:06:04,072 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 18:06:04,072 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 209.8%
2022-04-21 18:06:34,933 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.084, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 18:06:49,784 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-21 18:07:34,098 reid_baseline.train INFO: normal accuracy 0.6139747995418099 1.9771404266357422 
2022-04-21 18:08:04,834 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 18:08:04,834 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 197.7%
2022-04-21 18:08:36,150 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.000, Acc: 0.890, Base Lr: 4.01e-03
2022-04-21 18:08:50,977 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-21 18:09:51,970 reid_baseline.train INFO: normal accuracy 0.6210767468499427 1.9270310401916504 
2022-04-21 18:10:23,098 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 18:10:23,098 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.7%
2022-04-21 18:10:53,556 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.978, Acc: 0.911, Base Lr: 3.38e-03
2022-04-21 18:11:08,249 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 18:11:35,000 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.866634488105774 
2022-04-21 18:12:06,023 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 18:12:06,023 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.7%
2022-04-21 18:12:36,526 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.941, Acc: 0.918, Base Lr: 2.77e-03
2022-04-21 18:12:51,201 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-21 18:13:17,689 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.87157142162323 
2022-04-21 18:13:17,690 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 18:13:17,690 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.2%
2022-04-21 18:13:48,262 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.924, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 18:14:07,881 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-21 18:14:44,943 reid_baseline.train INFO: normal accuracy 0.6252004581901489 1.886398434638977 
2022-04-21 18:14:44,944 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 18:14:44,944 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.6%
2022-04-21 18:15:14,922 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.929, Acc: 0.920, Base Lr: 1.66e-03
2022-04-21 18:15:29,966 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-21 18:15:56,667 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.860721468925476 
2022-04-21 18:16:27,273 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 18:16:27,274 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.1%
2022-04-21 18:16:58,321 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.895, Acc: 0.935, Base Lr: 1.19e-03
2022-04-21 18:17:13,648 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-21 18:17:39,840 reid_baseline.train INFO: normal accuracy 0.6320733104238259 1.8517743349075317 
2022-04-21 18:18:09,957 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 18:18:09,957 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 185.2%
2022-04-21 18:18:49,281 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.907, Acc: 0.927, Base Lr: 7.78e-04
2022-04-21 18:19:06,487 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-21 18:19:33,080 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.760310411453247 
2022-04-21 18:20:03,294 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 18:20:03,295 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.0%
2022-04-21 18:20:33,527 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.869, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 18:20:48,763 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 18:21:28,885 reid_baseline.train INFO: normal accuracy 0.6357388316151202 1.8781919479370117 
2022-04-21 18:21:28,886 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 18:21:28,886 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 187.8%
2022-04-21 18:21:59,562 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.893, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 18:22:13,893 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-21 18:22:39,423 reid_baseline.train INFO: normal accuracy 0.6345933562428407 1.83245050907135 
2022-04-21 18:22:39,424 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 18:22:39,424 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 183.2%
2022-04-21 18:23:13,025 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.886, Acc: 0.923, Base Lr: 6.51e-05
2022-04-21 18:23:28,894 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-21 18:23:55,374 reid_baseline.train INFO: normal accuracy 0.6313860252004582 1.8690235614776611 
2022-04-21 18:23:55,375 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 18:23:55,375 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.9%
2022-04-21 18:24:25,854 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.888, Acc: 0.925, Base Lr: 1.60e-05
2022-04-21 18:24:40,083 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-21 18:25:53,255 reid_baseline.train INFO: normal accuracy 0.6345933562428407 1.8693804740905762 
2022-04-21 18:25:53,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 18:25:53,256 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 186.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-21 18:26:49,922 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.760310411453247 
2022-04-21 18:26:49,922 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 18:26:49,922 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-21 18:27:25,774 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.760310411453247 
2022-04-21 18:27:25,774 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 18:27:25,775 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-21 18:28:01,440 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7760881185531616 
2022-04-21 18:28:01,440 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 18:28:01,440 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 18:28:06,354 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2
2022-04-21 18:28:06,355 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-21 18:28:06,355 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 18:28:06,356 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 18:28:06,356 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 18:28:14,000 reid_baseline.train INFO: start training
2022-04-21 18:28:46,807 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.991, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 18:29:02,665 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-21 18:29:29,591 reid_baseline.train INFO: normal accuracy 0.5212885785086732 4.171815395355225 
2022-04-21 18:30:00,400 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 18:30:00,401 reid_baseline.train INFO: Accuracy: 52.1% Mean Entropy: 417.2%
2022-04-21 18:30:31,165 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.680, Acc: 0.594, Base Lr: 1.66e-03
2022-04-21 18:30:46,142 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-21 18:31:12,353 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.149555206298828 
2022-04-21 18:31:42,401 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 18:31:42,402 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-21 18:32:19,400 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.092, Acc: 0.633, Base Lr: 2.46e-03
2022-04-21 18:32:34,541 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-21 18:33:02,199 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.9584708213806152 
2022-04-21 18:33:32,781 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 18:33:32,781 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 395.8%
2022-04-21 18:34:11,646 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.287, Acc: 0.670, Base Lr: 3.25e-03
2022-04-21 18:34:27,052 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-21 18:34:53,178 reid_baseline.train INFO: normal accuracy 0.5911241270556432 3.3781752586364746 
2022-04-21 18:35:23,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 18:35:23,178 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 337.8%
2022-04-21 18:35:56,725 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.790, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 18:36:15,851 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.347[s] Speed: 46.2[samples/s]
2022-04-21 18:37:01,921 reid_baseline.train INFO: normal accuracy 0.6686190583464744 2.776876449584961 
2022-04-21 18:37:31,942 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 18:37:31,943 reid_baseline.train INFO: Accuracy: 66.9% Mean Entropy: 277.7%
2022-04-21 18:38:02,715 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.497, Acc: 0.771, Base Lr: 4.83e-03
2022-04-21 18:38:17,365 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 18:39:05,445 reid_baseline.train INFO: normal accuracy 0.7346249155215139 2.408730983734131 
2022-04-21 18:39:35,514 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 18:39:35,514 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 240.9%
2022-04-21 18:40:07,061 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.327, Acc: 0.800, Base Lr: 5.62e-03
2022-04-21 18:40:21,766 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-21 18:40:48,398 reid_baseline.train INFO: normal accuracy 0.7564766839378239 2.0757687091827393 
2022-04-21 18:41:18,453 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 18:41:18,454 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.6%
2022-04-21 18:41:48,844 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.149, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 18:42:03,383 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-21 18:42:30,463 reid_baseline.train INFO: normal accuracy 0.7668393782383419 1.8711848258972168 
2022-04-21 18:43:01,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 18:43:01,603 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 187.1%
2022-04-21 18:43:32,469 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.085, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 18:43:47,226 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-21 18:44:13,707 reid_baseline.train INFO: normal accuracy 0.7794548321694075 1.765974998474121 
2022-04-21 18:44:43,753 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 18:44:43,753 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 176.6%
2022-04-21 18:45:23,057 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.999, Acc: 0.892, Base Lr: 4.01e-03
2022-04-21 18:45:41,490 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-21 18:46:39,176 reid_baseline.train INFO: normal accuracy 0.7805812119846812 1.7263239622116089 
2022-04-21 18:47:09,207 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 18:47:09,207 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.6%
2022-04-21 18:47:39,632 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.979, Acc: 0.912, Base Lr: 3.38e-03
2022-04-21 18:47:54,454 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.298[s] Speed: 53.8[samples/s]
2022-04-21 18:48:22,238 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.6771059036254883 
2022-04-21 18:48:52,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 18:48:52,288 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.7%
2022-04-21 18:49:22,953 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.941, Acc: 0.918, Base Lr: 2.77e-03
2022-04-21 18:49:37,743 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 18:50:03,928 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.6733119487762451 
2022-04-21 18:50:33,993 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 18:50:33,994 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.3%
2022-04-21 18:51:06,109 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.924, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 18:51:25,522 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-21 18:51:52,238 reid_baseline.train INFO: normal accuracy 0.7821581437260644 1.6965341567993164 
2022-04-21 18:51:52,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 18:51:52,239 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 169.7%
2022-04-21 18:52:22,367 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.929, Acc: 0.921, Base Lr: 1.66e-03
2022-04-21 18:52:37,713 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 18:53:21,424 reid_baseline.train INFO: normal accuracy 0.7868889389502141 1.6683320999145508 
2022-04-21 18:53:52,117 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 18:53:52,117 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 166.8%
2022-04-21 18:54:34,285 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.895, Acc: 0.935, Base Lr: 1.19e-03
2022-04-21 18:54:53,191 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.402[s] Speed: 39.8[samples/s]
2022-04-21 18:55:21,946 reid_baseline.train INFO: normal accuracy 0.7857625591349403 1.6731082201004028 
2022-04-21 18:55:21,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 18:55:21,946 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.3%
2022-04-21 18:55:52,569 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.907, Acc: 0.926, Base Lr: 7.78e-04
2022-04-21 18:56:07,291 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-21 18:56:33,976 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5713496208190918 
2022-04-21 18:57:04,031 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 18:57:04,032 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.1%
2022-04-21 18:57:34,421 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.869, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 18:57:49,282 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-21 18:58:15,821 reid_baseline.train INFO: normal accuracy 0.7855372831718855 1.6840134859085083 
2022-04-21 18:58:15,822 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 18:58:15,822 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 168.4%
2022-04-21 18:58:48,529 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.893, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 18:59:05,337 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.326[s] Speed: 49.1[samples/s]
2022-04-21 18:59:31,656 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.6431877613067627 
2022-04-21 18:59:31,656 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 18:59:31,657 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.3%
2022-04-21 19:00:02,384 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.886, Acc: 0.923, Base Lr: 6.51e-05
2022-04-21 19:00:17,412 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-21 19:00:50,998 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.686547875404358 
2022-04-21 19:00:50,998 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 19:00:50,998 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
2022-04-21 19:01:27,171 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.888, Acc: 0.925, Base Lr: 1.60e-05
2022-04-21 19:01:41,519 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.332[s] Speed: 48.1[samples/s]
2022-04-21 19:02:38,117 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.6864269971847534 
2022-04-21 19:02:38,118 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 19:02:38,118 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 168.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-21 19:03:55,195 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5713496208190918 
2022-04-21 19:03:55,195 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 19:03:55,196 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-21 19:04:22,608 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5713496208190918 
2022-04-21 19:04:22,608 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 19:04:22,608 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-21 19:04:43,208 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7762683033943176 
2022-04-21 19:04:43,208 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 19:04:43,208 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 19:04:47,871 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2
2022-04-21 19:04:47,871 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-21 19:04:47,871 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 19:04:47,872 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 19:04:47,873 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 19:04:55,550 reid_baseline.train INFO: start training
2022-04-21 19:05:28,436 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.991, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 19:05:47,885 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-21 19:06:52,282 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.171506404876709 
2022-04-21 19:07:22,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 19:07:22,192 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-21 19:07:54,752 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.680, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 19:08:12,650 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-21 19:09:12,230 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.138621807098389 
2022-04-21 19:09:42,252 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 19:09:42,252 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-21 19:10:13,932 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.092, Acc: 0.633, Base Lr: 2.46e-03
2022-04-21 19:10:32,092 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-21 19:11:36,093 reid_baseline.train INFO: normal accuracy 0.6369061280697728 3.843602418899536 
2022-04-21 19:12:06,106 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 19:12:06,106 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-21 19:12:46,080 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.287, Acc: 0.669, Base Lr: 3.25e-03
2022-04-21 19:13:04,661 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.385[s] Speed: 41.5[samples/s]
2022-04-21 19:14:04,511 reid_baseline.train INFO: normal accuracy 0.6825797567133348 3.1002912521362305 
2022-04-21 19:14:34,512 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 19:14:34,513 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 310.0%
2022-04-21 19:15:06,619 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.790, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 19:15:24,761 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-21 19:16:25,657 reid_baseline.train INFO: normal accuracy 0.7443194858847831 2.453143358230591 
2022-04-21 19:16:55,656 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 19:16:55,656 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-21 19:17:27,662 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.496, Acc: 0.772, Base Lr: 4.83e-03
2022-04-21 19:17:45,441 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.327[s] Speed: 48.9[samples/s]
2022-04-21 19:18:46,287 reid_baseline.train INFO: normal accuracy 0.7893045673628644 2.0807743072509766 
2022-04-21 19:19:16,927 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 19:19:16,927 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 208.1%
2022-04-21 19:19:50,887 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.327, Acc: 0.800, Base Lr: 5.62e-03
2022-04-21 19:20:05,616 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-21 19:21:06,786 reid_baseline.train INFO: normal accuracy 0.8108790452145972 1.8070379495620728 
2022-04-21 19:21:36,803 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 19:21:36,804 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.7%
2022-04-21 19:22:13,342 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.149, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 19:22:30,149 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-21 19:23:29,937 reid_baseline.train INFO: normal accuracy 0.8212072526968097 1.6226425170898438 
2022-04-21 19:23:59,958 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 19:23:59,958 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.3%
2022-04-21 19:24:32,783 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.085, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 19:24:49,832 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-21 19:25:51,830 reid_baseline.train INFO: normal accuracy 0.8232728941932522 1.5125399827957153 
2022-04-21 19:26:21,861 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 19:26:21,861 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 151.3%
2022-04-21 19:26:53,303 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.999, Acc: 0.891, Base Lr: 4.01e-03
2022-04-21 19:27:08,033 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-21 19:28:39,480 reid_baseline.train INFO: normal accuracy 0.8303878815698875 1.4829695224761963 
2022-04-21 19:29:09,524 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 19:29:09,525 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-21 19:29:40,174 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.978, Acc: 0.911, Base Lr: 3.38e-03
2022-04-21 19:29:56,859 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-21 19:31:05,875 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.4360440969467163 
2022-04-21 19:31:36,647 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 19:31:36,647 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.6%
2022-04-21 19:32:08,843 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.941, Acc: 0.919, Base Lr: 2.77e-03
2022-04-21 19:32:23,517 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-21 19:33:22,413 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4386062622070312 
2022-04-21 19:33:22,414 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 19:33:22,414 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 143.9%
2022-04-21 19:33:53,281 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.924, Acc: 0.912, Base Lr: 2.20e-03
2022-04-21 19:34:08,920 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-21 19:35:09,397 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4583396911621094 
2022-04-21 19:35:09,398 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 19:35:09,398 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.8%
2022-04-21 19:35:39,682 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.929, Acc: 0.921, Base Lr: 1.66e-03
2022-04-21 19:35:54,683 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-21 19:36:58,710 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4415100812911987 
2022-04-21 19:36:58,710 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 19:36:58,711 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 144.2%
2022-04-21 19:37:29,788 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.895, Acc: 0.935, Base Lr: 1.19e-03
2022-04-21 19:37:47,105 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-21 19:38:53,450 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.445970058441162 
2022-04-21 19:38:53,450 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 19:38:53,450 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 144.6%
2022-04-21 19:39:32,856 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.907, Acc: 0.926, Base Lr: 7.78e-04
2022-04-21 19:39:51,253 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-21 19:41:12,734 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.3538466691970825 
2022-04-21 19:41:42,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 19:41:42,792 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 135.4%
2022-04-21 19:42:13,187 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.869, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 19:42:27,957 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 19:43:29,902 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.4678877592086792 
2022-04-21 19:43:29,902 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 19:43:29,903 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.8%
2022-04-21 19:44:00,431 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.893, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 19:44:14,765 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-21 19:45:15,888 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4282844066619873 
2022-04-21 19:45:15,888 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 19:45:15,889 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 142.8%
2022-04-21 19:45:46,714 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.886, Acc: 0.923, Base Lr: 6.51e-05
2022-04-21 19:46:01,778 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-21 19:47:21,823 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.4661450386047363 
2022-04-21 19:47:21,823 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 19:47:21,823 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-21 19:47:52,558 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.888, Acc: 0.925, Base Lr: 1.60e-05
2022-04-21 19:48:10,340 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.319[s] Speed: 50.1[samples/s]
2022-04-21 19:49:46,217 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.466008186340332 
2022-04-21 19:49:46,217 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 19:49:46,218 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-21 19:51:24,954 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.3538466691970825 
2022-04-21 19:51:24,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 19:51:24,955 reid_baseline.train INFO: Accuracy: 83.8%
2022-04-21 19:52:26,392 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.3538466691970825 
2022-04-21 19:52:26,392 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 19:52:26,392 reid_baseline.train INFO: Shuffled Accuracy: 83.8%
2022-04-21 19:52:46,850 reid_baseline.train INFO: normal accuracy 0.9752781211372065 0.7762580513954163 
2022-04-21 19:52:46,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 19:52:46,851 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 19:52:51,607 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3
2022-04-21 19:52:51,607 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-21 19:52:51,607 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 19:52:51,608 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 19:52:51,609 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 19:52:59,233 reid_baseline.train INFO: start training
2022-04-21 19:53:32,877 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.022, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 19:53:52,629 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.349[s] Speed: 45.8[samples/s]
2022-04-21 19:54:20,079 reid_baseline.train INFO: normal accuracy 0.404581901489118 4.1715803146362305 
2022-04-21 19:54:50,811 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 19:54:50,811 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 417.2%
2022-04-21 19:55:21,482 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.715, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 19:55:36,440 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-21 19:56:02,172 reid_baseline.train INFO: normal accuracy 0.4302405498281787 4.151165962219238 
2022-04-21 19:56:32,269 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 19:56:32,270 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-21 19:57:07,987 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.127, Acc: 0.633, Base Lr: 2.46e-03
2022-04-21 19:57:27,120 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-21 19:57:59,122 reid_baseline.train INFO: normal accuracy 0.4524627720504009 3.9771130084991455 
2022-04-21 19:58:32,038 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 19:58:32,038 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 397.7%
2022-04-21 19:59:03,636 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.329, Acc: 0.669, Base Lr: 3.25e-03
2022-04-21 19:59:18,798 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-21 19:59:45,379 reid_baseline.train INFO: normal accuracy 0.4884306987399771 3.452713966369629 
2022-04-21 20:00:15,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 20:00:15,752 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 345.3%
2022-04-21 20:00:46,557 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.828, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 20:01:03,923 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-21 20:01:35,166 reid_baseline.train INFO: normal accuracy 0.5539518900343643 2.9656546115875244 
2022-04-21 20:02:05,458 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 20:02:05,458 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.6%
2022-04-21 20:02:36,245 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.552, Acc: 0.771, Base Lr: 4.83e-03
2022-04-21 20:02:50,878 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-21 20:03:18,124 reid_baseline.train INFO: normal accuracy 0.6050400916380297 2.625279188156128 
2022-04-21 20:03:48,197 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 20:03:48,197 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 262.5%
2022-04-21 20:04:19,766 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.384, Acc: 0.801, Base Lr: 5.62e-03
2022-04-21 20:04:34,385 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-21 20:05:23,293 reid_baseline.train INFO: normal accuracy 0.6139747995418099 2.317723512649536 
2022-04-21 20:05:53,389 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 20:05:53,390 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.8%
2022-04-21 20:06:32,056 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.202, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 20:06:50,286 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-21 20:07:21,452 reid_baseline.train INFO: normal accuracy 0.6151202749140894 2.097512722015381 
2022-04-21 20:07:51,524 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 20:07:51,525 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 209.8%
2022-04-21 20:08:22,548 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.143, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 20:08:37,223 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-21 20:09:26,226 reid_baseline.train INFO: normal accuracy 0.6142038946162658 1.9767124652862549 
2022-04-21 20:09:56,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 20:09:56,301 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 197.7%
2022-04-21 20:10:27,803 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.082, Acc: 0.890, Base Lr: 4.01e-03
2022-04-21 20:10:42,559 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-21 20:11:40,464 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.927760362625122 
2022-04-21 20:12:11,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 20:12:11,195 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.8%
2022-04-21 20:12:41,878 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.028, Acc: 0.911, Base Lr: 3.38e-03
2022-04-21 20:12:56,714 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 20:13:43,620 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.866994857788086 
2022-04-21 20:14:14,457 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 20:14:14,458 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.7%
2022-04-21 20:14:45,270 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.017, Acc: 0.919, Base Lr: 2.77e-03
2022-04-21 20:15:01,194 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-21 20:15:33,032 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8708323240280151 
2022-04-21 20:15:33,032 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 20:15:33,032 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.1%
2022-04-21 20:16:11,924 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.018, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 20:16:28,110 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.362[s] Speed: 44.2[samples/s]
2022-04-21 20:16:55,293 reid_baseline.train INFO: normal accuracy 0.6252004581901489 1.8861068487167358 
2022-04-21 20:16:55,293 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 20:16:55,293 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.6%
2022-04-21 20:17:34,004 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.961, Acc: 0.920, Base Lr: 1.66e-03
2022-04-21 20:17:49,359 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.355[s] Speed: 45.0[samples/s]
2022-04-21 20:18:23,979 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8609812259674072 
2022-04-21 20:18:55,185 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 20:18:55,185 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.1%
2022-04-21 20:19:34,706 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.968, Acc: 0.935, Base Lr: 1.19e-03
2022-04-21 20:19:49,992 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.360[s] Speed: 44.4[samples/s]
2022-04-21 20:20:16,483 reid_baseline.train INFO: normal accuracy 0.6320733104238259 1.851972222328186 
2022-04-21 20:20:47,115 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 20:20:47,116 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 185.2%
2022-04-21 20:21:17,984 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.959, Acc: 0.926, Base Lr: 7.78e-04
2022-04-21 20:21:32,736 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-21 20:21:59,795 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.760567545890808 
2022-04-21 20:22:52,486 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 20:22:52,487 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.1%
2022-04-21 20:23:23,073 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.945, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 20:23:37,991 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.299[s] Speed: 53.4[samples/s]
2022-04-21 20:24:13,972 reid_baseline.train INFO: normal accuracy 0.6352806414662084 1.8782325983047485 
2022-04-21 20:24:13,973 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 20:24:13,973 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 187.8%
2022-04-21 20:24:52,852 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.944, Acc: 0.934, Base Lr: 2.11e-04
2022-04-21 20:25:10,908 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.375[s] Speed: 42.7[samples/s]
2022-04-21 20:26:00,600 reid_baseline.train INFO: normal accuracy 0.633906071019473 1.8325066566467285 
2022-04-21 20:26:00,600 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 20:26:00,600 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.3%
2022-04-21 20:26:31,390 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.967, Acc: 0.924, Base Lr: 6.51e-05
2022-04-21 20:26:46,514 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-21 20:27:13,832 reid_baseline.train INFO: normal accuracy 0.6311569301260023 1.8689513206481934 
2022-04-21 20:27:13,832 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 20:27:13,833 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.9%
2022-04-21 20:27:44,416 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.918, Acc: 0.925, Base Lr: 1.60e-05
2022-04-21 20:27:58,791 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-21 20:28:56,226 reid_baseline.train INFO: normal accuracy 0.634135166093929 1.8694016933441162 
2022-04-21 20:28:56,226 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 20:28:56,227 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 186.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-21 20:30:14,716 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.760567545890808 
2022-04-21 20:30:14,716 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 20:30:14,717 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-21 20:30:42,027 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.760567545890808 
2022-04-21 20:30:42,027 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 20:30:42,027 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-21 20:31:02,521 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7760857939720154 
2022-04-21 20:31:02,521 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 20:31:02,521 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 20:31:07,316 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3
2022-04-21 20:31:07,316 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-21 20:31:07,317 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 20:31:07,318 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 20:31:07,319 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 20:31:15,216 reid_baseline.train INFO: start training
2022-04-21 20:31:48,077 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.022, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 20:32:03,972 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-21 20:32:33,099 reid_baseline.train INFO: normal accuracy 0.5215138544717278 4.171815395355225 
2022-04-21 20:33:03,111 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 20:33:03,111 reid_baseline.train INFO: Accuracy: 52.2% Mean Entropy: 417.2%
2022-04-21 20:33:42,118 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.715, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 20:34:00,659 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.379[s] Speed: 42.3[samples/s]
2022-04-21 20:34:31,437 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.149553298950195 
2022-04-21 20:35:01,498 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 20:35:01,498 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-21 20:35:32,381 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.127, Acc: 0.633, Base Lr: 2.46e-03
2022-04-21 20:35:47,493 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-21 20:36:16,031 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.958498954772949 
2022-04-21 20:36:46,334 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 20:36:46,334 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 395.8%
2022-04-21 20:37:17,892 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.329, Acc: 0.669, Base Lr: 3.25e-03
2022-04-21 20:37:32,992 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-21 20:38:00,064 reid_baseline.train INFO: normal accuracy 0.5915746789817526 3.3786532878875732 
2022-04-21 20:38:30,171 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 20:38:30,171 reid_baseline.train INFO: Accuracy: 59.2% Mean Entropy: 337.9%
2022-04-21 20:39:00,730 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.828, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 20:39:15,959 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-21 20:39:42,866 reid_baseline.train INFO: normal accuracy 0.6683937823834197 2.7773215770721436 
2022-04-21 20:40:13,121 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 20:40:13,122 reid_baseline.train INFO: Accuracy: 66.8% Mean Entropy: 277.7%
2022-04-21 20:40:43,883 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.552, Acc: 0.771, Base Lr: 4.83e-03
2022-04-21 20:40:58,475 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-21 20:41:25,727 reid_baseline.train INFO: normal accuracy 0.7341743635954043 2.408313035964966 
2022-04-21 20:41:55,939 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 20:41:55,939 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 240.8%
2022-04-21 20:42:32,188 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.384, Acc: 0.801, Base Lr: 5.62e-03
2022-04-21 20:42:50,360 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.358[s] Speed: 44.7[samples/s]
2022-04-21 20:43:22,283 reid_baseline.train INFO: normal accuracy 0.7560261320117143 2.0753235816955566 
2022-04-21 20:43:52,397 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 20:43:52,397 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.5%
2022-04-21 20:44:22,889 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.202, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 20:44:37,547 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 20:45:05,453 reid_baseline.train INFO: normal accuracy 0.7672899301644515 1.8713828325271606 
2022-04-21 20:45:35,738 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 20:45:35,738 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 187.1%
2022-04-21 20:46:06,571 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.144, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 20:46:21,532 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-21 20:46:49,608 reid_baseline.train INFO: normal accuracy 0.7801306600585718 1.7665529251098633 
2022-04-21 20:47:19,880 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 20:47:19,880 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 176.7%
2022-04-21 20:47:51,394 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.082, Acc: 0.892, Base Lr: 4.01e-03
2022-04-21 20:48:06,164 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.304[s] Speed: 52.5[samples/s]
2022-04-21 20:49:06,213 reid_baseline.train INFO: normal accuracy 0.7805812119846812 1.7259247303009033 
2022-04-21 20:49:36,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 20:49:36,595 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.6%
2022-04-21 20:50:07,153 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.028, Acc: 0.912, Base Lr: 3.38e-03
2022-04-21 20:50:21,920 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-21 20:50:50,106 reid_baseline.train INFO: normal accuracy 0.781707591799955 1.6762537956237793 
2022-04-21 20:51:20,609 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 20:51:20,609 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.6%
2022-04-21 20:51:59,123 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.017, Acc: 0.918, Base Lr: 2.77e-03
2022-04-21 20:52:17,465 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-21 20:52:47,729 reid_baseline.train INFO: normal accuracy 0.7821581437260644 1.6748247146606445 
2022-04-21 20:53:17,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 20:53:17,909 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.5%
2022-04-21 20:53:48,721 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.017, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 20:54:04,434 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-21 20:54:31,930 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.6973273754119873 
2022-04-21 20:54:31,930 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 20:54:31,931 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 169.7%
2022-04-21 20:55:01,949 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.961, Acc: 0.920, Base Lr: 1.66e-03
2022-04-21 20:55:17,066 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 20:55:45,179 reid_baseline.train INFO: normal accuracy 0.7864383870241045 1.6691051721572876 
2022-04-21 20:56:15,497 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 20:56:15,497 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 166.9%
2022-04-21 20:56:46,142 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.967, Acc: 0.935, Base Lr: 1.19e-03
2022-04-21 20:57:01,403 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-21 20:57:29,602 reid_baseline.train INFO: normal accuracy 0.7859878350979951 1.6730003356933594 
2022-04-21 20:57:29,603 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 20:57:29,603 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.3%
2022-04-21 20:58:00,336 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.959, Acc: 0.927, Base Lr: 7.78e-04
2022-04-21 20:58:15,032 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 20:58:43,107 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5717954635620117 
2022-04-21 20:59:13,400 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 20:59:13,401 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.2%
2022-04-21 20:59:43,909 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.944, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 20:59:58,639 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.298[s] Speed: 53.8[samples/s]
2022-04-21 21:00:29,035 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.6845916509628296 
2022-04-21 21:00:29,035 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 21:00:29,035 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.5%
2022-04-21 21:01:08,430 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.944, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 21:01:26,221 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.376[s] Speed: 42.5[samples/s]
2022-04-21 21:01:56,153 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.643799066543579 
2022-04-21 21:01:56,154 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 21:01:56,154 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.4%
2022-04-21 21:02:27,012 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.966, Acc: 0.925, Base Lr: 6.51e-05
2022-04-21 21:02:42,113 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-21 21:03:10,719 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.686937689781189 
2022-04-21 21:03:10,720 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 21:03:10,720 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
2022-04-21 21:03:41,455 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.918, Acc: 0.925, Base Lr: 1.60e-05
2022-04-21 21:03:55,900 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-21 21:04:52,798 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.6872634887695312 
2022-04-21 21:04:52,798 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 21:04:52,799 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 168.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-21 21:05:49,859 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5717954635620117 
2022-04-21 21:05:49,860 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 21:05:49,860 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-21 21:06:17,720 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5717954635620117 
2022-04-21 21:06:17,720 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 21:06:17,720 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-21 21:06:38,176 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7764521837234497 
2022-04-21 21:06:38,176 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 21:06:38,176 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 21:06:43,531 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3
2022-04-21 21:06:43,531 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-21 21:06:43,531 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 21:06:43,532 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 21:06:43,532 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 21:06:51,114 reid_baseline.train INFO: start training
2022-04-21 21:07:23,891 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.022, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 21:07:39,692 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.318[s] Speed: 50.4[samples/s]
2022-04-21 21:08:42,875 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.171506404876709 
2022-04-21 21:09:12,844 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 21:09:12,844 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-21 21:09:49,052 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.715, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 21:10:07,790 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-21 21:11:12,162 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.138622760772705 
2022-04-21 21:11:42,243 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 21:11:42,244 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-21 21:12:13,354 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.127, Acc: 0.633, Base Lr: 2.46e-03
2022-04-21 21:12:28,409 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-21 21:13:33,154 reid_baseline.train INFO: normal accuracy 0.6371356437915997 3.843569755554199 
2022-04-21 21:14:03,545 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 21:14:03,545 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-21 21:14:37,479 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.329, Acc: 0.670, Base Lr: 3.25e-03
2022-04-21 21:14:52,592 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.323[s] Speed: 49.6[samples/s]
2022-04-21 21:15:53,509 reid_baseline.train INFO: normal accuracy 0.6825797567133348 3.10021710395813 
2022-04-21 21:16:23,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 21:16:23,603 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 310.0%
2022-04-21 21:16:54,553 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.828, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 21:17:11,864 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.317[s] Speed: 50.4[samples/s]
2022-04-21 21:18:16,651 reid_baseline.train INFO: normal accuracy 0.7440899701629562 2.453223466873169 
2022-04-21 21:18:46,977 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 21:18:46,977 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-21 21:19:25,718 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.552, Acc: 0.770, Base Lr: 4.83e-03
2022-04-21 21:19:44,072 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-04-21 21:21:00,271 reid_baseline.train INFO: normal accuracy 0.7890750516410374 2.080684185028076 
2022-04-21 21:21:30,328 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 21:21:30,329 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 208.1%
2022-04-21 21:22:01,757 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.384, Acc: 0.801, Base Lr: 5.62e-03
2022-04-21 21:22:16,356 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-21 21:23:33,413 reid_baseline.train INFO: normal accuracy 0.811797108101905 1.8064944744110107 
2022-04-21 21:24:03,804 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 21:24:03,804 reid_baseline.train INFO: Accuracy: 81.2% Mean Entropy: 180.6%
2022-04-21 21:24:34,348 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.203, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 21:24:48,825 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-21 21:26:06,817 reid_baseline.train INFO: normal accuracy 0.8202891898095019 1.6230432987213135 
2022-04-21 21:26:37,260 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 21:26:37,261 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 162.3%
2022-04-21 21:27:08,343 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.143, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 21:27:23,116 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-21 21:28:45,330 reid_baseline.train INFO: normal accuracy 0.8232728941932522 1.514327883720398 
2022-04-21 21:29:15,635 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 21:29:15,635 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 151.4%
2022-04-21 21:29:46,955 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.082, Acc: 0.891, Base Lr: 4.01e-03
2022-04-21 21:30:01,738 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-21 21:31:50,947 reid_baseline.train INFO: normal accuracy 0.8296993344044067 1.4832602739334106 
2022-04-21 21:32:21,174 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 21:32:21,175 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-21 21:32:51,527 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.028, Acc: 0.912, Base Lr: 3.38e-03
2022-04-21 21:33:06,284 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 21:34:25,714 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.431075930595398 
2022-04-21 21:34:55,771 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 21:34:55,772 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.1%
2022-04-21 21:35:26,504 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.017, Acc: 0.917, Base Lr: 2.77e-03
2022-04-21 21:35:41,237 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 21:37:01,261 reid_baseline.train INFO: normal accuracy 0.8331420702318109 1.437117576599121 
2022-04-21 21:37:01,262 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 21:37:01,262 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 143.7%
2022-04-21 21:37:39,343 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.018, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 21:37:58,711 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.378[s] Speed: 42.3[samples/s]
2022-04-21 21:39:21,493 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.458795428276062 
2022-04-21 21:39:21,493 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 21:39:21,493 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.9%
2022-04-21 21:39:51,648 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.961, Acc: 0.920, Base Lr: 1.66e-03
2022-04-21 21:40:06,687 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-21 21:41:26,656 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.4419760704040527 
2022-04-21 21:41:26,658 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 21:41:26,664 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.2%
2022-04-21 21:41:57,450 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.968, Acc: 0.935, Base Lr: 1.19e-03
2022-04-21 21:42:12,567 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-21 21:43:15,211 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4459068775177002 
2022-04-21 21:43:15,212 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 21:43:15,212 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 144.6%
2022-04-21 21:43:52,229 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.959, Acc: 0.927, Base Lr: 7.78e-04
2022-04-21 21:44:06,871 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.340[s] Speed: 47.1[samples/s]
2022-04-21 21:45:08,071 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.354204773902893 
2022-04-21 21:45:38,096 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 21:45:38,096 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 135.4%
2022-04-21 21:46:16,343 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.945, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 21:46:34,836 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-04-21 21:47:38,339 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4684027433395386 
2022-04-21 21:47:38,340 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 21:47:38,340 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.8%
2022-04-21 21:48:08,932 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.944, Acc: 0.934, Base Lr: 2.11e-04
2022-04-21 21:48:23,238 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-21 21:49:24,134 reid_baseline.train INFO: normal accuracy 0.8354372274500803 1.4285749197006226 
2022-04-21 21:49:24,135 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 21:49:24,135 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 142.9%
2022-04-21 21:49:54,581 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.966, Acc: 0.924, Base Lr: 6.51e-05
2022-04-21 21:50:09,501 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-21 21:51:12,788 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4659236669540405 
2022-04-21 21:51:12,788 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 21:51:12,788 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-21 21:51:43,431 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.918, Acc: 0.924, Base Lr: 1.60e-05
2022-04-21 21:51:57,705 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-21 21:53:29,474 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.4668900966644287 
2022-04-21 21:53:29,474 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 21:53:29,475 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-21 21:55:06,891 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.354204773902893 
2022-04-21 21:55:06,891 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 21:55:06,891 reid_baseline.train INFO: Accuracy: 83.8%
2022-04-21 21:56:13,304 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.354204773902893 
2022-04-21 21:56:13,304 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 21:56:13,305 reid_baseline.train INFO: Shuffled Accuracy: 83.8%
2022-04-21 21:56:34,105 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7765966653823853 
2022-04-21 21:56:34,105 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 21:56:34,105 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 21:56:38,650 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4
2022-04-21 21:56:38,651 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-21 21:56:38,651 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 21:56:38,651 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 21:56:38,652 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 21:56:46,274 reid_baseline.train INFO: start training
2022-04-21 21:57:22,913 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.995, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 21:57:38,891 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-21 21:58:06,321 reid_baseline.train INFO: normal accuracy 0.4043528064146621 4.171579837799072 
2022-04-21 21:58:36,684 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 21:58:36,684 reid_baseline.train INFO: Accuracy: 40.4% Mean Entropy: 417.2%
2022-04-21 21:59:15,946 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.669, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 21:59:30,928 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-21 22:00:19,691 reid_baseline.train INFO: normal accuracy 0.4300114547537228 4.151166915893555 
2022-04-21 22:00:49,696 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 22:00:49,697 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-21 22:01:20,782 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.101, Acc: 0.633, Base Lr: 2.46e-03
2022-04-21 22:01:35,832 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.303[s] Speed: 52.7[samples/s]
2022-04-21 22:02:03,640 reid_baseline.train INFO: normal accuracy 0.4526918671248568 3.9771156311035156 
2022-04-21 22:02:33,691 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 22:02:33,691 reid_baseline.train INFO: Accuracy: 45.3% Mean Entropy: 397.7%
2022-04-21 22:03:05,379 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.342, Acc: 0.669, Base Lr: 3.25e-03
2022-04-21 22:03:20,621 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-21 22:03:48,416 reid_baseline.train INFO: normal accuracy 0.4884306987399771 3.452676296234131 
2022-04-21 22:04:18,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 22:04:18,395 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 345.3%
2022-04-21 22:04:54,599 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.807, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 22:05:11,388 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-04-21 22:05:44,102 reid_baseline.train INFO: normal accuracy 0.5539518900343643 2.9655659198760986 
2022-04-21 22:06:14,099 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 22:06:14,100 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.6%
2022-04-21 22:06:44,924 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.505, Acc: 0.771, Base Lr: 4.83e-03
2022-04-21 22:06:59,644 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-21 22:07:49,207 reid_baseline.train INFO: normal accuracy 0.6048109965635738 2.6264874935150146 
2022-04-21 22:08:19,213 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 22:08:19,213 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 262.6%
2022-04-21 22:08:50,621 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.382, Acc: 0.802, Base Lr: 5.62e-03
2022-04-21 22:09:05,330 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.303[s] Speed: 52.7[samples/s]
2022-04-21 22:09:31,905 reid_baseline.train INFO: normal accuracy 0.6144329896907217 2.3178534507751465 
2022-04-21 22:10:02,348 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 22:10:02,348 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.8%
2022-04-21 22:10:36,960 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.181, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 22:10:51,467 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.323[s] Speed: 49.5[samples/s]
2022-04-21 22:11:18,607 reid_baseline.train INFO: normal accuracy 0.6162657502863689 2.096771240234375 
2022-04-21 22:11:48,622 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 22:11:48,623 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 209.7%
2022-04-21 22:12:22,420 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.168, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 22:12:40,705 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.343[s] Speed: 46.7[samples/s]
2022-04-21 22:13:11,096 reid_baseline.train INFO: normal accuracy 0.6132875143184422 1.9757142066955566 
2022-04-21 22:13:41,359 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 22:13:41,360 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 197.6%
2022-04-21 22:14:12,721 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.078, Acc: 0.890, Base Lr: 4.01e-03
2022-04-21 22:14:27,646 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-21 22:15:25,073 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.9271420240402222 
2022-04-21 22:15:55,111 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 22:15:55,111 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.7%
2022-04-21 22:16:25,454 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.027, Acc: 0.912, Base Lr: 3.38e-03
2022-04-21 22:16:40,138 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-21 22:17:29,127 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.8667951822280884 
2022-04-21 22:17:59,128 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 22:17:59,129 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.7%
2022-04-21 22:18:29,980 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.985, Acc: 0.918, Base Lr: 2.77e-03
2022-04-21 22:18:44,731 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-21 22:19:11,357 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8706343173980713 
2022-04-21 22:19:11,357 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 22:19:11,358 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.1%
2022-04-21 22:19:46,648 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.988, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 22:20:02,276 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-21 22:20:29,466 reid_baseline.train INFO: normal accuracy 0.6245131729667812 1.8857026100158691 
2022-04-21 22:20:29,467 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 22:20:29,467 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.6%
2022-04-21 22:20:59,606 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.972, Acc: 0.921, Base Lr: 1.66e-03
2022-04-21 22:21:14,570 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 22:22:01,102 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8602931499481201 
2022-04-21 22:22:31,291 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 22:22:31,291 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.0%
2022-04-21 22:23:02,167 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.935, Acc: 0.935, Base Lr: 1.19e-03
2022-04-21 22:23:17,281 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-21 22:23:43,827 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.8515573740005493 
2022-04-21 22:24:14,105 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 22:24:14,106 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 185.2%
2022-04-21 22:24:51,070 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.939, Acc: 0.926, Base Lr: 7.78e-04
2022-04-21 22:25:05,734 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.340[s] Speed: 47.1[samples/s]
2022-04-21 22:25:32,196 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.7601995468139648 
2022-04-21 22:26:02,823 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 22:26:02,823 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.0%
2022-04-21 22:26:39,836 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.930, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 22:26:54,577 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.340[s] Speed: 47.0[samples/s]
2022-04-21 22:27:21,112 reid_baseline.train INFO: normal accuracy 0.6352806414662084 1.8778423070907593 
2022-04-21 22:27:21,112 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 22:27:21,113 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 187.8%
2022-04-21 22:27:51,761 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.936, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 22:28:06,259 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 22:28:31,897 reid_baseline.train INFO: normal accuracy 0.634135166093929 1.832175374031067 
2022-04-21 22:28:31,897 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 22:28:31,897 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.2%
2022-04-21 22:29:04,133 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.924, Acc: 0.924, Base Lr: 6.51e-05
2022-04-21 22:29:21,921 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-21 22:29:48,884 reid_baseline.train INFO: normal accuracy 0.6313860252004582 1.8686118125915527 
2022-04-21 22:29:48,885 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 22:29:48,885 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.9%
2022-04-21 22:30:19,675 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.939, Acc: 0.925, Base Lr: 1.60e-05
2022-04-21 22:30:37,428 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.319[s] Speed: 50.1[samples/s]
2022-04-21 22:31:56,208 reid_baseline.train INFO: normal accuracy 0.6343642611683848 1.8684941530227661 
2022-04-21 22:31:56,208 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 22:31:56,208 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 186.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-21 22:32:52,724 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.7601995468139648 
2022-04-21 22:32:52,724 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 22:32:52,724 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-21 22:33:19,709 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.7601995468139648 
2022-04-21 22:33:19,709 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 22:33:19,710 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-21 22:33:40,298 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7761754393577576 
2022-04-21 22:33:40,298 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 22:33:40,299 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 22:33:44,895 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4
2022-04-21 22:33:44,895 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-21 22:33:44,896 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 22:33:44,897 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 22:33:44,898 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 22:33:52,546 reid_baseline.train INFO: start training
2022-04-21 22:34:25,385 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.995, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 22:34:41,355 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.319[s] Speed: 50.1[samples/s]
2022-04-21 22:35:08,649 reid_baseline.train INFO: normal accuracy 0.5212885785086732 4.171815395355225 
2022-04-21 22:35:38,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 22:35:38,578 reid_baseline.train INFO: Accuracy: 52.1% Mean Entropy: 417.2%
2022-04-21 22:36:09,442 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.669, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 22:36:24,571 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-21 22:36:51,319 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.149553298950195 
2022-04-21 22:37:21,387 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 22:37:21,387 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-21 22:37:52,316 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.101, Acc: 0.633, Base Lr: 2.46e-03
2022-04-21 22:38:07,355 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-21 22:38:35,384 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.958496332168579 
2022-04-21 22:39:05,482 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 22:39:05,482 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 395.8%
2022-04-21 22:39:43,054 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.342, Acc: 0.670, Base Lr: 3.25e-03
2022-04-21 22:40:02,165 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-04-21 22:40:33,407 reid_baseline.train INFO: normal accuracy 0.5911241270556432 3.3783187866210938 
2022-04-21 22:41:03,496 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 22:41:03,497 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 337.8%
2022-04-21 22:41:33,870 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.807, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 22:41:49,149 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-21 22:42:15,755 reid_baseline.train INFO: normal accuracy 0.6688443343095292 2.7771198749542236 
2022-04-21 22:42:45,784 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 22:42:45,785 reid_baseline.train INFO: Accuracy: 66.9% Mean Entropy: 277.7%
2022-04-21 22:43:16,507 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.505, Acc: 0.771, Base Lr: 4.83e-03
2022-04-21 22:43:31,179 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-21 22:43:58,442 reid_baseline.train INFO: normal accuracy 0.7346249155215139 2.408027172088623 
2022-04-21 22:44:28,704 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 22:44:28,705 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 240.8%
2022-04-21 22:45:00,084 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.382, Acc: 0.801, Base Lr: 5.62e-03
2022-04-21 22:45:14,670 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-21 22:45:42,133 reid_baseline.train INFO: normal accuracy 0.7562514079747691 2.0755813121795654 
2022-04-21 22:46:12,206 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 22:46:12,206 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.6%
2022-04-21 22:46:42,689 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.180, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 22:46:57,290 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.297[s] Speed: 54.0[samples/s]
2022-04-21 22:47:46,700 reid_baseline.train INFO: normal accuracy 0.7670646542013967 1.871123194694519 
2022-04-21 22:48:16,748 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 22:48:16,748 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 187.1%
2022-04-21 22:48:55,682 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.167, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 22:49:14,486 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-21 22:49:45,178 reid_baseline.train INFO: normal accuracy 0.7794548321694075 1.7659281492233276 
2022-04-21 22:50:15,239 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 22:50:15,239 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 176.6%
2022-04-21 22:50:46,611 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.077, Acc: 0.891, Base Lr: 4.01e-03
2022-04-21 22:51:01,372 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.303[s] Speed: 52.7[samples/s]
2022-04-21 22:51:58,921 reid_baseline.train INFO: normal accuracy 0.7810317639107908 1.7269660234451294 
2022-04-21 22:52:29,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 22:52:29,066 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.7%
2022-04-21 22:52:59,507 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.026, Acc: 0.912, Base Lr: 3.38e-03
2022-04-21 22:53:14,175 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 22:53:42,189 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.6790499687194824 
2022-04-21 22:54:12,265 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 22:54:12,266 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 167.9%
2022-04-21 22:54:43,040 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.985, Acc: 0.917, Base Lr: 2.77e-03
2022-04-21 22:54:57,762 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 22:55:38,791 reid_baseline.train INFO: normal accuracy 0.7821581437260644 1.6743957996368408 
2022-04-21 22:56:09,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 22:56:09,178 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.4%
2022-04-21 22:56:39,899 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.988, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 22:56:55,632 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.306[s] Speed: 52.4[samples/s]
2022-04-21 22:57:22,621 reid_baseline.train INFO: normal accuracy 0.781707591799955 1.6970301866531372 
2022-04-21 22:57:22,622 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 22:57:22,622 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 169.7%
2022-04-21 22:58:00,800 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.972, Acc: 0.921, Base Lr: 1.66e-03
2022-04-21 22:58:19,518 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.374[s] Speed: 42.7[samples/s]
2022-04-21 22:58:50,427 reid_baseline.train INFO: normal accuracy 0.7868889389502141 1.6685898303985596 
2022-04-21 22:59:21,082 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 22:59:21,082 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 166.9%
2022-04-21 22:59:57,017 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.935, Acc: 0.936, Base Lr: 1.19e-03
2022-04-21 23:00:12,173 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.336[s] Speed: 47.6[samples/s]
2022-04-21 23:00:39,394 reid_baseline.train INFO: normal accuracy 0.7857625591349403 1.6728568077087402 
2022-04-21 23:00:39,395 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 23:00:39,395 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.3%
2022-04-21 23:01:10,024 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.939, Acc: 0.926, Base Lr: 7.78e-04
2022-04-21 23:01:24,854 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 23:01:52,484 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5714960098266602 
2022-04-21 23:02:22,534 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 23:02:22,535 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.1%
2022-04-21 23:02:53,265 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.930, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 23:03:09,798 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-21 23:03:43,455 reid_baseline.train INFO: normal accuracy 0.7855372831718855 1.684188723564148 
2022-04-21 23:03:43,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 23:03:43,455 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 168.4%
2022-04-21 23:04:14,201 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.936, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 23:04:28,537 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.297[s] Speed: 54.0[samples/s]
2022-04-21 23:04:55,624 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.6437416076660156 
2022-04-21 23:04:55,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 23:04:55,625 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.4%
2022-04-21 23:05:26,558 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.924, Acc: 0.923, Base Lr: 6.51e-05
2022-04-21 23:05:41,560 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-21 23:06:10,062 reid_baseline.train INFO: normal accuracy 0.7850867312457761 1.686920404434204 
2022-04-21 23:06:10,062 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 23:06:10,062 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
2022-04-21 23:06:43,545 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.939, Acc: 0.925, Base Lr: 1.60e-05
2022-04-21 23:07:01,939 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-21 23:08:00,469 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.6866048574447632 
2022-04-21 23:08:00,469 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 23:08:00,469 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-21 23:08:57,163 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5714960098266602 
2022-04-21 23:08:57,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 23:08:57,163 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-21 23:09:23,806 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5714960098266602 
2022-04-21 23:09:23,807 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 23:09:23,807 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-21 23:09:44,452 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7762126326560974 
2022-04-21 23:09:44,453 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 23:09:44,453 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 23:09:49,278 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4
2022-04-21 23:09:49,278 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-21 23:09:49,279 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 23:09:49,280 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 23:09:49,280 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 23:09:57,023 reid_baseline.train INFO: start training
2022-04-21 23:10:33,145 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.995, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 23:10:49,836 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.345[s] Speed: 46.3[samples/s]
2022-04-21 23:11:51,544 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.171506404876709 
2022-04-21 23:12:21,497 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 23:12:21,498 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-21 23:12:52,108 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.669, Acc: 0.593, Base Lr: 1.66e-03
2022-04-21 23:13:07,073 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-21 23:14:24,197 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.138621807098389 
2022-04-21 23:14:54,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 23:14:54,323 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-21 23:15:25,440 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.101, Acc: 0.632, Base Lr: 2.46e-03
2022-04-21 23:15:43,629 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.324[s] Speed: 49.3[samples/s]
2022-04-21 23:16:53,201 reid_baseline.train INFO: normal accuracy 0.6371356437915997 3.8435635566711426 
2022-04-21 23:17:23,887 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 23:17:23,887 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-21 23:18:02,918 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.342, Acc: 0.669, Base Lr: 3.25e-03
2022-04-21 23:18:18,024 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.356[s] Speed: 44.9[samples/s]
2022-04-21 23:19:17,043 reid_baseline.train INFO: normal accuracy 0.6823502409915079 3.100106954574585 
2022-04-21 23:19:47,082 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 23:19:47,083 reid_baseline.train INFO: Accuracy: 68.2% Mean Entropy: 310.0%
2022-04-21 23:20:17,480 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.807, Acc: 0.710, Base Lr: 4.04e-03
2022-04-21 23:20:32,569 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 23:21:50,862 reid_baseline.train INFO: normal accuracy 0.7440899701629562 2.4531126022338867 
2022-04-21 23:22:20,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 23:22:20,934 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-21 23:22:51,702 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.505, Acc: 0.771, Base Lr: 4.83e-03
2022-04-21 23:23:06,270 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-21 23:24:07,512 reid_baseline.train INFO: normal accuracy 0.7895340830846913 2.080004930496216 
2022-04-21 23:24:38,143 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 23:24:38,144 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 208.0%
2022-04-21 23:25:20,518 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.382, Acc: 0.802, Base Lr: 5.62e-03
2022-04-21 23:25:38,589 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.398[s] Speed: 40.2[samples/s]
2022-04-21 23:26:55,864 reid_baseline.train INFO: normal accuracy 0.8113380766582511 1.8069684505462646 
2022-04-21 23:27:25,939 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 23:27:25,940 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.7%
2022-04-21 23:27:56,345 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.181, Acc: 0.859, Base Lr: 6.42e-03
2022-04-21 23:28:10,806 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-21 23:29:10,249 reid_baseline.train INFO: normal accuracy 0.8202891898095019 1.623104214668274 
2022-04-21 23:29:40,275 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 23:29:40,276 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 162.3%
2022-04-21 23:30:11,303 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.167, Acc: 0.870, Base Lr: 7.21e-03
2022-04-21 23:30:25,969 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-21 23:31:28,509 reid_baseline.train INFO: normal accuracy 0.8230433784714253 1.513942003250122 
2022-04-21 23:31:59,069 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 23:31:59,070 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 151.4%
2022-04-21 23:32:32,755 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.078, Acc: 0.890, Base Lr: 4.01e-03
2022-04-21 23:32:47,580 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.319[s] Speed: 50.1[samples/s]
2022-04-21 23:34:25,824 reid_baseline.train INFO: normal accuracy 0.8299288501262336 1.4834383726119995 
2022-04-21 23:34:55,878 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 23:34:55,878 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-21 23:35:27,427 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.027, Acc: 0.912, Base Lr: 3.38e-03
2022-04-21 23:35:44,765 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-21 23:36:46,991 reid_baseline.train INFO: normal accuracy 0.8315354601790222 1.4319242238998413 
2022-04-21 23:37:17,036 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 23:37:17,036 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.2%
2022-04-21 23:37:47,756 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.985, Acc: 0.919, Base Lr: 2.77e-03
2022-04-21 23:38:02,507 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-21 23:39:01,403 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4375988245010376 
2022-04-21 23:39:01,404 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 23:39:01,404 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 143.8%
2022-04-21 23:39:32,254 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.988, Acc: 0.911, Base Lr: 2.20e-03
2022-04-21 23:39:47,851 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-21 23:40:49,086 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4592288732528687 
2022-04-21 23:40:49,087 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 23:40:49,088 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.9%
2022-04-21 23:41:19,293 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.972, Acc: 0.921, Base Lr: 1.66e-03
2022-04-21 23:41:34,316 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-21 23:42:40,267 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.4415111541748047 
2022-04-21 23:42:40,268 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 23:42:40,268 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.2%
2022-04-21 23:43:18,721 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.935, Acc: 0.935, Base Lr: 1.19e-03
2022-04-21 23:43:37,620 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.377[s] Speed: 42.5[samples/s]
2022-04-21 23:44:42,515 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.445699691772461 
2022-04-21 23:44:42,516 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 23:44:42,516 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 144.6%
2022-04-21 23:45:13,053 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.939, Acc: 0.927, Base Lr: 7.78e-04
2022-04-21 23:45:27,723 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-21 23:46:29,853 reid_baseline.train INFO: normal accuracy 0.8375028689465228 1.3541542291641235 
2022-04-21 23:46:59,908 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 23:46:59,909 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 135.4%
2022-04-21 23:47:30,366 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.930, Acc: 0.938, Base Lr: 4.51e-04
2022-04-21 23:47:45,201 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-21 23:48:47,097 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4680927991867065 
2022-04-21 23:48:47,098 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 23:48:47,098 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.8%
2022-04-21 23:49:17,577 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.937, Acc: 0.933, Base Lr: 2.11e-04
2022-04-21 23:49:31,982 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-21 23:50:32,878 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4282821416854858 
2022-04-21 23:50:32,879 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 23:50:32,879 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 142.8%
2022-04-21 23:51:03,880 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.924, Acc: 0.923, Base Lr: 6.51e-05
2022-04-21 23:51:18,760 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-21 23:52:27,223 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.4660003185272217 
2022-04-21 23:52:27,223 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 23:52:27,223 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-21 23:53:02,382 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.940, Acc: 0.925, Base Lr: 1.60e-05
2022-04-21 23:53:16,604 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.325[s] Speed: 49.3[samples/s]
2022-04-21 23:54:49,168 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.4670833349227905 
2022-04-21 23:54:49,169 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 23:54:49,169 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-21 23:56:20,476 reid_baseline.train INFO: normal accuracy 0.8375028689465228 1.3541542291641235 
2022-04-21 23:56:20,476 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 23:56:20,476 reid_baseline.train INFO: Accuracy: 83.8%
2022-04-21 23:57:20,394 reid_baseline.train INFO: normal accuracy 0.8375028689465228 1.3541542291641235 
2022-04-21 23:57:20,395 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 23:57:20,395 reid_baseline.train INFO: Shuffled Accuracy: 83.8%
2022-04-21 23:57:41,271 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7765334844589233 
2022-04-21 23:57:41,271 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 23:57:41,271 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-21 23:57:46,077 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5
2022-04-21 23:57:46,077 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-21 23:57:46,077 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 23:57:46,078 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 23:57:46,079 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 23:57:53,706 reid_baseline.train INFO: start training
2022-04-21 23:58:26,638 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.133, Acc: 0.303, Base Lr: 8.72e-04
2022-04-21 23:58:42,618 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-21 23:59:10,593 reid_baseline.train INFO: normal accuracy 0.404581901489118 4.171579837799072 
2022-04-21 23:59:40,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 23:59:40,730 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 417.2%
2022-04-22 00:00:16,753 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.832, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 00:00:31,777 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.336[s] Speed: 47.6[samples/s]
2022-04-22 00:01:02,501 reid_baseline.train INFO: normal accuracy 0.4302405498281787 4.15116548538208 
2022-04-22 00:01:32,511 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 00:01:32,511 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-22 00:02:09,079 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.277, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 00:02:24,620 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.343[s] Speed: 46.7[samples/s]
2022-04-22 00:02:51,666 reid_baseline.train INFO: normal accuracy 0.452233676975945 3.9770779609680176 
2022-04-22 00:03:21,709 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 00:03:21,710 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 397.7%
2022-04-22 00:03:53,153 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.454, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 00:04:08,245 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-22 00:04:34,725 reid_baseline.train INFO: normal accuracy 0.4879725085910653 3.4529683589935303 
2022-04-22 00:05:04,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 00:05:04,792 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 345.3%
2022-04-22 00:05:35,333 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.965, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 00:05:50,420 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 00:06:17,787 reid_baseline.train INFO: normal accuracy 0.5539518900343643 2.965724468231201 
2022-04-22 00:06:47,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 00:06:47,859 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.6%
2022-04-22 00:07:18,779 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.657, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 00:07:33,460 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 00:07:59,255 reid_baseline.train INFO: normal accuracy 0.604352806414662 2.6251626014709473 
2022-04-22 00:08:29,320 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 00:08:29,321 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 262.5%
2022-04-22 00:09:00,838 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.516, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 00:09:15,450 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.303[s] Speed: 52.7[samples/s]
2022-04-22 00:10:04,302 reid_baseline.train INFO: normal accuracy 0.6144329896907217 2.317577838897705 
2022-04-22 00:10:34,366 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 00:10:34,366 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.8%
2022-04-22 00:11:05,063 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.328, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 00:11:19,631 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 00:11:46,871 reid_baseline.train INFO: normal accuracy 0.6155784650630012 2.0976128578186035 
2022-04-22 00:12:17,125 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 00:12:17,125 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 209.8%
2022-04-22 00:12:49,152 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.288, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 00:13:03,842 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 00:13:30,544 reid_baseline.train INFO: normal accuracy 0.6139747995418099 1.9771232604980469 
2022-04-22 00:14:00,784 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 00:14:00,785 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 197.7%
2022-04-22 00:14:39,816 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.214, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 00:14:54,565 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-22 00:15:51,721 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.9269672632217407 
2022-04-22 00:16:22,156 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 00:16:22,156 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.7%
2022-04-22 00:17:00,515 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.182, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 00:17:15,282 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.349[s] Speed: 45.8[samples/s]
2022-04-22 00:17:42,236 reid_baseline.train INFO: normal accuracy 0.6284077892325315 1.8663910627365112 
2022-04-22 00:18:12,266 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 00:18:12,267 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.6%
2022-04-22 00:18:49,147 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.111, Acc: 0.919, Base Lr: 2.77e-03
2022-04-22 00:19:07,970 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.366[s] Speed: 43.7[samples/s]
2022-04-22 00:19:38,326 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.8719477653503418 
2022-04-22 00:19:38,327 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 00:19:38,327 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.2%
2022-04-22 00:20:09,528 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.116, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 00:20:25,218 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-22 00:20:54,628 reid_baseline.train INFO: normal accuracy 0.6256586483390607 1.886291742324829 
2022-04-22 00:20:54,628 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 00:20:54,628 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 188.6%
2022-04-22 00:21:33,103 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.120, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 00:21:47,998 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.351[s] Speed: 45.6[samples/s]
2022-04-22 00:22:14,647 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.860740303993225 
2022-04-22 00:22:44,789 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 00:22:44,789 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.1%
2022-04-22 00:23:16,793 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.088, Acc: 0.934, Base Lr: 1.19e-03
2022-04-22 00:23:34,872 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-22 00:24:00,751 reid_baseline.train INFO: normal accuracy 0.63184421534937 1.8513612747192383 
2022-04-22 00:24:30,820 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 00:24:30,820 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 185.1%
2022-04-22 00:25:01,497 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.123, Acc: 0.927, Base Lr: 7.78e-04
2022-04-22 00:25:16,114 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 00:26:05,114 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.7601394653320312 
2022-04-22 00:26:35,151 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 00:26:35,151 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.0%
2022-04-22 00:27:05,504 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.079, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 00:27:20,224 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 00:28:10,709 reid_baseline.train INFO: normal accuracy 0.6350515463917525 1.8775935173034668 
2022-04-22 00:28:10,710 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 00:28:10,710 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 187.8%
2022-04-22 00:28:47,382 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.054, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 00:29:01,806 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.336[s] Speed: 47.6[samples/s]
2022-04-22 00:29:49,852 reid_baseline.train INFO: normal accuracy 0.634135166093929 1.8320038318634033 
2022-04-22 00:29:49,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 00:29:49,853 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.2%
2022-04-22 00:30:21,123 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.093, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 00:30:39,171 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.324[s] Speed: 49.3[samples/s]
2022-04-22 00:31:06,267 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.8685672283172607 
2022-04-22 00:31:06,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 00:31:06,267 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.9%
2022-04-22 00:31:36,673 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.112, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 00:31:50,906 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 00:33:06,866 reid_baseline.train INFO: normal accuracy 0.6343642611683848 1.869076132774353 
2022-04-22 00:33:06,867 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 00:33:06,867 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 186.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-22 00:34:02,925 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.7601394653320312 
2022-04-22 00:34:02,925 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 00:34:02,925 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-22 00:34:30,012 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.7601394653320312 
2022-04-22 00:34:30,012 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 00:34:30,012 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-22 00:35:10,536 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7763667106628418 
2022-04-22 00:35:10,536 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 00:35:10,536 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 00:35:15,279 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5
2022-04-22 00:35:15,280 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-22 00:35:15,280 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 00:35:15,281 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 00:35:15,282 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 00:35:22,952 reid_baseline.train INFO: start training
2022-04-22 00:35:55,739 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.133, Acc: 0.302, Base Lr: 8.72e-04
2022-04-22 00:36:11,734 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-22 00:36:41,304 reid_baseline.train INFO: normal accuracy 0.5215138544717278 4.171815395355225 
2022-04-22 00:37:11,241 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 00:37:11,241 reid_baseline.train INFO: Accuracy: 52.2% Mean Entropy: 417.2%
2022-04-22 00:37:47,900 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.832, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 00:38:03,037 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.341[s] Speed: 47.0[samples/s]
2022-04-22 00:38:29,565 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.149555206298828 
2022-04-22 00:38:59,580 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 00:38:59,581 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-22 00:39:30,499 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.277, Acc: 0.632, Base Lr: 2.46e-03
2022-04-22 00:39:45,609 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-22 00:40:12,906 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.9584946632385254 
2022-04-22 00:40:42,949 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 00:40:42,950 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 395.8%
2022-04-22 00:41:14,527 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.454, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 00:41:29,652 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 00:41:57,144 reid_baseline.train INFO: normal accuracy 0.5913494030186979 3.378286123275757 
2022-04-22 00:42:27,814 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 00:42:27,814 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 337.8%
2022-04-22 00:42:58,289 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.965, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 00:43:13,454 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 00:43:39,964 reid_baseline.train INFO: normal accuracy 0.6686190583464744 2.7769863605499268 
2022-04-22 00:44:10,019 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 00:44:10,020 reid_baseline.train INFO: Accuracy: 66.9% Mean Entropy: 277.7%
2022-04-22 00:44:40,769 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.657, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 00:44:55,416 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 00:45:22,265 reid_baseline.train INFO: normal accuracy 0.7343996395584591 2.4083163738250732 
2022-04-22 00:45:52,337 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 00:45:52,337 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 240.8%
2022-04-22 00:46:31,475 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.516, Acc: 0.800, Base Lr: 5.62e-03
2022-04-22 00:46:47,877 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-22 00:47:14,636 reid_baseline.train INFO: normal accuracy 0.7562514079747691 2.075247049331665 
2022-04-22 00:47:44,712 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 00:47:44,713 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.5%
2022-04-22 00:48:20,042 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.328, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 00:48:34,738 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-22 00:49:01,921 reid_baseline.train INFO: normal accuracy 0.7670646542013967 1.8711469173431396 
2022-04-22 00:49:32,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 00:49:32,123 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 187.1%
2022-04-22 00:50:06,082 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.288, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 00:50:22,137 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-22 00:50:59,979 reid_baseline.train INFO: normal accuracy 0.7794548321694075 1.7681595087051392 
2022-04-22 00:51:30,597 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 00:51:30,598 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 176.8%
2022-04-22 00:52:01,849 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.214, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 00:52:16,639 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-22 00:53:14,939 reid_baseline.train INFO: normal accuracy 0.7810317639107908 1.7264043092727661 
2022-04-22 00:53:45,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 00:53:45,008 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.6%
2022-04-22 00:54:15,338 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.182, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 00:54:31,424 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 00:55:03,218 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.6776492595672607 
2022-04-22 00:55:33,253 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 00:55:33,253 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.8%
2022-04-22 00:56:12,006 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.112, Acc: 0.917, Base Lr: 2.77e-03
2022-04-22 00:56:26,762 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.352[s] Speed: 45.5[samples/s]
2022-04-22 00:56:54,043 reid_baseline.train INFO: normal accuracy 0.7823834196891192 1.6737881898880005 
2022-04-22 00:57:24,092 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 00:57:24,092 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.4%
2022-04-22 00:57:54,687 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.115, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 00:58:10,798 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 00:58:57,203 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.696220874786377 
2022-04-22 00:58:57,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 00:58:57,203 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 169.6%
2022-04-22 00:59:27,371 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.120, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 00:59:42,339 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-22 01:00:09,841 reid_baseline.train INFO: normal accuracy 0.7866636629871593 1.668350100517273 
2022-04-22 01:00:40,108 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 01:00:40,108 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 166.8%
2022-04-22 01:01:17,953 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.088, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 01:01:33,190 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.349[s] Speed: 45.8[samples/s]
2022-04-22 01:02:00,008 reid_baseline.train INFO: normal accuracy 0.7859878350979951 1.6726324558258057 
2022-04-22 01:02:00,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 01:02:00,009 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.3%
2022-04-22 01:02:30,587 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.123, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 01:02:45,308 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 01:03:34,010 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5713902711868286 
2022-04-22 01:04:04,098 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 01:04:04,098 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.1%
2022-04-22 01:04:40,017 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.079, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 01:04:54,942 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.334[s] Speed: 47.8[samples/s]
2022-04-22 01:05:27,043 reid_baseline.train INFO: normal accuracy 0.7853120072088308 1.6840873956680298 
2022-04-22 01:05:27,043 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 01:05:27,043 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.4%
2022-04-22 01:06:04,476 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.054, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 01:06:18,859 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-22 01:06:46,201 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.6433285474777222 
2022-04-22 01:06:46,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 01:06:46,202 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.3%
2022-04-22 01:07:16,867 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.093, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 01:07:31,794 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 01:08:21,464 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.6863384246826172 
2022-04-22 01:08:21,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 01:08:21,465 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.6%
2022-04-22 01:08:51,956 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.112, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 01:09:06,374 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 01:10:02,387 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.6863207817077637 
2022-04-22 01:10:02,387 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 01:10:02,388 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 168.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-22 01:11:01,824 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5713902711868286 
2022-04-22 01:11:01,824 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 01:11:01,824 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-22 01:11:28,584 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5713902711868286 
2022-04-22 01:11:28,584 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 01:11:28,584 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-22 01:11:48,988 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7763887643814087 
2022-04-22 01:11:48,988 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 01:11:48,989 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 01:11:53,815 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5
2022-04-22 01:11:53,815 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-22 01:11:53,815 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 01:11:53,816 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 01:11:53,816 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 01:12:01,891 reid_baseline.train INFO: start training
2022-04-22 01:12:39,574 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.133, Acc: 0.302, Base Lr: 8.72e-04
2022-04-22 01:12:59,468 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.377[s] Speed: 42.5[samples/s]
2022-04-22 01:14:06,289 reid_baseline.train INFO: normal accuracy 0.6011016754647693 4.171506404876709 
2022-04-22 01:14:36,228 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 01:14:36,229 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-22 01:15:06,843 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.832, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 01:15:24,944 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.320[s] Speed: 49.9[samples/s]
2022-04-22 01:16:26,865 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.138621807098389 
2022-04-22 01:16:57,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 01:16:57,595 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-22 01:17:34,429 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.277, Acc: 0.632, Base Lr: 2.46e-03
2022-04-22 01:17:49,241 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.340[s] Speed: 47.1[samples/s]
2022-04-22 01:18:52,434 reid_baseline.train INFO: normal accuracy 0.6369061280697728 3.8435795307159424 
2022-04-22 01:19:22,474 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 01:19:22,475 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-22 01:19:54,238 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.454, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 01:20:12,596 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-22 01:21:12,975 reid_baseline.train INFO: normal accuracy 0.6825797567133348 3.100219488143921 
2022-04-22 01:21:43,033 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 01:21:43,034 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 310.0%
2022-04-22 01:22:21,273 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.965, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 01:22:39,855 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-22 01:23:40,901 reid_baseline.train INFO: normal accuracy 0.7438604544411292 2.4530277252197266 
2022-04-22 01:24:11,012 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 01:24:11,013 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-22 01:24:41,268 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.657, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 01:24:55,829 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-22 01:25:57,742 reid_baseline.train INFO: normal accuracy 0.7893045673628644 2.080764055252075 
2022-04-22 01:26:27,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 01:26:27,800 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 208.1%
2022-04-22 01:26:58,910 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.516, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 01:27:13,312 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-22 01:28:13,837 reid_baseline.train INFO: normal accuracy 0.8108790452145972 1.8063533306121826 
2022-04-22 01:28:43,866 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 01:28:43,867 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.6%
2022-04-22 01:29:13,826 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.327, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 01:29:28,342 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 01:30:29,396 reid_baseline.train INFO: normal accuracy 0.8207482212531558 1.6225987672805786 
2022-04-22 01:30:59,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 01:30:59,456 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.3%
2022-04-22 01:31:37,507 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.288, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 01:31:52,090 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.346[s] Speed: 46.3[samples/s]
2022-04-22 01:32:54,672 reid_baseline.train INFO: normal accuracy 0.8228138627495983 1.5137078762054443 
2022-04-22 01:33:24,730 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 01:33:24,730 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 151.4%
2022-04-22 01:33:55,909 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.214, Acc: 0.892, Base Lr: 4.01e-03
2022-04-22 01:34:10,515 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-22 01:35:43,433 reid_baseline.train INFO: normal accuracy 0.8299288501262336 1.4827492237091064 
2022-04-22 01:36:13,506 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 01:36:13,507 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-22 01:36:43,802 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.182, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 01:36:58,472 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 01:38:01,060 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.432864785194397 
2022-04-22 01:38:31,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 01:38:31,465 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 143.3%
2022-04-22 01:39:02,130 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.111, Acc: 0.918, Base Lr: 2.77e-03
2022-04-22 01:39:16,645 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-22 01:40:37,922 reid_baseline.train INFO: normal accuracy 0.8319944916226761 1.43816077709198 
2022-04-22 01:40:37,922 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 01:40:37,923 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.8%
2022-04-22 01:41:08,504 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.116, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 01:41:24,084 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-22 01:42:25,037 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.459081768989563 
2022-04-22 01:42:25,038 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 01:42:25,038 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.9%
2022-04-22 01:42:55,011 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.121, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 01:43:09,835 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-22 01:44:14,436 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.4423707723617554 
2022-04-22 01:44:14,436 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 01:44:14,437 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.2%
2022-04-22 01:44:44,676 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.088, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 01:44:59,673 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-22 01:46:20,287 reid_baseline.train INFO: normal accuracy 0.8370438375028689 1.4459155797958374 
2022-04-22 01:46:20,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 01:46:20,288 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 144.6%
2022-04-22 01:46:50,818 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.123, Acc: 0.927, Base Lr: 7.78e-04
2022-04-22 01:47:05,325 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 01:48:06,682 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.3539890050888062 
2022-04-22 01:48:36,751 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 01:48:36,751 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 135.4%
2022-04-22 01:49:15,031 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.079, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 01:49:33,718 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.375[s] Speed: 42.7[samples/s]
2022-04-22 01:50:44,830 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.4680955410003662 
2022-04-22 01:50:44,831 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 01:50:44,831 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.8%
2022-04-22 01:51:15,188 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.054, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 01:51:29,418 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 01:52:30,800 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.4284507036209106 
2022-04-22 01:52:30,801 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 01:52:30,801 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 142.8%
2022-04-22 01:53:01,301 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.093, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 01:53:16,403 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 01:54:31,535 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4661855697631836 
2022-04-22 01:54:31,535 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 01:54:31,536 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-22 01:55:01,630 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.112, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 01:55:15,894 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 01:56:48,655 reid_baseline.train INFO: normal accuracy 0.836584806059215 1.4671409130096436 
2022-04-22 01:56:48,655 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 01:56:48,655 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 146.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-22 01:58:28,989 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.3539890050888062 
2022-04-22 01:58:28,989 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 01:58:28,989 reid_baseline.train INFO: Accuracy: 83.7%
2022-04-22 01:59:30,184 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.3539890050888062 
2022-04-22 01:59:30,184 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 01:59:30,185 reid_baseline.train INFO: Shuffled Accuracy: 83.7%
2022-04-22 01:59:50,491 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7762307524681091 
2022-04-22 01:59:50,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 01:59:50,491 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 01:59:55,263 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6
2022-04-22 01:59:55,264 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-22 01:59:55,264 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 01:59:55,265 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 01:59:55,266 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 02:00:02,885 reid_baseline.train INFO: start training
2022-04-22 02:00:35,665 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.053, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 02:00:55,075 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-22 02:01:26,162 reid_baseline.train INFO: normal accuracy 0.4043528064146621 4.1715803146362305 
2022-04-22 02:01:56,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 02:01:56,122 reid_baseline.train INFO: Accuracy: 40.4% Mean Entropy: 417.2%
2022-04-22 02:02:26,613 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.736, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 02:02:41,523 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 02:03:08,461 reid_baseline.train INFO: normal accuracy 0.4300114547537228 4.15116548538208 
2022-04-22 02:03:38,510 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 02:03:38,511 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-22 02:04:09,356 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.170, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 02:04:24,953 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.306[s] Speed: 52.4[samples/s]
2022-04-22 02:05:03,990 reid_baseline.train INFO: normal accuracy 0.4524627720504009 3.97713565826416 
2022-04-22 02:05:34,007 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 02:05:34,008 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 397.7%
2022-04-22 02:06:05,495 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.371, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 02:06:21,948 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.315[s] Speed: 50.7[samples/s]
2022-04-22 02:06:52,629 reid_baseline.train INFO: normal accuracy 0.4877434135166094 3.4531173706054688 
2022-04-22 02:07:22,712 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 02:07:22,713 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 345.3%
2022-04-22 02:07:53,599 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.860, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 02:08:10,981 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.318[s] Speed: 50.4[samples/s]
2022-04-22 02:08:41,862 reid_baseline.train INFO: normal accuracy 0.5539518900343643 2.965876579284668 
2022-04-22 02:09:11,926 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 02:09:11,926 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.6%
2022-04-22 02:09:42,615 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.585, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 02:09:57,208 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 02:10:23,695 reid_baseline.train INFO: normal accuracy 0.6048109965635738 2.626401424407959 
2022-04-22 02:10:53,775 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 02:10:53,775 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 262.6%
2022-04-22 02:11:25,395 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.426, Acc: 0.802, Base Lr: 5.62e-03
2022-04-22 02:11:42,463 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-22 02:12:15,403 reid_baseline.train INFO: normal accuracy 0.6144329896907217 2.3179454803466797 
2022-04-22 02:12:45,571 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 02:12:45,572 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.8%
2022-04-22 02:13:16,049 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.234, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 02:13:30,602 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 02:13:58,016 reid_baseline.train INFO: normal accuracy 0.616036655211913 2.097730875015259 
2022-04-22 02:14:28,110 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 02:14:28,110 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 209.8%
2022-04-22 02:14:59,059 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.172, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 02:15:15,369 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-22 02:16:00,255 reid_baseline.train INFO: normal accuracy 0.6130584192439863 1.9763950109481812 
2022-04-22 02:16:30,325 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 02:16:30,326 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 197.6%
2022-04-22 02:17:02,832 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.112, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 02:17:20,197 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-22 02:18:17,254 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.9271701574325562 
2022-04-22 02:18:47,340 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 02:18:47,341 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.7%
2022-04-22 02:19:17,586 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.056, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 02:19:32,186 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 02:19:58,408 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.8669899702072144 
2022-04-22 02:20:28,428 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 02:20:28,429 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.7%
2022-04-22 02:20:59,050 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.030, Acc: 0.919, Base Lr: 2.77e-03
2022-04-22 02:21:13,846 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 02:21:40,483 reid_baseline.train INFO: normal accuracy 0.6306987399770905 1.8720093965530396 
2022-04-22 02:21:40,484 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 02:21:40,484 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 187.2%
2022-04-22 02:22:11,189 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.059, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 02:22:29,929 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-22 02:23:03,335 reid_baseline.train INFO: normal accuracy 0.6247422680412371 1.886432409286499 
2022-04-22 02:23:03,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 02:23:03,335 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.6%
2022-04-22 02:23:33,473 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.021, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 02:23:48,291 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-22 02:24:17,382 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.8603280782699585 
2022-04-22 02:24:47,437 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 02:24:47,438 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.0%
2022-04-22 02:25:23,883 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.000, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 02:25:38,905 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.339[s] Speed: 47.3[samples/s]
2022-04-22 02:26:27,272 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.851548433303833 
2022-04-22 02:26:57,331 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 02:26:57,332 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 185.2%
2022-04-22 02:27:27,396 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.975, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 02:27:41,767 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-22 02:28:07,507 reid_baseline.train INFO: normal accuracy 0.6329896907216495 1.7603994607925415 
2022-04-22 02:28:37,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 02:28:37,534 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.0%
2022-04-22 02:29:07,422 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.969, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 02:29:21,846 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-22 02:29:48,513 reid_baseline.train INFO: normal accuracy 0.6355097365406643 1.8779666423797607 
2022-04-22 02:29:48,513 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 02:29:48,514 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 187.8%
2022-04-22 02:30:18,439 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.981, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 02:30:32,402 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 02:30:58,960 reid_baseline.train INFO: normal accuracy 0.634135166093929 1.8322614431381226 
2022-04-22 02:30:58,961 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 02:30:58,961 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.2%
2022-04-22 02:31:29,092 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.976, Acc: 0.923, Base Lr: 6.51e-05
2022-04-22 02:31:43,765 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-22 02:32:10,658 reid_baseline.train INFO: normal accuracy 0.6316151202749141 1.8689571619033813 
2022-04-22 02:32:10,658 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 02:32:10,659 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 186.9%
2022-04-22 02:32:40,438 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.977, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 02:32:54,339 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.287[s] Speed: 55.7[samples/s]
2022-04-22 02:33:50,247 reid_baseline.train INFO: normal accuracy 0.633906071019473 1.8693575859069824 
2022-04-22 02:33:50,247 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 02:33:50,247 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 186.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-22 02:34:46,624 reid_baseline.train INFO: normal accuracy 0.6329896907216495 1.7603994607925415 
2022-04-22 02:34:46,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 02:34:46,624 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-22 02:35:13,369 reid_baseline.train INFO: normal accuracy 0.6329896907216495 1.7603994607925415 
2022-04-22 02:35:13,369 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 02:35:13,370 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-22 02:35:34,314 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7761951684951782 
2022-04-22 02:35:34,315 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 02:35:34,315 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 02:35:39,030 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6
2022-04-22 02:35:39,030 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-22 02:35:39,031 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 02:35:39,032 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 02:35:39,033 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 02:35:46,211 reid_baseline.train INFO: start training
2022-04-22 02:36:18,562 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.053, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 02:36:34,021 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-22 02:37:01,211 reid_baseline.train INFO: normal accuracy 0.5212885785086732 4.171815395355225 
2022-04-22 02:37:31,136 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 02:37:31,137 reid_baseline.train INFO: Accuracy: 52.1% Mean Entropy: 417.2%
2022-04-22 02:38:01,542 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.736, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 02:38:16,235 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-22 02:38:43,073 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.149552822113037 
2022-04-22 02:39:13,134 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 02:39:13,135 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-22 02:39:43,707 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.170, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 02:39:58,434 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 02:40:25,916 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.9584858417510986 
2022-04-22 02:40:56,046 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 02:40:56,047 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 395.8%
2022-04-22 02:41:26,988 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.371, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 02:41:41,737 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-22 02:42:08,261 reid_baseline.train INFO: normal accuracy 0.5913494030186979 3.378413200378418 
2022-04-22 02:42:38,306 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 02:42:38,307 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 337.8%
2022-04-22 02:43:08,096 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.860, Acc: 0.709, Base Lr: 4.04e-03
2022-04-22 02:43:22,752 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-22 02:43:48,722 reid_baseline.train INFO: normal accuracy 0.6686190583464744 2.777204990386963 
2022-04-22 02:44:18,833 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 02:44:18,833 reid_baseline.train INFO: Accuracy: 66.9% Mean Entropy: 277.7%
2022-04-22 02:44:49,200 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.585, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 02:45:03,593 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-22 02:45:30,884 reid_baseline.train INFO: normal accuracy 0.7343996395584591 2.4090676307678223 
2022-04-22 02:46:01,112 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 02:46:01,113 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 240.9%
2022-04-22 02:46:32,068 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.426, Acc: 0.800, Base Lr: 5.62e-03
2022-04-22 02:46:46,331 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-22 02:47:13,938 reid_baseline.train INFO: normal accuracy 0.7564766839378239 2.074683666229248 
2022-04-22 02:47:44,003 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 02:47:44,003 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.5%
2022-04-22 02:48:14,169 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.234, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 02:48:28,288 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-22 02:48:56,242 reid_baseline.train INFO: normal accuracy 0.7670646542013967 1.8708138465881348 
2022-04-22 02:49:26,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 02:49:26,267 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 187.1%
2022-04-22 02:49:57,199 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.172, Acc: 0.869, Base Lr: 7.21e-03
2022-04-22 02:50:15,827 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.326[s] Speed: 49.1[samples/s]
2022-04-22 02:50:43,241 reid_baseline.train INFO: normal accuracy 0.779905384095517 1.7662420272827148 
2022-04-22 02:51:13,320 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 02:51:13,321 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 176.6%
2022-04-22 02:51:44,313 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.112, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 02:51:58,738 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 02:53:05,886 reid_baseline.train INFO: normal accuracy 0.7803559360216265 1.7263621091842651 
2022-04-22 02:53:35,927 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 02:53:35,928 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 172.6%
2022-04-22 02:54:05,939 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.056, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 02:54:20,396 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-22 02:54:48,047 reid_baseline.train INFO: normal accuracy 0.7812570398738454 1.6771517992019653 
2022-04-22 02:55:18,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 02:55:18,343 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 167.7%
2022-04-22 02:55:48,607 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.030, Acc: 0.917, Base Lr: 2.77e-03
2022-04-22 02:56:02,907 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 02:56:29,313 reid_baseline.train INFO: normal accuracy 0.781707591799955 1.6733506917953491 
2022-04-22 02:56:59,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 02:56:59,343 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.3%
2022-04-22 02:57:29,606 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.059, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 02:57:44,919 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-22 02:58:11,586 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.6966438293457031 
2022-04-22 02:58:11,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 02:58:11,586 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 169.7%
2022-04-22 02:58:41,272 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.021, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 02:58:55,927 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 02:59:22,936 reid_baseline.train INFO: normal accuracy 0.7873394908763235 1.6686198711395264 
2022-04-22 02:59:53,381 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 02:59:53,381 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 166.9%
2022-04-22 03:00:27,965 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.999, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 03:00:42,943 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.326[s] Speed: 49.1[samples/s]
2022-04-22 03:01:09,691 reid_baseline.train INFO: normal accuracy 0.7859878350979951 1.6730401515960693 
2022-04-22 03:01:09,691 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 03:01:09,691 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.3%
2022-04-22 03:01:39,869 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.975, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 03:01:54,261 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 03:02:23,507 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5712308883666992 
2022-04-22 03:02:53,656 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 03:02:53,656 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.1%
2022-04-22 03:03:23,588 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.969, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 03:03:37,998 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 03:04:04,491 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.683931827545166 
2022-04-22 03:04:04,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 03:04:04,491 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.4%
2022-04-22 03:04:34,557 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.980, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 03:04:51,414 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-22 03:05:25,998 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.6431630849838257 
2022-04-22 03:05:25,998 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 03:05:25,999 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.3%
2022-04-22 03:05:56,000 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.975, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 03:06:10,644 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 03:06:38,469 reid_baseline.train INFO: normal accuracy 0.7853120072088308 1.686193585395813 
2022-04-22 03:06:38,469 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 03:06:38,470 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.6%
2022-04-22 03:07:11,343 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.976, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 03:07:27,770 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.324[s] Speed: 49.3[samples/s]
2022-04-22 03:08:24,089 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.685722827911377 
2022-04-22 03:08:24,090 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 03:08:24,090 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 168.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-22 03:09:42,624 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5712308883666992 
2022-04-22 03:09:42,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 03:09:42,624 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-22 03:10:09,398 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5712308883666992 
2022-04-22 03:10:09,398 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 03:10:09,399 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-22 03:10:29,749 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7765048742294312 
2022-04-22 03:10:29,750 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 03:10:29,750 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 03:10:34,501 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6
2022-04-22 03:10:34,501 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-22 03:10:34,502 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 03:10:34,503 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 03:10:34,504 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 03:10:41,903 reid_baseline.train INFO: start training
2022-04-22 03:11:14,121 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.053, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 03:11:31,588 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-22 03:12:41,822 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.171506404876709 
2022-04-22 03:13:11,770 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 03:13:11,771 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-22 03:13:42,347 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.736, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 03:14:01,460 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.327[s] Speed: 49.0[samples/s]
2022-04-22 03:15:01,362 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.138622760772705 
2022-04-22 03:15:31,471 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 03:15:31,472 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-22 03:16:02,445 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.170, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 03:16:20,522 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.323[s] Speed: 49.6[samples/s]
2022-04-22 03:17:24,346 reid_baseline.train INFO: normal accuracy 0.6369061280697728 3.843578577041626 
2022-04-22 03:17:54,428 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 03:17:54,428 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-22 03:18:26,031 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.371, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 03:18:44,296 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-22 03:19:44,295 reid_baseline.train INFO: normal accuracy 0.6823502409915079 3.1003835201263428 
2022-04-22 03:20:14,770 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 03:20:14,771 reid_baseline.train INFO: Accuracy: 68.2% Mean Entropy: 310.0%
2022-04-22 03:20:46,389 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.860, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 03:21:01,976 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-22 03:22:10,389 reid_baseline.train INFO: normal accuracy 0.7438604544411292 2.4533984661102295 
2022-04-22 03:22:40,476 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 03:22:40,477 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-22 03:23:11,137 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.585, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 03:23:29,441 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-22 03:24:30,403 reid_baseline.train INFO: normal accuracy 0.7893045673628644 2.0805609226226807 
2022-04-22 03:25:00,505 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 03:25:00,506 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 208.1%
2022-04-22 03:25:33,420 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.426, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 03:25:49,512 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.322[s] Speed: 49.6[samples/s]
2022-04-22 03:26:49,172 reid_baseline.train INFO: normal accuracy 0.8113380766582511 1.8065673112869263 
2022-04-22 03:27:19,219 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 03:27:19,220 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.7%
2022-04-22 03:27:49,170 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.234, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 03:28:03,306 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 03:29:03,677 reid_baseline.train INFO: normal accuracy 0.8202891898095019 1.622843623161316 
2022-04-22 03:29:33,733 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 03:29:33,734 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 162.3%
2022-04-22 03:30:04,135 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.172, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 03:30:18,459 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-22 03:31:20,183 reid_baseline.train INFO: normal accuracy 0.8237319256369061 1.5139999389648438 
2022-04-22 03:31:50,218 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 03:31:50,218 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 151.4%
2022-04-22 03:32:21,250 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.112, Acc: 0.891, Base Lr: 4.01e-03
2022-04-22 03:32:35,505 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-22 03:34:07,531 reid_baseline.train INFO: normal accuracy 0.8296993344044067 1.4835703372955322 
2022-04-22 03:34:37,600 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 03:34:37,600 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.4%
2022-04-22 03:35:07,459 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.056, Acc: 0.911, Base Lr: 3.38e-03
2022-04-22 03:35:21,773 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 03:36:24,295 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.4332220554351807 
2022-04-22 03:36:54,372 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 03:36:54,372 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 143.3%
2022-04-22 03:37:24,493 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.030, Acc: 0.919, Base Lr: 2.77e-03
2022-04-22 03:37:38,875 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-22 03:38:54,539 reid_baseline.train INFO: normal accuracy 0.8333715859536378 1.438179850578308 
2022-04-22 03:38:54,539 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 03:38:54,540 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 143.8%
2022-04-22 03:39:24,898 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.059, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 03:39:40,229 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 03:40:58,410 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4586464166641235 
2022-04-22 03:40:58,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 03:40:58,411 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.9%
2022-04-22 03:41:33,097 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.021, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 03:41:47,858 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.325[s] Speed: 49.3[samples/s]
2022-04-22 03:42:51,612 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.4421498775482178 
2022-04-22 03:42:51,613 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 03:42:51,613 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.2%
2022-04-22 03:43:21,652 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.000, Acc: 0.934, Base Lr: 1.19e-03
2022-04-22 03:43:36,540 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 03:44:38,825 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.445554256439209 
2022-04-22 03:44:38,826 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 03:44:38,826 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 144.6%
2022-04-22 03:45:08,836 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.975, Acc: 0.927, Base Lr: 7.78e-04
2022-04-22 03:45:23,170 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-22 03:46:37,647 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.353925347328186 
2022-04-22 03:47:07,860 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 03:47:07,861 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 135.4%
2022-04-22 03:47:37,595 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.970, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 03:47:51,925 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 03:49:04,762 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4684081077575684 
2022-04-22 03:49:04,763 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 03:49:04,763 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.8%
2022-04-22 03:49:38,565 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.981, Acc: 0.934, Base Lr: 2.11e-04
2022-04-22 03:49:52,450 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.314[s] Speed: 51.0[samples/s]
2022-04-22 03:50:52,373 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.4284759759902954 
2022-04-22 03:50:52,374 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 03:50:52,374 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 142.8%
2022-04-22 03:51:25,438 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.976, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 03:51:41,417 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.323[s] Speed: 49.6[samples/s]
2022-04-22 03:52:44,384 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4661757946014404 
2022-04-22 03:52:44,385 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 03:52:44,385 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-22 03:53:14,196 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.977, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 03:53:28,109 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-22 03:55:01,343 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4673982858657837 
2022-04-22 03:55:01,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 03:55:01,343 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-22 03:56:50,903 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.353925347328186 
2022-04-22 03:56:50,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 03:56:50,904 reid_baseline.train INFO: Accuracy: 83.7%
2022-04-22 03:57:52,161 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.353925347328186 
2022-04-22 03:57:52,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 03:57:52,162 reid_baseline.train INFO: Shuffled Accuracy: 83.7%
2022-04-22 03:58:32,919 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7760322690010071 
2022-04-22 03:58:32,920 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 03:58:32,920 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 03:58:37,659 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_7
2022-04-22 03:58:37,659 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_7', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=7)
2022-04-22 03:58:37,659 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 03:58:37,660 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 03:58:37,661 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_7
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 03:58:45,082 reid_baseline.train INFO: start training
2022-04-22 03:59:17,322 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.075, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 03:59:32,805 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-22 03:59:59,920 reid_baseline.train INFO: normal accuracy 0.404581901489118 4.171579837799072 
2022-04-22 04:00:30,157 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 04:00:30,158 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 417.2%
2022-04-22 04:01:07,966 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.772, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 04:01:22,463 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-22 04:01:48,235 reid_baseline.train INFO: normal accuracy 0.4300114547537228 4.15116548538208 
2022-04-22 04:02:18,274 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 04:02:18,275 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-22 04:02:48,762 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.177, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 04:03:06,764 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-22 04:03:36,944 reid_baseline.train INFO: normal accuracy 0.4526918671248568 3.9771156311035156 
2022-04-22 04:04:06,994 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 04:04:06,995 reid_baseline.train INFO: Accuracy: 45.3% Mean Entropy: 397.7%
2022-04-22 04:04:37,850 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.412, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 04:04:52,639 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 04:05:40,455 reid_baseline.train INFO: normal accuracy 0.4879725085910653 3.4531257152557373 
2022-04-22 04:06:10,523 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 04:06:10,523 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 345.3%
2022-04-22 04:06:40,284 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.936, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 04:06:55,540 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 04:07:32,223 reid_baseline.train INFO: normal accuracy 0.5539518900343643 2.9665415287017822 
2022-04-22 04:08:02,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 04:08:02,256 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.7%
2022-04-22 04:08:32,297 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.625, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 04:08:46,495 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-22 04:09:11,542 reid_baseline.train INFO: normal accuracy 0.604581901489118 2.626833438873291 
2022-04-22 04:09:42,002 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 04:09:42,003 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 262.7%
2022-04-22 04:10:19,060 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.486, Acc: 0.800, Base Lr: 5.62e-03
2022-04-22 04:10:33,286 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.337[s] Speed: 47.4[samples/s]
2022-04-22 04:10:58,999 reid_baseline.train INFO: normal accuracy 0.6139747995418099 2.317903518676758 
2022-04-22 04:11:29,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 04:11:29,065 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.8%
2022-04-22 04:11:59,156 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.287, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 04:12:16,168 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-22 04:12:48,986 reid_baseline.train INFO: normal accuracy 0.6153493699885453 2.097928285598755 
2022-04-22 04:13:19,070 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 04:13:19,070 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 209.8%
2022-04-22 04:13:49,452 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.224, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 04:14:03,730 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-22 04:14:29,491 reid_baseline.train INFO: normal accuracy 0.6126002290950745 1.9748542308807373 
2022-04-22 04:14:59,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 04:14:59,533 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 197.5%
2022-04-22 04:15:30,382 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.126, Acc: 0.892, Base Lr: 4.01e-03
2022-04-22 04:15:44,778 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-22 04:16:41,534 reid_baseline.train INFO: normal accuracy 0.6210767468499427 1.9267750978469849 
2022-04-22 04:17:11,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 04:17:11,587 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.7%
2022-04-22 04:17:41,292 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.115, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 04:17:55,576 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 04:18:21,780 reid_baseline.train INFO: normal accuracy 0.6268041237113402 1.8660268783569336 
2022-04-22 04:18:51,816 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 04:18:51,816 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 186.6%
2022-04-22 04:19:21,866 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.087, Acc: 0.919, Base Lr: 2.77e-03
2022-04-22 04:19:36,089 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-22 04:20:02,328 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8710763454437256 
2022-04-22 04:20:02,329 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 04:20:02,329 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.1%
2022-04-22 04:20:32,442 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.080, Acc: 0.912, Base Lr: 2.20e-03
2022-04-22 04:20:47,559 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-22 04:21:13,864 reid_baseline.train INFO: normal accuracy 0.6245131729667812 1.8864959478378296 
2022-04-22 04:21:13,864 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 04:21:13,864 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.6%
2022-04-22 04:21:43,415 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.030, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 04:21:58,094 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-22 04:22:24,631 reid_baseline.train INFO: normal accuracy 0.6306987399770905 1.8603357076644897 
2022-04-22 04:22:54,744 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 04:22:54,744 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.0%
2022-04-22 04:23:24,989 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.047, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 04:23:39,828 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 04:24:05,816 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.8518092632293701 
2022-04-22 04:24:35,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 04:24:35,891 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 185.2%
2022-04-22 04:25:05,897 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.044, Acc: 0.927, Base Lr: 7.78e-04
2022-04-22 04:25:20,233 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-22 04:26:08,865 reid_baseline.train INFO: normal accuracy 0.6320733104238259 1.760143756866455 
2022-04-22 04:26:38,920 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 04:26:38,920 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 176.0%
2022-04-22 04:27:08,965 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.011, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 04:27:25,455 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-22 04:27:57,279 reid_baseline.train INFO: normal accuracy 0.6357388316151202 1.8776880502700806 
2022-04-22 04:27:57,280 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 04:27:57,280 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 187.8%
2022-04-22 04:28:29,631 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.028, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 04:28:47,015 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.327[s] Speed: 48.9[samples/s]
2022-04-22 04:29:12,633 reid_baseline.train INFO: normal accuracy 0.633906071019473 1.8320071697235107 
2022-04-22 04:29:12,634 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 04:29:12,634 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.2%
2022-04-22 04:29:42,633 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.021, Acc: 0.925, Base Lr: 6.51e-05
2022-04-22 04:29:57,232 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-22 04:30:23,420 reid_baseline.train INFO: normal accuracy 0.6311569301260023 1.8684028387069702 
2022-04-22 04:30:23,420 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 04:30:23,420 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.8%
2022-04-22 04:30:53,311 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.008, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 04:31:07,243 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 04:32:02,613 reid_baseline.train INFO: normal accuracy 0.6345933562428407 1.8687834739685059 
2022-04-22 04:32:02,614 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 04:32:02,614 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 186.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_7/transformer_best_model.pth
2022-04-22 04:32:58,996 reid_baseline.train INFO: normal accuracy 0.6320733104238259 1.760143756866455 
2022-04-22 04:32:58,996 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 04:32:58,997 reid_baseline.train INFO: Accuracy: 63.2%
2022-04-22 04:33:26,022 reid_baseline.train INFO: normal accuracy 0.6320733104238259 1.760143756866455 
2022-04-22 04:33:26,022 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 04:33:26,023 reid_baseline.train INFO: Shuffled Accuracy: 63.2%
2022-04-22 04:33:46,335 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7764711380004883 
2022-04-22 04:33:46,336 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 04:33:46,336 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 04:33:51,036 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_7
2022-04-22 04:33:51,036 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_7', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=7)
2022-04-22 04:33:51,036 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 04:33:51,037 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 04:33:51,038 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_7
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 04:33:58,394 reid_baseline.train INFO: start training
2022-04-22 04:34:30,449 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.075, Acc: 0.302, Base Lr: 8.72e-04
2022-04-22 04:34:45,762 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.7[samples/s]
2022-04-22 04:35:34,991 reid_baseline.train INFO: normal accuracy 0.5212885785086732 4.171815395355225 
2022-04-22 04:36:05,104 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 04:36:05,104 reid_baseline.train INFO: Accuracy: 52.1% Mean Entropy: 417.2%
2022-04-22 04:36:35,140 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.772, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 04:36:49,730 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 04:37:15,309 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.149555206298828 
2022-04-22 04:37:45,351 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 04:37:45,351 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-22 04:38:15,823 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.177, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 04:38:31,068 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-22 04:39:11,891 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.958501100540161 
2022-04-22 04:39:41,923 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 04:39:41,924 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 395.9%
2022-04-22 04:40:12,774 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.412, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 04:40:27,572 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 04:40:53,520 reid_baseline.train INFO: normal accuracy 0.5908988510925884 3.37854266166687 
2022-04-22 04:41:23,682 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 04:41:23,682 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 337.9%
2022-04-22 04:41:53,510 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.936, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 04:42:12,938 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-22 04:42:40,800 reid_baseline.train INFO: normal accuracy 0.668168506420365 2.7767999172210693 
2022-04-22 04:43:10,858 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 04:43:10,859 reid_baseline.train INFO: Accuracy: 66.8% Mean Entropy: 277.7%
2022-04-22 04:43:40,974 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.625, Acc: 0.770, Base Lr: 4.83e-03
2022-04-22 04:43:55,216 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 04:44:21,902 reid_baseline.train INFO: normal accuracy 0.7330479837801307 2.4084112644195557 
2022-04-22 04:44:51,943 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 04:44:51,944 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 240.8%
2022-04-22 04:45:22,952 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.486, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 04:45:39,975 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-22 04:46:11,362 reid_baseline.train INFO: normal accuracy 0.7560261320117143 2.075228214263916 
2022-04-22 04:46:41,461 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 04:46:41,462 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.5%
2022-04-22 04:47:11,170 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.287, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 04:47:25,398 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 04:47:52,499 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.8719743490219116 
2022-04-22 04:48:22,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 04:48:22,904 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 187.2%
2022-04-22 04:48:52,971 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.224, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 04:49:08,915 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-22 04:49:45,340 reid_baseline.train INFO: normal accuracy 0.7801306600585718 1.7676777839660645 
2022-04-22 04:50:15,418 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 04:50:15,418 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 176.8%
2022-04-22 04:50:46,125 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.126, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 04:51:00,495 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.297[s] Speed: 54.0[samples/s]
2022-04-22 04:51:58,381 reid_baseline.train INFO: normal accuracy 0.780806487947736 1.7274246215820312 
2022-04-22 04:52:28,771 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 04:52:28,772 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.7%
2022-04-22 04:53:00,575 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.115, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 04:53:17,600 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-22 04:53:44,313 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.6747878789901733 
2022-04-22 04:54:14,379 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 04:54:14,379 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.5%
2022-04-22 04:54:44,474 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.087, Acc: 0.916, Base Lr: 2.77e-03
2022-04-22 04:54:58,713 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-22 04:55:25,760 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.6738512516021729 
2022-04-22 04:55:55,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 04:55:55,848 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.4%
2022-04-22 04:56:27,851 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.080, Acc: 0.910, Base Lr: 2.20e-03
2022-04-22 04:56:46,115 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-22 04:57:13,127 reid_baseline.train INFO: normal accuracy 0.782608695652174 1.6974915266036987 
2022-04-22 04:57:13,127 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 04:57:13,127 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 169.7%
2022-04-22 04:57:42,650 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.030, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 04:57:57,208 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 04:58:23,424 reid_baseline.train INFO: normal accuracy 0.7859878350979951 1.669140100479126 
2022-04-22 04:58:53,525 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 04:58:53,525 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 166.9%
2022-04-22 04:59:23,438 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.047, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 04:59:38,467 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-22 05:00:24,849 reid_baseline.train INFO: normal accuracy 0.7859878350979951 1.6732087135314941 
2022-04-22 05:00:24,850 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 05:00:24,850 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.3%
2022-04-22 05:00:54,902 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.044, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 05:01:09,059 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-22 05:01:35,899 reid_baseline.train INFO: normal accuracy 0.7839603514305024 1.571530818939209 
2022-04-22 05:02:05,949 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 05:02:05,950 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.2%
2022-04-22 05:02:35,654 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.011, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 05:02:49,947 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-22 05:03:38,369 reid_baseline.train INFO: normal accuracy 0.7855372831718855 1.6842244863510132 
2022-04-22 05:03:38,369 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 05:03:38,370 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 168.4%
2022-04-22 05:04:08,352 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.028, Acc: 0.933, Base Lr: 2.11e-04
2022-04-22 05:04:22,353 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-22 05:04:49,466 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.643467664718628 
2022-04-22 05:04:49,466 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 05:04:49,466 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.3%
2022-04-22 05:05:28,343 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.021, Acc: 0.923, Base Lr: 6.51e-05
2022-04-22 05:05:42,924 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.352[s] Speed: 45.5[samples/s]
2022-04-22 05:06:10,978 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.6859644651412964 
2022-04-22 05:06:10,979 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 05:06:10,979 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.6%
2022-04-22 05:06:40,927 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.009, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 05:06:54,913 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 05:07:51,267 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.6866374015808105 
2022-04-22 05:07:51,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 05:07:51,268 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_7/transformer_best_model.pth
2022-04-22 05:08:47,189 reid_baseline.train INFO: normal accuracy 0.7839603514305024 1.571530818939209 
2022-04-22 05:08:47,189 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 05:08:47,189 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-22 05:09:13,632 reid_baseline.train INFO: normal accuracy 0.7839603514305024 1.571530818939209 
2022-04-22 05:09:13,632 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 05:09:13,633 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-22 05:09:34,234 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7767601609230042 
2022-04-22 05:09:34,234 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 05:09:34,234 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 05:09:38,994 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_7
2022-04-22 05:09:38,995 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_7', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=7)
2022-04-22 05:09:38,995 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 05:09:38,996 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 05:09:38,997 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_7
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 05:09:46,291 reid_baseline.train INFO: start training
2022-04-22 05:10:18,436 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.075, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 05:10:35,164 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.319[s] Speed: 50.1[samples/s]
2022-04-22 05:11:46,520 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.171506404876709 
2022-04-22 05:12:16,475 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 05:12:16,476 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-22 05:12:46,435 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.772, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 05:13:01,063 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-22 05:14:13,825 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.1386237144470215 
2022-04-22 05:14:44,061 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 05:14:44,061 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-22 05:15:14,269 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.177, Acc: 0.632, Base Lr: 2.46e-03
2022-04-22 05:15:28,908 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 05:16:32,554 reid_baseline.train INFO: normal accuracy 0.6369061280697728 3.843581438064575 
2022-04-22 05:17:02,888 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 05:17:02,889 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-22 05:17:33,758 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.412, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 05:17:48,449 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-22 05:18:47,768 reid_baseline.train INFO: normal accuracy 0.6828092724351618 3.1002705097198486 
2022-04-22 05:19:17,847 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 05:19:17,847 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 310.0%
2022-04-22 05:19:47,610 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.936, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 05:20:02,215 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 05:21:03,998 reid_baseline.train INFO: normal accuracy 0.7440899701629562 2.4530727863311768 
2022-04-22 05:21:34,076 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 05:21:34,076 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-22 05:22:04,237 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.625, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 05:22:18,449 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 05:23:19,955 reid_baseline.train INFO: normal accuracy 0.7893045673628644 2.08107852935791 
2022-04-22 05:23:50,407 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 05:23:50,407 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 208.1%
2022-04-22 05:24:21,026 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.486, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 05:24:35,169 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-22 05:25:34,837 reid_baseline.train INFO: normal accuracy 0.8111085609364241 1.8069292306900024 
2022-04-22 05:26:05,003 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 05:26:05,004 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.7%
2022-04-22 05:26:34,825 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.287, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 05:26:48,851 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 05:27:48,887 reid_baseline.train INFO: normal accuracy 0.8209777369749828 1.6224486827850342 
2022-04-22 05:28:19,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 05:28:19,001 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.2%
2022-04-22 05:28:49,379 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.224, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 05:29:03,665 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 05:30:05,989 reid_baseline.train INFO: normal accuracy 0.8232728941932522 1.5147395133972168 
2022-04-22 05:30:36,073 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 05:30:36,073 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 151.5%
2022-04-22 05:31:06,819 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.127, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 05:31:21,150 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.297[s] Speed: 54.0[samples/s]
2022-04-22 05:32:52,752 reid_baseline.train INFO: normal accuracy 0.8296993344044067 1.482617735862732 
2022-04-22 05:33:22,878 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 05:33:22,878 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-22 05:33:52,569 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.115, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 05:34:06,864 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-22 05:35:08,933 reid_baseline.train INFO: normal accuracy 0.8310764287353684 1.432928204536438 
2022-04-22 05:35:39,015 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 05:35:39,016 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 143.3%
2022-04-22 05:36:09,030 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.088, Acc: 0.919, Base Lr: 2.77e-03
2022-04-22 05:36:23,207 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-22 05:37:39,284 reid_baseline.train INFO: normal accuracy 0.8319944916226761 1.4376749992370605 
2022-04-22 05:37:39,284 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 05:37:39,285 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.8%
2022-04-22 05:38:09,329 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.080, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 05:38:24,579 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 05:39:29,187 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4584360122680664 
2022-04-22 05:39:29,187 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 05:39:29,188 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.8%
2022-04-22 05:40:07,123 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.030, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 05:40:21,661 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-22 05:41:25,745 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.4417684078216553 
2022-04-22 05:41:25,746 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 05:41:25,746 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.2%
2022-04-22 05:41:55,668 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.047, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 05:42:10,505 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-22 05:43:13,615 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4457898139953613 
2022-04-22 05:43:13,615 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 05:43:13,616 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 144.6%
2022-04-22 05:43:43,748 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.044, Acc: 0.927, Base Lr: 7.78e-04
2022-04-22 05:43:58,082 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-22 05:44:58,970 reid_baseline.train INFO: normal accuracy 0.8381914161120037 1.3540194034576416 
2022-04-22 05:45:29,036 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 05:45:29,037 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 135.4%
2022-04-22 05:45:58,913 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.011, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 05:46:13,140 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 05:47:32,005 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.468214511871338 
2022-04-22 05:47:32,005 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 05:47:32,005 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.8%
2022-04-22 05:48:02,041 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.028, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 05:48:15,985 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-22 05:49:25,577 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.428443193435669 
2022-04-22 05:49:25,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 05:49:25,578 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 142.8%
2022-04-22 05:50:00,990 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.021, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 05:50:15,561 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.329[s] Speed: 48.7[samples/s]
2022-04-22 05:51:18,351 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4660309553146362 
2022-04-22 05:51:18,352 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 05:51:18,352 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-22 05:51:50,651 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.009, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 05:52:07,953 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.326[s] Speed: 49.0[samples/s]
2022-04-22 05:53:40,301 reid_baseline.train INFO: normal accuracy 0.8356667431719073 1.466688871383667 
2022-04-22 05:53:40,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 05:53:40,302 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_7/transformer_best_model.pth
2022-04-22 05:55:18,270 reid_baseline.train INFO: normal accuracy 0.8381914161120037 1.3540194034576416 
2022-04-22 05:55:18,271 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 05:55:18,271 reid_baseline.train INFO: Accuracy: 83.8%
2022-04-22 05:56:35,714 reid_baseline.train INFO: normal accuracy 0.8381914161120037 1.3540194034576416 
2022-04-22 05:56:35,714 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 05:56:35,714 reid_baseline.train INFO: Shuffled Accuracy: 83.8%
2022-04-22 05:56:55,867 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7763295769691467 
2022-04-22 05:56:55,868 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 05:56:55,868 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 05:57:00,608 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_8
2022-04-22 05:57:00,608 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=8)
2022-04-22 05:57:00,609 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 05:57:00,609 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 05:57:00,610 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 05:57:07,891 reid_baseline.train INFO: start training
2022-04-22 05:57:39,920 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.029, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 05:57:55,278 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.7[samples/s]
2022-04-22 05:58:44,821 reid_baseline.train INFO: normal accuracy 0.4043528064146621 4.171579837799072 
2022-04-22 05:59:14,877 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 05:59:14,878 reid_baseline.train INFO: Accuracy: 40.4% Mean Entropy: 417.2%
2022-04-22 05:59:44,685 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.722, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 05:59:59,329 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-22 06:00:34,684 reid_baseline.train INFO: normal accuracy 0.4300114547537228 4.15116548538208 
2022-04-22 06:01:04,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 06:01:04,910 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-22 06:01:35,114 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.139, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 06:01:49,819 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 06:02:17,484 reid_baseline.train INFO: normal accuracy 0.4526918671248568 3.97713303565979 
2022-04-22 06:02:48,043 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 06:02:48,043 reid_baseline.train INFO: Accuracy: 45.3% Mean Entropy: 397.7%
2022-04-22 06:03:23,924 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.345, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 06:03:38,501 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-22 06:04:03,822 reid_baseline.train INFO: normal accuracy 0.4879725085910653 3.4530029296875 
2022-04-22 06:04:33,935 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 06:04:33,935 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 345.3%
2022-04-22 06:05:05,839 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.822, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 06:05:23,114 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.324[s] Speed: 49.5[samples/s]
2022-04-22 06:05:49,252 reid_baseline.train INFO: normal accuracy 0.5539518900343643 2.966266632080078 
2022-04-22 06:06:19,376 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 06:06:19,377 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.6%
2022-04-22 06:06:53,855 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.562, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 06:07:08,108 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-22 06:07:57,068 reid_baseline.train INFO: normal accuracy 0.6048109965635738 2.62550950050354 
2022-04-22 06:08:27,164 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 06:08:27,164 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 262.6%
2022-04-22 06:08:57,921 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.402, Acc: 0.802, Base Lr: 5.62e-03
2022-04-22 06:09:12,082 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 06:09:37,931 reid_baseline.train INFO: normal accuracy 0.6139747995418099 2.318138599395752 
2022-04-22 06:10:08,658 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 06:10:08,659 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.8%
2022-04-22 06:10:38,369 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.206, Acc: 0.860, Base Lr: 6.42e-03
2022-04-22 06:10:52,530 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 06:11:19,332 reid_baseline.train INFO: normal accuracy 0.6153493699885453 2.097677230834961 
2022-04-22 06:11:49,414 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 06:11:49,415 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 209.8%
2022-04-22 06:12:24,763 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.125, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 06:12:39,059 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.326[s] Speed: 49.0[samples/s]
2022-04-22 06:13:04,940 reid_baseline.train INFO: normal accuracy 0.6142038946162658 1.9769972562789917 
2022-04-22 06:13:35,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 06:13:35,010 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 197.7%
2022-04-22 06:14:05,620 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.093, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 06:14:20,010 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-22 06:15:16,613 reid_baseline.train INFO: normal accuracy 0.6213058419243986 1.9279778003692627 
2022-04-22 06:15:46,714 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 06:15:46,715 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.8%
2022-04-22 06:16:16,497 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.026, Acc: 0.910, Base Lr: 3.38e-03
2022-04-22 06:16:30,831 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 06:16:57,311 reid_baseline.train INFO: normal accuracy 0.627262313860252 1.86708402633667 
2022-04-22 06:17:27,393 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 06:17:27,394 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 186.7%
2022-04-22 06:17:57,454 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.996, Acc: 0.919, Base Lr: 2.77e-03
2022-04-22 06:18:11,690 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-22 06:18:37,823 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8717314004898071 
2022-04-22 06:18:37,824 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 06:18:37,824 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.2%
2022-04-22 06:19:07,935 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.001, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 06:19:23,200 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 06:19:50,036 reid_baseline.train INFO: normal accuracy 0.624971363115693 1.886157512664795 
2022-04-22 06:19:50,036 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 06:19:50,036 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.6%
2022-04-22 06:20:19,340 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.978, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 06:20:33,906 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 06:21:00,458 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.8606927394866943 
2022-04-22 06:21:30,556 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 06:21:30,557 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.1%
2022-04-22 06:22:00,557 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.959, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 06:22:15,308 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-22 06:22:40,859 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.8516820669174194 
2022-04-22 06:23:10,976 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 06:23:10,977 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 185.2%
2022-04-22 06:23:40,765 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.965, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 06:23:54,937 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-22 06:24:22,387 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.760257601737976 
2022-04-22 06:24:53,097 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 06:24:53,098 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.0%
2022-04-22 06:25:22,719 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.937, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 06:25:37,002 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 06:26:09,999 reid_baseline.train INFO: normal accuracy 0.6357388316151202 1.877972960472107 
2022-04-22 06:26:10,000 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 06:26:10,000 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 187.8%
2022-04-22 06:26:46,790 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.948, Acc: 0.932, Base Lr: 2.11e-04
2022-04-22 06:27:00,657 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.333[s] Speed: 48.0[samples/s]
2022-04-22 06:27:48,337 reid_baseline.train INFO: normal accuracy 0.634135166093929 1.8322657346725464 
2022-04-22 06:27:48,338 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 06:27:48,338 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.2%
2022-04-22 06:28:18,454 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.962, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 06:28:32,977 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 06:28:59,319 reid_baseline.train INFO: normal accuracy 0.6316151202749141 1.8690675497055054 
2022-04-22 06:28:59,319 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 06:28:59,319 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 186.9%
2022-04-22 06:29:28,926 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.987, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 06:29:42,751 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-22 06:30:38,256 reid_baseline.train INFO: normal accuracy 0.6345933562428407 1.8694114685058594 
2022-04-22 06:30:38,258 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 06:30:38,258 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 186.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_8/transformer_best_model.pth
2022-04-22 06:31:33,948 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.760257601737976 
2022-04-22 06:31:33,949 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 06:31:33,949 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-22 06:32:15,286 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.760257601737976 
2022-04-22 06:32:15,293 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 06:32:15,293 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-22 06:32:40,919 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7760396599769592 
2022-04-22 06:32:40,920 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 06:32:40,920 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 06:32:45,571 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_8
2022-04-22 06:32:45,571 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=8)
2022-04-22 06:32:45,572 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 06:32:45,573 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 06:32:45,573 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 06:32:52,819 reid_baseline.train INFO: start training
2022-04-22 06:33:24,823 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.029, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 06:33:40,209 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.7[samples/s]
2022-04-22 06:34:07,083 reid_baseline.train INFO: normal accuracy 0.5212885785086732 4.171815395355225 
2022-04-22 06:34:37,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 06:34:37,343 reid_baseline.train INFO: Accuracy: 52.1% Mean Entropy: 417.2%
2022-04-22 06:35:11,240 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.722, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 06:35:25,740 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-22 06:35:52,165 reid_baseline.train INFO: normal accuracy 0.5417886911466546 4.149555206298828 
2022-04-22 06:36:22,265 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 06:36:22,266 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-22 06:36:54,526 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.139, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 06:37:10,967 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.320[s] Speed: 49.9[samples/s]
2022-04-22 06:37:37,783 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.9584879875183105 
2022-04-22 06:38:07,870 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 06:38:07,870 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 395.8%
2022-04-22 06:38:38,602 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.345, Acc: 0.670, Base Lr: 3.25e-03
2022-04-22 06:38:53,333 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-22 06:39:42,128 reid_baseline.train INFO: normal accuracy 0.5913494030186979 3.3782694339752197 
2022-04-22 06:40:12,245 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 06:40:12,245 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 337.8%
2022-04-22 06:40:41,937 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.822, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 06:40:56,621 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 06:41:40,539 reid_baseline.train INFO: normal accuracy 0.668168506420365 2.7768852710723877 
2022-04-22 06:42:10,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 06:42:10,783 reid_baseline.train INFO: Accuracy: 66.8% Mean Entropy: 277.7%
2022-04-22 06:42:41,168 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.562, Acc: 0.772, Base Lr: 4.83e-03
2022-04-22 06:42:55,775 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-22 06:43:22,346 reid_baseline.train INFO: normal accuracy 0.7339490876323497 2.40828800201416 
2022-04-22 06:43:52,771 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 06:43:52,771 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 240.8%
2022-04-22 06:44:28,395 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.402, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 06:44:42,603 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-22 06:45:09,229 reid_baseline.train INFO: normal accuracy 0.7562514079747691 2.0752651691436768 
2022-04-22 06:45:39,307 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 06:45:39,307 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.5%
2022-04-22 06:46:09,357 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.205, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 06:46:26,871 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-22 06:46:57,655 reid_baseline.train INFO: normal accuracy 0.7668393782383419 1.8710435628890991 
2022-04-22 06:47:27,781 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 06:47:27,781 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 187.1%
2022-04-22 06:47:58,020 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.125, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 06:48:12,323 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 06:49:00,833 reid_baseline.train INFO: normal accuracy 0.7796801081324622 1.7671620845794678 
2022-04-22 06:49:30,929 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 06:49:30,930 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 176.7%
2022-04-22 06:50:01,536 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.092, Acc: 0.891, Base Lr: 4.01e-03
2022-04-22 06:50:15,942 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 06:51:35,099 reid_baseline.train INFO: normal accuracy 0.780806487947736 1.7263216972351074 
2022-04-22 06:52:05,181 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 06:52:05,181 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.6%
2022-04-22 06:52:35,031 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.027, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 06:52:50,959 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-22 06:53:29,264 reid_baseline.train INFO: normal accuracy 0.7821581437260644 1.6763964891433716 
2022-04-22 06:53:59,379 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 06:53:59,379 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.6%
2022-04-22 06:54:29,351 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.996, Acc: 0.918, Base Lr: 2.77e-03
2022-04-22 06:54:43,664 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-22 06:55:09,749 reid_baseline.train INFO: normal accuracy 0.782608695652174 1.6742216348648071 
2022-04-22 06:55:40,118 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 06:55:40,118 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 167.4%
2022-04-22 06:56:17,506 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.001, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 06:56:32,775 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.346[s] Speed: 46.2[samples/s]
2022-04-22 06:56:59,411 reid_baseline.train INFO: normal accuracy 0.7821581437260644 1.696757435798645 
2022-04-22 06:56:59,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 06:56:59,412 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 169.7%
2022-04-22 06:57:28,853 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.978, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 06:57:43,520 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-22 06:58:31,954 reid_baseline.train INFO: normal accuracy 0.7866636629871593 1.6682281494140625 
2022-04-22 06:59:02,040 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 06:59:02,041 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 166.8%
2022-04-22 06:59:31,970 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.959, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 06:59:46,765 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-22 07:00:13,216 reid_baseline.train INFO: normal accuracy 0.7855372831718855 1.6728589534759521 
2022-04-22 07:00:13,217 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 07:00:13,217 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.3%
2022-04-22 07:00:43,245 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.965, Acc: 0.927, Base Lr: 7.78e-04
2022-04-22 07:00:57,525 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-22 07:01:24,193 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5716893672943115 
2022-04-22 07:01:54,252 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 07:01:54,252 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.2%
2022-04-22 07:02:24,089 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.937, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 07:02:38,491 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-22 07:03:04,811 reid_baseline.train INFO: normal accuracy 0.7853120072088308 1.684253454208374 
2022-04-22 07:03:04,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 07:03:04,812 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.4%
2022-04-22 07:03:34,849 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.948, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 07:03:48,809 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-22 07:04:14,964 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.643729567527771 
2022-04-22 07:04:14,964 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 07:04:14,965 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.4%
2022-04-22 07:04:44,995 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.962, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 07:04:59,570 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-22 07:05:27,809 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.686539649963379 
2022-04-22 07:05:27,810 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 07:05:27,810 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
2022-04-22 07:05:57,728 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.987, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 07:06:11,641 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 07:07:07,727 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.686765193939209 
2022-04-22 07:07:07,728 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 07:07:07,728 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 168.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_8/transformer_best_model.pth
2022-04-22 07:08:03,970 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5716893672943115 
2022-04-22 07:08:03,970 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 07:08:03,970 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-22 07:08:30,648 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.5716893672943115 
2022-04-22 07:08:30,648 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 07:08:30,649 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-22 07:08:50,483 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7767234444618225 
2022-04-22 07:08:50,483 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 07:08:50,483 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 07:08:55,133 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_8
2022-04-22 07:08:55,133 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=8)
2022-04-22 07:08:55,134 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 07:08:55,135 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 07:08:55,136 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 07:09:02,502 reid_baseline.train INFO: start training
2022-04-22 07:09:34,660 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.029, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 07:09:50,078 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-22 07:10:52,359 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.171506404876709 
2022-04-22 07:11:22,350 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 07:11:22,351 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-22 07:11:52,565 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.722, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 07:12:09,499 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-22 07:13:13,630 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.138624668121338 
2022-04-22 07:13:44,080 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 07:13:44,080 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-22 07:14:20,523 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.139, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 07:14:35,131 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.336[s] Speed: 47.6[samples/s]
2022-04-22 07:15:53,832 reid_baseline.train INFO: normal accuracy 0.6371356437915997 3.8435652256011963 
2022-04-22 07:16:23,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 07:16:23,890 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-22 07:16:54,646 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.345, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 07:17:09,282 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 07:18:08,607 reid_baseline.train INFO: normal accuracy 0.6825797567133348 3.1002912521362305 
2022-04-22 07:18:38,702 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 07:18:38,703 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 310.0%
2022-04-22 07:19:08,301 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.822, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 07:19:23,044 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-22 07:20:24,243 reid_baseline.train INFO: normal accuracy 0.7440899701629562 2.4532201290130615 
2022-04-22 07:20:54,601 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 07:20:54,602 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-22 07:21:31,057 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.562, Acc: 0.770, Base Lr: 4.83e-03
2022-04-22 07:21:45,324 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.334[s] Speed: 48.0[samples/s]
2022-04-22 07:22:46,703 reid_baseline.train INFO: normal accuracy 0.7902226302501721 2.081217050552368 
2022-04-22 07:23:17,077 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 07:23:17,078 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 208.1%
2022-04-22 07:23:47,810 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.402, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 07:24:02,040 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-22 07:25:17,883 reid_baseline.train INFO: normal accuracy 0.8106495294927702 1.8062665462493896 
2022-04-22 07:25:47,992 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 07:25:47,993 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.6%
2022-04-22 07:26:17,774 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.206, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 07:26:31,842 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 07:27:32,884 reid_baseline.train INFO: normal accuracy 0.8209777369749828 1.6227530241012573 
2022-04-22 07:28:02,968 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 07:28:02,968 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.3%
2022-04-22 07:28:36,973 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.126, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 07:28:52,344 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.325[s] Speed: 49.3[samples/s]
2022-04-22 07:29:53,998 reid_baseline.train INFO: normal accuracy 0.8230433784714253 1.51405930519104 
2022-04-22 07:30:24,082 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 07:30:24,083 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 151.4%
2022-04-22 07:30:54,714 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.092, Acc: 0.891, Base Lr: 4.01e-03
2022-04-22 07:31:08,983 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 07:32:52,131 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.482674241065979 
2022-04-22 07:33:22,197 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 07:33:22,198 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-22 07:33:51,842 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.027, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 07:34:06,099 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 07:35:23,165 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.4309791326522827 
2022-04-22 07:35:53,410 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 07:35:53,411 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.1%
2022-04-22 07:36:23,354 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.996, Acc: 0.916, Base Lr: 2.77e-03
2022-04-22 07:36:37,528 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-22 07:37:36,772 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.437015175819397 
2022-04-22 07:37:36,772 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 07:37:36,772 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.7%
2022-04-22 07:38:06,912 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.001, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 07:38:22,178 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 07:39:40,145 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.459596037864685 
2022-04-22 07:39:40,145 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 07:39:40,145 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.0%
2022-04-22 07:40:09,906 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.978, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 07:40:24,472 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-22 07:41:28,699 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4418277740478516 
2022-04-22 07:41:28,700 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 07:41:28,700 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.2%
2022-04-22 07:41:58,964 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.959, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 07:42:15,698 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-22 07:43:23,503 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4456982612609863 
2022-04-22 07:43:23,503 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 07:43:23,504 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 144.6%
2022-04-22 07:43:53,487 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.965, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 07:44:07,763 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-22 07:45:09,040 reid_baseline.train INFO: normal accuracy 0.8375028689465228 1.3542922735214233 
2022-04-22 07:45:39,499 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 07:45:39,499 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 135.4%
2022-04-22 07:46:14,605 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.937, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 07:46:28,961 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-22 07:47:30,496 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.4682804346084595 
2022-04-22 07:47:30,497 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 07:47:30,497 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.8%
2022-04-22 07:48:00,506 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.948, Acc: 0.933, Base Lr: 2.11e-04
2022-04-22 07:48:14,416 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.5[samples/s]
2022-04-22 07:49:31,706 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.428519368171692 
2022-04-22 07:49:31,707 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 07:49:31,707 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 142.9%
2022-04-22 07:50:01,864 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.961, Acc: 0.922, Base Lr: 6.51e-05
2022-04-22 07:50:16,390 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 07:51:35,458 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.465836524963379 
2022-04-22 07:51:35,458 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 07:51:35,458 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.6%
2022-04-22 07:52:05,512 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.986, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 07:52:19,271 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-22 07:53:51,546 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.4668490886688232 
2022-04-22 07:53:51,547 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 07:53:51,547 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_8/transformer_best_model.pth
2022-04-22 07:55:25,735 reid_baseline.train INFO: normal accuracy 0.8375028689465228 1.3542922735214233 
2022-04-22 07:55:25,735 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 07:55:25,735 reid_baseline.train INFO: Accuracy: 83.8%
2022-04-22 07:56:45,238 reid_baseline.train INFO: normal accuracy 0.8375028689465228 1.3542922735214233 
2022-04-22 07:56:45,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 07:56:45,239 reid_baseline.train INFO: Shuffled Accuracy: 83.8%
2022-04-22 07:57:05,467 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7767175436019897 
2022-04-22 07:57:05,467 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 07:57:05,467 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 07:57:10,280 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_9
2022-04-22 07:57:10,281 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_9', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=9)
2022-04-22 07:57:10,281 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 07:57:10,282 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 07:57:10,282 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_9
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 07:57:17,564 reid_baseline.train INFO: start training
2022-04-22 07:57:49,866 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.048, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 07:58:05,208 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-22 07:58:32,722 reid_baseline.train INFO: normal accuracy 0.404581901489118 4.171579837799072 
2022-04-22 07:59:02,705 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 07:59:02,705 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 417.2%
2022-04-22 07:59:37,722 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.719, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 07:59:52,301 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.326[s] Speed: 49.0[samples/s]
2022-04-22 08:00:18,670 reid_baseline.train INFO: normal accuracy 0.4302405498281787 4.15116548538208 
2022-04-22 08:00:48,769 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 08:00:48,769 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-22 08:01:19,142 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.151, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 08:01:33,684 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.295[s] Speed: 54.1[samples/s]
2022-04-22 08:02:01,464 reid_baseline.train INFO: normal accuracy 0.4524627720504009 3.9771084785461426 
2022-04-22 08:02:31,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 08:02:31,568 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 397.7%
2022-04-22 08:03:02,355 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.373, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 08:03:17,149 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-22 08:03:42,803 reid_baseline.train INFO: normal accuracy 0.4882016036655212 3.453007936477661 
2022-04-22 08:04:12,898 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 08:04:12,898 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 345.3%
2022-04-22 08:04:42,617 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.880, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 08:04:57,227 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-22 08:05:24,054 reid_baseline.train INFO: normal accuracy 0.5539518900343643 2.966015338897705 
2022-04-22 08:05:54,178 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 08:05:54,178 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.6%
2022-04-22 08:06:24,226 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.566, Acc: 0.770, Base Lr: 4.83e-03
2022-04-22 08:06:38,387 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-22 08:07:04,280 reid_baseline.train INFO: normal accuracy 0.604581901489118 2.625933885574341 
2022-04-22 08:07:34,371 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 08:07:34,371 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 262.6%
2022-04-22 08:08:05,092 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.446, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 08:08:19,236 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 08:08:45,543 reid_baseline.train INFO: normal accuracy 0.6142038946162658 2.317777156829834 
2022-04-22 08:09:15,654 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 08:09:15,654 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.8%
2022-04-22 08:09:45,431 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.234, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 08:09:59,495 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 08:10:26,624 reid_baseline.train INFO: normal accuracy 0.6142038946162658 2.0977938175201416 
2022-04-22 08:10:56,958 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 08:10:56,959 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 209.8%
2022-04-22 08:11:27,313 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.168, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 08:11:41,540 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 08:12:07,676 reid_baseline.train INFO: normal accuracy 0.6132875143184422 1.9762235879898071 
2022-04-22 08:12:37,811 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 08:12:37,812 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 197.6%
2022-04-22 08:13:08,633 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.116, Acc: 0.892, Base Lr: 4.01e-03
2022-04-22 08:13:22,978 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-22 08:14:19,625 reid_baseline.train INFO: normal accuracy 0.6213058419243986 1.9271478652954102 
2022-04-22 08:14:49,840 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 08:14:49,841 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.7%
2022-04-22 08:15:19,578 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.081, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 08:15:33,923 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 08:16:00,552 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.8663593530654907 
2022-04-22 08:16:30,658 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 08:16:30,658 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.6%
2022-04-22 08:17:00,596 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.014, Acc: 0.918, Base Lr: 2.77e-03
2022-04-22 08:17:14,849 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-22 08:17:40,919 reid_baseline.train INFO: normal accuracy 0.6297823596792669 1.8718618154525757 
2022-04-22 08:17:40,919 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 08:17:40,920 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.2%
2022-04-22 08:18:11,017 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.033, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 08:18:26,089 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-22 08:18:52,514 reid_baseline.train INFO: normal accuracy 0.6252004581901489 1.886292815208435 
2022-04-22 08:18:52,515 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 08:18:52,515 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.6%
2022-04-22 08:19:21,944 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.024, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 08:19:36,573 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 08:20:03,754 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8604869842529297 
2022-04-22 08:20:33,847 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 08:20:33,848 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.0%
2022-04-22 08:21:03,734 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.003, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 08:21:18,603 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-22 08:21:44,132 reid_baseline.train INFO: normal accuracy 0.63184421534937 1.8514869213104248 
2022-04-22 08:22:14,686 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 08:22:14,687 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 185.1%
2022-04-22 08:22:52,213 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.989, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 08:23:06,537 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-22 08:23:32,517 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.7602171897888184 
2022-04-22 08:24:02,570 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 08:24:02,571 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.0%
2022-04-22 08:24:32,527 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.967, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 08:24:49,007 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 08:25:21,231 reid_baseline.train INFO: normal accuracy 0.6355097365406643 1.8779321908950806 
2022-04-22 08:25:21,232 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 08:25:21,232 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 187.8%
2022-04-22 08:25:51,213 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.969, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 08:26:05,229 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-22 08:26:31,410 reid_baseline.train INFO: normal accuracy 0.6343642611683848 1.8318822383880615 
2022-04-22 08:26:31,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 08:26:31,411 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.2%
2022-04-22 08:27:01,509 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.990, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 08:27:16,034 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 08:27:42,439 reid_baseline.train INFO: normal accuracy 0.6306987399770905 1.868659257888794 
2022-04-22 08:27:42,439 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 08:27:42,440 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 186.9%
2022-04-22 08:28:12,079 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.009, Acc: 0.924, Base Lr: 1.60e-05
2022-04-22 08:28:25,941 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-22 08:29:21,191 reid_baseline.train INFO: normal accuracy 0.634135166093929 1.8692430257797241 
2022-04-22 08:29:21,192 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 08:29:21,192 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 186.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_9/transformer_best_model.pth
2022-04-22 08:30:16,398 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.7602171897888184 
2022-04-22 08:30:16,398 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 08:30:16,398 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-22 08:30:42,882 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.7602171897888184 
2022-04-22 08:30:42,883 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 08:30:42,883 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-22 08:31:03,261 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7763071656227112 
2022-04-22 08:31:03,262 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 08:31:03,262 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 08:31:07,996 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_9
2022-04-22 08:31:07,996 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_9', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=9)
2022-04-22 08:31:07,996 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 08:31:07,997 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 08:31:07,998 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_9
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 08:31:15,373 reid_baseline.train INFO: start training
2022-04-22 08:31:47,535 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.048, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 08:32:06,090 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-22 08:32:38,555 reid_baseline.train INFO: normal accuracy 0.5212885785086732 4.171815395355225 
2022-04-22 08:33:08,513 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 08:33:08,513 reid_baseline.train INFO: Accuracy: 52.1% Mean Entropy: 417.2%
2022-04-22 08:33:38,652 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.719, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 08:33:53,572 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 08:34:38,802 reid_baseline.train INFO: normal accuracy 0.5417886911466546 4.149554252624512 
2022-04-22 08:35:08,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 08:35:08,846 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-22 08:35:39,177 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.151, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 08:35:53,920 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.297[s] Speed: 54.0[samples/s]
2022-04-22 08:36:43,492 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.9584813117980957 
2022-04-22 08:37:13,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 08:37:13,578 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 395.8%
2022-04-22 08:37:44,535 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.373, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 08:37:59,293 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-22 08:38:47,155 reid_baseline.train INFO: normal accuracy 0.5908988510925884 3.37847638130188 
2022-04-22 08:39:17,224 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 08:39:17,225 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 337.8%
2022-04-22 08:39:47,037 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.880, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 08:40:01,811 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-22 08:40:39,468 reid_baseline.train INFO: normal accuracy 0.668168506420365 2.7766876220703125 
2022-04-22 08:41:09,954 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 08:41:09,955 reid_baseline.train INFO: Accuracy: 66.8% Mean Entropy: 277.7%
2022-04-22 08:41:40,038 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.566, Acc: 0.770, Base Lr: 4.83e-03
2022-04-22 08:41:54,383 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-22 08:42:20,937 reid_baseline.train INFO: normal accuracy 0.7330479837801307 2.4072203636169434 
2022-04-22 08:42:51,218 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 08:42:51,219 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 240.7%
2022-04-22 08:43:29,857 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.446, Acc: 0.803, Base Lr: 5.62e-03
2022-04-22 08:43:44,318 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.349[s] Speed: 45.8[samples/s]
2022-04-22 08:44:10,588 reid_baseline.train INFO: normal accuracy 0.7560261320117143 2.075711965560913 
2022-04-22 08:44:40,672 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 08:44:40,673 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.6%
2022-04-22 08:45:11,380 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.234, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 08:45:29,526 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-22 08:45:56,776 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.8725826740264893 
2022-04-22 08:46:26,867 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 08:46:26,867 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 187.3%
2022-04-22 08:46:57,149 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.167, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 08:47:11,415 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 08:47:58,115 reid_baseline.train INFO: normal accuracy 0.7796801081324622 1.768835425376892 
2022-04-22 08:48:28,168 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 08:48:28,169 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 176.9%
2022-04-22 08:48:58,984 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.116, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 08:49:13,370 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-22 08:50:19,997 reid_baseline.train INFO: normal accuracy 0.7805812119846812 1.727286696434021 
2022-04-22 08:50:50,062 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 08:50:50,063 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.7%
2022-04-22 08:51:22,124 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.082, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 08:51:38,717 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-22 08:52:10,480 reid_baseline.train INFO: normal accuracy 0.7823834196891192 1.6757516860961914 
2022-04-22 08:52:41,576 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 08:52:41,576 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.6%
2022-04-22 08:53:11,679 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.014, Acc: 0.918, Base Lr: 2.77e-03
2022-04-22 08:53:25,960 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 08:53:52,233 reid_baseline.train INFO: normal accuracy 0.782608695652174 1.6741029024124146 
2022-04-22 08:54:22,835 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 08:54:22,835 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 167.4%
2022-04-22 08:54:58,127 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.032, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 08:55:13,490 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.333[s] Speed: 48.0[samples/s]
2022-04-22 08:55:40,856 reid_baseline.train INFO: normal accuracy 0.782608695652174 1.6978965997695923 
2022-04-22 08:55:40,856 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 08:55:40,857 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 169.8%
2022-04-22 08:56:10,447 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.024, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 08:56:25,386 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 08:57:12,581 reid_baseline.train INFO: normal accuracy 0.7857625591349403 1.6688668727874756 
2022-04-22 08:57:42,648 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 08:57:42,649 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 166.9%
2022-04-22 08:58:12,447 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.003, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 08:58:27,204 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 08:58:53,740 reid_baseline.train INFO: normal accuracy 0.7857625591349403 1.6728726625442505 
2022-04-22 08:58:53,741 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 08:58:53,741 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.3%
2022-04-22 08:59:23,923 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.989, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 08:59:38,117 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 09:00:04,467 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.571702241897583 
2022-04-22 09:00:34,532 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 09:00:34,532 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.2%
2022-04-22 09:01:04,410 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.967, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 09:01:18,707 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-22 09:01:45,157 reid_baseline.train INFO: normal accuracy 0.7855372831718855 1.6844428777694702 
2022-04-22 09:01:45,158 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 09:01:45,158 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 168.4%
2022-04-22 09:02:15,129 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.969, Acc: 0.934, Base Lr: 2.11e-04
2022-04-22 09:02:28,986 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 09:02:55,759 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.6436949968338013 
2022-04-22 09:02:55,760 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 09:02:55,760 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.4%
2022-04-22 09:03:25,823 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.990, Acc: 0.923, Base Lr: 6.51e-05
2022-04-22 09:03:40,430 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-22 09:04:08,653 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.6863194704055786 
2022-04-22 09:04:08,654 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 09:04:08,654 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 168.6%
2022-04-22 09:04:38,406 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.009, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 09:04:52,192 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 55.9[samples/s]
2022-04-22 09:05:47,995 reid_baseline.train INFO: normal accuracy 0.7853120072088308 1.6870540380477905 
2022-04-22 09:05:47,996 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 09:05:47,996 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_9/transformer_best_model.pth
2022-04-22 09:06:43,535 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.571702241897583 
2022-04-22 09:06:43,536 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 09:06:43,536 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-22 09:07:09,338 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.571702241897583 
2022-04-22 09:07:09,339 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 09:07:09,339 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-22 09:07:30,022 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7768486142158508 
2022-04-22 09:07:30,023 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 09:07:30,023 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 09:07:34,724 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_9
2022-04-22 09:07:34,725 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_9', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=9)
2022-04-22 09:07:34,725 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 09:07:34,725 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 09:07:34,726 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_9
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 09:07:41,930 reid_baseline.train INFO: start training
2022-04-22 09:08:14,024 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.048, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 09:08:29,418 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.5[samples/s]
2022-04-22 09:09:48,067 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.171506404876709 
2022-04-22 09:10:18,024 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 09:10:18,024 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-22 09:10:50,731 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.719, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 09:11:08,137 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-22 09:12:25,194 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.138621807098389 
2022-04-22 09:12:55,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 09:12:55,256 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-22 09:13:25,791 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.151, Acc: 0.632, Base Lr: 2.46e-03
2022-04-22 09:13:40,465 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-22 09:14:43,532 reid_baseline.train INFO: normal accuracy 0.6369061280697728 3.843585968017578 
2022-04-22 09:15:13,611 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 09:15:13,611 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-22 09:15:44,804 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.373, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 09:15:59,622 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-22 09:17:16,688 reid_baseline.train INFO: normal accuracy 0.6828092724351618 3.1001906394958496 
2022-04-22 09:17:46,771 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 09:17:46,772 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 310.0%
2022-04-22 09:18:16,594 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.880, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 09:18:31,219 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-22 09:19:49,599 reid_baseline.train INFO: normal accuracy 0.7443194858847831 2.4528896808624268 
2022-04-22 09:20:19,680 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 09:20:19,680 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-22 09:20:49,780 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.566, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 09:21:04,007 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-22 09:22:21,550 reid_baseline.train INFO: normal accuracy 0.7899931145283452 2.0813400745391846 
2022-04-22 09:22:51,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 09:22:51,599 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 208.1%
2022-04-22 09:23:22,348 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.446, Acc: 0.800, Base Lr: 5.62e-03
2022-04-22 09:23:37,081 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-22 09:24:47,606 reid_baseline.train INFO: normal accuracy 0.8106495294927702 1.8065305948257446 
2022-04-22 09:25:17,649 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 09:25:17,649 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.7%
2022-04-22 09:25:47,421 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.234, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 09:26:02,972 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 09:27:10,599 reid_baseline.train INFO: normal accuracy 0.8209777369749828 1.6225848197937012 
2022-04-22 09:27:40,678 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 09:27:40,679 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.3%
2022-04-22 09:28:10,776 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.167, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 09:28:27,802 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-22 09:29:34,693 reid_baseline.train INFO: normal accuracy 0.8237319256369061 1.5135568380355835 
2022-04-22 09:30:04,746 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 09:30:04,746 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 151.4%
2022-04-22 09:30:35,733 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.116, Acc: 0.891, Base Lr: 4.01e-03
2022-04-22 09:30:52,623 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.315[s] Speed: 50.8[samples/s]
2022-04-22 09:32:24,395 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.48319673538208 
2022-04-22 09:32:54,896 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 09:32:54,897 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-22 09:33:31,151 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.082, Acc: 0.911, Base Lr: 3.38e-03
2022-04-22 09:33:45,520 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.333[s] Speed: 48.0[samples/s]
2022-04-22 09:34:47,151 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.431415319442749 
2022-04-22 09:35:17,541 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 09:35:17,541 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.1%
2022-04-22 09:35:53,502 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.014, Acc: 0.919, Base Lr: 2.77e-03
2022-04-22 09:36:07,608 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-22 09:37:23,116 reid_baseline.train INFO: normal accuracy 0.83245352306633 1.4365867376327515 
2022-04-22 09:37:23,117 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 09:37:23,117 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.7%
2022-04-22 09:37:53,278 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.033, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 09:38:08,447 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 09:39:08,841 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.4588936567306519 
2022-04-22 09:39:08,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 09:39:08,842 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.9%
2022-04-22 09:39:38,465 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.025, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 09:39:53,310 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-22 09:41:11,353 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4414613246917725 
2022-04-22 09:41:11,353 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 09:41:11,353 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.1%
2022-04-22 09:41:41,419 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.003, Acc: 0.936, Base Lr: 1.19e-03
2022-04-22 09:41:56,102 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-22 09:43:16,340 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.4462019205093384 
2022-04-22 09:43:16,341 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 09:43:16,341 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 144.6%
2022-04-22 09:43:46,216 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.989, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 09:44:00,508 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-22 09:45:01,738 reid_baseline.train INFO: normal accuracy 0.8379619003901767 1.353865146636963 
2022-04-22 09:45:31,807 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 09:45:31,807 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 135.4%
2022-04-22 09:46:01,355 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.967, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 09:46:15,664 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 09:47:17,020 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.467699408531189 
2022-04-22 09:47:17,020 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 09:47:17,020 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.8%
2022-04-22 09:47:46,955 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.969, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 09:48:00,898 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 09:49:01,987 reid_baseline.train INFO: normal accuracy 0.8356667431719073 1.4280695915222168 
2022-04-22 09:49:01,987 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 09:49:01,988 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 142.8%
2022-04-22 09:49:32,101 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.990, Acc: 0.923, Base Lr: 6.51e-05
2022-04-22 09:49:46,614 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 09:50:49,735 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4656809568405151 
2022-04-22 09:50:49,735 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 09:50:49,736 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-22 09:51:19,443 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.009, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 09:51:33,389 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.287[s] Speed: 55.7[samples/s]
2022-04-22 09:53:05,334 reid_baseline.train INFO: normal accuracy 0.836584806059215 1.4661599397659302 
2022-04-22 09:53:05,334 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 09:53:05,335 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 146.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_9/transformer_best_model.pth
2022-04-22 09:54:39,323 reid_baseline.train INFO: normal accuracy 0.8379619003901767 1.353865146636963 
2022-04-22 09:54:39,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 09:54:39,336 reid_baseline.train INFO: Accuracy: 83.8%
2022-04-22 09:55:42,449 reid_baseline.train INFO: normal accuracy 0.8379619003901767 1.353865146636963 
2022-04-22 09:55:42,449 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 09:55:42,450 reid_baseline.train INFO: Shuffled Accuracy: 83.8%
2022-04-22 09:56:02,912 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7765609622001648 
2022-04-22 09:56:02,912 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 09:56:02,912 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 09:56:07,605 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_10
2022-04-22 09:56:07,605 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=10)
2022-04-22 09:56:07,605 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 09:56:07,606 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 09:56:07,607 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 09:56:20,988 reid_baseline.train INFO: start training
2022-04-22 09:56:57,225 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.090, Acc: 0.302, Base Lr: 8.72e-04
2022-04-22 09:57:12,446 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.336[s] Speed: 47.7[samples/s]
2022-04-22 09:57:39,932 reid_baseline.train INFO: normal accuracy 0.4043528064146621 4.171579837799072 
2022-04-22 09:58:10,138 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 09:58:10,139 reid_baseline.train INFO: Accuracy: 40.4% Mean Entropy: 417.2%
2022-04-22 09:58:45,838 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.786, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 09:59:00,356 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.330[s] Speed: 48.4[samples/s]
2022-04-22 09:59:48,542 reid_baseline.train INFO: normal accuracy 0.4300114547537228 4.151164531707764 
2022-04-22 10:00:18,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 10:00:18,579 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-22 10:00:48,858 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.169, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 10:01:03,517 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-22 10:01:30,808 reid_baseline.train INFO: normal accuracy 0.4524627720504009 3.977106809616089 
2022-04-22 10:02:00,871 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 10:02:00,871 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 397.7%
2022-04-22 10:02:31,583 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.431, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 10:02:46,333 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-22 10:03:11,918 reid_baseline.train INFO: normal accuracy 0.4882016036655212 3.4527788162231445 
2022-04-22 10:03:42,025 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 10:03:42,026 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 345.3%
2022-04-22 10:04:11,655 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.957, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 10:04:26,230 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-22 10:04:52,660 reid_baseline.train INFO: normal accuracy 0.5539518900343643 2.965878963470459 
2022-04-22 10:05:23,006 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 10:05:23,007 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.6%
2022-04-22 10:06:01,213 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.618, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 10:06:15,396 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-22 10:06:41,444 reid_baseline.train INFO: normal accuracy 0.6048109965635738 2.6264615058898926 
2022-04-22 10:07:11,516 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 10:07:11,517 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 262.6%
2022-04-22 10:07:42,278 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.473, Acc: 0.802, Base Lr: 5.62e-03
2022-04-22 10:07:56,453 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 10:08:22,340 reid_baseline.train INFO: normal accuracy 0.6139747995418099 2.317955493927002 
2022-04-22 10:08:52,852 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 10:08:52,852 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.8%
2022-04-22 10:09:29,476 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.297, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 10:09:43,617 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.334[s] Speed: 48.0[samples/s]
2022-04-22 10:10:10,287 reid_baseline.train INFO: normal accuracy 0.616036655211913 2.096816301345825 
2022-04-22 10:10:40,336 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 10:10:40,337 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 209.7%
2022-04-22 10:11:10,673 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.278, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 10:11:24,935 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 10:11:50,386 reid_baseline.train INFO: normal accuracy 0.6132875143184422 1.976729393005371 
2022-04-22 10:12:20,971 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 10:12:20,971 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 197.7%
2022-04-22 10:12:55,614 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.173, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 10:13:09,865 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-22 10:14:06,184 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.9271169900894165 
2022-04-22 10:14:36,239 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 10:14:36,239 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.7%
2022-04-22 10:15:06,057 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.162, Acc: 0.911, Base Lr: 3.38e-03
2022-04-22 10:15:20,378 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 10:15:46,635 reid_baseline.train INFO: normal accuracy 0.6277205040091638 1.8670673370361328 
2022-04-22 10:16:16,714 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 10:16:16,714 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.7%
2022-04-22 10:16:52,216 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.107, Acc: 0.918, Base Lr: 2.77e-03
2022-04-22 10:17:06,548 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.327[s] Speed: 48.9[samples/s]
2022-04-22 10:17:32,496 reid_baseline.train INFO: normal accuracy 0.6306987399770905 1.8716323375701904 
2022-04-22 10:17:32,496 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 10:17:32,497 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 187.2%
2022-04-22 10:18:02,491 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.092, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 10:18:17,839 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 10:18:44,176 reid_baseline.train INFO: normal accuracy 0.624971363115693 1.8865787982940674 
2022-04-22 10:18:44,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 10:18:44,177 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.7%
2022-04-22 10:19:13,659 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.104, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 10:19:28,263 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.290[s] Speed: 55.3[samples/s]
2022-04-22 10:19:55,129 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8606948852539062 
2022-04-22 10:20:25,239 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 10:20:25,239 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.1%
2022-04-22 10:20:55,354 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.049, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 10:21:13,134 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.315[s] Speed: 50.9[samples/s]
2022-04-22 10:21:41,954 reid_baseline.train INFO: normal accuracy 0.6323024054982818 1.8517909049987793 
2022-04-22 10:22:12,015 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 10:22:12,015 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 185.2%
2022-04-22 10:22:41,844 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.074, Acc: 0.927, Base Lr: 7.78e-04
2022-04-22 10:22:56,134 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-22 10:23:22,678 reid_baseline.train INFO: normal accuracy 0.6334478808705613 1.760609745979309 
2022-04-22 10:23:52,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 10:23:52,793 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.1%
2022-04-22 10:24:22,570 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.092, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 10:24:36,889 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 10:25:03,515 reid_baseline.train INFO: normal accuracy 0.6357388316151202 1.8781118392944336 
2022-04-22 10:25:03,515 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 10:25:03,516 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 187.8%
2022-04-22 10:25:33,540 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.089, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 10:25:50,558 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-22 10:26:21,726 reid_baseline.train INFO: normal accuracy 0.6343642611683848 1.8324776887893677 
2022-04-22 10:26:21,727 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 10:26:21,727 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.2%
2022-04-22 10:26:51,629 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.050, Acc: 0.923, Base Lr: 6.51e-05
2022-04-22 10:27:06,193 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-22 10:27:33,046 reid_baseline.train INFO: normal accuracy 0.6316151202749141 1.8690905570983887 
2022-04-22 10:27:33,046 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 10:27:33,047 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 186.9%
2022-04-22 10:28:02,746 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.076, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 10:28:16,564 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 55.9[samples/s]
2022-04-22 10:29:12,247 reid_baseline.train INFO: normal accuracy 0.633906071019473 1.8690986633300781 
2022-04-22 10:29:12,248 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 10:29:12,248 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 186.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_10/transformer_best_model.pth
2022-04-22 10:30:30,419 reid_baseline.train INFO: normal accuracy 0.6334478808705613 1.760609745979309 
2022-04-22 10:30:30,419 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 10:30:30,419 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-22 10:30:56,299 reid_baseline.train INFO: normal accuracy 0.6334478808705613 1.760609745979309 
2022-04-22 10:30:56,300 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 10:30:56,300 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-22 10:31:15,892 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7762829065322876 
2022-04-22 10:31:15,893 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 10:31:15,893 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 10:31:20,683 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_10
2022-04-22 10:31:20,684 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=10)
2022-04-22 10:31:20,684 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 10:31:20,685 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 10:31:20,686 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 10:31:28,000 reid_baseline.train INFO: start training
2022-04-22 10:31:59,989 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.090, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 10:32:15,275 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-22 10:32:42,173 reid_baseline.train INFO: normal accuracy 0.5212885785086732 4.171815395355225 
2022-04-22 10:33:12,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 10:33:12,142 reid_baseline.train INFO: Accuracy: 52.1% Mean Entropy: 417.2%
2022-04-22 10:33:42,184 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.786, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 10:33:56,717 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 10:34:45,041 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.149554252624512 
2022-04-22 10:35:15,109 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 10:35:15,110 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-22 10:35:45,337 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.169, Acc: 0.632, Base Lr: 2.46e-03
2022-04-22 10:35:59,893 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-22 10:36:27,048 reid_baseline.train INFO: normal accuracy 0.554629421040775 3.958495855331421 
2022-04-22 10:36:57,147 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 10:36:57,147 reid_baseline.train INFO: Accuracy: 55.5% Mean Entropy: 395.8%
2022-04-22 10:37:28,138 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.431, Acc: 0.670, Base Lr: 3.25e-03
2022-04-22 10:37:44,931 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.314[s] Speed: 50.9[samples/s]
2022-04-22 10:38:18,928 reid_baseline.train INFO: normal accuracy 0.5913494030186979 3.3785018920898438 
2022-04-22 10:38:48,994 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 10:38:48,994 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 337.9%
2022-04-22 10:39:19,975 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.957, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 10:39:38,795 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-22 10:40:04,839 reid_baseline.train INFO: normal accuracy 0.668168506420365 2.7768945693969727 
2022-04-22 10:40:34,901 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 10:40:34,902 reid_baseline.train INFO: Accuracy: 66.8% Mean Entropy: 277.7%
2022-04-22 10:41:04,876 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.618, Acc: 0.770, Base Lr: 4.83e-03
2022-04-22 10:41:19,047 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-22 10:41:46,187 reid_baseline.train INFO: normal accuracy 0.7328227078170759 2.407075881958008 
2022-04-22 10:42:16,281 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 10:42:16,282 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 240.7%
2022-04-22 10:42:47,070 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.473, Acc: 0.802, Base Lr: 5.62e-03
2022-04-22 10:43:01,297 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 10:43:28,115 reid_baseline.train INFO: normal accuracy 0.7562514079747691 2.0757031440734863 
2022-04-22 10:43:58,196 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 10:43:58,197 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.6%
2022-04-22 10:44:27,962 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.297, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 10:44:43,501 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 10:45:20,839 reid_baseline.train INFO: normal accuracy 0.7670646542013967 1.8717138767242432 
2022-04-22 10:45:50,944 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 10:45:50,945 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 187.2%
2022-04-22 10:46:20,900 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.278, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 10:46:35,238 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-22 10:47:01,639 reid_baseline.train INFO: normal accuracy 0.7796801081324622 1.768485188484192 
2022-04-22 10:47:31,710 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 10:47:31,710 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 176.8%
2022-04-22 10:48:02,629 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.173, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 10:48:19,755 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-22 10:49:17,543 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.726402759552002 
2022-04-22 10:49:47,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 10:49:47,624 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.6%
2022-04-22 10:50:17,345 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.162, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 10:50:31,676 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 10:50:59,128 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.6758129596710205 
2022-04-22 10:51:29,228 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 10:51:29,228 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 167.6%
2022-04-22 10:51:59,226 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.107, Acc: 0.917, Base Lr: 2.77e-03
2022-04-22 10:52:13,392 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-22 10:52:39,462 reid_baseline.train INFO: normal accuracy 0.781707591799955 1.6737381219863892 
2022-04-22 10:53:09,497 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 10:53:09,498 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.4%
2022-04-22 10:53:39,657 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.092, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 10:53:55,129 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 10:54:21,059 reid_baseline.train INFO: normal accuracy 0.7828339716152286 1.6978199481964111 
2022-04-22 10:54:21,060 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 10:54:21,060 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 169.8%
2022-04-22 10:54:50,420 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.103, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 10:55:04,951 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 10:55:31,305 reid_baseline.train INFO: normal accuracy 0.7864383870241045 1.6689521074295044 
2022-04-22 10:56:01,434 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 10:56:01,435 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 166.9%
2022-04-22 10:56:31,408 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.049, Acc: 0.936, Base Lr: 1.19e-03
2022-04-22 10:56:46,185 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-22 10:57:12,492 reid_baseline.train INFO: normal accuracy 0.7857625591349403 1.672866940498352 
2022-04-22 10:57:12,492 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 10:57:12,493 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.3%
2022-04-22 10:57:42,361 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.075, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 10:57:56,591 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 10:58:23,515 reid_baseline.train INFO: normal accuracy 0.7839603514305024 1.571757197380066 
2022-04-22 10:58:53,589 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 10:58:53,590 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.2%
2022-04-22 10:59:23,234 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.092, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 10:59:37,528 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 11:00:04,244 reid_baseline.train INFO: normal accuracy 0.7853120072088308 1.6847234964370728 
2022-04-22 11:00:04,245 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 11:00:04,245 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.5%
2022-04-22 11:00:34,193 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.090, Acc: 0.933, Base Lr: 2.11e-04
2022-04-22 11:00:48,171 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 11:01:14,266 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.6440989971160889 
2022-04-22 11:01:14,266 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 11:01:14,266 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.4%
2022-04-22 11:01:44,295 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.050, Acc: 0.923, Base Lr: 6.51e-05
2022-04-22 11:01:58,822 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 11:02:27,012 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.6867471933364868 
2022-04-22 11:02:27,012 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 11:02:27,012 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
2022-04-22 11:02:56,812 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.076, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 11:03:10,781 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-22 11:04:06,659 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.687420129776001 
2022-04-22 11:04:06,659 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 11:04:06,660 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_10/transformer_best_model.pth
2022-04-22 11:05:02,968 reid_baseline.train INFO: normal accuracy 0.7839603514305024 1.571757197380066 
2022-04-22 11:05:02,969 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:05:02,969 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-22 11:05:28,723 reid_baseline.train INFO: normal accuracy 0.7839603514305024 1.571757197380066 
2022-04-22 11:05:28,724 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:05:28,724 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-22 11:05:48,703 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7765611410140991 
2022-04-22 11:05:48,704 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:05:48,704 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 11:05:53,462 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_10
2022-04-22 11:05:53,462 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=10)
2022-04-22 11:05:53,463 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 11:05:53,464 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 11:05:53,464 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 11:06:00,663 reid_baseline.train INFO: start training
2022-04-22 11:06:32,534 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.090, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 11:06:47,848 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.309[s] Speed: 51.9[samples/s]
2022-04-22 11:07:49,465 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.171506404876709 
2022-04-22 11:08:19,508 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 11:08:19,508 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-22 11:08:49,475 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.786, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 11:09:04,068 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 11:10:12,119 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.138621807098389 
2022-04-22 11:10:44,693 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 11:10:44,693 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-22 11:11:15,176 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.169, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 11:11:29,659 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-22 11:12:35,090 reid_baseline.train INFO: normal accuracy 0.6369061280697728 3.8435707092285156 
2022-04-22 11:13:06,559 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 11:13:06,559 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-22 11:13:41,125 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.431, Acc: 0.670, Base Lr: 3.25e-03
2022-04-22 11:13:55,803 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-22 11:14:57,002 reid_baseline.train INFO: normal accuracy 0.6828092724351618 3.100186347961426 
2022-04-22 11:15:27,067 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 11:15:27,067 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 310.0%
2022-04-22 11:15:57,269 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.957, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 11:16:11,958 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 11:17:17,420 reid_baseline.train INFO: normal accuracy 0.7445490016066101 2.4531641006469727 
2022-04-22 11:17:52,963 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 11:17:52,964 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 245.3%
2022-04-22 11:18:24,652 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.618, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 11:18:38,879 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-22 11:19:49,274 reid_baseline.train INFO: normal accuracy 0.7899931145283452 2.0819294452667236 
2022-04-22 11:20:19,996 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 11:20:19,997 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 208.2%
2022-04-22 11:20:50,807 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.473, Acc: 0.800, Base Lr: 5.62e-03
2022-04-22 11:21:04,956 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-22 11:22:20,069 reid_baseline.train INFO: normal accuracy 0.8106495294927702 1.8065290451049805 
2022-04-22 11:22:50,426 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 11:22:50,426 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.7%
2022-04-22 11:23:19,983 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.298, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 11:23:34,081 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.287[s] Speed: 55.7[samples/s]
2022-04-22 11:24:49,023 reid_baseline.train INFO: normal accuracy 0.8209777369749828 1.6225354671478271 
2022-04-22 11:25:19,516 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 11:25:19,516 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.3%
2022-04-22 11:25:51,607 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.278, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 11:26:08,999 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-22 11:27:09,375 reid_baseline.train INFO: normal accuracy 0.8235024099150792 1.5136184692382812 
2022-04-22 11:27:40,005 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 11:27:40,005 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 151.4%
2022-04-22 11:28:16,798 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.173, Acc: 0.891, Base Lr: 4.01e-03
2022-04-22 11:28:30,922 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-22 11:30:19,267 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.4828678369522095 
2022-04-22 11:30:49,531 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 11:30:49,531 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-22 11:31:19,135 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.162, Acc: 0.911, Base Lr: 3.38e-03
2022-04-22 11:31:33,346 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-22 11:32:50,942 reid_baseline.train INFO: normal accuracy 0.8315354601790222 1.4329150915145874 
2022-04-22 11:33:21,228 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 11:33:21,228 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.3%
2022-04-22 11:33:52,552 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.107, Acc: 0.918, Base Lr: 2.77e-03
2022-04-22 11:34:10,509 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-22 11:35:08,231 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4379619359970093 
2022-04-22 11:35:08,231 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 11:35:08,231 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 143.8%
2022-04-22 11:35:38,344 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.093, Acc: 0.912, Base Lr: 2.20e-03
2022-04-22 11:35:56,364 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-22 11:37:03,799 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.458936333656311 
2022-04-22 11:37:03,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 11:37:03,800 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.9%
2022-04-22 11:37:38,297 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.104, Acc: 0.921, Base Lr: 1.66e-03
2022-04-22 11:37:52,797 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-22 11:39:12,347 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4419761896133423 
2022-04-22 11:39:12,347 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 11:39:12,347 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.2%
2022-04-22 11:39:42,444 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.050, Acc: 0.936, Base Lr: 1.19e-03
2022-04-22 11:39:57,234 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-22 11:41:15,589 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.446104884147644 
2022-04-22 11:41:15,589 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 11:41:15,590 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 144.6%
2022-04-22 11:41:45,294 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.074, Acc: 0.927, Base Lr: 7.78e-04
2022-04-22 11:41:59,516 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 11:43:16,763 reid_baseline.train INFO: normal accuracy 0.8379619003901767 1.354070782661438 
2022-04-22 11:43:47,213 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 11:43:47,214 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 135.4%
2022-04-22 11:44:16,902 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.092, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 11:44:31,173 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-22 11:45:31,651 reid_baseline.train INFO: normal accuracy 0.8336011016754648 1.468077540397644 
2022-04-22 11:45:31,652 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 11:45:31,652 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.8%
2022-04-22 11:46:01,603 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.090, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 11:46:15,878 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-22 11:47:17,295 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4283586740493774 
2022-04-22 11:47:17,296 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 11:47:17,296 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 142.8%
2022-04-22 11:47:47,173 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.049, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 11:48:01,640 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-22 11:49:03,296 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4658823013305664 
2022-04-22 11:49:03,296 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 11:49:03,297 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-22 11:49:33,070 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.076, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 11:49:46,741 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-22 11:51:17,915 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4665416479110718 
2022-04-22 11:51:17,915 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 11:51:17,916 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_10/transformer_best_model.pth
2022-04-22 11:52:49,329 reid_baseline.train INFO: normal accuracy 0.8379619003901767 1.354070782661438 
2022-04-22 11:52:49,330 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:52:49,330 reid_baseline.train INFO: Accuracy: 83.8%
2022-04-22 11:54:12,229 reid_baseline.train INFO: normal accuracy 0.8379619003901767 1.354070782661438 
2022-04-22 11:54:12,229 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:54:12,230 reid_baseline.train INFO: Shuffled Accuracy: 83.8%
2022-04-22 11:54:32,115 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7765262126922607 
2022-04-22 11:54:32,116 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:54:32,116 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 11:54:36,777 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_12
2022-04-22 11:54:36,777 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-22 11:54:36,778 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 11:54:36,778 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 11:54:36,779 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 11:54:44,037 reid_baseline.train INFO: start training
2022-04-22 11:55:21,092 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.031, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 11:55:36,480 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-22 11:56:25,514 reid_baseline.train INFO: normal accuracy 0.404581901489118 4.171579837799072 
2022-04-22 11:56:55,751 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 11:56:55,751 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 417.2%
2022-04-22 11:57:25,766 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.720, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 11:57:40,296 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-22 11:58:05,779 reid_baseline.train INFO: normal accuracy 0.4300114547537228 4.15116548538208 
2022-04-22 11:58:36,126 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 11:58:36,127 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-22 11:59:06,467 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.126, Acc: 0.632, Base Lr: 2.46e-03
2022-04-22 11:59:21,322 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-22 11:59:48,136 reid_baseline.train INFO: normal accuracy 0.4524627720504009 3.9770596027374268 
2022-04-22 12:00:19,429 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 12:00:19,429 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 397.7%
2022-04-22 12:00:56,064 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.338, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 12:01:10,727 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.337[s] Speed: 47.4[samples/s]
2022-04-22 12:01:35,581 reid_baseline.train INFO: normal accuracy 0.4879725085910653 3.4531030654907227 
2022-04-22 12:02:06,249 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 12:02:06,250 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 345.3%
2022-04-22 12:02:37,804 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.862, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 12:02:55,112 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-22 12:03:21,139 reid_baseline.train INFO: normal accuracy 0.5541809851088202 2.966135263442993 
2022-04-22 12:03:51,542 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 12:03:51,543 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 296.6%
2022-04-22 12:04:21,768 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.571, Acc: 0.770, Base Lr: 4.83e-03
2022-04-22 12:04:36,433 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 12:05:16,751 reid_baseline.train INFO: normal accuracy 0.6054982817869415 2.6259615421295166 
2022-04-22 12:05:47,056 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 12:05:47,056 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 262.6%
2022-04-22 12:06:17,798 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.461, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 12:06:31,930 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 12:07:19,664 reid_baseline.train INFO: normal accuracy 0.6142038946162658 2.317434072494507 
2022-04-22 12:07:50,044 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 12:07:50,045 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 231.7%
2022-04-22 12:08:19,888 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.230, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 12:08:34,086 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-22 12:09:22,960 reid_baseline.train INFO: normal accuracy 0.6158075601374571 2.0973145961761475 
2022-04-22 12:09:53,438 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 12:09:53,439 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 209.7%
2022-04-22 12:10:23,799 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.177, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 12:10:37,960 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-22 12:11:25,914 reid_baseline.train INFO: normal accuracy 0.6135166093928981 1.9763249158859253 
2022-04-22 12:11:56,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 12:11:56,289 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 197.6%
2022-04-22 12:12:26,924 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.117, Acc: 0.891, Base Lr: 4.01e-03
2022-04-22 12:12:41,188 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-22 12:13:52,197 reid_baseline.train INFO: normal accuracy 0.6208476517754868 1.927088975906372 
2022-04-22 12:14:22,622 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 12:14:22,622 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 192.7%
2022-04-22 12:14:52,256 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.083, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 12:15:06,523 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 12:15:54,907 reid_baseline.train INFO: normal accuracy 0.6270332187857961 1.8644517660140991 
2022-04-22 12:16:25,315 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 12:16:25,315 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 186.4%
2022-04-22 12:16:55,570 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.009, Acc: 0.916, Base Lr: 2.77e-03
2022-04-22 12:17:09,841 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-22 12:17:58,220 reid_baseline.train INFO: normal accuracy 0.6306987399770905 1.8711143732070923 
2022-04-22 12:17:58,221 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 12:17:58,221 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 187.1%
2022-04-22 12:18:28,302 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.016, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 12:18:43,496 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-22 12:19:32,082 reid_baseline.train INFO: normal accuracy 0.6238258877434135 1.8876662254333496 
2022-04-22 12:19:32,083 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 12:19:32,083 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 188.8%
2022-04-22 12:20:01,575 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.999, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 12:20:16,169 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.290[s] Speed: 55.3[samples/s]
2022-04-22 12:20:42,171 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8607970476150513 
2022-04-22 12:21:12,535 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 12:21:12,535 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.1%
2022-04-22 12:21:43,416 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.993, Acc: 0.935, Base Lr: 1.19e-03
2022-04-22 12:22:01,737 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.323[s] Speed: 49.5[samples/s]
2022-04-22 12:22:26,723 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.8515114784240723 
2022-04-22 12:22:57,040 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 12:22:57,040 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 185.2%
2022-04-22 12:23:26,935 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.006, Acc: 0.926, Base Lr: 7.78e-04
2022-04-22 12:23:41,412 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 12:24:26,494 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.7602992057800293 
2022-04-22 12:24:56,875 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 12:24:56,875 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.0%
2022-04-22 12:25:26,491 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.980, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 12:25:40,771 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 12:26:06,145 reid_baseline.train INFO: normal accuracy 0.6350515463917525 1.8780932426452637 
2022-04-22 12:26:06,145 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 12:26:06,146 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 187.8%
2022-04-22 12:26:35,796 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.987, Acc: 0.934, Base Lr: 2.11e-04
2022-04-22 12:26:49,748 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.287[s] Speed: 55.8[samples/s]
2022-04-22 12:27:14,984 reid_baseline.train INFO: normal accuracy 0.6336769759450172 1.832125186920166 
2022-04-22 12:27:14,985 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 12:27:14,985 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.2%
2022-04-22 12:27:44,911 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.958, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 12:27:59,477 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-22 12:28:25,487 reid_baseline.train INFO: normal accuracy 0.6316151202749141 1.868350863456726 
2022-04-22 12:28:25,487 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 12:28:25,487 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 186.8%
2022-04-22 12:28:55,142 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.963, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 12:29:08,965 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 55.9[samples/s]
2022-04-22 12:30:04,392 reid_baseline.train INFO: normal accuracy 0.6350515463917525 1.868906021118164 
2022-04-22 12:30:04,392 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 12:30:04,393 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 186.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_12/transformer_best_model.pth
2022-04-22 12:30:59,807 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.7602992057800293 
2022-04-22 12:30:59,808 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 12:30:59,808 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-22 12:31:25,844 reid_baseline.train INFO: normal accuracy 0.6325315005727377 1.7602992057800293 
2022-04-22 12:31:25,850 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 12:31:25,850 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-22 12:31:45,543 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7766926288604736 
2022-04-22 12:31:45,543 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 12:31:45,543 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 12:31:50,203 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_12
2022-04-22 12:31:50,203 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-22 12:31:50,203 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 12:31:50,204 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 12:31:50,205 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 12:31:57,538 reid_baseline.train INFO: start training
2022-04-22 12:32:29,870 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.031, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 12:32:45,285 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.312[s] Speed: 51.2[samples/s]
2022-04-22 12:33:11,201 reid_baseline.train INFO: normal accuracy 0.5215138544717278 4.171815395355225 
2022-04-22 12:33:41,646 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 12:33:41,647 reid_baseline.train INFO: Accuracy: 52.2% Mean Entropy: 417.2%
2022-04-22 12:34:11,539 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.720, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 12:34:26,114 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-22 12:34:52,011 reid_baseline.train INFO: normal accuracy 0.5417886911466546 4.149554252624512 
2022-04-22 12:35:22,458 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 12:35:22,459 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.0%
2022-04-22 12:35:55,373 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.126, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 12:36:11,824 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.325[s] Speed: 49.3[samples/s]
2022-04-22 12:36:38,239 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.9584691524505615 
2022-04-22 12:37:09,086 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 12:37:09,087 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 395.8%
2022-04-22 12:37:47,700 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.338, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 12:38:02,314 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-22 12:38:50,166 reid_baseline.train INFO: normal accuracy 0.5915746789817526 3.3784518241882324 
2022-04-22 12:39:20,709 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 12:39:20,710 reid_baseline.train INFO: Accuracy: 59.2% Mean Entropy: 337.8%
2022-04-22 12:39:50,317 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.862, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 12:40:04,879 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-22 12:40:30,787 reid_baseline.train INFO: normal accuracy 0.668168506420365 2.776937246322632 
2022-04-22 12:41:01,302 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 12:41:01,303 reid_baseline.train INFO: Accuracy: 66.8% Mean Entropy: 277.7%
2022-04-22 12:41:31,224 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.571, Acc: 0.771, Base Lr: 4.83e-03
2022-04-22 12:41:45,476 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-22 12:42:11,512 reid_baseline.train INFO: normal accuracy 0.7341743635954043 2.4083263874053955 
2022-04-22 12:42:42,039 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 12:42:42,040 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 240.8%
2022-04-22 12:43:12,658 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.461, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 12:43:26,837 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-22 12:44:12,402 reid_baseline.train INFO: normal accuracy 0.7560261320117143 2.0750577449798584 
2022-04-22 12:44:43,438 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 12:44:43,438 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 207.5%
2022-04-22 12:45:13,178 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.230, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 12:45:27,180 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-22 12:45:53,616 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.8715205192565918 
2022-04-22 12:46:24,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 12:46:24,001 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 187.2%
2022-04-22 12:46:54,389 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.177, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 12:47:11,937 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.315[s] Speed: 50.7[samples/s]
2022-04-22 12:47:50,478 reid_baseline.train INFO: normal accuracy 0.7794548321694075 1.766438603401184 
2022-04-22 12:48:22,300 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 12:48:22,300 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 176.6%
2022-04-22 12:48:52,763 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.117, Acc: 0.891, Base Lr: 4.01e-03
2022-04-22 12:49:07,068 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-22 12:50:25,793 reid_baseline.train INFO: normal accuracy 0.780806487947736 1.726012945175171 
2022-04-22 12:50:56,220 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 12:50:56,221 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.6%
2022-04-22 12:51:25,794 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.083, Acc: 0.911, Base Lr: 3.38e-03
2022-04-22 12:51:40,159 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 12:52:06,359 reid_baseline.train INFO: normal accuracy 0.781707591799955 1.6769160032272339 
2022-04-22 12:52:36,746 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 12:52:36,747 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.7%
2022-04-22 12:53:08,579 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.009, Acc: 0.917, Base Lr: 2.77e-03
2022-04-22 12:53:24,266 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-22 12:53:49,751 reid_baseline.train INFO: normal accuracy 0.7823834196891192 1.6742644309997559 
2022-04-22 12:54:20,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 12:54:20,155 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 167.4%
2022-04-22 12:54:50,455 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.016, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 12:55:04,810 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 12:55:30,658 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.6975167989730835 
2022-04-22 12:55:30,659 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 12:55:30,664 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 169.8%
2022-04-22 12:56:00,629 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.000, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 12:56:19,916 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-22 12:56:46,724 reid_baseline.train INFO: normal accuracy 0.7866636629871593 1.669279932975769 
2022-04-22 12:57:17,236 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 12:57:17,237 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 166.9%
2022-04-22 12:57:47,099 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.993, Acc: 0.936, Base Lr: 1.19e-03
2022-04-22 12:58:01,843 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-22 12:58:27,819 reid_baseline.train INFO: normal accuracy 0.7862131110610497 1.6730087995529175 
2022-04-22 12:58:27,820 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 12:58:27,820 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 167.3%
2022-04-22 12:58:57,849 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.007, Acc: 0.927, Base Lr: 7.78e-04
2022-04-22 12:59:12,829 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 12:59:52,636 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5717213153839111 
2022-04-22 13:00:22,922 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 13:00:22,922 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 157.2%
2022-04-22 13:00:52,618 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.979, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 13:01:06,967 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 13:01:32,945 reid_baseline.train INFO: normal accuracy 0.7853120072088308 1.6843923330307007 
2022-04-22 13:01:32,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 13:01:32,946 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.4%
2022-04-22 13:02:02,640 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.986, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 13:02:19,526 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.306[s] Speed: 52.2[samples/s]
2022-04-22 13:02:53,377 reid_baseline.train INFO: normal accuracy 0.7846361793196666 1.6439247131347656 
2022-04-22 13:02:53,378 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 13:02:53,378 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 164.4%
2022-04-22 13:03:24,014 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.958, Acc: 0.924, Base Lr: 6.51e-05
2022-04-22 13:03:38,758 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 13:04:06,375 reid_baseline.train INFO: normal accuracy 0.7848614552827213 1.6867679357528687 
2022-04-22 13:04:06,375 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 13:04:06,376 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
2022-04-22 13:04:36,058 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.964, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 13:04:49,895 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 55.9[samples/s]
2022-04-22 13:05:53,320 reid_baseline.train INFO: normal accuracy 0.7841856273935571 1.6867201328277588 
2022-04-22 13:05:53,321 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 13:05:53,321 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 168.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_12/transformer_best_model.pth
2022-04-22 13:06:48,855 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5717213153839111 
2022-04-22 13:06:48,855 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 13:06:48,856 reid_baseline.train INFO: Accuracy: 78.4%
2022-04-22 13:07:14,360 reid_baseline.train INFO: normal accuracy 0.7835097995043929 1.5717213153839111 
2022-04-22 13:07:14,361 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 13:07:14,361 reid_baseline.train INFO: Shuffled Accuracy: 78.4%
2022-04-22 13:07:34,455 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7765206694602966 
2022-04-22 13:07:34,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 13:07:34,455 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-22 13:07:39,132 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_12
2022-04-22 13:07:39,133 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-22 13:07:39,133 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 13:07:39,134 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 13:07:39,135 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 13:07:46,459 reid_baseline.train INFO: start training
2022-04-22 13:08:18,628 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.031, Acc: 0.303, Base Lr: 8.72e-04
2022-04-22 13:08:33,965 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-22 13:09:52,134 reid_baseline.train INFO: normal accuracy 0.6008721597429424 4.171505928039551 
2022-04-22 13:10:22,462 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 13:10:22,462 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-22 13:10:52,501 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.720, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 13:11:07,093 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 13:12:30,552 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.138625621795654 
2022-04-22 13:13:01,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 13:13:01,008 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-22 13:13:31,251 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.126, Acc: 0.633, Base Lr: 2.46e-03
2022-04-22 13:13:45,987 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-22 13:14:47,851 reid_baseline.train INFO: normal accuracy 0.6369061280697728 3.8436155319213867 
2022-04-22 13:15:18,293 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 13:15:18,294 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-22 13:15:49,068 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.338, Acc: 0.669, Base Lr: 3.25e-03
2022-04-22 13:16:03,767 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-22 13:17:29,723 reid_baseline.train INFO: normal accuracy 0.6825797567133348 3.1003177165985107 
2022-04-22 13:18:05,656 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 13:18:05,656 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 310.0%
2022-04-22 13:18:35,549 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.862, Acc: 0.710, Base Lr: 4.04e-03
2022-04-22 13:18:50,274 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-22 13:19:54,567 reid_baseline.train INFO: normal accuracy 0.7440899701629562 2.4529356956481934 
2022-04-22 13:20:30,355 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 13:20:30,355 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-22 13:21:00,200 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.571, Acc: 0.772, Base Lr: 4.83e-03
2022-04-22 13:21:18,091 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.314[s] Speed: 51.0[samples/s]
2022-04-22 13:22:28,180 reid_baseline.train INFO: normal accuracy 0.7899931145283452 2.0809032917022705 
2022-04-22 13:23:03,517 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 13:23:03,518 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 208.1%
2022-04-22 13:23:34,237 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.461, Acc: 0.801, Base Lr: 5.62e-03
2022-04-22 13:23:48,426 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 13:24:51,372 reid_baseline.train INFO: normal accuracy 0.8106495294927702 1.8070391416549683 
2022-04-22 13:25:26,785 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 13:25:26,785 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.7%
2022-04-22 13:25:56,657 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.230, Acc: 0.859, Base Lr: 6.42e-03
2022-04-22 13:26:10,802 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.290[s] Speed: 55.3[samples/s]
2022-04-22 13:27:14,394 reid_baseline.train INFO: normal accuracy 0.8209777369749828 1.6228352785110474 
2022-04-22 13:27:50,260 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 13:27:50,260 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.3%
2022-04-22 13:28:20,636 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.177, Acc: 0.869, Base Lr: 7.21e-03
2022-04-22 13:28:34,905 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 13:29:41,622 reid_baseline.train INFO: normal accuracy 0.8237319256369061 1.5125161409378052 
2022-04-22 13:30:18,993 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 13:30:18,994 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 151.3%
2022-04-22 13:30:50,121 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.116, Acc: 0.891, Base Lr: 4.01e-03
2022-04-22 13:31:04,445 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-22 13:32:47,673 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.483078956604004 
2022-04-22 13:33:23,994 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 13:33:23,994 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-22 13:33:54,584 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.083, Acc: 0.912, Base Lr: 3.38e-03
2022-04-22 13:34:09,405 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 13:35:14,922 reid_baseline.train INFO: normal accuracy 0.8319944916226761 1.432343602180481 
2022-04-22 13:35:51,133 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 13:35:51,133 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.2%
2022-04-22 13:36:21,757 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.009, Acc: 0.917, Base Lr: 2.77e-03
2022-04-22 13:36:36,394 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 13:37:38,786 reid_baseline.train INFO: normal accuracy 0.83245352306633 1.4371730089187622 
2022-04-22 13:37:38,787 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 13:37:38,787 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.7%
2022-04-22 13:38:09,799 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.016, Acc: 0.911, Base Lr: 2.20e-03
2022-04-22 13:38:25,532 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.307[s] Speed: 52.0[samples/s]
2022-04-22 13:39:25,471 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4588929414749146 
2022-04-22 13:39:25,472 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 13:39:25,472 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.9%
2022-04-22 13:39:56,119 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.000, Acc: 0.920, Base Lr: 1.66e-03
2022-04-22 13:40:12,142 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 13:41:26,152 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4415416717529297 
2022-04-22 13:41:26,153 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 13:41:26,153 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.2%
2022-04-22 13:41:56,828 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.993, Acc: 0.936, Base Lr: 1.19e-03
2022-04-22 13:42:11,953 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-22 13:43:18,495 reid_baseline.train INFO: normal accuracy 0.836584806059215 1.4463105201721191 
2022-04-22 13:43:18,496 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 13:43:18,496 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 144.6%
2022-04-22 13:43:49,576 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.007, Acc: 0.927, Base Lr: 7.78e-04
2022-04-22 13:44:04,276 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-22 13:45:09,818 reid_baseline.train INFO: normal accuracy 0.8379619003901767 1.3537914752960205 
2022-04-22 13:45:45,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 13:45:45,239 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 135.4%
2022-04-22 13:46:24,938 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.979, Acc: 0.938, Base Lr: 4.51e-04
2022-04-22 13:46:39,724 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.358[s] Speed: 44.6[samples/s]
2022-04-22 13:47:55,482 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.4678019285202026 
2022-04-22 13:47:55,482 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 13:47:55,482 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.8%
2022-04-22 13:48:34,199 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.986, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 13:48:48,470 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-04-22 13:49:58,632 reid_baseline.train INFO: normal accuracy 0.8356667431719073 1.428012490272522 
2022-04-22 13:49:58,633 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 13:49:58,633 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 142.8%
2022-04-22 13:50:32,958 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.958, Acc: 0.923, Base Lr: 6.51e-05
2022-04-22 13:50:47,870 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-22 13:51:55,359 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.4657979011535645 
2022-04-22 13:51:55,359 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 13:51:55,360 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-22 13:52:25,898 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.964, Acc: 0.925, Base Lr: 1.60e-05
2022-04-22 13:52:40,218 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 13:54:23,237 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4660669565200806 
2022-04-22 13:54:23,237 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 13:54:23,238 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_12/transformer_best_model.pth
2022-04-22 13:56:02,547 reid_baseline.train INFO: normal accuracy 0.8379619003901767 1.3537914752960205 
2022-04-22 13:56:02,548 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 13:56:02,548 reid_baseline.train INFO: Accuracy: 83.8%
2022-04-22 13:57:24,902 reid_baseline.train INFO: normal accuracy 0.8379619003901767 1.3537914752960205 
2022-04-22 13:57:24,902 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 13:57:24,903 reid_baseline.train INFO: Shuffled Accuracy: 83.8%
2022-04-22 13:57:46,860 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.77641761302948 
2022-04-22 13:57:46,860 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 13:57:46,861 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
