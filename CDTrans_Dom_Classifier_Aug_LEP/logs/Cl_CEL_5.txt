2022-04-23 10:33:59,574 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1
2022-04-23 10:33:59,574 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-23 10:33:59,575 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 10:33:59,575 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 10:33:59,575 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 10:34:13,338 reid_baseline.train INFO: start training
2022-04-23 10:35:19,755 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.008, Acc: 0.274, Base Lr: 8.72e-04
2022-04-23 10:36:03,009 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.945, Acc: 0.375, Base Lr: 8.72e-04
2022-04-23 10:36:34,383 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.504[s] Speed: 31.8[samples/s]
2022-04-23 10:37:09,493 reid_baseline.train INFO: normal accuracy 0.5063864853728883 4.167745113372803 
2022-04-23 10:37:41,511 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 10:37:41,512 reid_baseline.train INFO: Accuracy: 50.6% Mean Entropy: 416.8%
2022-04-23 10:38:27,271 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.530, Acc: 0.539, Base Lr: 1.66e-03
2022-04-23 10:39:09,176 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.369, Acc: 0.547, Base Lr: 1.66e-03
2022-04-23 10:39:42,946 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.444[s] Speed: 36.0[samples/s]
2022-04-23 10:40:15,654 reid_baseline.train INFO: normal accuracy 0.53811289658014 4.055405616760254 
2022-04-23 10:40:45,632 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 10:40:45,633 reid_baseline.train INFO: Accuracy: 53.8% Mean Entropy: 405.5%
2022-04-23 10:41:31,832 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.606, Acc: 0.594, Base Lr: 2.46e-03
2022-04-23 10:42:15,937 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.462, Acc: 0.603, Base Lr: 2.46e-03
2022-04-23 10:42:47,474 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.446[s] Speed: 35.9[samples/s]
2022-04-23 10:43:18,220 reid_baseline.train INFO: normal accuracy 0.6093943139678616 3.5393872261047363 
2022-04-23 10:44:02,776 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 10:44:02,777 reid_baseline.train INFO: Accuracy: 60.9% Mean Entropy: 353.9%
2022-04-23 10:44:47,491 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.865, Acc: 0.669, Base Lr: 3.25e-03
2022-04-23 10:45:29,917 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.766, Acc: 0.698, Base Lr: 3.25e-03
2022-04-23 10:46:00,915 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.432[s] Speed: 37.0[samples/s]
2022-04-23 10:46:32,438 reid_baseline.train INFO: normal accuracy 0.6744952616398846 2.8999857902526855 
2022-04-23 10:47:02,430 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 10:47:02,431 reid_baseline.train INFO: Accuracy: 67.4% Mean Entropy: 290.0%
2022-04-23 10:47:46,443 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.500, Acc: 0.761, Base Lr: 4.04e-03
2022-04-23 10:48:28,954 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.459, Acc: 0.754, Base Lr: 4.04e-03
2022-04-23 10:49:00,313 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.432[s] Speed: 37.1[samples/s]
2022-04-23 10:49:33,262 reid_baseline.train INFO: normal accuracy 0.7004532344458179 2.578115224838257 
2022-04-23 10:50:27,554 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 10:50:27,554 reid_baseline.train INFO: Accuracy: 70.0% Mean Entropy: 257.8%
2022-04-23 10:51:12,121 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.278, Acc: 0.795, Base Lr: 4.83e-03
2022-04-23 10:51:55,901 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.278, Acc: 0.793, Base Lr: 4.83e-03
2022-04-23 10:52:27,070 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.438[s] Speed: 36.6[samples/s]
2022-04-23 10:52:58,260 reid_baseline.train INFO: normal accuracy 0.7165224557066338 2.3198633193969727 
2022-04-23 10:53:28,350 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 10:53:28,351 reid_baseline.train INFO: Accuracy: 71.7% Mean Entropy: 232.0%
2022-04-23 10:54:13,155 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.200, Acc: 0.815, Base Lr: 5.62e-03
2022-04-23 10:54:55,234 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.169, Acc: 0.828, Base Lr: 5.62e-03
2022-04-23 10:55:26,317 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.432[s] Speed: 37.0[samples/s]
2022-04-23 10:55:59,142 reid_baseline.train INFO: normal accuracy 0.7206427688504327 2.208137035369873 
2022-04-23 10:56:52,932 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 10:56:52,933 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 220.8%
2022-04-23 10:57:38,224 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.076, Acc: 0.851, Base Lr: 6.42e-03
2022-04-23 10:58:21,048 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.079, Acc: 0.847, Base Lr: 6.42e-03
2022-04-23 10:58:52,489 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.438[s] Speed: 36.6[samples/s]
2022-04-23 10:59:24,704 reid_baseline.train INFO: normal accuracy 0.7449526163988464 2.036241054534912 
2022-04-23 11:00:23,464 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 11:00:23,465 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 203.6%
2022-04-23 11:01:09,387 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.018, Acc: 0.870, Base Lr: 7.21e-03
2022-04-23 11:01:52,037 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.012, Acc: 0.873, Base Lr: 7.21e-03
2022-04-23 11:02:23,312 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.439[s] Speed: 36.4[samples/s]
2022-04-23 11:02:55,211 reid_baseline.train INFO: normal accuracy 0.7325916769674495 1.9667694568634033 
2022-04-23 11:03:25,205 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 11:03:25,205 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 196.7%
2022-04-23 11:04:09,372 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.943, Acc: 0.890, Base Lr: 4.01e-03
2022-04-23 11:04:52,247 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.931, Acc: 0.899, Base Lr: 4.01e-03
2022-04-23 11:05:22,154 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.428[s] Speed: 37.4[samples/s]
2022-04-23 11:06:24,225 reid_baseline.train INFO: normal accuracy 0.7334157395962093 1.9490469694137573 
2022-04-23 11:06:54,236 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 11:06:54,236 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 194.9%
2022-04-23 11:07:38,577 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.898, Acc: 0.908, Base Lr: 3.38e-03
2022-04-23 11:08:22,326 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.914, Acc: 0.904, Base Lr: 3.38e-03
2022-04-23 11:08:54,113 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.439[s] Speed: 36.5[samples/s]
2022-04-23 11:09:23,673 reid_baseline.train INFO: normal accuracy 0.7395962093119077 1.8891043663024902 
2022-04-23 11:09:58,018 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 11:09:58,019 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 188.9%
2022-04-23 11:10:43,332 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.930, Acc: 0.890, Base Lr: 2.77e-03
2022-04-23 11:11:25,776 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.896, Acc: 0.904, Base Lr: 2.77e-03
2022-04-23 11:11:57,747 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.438[s] Speed: 36.5[samples/s]
2022-04-23 11:12:28,490 reid_baseline.train INFO: normal accuracy 0.7395962093119077 1.8535159826278687 
2022-04-23 11:13:13,718 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 11:13:13,721 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 185.4%
2022-04-23 11:13:58,093 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.897, Acc: 0.904, Base Lr: 2.20e-03
2022-04-23 11:14:40,572 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.881, Acc: 0.914, Base Lr: 2.20e-03
2022-04-23 11:15:10,642 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.428[s] Speed: 37.4[samples/s]
2022-04-23 11:15:41,476 reid_baseline.train INFO: normal accuracy 0.7400082406262876 1.9081785678863525 
2022-04-23 11:15:41,479 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 11:15:41,479 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 190.8%
2022-04-23 11:16:25,586 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.875, Acc: 0.907, Base Lr: 1.66e-03
2022-04-23 11:17:07,388 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.852, Acc: 0.920, Base Lr: 1.66e-03
2022-04-23 11:17:38,976 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.430[s] Speed: 37.2[samples/s]
2022-04-23 11:18:08,668 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8947714567184448 
2022-04-23 11:18:08,676 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 11:18:08,677 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 189.5%
2022-04-23 11:18:52,257 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.829, Acc: 0.932, Base Lr: 1.19e-03
2022-04-23 11:19:35,177 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.846, Acc: 0.926, Base Lr: 1.19e-03
2022-04-23 11:20:06,620 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.432[s] Speed: 37.0[samples/s]
2022-04-23 11:20:39,253 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.887769103050232 
2022-04-23 11:20:39,255 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 11:20:39,255 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 188.8%
2022-04-23 11:21:23,285 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.842, Acc: 0.924, Base Lr: 7.78e-04
2022-04-23 11:22:06,199 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.844, Acc: 0.921, Base Lr: 7.78e-04
2022-04-23 11:22:37,468 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.433[s] Speed: 37.0[samples/s]
2022-04-23 11:23:06,894 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.8543239831924438 
2022-04-23 11:23:06,897 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 11:23:06,897 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 185.4%
2022-04-23 11:23:51,537 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.851, Acc: 0.919, Base Lr: 4.51e-04
2022-04-23 11:24:34,098 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.842, Acc: 0.921, Base Lr: 4.51e-04
2022-04-23 11:25:06,822 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.439[s] Speed: 36.5[samples/s]
2022-04-23 11:25:38,871 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.871570110321045 
2022-04-23 11:25:38,873 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 11:25:38,873 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 187.2%
2022-04-23 11:26:23,023 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.814, Acc: 0.932, Base Lr: 2.11e-04
2022-04-23 11:27:04,872 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.817, Acc: 0.928, Base Lr: 2.11e-04
2022-04-23 11:27:35,060 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.426[s] Speed: 37.6[samples/s]
2022-04-23 11:28:11,315 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.844077706336975 
2022-04-23 11:28:41,307 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 11:28:41,308 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 184.4%
2022-04-23 11:29:31,772 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.826, Acc: 0.932, Base Lr: 6.51e-05
2022-04-23 11:30:19,346 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.841, Acc: 0.925, Base Lr: 6.51e-05
2022-04-23 11:30:54,242 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.487[s] Speed: 32.9[samples/s]
2022-04-23 11:31:31,752 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.8380992412567139 
2022-04-23 11:32:01,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 11:32:01,730 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 183.8%
2022-04-23 11:32:50,808 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.818, Acc: 0.933, Base Lr: 1.60e-05
2022-04-23 11:33:40,078 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.831, Acc: 0.929, Base Lr: 1.60e-05
2022-04-23 11:34:15,161 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.489[s] Speed: 32.7[samples/s]
2022-04-23 11:35:21,181 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.792531967163086 
2022-04-23 11:36:01,035 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 11:36:01,035 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 179.3%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-23 11:37:09,385 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.792531967163086 
2022-04-23 11:37:09,386 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 11:37:09,386 reid_baseline.train INFO: Accuracy: 74.5%
2022-04-23 11:37:48,334 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.792531967163086 
2022-04-23 11:37:48,334 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 11:37:48,335 reid_baseline.train INFO: Shuffled Accuracy: 74.5%
2022-04-23 11:38:36,182 reid_baseline.train INFO: normal accuracy 0.9573883161512028 0.7879953384399414 
2022-04-23 11:38:36,182 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 11:38:36,182 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-04-23 11:38:42,413 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1
2022-04-23 11:38:42,413 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-23 11:38:42,413 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 11:38:42,413 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 11:38:42,413 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 11:38:53,264 reid_baseline.train INFO: start training
2022-04-23 11:39:56,404 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.008, Acc: 0.273, Base Lr: 8.72e-04
2022-04-23 11:40:46,026 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.945, Acc: 0.375, Base Lr: 8.72e-04
2022-04-23 11:41:20,949 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.530[s] Speed: 30.2[samples/s]
2022-04-23 11:42:12,113 reid_baseline.train INFO: normal accuracy 0.5471953142599685 4.16571044921875 
2022-04-23 11:42:42,055 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 11:42:42,056 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 416.6%
2022-04-23 11:43:33,251 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.530, Acc: 0.538, Base Lr: 1.66e-03
2022-04-23 11:44:20,198 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.369, Acc: 0.547, Base Lr: 1.66e-03
2022-04-23 11:44:58,540 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.500[s] Speed: 32.0[samples/s]
2022-04-23 11:45:47,253 reid_baseline.train INFO: normal accuracy 0.57197567019599 4.008697032928467 
2022-04-23 11:46:17,246 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 11:46:17,247 reid_baseline.train INFO: Accuracy: 57.2% Mean Entropy: 400.9%
2022-04-23 11:47:07,249 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.606, Acc: 0.594, Base Lr: 2.46e-03
2022-04-23 11:47:57,696 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.462, Acc: 0.603, Base Lr: 2.46e-03
2022-04-23 11:48:33,175 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.498[s] Speed: 32.1[samples/s]
2022-04-23 11:49:23,742 reid_baseline.train INFO: normal accuracy 0.6350529398513178 3.332564353942871 
2022-04-23 11:50:12,815 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 11:50:12,816 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 333.3%
2022-04-23 11:51:04,024 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.865, Acc: 0.670, Base Lr: 3.25e-03
2022-04-23 11:51:53,600 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.766, Acc: 0.698, Base Lr: 3.25e-03
2022-04-23 11:52:28,786 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.498[s] Speed: 32.1[samples/s]
2022-04-23 11:53:16,975 reid_baseline.train INFO: normal accuracy 0.6992565893219194 2.6236579418182373 
2022-04-23 11:53:46,948 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 11:53:46,949 reid_baseline.train INFO: Accuracy: 69.9% Mean Entropy: 262.4%
2022-04-23 11:54:37,537 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.500, Acc: 0.761, Base Lr: 4.04e-03
2022-04-23 11:55:25,869 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.460, Acc: 0.754, Base Lr: 4.04e-03
2022-04-23 11:56:01,929 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.494[s] Speed: 32.4[samples/s]
2022-04-23 11:56:52,326 reid_baseline.train INFO: normal accuracy 0.7224600135165578 2.2515275478363037 
2022-04-23 11:57:22,305 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 11:57:22,305 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 225.2%
2022-04-23 11:58:13,765 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.278, Acc: 0.796, Base Lr: 4.83e-03
2022-04-23 11:59:03,325 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.277, Acc: 0.793, Base Lr: 4.83e-03
2022-04-23 11:59:39,706 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.503[s] Speed: 31.8[samples/s]
2022-04-23 12:00:32,059 reid_baseline.train INFO: normal accuracy 0.7292182924082 2.0480220317840576 
2022-04-23 12:01:02,069 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 12:01:02,069 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 204.8%
2022-04-23 12:01:53,914 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.200, Acc: 0.815, Base Lr: 5.62e-03
2022-04-23 12:02:43,116 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.170, Acc: 0.827, Base Lr: 5.62e-03
2022-04-23 12:03:18,729 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.501[s] Speed: 32.0[samples/s]
2022-04-23 12:04:10,123 reid_baseline.train INFO: normal accuracy 0.751971164676729 1.9171452522277832 
2022-04-23 12:04:40,111 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 12:04:40,111 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 191.7%
2022-04-23 12:05:32,779 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.075, Acc: 0.852, Base Lr: 6.42e-03
2022-04-23 12:06:22,335 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.079, Acc: 0.847, Base Lr: 6.42e-03
2022-04-23 12:06:58,120 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.505[s] Speed: 31.7[samples/s]
2022-04-23 12:07:45,891 reid_baseline.train INFO: normal accuracy 0.7571525118269881 1.829854130744934 
2022-04-23 12:08:15,977 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 12:08:15,984 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 183.0%
2022-04-23 12:09:05,731 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.018, Acc: 0.871, Base Lr: 7.21e-03
2022-04-23 12:09:54,058 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.012, Acc: 0.873, Base Lr: 7.21e-03
2022-04-23 12:10:28,832 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.487[s] Speed: 32.9[samples/s]
2022-04-23 12:11:16,213 reid_baseline.train INFO: normal accuracy 0.7573777877900428 1.7614434957504272 
2022-04-23 12:12:03,796 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 12:12:03,803 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 176.1%
2022-04-23 12:12:51,554 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.944, Acc: 0.889, Base Lr: 4.01e-03
2022-04-23 12:13:42,009 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.931, Acc: 0.899, Base Lr: 4.01e-03
2022-04-23 12:14:17,031 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.488[s] Speed: 32.8[samples/s]
2022-04-23 12:15:34,915 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.7842415571212769 
2022-04-23 12:15:34,918 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 12:15:34,918 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 178.4%
2022-04-23 12:16:26,208 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.898, Acc: 0.908, Base Lr: 3.38e-03
2022-04-23 12:17:15,677 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.914, Acc: 0.904, Base Lr: 3.38e-03
2022-04-23 12:17:52,542 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.504[s] Speed: 31.8[samples/s]
2022-04-23 12:18:43,468 reid_baseline.train INFO: normal accuracy 0.7636855147555756 1.7038158178329468 
2022-04-23 12:19:38,237 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 12:19:38,239 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 170.4%
2022-04-23 12:20:29,960 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.930, Acc: 0.890, Base Lr: 2.77e-03
2022-04-23 12:21:18,531 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.896, Acc: 0.904, Base Lr: 2.77e-03
2022-04-23 12:21:55,817 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.504[s] Speed: 31.8[samples/s]
2022-04-23 12:22:45,891 reid_baseline.train INFO: normal accuracy 0.7666141022752873 1.6894971132278442 
2022-04-23 12:23:19,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 12:23:19,609 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 168.9%
2022-04-23 12:23:50,239 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.897, Acc: 0.904, Base Lr: 2.20e-03
2022-04-23 12:24:20,271 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.881, Acc: 0.914, Base Lr: 2.20e-03
2022-04-23 12:24:41,249 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 12:25:29,763 reid_baseline.train INFO: normal accuracy 0.7679657580536157 1.7522146701812744 
2022-04-23 12:25:29,764 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 12:25:29,764 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 175.2%
2022-04-23 12:26:03,978 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.875, Acc: 0.907, Base Lr: 1.66e-03
2022-04-23 12:26:38,647 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.852, Acc: 0.920, Base Lr: 1.66e-03
2022-04-23 12:27:04,243 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.346[s] Speed: 46.3[samples/s]
2022-04-23 12:27:47,978 reid_baseline.train INFO: normal accuracy 0.7661635503491777 1.7315354347229004 
2022-04-23 12:27:47,985 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 12:27:47,986 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 173.2%
2022-04-23 12:28:18,101 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.829, Acc: 0.932, Base Lr: 1.19e-03
2022-04-23 12:28:51,939 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.846, Acc: 0.926, Base Lr: 1.19e-03
2022-04-23 12:29:14,789 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-23 12:30:09,583 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.735878825187683 
2022-04-23 12:30:09,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 12:30:09,586 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 173.6%
2022-04-23 12:30:51,866 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.842, Acc: 0.924, Base Lr: 7.78e-04
2022-04-23 12:31:35,449 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.844, Acc: 0.921, Base Lr: 7.78e-04
2022-04-23 12:32:12,730 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.450[s] Speed: 35.5[samples/s]
2022-04-23 12:32:57,514 reid_baseline.train INFO: normal accuracy 0.7697679657580536 1.702054500579834 
2022-04-23 12:32:57,523 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 12:32:57,533 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 170.2%
2022-04-23 12:33:32,367 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.851, Acc: 0.919, Base Lr: 4.51e-04
2022-04-23 12:34:02,484 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.842, Acc: 0.921, Base Lr: 4.51e-04
2022-04-23 12:34:25,357 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-23 12:35:12,850 reid_baseline.train INFO: normal accuracy 0.7722460013516558 1.7233163118362427 
2022-04-23 12:35:12,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 12:35:12,854 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 172.3%
2022-04-23 12:35:46,636 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.814, Acc: 0.932, Base Lr: 2.11e-04
2022-04-23 12:36:18,413 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.817, Acc: 0.928, Base Lr: 2.11e-04
2022-04-23 12:36:39,938 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-23 12:37:22,800 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.7035953998565674 
2022-04-23 12:37:22,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 12:37:22,800 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 170.4%
2022-04-23 12:37:55,707 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.826, Acc: 0.931, Base Lr: 6.51e-05
2022-04-23 12:38:26,074 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.841, Acc: 0.924, Base Lr: 6.51e-05
2022-04-23 12:38:48,056 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-23 12:39:36,208 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.6796233654022217 
2022-04-23 12:40:06,209 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 12:40:06,210 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 168.0%
2022-04-23 12:40:39,341 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.818, Acc: 0.932, Base Lr: 1.60e-05
2022-04-23 12:41:07,383 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.831, Acc: 0.929, Base Lr: 1.60e-05
2022-04-23 12:41:28,096 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.299[s] Speed: 53.4[samples/s]
2022-04-23 12:42:46,093 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.6391148567199707 
2022-04-23 12:43:16,091 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 12:43:16,091 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 163.9%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-23 12:44:36,306 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.6391148567199707 
2022-04-23 12:44:36,307 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 12:44:36,307 reid_baseline.train INFO: Accuracy: 77.3%
2022-04-23 12:45:18,614 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.6391148567199707 
2022-04-23 12:45:18,614 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 12:45:18,615 reid_baseline.train INFO: Shuffled Accuracy: 77.3%
2022-04-23 12:46:06,047 reid_baseline.train INFO: normal accuracy 0.9573883161512028 0.7879847288131714 
2022-04-23 12:46:06,047 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 12:46:06,047 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-04-23 12:46:12,119 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1
2022-04-23 12:46:12,120 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-23 12:46:12,120 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 12:46:12,120 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 12:46:12,121 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 12:46:20,919 reid_baseline.train INFO: start training
2022-04-23 12:46:58,844 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.008, Acc: 0.274, Base Lr: 8.72e-04
2022-04-23 12:47:29,949 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.945, Acc: 0.375, Base Lr: 8.72e-04
2022-04-23 12:47:52,253 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-23 12:49:47,504 reid_baseline.train INFO: normal accuracy 0.5673628643562084 4.167020320892334 
2022-04-23 12:50:17,444 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 12:50:17,444 reid_baseline.train INFO: Accuracy: 56.7% Mean Entropy: 416.7%
2022-04-23 12:50:50,727 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.530, Acc: 0.539, Base Lr: 1.66e-03
2022-04-23 12:51:21,884 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.369, Acc: 0.547, Base Lr: 1.66e-03
2022-04-23 12:51:46,059 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.325[s] Speed: 49.3[samples/s]
2022-04-23 12:53:42,609 reid_baseline.train INFO: normal accuracy 0.5921505623135185 4.02883768081665 
2022-04-23 12:54:12,596 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 12:54:12,596 reid_baseline.train INFO: Accuracy: 59.2% Mean Entropy: 402.9%
2022-04-23 12:54:43,133 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.606, Acc: 0.594, Base Lr: 2.46e-03
2022-04-23 12:55:12,529 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.462, Acc: 0.603, Base Lr: 2.46e-03
2022-04-23 12:55:34,918 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-23 12:57:30,451 reid_baseline.train INFO: normal accuracy 0.6639889832453523 3.388033151626587 
2022-04-23 12:58:00,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 12:58:00,411 reid_baseline.train INFO: Accuracy: 66.4% Mean Entropy: 338.8%
2022-04-23 12:58:32,609 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.865, Acc: 0.669, Base Lr: 3.25e-03
2022-04-23 12:59:02,302 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.766, Acc: 0.697, Base Lr: 3.25e-03
2022-04-23 12:59:25,329 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-23 13:01:16,437 reid_baseline.train INFO: normal accuracy 0.7254991966949736 2.6718437671661377 
2022-04-23 13:01:49,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 13:01:49,842 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 267.2%
2022-04-23 13:02:22,325 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.500, Acc: 0.761, Base Lr: 4.04e-03
2022-04-23 13:02:53,477 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.459, Acc: 0.754, Base Lr: 4.04e-03
2022-04-23 13:03:15,185 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-23 13:05:21,697 reid_baseline.train INFO: normal accuracy 0.7539591462015148 2.3209288120269775 
2022-04-23 13:05:51,685 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 13:05:51,685 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 232.1%
2022-04-23 13:06:23,544 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.278, Acc: 0.796, Base Lr: 4.83e-03
2022-04-23 13:06:54,894 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.277, Acc: 0.793, Base Lr: 4.83e-03
2022-04-23 13:07:17,863 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.316[s] Speed: 50.7[samples/s]
2022-04-23 13:09:22,242 reid_baseline.train INFO: normal accuracy 0.7693366995639201 2.0854592323303223 
2022-04-23 13:09:52,229 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 13:09:52,230 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 208.5%
2022-04-23 13:10:25,547 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.200, Acc: 0.815, Base Lr: 5.62e-03
2022-04-23 13:10:57,030 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.169, Acc: 0.828, Base Lr: 5.62e-03
2022-04-23 13:11:19,512 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-23 13:13:14,599 reid_baseline.train INFO: normal accuracy 0.7755336240532477 1.9778591394424438 
2022-04-23 13:13:44,576 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 13:13:44,576 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 197.8%
2022-04-23 13:14:20,451 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.076, Acc: 0.852, Base Lr: 6.42e-03
2022-04-23 13:14:51,072 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.079, Acc: 0.847, Base Lr: 6.42e-03
2022-04-23 13:15:12,140 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.320[s] Speed: 49.9[samples/s]
2022-04-23 13:17:04,198 reid_baseline.train INFO: normal accuracy 0.782648611429883 1.8443000316619873 
2022-04-23 13:17:34,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 13:17:34,178 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 184.4%
2022-04-23 13:18:06,722 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.018, Acc: 0.870, Base Lr: 7.21e-03
2022-04-23 13:18:35,984 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.012, Acc: 0.873, Base Lr: 7.21e-03
2022-04-23 13:18:58,520 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-23 13:20:55,463 reid_baseline.train INFO: normal accuracy 0.7849437686481524 1.7762564420700073 
2022-04-23 13:21:25,449 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 13:21:25,450 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 177.6%
2022-04-23 13:21:57,519 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.944, Acc: 0.889, Base Lr: 4.01e-03
2022-04-23 13:22:27,179 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.931, Acc: 0.899, Base Lr: 4.01e-03
2022-04-23 13:22:49,298 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-23 13:25:16,184 reid_baseline.train INFO: normal accuracy 0.7835666743171907 1.7877304553985596 
2022-04-23 13:25:16,185 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 13:25:16,186 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 178.8%
2022-04-23 13:25:49,047 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.898, Acc: 0.908, Base Lr: 3.38e-03
2022-04-23 13:26:19,527 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.914, Acc: 0.904, Base Lr: 3.38e-03
2022-04-23 13:26:41,592 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.312[s] Speed: 51.2[samples/s]
2022-04-23 13:28:41,975 reid_baseline.train INFO: normal accuracy 0.7874684415882488 1.7283661365509033 
2022-04-23 13:29:35,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 13:29:35,289 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 172.8%
2022-04-23 13:30:09,757 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.930, Acc: 0.890, Base Lr: 2.77e-03
2022-04-23 13:30:40,182 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.896, Acc: 0.904, Base Lr: 2.77e-03
2022-04-23 13:31:01,889 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-23 13:32:59,185 reid_baseline.train INFO: normal accuracy 0.7874684415882488 1.6978938579559326 
2022-04-23 13:33:30,637 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 13:33:30,644 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 169.8%
2022-04-23 13:34:00,176 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.897, Acc: 0.904, Base Lr: 2.20e-03
2022-04-23 13:34:27,577 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.881, Acc: 0.914, Base Lr: 2.20e-03
2022-04-23 13:34:48,338 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.284[s] Speed: 56.2[samples/s]
2022-04-23 13:36:50,014 reid_baseline.train INFO: normal accuracy 0.7888455359192105 1.7612379789352417 
2022-04-23 13:36:50,015 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 13:36:50,015 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 176.1%
2022-04-23 13:37:23,896 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.875, Acc: 0.907, Base Lr: 1.66e-03
2022-04-23 13:37:54,630 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.852, Acc: 0.920, Base Lr: 1.66e-03
2022-04-23 13:38:18,349 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.323[s] Speed: 49.5[samples/s]
2022-04-23 13:40:12,985 reid_baseline.train INFO: normal accuracy 0.7860913472572871 1.7394418716430664 
2022-04-23 13:40:12,987 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 13:40:12,987 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 173.9%
2022-04-23 13:40:45,455 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.829, Acc: 0.932, Base Lr: 1.19e-03
2022-04-23 13:41:14,986 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.846, Acc: 0.926, Base Lr: 1.19e-03
2022-04-23 13:41:36,567 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.306[s] Speed: 52.4[samples/s]
2022-04-23 13:43:29,634 reid_baseline.train INFO: normal accuracy 0.7886160201973835 1.7418299913406372 
2022-04-23 13:43:29,634 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 13:43:29,635 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 174.2%
2022-04-23 13:44:00,628 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.842, Acc: 0.924, Base Lr: 7.78e-04
2022-04-23 13:44:27,123 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.844, Acc: 0.921, Base Lr: 7.78e-04
2022-04-23 13:44:46,520 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-23 13:46:36,453 reid_baseline.train INFO: normal accuracy 0.7897635988065183 1.7057781219482422 
2022-04-23 13:46:36,453 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 13:46:36,454 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 170.6%
2022-04-23 13:47:05,358 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.851, Acc: 0.919, Base Lr: 4.51e-04
2022-04-23 13:47:33,871 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.842, Acc: 0.921, Base Lr: 4.51e-04
2022-04-23 13:47:55,901 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 13:49:45,130 reid_baseline.train INFO: normal accuracy 0.7902226302501721 1.726871132850647 
2022-04-23 13:49:45,131 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 13:49:45,132 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 172.7%
2022-04-23 13:50:16,749 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.814, Acc: 0.932, Base Lr: 2.11e-04
2022-04-23 13:50:45,818 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.817, Acc: 0.928, Base Lr: 2.11e-04
2022-04-23 13:51:05,985 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 13:52:56,028 reid_baseline.train INFO: normal accuracy 0.790911177415653 1.7085117101669312 
2022-04-23 13:52:56,029 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 13:52:56,029 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 170.9%
2022-04-23 13:53:27,140 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.826, Acc: 0.932, Base Lr: 6.51e-05
2022-04-23 13:53:55,670 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.841, Acc: 0.925, Base Lr: 6.51e-05
2022-04-23 13:54:15,630 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 13:56:05,299 reid_baseline.train INFO: normal accuracy 0.7888455359192105 1.6882917881011963 
2022-04-23 13:56:38,110 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 13:56:38,116 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 168.8%
2022-04-23 13:57:06,121 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.818, Acc: 0.932, Base Lr: 1.60e-05
2022-04-23 13:57:35,448 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.831, Acc: 0.929, Base Lr: 1.60e-05
2022-04-23 13:57:57,462 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 14:00:20,760 reid_baseline.train INFO: normal accuracy 0.7899931145283452 1.642937183380127 
2022-04-23 14:00:50,735 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 14:00:50,736 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 164.3%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-23 14:03:09,995 reid_baseline.train INFO: normal accuracy 0.7899931145283452 1.642937183380127 
2022-04-23 14:03:09,996 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 14:03:09,996 reid_baseline.train INFO: Accuracy: 79.0%
2022-04-23 14:04:52,382 reid_baseline.train INFO: normal accuracy 0.7899931145283452 1.642937183380127 
2022-04-23 14:04:52,382 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 14:04:52,382 reid_baseline.train INFO: Shuffled Accuracy: 79.0%
2022-04-23 14:05:37,899 reid_baseline.train INFO: normal accuracy 0.9573883161512028 0.7880452871322632 
2022-04-23 14:05:37,903 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 14:05:37,910 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-04-23 14:05:44,038 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2
2022-04-23 14:05:44,038 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-23 14:05:44,039 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 14:05:44,039 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 14:05:44,039 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 14:05:53,167 reid_baseline.train INFO: start training
2022-04-23 14:06:29,956 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.980, Acc: 0.270, Base Lr: 8.72e-04
2022-04-23 14:06:57,086 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.903, Acc: 0.370, Base Lr: 8.72e-04
2022-04-23 14:07:15,842 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 14:07:50,044 reid_baseline.train INFO: normal accuracy 0.5072105480016481 4.16784143447876 
2022-04-23 14:08:19,978 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 14:08:19,978 reid_baseline.train INFO: Accuracy: 50.7% Mean Entropy: 416.8%
2022-04-23 14:08:51,990 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.505, Acc: 0.546, Base Lr: 1.66e-03
2022-04-23 14:09:19,979 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.351, Acc: 0.553, Base Lr: 1.66e-03
2022-04-23 14:09:39,750 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 14:10:16,630 reid_baseline.train INFO: normal accuracy 0.5418211784095591 4.058411121368408 
2022-04-23 14:10:46,642 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 14:10:46,643 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 405.8%
2022-04-23 14:11:17,814 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.606, Acc: 0.600, Base Lr: 2.46e-03
2022-04-23 14:11:47,362 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.453, Acc: 0.606, Base Lr: 2.46e-03
2022-04-23 14:12:10,386 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.307[s] Speed: 52.2[samples/s]
2022-04-23 14:12:45,318 reid_baseline.train INFO: normal accuracy 0.6205191594561187 3.5439722537994385 
2022-04-23 14:13:15,311 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 14:13:15,312 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 354.4%
2022-04-23 14:13:47,023 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.861, Acc: 0.669, Base Lr: 3.25e-03
2022-04-23 14:14:16,182 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.776, Acc: 0.697, Base Lr: 3.25e-03
2022-04-23 14:14:37,103 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 14:15:13,517 reid_baseline.train INFO: normal accuracy 0.6786155747836835 2.8919994831085205 
2022-04-23 14:15:43,495 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 14:15:43,496 reid_baseline.train INFO: Accuracy: 67.9% Mean Entropy: 289.2%
2022-04-23 14:16:15,380 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.488, Acc: 0.762, Base Lr: 4.04e-03
2022-04-23 14:16:44,672 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.446, Acc: 0.754, Base Lr: 4.04e-03
2022-04-23 14:17:06,377 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-23 14:17:40,621 reid_baseline.train INFO: normal accuracy 0.7045735475896168 2.574305295944214 
2022-04-23 14:18:22,063 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 14:18:22,063 reid_baseline.train INFO: Accuracy: 70.5% Mean Entropy: 257.4%
2022-04-23 14:18:52,850 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.277, Acc: 0.796, Base Lr: 4.83e-03
2022-04-23 14:19:22,409 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.273, Acc: 0.795, Base Lr: 4.83e-03
2022-04-23 14:19:43,775 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 14:20:19,457 reid_baseline.train INFO: normal accuracy 0.722702925422332 2.319718599319458 
2022-04-23 14:20:49,461 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 14:20:49,462 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 232.0%
2022-04-23 14:21:21,256 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.181, Acc: 0.822, Base Lr: 5.62e-03
2022-04-23 14:21:50,563 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.153, Acc: 0.831, Base Lr: 5.62e-03
2022-04-23 14:22:11,162 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 14:22:47,062 reid_baseline.train INFO: normal accuracy 0.7247630819942316 2.1777455806732178 
2022-04-23 14:23:17,075 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 14:23:17,076 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 217.8%
2022-04-23 14:23:48,577 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.075, Acc: 0.853, Base Lr: 6.42e-03
2022-04-23 14:24:14,819 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.079, Acc: 0.849, Base Lr: 6.42e-03
2022-04-23 14:24:36,509 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 14:25:11,988 reid_baseline.train INFO: normal accuracy 0.7404202719406675 2.031883716583252 
2022-04-23 14:25:45,107 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 14:25:45,107 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 203.2%
2022-04-23 14:26:14,976 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 2.999, Acc: 0.869, Base Lr: 7.21e-03
2022-04-23 14:26:46,529 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 2.992, Acc: 0.872, Base Lr: 7.21e-03
2022-04-23 14:27:06,459 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 14:27:39,280 reid_baseline.train INFO: normal accuracy 0.7342398022249691 1.9703272581100464 
2022-04-23 14:28:09,389 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 14:28:09,390 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 197.0%
2022-04-23 14:28:41,440 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.929, Acc: 0.896, Base Lr: 4.01e-03
2022-04-23 14:29:10,269 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.917, Acc: 0.903, Base Lr: 4.01e-03
2022-04-23 14:29:31,155 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.299[s] Speed: 53.4[samples/s]
2022-04-23 14:30:36,601 reid_baseline.train INFO: normal accuracy 0.7437165224557066 1.970757007598877 
2022-04-23 14:30:36,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 14:30:36,602 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 197.1%
2022-04-23 14:31:11,367 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.885, Acc: 0.913, Base Lr: 3.38e-03
2022-04-23 14:31:41,248 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.899, Acc: 0.908, Base Lr: 3.38e-03
2022-04-23 14:32:04,167 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-23 14:32:44,921 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.8899011611938477 
2022-04-23 14:33:33,604 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 14:33:33,610 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 189.0%
2022-04-23 14:34:05,511 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.917, Acc: 0.891, Base Lr: 2.77e-03
2022-04-23 14:34:36,294 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.880, Acc: 0.906, Base Lr: 2.77e-03
2022-04-23 14:34:58,397 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-23 14:35:34,608 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.8552080392837524 
2022-04-23 14:36:04,612 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 14:36:04,613 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 185.5%
2022-04-23 14:36:35,250 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.883, Acc: 0.905, Base Lr: 2.20e-03
2022-04-23 14:37:05,558 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.869, Acc: 0.912, Base Lr: 2.20e-03
2022-04-23 14:37:26,671 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-23 14:38:04,241 reid_baseline.train INFO: normal accuracy 0.7334157395962093 1.923571228981018 
2022-04-23 14:38:04,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 14:38:04,242 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 192.4%
2022-04-23 14:38:37,628 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.862, Acc: 0.904, Base Lr: 1.66e-03
2022-04-23 14:39:06,617 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.846, Acc: 0.916, Base Lr: 1.66e-03
2022-04-23 14:39:26,582 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-23 14:40:03,409 reid_baseline.train INFO: normal accuracy 0.7400082406262876 1.873563528060913 
2022-04-23 14:40:03,409 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 14:40:03,409 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 187.4%
2022-04-23 14:40:36,212 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.824, Acc: 0.929, Base Lr: 1.19e-03
2022-04-23 14:41:07,222 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.837, Acc: 0.925, Base Lr: 1.19e-03
2022-04-23 14:41:29,596 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.316[s] Speed: 50.7[samples/s]
2022-04-23 14:42:07,098 reid_baseline.train INFO: normal accuracy 0.7395962093119077 1.8823026418685913 
2022-04-23 14:42:07,105 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 14:42:07,106 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 188.2%
2022-04-23 14:42:38,032 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.839, Acc: 0.925, Base Lr: 7.78e-04
2022-04-23 14:43:08,335 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.832, Acc: 0.925, Base Lr: 7.78e-04
2022-04-23 14:43:30,361 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.305[s] Speed: 52.5[samples/s]
2022-04-23 14:44:07,067 reid_baseline.train INFO: normal accuracy 0.7408323032550473 1.8549553155899048 
2022-04-23 14:44:37,078 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 14:44:37,078 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 185.5%
2022-04-23 14:45:06,991 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.828, Acc: 0.917, Base Lr: 4.51e-04
2022-04-23 14:45:38,201 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.828, Acc: 0.919, Base Lr: 4.51e-04
2022-04-23 14:46:01,372 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.309[s] Speed: 51.9[samples/s]
2022-04-23 14:46:36,748 reid_baseline.train INFO: normal accuracy 0.7404202719406675 1.8890271186828613 
2022-04-23 14:46:36,749 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 14:46:36,749 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 188.9%
2022-04-23 14:47:08,675 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.803, Acc: 0.937, Base Lr: 2.11e-04
2022-04-23 14:47:37,824 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.808, Acc: 0.932, Base Lr: 2.11e-04
2022-04-23 14:47:57,684 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 14:48:35,386 reid_baseline.train INFO: normal accuracy 0.7400082406262876 1.8559564352035522 
2022-04-23 14:48:35,386 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 14:48:35,386 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 185.6%
2022-04-23 14:49:08,120 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.809, Acc: 0.935, Base Lr: 6.51e-05
2022-04-23 14:49:38,976 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.817, Acc: 0.926, Base Lr: 6.51e-05
2022-04-23 14:50:02,069 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.318[s] Speed: 50.4[samples/s]
2022-04-23 14:50:35,425 reid_baseline.train INFO: normal accuracy 0.7391841779975278 1.8357672691345215 
2022-04-23 14:51:16,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 14:51:16,729 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 183.6%
2022-04-23 14:51:50,164 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.804, Acc: 0.930, Base Lr: 1.60e-05
2022-04-23 14:52:21,105 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.812, Acc: 0.930, Base Lr: 1.60e-05
2022-04-23 14:52:43,277 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-23 14:53:48,154 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.8006004095077515 
2022-04-23 14:54:18,144 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 14:54:18,144 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 180.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-23 14:55:25,314 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.8006004095077515 
2022-04-23 14:55:25,314 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 14:55:25,314 reid_baseline.train INFO: Accuracy: 74.2%
2022-04-23 14:56:00,365 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.8006004095077515 
2022-04-23 14:56:00,366 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 14:56:00,374 reid_baseline.train INFO: Shuffled Accuracy: 74.2%
2022-04-23 14:56:44,963 reid_baseline.train INFO: normal accuracy 0.9562428407789233 0.7854079604148865 
2022-04-23 14:56:44,964 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 14:56:44,964 reid_baseline.train INFO: Source Clean Accuracy: 95.6%
2022-04-23 14:56:51,721 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2
2022-04-23 14:56:51,721 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-23 14:56:51,722 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 14:56:51,722 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 14:56:51,722 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 14:57:00,313 reid_baseline.train INFO: start training
2022-04-23 14:57:39,527 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.980, Acc: 0.269, Base Lr: 8.72e-04
2022-04-23 14:58:06,155 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.903, Acc: 0.370, Base Lr: 8.72e-04
2022-04-23 14:58:26,345 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-23 14:59:14,511 reid_baseline.train INFO: normal accuracy 0.5429150709619284 4.165934085845947 
2022-04-23 15:00:03,818 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 15:00:03,820 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.6%
2022-04-23 15:00:38,801 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.505, Acc: 0.546, Base Lr: 1.66e-03
2022-04-23 15:01:11,196 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.351, Acc: 0.553, Base Lr: 1.66e-03
2022-04-23 15:01:35,263 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-23 15:02:26,953 reid_baseline.train INFO: normal accuracy 0.5742284298265375 4.01294469833374 
2022-04-23 15:03:19,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 15:03:19,667 reid_baseline.train INFO: Accuracy: 57.4% Mean Entropy: 401.3%
2022-04-23 15:03:55,681 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.606, Acc: 0.600, Base Lr: 2.46e-03
2022-04-23 15:04:29,725 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.453, Acc: 0.606, Base Lr: 2.46e-03
2022-04-23 15:04:54,225 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.346[s] Speed: 46.2[samples/s]
2022-04-23 15:05:46,978 reid_baseline.train INFO: normal accuracy 0.6368551475557558 3.3417718410491943 
2022-04-23 15:06:44,821 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 15:06:44,822 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 334.2%
2022-04-23 15:07:21,776 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.861, Acc: 0.669, Base Lr: 3.25e-03
2022-04-23 15:07:55,954 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.777, Acc: 0.697, Base Lr: 3.25e-03
2022-04-23 15:08:20,374 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-23 15:09:12,017 reid_baseline.train INFO: normal accuracy 0.6997071412480288 2.6163222789764404 
2022-04-23 15:09:42,028 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 15:09:42,028 reid_baseline.train INFO: Accuracy: 70.0% Mean Entropy: 261.6%
2022-04-23 15:10:19,098 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.488, Acc: 0.762, Base Lr: 4.04e-03
2022-04-23 15:10:53,298 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.446, Acc: 0.754, Base Lr: 4.04e-03
2022-04-23 15:11:19,472 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-23 15:12:10,992 reid_baseline.train INFO: normal accuracy 0.7211083577382293 2.2639708518981934 
2022-04-23 15:12:40,982 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 15:12:40,983 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 226.4%
2022-04-23 15:13:18,372 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.278, Acc: 0.796, Base Lr: 4.83e-03
2022-04-23 15:13:55,469 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.273, Acc: 0.795, Base Lr: 4.83e-03
2022-04-23 15:14:21,184 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-23 15:15:15,698 reid_baseline.train INFO: normal accuracy 0.7350754674476233 2.025413990020752 
2022-04-23 15:15:45,649 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 15:15:45,649 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 202.5%
2022-04-23 15:16:22,479 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.181, Acc: 0.822, Base Lr: 5.62e-03
2022-04-23 15:16:56,713 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.153, Acc: 0.831, Base Lr: 5.62e-03
2022-04-23 15:17:19,462 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.344[s] Speed: 46.6[samples/s]
2022-04-23 15:18:12,668 reid_baseline.train INFO: normal accuracy 0.752872268528948 1.8989711999893188 
2022-04-23 15:18:42,694 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 15:18:42,695 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 189.9%
2022-04-23 15:19:22,145 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.075, Acc: 0.854, Base Lr: 6.42e-03
2022-04-23 15:19:57,355 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.079, Acc: 0.850, Base Lr: 6.42e-03
2022-04-23 15:20:23,326 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-04-23 15:21:13,478 reid_baseline.train INFO: normal accuracy 0.7521964406397837 1.8178948163986206 
2022-04-23 15:21:43,439 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 15:21:43,439 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 181.8%
2022-04-23 15:22:21,310 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 2.999, Acc: 0.869, Base Lr: 7.21e-03
2022-04-23 15:22:56,127 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 2.992, Acc: 0.872, Base Lr: 7.21e-03
2022-04-23 15:23:21,444 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-23 15:24:10,992 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.744675636291504 
2022-04-23 15:24:41,032 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 15:24:41,033 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 174.5%
2022-04-23 15:25:14,229 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.929, Acc: 0.896, Base Lr: 4.01e-03
2022-04-23 15:25:47,628 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.917, Acc: 0.903, Base Lr: 4.01e-03
2022-04-23 15:26:14,700 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-23 15:27:35,614 reid_baseline.train INFO: normal accuracy 0.760756927235864 1.8044813871383667 
2022-04-23 15:27:35,615 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 15:27:35,615 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 180.4%
2022-04-23 15:28:16,678 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.885, Acc: 0.913, Base Lr: 3.38e-03
2022-04-23 15:28:50,444 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.899, Acc: 0.908, Base Lr: 3.38e-03
2022-04-23 15:29:14,502 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.362[s] Speed: 44.2[samples/s]
2022-04-23 15:30:07,342 reid_baseline.train INFO: normal accuracy 0.7679657580536157 1.7173174619674683 
2022-04-23 15:30:37,339 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 15:30:37,339 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 171.7%
2022-04-23 15:31:18,470 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.917, Acc: 0.891, Base Lr: 2.77e-03
2022-04-23 15:31:56,995 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.880, Acc: 0.906, Base Lr: 2.77e-03
2022-04-23 15:32:22,360 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.385[s] Speed: 41.6[samples/s]
2022-04-23 15:33:13,984 reid_baseline.train INFO: normal accuracy 0.7684163099797252 1.6879111528396606 
2022-04-23 15:33:43,977 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 15:33:43,977 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 168.8%
2022-04-23 15:34:23,376 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.883, Acc: 0.905, Base Lr: 2.20e-03
2022-04-23 15:35:01,740 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.869, Acc: 0.912, Base Lr: 2.20e-03
2022-04-23 15:35:28,248 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.382[s] Speed: 41.9[samples/s]
2022-04-23 15:36:26,767 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.7737067937850952 
2022-04-23 15:36:26,768 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 15:36:26,769 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 177.4%
2022-04-23 15:37:03,202 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.862, Acc: 0.903, Base Lr: 1.66e-03
2022-04-23 15:37:39,958 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.846, Acc: 0.915, Base Lr: 1.66e-03
2022-04-23 15:38:07,740 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.369[s] Speed: 43.3[samples/s]
2022-04-23 15:39:02,419 reid_baseline.train INFO: normal accuracy 0.7679657580536157 1.7278450727462769 
2022-04-23 15:39:02,420 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 15:39:02,420 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 172.8%
2022-04-23 15:39:43,545 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.824, Acc: 0.929, Base Lr: 1.19e-03
2022-04-23 15:40:22,509 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.837, Acc: 0.925, Base Lr: 1.19e-03
2022-04-23 15:40:51,161 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.398[s] Speed: 40.2[samples/s]
2022-04-23 15:41:40,452 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.7280243635177612 
2022-04-23 15:41:40,454 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 15:41:40,454 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 172.8%
2022-04-23 15:42:16,426 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.839, Acc: 0.925, Base Lr: 7.78e-04
2022-04-23 15:42:50,093 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.832, Acc: 0.925, Base Lr: 7.78e-04
2022-04-23 15:43:14,683 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-23 15:44:04,157 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.6974573135375977 
2022-04-23 15:44:04,157 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 15:44:04,158 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 169.7%
2022-04-23 15:44:42,646 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.828, Acc: 0.917, Base Lr: 4.51e-04
2022-04-23 15:45:18,357 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.828, Acc: 0.919, Base Lr: 4.51e-04
2022-04-23 15:45:43,221 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.363[s] Speed: 44.1[samples/s]
2022-04-23 15:46:30,309 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.7315267324447632 
2022-04-23 15:46:30,310 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 15:46:30,310 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 173.2%
2022-04-23 15:47:07,170 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.803, Acc: 0.937, Base Lr: 2.11e-04
2022-04-23 15:47:40,570 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.808, Acc: 0.932, Base Lr: 2.11e-04
2022-04-23 15:48:05,036 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-23 15:48:57,565 reid_baseline.train INFO: normal accuracy 0.7758504167605317 1.7092251777648926 
2022-04-23 15:48:57,565 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 15:48:57,565 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 170.9%
2022-04-23 15:49:36,363 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.809, Acc: 0.935, Base Lr: 6.51e-05
2022-04-23 15:50:10,273 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.817, Acc: 0.926, Base Lr: 6.51e-05
2022-04-23 15:50:32,087 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.346[s] Speed: 46.2[samples/s]
2022-04-23 15:51:24,401 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.6719692945480347 
2022-04-23 15:51:54,407 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 15:51:54,408 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 167.2%
2022-04-23 15:52:34,050 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.804, Acc: 0.930, Base Lr: 1.60e-05
2022-04-23 15:53:12,949 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.812, Acc: 0.930, Base Lr: 1.60e-05
2022-04-23 15:53:42,075 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.394[s] Speed: 40.6[samples/s]
2022-04-23 15:55:01,988 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.6428755521774292 
2022-04-23 15:55:44,834 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 15:55:44,834 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 164.3%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-23 15:57:05,482 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.6428755521774292 
2022-04-23 15:57:05,482 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 15:57:05,482 reid_baseline.train INFO: Accuracy: 77.4%
2022-04-23 15:57:57,762 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.6428755521774292 
2022-04-23 15:57:57,763 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 15:57:57,763 reid_baseline.train INFO: Shuffled Accuracy: 77.4%
2022-04-23 15:58:50,213 reid_baseline.train INFO: normal accuracy 0.9562428407789233 0.7853261828422546 
2022-04-23 15:58:50,213 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 15:58:50,213 reid_baseline.train INFO: Source Clean Accuracy: 95.6%
2022-04-23 15:58:56,934 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2
2022-04-23 15:58:56,934 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-23 15:58:56,934 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 15:58:56,935 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 15:58:56,935 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 15:59:07,138 reid_baseline.train INFO: start training
2022-04-23 15:59:46,521 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.980, Acc: 0.271, Base Lr: 8.72e-04
2022-04-23 16:00:18,075 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.903, Acc: 0.371, Base Lr: 8.72e-04
2022-04-23 16:00:42,127 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.344[s] Speed: 46.6[samples/s]
2022-04-23 16:02:51,890 reid_baseline.train INFO: normal accuracy 0.5632315813633234 4.167189121246338 
2022-04-23 16:03:21,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 16:03:21,801 reid_baseline.train INFO: Accuracy: 56.3% Mean Entropy: 416.7%
2022-04-23 16:04:02,198 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.505, Acc: 0.546, Base Lr: 1.66e-03
2022-04-23 16:04:35,545 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.351, Acc: 0.553, Base Lr: 1.66e-03
2022-04-23 16:05:03,793 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-23 16:07:25,851 reid_baseline.train INFO: normal accuracy 0.5960523295845765 4.0331525802612305 
2022-04-23 16:07:55,847 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 16:07:55,847 reid_baseline.train INFO: Accuracy: 59.6% Mean Entropy: 403.3%
2022-04-23 16:08:36,751 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.606, Acc: 0.601, Base Lr: 2.46e-03
2022-04-23 16:09:09,974 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.453, Acc: 0.606, Base Lr: 2.46e-03
2022-04-23 16:09:36,941 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.370[s] Speed: 43.2[samples/s]
2022-04-23 16:11:52,013 reid_baseline.train INFO: normal accuracy 0.6653660775763139 3.396629571914673 
2022-04-23 16:12:22,024 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 16:12:22,025 reid_baseline.train INFO: Accuracy: 66.5% Mean Entropy: 339.7%
2022-04-23 16:12:59,787 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.861, Acc: 0.669, Base Lr: 3.25e-03
2022-04-23 16:13:35,190 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.777, Acc: 0.697, Base Lr: 3.25e-03
2022-04-23 16:14:03,838 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-04-23 16:16:15,597 reid_baseline.train INFO: normal accuracy 0.72802386963507 2.668186902999878 
2022-04-23 16:16:45,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 16:16:45,579 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 266.8%
2022-04-23 16:17:26,091 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.488, Acc: 0.762, Base Lr: 4.04e-03
2022-04-23 16:18:01,412 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.446, Acc: 0.754, Base Lr: 4.04e-03
2022-04-23 16:18:23,923 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.360[s] Speed: 44.4[samples/s]
2022-04-23 16:20:28,938 reid_baseline.train INFO: normal accuracy 0.7555657562543034 2.3271195888519287 
2022-04-23 16:20:58,894 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 16:20:58,895 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 232.7%
2022-04-23 16:21:38,130 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.278, Acc: 0.796, Base Lr: 4.83e-03
2022-04-23 16:22:15,222 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.273, Acc: 0.795, Base Lr: 4.83e-03
2022-04-23 16:22:39,681 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.369[s] Speed: 43.3[samples/s]
2022-04-23 16:24:55,269 reid_baseline.train INFO: normal accuracy 0.7704842781730549 2.0818676948547363 
2022-04-23 16:25:25,244 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 16:25:25,245 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 208.2%
2022-04-23 16:26:06,063 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.181, Acc: 0.821, Base Lr: 5.62e-03
2022-04-23 16:26:42,727 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.153, Acc: 0.831, Base Lr: 5.62e-03
2022-04-23 16:27:07,189 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-04-23 16:29:09,870 reid_baseline.train INFO: normal accuracy 0.778287812715171 1.9556756019592285 
2022-04-23 16:29:39,951 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 16:29:39,951 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 195.6%
2022-04-23 16:30:22,299 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.075, Acc: 0.853, Base Lr: 6.42e-03
2022-04-23 16:30:59,307 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.079, Acc: 0.849, Base Lr: 6.42e-03
2022-04-23 16:31:25,725 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.387[s] Speed: 41.3[samples/s]
2022-04-23 16:33:38,134 reid_baseline.train INFO: normal accuracy 0.7817305485425752 1.8378796577453613 
2022-04-23 16:34:08,174 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 16:34:08,174 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 183.8%
2022-04-23 16:34:51,825 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 2.999, Acc: 0.869, Base Lr: 7.21e-03
2022-04-23 16:35:31,914 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 2.992, Acc: 0.872, Base Lr: 7.21e-03
2022-04-23 16:36:00,587 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.412[s] Speed: 38.9[samples/s]
2022-04-23 16:38:18,295 reid_baseline.train INFO: normal accuracy 0.7860913472572871 1.7721912860870361 
2022-04-23 16:38:48,303 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 16:38:48,303 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 177.2%
2022-04-23 16:39:30,383 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.929, Acc: 0.896, Base Lr: 4.01e-03
2022-04-23 16:40:05,648 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.917, Acc: 0.903, Base Lr: 4.01e-03
2022-04-23 16:40:32,901 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-04-23 16:43:11,160 reid_baseline.train INFO: normal accuracy 0.7870094101445949 1.8071964979171753 
2022-04-23 16:43:11,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 16:43:11,163 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 180.7%
2022-04-23 16:43:47,553 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.885, Acc: 0.913, Base Lr: 3.38e-03
2022-04-23 16:44:20,847 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.899, Acc: 0.908, Base Lr: 3.38e-03
2022-04-23 16:44:46,455 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-04-23 16:46:57,823 reid_baseline.train INFO: normal accuracy 0.7881569887537296 1.73338782787323 
2022-04-23 16:47:27,797 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 16:47:27,798 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 173.3%
2022-04-23 16:48:05,346 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.917, Acc: 0.891, Base Lr: 2.77e-03
2022-04-23 16:48:40,323 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.880, Acc: 0.906, Base Lr: 2.77e-03
2022-04-23 16:49:05,923 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.359[s] Speed: 44.5[samples/s]
2022-04-23 16:51:17,862 reid_baseline.train INFO: normal accuracy 0.7876979573100757 1.6993478536605835 
2022-04-23 16:51:47,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 16:51:47,853 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 169.9%
2022-04-23 16:52:25,987 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.883, Acc: 0.905, Base Lr: 2.20e-03
2022-04-23 16:53:00,885 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.869, Acc: 0.912, Base Lr: 2.20e-03
2022-04-23 16:53:24,715 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.355[s] Speed: 45.1[samples/s]
2022-04-23 16:55:39,057 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.775244951248169 
2022-04-23 16:55:39,060 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 16:55:39,061 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 177.5%
2022-04-23 16:56:16,627 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.862, Acc: 0.904, Base Lr: 1.66e-03
2022-04-23 16:56:52,480 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.846, Acc: 0.916, Base Lr: 1.66e-03
2022-04-23 16:57:19,396 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-23 16:59:25,128 reid_baseline.train INFO: normal accuracy 0.7893045673628644 1.7248293161392212 
2022-04-23 16:59:25,129 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 16:59:25,129 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 172.5%
2022-04-23 17:00:03,329 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.824, Acc: 0.929, Base Lr: 1.19e-03
2022-04-23 17:00:38,777 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.837, Acc: 0.925, Base Lr: 1.19e-03
2022-04-23 17:01:02,127 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.355[s] Speed: 45.0[samples/s]
2022-04-23 17:03:16,452 reid_baseline.train INFO: normal accuracy 0.786779894422768 1.7379324436187744 
2022-04-23 17:03:16,457 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 17:03:16,457 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 173.8%
2022-04-23 17:03:58,936 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.839, Acc: 0.925, Base Lr: 7.78e-04
2022-04-23 17:04:37,905 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.832, Acc: 0.925, Base Lr: 7.78e-04
2022-04-23 17:05:06,880 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.403[s] Speed: 39.7[samples/s]
2022-04-23 17:07:25,196 reid_baseline.train INFO: normal accuracy 0.790911177415653 1.7070859670639038 
2022-04-23 17:07:25,197 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 17:07:25,197 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 170.7%
2022-04-23 17:08:04,706 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.828, Acc: 0.917, Base Lr: 4.51e-04
2022-04-23 17:08:42,963 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.828, Acc: 0.919, Base Lr: 4.51e-04
2022-04-23 17:09:12,404 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.392[s] Speed: 40.8[samples/s]
2022-04-23 17:11:34,181 reid_baseline.train INFO: normal accuracy 0.7927473031902685 1.7445178031921387 
2022-04-23 17:11:34,181 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 17:11:34,181 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 174.5%
2022-04-23 17:12:16,497 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.803, Acc: 0.937, Base Lr: 2.11e-04
2022-04-23 17:12:53,091 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.808, Acc: 0.932, Base Lr: 2.11e-04
2022-04-23 17:13:20,016 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.388[s] Speed: 41.3[samples/s]
2022-04-23 17:15:28,803 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.7221999168395996 
2022-04-23 17:15:28,806 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 17:15:28,808 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 172.2%
2022-04-23 17:16:06,304 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.809, Acc: 0.935, Base Lr: 6.51e-05
2022-04-23 17:16:41,632 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.817, Acc: 0.926, Base Lr: 6.51e-05
2022-04-23 17:17:04,073 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-04-23 17:19:07,201 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.6870887279510498 
2022-04-23 17:19:37,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 17:19:37,173 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 168.7%
2022-04-23 17:20:11,810 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.804, Acc: 0.930, Base Lr: 1.60e-05
2022-04-23 17:20:46,821 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.812, Acc: 0.929, Base Lr: 1.60e-05
2022-04-23 17:21:12,041 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-23 17:23:49,480 reid_baseline.train INFO: normal accuracy 0.7920587560247877 1.6529093980789185 
2022-04-23 17:24:19,439 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 17:24:19,440 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 165.3%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-23 17:26:55,146 reid_baseline.train INFO: normal accuracy 0.7920587560247877 1.6529093980789185 
2022-04-23 17:26:55,146 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 17:26:55,147 reid_baseline.train INFO: Accuracy: 79.2%
2022-04-23 17:29:00,392 reid_baseline.train INFO: normal accuracy 0.7920587560247877 1.6529093980789185 
2022-04-23 17:29:00,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 17:29:00,394 reid_baseline.train INFO: Shuffled Accuracy: 79.2%
2022-04-23 17:29:49,060 reid_baseline.train INFO: normal accuracy 0.9562428407789233 0.7853866219520569 
2022-04-23 17:29:49,060 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 17:29:49,061 reid_baseline.train INFO: Source Clean Accuracy: 95.6%
2022-04-23 17:29:55,848 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3
2022-04-23 17:29:55,849 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-23 17:29:55,849 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 17:29:55,849 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 17:29:55,850 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 17:30:06,120 reid_baseline.train INFO: start training
2022-04-23 17:30:49,890 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.992, Acc: 0.250, Base Lr: 8.72e-04
2022-04-23 17:31:25,174 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.930, Acc: 0.359, Base Lr: 8.72e-04
2022-04-23 17:31:50,715 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.378[s] Speed: 42.4[samples/s]
2022-04-23 17:32:26,859 reid_baseline.train INFO: normal accuracy 0.5010300782859497 4.169129848480225 
2022-04-23 17:32:56,756 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 17:32:56,757 reid_baseline.train INFO: Accuracy: 50.1% Mean Entropy: 416.9%
2022-04-23 17:33:33,239 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.567, Acc: 0.545, Base Lr: 1.66e-03
2022-04-23 17:34:05,641 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.423, Acc: 0.552, Base Lr: 1.66e-03
2022-04-23 17:34:32,132 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.349[s] Speed: 45.8[samples/s]
2022-04-23 17:35:10,184 reid_baseline.train INFO: normal accuracy 0.5339925834363412 4.091787338256836 
2022-04-23 17:35:44,564 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 17:35:44,565 reid_baseline.train INFO: Accuracy: 53.4% Mean Entropy: 409.2%
2022-04-23 17:36:22,141 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.740, Acc: 0.587, Base Lr: 2.46e-03
2022-04-23 17:36:57,118 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.580, Acc: 0.592, Base Lr: 2.46e-03
2022-04-23 17:37:20,917 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.353[s] Speed: 45.4[samples/s]
2022-04-23 17:37:59,471 reid_baseline.train INFO: normal accuracy 0.6048619695096827 3.6462721824645996 
2022-04-23 17:38:43,361 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 17:38:43,368 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 364.6%
2022-04-23 17:39:19,487 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.953, Acc: 0.663, Base Lr: 3.25e-03
2022-04-23 17:39:53,876 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.854, Acc: 0.690, Base Lr: 3.25e-03
2022-04-23 17:40:19,399 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.352[s] Speed: 45.5[samples/s]
2022-04-23 17:40:58,646 reid_baseline.train INFO: normal accuracy 0.6711990111248455 3.0028202533721924 
2022-04-23 17:41:28,626 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 17:41:28,627 reid_baseline.train INFO: Accuracy: 67.1% Mean Entropy: 300.3%
2022-04-23 17:42:03,342 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.547, Acc: 0.752, Base Lr: 4.04e-03
2022-04-23 17:42:38,434 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.504, Acc: 0.744, Base Lr: 4.04e-03
2022-04-23 17:43:04,307 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-23 17:43:42,601 reid_baseline.train INFO: normal accuracy 0.6967449526163988 2.6321237087249756 
2022-04-23 17:44:12,642 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 17:44:12,643 reid_baseline.train INFO: Accuracy: 69.7% Mean Entropy: 263.2%
2022-04-23 17:44:46,472 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.313, Acc: 0.792, Base Lr: 4.83e-03
2022-04-23 17:45:20,812 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.309, Acc: 0.789, Base Lr: 4.83e-03
2022-04-23 17:45:45,460 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.340[s] Speed: 47.1[samples/s]
2022-04-23 17:46:24,673 reid_baseline.train INFO: normal accuracy 0.7218788627935723 2.402217388153076 
2022-04-23 17:46:54,669 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 17:46:54,670 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 240.2%
2022-04-23 17:47:31,814 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.212, Acc: 0.812, Base Lr: 5.62e-03
2022-04-23 17:48:06,524 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.176, Acc: 0.824, Base Lr: 5.62e-03
2022-04-23 17:48:31,582 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.355[s] Speed: 45.1[samples/s]
2022-04-23 17:49:12,572 reid_baseline.train INFO: normal accuracy 0.7218788627935723 2.212510585784912 
2022-04-23 17:49:42,528 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 17:49:42,528 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 221.3%
2022-04-23 17:50:20,452 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.097, Acc: 0.844, Base Lr: 6.42e-03
2022-04-23 17:50:54,688 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.099, Acc: 0.843, Base Lr: 6.42e-03
2022-04-23 17:51:20,191 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.358[s] Speed: 44.7[samples/s]
2022-04-23 17:51:59,604 reid_baseline.train INFO: normal accuracy 0.738772146683148 2.0818324089050293 
2022-04-23 17:52:29,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 17:52:29,599 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 208.2%
2022-04-23 17:53:05,082 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.018, Acc: 0.863, Base Lr: 7.21e-03
2022-04-23 17:53:38,117 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.011, Acc: 0.866, Base Lr: 7.21e-03
2022-04-23 17:54:03,248 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-23 17:54:44,697 reid_baseline.train INFO: normal accuracy 0.7292954264524104 2.0318233966827393 
2022-04-23 17:55:32,045 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 17:55:32,053 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 203.2%
2022-04-23 17:56:09,982 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.943, Acc: 0.884, Base Lr: 4.01e-03
2022-04-23 17:56:46,839 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.939, Acc: 0.893, Base Lr: 4.01e-03
2022-04-23 17:57:14,032 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-23 17:58:27,276 reid_baseline.train INFO: normal accuracy 0.73053152039555 2.005561113357544 
2022-04-23 17:58:57,275 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 17:58:57,276 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 200.6%
2022-04-23 17:59:36,385 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.901, Acc: 0.902, Base Lr: 3.38e-03
2022-04-23 18:00:12,638 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.918, Acc: 0.897, Base Lr: 3.38e-03
2022-04-23 18:00:39,985 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.376[s] Speed: 42.5[samples/s]
2022-04-23 18:01:21,698 reid_baseline.train INFO: normal accuracy 0.7391841779975278 1.9184871912002563 
2022-04-23 18:01:51,692 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 18:01:51,692 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 191.8%
2022-04-23 18:02:30,872 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.945, Acc: 0.887, Base Lr: 2.77e-03
2022-04-23 18:03:05,157 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.900, Acc: 0.901, Base Lr: 2.77e-03
2022-04-23 18:03:29,635 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-23 18:04:06,325 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.8879402875900269 
2022-04-23 18:04:36,293 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 18:04:36,294 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 188.8%
2022-04-23 18:05:13,366 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.894, Acc: 0.898, Base Lr: 2.20e-03
2022-04-23 18:05:47,171 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.883, Acc: 0.906, Base Lr: 2.20e-03
2022-04-23 18:06:09,347 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-23 18:06:50,344 reid_baseline.train INFO: normal accuracy 0.7404202719406675 1.9511348009109497 
2022-04-23 18:06:50,345 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 18:06:50,346 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 195.1%
2022-04-23 18:07:23,477 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.879, Acc: 0.898, Base Lr: 1.66e-03
2022-04-23 18:07:54,887 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.863, Acc: 0.911, Base Lr: 1.66e-03
2022-04-23 18:08:20,584 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-23 18:09:01,208 reid_baseline.train INFO: normal accuracy 0.7445405850844664 1.9114333391189575 
2022-04-23 18:09:01,209 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 18:09:01,209 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 191.1%
2022-04-23 18:09:39,417 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.832, Acc: 0.926, Base Lr: 1.19e-03
2022-04-23 18:10:14,313 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.844, Acc: 0.920, Base Lr: 1.19e-03
2022-04-23 18:10:38,472 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.356[s] Speed: 45.0[samples/s]
2022-04-23 18:11:19,352 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.9034937620162964 
2022-04-23 18:11:19,352 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 18:11:19,352 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 190.3%
2022-04-23 18:11:56,679 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.854, Acc: 0.921, Base Lr: 7.78e-04
2022-04-23 18:12:30,425 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.843, Acc: 0.919, Base Lr: 7.78e-04
2022-04-23 18:12:57,376 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-23 18:13:34,824 reid_baseline.train INFO: normal accuracy 0.7433044911413268 1.8872506618499756 
2022-04-23 18:14:14,570 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 18:14:14,571 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 188.7%
2022-04-23 18:14:51,541 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.839, Acc: 0.917, Base Lr: 4.51e-04
2022-04-23 18:15:25,585 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.833, Acc: 0.917, Base Lr: 4.51e-04
2022-04-23 18:15:49,897 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.349[s] Speed: 45.8[samples/s]
2022-04-23 18:16:29,789 reid_baseline.train INFO: normal accuracy 0.7437165224557066 1.909062147140503 
2022-04-23 18:16:29,790 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 18:16:29,790 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 190.9%
2022-04-23 18:17:03,228 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.815, Acc: 0.926, Base Lr: 2.11e-04
2022-04-23 18:17:37,265 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.818, Acc: 0.923, Base Lr: 2.11e-04
2022-04-23 18:18:01,969 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.337[s] Speed: 47.4[samples/s]
2022-04-23 18:18:41,506 reid_baseline.train INFO: normal accuracy 0.746188710341986 1.8859604597091675 
2022-04-23 18:19:11,492 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 18:19:11,493 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 188.6%
2022-04-23 18:19:48,975 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.816, Acc: 0.926, Base Lr: 6.51e-05
2022-04-23 18:20:20,995 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.822, Acc: 0.921, Base Lr: 6.51e-05
2022-04-23 18:20:44,957 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.342[s] Speed: 46.7[samples/s]
2022-04-23 18:21:23,730 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.8671685457229614 
2022-04-23 18:21:53,722 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 18:21:53,722 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 186.7%
2022-04-23 18:22:30,149 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.811, Acc: 0.927, Base Lr: 1.60e-05
2022-04-23 18:23:04,281 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.818, Acc: 0.922, Base Lr: 1.60e-05
2022-04-23 18:23:27,470 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-23 18:24:37,190 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.829931616783142 
2022-04-23 18:25:07,198 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 18:25:07,198 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 183.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-23 18:26:15,801 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.829931616783142 
2022-04-23 18:26:15,804 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 18:26:15,804 reid_baseline.train INFO: Accuracy: 74.3%
2022-04-23 18:26:53,658 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.829931616783142 
2022-04-23 18:26:53,658 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 18:26:53,658 reid_baseline.train INFO: Shuffled Accuracy: 74.3%
2022-04-23 18:27:43,248 reid_baseline.train INFO: normal accuracy 0.9532646048109966 0.8126572370529175 
2022-04-23 18:27:43,249 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 18:27:43,249 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-23 18:27:49,918 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3
2022-04-23 18:27:49,919 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-23 18:27:49,919 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 18:27:49,919 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 18:27:49,920 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 18:28:00,684 reid_baseline.train INFO: start training
2022-04-23 18:28:45,943 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.992, Acc: 0.250, Base Lr: 8.72e-04
2022-04-23 18:29:20,326 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.930, Acc: 0.359, Base Lr: 8.72e-04
2022-04-23 18:29:43,934 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.375[s] Speed: 42.7[samples/s]
2022-04-23 18:30:36,044 reid_baseline.train INFO: normal accuracy 0.5413381392205452 4.167730331420898 
2022-04-23 18:31:05,964 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 18:31:05,964 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 416.8%
2022-04-23 18:31:44,151 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.567, Acc: 0.545, Base Lr: 1.66e-03
2022-04-23 18:32:19,610 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.423, Acc: 0.552, Base Lr: 1.66e-03
2022-04-23 18:32:43,403 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-23 18:33:33,236 reid_baseline.train INFO: normal accuracy 0.5690470826762785 4.060264587402344 
2022-04-23 18:34:03,239 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 18:34:03,240 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 406.0%
2022-04-23 18:34:40,952 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.740, Acc: 0.587, Base Lr: 2.46e-03
2022-04-23 18:35:17,285 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.580, Acc: 0.592, Base Lr: 2.46e-03
2022-04-23 18:35:42,358 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.363[s] Speed: 44.1[samples/s]
2022-04-23 18:36:31,709 reid_baseline.train INFO: normal accuracy 0.6208605541788691 3.4713027477264404 
2022-04-23 18:37:01,692 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 18:37:01,692 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 347.1%
2022-04-23 18:37:38,167 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.953, Acc: 0.664, Base Lr: 3.25e-03
2022-04-23 18:38:13,536 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.854, Acc: 0.690, Base Lr: 3.25e-03
2022-04-23 18:38:40,080 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.360[s] Speed: 44.4[samples/s]
2022-04-23 18:39:27,883 reid_baseline.train INFO: normal accuracy 0.6850642036494706 2.7440850734710693 
2022-04-23 18:39:57,876 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 18:39:57,876 reid_baseline.train INFO: Accuracy: 68.5% Mean Entropy: 274.4%
2022-04-23 18:40:34,723 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.547, Acc: 0.753, Base Lr: 4.04e-03
2022-04-23 18:41:07,997 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.504, Acc: 0.745, Base Lr: 4.04e-03
2022-04-23 18:41:30,579 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.339[s] Speed: 47.3[samples/s]
2022-04-23 18:42:22,709 reid_baseline.train INFO: normal accuracy 0.7109709394007659 2.321394920349121 
2022-04-23 18:43:22,280 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 18:43:22,280 reid_baseline.train INFO: Accuracy: 71.1% Mean Entropy: 232.1%
2022-04-23 18:43:59,114 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.313, Acc: 0.792, Base Lr: 4.83e-03
2022-04-23 18:44:35,522 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.309, Acc: 0.789, Base Lr: 4.83e-03
2022-04-23 18:45:02,749 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.368[s] Speed: 43.5[samples/s]
2022-04-23 18:46:00,905 reid_baseline.train INFO: normal accuracy 0.7267402568145979 2.1091127395629883 
2022-04-23 18:46:52,404 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 18:46:52,408 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 210.9%
2022-04-23 18:47:30,721 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.212, Acc: 0.812, Base Lr: 5.62e-03
2022-04-23 18:48:07,595 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.176, Acc: 0.824, Base Lr: 5.62e-03
2022-04-23 18:48:34,390 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-23 18:49:29,120 reid_baseline.train INFO: normal accuracy 0.7427348501914846 1.9203733205795288 
2022-04-23 18:49:59,139 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 18:49:59,139 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 192.0%
2022-04-23 18:50:37,027 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.097, Acc: 0.844, Base Lr: 6.42e-03
2022-04-23 18:51:10,707 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.099, Acc: 0.843, Base Lr: 6.42e-03
2022-04-23 18:51:35,326 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.352[s] Speed: 45.4[samples/s]
2022-04-23 18:52:26,591 reid_baseline.train INFO: normal accuracy 0.7472403694525794 1.866401195526123 
2022-04-23 18:52:56,584 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 18:52:56,585 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 186.6%
2022-04-23 18:53:33,591 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.018, Acc: 0.862, Base Lr: 7.21e-03
2022-04-23 18:54:08,544 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.011, Acc: 0.865, Base Lr: 7.21e-03
2022-04-23 18:54:34,279 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.358[s] Speed: 44.7[samples/s]
2022-04-23 18:55:25,187 reid_baseline.train INFO: normal accuracy 0.7535480964181122 1.796505331993103 
2022-04-23 18:55:55,156 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 18:55:55,156 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 179.7%
2022-04-23 18:56:31,311 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.943, Acc: 0.884, Base Lr: 4.01e-03
2022-04-23 18:57:05,162 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.939, Acc: 0.893, Base Lr: 4.01e-03
2022-04-23 18:57:31,785 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-23 18:58:51,264 reid_baseline.train INFO: normal accuracy 0.7560261320117143 1.8130308389663696 
2022-04-23 18:58:51,265 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 18:58:51,265 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 181.3%
2022-04-23 18:59:28,062 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.901, Acc: 0.902, Base Lr: 3.38e-03
2022-04-23 19:00:03,187 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.918, Acc: 0.897, Base Lr: 3.38e-03
2022-04-23 19:00:28,660 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.357[s] Speed: 44.9[samples/s]
2022-04-23 19:01:16,565 reid_baseline.train INFO: normal accuracy 0.7616580310880829 1.7295032739639282 
2022-04-23 19:01:46,554 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 19:01:46,554 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 173.0%
2022-04-23 19:02:23,621 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.945, Acc: 0.887, Base Lr: 2.77e-03
2022-04-23 19:02:58,153 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.900, Acc: 0.901, Base Lr: 2.77e-03
2022-04-23 19:03:25,064 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.361[s] Speed: 44.4[samples/s]
2022-04-23 19:04:13,999 reid_baseline.train INFO: normal accuracy 0.7639107907186303 1.7005794048309326 
2022-04-23 19:04:43,992 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 19:04:43,992 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 170.1%
2022-04-23 19:05:22,419 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.894, Acc: 0.898, Base Lr: 2.20e-03
2022-04-23 19:05:59,765 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.883, Acc: 0.906, Base Lr: 2.20e-03
2022-04-23 19:06:23,433 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.364[s] Speed: 43.9[samples/s]
2022-04-23 19:07:16,468 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.773131251335144 
2022-04-23 19:07:16,469 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 19:07:16,469 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 177.3%
2022-04-23 19:07:52,310 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.879, Acc: 0.898, Base Lr: 1.66e-03
2022-04-23 19:08:27,147 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.863, Acc: 0.910, Base Lr: 1.66e-03
2022-04-23 19:08:52,776 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.353[s] Speed: 45.4[samples/s]
2022-04-23 19:09:42,007 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.7365105152130127 
2022-04-23 19:09:42,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 19:09:42,008 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 173.7%
2022-04-23 19:10:16,589 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.832, Acc: 0.927, Base Lr: 1.19e-03
2022-04-23 19:10:51,543 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.844, Acc: 0.920, Base Lr: 1.19e-03
2022-04-23 19:11:15,743 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-23 19:12:05,922 reid_baseline.train INFO: normal accuracy 0.7672899301644515 1.7426648139953613 
2022-04-23 19:12:05,923 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 19:12:05,923 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 174.3%
2022-04-23 19:12:43,057 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.854, Acc: 0.920, Base Lr: 7.78e-04
2022-04-23 19:13:14,829 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.843, Acc: 0.918, Base Lr: 7.78e-04
2022-04-23 19:13:38,307 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-23 19:14:28,718 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.723804235458374 
2022-04-23 19:14:28,719 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 19:14:28,719 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 172.4%
2022-04-23 19:15:08,103 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.839, Acc: 0.917, Base Lr: 4.51e-04
2022-04-23 19:15:43,652 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.833, Acc: 0.917, Base Lr: 4.51e-04
2022-04-23 19:16:08,414 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-23 19:16:56,971 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7459864616394043 
2022-04-23 19:16:56,977 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 19:16:56,978 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 174.6%
2022-04-23 19:17:33,773 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.815, Acc: 0.927, Base Lr: 2.11e-04
2022-04-23 19:18:07,612 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.818, Acc: 0.924, Base Lr: 2.11e-04
2022-04-23 19:18:31,666 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-23 19:19:24,749 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.732421875 
2022-04-23 19:19:24,749 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 19:19:24,750 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 173.2%
2022-04-23 19:20:05,907 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.816, Acc: 0.926, Base Lr: 6.51e-05
2022-04-23 19:20:40,057 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.822, Acc: 0.921, Base Lr: 6.51e-05
2022-04-23 19:21:02,506 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.358[s] Speed: 44.7[samples/s]
2022-04-23 19:21:53,178 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.6969186067581177 
2022-04-23 19:22:23,259 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 19:22:23,260 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 169.7%
2022-04-23 19:23:00,859 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.811, Acc: 0.927, Base Lr: 1.60e-05
2022-04-23 19:23:37,818 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.818, Acc: 0.922, Base Lr: 1.60e-05
2022-04-23 19:24:04,876 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-23 19:25:21,640 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.6649655103683472 
2022-04-23 19:26:00,230 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 19:26:00,230 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 166.5%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-23 19:27:21,983 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.6649655103683472 
2022-04-23 19:27:21,984 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 19:27:21,985 reid_baseline.train INFO: Accuracy: 77.1%
2022-04-23 19:28:13,202 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.6649655103683472 
2022-04-23 19:28:13,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 19:28:13,203 reid_baseline.train INFO: Shuffled Accuracy: 77.1%
2022-04-23 19:29:07,254 reid_baseline.train INFO: normal accuracy 0.9532646048109966 0.8126549124717712 
2022-04-23 19:29:07,255 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 19:29:07,255 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-23 19:29:15,132 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3
2022-04-23 19:29:15,133 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-23 19:29:15,133 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 19:29:15,133 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 19:29:15,133 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 19:29:26,415 reid_baseline.train INFO: start training
2022-04-23 19:30:05,847 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.992, Acc: 0.250, Base Lr: 8.72e-04
2022-04-23 19:30:40,531 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.930, Acc: 0.360, Base Lr: 8.72e-04
2022-04-23 19:31:04,818 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-23 19:33:32,357 reid_baseline.train INFO: normal accuracy 0.5627725499196695 4.1686625480651855 
2022-04-23 19:34:02,430 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 19:34:02,430 reid_baseline.train INFO: Accuracy: 56.3% Mean Entropy: 416.9%
2022-04-23 19:34:36,867 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.567, Acc: 0.545, Base Lr: 1.66e-03
2022-04-23 19:35:10,469 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.423, Acc: 0.552, Base Lr: 1.66e-03
2022-04-23 19:35:37,042 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.347[s] Speed: 46.2[samples/s]
2022-04-23 19:37:58,665 reid_baseline.train INFO: normal accuracy 0.5882487950424604 4.075571060180664 
2022-04-23 19:38:28,662 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 19:38:28,663 reid_baseline.train INFO: Accuracy: 58.8% Mean Entropy: 407.6%
2022-04-23 19:39:00,896 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.740, Acc: 0.587, Base Lr: 2.46e-03
2022-04-23 19:39:32,350 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.580, Acc: 0.592, Base Lr: 2.46e-03
2022-04-23 19:39:56,176 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-23 19:42:13,918 reid_baseline.train INFO: normal accuracy 0.6472343355519853 3.522846221923828 
2022-04-23 19:42:43,901 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 19:42:43,902 reid_baseline.train INFO: Accuracy: 64.7% Mean Entropy: 352.3%
2022-04-23 19:43:19,263 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.953, Acc: 0.664, Base Lr: 3.25e-03
2022-04-23 19:43:48,663 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.854, Acc: 0.690, Base Lr: 3.25e-03
2022-04-23 19:44:12,058 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.323[s] Speed: 49.6[samples/s]
2022-04-23 19:46:15,421 reid_baseline.train INFO: normal accuracy 0.7165480835437228 2.7942211627960205 
2022-04-23 19:46:45,412 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 19:46:45,413 reid_baseline.train INFO: Accuracy: 71.7% Mean Entropy: 279.4%
2022-04-23 19:47:21,344 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.547, Acc: 0.752, Base Lr: 4.04e-03
2022-04-23 19:47:51,358 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.504, Acc: 0.745, Base Lr: 4.04e-03
2022-04-23 19:48:15,533 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-23 19:50:21,221 reid_baseline.train INFO: normal accuracy 0.745008033050264 2.3831946849823 
2022-04-23 19:50:51,188 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 19:50:51,189 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 238.3%
2022-04-23 19:51:26,194 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.313, Acc: 0.792, Base Lr: 4.83e-03
2022-04-23 19:51:57,402 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.309, Acc: 0.789, Base Lr: 4.83e-03
2022-04-23 19:52:20,648 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-23 19:54:34,801 reid_baseline.train INFO: normal accuracy 0.7670415423456507 2.1670286655426025 
2022-04-23 19:55:04,787 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 19:55:04,788 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 216.7%
2022-04-23 19:55:39,497 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.212, Acc: 0.812, Base Lr: 5.62e-03
2022-04-23 19:56:10,125 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.176, Acc: 0.823, Base Lr: 5.62e-03
2022-04-23 19:56:32,430 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-23 19:58:32,181 reid_baseline.train INFO: normal accuracy 0.7695662152857471 1.983089804649353 
2022-04-23 19:59:02,179 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 19:59:02,180 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 198.3%
2022-04-23 19:59:40,261 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.097, Acc: 0.845, Base Lr: 6.42e-03
2022-04-23 20:00:13,174 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.099, Acc: 0.843, Base Lr: 6.42e-03
2022-04-23 20:00:34,548 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-23 20:02:31,306 reid_baseline.train INFO: normal accuracy 0.778287812715171 1.8870203495025635 
2022-04-23 20:03:01,276 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 20:03:01,276 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 188.7%
2022-04-23 20:03:37,923 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.018, Acc: 0.862, Base Lr: 7.21e-03
2022-04-23 20:04:10,843 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.011, Acc: 0.865, Base Lr: 7.21e-03
2022-04-23 20:04:32,751 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-23 20:06:32,770 reid_baseline.train INFO: normal accuracy 0.7831076428735368 1.82693612575531 
2022-04-23 20:07:02,755 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 20:07:02,756 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 182.7%
2022-04-23 20:07:38,316 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.942, Acc: 0.884, Base Lr: 4.01e-03
2022-04-23 20:08:11,634 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.939, Acc: 0.894, Base Lr: 4.01e-03
2022-04-23 20:08:34,547 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.336[s] Speed: 47.6[samples/s]
2022-04-23 20:11:23,769 reid_baseline.train INFO: normal accuracy 0.7803534542116135 1.8336989879608154 
2022-04-23 20:11:23,769 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 20:11:23,769 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 183.4%
2022-04-23 20:11:59,487 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.901, Acc: 0.902, Base Lr: 3.38e-03
2022-04-23 20:12:33,082 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.918, Acc: 0.897, Base Lr: 3.38e-03
2022-04-23 20:12:58,001 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-23 20:15:01,926 reid_baseline.train INFO: normal accuracy 0.7858618315354602 1.7472268342971802 
2022-04-23 20:15:31,913 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 20:15:31,913 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 174.7%
2022-04-23 20:16:07,928 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.945, Acc: 0.887, Base Lr: 2.77e-03
2022-04-23 20:16:40,804 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.900, Acc: 0.901, Base Lr: 2.77e-03
2022-04-23 20:17:03,282 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-23 20:19:15,255 reid_baseline.train INFO: normal accuracy 0.7842552214826716 1.7204546928405762 
2022-04-23 20:19:45,241 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 20:19:45,242 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 172.0%
2022-04-23 20:20:23,857 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.894, Acc: 0.899, Base Lr: 2.20e-03
2022-04-23 20:20:56,903 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.883, Acc: 0.906, Base Lr: 2.20e-03
2022-04-23 20:21:21,213 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.352[s] Speed: 45.5[samples/s]
2022-04-23 20:23:33,276 reid_baseline.train INFO: normal accuracy 0.7870094101445949 1.793485403060913 
2022-04-23 20:23:33,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 20:23:33,278 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 179.3%
2022-04-23 20:24:09,841 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.879, Acc: 0.898, Base Lr: 1.66e-03
2022-04-23 20:24:42,274 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.863, Acc: 0.911, Base Lr: 1.66e-03
2022-04-23 20:25:05,798 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-23 20:27:11,040 reid_baseline.train INFO: normal accuracy 0.7842552214826716 1.750346302986145 
2022-04-23 20:27:11,041 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 20:27:11,041 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 175.0%
2022-04-23 20:27:49,351 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.832, Acc: 0.926, Base Lr: 1.19e-03
2022-04-23 20:28:25,481 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.844, Acc: 0.920, Base Lr: 1.19e-03
2022-04-23 20:28:49,067 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-23 20:30:56,094 reid_baseline.train INFO: normal accuracy 0.7810420013770943 1.754858136177063 
2022-04-23 20:30:56,095 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 20:30:56,095 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 175.5%
2022-04-23 20:31:34,689 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.854, Acc: 0.920, Base Lr: 7.78e-04
2022-04-23 20:32:10,894 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.843, Acc: 0.918, Base Lr: 7.78e-04
2022-04-23 20:32:35,764 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-23 20:34:39,925 reid_baseline.train INFO: normal accuracy 0.7863208629791141 1.7333744764328003 
2022-04-23 20:34:39,927 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 20:34:39,927 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 173.3%
2022-04-23 20:35:18,462 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.839, Acc: 0.917, Base Lr: 4.51e-04
2022-04-23 20:35:54,523 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.834, Acc: 0.917, Base Lr: 4.51e-04
2022-04-23 20:36:21,245 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.371[s] Speed: 43.1[samples/s]
2022-04-23 20:38:26,945 reid_baseline.train INFO: normal accuracy 0.7881569887537296 1.7579776048660278 
2022-04-23 20:38:26,945 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 20:38:26,945 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 175.8%
2022-04-23 20:39:00,620 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.815, Acc: 0.927, Base Lr: 2.11e-04
2022-04-23 20:39:32,089 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.818, Acc: 0.923, Base Lr: 2.11e-04
2022-04-23 20:39:56,266 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.327[s] Speed: 48.9[samples/s]
2022-04-23 20:41:54,772 reid_baseline.train INFO: normal accuracy 0.7881569887537296 1.7453479766845703 
2022-04-23 20:41:54,773 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 20:41:54,773 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 174.5%
2022-04-23 20:42:26,991 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.816, Acc: 0.926, Base Lr: 6.51e-05
2022-04-23 20:42:59,269 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.822, Acc: 0.921, Base Lr: 6.51e-05
2022-04-23 20:43:23,831 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.326[s] Speed: 49.0[samples/s]
2022-04-23 20:45:27,789 reid_baseline.train INFO: normal accuracy 0.7874684415882488 1.7133018970489502 
2022-04-23 20:45:57,784 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 20:45:57,785 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 171.3%
2022-04-23 20:46:32,770 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.811, Acc: 0.927, Base Lr: 1.60e-05
2022-04-23 20:47:05,996 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.818, Acc: 0.922, Base Lr: 1.60e-05
2022-04-23 20:47:28,124 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-23 20:50:02,814 reid_baseline.train INFO: normal accuracy 0.7881569887537296 1.6760170459747314 
2022-04-23 20:50:42,820 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 20:50:42,821 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 167.6%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-23 20:53:11,520 reid_baseline.train INFO: normal accuracy 0.7881569887537296 1.6760170459747314 
2022-04-23 20:53:11,520 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 20:53:11,520 reid_baseline.train INFO: Accuracy: 78.8%
2022-04-23 20:55:09,825 reid_baseline.train INFO: normal accuracy 0.7881569887537296 1.6760170459747314 
2022-04-23 20:55:09,825 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 20:55:09,826 reid_baseline.train INFO: Shuffled Accuracy: 78.8%
2022-04-23 20:55:56,268 reid_baseline.train INFO: normal accuracy 0.9532646048109966 0.8126287460327148 
2022-04-23 20:55:56,268 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 20:55:56,268 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-23 20:56:02,917 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4
2022-04-23 20:56:02,917 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-23 20:56:02,917 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 20:56:02,917 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 20:56:02,918 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 20:56:12,255 reid_baseline.train INFO: start training
2022-04-23 20:56:55,549 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.003, Acc: 0.244, Base Lr: 8.72e-04
2022-04-23 20:57:31,346 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.939, Acc: 0.353, Base Lr: 8.72e-04
2022-04-23 20:57:57,346 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.381[s] Speed: 42.0[samples/s]
2022-04-23 20:58:35,658 reid_baseline.train INFO: normal accuracy 0.5010300782859497 4.169643878936768 
2022-04-23 20:59:05,595 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 20:59:05,596 reid_baseline.train INFO: Accuracy: 50.1% Mean Entropy: 417.0%
2022-04-23 20:59:40,580 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.616, Acc: 0.541, Base Lr: 1.66e-03
2022-04-23 21:00:12,763 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.473, Acc: 0.550, Base Lr: 1.66e-03
2022-04-23 21:00:38,918 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-23 21:01:15,346 reid_baseline.train INFO: normal accuracy 0.5294602389781623 4.106684684753418 
2022-04-23 21:01:45,342 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 21:01:45,343 reid_baseline.train INFO: Accuracy: 52.9% Mean Entropy: 410.7%
2022-04-23 21:02:21,248 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.825, Acc: 0.588, Base Lr: 2.46e-03
2022-04-23 21:02:55,792 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.670, Acc: 0.591, Base Lr: 2.46e-03
2022-04-23 21:03:22,227 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.355[s] Speed: 45.1[samples/s]
2022-04-23 21:04:01,385 reid_baseline.train INFO: normal accuracy 0.5966213432220849 3.7150497436523438 
2022-04-23 21:04:31,385 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 21:04:31,386 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 371.5%
2022-04-23 21:05:08,401 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.033, Acc: 0.648, Base Lr: 3.25e-03
2022-04-23 21:05:43,861 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.922, Acc: 0.678, Base Lr: 3.25e-03
2022-04-23 21:06:08,445 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.355[s] Speed: 45.0[samples/s]
2022-04-23 21:06:45,364 reid_baseline.train INFO: normal accuracy 0.6567779151215493 3.088010787963867 
2022-04-23 21:07:16,147 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 21:07:16,147 reid_baseline.train INFO: Accuracy: 65.7% Mean Entropy: 308.8%
2022-04-23 21:07:50,897 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.592, Acc: 0.745, Base Lr: 4.04e-03
2022-04-23 21:08:22,885 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.544, Acc: 0.740, Base Lr: 4.04e-03
2022-04-23 21:08:47,224 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.333[s] Speed: 48.0[samples/s]
2022-04-23 21:09:22,037 reid_baseline.train INFO: normal accuracy 0.6893283889575608 2.7138805389404297 
2022-04-23 21:09:58,506 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 21:09:58,506 reid_baseline.train INFO: Accuracy: 68.9% Mean Entropy: 271.4%
2022-04-23 21:10:33,977 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.337, Acc: 0.786, Base Lr: 4.83e-03
2022-04-23 21:11:08,996 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.333, Acc: 0.782, Base Lr: 4.83e-03
2022-04-23 21:11:34,020 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-23 21:12:10,909 reid_baseline.train INFO: normal accuracy 0.7210548001648125 2.44997239112854 
2022-04-23 21:12:42,794 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 21:12:42,794 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 245.0%
2022-04-23 21:13:19,038 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.219, Acc: 0.809, Base Lr: 5.62e-03
2022-04-23 21:13:51,638 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.190, Acc: 0.819, Base Lr: 5.62e-03
2022-04-23 21:14:13,098 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-23 21:14:54,328 reid_baseline.train INFO: normal accuracy 0.7169344870210136 2.2586631774902344 
2022-04-23 21:15:52,464 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 21:15:52,465 reid_baseline.train INFO: Accuracy: 71.7% Mean Entropy: 225.9%
2022-04-23 21:16:29,907 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.124, Acc: 0.842, Base Lr: 6.42e-03
2022-04-23 21:17:02,208 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.131, Acc: 0.838, Base Lr: 6.42e-03
2022-04-23 21:17:27,246 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-23 21:18:08,212 reid_baseline.train INFO: normal accuracy 0.7404202719406675 2.1090590953826904 
2022-04-23 21:19:05,554 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 21:19:05,555 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 210.9%
2022-04-23 21:19:40,919 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.028, Acc: 0.857, Base Lr: 7.21e-03
2022-04-23 21:20:14,008 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.037, Acc: 0.858, Base Lr: 7.21e-03
2022-04-23 21:20:37,886 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-23 21:21:17,055 reid_baseline.train INFO: normal accuracy 0.7350638648537289 2.0425865650177 
2022-04-23 21:22:14,246 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 21:22:14,254 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 204.3%
2022-04-23 21:22:49,470 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.957, Acc: 0.883, Base Lr: 4.01e-03
2022-04-23 21:23:21,981 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.944, Acc: 0.890, Base Lr: 4.01e-03
2022-04-23 21:23:46,189 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-23 21:24:54,845 reid_baseline.train INFO: normal accuracy 0.7441285537700866 2.0137317180633545 
2022-04-23 21:25:24,862 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 21:25:24,862 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 201.4%
2022-04-23 21:26:00,766 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.908, Acc: 0.895, Base Lr: 3.38e-03
2022-04-23 21:26:36,037 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.920, Acc: 0.892, Base Lr: 3.38e-03
2022-04-23 21:27:00,981 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.351[s] Speed: 45.5[samples/s]
2022-04-23 21:27:39,672 reid_baseline.train INFO: normal accuracy 0.7482488669138855 1.9348491430282593 
2022-04-23 21:28:09,649 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 21:28:09,650 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 193.5%
2022-04-23 21:28:47,527 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.944, Acc: 0.883, Base Lr: 2.77e-03
2022-04-23 21:29:22,253 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.909, Acc: 0.898, Base Lr: 2.77e-03
2022-04-23 21:29:47,288 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.358[s] Speed: 44.7[samples/s]
2022-04-23 21:30:26,109 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.8994301557540894 
2022-04-23 21:30:56,101 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 21:30:56,102 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 189.9%
2022-04-23 21:31:34,103 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.899, Acc: 0.898, Base Lr: 2.20e-03
2022-04-23 21:32:06,527 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.886, Acc: 0.907, Base Lr: 2.20e-03
2022-04-23 21:32:30,668 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.346[s] Speed: 46.2[samples/s]
2022-04-23 21:33:11,161 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.9668536186218262 
2022-04-23 21:33:11,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 21:33:11,162 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 196.7%
2022-04-23 21:33:48,558 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.884, Acc: 0.895, Base Lr: 1.66e-03
2022-04-23 21:34:22,950 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.855, Acc: 0.909, Base Lr: 1.66e-03
2022-04-23 21:34:46,453 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.349[s] Speed: 45.8[samples/s]
2022-04-23 21:35:26,094 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.9273285865783691 
2022-04-23 21:35:26,095 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 21:35:26,095 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 192.7%
2022-04-23 21:36:03,216 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.844, Acc: 0.916, Base Lr: 1.19e-03
2022-04-23 21:36:38,953 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.855, Acc: 0.914, Base Lr: 1.19e-03
2022-04-23 21:37:05,036 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.362[s] Speed: 44.2[samples/s]
2022-04-23 21:37:44,699 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.925528883934021 
2022-04-23 21:37:44,707 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 21:37:44,707 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 192.6%
2022-04-23 21:38:23,501 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.863, Acc: 0.922, Base Lr: 7.78e-04
2022-04-23 21:39:01,904 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.855, Acc: 0.918, Base Lr: 7.78e-04
2022-04-23 21:39:29,574 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.384[s] Speed: 41.7[samples/s]
2022-04-23 21:40:12,504 reid_baseline.train INFO: normal accuracy 0.7470127729707458 1.9029701948165894 
2022-04-23 21:40:12,504 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 21:40:12,504 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 190.3%
2022-04-23 21:40:49,162 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.856, Acc: 0.909, Base Lr: 4.51e-04
2022-04-23 21:41:26,710 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.846, Acc: 0.913, Base Lr: 4.51e-04
2022-04-23 21:41:51,573 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.363[s] Speed: 44.1[samples/s]
2022-04-23 21:42:30,342 reid_baseline.train INFO: normal accuracy 0.7478368355995055 1.918256402015686 
2022-04-23 21:42:30,342 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 21:42:30,343 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 191.8%
2022-04-23 21:43:04,468 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.828, Acc: 0.925, Base Lr: 2.11e-04
2022-04-23 21:43:39,964 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.829, Acc: 0.918, Base Lr: 2.11e-04
2022-04-23 21:44:02,029 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.336[s] Speed: 47.6[samples/s]
2022-04-23 21:44:40,501 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.8931406736373901 
2022-04-23 21:45:10,575 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 21:45:10,575 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 189.3%
2022-04-23 21:45:48,019 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.807, Acc: 0.922, Base Lr: 6.51e-05
2022-04-23 21:46:22,649 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.818, Acc: 0.919, Base Lr: 6.51e-05
2022-04-23 21:46:47,753 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.355[s] Speed: 45.0[samples/s]
2022-04-23 21:47:26,188 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.88229238986969 
2022-04-23 21:47:56,181 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 21:47:56,181 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 188.2%
2022-04-23 21:48:35,414 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.808, Acc: 0.923, Base Lr: 1.60e-05
2022-04-23 21:49:12,466 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.820, Acc: 0.920, Base Lr: 1.60e-05
2022-04-23 21:49:40,398 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.382[s] Speed: 41.9[samples/s]
2022-04-23 21:51:00,562 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.8467090129852295 
2022-04-23 21:51:30,579 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 21:51:30,580 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 184.7%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-23 21:52:43,406 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.8467090129852295 
2022-04-23 21:52:43,406 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 21:52:43,406 reid_baseline.train INFO: Accuracy: 74.6%
2022-04-23 21:53:25,238 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.8467090129852295 
2022-04-23 21:53:25,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 21:53:25,238 reid_baseline.train INFO: Shuffled Accuracy: 74.6%
2022-04-23 21:54:18,811 reid_baseline.train INFO: normal accuracy 0.9493699885452462 0.8280263543128967 
2022-04-23 21:54:18,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 21:54:18,812 reid_baseline.train INFO: Source Clean Accuracy: 94.9%
2022-04-23 21:54:25,547 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4
2022-04-23 21:54:25,548 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-23 21:54:25,548 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 21:54:25,548 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 21:54:25,549 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 21:54:36,465 reid_baseline.train INFO: start training
2022-04-23 21:55:18,866 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.003, Acc: 0.244, Base Lr: 8.72e-04
2022-04-23 21:55:52,545 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.939, Acc: 0.353, Base Lr: 8.72e-04
2022-04-23 21:56:17,781 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.368[s] Speed: 43.5[samples/s]
2022-04-23 21:57:07,287 reid_baseline.train INFO: normal accuracy 0.5440414507772021 4.168392658233643 
2022-04-23 21:57:37,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 21:57:37,194 reid_baseline.train INFO: Accuracy: 54.4% Mean Entropy: 416.8%
2022-04-23 21:58:13,994 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.616, Acc: 0.541, Base Lr: 1.66e-03
2022-04-23 21:58:48,258 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.473, Acc: 0.550, Base Lr: 1.66e-03
2022-04-23 21:59:14,524 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.357[s] Speed: 44.9[samples/s]
2022-04-23 22:00:04,657 reid_baseline.train INFO: normal accuracy 0.5609371480063077 4.078295707702637 
2022-04-23 22:00:42,354 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 22:00:42,355 reid_baseline.train INFO: Accuracy: 56.1% Mean Entropy: 407.8%
2022-04-23 22:01:20,773 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.825, Acc: 0.589, Base Lr: 2.46e-03
2022-04-23 22:01:53,566 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.670, Acc: 0.592, Base Lr: 2.46e-03
2022-04-23 22:02:19,625 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.356[s] Speed: 44.9[samples/s]
2022-04-23 22:03:14,405 reid_baseline.train INFO: normal accuracy 0.6145528272133364 3.546147346496582 
2022-04-23 22:04:02,573 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 22:04:02,575 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 354.6%
2022-04-23 22:04:42,661 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.033, Acc: 0.648, Base Lr: 3.25e-03
2022-04-23 22:05:20,861 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.922, Acc: 0.678, Base Lr: 3.25e-03
2022-04-23 22:05:45,300 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.376[s] Speed: 42.5[samples/s]
2022-04-23 22:06:36,514 reid_baseline.train INFO: normal accuracy 0.6796575805361568 2.8121535778045654 
2022-04-23 22:07:34,097 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 22:07:34,099 reid_baseline.train INFO: Accuracy: 68.0% Mean Entropy: 281.2%
2022-04-23 22:08:09,614 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.592, Acc: 0.745, Base Lr: 4.04e-03
2022-04-23 22:08:43,948 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.544, Acc: 0.740, Base Lr: 4.04e-03
2022-04-23 22:09:08,756 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-23 22:10:00,640 reid_baseline.train INFO: normal accuracy 0.7134489749943681 2.3750693798065186 
2022-04-23 22:10:46,529 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 22:10:46,538 reid_baseline.train INFO: Accuracy: 71.3% Mean Entropy: 237.5%
2022-04-23 22:11:21,040 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.337, Acc: 0.786, Base Lr: 4.83e-03
2022-04-23 22:11:59,434 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.333, Acc: 0.782, Base Lr: 4.83e-03
2022-04-23 22:12:26,802 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-23 22:13:25,085 reid_baseline.train INFO: normal accuracy 0.7274160847037621 2.1265385150909424 
2022-04-23 22:14:08,148 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 22:14:08,154 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 212.7%
2022-04-23 22:14:45,010 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.219, Acc: 0.809, Base Lr: 5.62e-03
2022-04-23 22:15:18,305 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.190, Acc: 0.820, Base Lr: 5.62e-03
2022-04-23 22:15:42,772 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.347[s] Speed: 46.2[samples/s]
2022-04-23 22:16:34,392 reid_baseline.train INFO: normal accuracy 0.7431854021175941 1.954567313194275 
2022-04-23 22:17:04,703 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 22:17:04,712 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 195.5%
2022-04-23 22:17:40,594 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.124, Acc: 0.843, Base Lr: 6.42e-03
2022-04-23 22:18:14,975 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.131, Acc: 0.839, Base Lr: 6.42e-03
2022-04-23 22:18:39,991 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-04-23 22:19:29,719 reid_baseline.train INFO: normal accuracy 0.7431854021175941 1.8877249956130981 
2022-04-23 22:20:24,630 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 22:20:24,630 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 188.8%
2022-04-23 22:21:04,455 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.029, Acc: 0.857, Base Lr: 7.21e-03
2022-04-23 22:21:36,435 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.037, Acc: 0.858, Base Lr: 7.21e-03
2022-04-23 22:22:01,488 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.355[s] Speed: 45.1[samples/s]
2022-04-23 22:22:50,253 reid_baseline.train INFO: normal accuracy 0.7517458887136742 1.7951114177703857 
2022-04-23 22:23:20,234 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 22:23:20,234 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 179.5%
2022-04-23 22:23:58,330 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.957, Acc: 0.884, Base Lr: 4.01e-03
2022-04-23 22:24:31,557 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.944, Acc: 0.890, Base Lr: 4.01e-03
2022-04-23 22:24:54,179 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-23 22:26:16,602 reid_baseline.train INFO: normal accuracy 0.7600810993466998 1.811448335647583 
2022-04-23 22:26:16,603 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 22:26:16,603 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 181.1%
2022-04-23 22:26:57,452 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.908, Acc: 0.894, Base Lr: 3.38e-03
2022-04-23 22:27:36,032 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.920, Acc: 0.891, Base Lr: 3.38e-03
2022-04-23 22:28:01,434 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.384[s] Speed: 41.7[samples/s]
2022-04-23 22:28:53,891 reid_baseline.train INFO: normal accuracy 0.7641360666816851 1.7580692768096924 
2022-04-23 22:29:23,874 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 22:29:23,877 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 175.8%
2022-04-23 22:30:01,363 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.944, Acc: 0.883, Base Lr: 2.77e-03
2022-04-23 22:30:37,615 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.909, Acc: 0.898, Base Lr: 2.77e-03
2022-04-23 22:31:02,464 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-23 22:31:53,149 reid_baseline.train INFO: normal accuracy 0.7672899301644515 1.7097206115722656 
2022-04-23 22:32:23,139 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 22:32:23,140 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 171.0%
2022-04-23 22:33:01,432 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.899, Acc: 0.898, Base Lr: 2.20e-03
2022-04-23 22:33:36,741 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.886, Acc: 0.907, Base Lr: 2.20e-03
2022-04-23 22:33:59,748 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-23 22:34:52,321 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.779285192489624 
2022-04-23 22:34:52,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 22:34:52,323 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 177.9%
2022-04-23 22:35:29,427 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.884, Acc: 0.895, Base Lr: 1.66e-03
2022-04-23 22:36:04,434 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.855, Acc: 0.908, Base Lr: 1.66e-03
2022-04-23 22:36:28,638 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.352[s] Speed: 45.4[samples/s]
2022-04-23 22:37:21,437 reid_baseline.train INFO: normal accuracy 0.7668393782383419 1.747146725654602 
2022-04-23 22:37:21,439 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 22:37:21,440 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 174.7%
2022-04-23 22:38:00,146 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.844, Acc: 0.916, Base Lr: 1.19e-03
2022-04-23 22:38:38,961 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.855, Acc: 0.914, Base Lr: 1.19e-03
2022-04-23 22:39:04,982 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.379[s] Speed: 42.2[samples/s]
2022-04-23 22:40:00,429 reid_baseline.train INFO: normal accuracy 0.7681910340166704 1.7643355131149292 
2022-04-23 22:40:00,430 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 22:40:00,430 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 176.4%
2022-04-23 22:40:40,341 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.863, Acc: 0.922, Base Lr: 7.78e-04
2022-04-23 22:41:17,946 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.855, Acc: 0.918, Base Lr: 7.78e-04
2022-04-23 22:41:44,233 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-23 22:42:36,159 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.7284953594207764 
2022-04-23 22:42:36,159 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 22:42:36,160 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 172.8%
2022-04-23 22:43:12,479 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.856, Acc: 0.909, Base Lr: 4.51e-04
2022-04-23 22:43:46,324 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.846, Acc: 0.913, Base Lr: 4.51e-04
2022-04-23 22:44:13,530 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.357[s] Speed: 44.9[samples/s]
2022-04-23 22:45:03,544 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.7523421049118042 
2022-04-23 22:45:03,544 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 22:45:03,544 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 175.2%
2022-04-23 22:45:39,669 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.828, Acc: 0.925, Base Lr: 2.11e-04
2022-04-23 22:46:12,568 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.829, Acc: 0.918, Base Lr: 2.11e-04
2022-04-23 22:46:38,358 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-23 22:47:27,911 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.7383300065994263 
2022-04-23 22:47:27,919 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 22:47:27,920 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 173.8%
2022-04-23 22:48:03,100 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.807, Acc: 0.922, Base Lr: 6.51e-05
2022-04-23 22:48:37,215 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.818, Acc: 0.919, Base Lr: 6.51e-05
2022-04-23 22:49:02,772 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-23 22:49:52,489 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.7085157632827759 
2022-04-23 22:50:27,446 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 22:50:27,447 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.9%
2022-04-23 22:51:04,341 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.808, Acc: 0.923, Base Lr: 1.60e-05
2022-04-23 22:51:37,498 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.820, Acc: 0.920, Base Lr: 1.60e-05
2022-04-23 22:52:04,348 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.354[s] Speed: 45.1[samples/s]
2022-04-23 22:53:27,739 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.6795823574066162 
2022-04-23 22:53:57,708 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 22:53:57,709 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 168.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-23 22:55:17,790 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.6795823574066162 
2022-04-23 22:55:17,791 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 22:55:17,791 reid_baseline.train INFO: Accuracy: 77.2%
2022-04-23 22:56:07,365 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.6795823574066162 
2022-04-23 22:56:07,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 22:56:07,365 reid_baseline.train INFO: Shuffled Accuracy: 77.2%
2022-04-23 22:56:57,770 reid_baseline.train INFO: normal accuracy 0.9493699885452462 0.8281002044677734 
2022-04-23 22:56:57,770 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 22:56:57,770 reid_baseline.train INFO: Source Clean Accuracy: 94.9%
2022-04-23 22:57:04,831 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4
2022-04-23 22:57:04,831 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-23 22:57:04,831 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 22:57:04,832 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 22:57:04,832 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 22:57:15,015 reid_baseline.train INFO: start training
2022-04-23 22:57:59,787 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.003, Acc: 0.244, Base Lr: 8.72e-04
2022-04-23 22:58:34,799 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.939, Acc: 0.353, Base Lr: 8.72e-04
2022-04-23 22:58:56,848 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.369[s] Speed: 43.3[samples/s]
2022-04-23 23:01:03,458 reid_baseline.train INFO: normal accuracy 0.564838191416112 4.169238090515137 
2022-04-23 23:01:33,418 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 23:01:33,419 reid_baseline.train INFO: Accuracy: 56.5% Mean Entropy: 416.9%
2022-04-23 23:02:11,999 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.616, Acc: 0.541, Base Lr: 1.66e-03
2022-04-23 23:02:46,815 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.473, Acc: 0.550, Base Lr: 1.66e-03
2022-04-23 23:03:12,421 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.363[s] Speed: 44.1[samples/s]
2022-04-23 23:05:20,076 reid_baseline.train INFO: normal accuracy 0.5864126692678449 4.092592716217041 
2022-04-23 23:05:50,042 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 23:05:50,042 reid_baseline.train INFO: Accuracy: 58.6% Mean Entropy: 409.3%
2022-04-23 23:06:28,987 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.825, Acc: 0.589, Base Lr: 2.46e-03
2022-04-23 23:07:04,576 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.670, Acc: 0.592, Base Lr: 2.46e-03
2022-04-23 23:07:31,091 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.370[s] Speed: 43.2[samples/s]
2022-04-23 23:09:36,220 reid_baseline.train INFO: normal accuracy 0.6424145053936194 3.602161169052124 
2022-04-23 23:10:06,233 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 23:10:06,233 reid_baseline.train INFO: Accuracy: 64.2% Mean Entropy: 360.2%
2022-04-23 23:10:44,991 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.033, Acc: 0.648, Base Lr: 3.25e-03
2022-04-23 23:11:20,198 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.922, Acc: 0.678, Base Lr: 3.25e-03
2022-04-23 23:11:46,621 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-23 23:13:45,612 reid_baseline.train INFO: normal accuracy 0.7075969703924719 2.8810551166534424 
2022-04-23 23:14:15,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 23:14:15,598 reid_baseline.train INFO: Accuracy: 70.8% Mean Entropy: 288.1%
2022-04-23 23:14:53,470 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.592, Acc: 0.745, Base Lr: 4.04e-03
2022-04-23 23:15:30,566 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.544, Acc: 0.740, Base Lr: 4.04e-03
2022-04-23 23:15:56,397 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.369[s] Speed: 43.3[samples/s]
2022-04-23 23:18:00,811 reid_baseline.train INFO: normal accuracy 0.7422538443883406 2.4584758281707764 
2022-04-23 23:18:30,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 23:18:30,801 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 245.8%
2022-04-23 23:19:07,498 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.338, Acc: 0.786, Base Lr: 4.83e-03
2022-04-23 23:19:44,089 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.333, Acc: 0.782, Base Lr: 4.83e-03
2022-04-23 23:20:10,894 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-23 23:22:24,173 reid_baseline.train INFO: normal accuracy 0.7633692907964196 2.196866989135742 
2022-04-23 23:22:54,167 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 23:22:54,168 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 219.7%
2022-04-23 23:23:29,624 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.219, Acc: 0.809, Base Lr: 5.62e-03
2022-04-23 23:24:04,501 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.190, Acc: 0.819, Base Lr: 5.62e-03
2022-04-23 23:24:31,264 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.356[s] Speed: 45.0[samples/s]
2022-04-23 23:26:43,570 reid_baseline.train INFO: normal accuracy 0.7688776681202663 2.016343593597412 
2022-04-23 23:27:13,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 23:27:13,568 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 201.6%
2022-04-23 23:27:54,650 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.124, Acc: 0.843, Base Lr: 6.42e-03
2022-04-23 23:28:31,268 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.131, Acc: 0.839, Base Lr: 6.42e-03
2022-04-23 23:28:57,385 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-23 23:30:59,821 reid_baseline.train INFO: normal accuracy 0.7743860454441129 1.9020774364471436 
2022-04-23 23:31:29,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 23:31:29,812 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 190.2%
2022-04-23 23:32:06,729 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.028, Acc: 0.857, Base Lr: 7.21e-03
2022-04-23 23:32:41,381 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.037, Acc: 0.858, Base Lr: 7.21e-03
2022-04-23 23:33:08,770 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.362[s] Speed: 44.1[samples/s]
2022-04-23 23:35:19,737 reid_baseline.train INFO: normal accuracy 0.7812715170989213 1.83170485496521 
2022-04-23 23:35:49,756 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 23:35:49,757 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 183.2%
2022-04-23 23:36:26,210 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.957, Acc: 0.885, Base Lr: 4.01e-03
2022-04-23 23:37:00,386 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.944, Acc: 0.891, Base Lr: 4.01e-03
2022-04-23 23:37:24,008 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.345[s] Speed: 46.3[samples/s]
2022-04-23 23:40:10,629 reid_baseline.train INFO: normal accuracy 0.7840257057608446 1.8308277130126953 
2022-04-23 23:40:50,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 23:40:50,937 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 183.1%
2022-04-23 23:41:28,001 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.908, Acc: 0.894, Base Lr: 3.38e-03
2022-04-23 23:42:03,446 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.920, Acc: 0.891, Base Lr: 3.38e-03
2022-04-23 23:42:29,132 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.360[s] Speed: 44.5[samples/s]
2022-04-23 23:44:42,763 reid_baseline.train INFO: normal accuracy 0.7874684415882488 1.7672232389450073 
2022-04-23 23:45:35,381 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 23:45:35,381 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 176.7%
2022-04-23 23:46:18,665 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.944, Acc: 0.882, Base Lr: 2.77e-03
2022-04-23 23:46:53,505 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.909, Acc: 0.898, Base Lr: 2.77e-03
2022-04-23 23:47:19,173 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-23 23:49:33,200 reid_baseline.train INFO: normal accuracy 0.7854028000918063 1.7288411855697632 
2022-04-23 23:50:30,294 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 23:50:30,302 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 172.9%
2022-04-23 23:51:19,994 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.899, Acc: 0.898, Base Lr: 2.20e-03
2022-04-23 23:52:16,241 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.886, Acc: 0.907, Base Lr: 2.20e-03
2022-04-23 23:52:44,485 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.491[s] Speed: 32.6[samples/s]
2022-04-23 23:55:49,886 reid_baseline.train INFO: normal accuracy 0.786779894422768 1.801924705505371 
2022-04-23 23:55:49,889 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 23:55:49,890 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 180.2%
2022-04-23 23:56:39,532 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.884, Acc: 0.895, Base Lr: 1.66e-03
2022-04-23 23:57:21,819 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.855, Acc: 0.908, Base Lr: 1.66e-03
2022-04-23 23:57:46,525 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.427[s] Speed: 37.5[samples/s]
2022-04-23 23:59:55,832 reid_baseline.train INFO: normal accuracy 0.7874684415882488 1.7646839618682861 
2022-04-23 23:59:55,833 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 23:59:55,834 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 176.5%
2022-04-24 00:00:31,198 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.844, Acc: 0.916, Base Lr: 1.19e-03
2022-04-24 00:01:05,998 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.855, Acc: 0.914, Base Lr: 1.19e-03
2022-04-24 00:01:31,927 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.351[s] Speed: 45.6[samples/s]
2022-04-24 00:03:45,820 reid_baseline.train INFO: normal accuracy 0.7890750516410374 1.7758241891860962 
2022-04-24 00:03:45,823 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-24 00:03:45,823 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 177.6%
2022-04-24 00:04:22,618 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.863, Acc: 0.922, Base Lr: 7.78e-04
2022-04-24 00:04:57,594 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.855, Acc: 0.918, Base Lr: 7.78e-04
2022-04-24 00:05:23,331 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-24 00:07:34,341 reid_baseline.train INFO: normal accuracy 0.7883865044755566 1.7453346252441406 
2022-04-24 00:07:34,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-24 00:07:34,343 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 174.5%
2022-04-24 00:08:13,416 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.856, Acc: 0.909, Base Lr: 4.51e-04
2022-04-24 00:08:49,521 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.846, Acc: 0.913, Base Lr: 4.51e-04
2022-04-24 00:09:16,545 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-24 00:11:31,893 reid_baseline.train INFO: normal accuracy 0.7870094101445949 1.766243577003479 
2022-04-24 00:11:31,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-24 00:11:31,896 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 176.6%
2022-04-24 00:12:10,639 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.828, Acc: 0.925, Base Lr: 2.11e-04
2022-04-24 00:12:45,495 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.829, Acc: 0.918, Base Lr: 2.11e-04
2022-04-24 00:13:11,759 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-24 00:15:30,859 reid_baseline.train INFO: normal accuracy 0.7913702088593069 1.7516276836395264 
2022-04-24 00:15:30,860 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-24 00:15:30,860 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 175.2%
2022-04-24 00:16:15,204 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.807, Acc: 0.922, Base Lr: 6.51e-05
2022-04-24 00:16:53,461 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.818, Acc: 0.918, Base Lr: 6.51e-05
2022-04-24 00:17:21,169 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.403[s] Speed: 39.7[samples/s]
2022-04-24 00:19:40,888 reid_baseline.train INFO: normal accuracy 0.7899931145283452 1.725655436515808 
2022-04-24 00:20:10,971 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-24 00:20:10,972 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 172.6%
2022-04-24 00:20:50,084 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.808, Acc: 0.924, Base Lr: 1.60e-05
2022-04-24 00:21:23,019 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.820, Acc: 0.920, Base Lr: 1.60e-05
2022-04-24 00:21:49,081 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.359[s] Speed: 44.5[samples/s]
2022-04-24 00:24:32,408 reid_baseline.train INFO: normal accuracy 0.7932063346339224 1.6910518407821655 
2022-04-24 00:25:02,456 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-24 00:25:02,457 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 169.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-24 00:27:39,653 reid_baseline.train INFO: normal accuracy 0.7932063346339224 1.6910518407821655 
2022-04-24 00:27:39,654 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 00:27:39,654 reid_baseline.train INFO: Accuracy: 79.3%
2022-04-24 00:29:52,738 reid_baseline.train INFO: normal accuracy 0.7932063346339224 1.6910518407821655 
2022-04-24 00:29:52,738 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 00:29:52,738 reid_baseline.train INFO: Shuffled Accuracy: 79.3%
2022-04-24 00:30:46,391 reid_baseline.train INFO: normal accuracy 0.9493699885452462 0.828100860118866 
2022-04-24 00:30:46,395 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 00:30:46,395 reid_baseline.train INFO: Source Clean Accuracy: 94.9%
2022-04-24 00:30:53,664 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5
2022-04-24 00:30:53,665 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-24 00:30:53,665 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-24 00:30:53,665 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-24 00:30:53,666 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-24 00:31:03,672 reid_baseline.train INFO: start training
2022-04-24 00:31:51,725 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.044, Acc: 0.238, Base Lr: 8.72e-04
2022-04-24 00:32:26,699 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.965, Acc: 0.348, Base Lr: 8.72e-04
2022-04-24 00:32:51,619 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.390[s] Speed: 41.1[samples/s]
2022-04-24 00:33:31,144 reid_baseline.train INFO: normal accuracy 0.49938195302843014 4.169980525970459 
2022-04-24 00:34:01,094 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-24 00:34:01,095 reid_baseline.train INFO: Accuracy: 49.9% Mean Entropy: 417.0%
2022-04-24 00:34:40,353 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.613, Acc: 0.545, Base Lr: 1.66e-03
2022-04-24 00:35:17,273 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.475, Acc: 0.545, Base Lr: 1.66e-03
2022-04-24 00:35:43,515 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.375[s] Speed: 42.7[samples/s]
2022-04-24 00:36:26,281 reid_baseline.train INFO: normal accuracy 0.53852492789452 4.110527992248535 
2022-04-24 00:36:56,270 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-24 00:36:56,270 reid_baseline.train INFO: Accuracy: 53.9% Mean Entropy: 411.1%
2022-04-24 00:37:34,971 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.852, Acc: 0.587, Base Lr: 2.46e-03
2022-04-24 00:38:11,819 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.698, Acc: 0.590, Base Lr: 2.46e-03
2022-04-24 00:38:38,319 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-24 00:39:19,558 reid_baseline.train INFO: normal accuracy 0.5916769674495261 3.726987361907959 
2022-04-24 00:39:49,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-24 00:39:49,594 reid_baseline.train INFO: Accuracy: 59.2% Mean Entropy: 372.7%
2022-04-24 00:40:29,007 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.059, Acc: 0.639, Base Lr: 3.25e-03
2022-04-24 00:41:05,764 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.946, Acc: 0.668, Base Lr: 3.25e-03
2022-04-24 00:41:29,825 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-24 00:42:10,486 reid_baseline.train INFO: normal accuracy 0.6592501030078286 3.095456123352051 
2022-04-24 00:42:40,470 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-24 00:42:40,471 reid_baseline.train INFO: Accuracy: 65.9% Mean Entropy: 309.5%
2022-04-24 00:43:18,846 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.607, Acc: 0.743, Base Lr: 4.04e-03
2022-04-24 00:43:56,948 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.556, Acc: 0.738, Base Lr: 4.04e-03
2022-04-24 00:44:23,453 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.377[s] Speed: 42.5[samples/s]
2022-04-24 00:45:01,595 reid_baseline.train INFO: normal accuracy 0.69221260815822 2.717982053756714 
2022-04-24 00:45:31,611 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-24 00:45:31,612 reid_baseline.train INFO: Accuracy: 69.2% Mean Entropy: 271.8%
2022-04-24 00:46:11,041 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.334, Acc: 0.784, Base Lr: 4.83e-03
2022-04-24 00:46:47,745 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.327, Acc: 0.782, Base Lr: 4.83e-03
2022-04-24 00:47:15,249 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.379[s] Speed: 42.2[samples/s]
2022-04-24 00:47:54,228 reid_baseline.train INFO: normal accuracy 0.7144622991347342 2.433649778366089 
2022-04-24 00:48:24,205 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-24 00:48:24,205 reid_baseline.train INFO: Accuracy: 71.4% Mean Entropy: 243.4%
2022-04-24 00:49:03,745 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.232, Acc: 0.804, Base Lr: 5.62e-03
2022-04-24 00:49:40,257 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.202, Acc: 0.815, Base Lr: 5.62e-03
2022-04-24 00:50:06,639 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.375[s] Speed: 42.7[samples/s]
2022-04-24 00:50:47,076 reid_baseline.train INFO: normal accuracy 0.7181705809641533 2.251038074493408 
2022-04-24 00:51:27,452 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-24 00:51:27,453 reid_baseline.train INFO: Accuracy: 71.8% Mean Entropy: 225.1%
2022-04-24 00:52:07,714 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.102, Acc: 0.845, Base Lr: 6.42e-03
2022-04-24 00:52:44,914 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.107, Acc: 0.838, Base Lr: 6.42e-03
2022-04-24 00:53:11,354 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-24 00:53:50,697 reid_baseline.train INFO: normal accuracy 0.73053152039555 2.1267263889312744 
2022-04-24 00:54:44,577 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-24 00:54:44,578 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 212.7%
2022-04-24 00:55:22,895 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.039, Acc: 0.861, Base Lr: 7.21e-03
2022-04-24 00:55:58,928 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.032, Acc: 0.862, Base Lr: 7.21e-03
2022-04-24 00:56:25,677 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.370[s] Speed: 43.2[samples/s]
2022-04-24 00:57:06,559 reid_baseline.train INFO: normal accuracy 0.7276473011948908 2.032819986343384 
2022-04-24 00:57:59,207 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-24 00:57:59,213 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 203.3%
2022-04-24 00:58:36,652 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.964, Acc: 0.880, Base Lr: 4.01e-03
2022-04-24 00:59:12,613 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.943, Acc: 0.889, Base Lr: 4.01e-03
2022-04-24 00:59:39,662 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.368[s] Speed: 43.5[samples/s]
2022-04-24 01:00:49,737 reid_baseline.train INFO: normal accuracy 0.7354758961681088 2.0212185382843018 
2022-04-24 01:01:36,605 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-24 01:01:36,605 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 202.1%
2022-04-24 01:02:16,092 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.909, Acc: 0.902, Base Lr: 3.38e-03
2022-04-24 01:02:55,823 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.928, Acc: 0.896, Base Lr: 3.38e-03
2022-04-24 01:03:23,694 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.392[s] Speed: 40.8[samples/s]
2022-04-24 01:04:05,920 reid_baseline.train INFO: normal accuracy 0.7400082406262876 1.9384294748306274 
2022-04-24 01:04:40,097 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-24 01:04:40,103 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 193.8%
2022-04-24 01:05:19,414 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.937, Acc: 0.886, Base Lr: 2.77e-03
2022-04-24 01:05:58,803 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.904, Acc: 0.899, Base Lr: 2.77e-03
2022-04-24 01:06:27,052 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.392[s] Speed: 40.8[samples/s]
2022-04-24 01:07:07,110 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.9016679525375366 
2022-04-24 01:07:37,127 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-24 01:07:37,128 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 190.2%
2022-04-24 01:08:11,026 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.913, Acc: 0.894, Base Lr: 2.20e-03
2022-04-24 01:08:46,686 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.892, Acc: 0.900, Base Lr: 2.20e-03
2022-04-24 01:09:11,740 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.347[s] Speed: 46.2[samples/s]
2022-04-24 01:09:53,950 reid_baseline.train INFO: normal accuracy 0.7354758961681088 1.9652597904205322 
2022-04-24 01:09:53,953 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-24 01:09:53,953 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 196.5%
2022-04-24 01:10:33,271 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.886, Acc: 0.898, Base Lr: 1.66e-03
2022-04-24 01:11:08,433 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.860, Acc: 0.909, Base Lr: 1.66e-03
2022-04-24 01:11:32,078 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.359[s] Speed: 44.5[samples/s]
2022-04-24 01:12:13,276 reid_baseline.train INFO: normal accuracy 0.7408323032550473 1.947698950767517 
2022-04-24 01:12:13,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-24 01:12:13,277 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 194.8%
2022-04-24 01:12:51,327 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.839, Acc: 0.917, Base Lr: 1.19e-03
2022-04-24 01:13:27,815 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.857, Acc: 0.913, Base Lr: 1.19e-03
2022-04-24 01:13:55,316 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-24 01:14:38,931 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.9425835609436035 
2022-04-24 01:14:38,931 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-24 01:14:38,931 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 194.3%
2022-04-24 01:15:18,571 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.863, Acc: 0.917, Base Lr: 7.78e-04
2022-04-24 01:15:55,537 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.853, Acc: 0.917, Base Lr: 7.78e-04
2022-04-24 01:16:23,502 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-04-24 01:17:04,081 reid_baseline.train INFO: normal accuracy 0.7408323032550473 1.9145900011062622 
2022-04-24 01:17:04,081 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-24 01:17:04,082 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 191.5%
2022-04-24 01:17:43,577 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.847, Acc: 0.911, Base Lr: 4.51e-04
2022-04-24 01:18:22,739 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.832, Acc: 0.914, Base Lr: 4.51e-04
2022-04-24 01:18:53,106 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.399[s] Speed: 40.1[samples/s]
2022-04-24 01:19:35,681 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.9189090728759766 
2022-04-24 01:19:35,681 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-24 01:19:35,682 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 191.9%
2022-04-24 01:20:18,327 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.819, Acc: 0.923, Base Lr: 2.11e-04
2022-04-24 01:20:56,430 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.811, Acc: 0.923, Base Lr: 2.11e-04
2022-04-24 01:21:24,267 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.398[s] Speed: 40.2[samples/s]
2022-04-24 01:22:09,451 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.8986257314682007 
2022-04-24 01:22:59,153 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-24 01:22:59,153 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 189.9%
2022-04-24 01:23:38,156 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.813, Acc: 0.924, Base Lr: 6.51e-05
2022-04-24 01:24:13,873 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.815, Acc: 0.918, Base Lr: 6.51e-05
2022-04-24 01:24:39,482 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.367[s] Speed: 43.5[samples/s]
2022-04-24 01:25:22,106 reid_baseline.train INFO: normal accuracy 0.7408323032550473 1.897538185119629 
2022-04-24 01:26:19,538 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-24 01:26:19,541 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 189.8%
2022-04-24 01:26:59,234 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.797, Acc: 0.920, Base Lr: 1.60e-05
2022-04-24 01:27:36,052 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.810, Acc: 0.917, Base Lr: 1.60e-05
2022-04-24 01:28:03,305 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-24 01:29:12,532 reid_baseline.train INFO: normal accuracy 0.7375360527400082 1.844718098640442 
2022-04-24 01:29:53,774 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-24 01:29:53,774 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 184.5%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-24 01:31:05,753 reid_baseline.train INFO: normal accuracy 0.7375360527400082 1.844718098640442 
2022-04-24 01:31:05,754 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 01:31:05,754 reid_baseline.train INFO: Accuracy: 73.8%
2022-04-24 01:31:47,381 reid_baseline.train INFO: normal accuracy 0.7375360527400082 1.844718098640442 
2022-04-24 01:31:47,382 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 01:31:47,382 reid_baseline.train INFO: Shuffled Accuracy: 73.8%
2022-04-24 01:32:37,616 reid_baseline.train INFO: normal accuracy 0.9500572737686139 0.8279430866241455 
2022-04-24 01:32:37,616 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 01:32:37,616 reid_baseline.train INFO: Source Clean Accuracy: 95.0%
2022-04-24 01:32:44,775 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5
2022-04-24 01:32:44,775 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-24 01:32:44,775 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-24 01:32:44,775 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-24 01:32:44,776 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-24 01:32:55,438 reid_baseline.train INFO: start training
2022-04-24 01:33:40,856 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.044, Acc: 0.238, Base Lr: 8.72e-04
2022-04-24 01:34:17,520 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.965, Acc: 0.348, Base Lr: 8.72e-04
2022-04-24 01:34:42,587 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.390[s] Speed: 41.0[samples/s]
2022-04-24 01:35:36,543 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.168908596038818 
2022-04-24 01:36:32,125 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-24 01:36:32,133 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.9%
2022-04-24 01:37:08,317 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.613, Acc: 0.545, Base Lr: 1.66e-03
2022-04-24 01:37:47,540 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.475, Acc: 0.546, Base Lr: 1.66e-03
2022-04-24 01:38:16,470 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.382[s] Speed: 41.9[samples/s]
2022-04-24 01:39:11,484 reid_baseline.train INFO: normal accuracy 0.5676954268979499 4.088472843170166 
2022-04-24 01:39:41,463 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-24 01:39:41,463 reid_baseline.train INFO: Accuracy: 56.8% Mean Entropy: 408.8%
2022-04-24 01:40:21,270 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.852, Acc: 0.587, Base Lr: 2.46e-03
2022-04-24 01:40:59,159 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.698, Acc: 0.590, Base Lr: 2.46e-03
2022-04-24 01:41:27,864 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.390[s] Speed: 41.1[samples/s]
2022-04-24 01:42:23,155 reid_baseline.train INFO: normal accuracy 0.6125253435458436 3.56870436668396 
2022-04-24 01:43:11,095 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-24 01:43:11,102 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 356.9%
2022-04-24 01:43:49,591 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.059, Acc: 0.639, Base Lr: 3.25e-03
2022-04-24 01:44:27,058 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.946, Acc: 0.668, Base Lr: 3.25e-03
2022-04-24 01:44:52,734 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-24 01:45:44,133 reid_baseline.train INFO: normal accuracy 0.680333408425321 2.8471693992614746 
2022-04-24 01:46:17,476 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-24 01:46:17,485 reid_baseline.train INFO: Accuracy: 68.0% Mean Entropy: 284.7%
2022-04-24 01:46:53,256 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.607, Acc: 0.743, Base Lr: 4.04e-03
2022-04-24 01:47:28,225 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.556, Acc: 0.738, Base Lr: 4.04e-03
2022-04-24 01:47:52,903 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.349[s] Speed: 45.8[samples/s]
2022-04-24 01:48:41,549 reid_baseline.train INFO: normal accuracy 0.7098445595854922 2.417529344558716 
2022-04-24 01:49:15,718 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-24 01:49:15,719 reid_baseline.train INFO: Accuracy: 71.0% Mean Entropy: 241.8%
2022-04-24 01:49:49,341 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.334, Acc: 0.784, Base Lr: 4.83e-03
2022-04-24 01:50:23,101 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.327, Acc: 0.781, Base Lr: 4.83e-03
2022-04-24 01:50:49,264 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.343[s] Speed: 46.7[samples/s]
2022-04-24 01:51:46,115 reid_baseline.train INFO: normal accuracy 0.7271908087407074 2.133810520172119 
2022-04-24 01:52:25,932 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-24 01:52:25,939 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 213.4%
2022-04-24 01:53:02,057 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.232, Acc: 0.803, Base Lr: 5.62e-03
2022-04-24 01:53:36,011 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.202, Acc: 0.815, Base Lr: 5.62e-03
2022-04-24 01:54:00,031 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-24 01:54:51,225 reid_baseline.train INFO: normal accuracy 0.7434106780806488 1.9801714420318604 
2022-04-24 01:55:38,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-24 01:55:38,944 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 198.0%
2022-04-24 01:56:15,607 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.102, Acc: 0.845, Base Lr: 6.42e-03
2022-04-24 01:56:49,057 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.107, Acc: 0.838, Base Lr: 6.42e-03
2022-04-24 01:57:13,657 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-24 01:58:03,254 reid_baseline.train INFO: normal accuracy 0.7515206127506195 1.8939405679702759 
2022-04-24 01:58:53,232 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-24 01:58:53,243 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 189.4%
2022-04-24 01:59:28,882 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.039, Acc: 0.860, Base Lr: 7.21e-03
2022-04-24 02:00:03,443 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.032, Acc: 0.861, Base Lr: 7.21e-03
2022-04-24 02:00:28,119 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-24 02:01:16,558 reid_baseline.train INFO: normal accuracy 0.759855823383645 1.818484902381897 
2022-04-24 02:02:09,158 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-24 02:02:09,159 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 181.8%
2022-04-24 02:02:43,792 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.964, Acc: 0.878, Base Lr: 4.01e-03
2022-04-24 02:03:16,607 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.943, Acc: 0.888, Base Lr: 4.01e-03
2022-04-24 02:03:41,559 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-24 02:05:02,126 reid_baseline.train INFO: normal accuracy 0.7582788916422618 1.827283263206482 
2022-04-24 02:05:02,131 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-24 02:05:02,131 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 182.7%
2022-04-24 02:05:41,285 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.909, Acc: 0.901, Base Lr: 3.38e-03
2022-04-24 02:06:17,159 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.928, Acc: 0.895, Base Lr: 3.38e-03
2022-04-24 02:06:41,710 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.365[s] Speed: 43.9[samples/s]
2022-04-24 02:07:30,398 reid_baseline.train INFO: normal accuracy 0.7627844109033566 1.746058464050293 
2022-04-24 02:08:27,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-24 02:08:27,308 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 174.6%
2022-04-24 02:09:05,219 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.937, Acc: 0.888, Base Lr: 2.77e-03
2022-04-24 02:09:40,080 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.904, Acc: 0.900, Base Lr: 2.77e-03
2022-04-24 02:10:03,254 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.351[s] Speed: 45.5[samples/s]
2022-04-24 02:10:50,241 reid_baseline.train INFO: normal accuracy 0.7657129984230683 1.7221077680587769 
2022-04-24 02:11:23,421 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-24 02:11:23,428 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 172.2%
2022-04-24 02:11:58,281 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.913, Acc: 0.893, Base Lr: 2.20e-03
2022-04-24 02:12:32,581 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.892, Acc: 0.900, Base Lr: 2.20e-03
2022-04-24 02:12:55,390 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-24 02:13:46,899 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.7784485816955566 
2022-04-24 02:13:46,900 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-24 02:13:46,900 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 177.8%
2022-04-24 02:14:21,541 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.886, Acc: 0.897, Base Lr: 1.66e-03
2022-04-24 02:14:53,944 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.860, Acc: 0.908, Base Lr: 1.66e-03
2022-04-24 02:15:19,392 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-24 02:16:08,003 reid_baseline.train INFO: normal accuracy 0.7679657580536157 1.761880874633789 
2022-04-24 02:16:08,004 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-24 02:16:08,004 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 176.2%
2022-04-24 02:16:45,283 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.838, Acc: 0.917, Base Lr: 1.19e-03
2022-04-24 02:17:17,072 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.857, Acc: 0.914, Base Lr: 1.19e-03
2022-04-24 02:17:41,462 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.342[s] Speed: 46.7[samples/s]
2022-04-24 02:18:31,107 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.7652612924575806 
2022-04-24 02:18:31,107 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-24 02:18:31,107 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 176.5%
2022-04-24 02:19:08,334 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.863, Acc: 0.917, Base Lr: 7.78e-04
2022-04-24 02:19:42,815 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.853, Acc: 0.917, Base Lr: 7.78e-04
2022-04-24 02:20:07,629 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.354[s] Speed: 45.3[samples/s]
2022-04-24 02:20:56,296 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.7367061376571655 
2022-04-24 02:20:56,297 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-24 02:20:56,297 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 173.7%
2022-04-24 02:21:32,618 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.846, Acc: 0.911, Base Lr: 4.51e-04
2022-04-24 02:22:05,349 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.831, Acc: 0.914, Base Lr: 4.51e-04
2022-04-24 02:22:31,854 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-24 02:23:20,965 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.745856523513794 
2022-04-24 02:23:20,966 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-24 02:23:20,966 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 174.6%
2022-04-24 02:23:57,551 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.819, Acc: 0.923, Base Lr: 2.11e-04
2022-04-24 02:24:31,824 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.811, Acc: 0.923, Base Lr: 2.11e-04
2022-04-24 02:24:55,944 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-24 02:25:46,084 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.7359371185302734 
2022-04-24 02:25:46,086 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-24 02:25:46,086 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 173.6%
2022-04-24 02:26:21,892 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.813, Acc: 0.925, Base Lr: 6.51e-05
2022-04-24 02:26:54,243 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.814, Acc: 0.918, Base Lr: 6.51e-05
2022-04-24 02:27:16,928 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.333[s] Speed: 48.1[samples/s]
2022-04-24 02:28:06,583 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.7144428491592407 
2022-04-24 02:28:36,580 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-24 02:28:36,580 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 171.4%
2022-04-24 02:29:13,471 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.797, Acc: 0.920, Base Lr: 1.60e-05
2022-04-24 02:29:48,155 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.810, Acc: 0.917, Base Lr: 1.60e-05
2022-04-24 02:30:14,130 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-24 02:31:33,095 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.6696391105651855 
2022-04-24 02:32:03,071 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-24 02:32:03,071 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 167.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-24 02:33:23,508 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.6696391105651855 
2022-04-24 02:33:23,509 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 02:33:23,510 reid_baseline.train INFO: Accuracy: 77.2%
2022-04-24 02:34:13,988 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.6696391105651855 
2022-04-24 02:34:13,990 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 02:34:13,990 reid_baseline.train INFO: Shuffled Accuracy: 77.2%
2022-04-24 02:35:05,432 reid_baseline.train INFO: normal accuracy 0.9500572737686139 0.8283726572990417 
2022-04-24 02:35:05,432 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 02:35:05,432 reid_baseline.train INFO: Source Clean Accuracy: 95.0%
2022-04-24 02:35:12,490 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5
2022-04-24 02:35:12,493 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-24 02:35:12,495 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-24 02:35:12,495 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-24 02:35:12,496 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-24 02:35:23,233 reid_baseline.train INFO: start training
2022-04-24 02:36:05,844 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.044, Acc: 0.238, Base Lr: 8.72e-04
2022-04-24 02:36:37,439 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.965, Acc: 0.348, Base Lr: 8.72e-04
2022-04-24 02:37:02,339 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-24 02:38:56,811 reid_baseline.train INFO: normal accuracy 0.5643791599724581 4.1696248054504395 
2022-04-24 02:39:26,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-24 02:39:26,753 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 417.0%
2022-04-24 02:40:01,760 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.613, Acc: 0.545, Base Lr: 1.66e-03
2022-04-24 02:40:32,819 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.475, Acc: 0.546, Base Lr: 1.66e-03
2022-04-24 02:40:55,609 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-24 02:42:59,786 reid_baseline.train INFO: normal accuracy 0.5871012164333257 4.099239349365234 
2022-04-24 02:43:29,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-24 02:43:29,784 reid_baseline.train INFO: Accuracy: 58.7% Mean Entropy: 409.9%
2022-04-24 02:44:05,053 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.852, Acc: 0.587, Base Lr: 2.46e-03
2022-04-24 02:44:35,083 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.698, Acc: 0.590, Base Lr: 2.46e-03
2022-04-24 02:44:56,729 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-24 02:47:02,295 reid_baseline.train INFO: normal accuracy 0.6385127381225614 3.6170284748077393 
2022-04-24 02:47:32,282 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-24 02:47:32,282 reid_baseline.train INFO: Accuracy: 63.9% Mean Entropy: 361.7%
2022-04-24 02:48:09,147 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.059, Acc: 0.639, Base Lr: 3.25e-03
2022-04-24 02:48:39,303 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.946, Acc: 0.669, Base Lr: 3.25e-03
2022-04-24 02:49:00,398 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.323[s] Speed: 49.6[samples/s]
2022-04-24 02:50:57,952 reid_baseline.train INFO: normal accuracy 0.7066789075051642 2.8967854976654053 
2022-04-24 02:51:27,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-24 02:51:27,900 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 289.7%
2022-04-24 02:52:01,257 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.607, Acc: 0.743, Base Lr: 4.04e-03
2022-04-24 02:52:31,621 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.556, Acc: 0.739, Base Lr: 4.04e-03
2022-04-24 02:52:53,078 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-24 02:54:54,727 reid_baseline.train INFO: normal accuracy 0.744778517328437 2.4706203937530518 
2022-04-24 02:55:24,700 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-24 02:55:24,700 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 247.1%
2022-04-24 02:55:57,114 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.334, Acc: 0.784, Base Lr: 4.83e-03
2022-04-24 02:56:28,370 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.327, Acc: 0.781, Base Lr: 4.83e-03
2022-04-24 02:56:49,976 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-24 02:59:01,960 reid_baseline.train INFO: normal accuracy 0.7647463851273812 2.1938202381134033 
2022-04-24 02:59:31,934 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-24 02:59:31,934 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 219.4%
2022-04-24 03:00:05,102 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.232, Acc: 0.803, Base Lr: 5.62e-03
2022-04-24 03:00:34,843 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.202, Acc: 0.815, Base Lr: 5.62e-03
2022-04-24 03:00:58,013 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.315[s] Speed: 50.7[samples/s]
2022-04-24 03:02:56,151 reid_baseline.train INFO: normal accuracy 0.7704842781730549 2.0251400470733643 
2022-04-24 03:03:26,126 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-24 03:03:26,126 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 202.5%
2022-04-24 03:04:01,264 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.102, Acc: 0.845, Base Lr: 6.42e-03
2022-04-24 03:04:29,935 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.107, Acc: 0.837, Base Lr: 6.42e-03
2022-04-24 03:04:51,870 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.314[s] Speed: 51.0[samples/s]
2022-04-24 03:06:48,970 reid_baseline.train INFO: normal accuracy 0.7775992655496902 1.914542555809021 
2022-04-24 03:07:18,985 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-24 03:07:18,986 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 191.5%
2022-04-24 03:07:51,428 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.039, Acc: 0.861, Base Lr: 7.21e-03
2022-04-24 03:08:20,347 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.032, Acc: 0.861, Base Lr: 7.21e-03
2022-04-24 03:08:41,677 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-24 03:10:43,184 reid_baseline.train INFO: normal accuracy 0.7821895799862291 1.8339875936508179 
2022-04-24 03:11:13,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-24 03:11:13,142 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 183.4%
2022-04-24 03:11:47,705 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.964, Acc: 0.877, Base Lr: 4.01e-03
2022-04-24 03:12:16,893 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.943, Acc: 0.888, Base Lr: 4.01e-03
2022-04-24 03:12:39,067 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.315[s] Speed: 50.8[samples/s]
2022-04-24 03:15:08,732 reid_baseline.train INFO: normal accuracy 0.782648611429883 1.8408881425857544 
2022-04-24 03:15:08,733 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-24 03:15:08,733 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 184.1%
2022-04-24 03:15:41,899 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.909, Acc: 0.901, Base Lr: 3.38e-03
2022-04-24 03:16:11,490 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.928, Acc: 0.895, Base Lr: 3.38e-03
2022-04-24 03:16:33,151 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-24 03:18:33,259 reid_baseline.train INFO: normal accuracy 0.7812715170989213 1.7611042261123657 
2022-04-24 03:19:03,217 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-24 03:19:03,218 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 176.1%
2022-04-24 03:19:38,908 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.937, Acc: 0.888, Base Lr: 2.77e-03
2022-04-24 03:20:09,774 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.904, Acc: 0.900, Base Lr: 2.77e-03
2022-04-24 03:20:30,838 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-24 03:22:32,737 reid_baseline.train INFO: normal accuracy 0.7847142529263255 1.7302385568618774 
2022-04-24 03:23:02,703 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-24 03:23:02,703 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 173.0%
2022-04-24 03:23:37,537 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.914, Acc: 0.893, Base Lr: 2.20e-03
2022-04-24 03:24:07,032 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.892, Acc: 0.900, Base Lr: 2.20e-03
2022-04-24 03:24:27,134 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-24 03:26:32,249 reid_baseline.train INFO: normal accuracy 0.7879274730319027 1.800580382347107 
2022-04-24 03:26:32,249 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-24 03:26:32,249 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 180.1%
2022-04-24 03:27:05,382 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.886, Acc: 0.897, Base Lr: 1.66e-03
2022-04-24 03:27:38,589 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.860, Acc: 0.908, Base Lr: 1.66e-03
2022-04-24 03:28:01,776 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-24 03:30:00,173 reid_baseline.train INFO: normal accuracy 0.7899931145283452 1.7764030694961548 
2022-04-24 03:30:00,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-24 03:30:00,174 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 177.6%
2022-04-24 03:30:34,107 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.838, Acc: 0.917, Base Lr: 1.19e-03
2022-04-24 03:31:05,322 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.857, Acc: 0.913, Base Lr: 1.19e-03
2022-04-24 03:31:29,724 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-24 03:33:30,728 reid_baseline.train INFO: normal accuracy 0.7863208629791141 1.7809208631515503 
2022-04-24 03:33:30,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-24 03:33:30,729 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 178.1%
2022-04-24 03:34:03,900 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.863, Acc: 0.917, Base Lr: 7.78e-04
2022-04-24 03:34:35,186 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.853, Acc: 0.917, Base Lr: 7.78e-04
2022-04-24 03:34:58,545 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-24 03:36:56,267 reid_baseline.train INFO: normal accuracy 0.7904521459719991 1.7480372190475464 
2022-04-24 03:36:56,269 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-24 03:36:56,270 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 174.8%
2022-04-24 03:37:30,946 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.846, Acc: 0.911, Base Lr: 4.51e-04
2022-04-24 03:38:01,926 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.831, Acc: 0.914, Base Lr: 4.51e-04
2022-04-24 03:38:25,294 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.326[s] Speed: 49.1[samples/s]
2022-04-24 03:40:25,024 reid_baseline.train INFO: normal accuracy 0.7879274730319027 1.75637686252594 
2022-04-24 03:40:25,025 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-24 03:40:25,025 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 175.6%
2022-04-24 03:40:58,420 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.819, Acc: 0.924, Base Lr: 2.11e-04
2022-04-24 03:41:30,745 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.811, Acc: 0.923, Base Lr: 2.11e-04
2022-04-24 03:41:53,029 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.322[s] Speed: 49.6[samples/s]
2022-04-24 03:43:51,584 reid_baseline.train INFO: normal accuracy 0.7911406931374799 1.74862802028656 
2022-04-24 03:43:51,584 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-24 03:43:51,585 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 174.9%
2022-04-24 03:44:27,273 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.813, Acc: 0.925, Base Lr: 6.51e-05
2022-04-24 03:44:57,598 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.814, Acc: 0.918, Base Lr: 6.51e-05
2022-04-24 03:45:20,610 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.326[s] Speed: 49.1[samples/s]
2022-04-24 03:47:18,726 reid_baseline.train INFO: normal accuracy 0.7895340830846913 1.731042504310608 
2022-04-24 03:47:18,727 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-24 03:47:18,727 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 173.1%
2022-04-24 03:47:53,164 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.797, Acc: 0.920, Base Lr: 1.60e-05
2022-04-24 03:48:24,085 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.810, Acc: 0.917, Base Lr: 1.60e-05
2022-04-24 03:48:48,855 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-24 03:51:21,978 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.6794308423995972 
2022-04-24 03:51:51,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-24 03:51:51,938 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 167.9%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-24 03:54:21,723 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.6794308423995972 
2022-04-24 03:54:21,724 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 03:54:21,724 reid_baseline.train INFO: Accuracy: 79.2%
2022-04-24 03:56:24,095 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.6794308423995972 
2022-04-24 03:56:24,102 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 03:56:24,106 reid_baseline.train INFO: Shuffled Accuracy: 79.2%
2022-04-24 03:57:09,480 reid_baseline.train INFO: normal accuracy 0.9500572737686139 0.8281816840171814 
2022-04-24 03:57:09,481 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 03:57:09,481 reid_baseline.train INFO: Source Clean Accuracy: 95.0%
2022-04-24 03:57:15,833 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6
2022-04-24 03:57:15,833 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-24 03:57:15,833 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-24 03:57:15,833 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-24 03:57:15,834 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-24 03:57:25,299 reid_baseline.train INFO: start training
2022-04-24 03:58:06,998 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.018, Acc: 0.226, Base Lr: 8.72e-04
2022-04-24 03:58:38,097 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.956, Acc: 0.340, Base Lr: 8.72e-04
2022-04-24 03:59:00,452 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-24 03:59:37,060 reid_baseline.train INFO: normal accuracy 0.4903172641120725 4.1704607009887695 
2022-04-24 04:00:06,963 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-24 04:00:06,964 reid_baseline.train INFO: Accuracy: 49.0% Mean Entropy: 417.0%
2022-04-24 04:00:42,238 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.654, Acc: 0.544, Base Lr: 1.66e-03
2022-04-24 04:01:12,720 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.538, Acc: 0.544, Base Lr: 1.66e-03
2022-04-24 04:01:36,306 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.327[s] Speed: 48.9[samples/s]
2022-04-24 04:02:14,375 reid_baseline.train INFO: normal accuracy 0.5274000824062629 4.122212886810303 
2022-04-24 04:02:44,337 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-24 04:02:44,337 reid_baseline.train INFO: Accuracy: 52.7% Mean Entropy: 412.2%
2022-04-24 04:03:16,080 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.945, Acc: 0.580, Base Lr: 2.46e-03
2022-04-24 04:03:45,438 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.787, Acc: 0.585, Base Lr: 2.46e-03
2022-04-24 04:04:06,859 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-24 04:04:42,521 reid_baseline.train INFO: normal accuracy 0.5830243098475484 3.7755813598632812 
2022-04-24 04:05:12,484 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-24 04:05:12,484 reid_baseline.train INFO: Accuracy: 58.3% Mean Entropy: 377.6%
2022-04-24 04:05:43,253 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.134, Acc: 0.632, Base Lr: 3.25e-03
2022-04-24 04:06:11,856 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.014, Acc: 0.659, Base Lr: 3.25e-03
2022-04-24 04:06:32,698 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-24 04:07:11,637 reid_baseline.train INFO: normal accuracy 0.6452410383189122 3.1511943340301514 
2022-04-24 04:07:41,607 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-24 04:07:41,608 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 315.1%
2022-04-24 04:08:12,298 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.649, Acc: 0.732, Base Lr: 4.04e-03
2022-04-24 04:08:39,699 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.594, Acc: 0.732, Base Lr: 4.04e-03
2022-04-24 04:09:01,002 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-24 04:09:34,660 reid_baseline.train INFO: normal accuracy 0.6880922950144212 2.7630667686462402 
2022-04-24 04:10:04,615 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-24 04:10:04,615 reid_baseline.train INFO: Accuracy: 68.8% Mean Entropy: 276.3%
2022-04-24 04:10:36,094 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.369, Acc: 0.782, Base Lr: 4.83e-03
2022-04-24 04:11:05,545 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.370, Acc: 0.777, Base Lr: 4.83e-03
2022-04-24 04:11:26,827 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-24 04:12:01,952 reid_baseline.train INFO: normal accuracy 0.7103419859909353 2.460952043533325 
2022-04-24 04:12:31,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-24 04:12:31,933 reid_baseline.train INFO: Accuracy: 71.0% Mean Entropy: 246.1%
2022-04-24 04:13:03,090 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.261, Acc: 0.804, Base Lr: 5.62e-03
2022-04-24 04:13:31,895 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.228, Acc: 0.814, Base Lr: 5.62e-03
2022-04-24 04:13:53,182 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-24 04:14:28,046 reid_baseline.train INFO: normal accuracy 0.7124021425628347 2.2617435455322266 
2022-04-24 04:14:58,012 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-24 04:14:58,013 reid_baseline.train INFO: Accuracy: 71.2% Mean Entropy: 226.2%
2022-04-24 04:15:29,608 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.137, Acc: 0.836, Base Lr: 6.42e-03
2022-04-24 04:15:58,716 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.130, Acc: 0.832, Base Lr: 6.42e-03
2022-04-24 04:16:19,845 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-24 04:16:53,940 reid_baseline.train INFO: normal accuracy 0.7330037082818294 2.143247365951538 
2022-04-24 04:17:23,900 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-24 04:17:23,901 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 214.3%
2022-04-24 04:17:55,289 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.048, Acc: 0.853, Base Lr: 7.21e-03
2022-04-24 04:18:23,602 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.044, Acc: 0.856, Base Lr: 7.21e-03
2022-04-24 04:18:44,638 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-24 04:19:18,172 reid_baseline.train INFO: normal accuracy 0.7301194890811702 2.0551795959472656 
2022-04-24 04:19:48,153 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-24 04:19:48,153 reid_baseline.train INFO: Accuracy: 73.0% Mean Entropy: 205.5%
2022-04-24 04:20:19,458 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.985, Acc: 0.875, Base Lr: 4.01e-03
2022-04-24 04:20:47,783 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.965, Acc: 0.886, Base Lr: 4.01e-03
2022-04-24 04:21:09,298 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-24 04:22:13,071 reid_baseline.train INFO: normal accuracy 0.7367119901112484 2.031611442565918 
2022-04-24 04:22:43,038 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-24 04:22:43,038 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 203.2%
2022-04-24 04:23:14,204 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.908, Acc: 0.894, Base Lr: 3.38e-03
2022-04-24 04:23:42,648 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.936, Acc: 0.891, Base Lr: 3.38e-03
2022-04-24 04:24:03,245 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-24 04:24:38,947 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.9371381998062134 
2022-04-24 04:25:08,906 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-24 04:25:08,907 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 193.7%
2022-04-24 04:25:40,534 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.958, Acc: 0.875, Base Lr: 2.77e-03
2022-04-24 04:26:09,696 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.912, Acc: 0.893, Base Lr: 2.77e-03
2022-04-24 04:26:30,924 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-24 04:27:04,722 reid_baseline.train INFO: normal accuracy 0.7375360527400082 1.926697850227356 
2022-04-24 04:27:34,690 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-24 04:27:34,690 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 192.7%
2022-04-24 04:28:05,938 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.903, Acc: 0.894, Base Lr: 2.20e-03
2022-04-24 04:28:35,738 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.893, Acc: 0.901, Base Lr: 2.20e-03
2022-04-24 04:28:54,995 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-24 04:29:31,135 reid_baseline.train INFO: normal accuracy 0.7358879274824887 1.9610328674316406 
2022-04-24 04:29:31,135 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-24 04:29:31,135 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 196.1%
2022-04-24 04:30:02,149 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.892, Acc: 0.890, Base Lr: 1.66e-03
2022-04-24 04:30:30,980 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.862, Acc: 0.900, Base Lr: 1.66e-03
2022-04-24 04:30:51,671 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-24 04:31:27,288 reid_baseline.train INFO: normal accuracy 0.7367119901112484 1.954329252243042 
2022-04-24 04:31:27,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-24 04:31:27,288 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 195.4%
2022-04-24 04:31:58,132 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.850, Acc: 0.915, Base Lr: 1.19e-03
2022-04-24 04:32:27,852 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.870, Acc: 0.911, Base Lr: 1.19e-03
2022-04-24 04:32:48,947 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-24 04:33:23,887 reid_baseline.train INFO: normal accuracy 0.7338277709105891 1.9421683549880981 
2022-04-24 04:33:23,888 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-24 04:33:23,888 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 194.2%
2022-04-24 04:33:54,589 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.867, Acc: 0.913, Base Lr: 7.78e-04
2022-04-24 04:34:23,252 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.858, Acc: 0.913, Base Lr: 7.78e-04
2022-04-24 04:34:44,550 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-24 04:35:17,628 reid_baseline.train INFO: normal accuracy 0.7404202719406675 1.9320669174194336 
2022-04-24 04:35:17,630 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-24 04:35:17,630 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 193.2%
2022-04-24 04:35:48,371 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.850, Acc: 0.912, Base Lr: 4.51e-04
2022-04-24 04:36:17,650 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.840, Acc: 0.910, Base Lr: 4.51e-04
2022-04-24 04:36:39,560 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-24 04:37:12,468 reid_baseline.train INFO: normal accuracy 0.7395962093119077 1.9406418800354004 
2022-04-24 04:37:12,469 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-24 04:37:12,469 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 194.1%
2022-04-24 04:37:43,636 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.837, Acc: 0.913, Base Lr: 2.11e-04
2022-04-24 04:38:11,398 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.830, Acc: 0.914, Base Lr: 2.11e-04
2022-04-24 04:38:32,133 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-24 04:39:07,624 reid_baseline.train INFO: normal accuracy 0.7367119901112484 1.9239484071731567 
2022-04-24 04:39:37,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-24 04:39:37,568 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 192.4%
2022-04-24 04:40:08,494 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.816, Acc: 0.921, Base Lr: 6.51e-05
2022-04-24 04:40:36,202 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.827, Acc: 0.914, Base Lr: 6.51e-05
2022-04-24 04:40:57,129 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-24 04:41:34,159 reid_baseline.train INFO: normal accuracy 0.7367119901112484 1.899396300315857 
2022-04-24 04:42:04,147 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-24 04:42:04,147 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 189.9%
2022-04-24 04:42:35,658 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.807, Acc: 0.921, Base Lr: 1.60e-05
2022-04-24 04:43:05,459 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.818, Acc: 0.919, Base Lr: 1.60e-05
2022-04-24 04:43:27,309 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.305[s] Speed: 52.5[samples/s]
2022-04-24 04:44:35,277 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.8538968563079834 
2022-04-24 04:45:05,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-24 04:45:05,242 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 185.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-24 04:46:09,378 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.8538968563079834 
2022-04-24 04:46:09,378 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 04:46:09,378 reid_baseline.train INFO: Accuracy: 74.2%
2022-04-24 04:46:42,653 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.8538968563079834 
2022-04-24 04:46:42,654 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 04:46:42,654 reid_baseline.train INFO: Shuffled Accuracy: 74.2%
2022-04-24 04:47:26,336 reid_baseline.train INFO: normal accuracy 0.9461626575028637 0.8402200937271118 
2022-04-24 04:47:26,336 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 04:47:26,337 reid_baseline.train INFO: Source Clean Accuracy: 94.6%
2022-04-24 04:47:31,768 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6
2022-04-24 04:47:31,768 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-24 04:47:31,768 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-24 04:47:31,768 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-24 04:47:31,768 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-24 04:47:41,284 reid_baseline.train INFO: start training
2022-04-24 04:48:20,247 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.018, Acc: 0.226, Base Lr: 8.72e-04
2022-04-24 04:48:48,728 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.956, Acc: 0.341, Base Lr: 8.72e-04
2022-04-24 04:49:10,038 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-24 04:49:52,729 reid_baseline.train INFO: normal accuracy 0.5408875872944356 4.169574737548828 
2022-04-24 04:50:22,633 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-24 04:50:22,634 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 417.0%
2022-04-24 04:50:54,917 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.654, Acc: 0.545, Base Lr: 1.66e-03
2022-04-24 04:51:24,012 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.538, Acc: 0.545, Base Lr: 1.66e-03
2022-04-24 04:51:46,681 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-24 04:52:32,061 reid_baseline.train INFO: normal accuracy 0.5631899076368552 4.104611396789551 
2022-04-24 04:53:02,004 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-24 04:53:02,004 reid_baseline.train INFO: Accuracy: 56.3% Mean Entropy: 410.5%
2022-04-24 04:53:34,269 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.945, Acc: 0.580, Base Lr: 2.46e-03
2022-04-24 04:54:03,374 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.788, Acc: 0.585, Base Lr: 2.46e-03
2022-04-24 04:54:25,685 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.306[s] Speed: 52.2[samples/s]
2022-04-24 04:55:09,650 reid_baseline.train INFO: normal accuracy 0.6057670646542014 3.6424918174743652 
2022-04-24 04:55:39,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-24 04:55:39,603 reid_baseline.train INFO: Accuracy: 60.6% Mean Entropy: 364.2%
2022-04-24 04:56:10,960 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.134, Acc: 0.632, Base Lr: 3.25e-03
2022-04-24 04:56:39,188 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.014, Acc: 0.660, Base Lr: 3.25e-03
2022-04-24 04:56:59,828 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-24 04:57:43,686 reid_baseline.train INFO: normal accuracy 0.673349853570624 2.9127132892608643 
2022-04-24 04:58:13,622 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-24 04:58:13,622 reid_baseline.train INFO: Accuracy: 67.3% Mean Entropy: 291.3%
2022-04-24 04:58:44,779 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.649, Acc: 0.732, Base Lr: 4.04e-03
2022-04-24 04:59:14,176 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.594, Acc: 0.732, Base Lr: 4.04e-03
2022-04-24 04:59:35,602 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-24 05:00:23,335 reid_baseline.train INFO: normal accuracy 0.7028610047307953 2.4650843143463135 
2022-04-24 05:00:53,320 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-24 05:00:53,320 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 246.5%
2022-04-24 05:01:23,772 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.369, Acc: 0.782, Base Lr: 4.83e-03
2022-04-24 05:01:52,554 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.370, Acc: 0.777, Base Lr: 4.83e-03
2022-04-24 05:02:13,790 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-24 05:03:01,175 reid_baseline.train INFO: normal accuracy 0.7213336337012841 2.1803345680236816 
2022-04-24 05:03:31,141 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-24 05:03:31,142 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 218.0%
2022-04-24 05:04:02,296 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.261, Acc: 0.804, Base Lr: 5.62e-03
2022-04-24 05:04:31,637 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.228, Acc: 0.814, Base Lr: 5.62e-03
2022-04-24 05:04:52,907 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.299[s] Speed: 53.4[samples/s]
2022-04-24 05:05:37,017 reid_baseline.train INFO: normal accuracy 0.7373282270781708 2.0036442279815674 
2022-04-24 05:06:06,979 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-24 05:06:06,979 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 200.4%
2022-04-24 05:06:39,368 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.137, Acc: 0.835, Base Lr: 6.42e-03
2022-04-24 05:07:09,075 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.131, Acc: 0.832, Base Lr: 6.42e-03
2022-04-24 05:07:29,887 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-24 05:08:13,577 reid_baseline.train INFO: normal accuracy 0.7454381617481415 1.9058843851089478 
2022-04-24 05:08:43,558 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-24 05:08:43,559 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 190.6%
2022-04-24 05:09:14,739 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.048, Acc: 0.852, Base Lr: 7.21e-03
2022-04-24 05:09:43,939 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.044, Acc: 0.856, Base Lr: 7.21e-03
2022-04-24 05:10:04,650 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-24 05:10:47,792 reid_baseline.train INFO: normal accuracy 0.7499436810092364 1.8349381685256958 
2022-04-24 05:11:17,733 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-24 05:11:17,734 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 183.5%
2022-04-24 05:11:48,268 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.985, Acc: 0.876, Base Lr: 4.01e-03
2022-04-24 05:12:16,688 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.965, Acc: 0.886, Base Lr: 4.01e-03
2022-04-24 05:12:37,255 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-24 05:13:51,179 reid_baseline.train INFO: normal accuracy 0.751971164676729 1.824191927909851 
2022-04-24 05:14:21,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-24 05:14:21,162 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 182.4%
2022-04-24 05:14:51,959 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.908, Acc: 0.895, Base Lr: 3.38e-03
2022-04-24 05:15:21,222 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.936, Acc: 0.891, Base Lr: 3.38e-03
2022-04-24 05:15:42,328 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-24 05:16:25,366 reid_baseline.train INFO: normal accuracy 0.7609822031989186 1.740301489830017 
2022-04-24 05:16:55,336 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-24 05:16:55,337 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 174.0%
2022-04-24 05:17:27,328 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.958, Acc: 0.875, Base Lr: 2.77e-03
2022-04-24 05:17:56,113 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.912, Acc: 0.893, Base Lr: 2.77e-03
2022-04-24 05:18:16,822 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-24 05:19:04,682 reid_baseline.train INFO: normal accuracy 0.7654877224600135 1.7549694776535034 
2022-04-24 05:19:04,683 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-24 05:19:04,683 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 175.5%
2022-04-24 05:19:36,380 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.903, Acc: 0.894, Base Lr: 2.20e-03
2022-04-24 05:20:05,327 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.893, Acc: 0.901, Base Lr: 2.20e-03
2022-04-24 05:20:25,545 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-24 05:21:13,671 reid_baseline.train INFO: normal accuracy 0.7666141022752873 1.7899746894836426 
2022-04-24 05:21:13,671 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-24 05:21:13,671 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 179.0%
2022-04-24 05:21:43,484 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.892, Acc: 0.890, Base Lr: 1.66e-03
2022-04-24 05:22:11,881 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.862, Acc: 0.899, Base Lr: 1.66e-03
2022-04-24 05:22:32,595 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.289[s] Speed: 55.5[samples/s]
2022-04-24 05:23:18,794 reid_baseline.train INFO: normal accuracy 0.7670646542013967 1.7838804721832275 
2022-04-24 05:23:18,796 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-24 05:23:18,797 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 178.4%
2022-04-24 05:23:49,195 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.850, Acc: 0.915, Base Lr: 1.19e-03
2022-04-24 05:24:18,449 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.870, Acc: 0.911, Base Lr: 1.19e-03
2022-04-24 05:24:39,649 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-24 05:25:24,137 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.7816158533096313 
2022-04-24 05:25:24,137 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-24 05:25:24,137 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 178.2%
2022-04-24 05:25:54,951 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.867, Acc: 0.914, Base Lr: 7.78e-04
2022-04-24 05:26:23,755 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.858, Acc: 0.913, Base Lr: 7.78e-04
2022-04-24 05:26:45,006 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-24 05:27:27,832 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.7626662254333496 
2022-04-24 05:27:27,835 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-24 05:27:27,835 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 176.3%
2022-04-24 05:27:58,582 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.850, Acc: 0.913, Base Lr: 4.51e-04
2022-04-24 05:28:26,879 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.840, Acc: 0.911, Base Lr: 4.51e-04
2022-04-24 05:28:48,613 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-24 05:29:33,015 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.7778847217559814 
2022-04-24 05:29:33,015 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-24 05:29:33,015 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 177.8%
2022-04-24 05:30:04,550 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.838, Acc: 0.912, Base Lr: 2.11e-04
2022-04-24 05:30:32,883 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.830, Acc: 0.914, Base Lr: 2.11e-04
2022-04-24 05:30:52,934 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-24 05:31:37,054 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.7736648321151733 
2022-04-24 05:31:37,055 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-24 05:31:37,055 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 177.4%
2022-04-24 05:32:08,289 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.817, Acc: 0.921, Base Lr: 6.51e-05
2022-04-24 05:32:37,694 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.827, Acc: 0.915, Base Lr: 6.51e-05
2022-04-24 05:32:58,677 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-24 05:33:44,421 reid_baseline.train INFO: normal accuracy 0.7686415859427799 1.7287607192993164 
2022-04-24 05:34:14,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-24 05:34:14,366 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 172.9%
2022-04-24 05:34:45,862 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.807, Acc: 0.921, Base Lr: 1.60e-05
2022-04-24 05:35:15,278 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.818, Acc: 0.919, Base Lr: 1.60e-05
2022-04-24 05:35:36,226 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.299[s] Speed: 53.4[samples/s]
2022-04-24 05:36:50,691 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.6899672746658325 
2022-04-24 05:37:20,641 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-24 05:37:20,641 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 169.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-24 05:38:38,533 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.6899672746658325 
2022-04-24 05:38:38,534 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 05:38:38,534 reid_baseline.train INFO: Accuracy: 76.9%
2022-04-24 05:39:22,997 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.6899672746658325 
2022-04-24 05:39:22,998 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 05:39:22,998 reid_baseline.train INFO: Shuffled Accuracy: 76.9%
2022-04-24 05:40:06,933 reid_baseline.train INFO: normal accuracy 0.9461626575028637 0.8402612805366516 
2022-04-24 05:40:06,934 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 05:40:06,934 reid_baseline.train INFO: Source Clean Accuracy: 94.6%
2022-04-24 05:40:13,540 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6
2022-04-24 05:40:13,540 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-24 05:40:13,540 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-24 05:40:13,541 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-24 05:40:13,541 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-24 05:40:22,589 reid_baseline.train INFO: start training
2022-04-24 05:40:59,801 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.018, Acc: 0.226, Base Lr: 8.72e-04
2022-04-24 05:41:28,343 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.956, Acc: 0.340, Base Lr: 8.72e-04
2022-04-24 05:41:49,180 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.314[s] Speed: 51.0[samples/s]
2022-04-24 05:43:38,214 reid_baseline.train INFO: normal accuracy 0.5545099839338995 4.170180797576904 
2022-04-24 05:44:08,120 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-24 05:44:08,120 reid_baseline.train INFO: Accuracy: 55.5% Mean Entropy: 417.0%
2022-04-24 05:44:39,374 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.654, Acc: 0.545, Base Lr: 1.66e-03
2022-04-24 05:45:08,541 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.538, Acc: 0.544, Base Lr: 1.66e-03
2022-04-24 05:45:30,384 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-24 05:47:21,593 reid_baseline.train INFO: normal accuracy 0.5861831535460179 4.113492012023926 
2022-04-24 05:47:51,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-24 05:47:51,586 reid_baseline.train INFO: Accuracy: 58.6% Mean Entropy: 411.3%
2022-04-24 05:48:23,931 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.945, Acc: 0.580, Base Lr: 2.46e-03
2022-04-24 05:48:52,835 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.787, Acc: 0.585, Base Lr: 2.46e-03
2022-04-24 05:49:14,410 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-24 05:51:08,707 reid_baseline.train INFO: normal accuracy 0.6343814551296764 3.6809072494506836 
2022-04-24 05:51:38,683 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-24 05:51:38,683 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 368.1%
2022-04-24 05:52:09,800 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.134, Acc: 0.633, Base Lr: 3.25e-03
2022-04-24 05:52:38,488 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.014, Acc: 0.660, Base Lr: 3.25e-03
2022-04-24 05:52:59,069 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-24 05:54:44,486 reid_baseline.train INFO: normal accuracy 0.6949736056919898 2.9567039012908936 
2022-04-24 05:55:14,442 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-24 05:55:14,442 reid_baseline.train INFO: Accuracy: 69.5% Mean Entropy: 295.7%
2022-04-24 05:55:44,550 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.649, Acc: 0.731, Base Lr: 4.04e-03
2022-04-24 05:56:12,817 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.594, Acc: 0.731, Base Lr: 4.04e-03
2022-04-24 05:56:33,884 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-24 05:58:37,104 reid_baseline.train INFO: normal accuracy 0.732384668349782 2.517650604248047 
2022-04-24 05:59:07,070 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-24 05:59:07,070 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 251.8%
2022-04-24 05:59:38,069 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.369, Acc: 0.782, Base Lr: 4.83e-03
2022-04-24 06:00:07,415 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.370, Acc: 0.777, Base Lr: 4.83e-03
2022-04-24 06:00:28,160 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-24 06:02:23,918 reid_baseline.train INFO: normal accuracy 0.7613036492999771 2.226675271987915 
2022-04-24 06:02:53,889 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-24 06:02:53,889 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 222.7%
2022-04-24 06:03:25,170 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.261, Acc: 0.804, Base Lr: 5.62e-03
2022-04-24 06:03:54,280 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.228, Acc: 0.814, Base Lr: 5.62e-03
2022-04-24 06:04:15,387 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-24 06:06:02,689 reid_baseline.train INFO: normal accuracy 0.7640578379619004 2.040459156036377 
2022-04-24 06:06:32,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-24 06:06:32,667 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 204.0%
2022-04-24 06:07:04,825 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.137, Acc: 0.835, Base Lr: 6.42e-03
2022-04-24 06:07:33,512 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.130, Acc: 0.833, Base Lr: 6.42e-03
2022-04-24 06:07:54,647 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-24 06:09:40,091 reid_baseline.train INFO: normal accuracy 0.7727794353913243 1.9370286464691162 
2022-04-24 06:10:10,062 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-24 06:10:10,062 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 193.7%
2022-04-24 06:10:41,022 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.047, Acc: 0.854, Base Lr: 7.21e-03
2022-04-24 06:11:10,426 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.044, Acc: 0.856, Base Lr: 7.21e-03
2022-04-24 06:11:31,451 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-24 06:13:18,805 reid_baseline.train INFO: normal accuracy 0.7771402341060363 1.860143780708313 
2022-04-24 06:13:48,777 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-24 06:13:48,778 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 186.0%
2022-04-24 06:14:19,208 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.985, Acc: 0.876, Base Lr: 4.01e-03
2022-04-24 06:14:47,873 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.965, Acc: 0.886, Base Lr: 4.01e-03
2022-04-24 06:15:08,317 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-24 06:17:29,724 reid_baseline.train INFO: normal accuracy 0.7778287812715171 1.8504656553268433 
2022-04-24 06:17:59,707 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-24 06:17:59,707 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 185.0%
2022-04-24 06:18:30,694 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.907, Acc: 0.896, Base Lr: 3.38e-03
2022-04-24 06:18:59,492 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.935, Acc: 0.892, Base Lr: 3.38e-03
2022-04-24 06:19:20,798 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-24 06:21:11,373 reid_baseline.train INFO: normal accuracy 0.7831076428735368 1.764670729637146 
2022-04-24 06:21:41,348 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-24 06:21:41,348 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 176.5%
2022-04-24 06:22:13,549 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.958, Acc: 0.874, Base Lr: 2.77e-03
2022-04-24 06:22:41,846 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.912, Acc: 0.892, Base Lr: 2.77e-03
2022-04-24 06:23:03,657 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-24 06:24:55,733 reid_baseline.train INFO: normal accuracy 0.7847142529263255 1.7667138576507568 
2022-04-24 06:24:55,734 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-24 06:24:55,734 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 176.7%
2022-04-24 06:25:27,376 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.902, Acc: 0.894, Base Lr: 2.20e-03
2022-04-24 06:25:57,152 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.893, Acc: 0.900, Base Lr: 2.20e-03
2022-04-24 06:26:17,168 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-24 06:28:10,766 reid_baseline.train INFO: normal accuracy 0.7870094101445949 1.8032593727111816 
2022-04-24 06:28:10,767 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-24 06:28:10,767 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 180.3%
2022-04-24 06:28:41,516 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.892, Acc: 0.889, Base Lr: 1.66e-03
2022-04-24 06:29:10,569 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.862, Acc: 0.900, Base Lr: 1.66e-03
2022-04-24 06:29:32,278 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-24 06:31:21,618 reid_baseline.train INFO: normal accuracy 0.7870094101445949 1.7944483757019043 
2022-04-24 06:31:21,619 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-24 06:31:21,619 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 179.4%
2022-04-24 06:31:53,381 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.850, Acc: 0.915, Base Lr: 1.19e-03
2022-04-24 06:32:21,844 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.870, Acc: 0.911, Base Lr: 1.19e-03
2022-04-24 06:32:42,170 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-24 06:34:39,196 reid_baseline.train INFO: normal accuracy 0.7856323158136332 1.790712833404541 
2022-04-24 06:34:39,197 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-24 06:34:39,197 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 179.1%
2022-04-24 06:35:11,047 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.867, Acc: 0.913, Base Lr: 7.78e-04
2022-04-24 06:35:40,133 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.858, Acc: 0.914, Base Lr: 7.78e-04
2022-04-24 06:36:00,613 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-24 06:37:53,791 reid_baseline.train INFO: normal accuracy 0.7883865044755566 1.7747373580932617 
2022-04-24 06:37:53,791 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-24 06:37:53,791 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 177.5%
2022-04-24 06:38:25,430 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.850, Acc: 0.912, Base Lr: 4.51e-04
2022-04-24 06:38:54,104 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.840, Acc: 0.910, Base Lr: 4.51e-04
2022-04-24 06:39:15,931 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-24 06:41:07,350 reid_baseline.train INFO: normal accuracy 0.7851732843699794 1.7884390354156494 
2022-04-24 06:41:07,351 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-24 06:41:07,351 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 178.8%
2022-04-24 06:41:38,710 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.837, Acc: 0.912, Base Lr: 2.11e-04
2022-04-24 06:42:07,341 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.830, Acc: 0.914, Base Lr: 2.11e-04
2022-04-24 06:42:28,151 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-24 06:44:16,945 reid_baseline.train INFO: normal accuracy 0.7881569887537296 1.784501075744629 
2022-04-24 06:44:16,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-24 06:44:16,946 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 178.5%
2022-04-24 06:44:48,056 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.816, Acc: 0.920, Base Lr: 6.51e-05
2022-04-24 06:45:16,522 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.827, Acc: 0.913, Base Lr: 6.51e-05
2022-04-24 06:45:37,451 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-24 06:47:25,080 reid_baseline.train INFO: normal accuracy 0.7886160201973835 1.7432891130447388 
2022-04-24 06:47:55,056 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-24 06:47:55,056 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 174.3%
2022-04-24 06:48:26,099 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.807, Acc: 0.920, Base Lr: 1.60e-05
2022-04-24 06:48:54,727 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.818, Acc: 0.918, Base Lr: 1.60e-05
2022-04-24 06:49:15,791 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-24 06:51:33,683 reid_baseline.train INFO: normal accuracy 0.7890750516410374 1.6984201669692993 
2022-04-24 06:52:03,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-24 06:52:03,667 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 169.8%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-24 06:54:29,556 reid_baseline.train INFO: normal accuracy 0.7890750516410374 1.6984201669692993 
2022-04-24 06:54:29,556 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 06:54:29,556 reid_baseline.train INFO: Accuracy: 78.9%
2022-04-24 06:56:15,720 reid_baseline.train INFO: normal accuracy 0.7890750516410374 1.6984201669692993 
2022-04-24 06:56:15,720 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 06:56:15,720 reid_baseline.train INFO: Shuffled Accuracy: 78.9%
2022-04-24 06:56:59,573 reid_baseline.train INFO: normal accuracy 0.9459335624284078 0.8400838375091553 
2022-04-24 06:56:59,573 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-24 06:56:59,573 reid_baseline.train INFO: Source Clean Accuracy: 94.6%
