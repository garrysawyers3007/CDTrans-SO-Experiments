2022-04-13 14:54:25,724 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2
2022-04-13 14:54:25,724 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2)
2022-04-13 14:54:25,725 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 14:54:25,725 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 10
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 14:54:25,725 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 10
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 14:54:35,388 reid_baseline.train INFO: start training
2022-04-13 14:54:49,797 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.100, Acc: 0.363, Base Lr: 8.72e-04
2022-04-13 14:54:56,028 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.135[s] Speed: 118.3[samples/s]
2022-04-13 14:55:14,723 reid_baseline.train INFO: normal accuracy 0.3974799541809851 4.171079635620117 
2022-04-13 14:55:15,912 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 14:55:15,913 reid_baseline.train INFO: Accuracy: 39.7% Mean Entropy: 417.1%
2022-04-13 14:55:32,329 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.713, Acc: 0.681, Base Lr: 1.66e-03
2022-04-13 14:55:39,849 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.157[s] Speed: 101.7[samples/s]
2022-04-13 14:56:05,750 reid_baseline.train INFO: normal accuracy 0.41741122565864835 4.145342826843262 
2022-04-13 14:56:07,016 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 14:56:07,016 reid_baseline.train INFO: Accuracy: 41.7% Mean Entropy: 414.5%
2022-04-13 14:56:27,849 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.012, Acc: 0.703, Base Lr: 2.46e-03
2022-04-13 14:56:37,825 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.202[s] Speed: 79.0[samples/s]
2022-04-13 14:57:09,225 reid_baseline.train INFO: normal accuracy 0.4309278350515464 3.9870083332061768 
2022-04-13 14:57:10,579 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 14:57:10,579 reid_baseline.train INFO: Accuracy: 43.1% Mean Entropy: 398.7%
2022-04-13 14:57:29,898 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.287, Acc: 0.712, Base Lr: 3.25e-03
2022-04-13 14:57:39,647 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.189[s] Speed: 84.5[samples/s]
2022-04-13 14:58:10,732 reid_baseline.train INFO: normal accuracy 0.47056128293241695 3.4949097633361816 
2022-04-13 14:58:12,079 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 14:58:12,079 reid_baseline.train INFO: Accuracy: 47.1% Mean Entropy: 349.5%
2022-04-13 14:58:32,442 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.739, Acc: 0.790, Base Lr: 4.04e-03
2022-04-13 14:58:43,905 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.209[s] Speed: 76.6[samples/s]
2022-04-13 14:59:15,163 reid_baseline.train INFO: normal accuracy 0.5271477663230241 2.9804391860961914 
2022-04-13 14:59:16,371 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 14:59:16,371 reid_baseline.train INFO: Accuracy: 52.7% Mean Entropy: 298.0%
2022-04-13 14:59:36,940 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.435, Acc: 0.836, Base Lr: 4.83e-03
2022-04-13 14:59:46,459 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.198[s] Speed: 80.9[samples/s]
2022-04-13 15:00:21,757 reid_baseline.train INFO: normal accuracy 0.5670103092783505 2.5711042881011963 
2022-04-13 15:00:23,168 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 15:00:23,168 reid_baseline.train INFO: Accuracy: 56.7% Mean Entropy: 257.1%
2022-04-13 15:00:44,490 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.275, Acc: 0.873, Base Lr: 5.62e-03
2022-04-13 15:00:55,436 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.211[s] Speed: 75.7[samples/s]
2022-04-13 15:01:24,017 reid_baseline.train INFO: normal accuracy 0.5809851088201604 2.311213254928589 
2022-04-13 15:01:25,398 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 15:01:25,399 reid_baseline.train INFO: Accuracy: 58.1% Mean Entropy: 231.1%
2022-04-13 15:01:49,581 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.131, Acc: 0.908, Base Lr: 6.42e-03
2022-04-13 15:01:58,194 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.215[s] Speed: 74.2[samples/s]
2022-04-13 15:02:30,401 reid_baseline.train INFO: normal accuracy 0.590836197021764 2.1102049350738525 
2022-04-13 15:02:31,666 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 15:02:31,667 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 211.0%
2022-04-13 15:02:52,010 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.053, Acc: 0.941, Base Lr: 7.21e-03
2022-04-13 15:03:05,374 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.222[s] Speed: 72.2[samples/s]
2022-04-13 15:03:36,812 reid_baseline.train INFO: normal accuracy 0.5945017182130584 2.022749662399292 
2022-04-13 15:03:38,000 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 15:03:38,000 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 202.3%
2022-04-13 15:03:57,831 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 0.983, Acc: 0.952, Base Lr: 1.60e-05
2022-04-13 15:04:07,779 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.196[s] Speed: 81.8[samples/s]
2022-04-13 15:04:44,816 reid_baseline.train INFO: normal accuracy 0.5935853379152348 2.1027252674102783 
2022-04-13 15:04:44,817 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 15:04:44,817 reid_baseline.train INFO: Accuracy: 59.4% Mean Entropy: 210.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2/transformer_best_model.pth
2022-04-13 15:05:18,035 reid_baseline.train INFO: normal accuracy 0.5945017182130584 2.022749662399292 
2022-04-13 15:05:18,036 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:05:18,036 reid_baseline.train INFO: Accuracy: 59.5%
2022-04-13 15:05:46,914 reid_baseline.train INFO: normal accuracy 0.5232531500572738 2.1216847896575928 
2022-04-13 15:05:46,915 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:05:46,915 reid_baseline.train INFO: Shuffled Accuracy: 52.3%
2022-04-13 15:05:55,178 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_3
2022-04-13 15:05:55,178 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3)
2022-04-13 15:05:55,178 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 15:05:55,178 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 10
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 15:05:55,179 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 10
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 15:06:09,026 reid_baseline.train INFO: start training
2022-04-13 15:06:30,289 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.105, Acc: 0.329, Base Lr: 8.72e-04
2022-04-13 15:06:40,356 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.205[s] Speed: 78.1[samples/s]
2022-04-13 15:07:11,249 reid_baseline.train INFO: normal accuracy 0.3624284077892325 4.170930862426758 
2022-04-13 15:07:12,389 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 15:07:12,390 reid_baseline.train INFO: Accuracy: 36.2% Mean Entropy: 417.1%
2022-04-13 15:07:33,426 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.746, Acc: 0.606, Base Lr: 1.66e-03
2022-04-13 15:07:42,971 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.201[s] Speed: 79.7[samples/s]
2022-04-13 15:08:15,165 reid_baseline.train INFO: normal accuracy 0.3846506300114548 4.142737865447998 
2022-04-13 15:08:16,488 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 15:08:16,489 reid_baseline.train INFO: Accuracy: 38.5% Mean Entropy: 414.3%
2022-04-13 15:08:37,063 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.090, Acc: 0.631, Base Lr: 2.46e-03
2022-04-13 15:08:48,383 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.210[s] Speed: 76.3[samples/s]
2022-04-13 15:09:19,408 reid_baseline.train INFO: normal accuracy 0.39862542955326463 3.9807865619659424 
2022-04-13 15:09:20,711 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 15:09:20,711 reid_baseline.train INFO: Accuracy: 39.9% Mean Entropy: 398.1%
2022-04-13 15:09:40,591 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.422, Acc: 0.657, Base Lr: 3.25e-03
2022-04-13 15:09:49,642 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.190[s] Speed: 84.4[samples/s]
2022-04-13 15:10:26,167 reid_baseline.train INFO: normal accuracy 0.4329896907216495 3.570871353149414 
2022-04-13 15:10:27,606 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 15:10:27,607 reid_baseline.train INFO: Accuracy: 43.3% Mean Entropy: 357.1%
2022-04-13 15:10:49,671 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.886, Acc: 0.729, Base Lr: 4.04e-03
2022-04-13 15:11:00,953 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.219[s] Speed: 73.0[samples/s]
2022-04-13 15:11:37,174 reid_baseline.train INFO: normal accuracy 0.4827033218785796 3.1144392490386963 
2022-04-13 15:11:38,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 15:11:38,343 reid_baseline.train INFO: Accuracy: 48.3% Mean Entropy: 311.4%
2022-04-13 15:11:52,105 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.585, Acc: 0.801, Base Lr: 4.83e-03
2022-04-13 15:12:01,054 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.149[s] Speed: 107.2[samples/s]
2022-04-13 15:12:33,454 reid_baseline.train INFO: normal accuracy 0.529438717067583 2.7772066593170166 
2022-04-13 15:12:34,704 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 15:12:34,705 reid_baseline.train INFO: Accuracy: 52.9% Mean Entropy: 277.7%
2022-04-13 15:12:52,781 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.394, Acc: 0.832, Base Lr: 5.62e-03
2022-04-13 15:13:03,817 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.191[s] Speed: 83.9[samples/s]
2022-04-13 15:13:36,362 reid_baseline.train INFO: normal accuracy 0.54524627720504 2.4884374141693115 
2022-04-13 15:13:37,454 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 15:13:37,455 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 248.8%
2022-04-13 15:13:57,050 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.248, Acc: 0.884, Base Lr: 6.42e-03
2022-04-13 15:14:06,774 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.192[s] Speed: 83.2[samples/s]
2022-04-13 15:14:39,019 reid_baseline.train INFO: normal accuracy 0.5564719358533792 2.345853090286255 
2022-04-13 15:14:40,241 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 15:14:40,241 reid_baseline.train INFO: Accuracy: 55.6% Mean Entropy: 234.6%
2022-04-13 15:14:59,735 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.153, Acc: 0.897, Base Lr: 7.21e-03
2022-04-13 15:15:09,543 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.192[s] Speed: 83.4[samples/s]
2022-04-13 15:15:41,839 reid_baseline.train INFO: normal accuracy 0.5594501718213059 2.1486458778381348 
2022-04-13 15:15:43,000 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 15:15:43,001 reid_baseline.train INFO: Accuracy: 55.9% Mean Entropy: 214.9%
2022-04-13 15:16:05,125 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.086, Acc: 0.931, Base Lr: 1.60e-05
2022-04-13 15:16:16,124 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.218[s] Speed: 73.5[samples/s]
2022-04-13 15:16:49,481 reid_baseline.train INFO: normal accuracy 0.5603665521191294 2.2296977043151855 
2022-04-13 15:16:49,484 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 15:16:49,484 reid_baseline.train INFO: Accuracy: 56.0% Mean Entropy: 223.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_3/transformer_best_model.pth
2022-04-13 15:17:19,697 reid_baseline.train INFO: normal accuracy 0.5594501718213059 2.1486458778381348 
2022-04-13 15:17:19,697 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:17:19,697 reid_baseline.train INFO: Accuracy: 55.9%
2022-04-13 15:17:53,409 reid_baseline.train INFO: normal accuracy 0.4529209621993127 2.266484260559082 
2022-04-13 15:17:53,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:17:53,411 reid_baseline.train INFO: Shuffled Accuracy: 45.3%
2022-04-13 15:18:02,764 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_4
2022-04-13 15:18:02,764 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4)
2022-04-13 15:18:02,764 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 15:18:02,764 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 10
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 15:18:02,765 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 10
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 15:18:15,678 reid_baseline.train INFO: start training
2022-04-13 15:18:36,301 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.109, Acc: 0.284, Base Lr: 8.72e-04
2022-04-13 15:18:46,517 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.202[s] Speed: 79.3[samples/s]
2022-04-13 15:19:19,799 reid_baseline.train INFO: normal accuracy 0.33745704467353954 4.1711249351501465 
2022-04-13 15:19:21,077 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 15:19:21,078 reid_baseline.train INFO: Accuracy: 33.7% Mean Entropy: 417.1%
2022-04-13 15:19:41,004 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.775, Acc: 0.546, Base Lr: 1.66e-03
2022-04-13 15:19:50,888 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.196[s] Speed: 81.6[samples/s]
2022-04-13 15:20:20,533 reid_baseline.train INFO: normal accuracy 0.34914089347079036 4.145928382873535 
2022-04-13 15:20:22,422 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 15:20:22,422 reid_baseline.train INFO: Accuracy: 34.9% Mean Entropy: 414.6%
2022-04-13 15:20:44,458 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.159, Acc: 0.574, Base Lr: 2.46e-03
2022-04-13 15:20:54,299 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.209[s] Speed: 76.7[samples/s]
2022-04-13 15:21:26,991 reid_baseline.train INFO: normal accuracy 0.3667812142038946 4.0060648918151855 
2022-04-13 15:21:28,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 15:21:28,162 reid_baseline.train INFO: Accuracy: 36.7% Mean Entropy: 400.6%
2022-04-13 15:21:49,690 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.540, Acc: 0.610, Base Lr: 3.25e-03
2022-04-13 15:22:00,789 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.214[s] Speed: 74.8[samples/s]
2022-04-13 15:22:31,266 reid_baseline.train INFO: normal accuracy 0.40939289805269186 3.656644344329834 
2022-04-13 15:22:32,606 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 15:22:32,607 reid_baseline.train INFO: Accuracy: 40.9% Mean Entropy: 365.7%
2022-04-13 15:22:53,392 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.002, Acc: 0.704, Base Lr: 4.04e-03
2022-04-13 15:23:01,880 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.192[s] Speed: 83.3[samples/s]
2022-04-13 15:23:36,267 reid_baseline.train INFO: normal accuracy 0.4529209621993127 3.2414608001708984 
2022-04-13 15:23:37,499 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 15:23:37,499 reid_baseline.train INFO: Accuracy: 45.3% Mean Entropy: 324.1%
2022-04-13 15:23:57,065 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.680, Acc: 0.766, Base Lr: 4.83e-03
2022-04-13 15:24:06,801 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.193[s] Speed: 83.1[samples/s]
2022-04-13 15:24:36,657 reid_baseline.train INFO: normal accuracy 0.49805269186712486 2.9055793285369873 
2022-04-13 15:24:37,834 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 15:24:37,834 reid_baseline.train INFO: Accuracy: 49.8% Mean Entropy: 290.6%
2022-04-13 15:24:59,747 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.498, Acc: 0.803, Base Lr: 5.62e-03
2022-04-13 15:25:08,964 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.204[s] Speed: 78.2[samples/s]
2022-04-13 15:25:41,738 reid_baseline.train INFO: normal accuracy 0.5198167239404353 2.630380392074585 
2022-04-13 15:25:42,811 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 15:25:42,811 reid_baseline.train INFO: Accuracy: 52.0% Mean Entropy: 263.0%
2022-04-13 15:26:01,486 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.313, Acc: 0.862, Base Lr: 6.42e-03
2022-04-13 15:26:13,899 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.204[s] Speed: 78.3[samples/s]
2022-04-13 15:26:43,640 reid_baseline.train INFO: normal accuracy 0.5411225658648339 2.451982259750366 
2022-04-13 15:26:45,064 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 15:26:45,065 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 245.2%
2022-04-13 15:27:07,328 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.229, Acc: 0.884, Base Lr: 7.21e-03
2022-04-13 15:27:18,893 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.222[s] Speed: 72.0[samples/s]
2022-04-13 15:27:41,534 reid_baseline.train INFO: normal accuracy 0.5383734249713631 2.3056015968322754 
2022-04-13 15:27:42,824 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 15:27:42,824 reid_baseline.train INFO: Accuracy: 53.8% Mean Entropy: 230.6%
2022-04-13 15:28:01,129 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.147, Acc: 0.909, Base Lr: 1.60e-05
2022-04-13 15:28:10,793 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.183[s] Speed: 87.4[samples/s]
2022-04-13 15:28:44,227 reid_baseline.train INFO: normal accuracy 0.5379152348224513 2.3660690784454346 
2022-04-13 15:28:44,229 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 15:28:44,230 reid_baseline.train INFO: Accuracy: 53.8% Mean Entropy: 236.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_4/transformer_best_model.pth
2022-04-13 15:29:21,465 reid_baseline.train INFO: normal accuracy 0.5383734249713631 2.3056015968322754 
2022-04-13 15:29:21,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:29:21,465 reid_baseline.train INFO: Accuracy: 53.8%
2022-04-13 15:29:49,260 reid_baseline.train INFO: normal accuracy 0.40916380297823596 2.4112796783447266 
2022-04-13 15:29:49,260 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:29:49,261 reid_baseline.train INFO: Shuffled Accuracy: 40.9%
2022-04-13 15:29:57,334 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_5
2022-04-13 15:29:57,335 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=5)
2022-04-13 15:29:57,335 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 15:29:57,335 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 10
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 15:29:57,335 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 10
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 15:30:08,297 reid_baseline.train INFO: start training
2022-04-13 15:30:31,111 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.113, Acc: 0.265, Base Lr: 8.72e-04
2022-04-13 15:30:42,208 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.222[s] Speed: 72.2[samples/s]
2022-04-13 15:31:12,425 reid_baseline.train INFO: normal accuracy 0.27857961053837343 4.1712565422058105 
2022-04-13 15:31:13,556 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 15:31:13,556 reid_baseline.train INFO: Accuracy: 27.9% Mean Entropy: 417.1%
2022-04-13 15:31:33,126 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.799, Acc: 0.506, Base Lr: 1.66e-03
2022-04-13 15:31:42,396 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.190[s] Speed: 84.3[samples/s]
2022-04-13 15:32:17,674 reid_baseline.train INFO: normal accuracy 0.3131729667812142 4.147568702697754 
2022-04-13 15:32:19,043 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 15:32:19,044 reid_baseline.train INFO: Accuracy: 31.3% Mean Entropy: 414.8%
2022-04-13 15:32:38,810 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.235, Acc: 0.526, Base Lr: 2.46e-03
2022-04-13 15:32:48,524 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.194[s] Speed: 82.6[samples/s]
2022-04-13 15:33:19,092 reid_baseline.train INFO: normal accuracy 0.3418098510882016 4.026362895965576 
2022-04-13 15:33:20,966 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 15:33:20,967 reid_baseline.train INFO: Accuracy: 34.2% Mean Entropy: 402.6%
2022-04-13 15:33:43,113 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.655, Acc: 0.560, Base Lr: 3.25e-03
2022-04-13 15:33:53,096 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.211[s] Speed: 75.8[samples/s]
2022-04-13 15:34:25,803 reid_baseline.train INFO: normal accuracy 0.384192439862543 3.721254348754883 
2022-04-13 15:34:27,075 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 15:34:27,075 reid_baseline.train INFO: Accuracy: 38.4% Mean Entropy: 372.1%
2022-04-13 15:34:47,989 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.145, Acc: 0.652, Base Lr: 4.04e-03
2022-04-13 15:34:59,762 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.215[s] Speed: 74.5[samples/s]
2022-04-13 15:35:30,448 reid_baseline.train INFO: normal accuracy 0.4217640320733104 3.358806848526001 
2022-04-13 15:35:31,632 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 15:35:31,632 reid_baseline.train INFO: Accuracy: 42.2% Mean Entropy: 335.9%
2022-04-13 15:35:51,770 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.807, Acc: 0.722, Base Lr: 4.83e-03
2022-04-13 15:36:01,610 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.197[s] Speed: 81.2[samples/s]
2022-04-13 15:36:37,918 reid_baseline.train INFO: normal accuracy 0.4655211912943872 3.054037094116211 
2022-04-13 15:36:39,196 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 15:36:39,197 reid_baseline.train INFO: Accuracy: 46.6% Mean Entropy: 305.4%
2022-04-13 15:36:59,536 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.594, Acc: 0.772, Base Lr: 5.62e-03
2022-04-13 15:37:09,330 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.198[s] Speed: 80.8[samples/s]
2022-04-13 15:37:38,700 reid_baseline.train INFO: normal accuracy 0.4827033218785796 2.7460222244262695 
2022-04-13 15:37:39,947 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 15:37:39,947 reid_baseline.train INFO: Accuracy: 48.3% Mean Entropy: 274.6%
2022-04-13 15:38:02,289 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.419, Acc: 0.830, Base Lr: 6.42e-03
2022-04-13 15:38:11,617 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.208[s] Speed: 76.9[samples/s]
2022-04-13 15:38:43,476 reid_baseline.train INFO: normal accuracy 0.5003436426116838 2.5828542709350586 
2022-04-13 15:38:45,148 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 15:38:45,148 reid_baseline.train INFO: Accuracy: 50.0% Mean Entropy: 258.3%
2022-04-13 15:39:03,989 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.322, Acc: 0.854, Base Lr: 7.21e-03
2022-04-13 15:39:15,271 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.198[s] Speed: 80.8[samples/s]
2022-04-13 15:39:46,535 reid_baseline.train INFO: normal accuracy 0.5049255441008018 2.447833299636841 
2022-04-13 15:39:47,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 15:39:47,792 reid_baseline.train INFO: Accuracy: 50.5% Mean Entropy: 244.8%
2022-04-13 15:40:07,496 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.232, Acc: 0.884, Base Lr: 1.60e-05
2022-04-13 15:40:17,729 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.197[s] Speed: 81.3[samples/s]
2022-04-13 15:40:51,374 reid_baseline.train INFO: normal accuracy 0.5042382588774341 2.4991378784179688 
2022-04-13 15:40:51,376 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 15:40:51,377 reid_baseline.train INFO: Accuracy: 50.4% Mean Entropy: 249.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_5/transformer_best_model.pth
2022-04-13 15:41:22,796 reid_baseline.train INFO: normal accuracy 0.5049255441008018 2.447833299636841 
2022-04-13 15:41:22,796 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:41:22,796 reid_baseline.train INFO: Accuracy: 50.5%
2022-04-13 15:41:54,427 reid_baseline.train INFO: normal accuracy 0.363573883161512 2.5190675258636475 
2022-04-13 15:41:54,429 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:41:54,429 reid_baseline.train INFO: Shuffled Accuracy: 36.4%
2022-04-13 15:42:01,644 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_6
2022-04-13 15:42:01,644 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6)
2022-04-13 15:42:01,644 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 15:42:01,645 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 10
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 15:42:01,645 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 10
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 15:42:15,679 reid_baseline.train INFO: start training
2022-04-13 15:42:35,988 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.245, Base Lr: 8.72e-04
2022-04-13 15:42:47,396 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.206[s] Speed: 77.5[samples/s]
2022-04-13 15:43:22,406 reid_baseline.train INFO: normal accuracy 0.2034364261168385 4.171036243438721 
2022-04-13 15:43:23,629 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 15:43:23,629 reid_baseline.train INFO: Accuracy: 20.3% Mean Entropy: 417.1%
2022-04-13 15:43:37,260 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.820, Acc: 0.438, Base Lr: 1.66e-03
2022-04-13 15:43:43,623 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.132[s] Speed: 121.7[samples/s]
2022-04-13 15:44:15,558 reid_baseline.train INFO: normal accuracy 0.20778923253150058 4.146274566650391 
2022-04-13 15:44:16,628 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 15:44:16,628 reid_baseline.train INFO: Accuracy: 20.8% Mean Entropy: 414.6%
2022-04-13 15:44:36,407 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.300, Acc: 0.466, Base Lr: 2.46e-03
2022-04-13 15:44:45,594 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.190[s] Speed: 84.0[samples/s]
2022-04-13 15:45:17,224 reid_baseline.train INFO: normal accuracy 0.2650630011454754 4.034875392913818 
2022-04-13 15:45:18,925 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 15:45:18,925 reid_baseline.train INFO: Accuracy: 26.5% Mean Entropy: 403.5%
2022-04-13 15:45:38,787 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.788, Acc: 0.511, Base Lr: 3.25e-03
2022-04-13 15:45:48,679 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.196[s] Speed: 81.8[samples/s]
2022-04-13 15:46:20,003 reid_baseline.train INFO: normal accuracy 0.3333333333333333 3.784083366394043 
2022-04-13 15:46:21,392 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 15:46:21,393 reid_baseline.train INFO: Accuracy: 33.3% Mean Entropy: 378.4%
2022-04-13 15:46:41,470 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.302, Acc: 0.601, Base Lr: 4.04e-03
2022-04-13 15:46:51,169 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.195[s] Speed: 82.2[samples/s]
2022-04-13 15:47:23,423 reid_baseline.train INFO: normal accuracy 0.3828178694158076 3.4763545989990234 
2022-04-13 15:47:24,897 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 15:47:24,897 reid_baseline.train INFO: Accuracy: 38.3% Mean Entropy: 347.6%
2022-04-13 15:47:46,270 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.973, Acc: 0.673, Base Lr: 4.83e-03
2022-04-13 15:47:58,457 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.220[s] Speed: 72.8[samples/s]
2022-04-13 15:48:29,035 reid_baseline.train INFO: normal accuracy 0.4297823596792669 3.1814985275268555 
2022-04-13 15:48:30,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 15:48:30,317 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 318.1%
2022-04-13 15:48:51,323 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.735, Acc: 0.725, Base Lr: 5.62e-03
2022-04-13 15:49:00,876 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.201[s] Speed: 79.7[samples/s]
2022-04-13 15:49:36,677 reid_baseline.train INFO: normal accuracy 0.456815578465063 2.9135658740997314 
2022-04-13 15:49:37,962 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 15:49:37,962 reid_baseline.train INFO: Accuracy: 45.7% Mean Entropy: 291.4%
2022-04-13 15:49:57,980 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.531, Acc: 0.790, Base Lr: 6.42e-03
2022-04-13 15:50:07,672 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.195[s] Speed: 82.1[samples/s]
2022-04-13 15:50:35,688 reid_baseline.train INFO: normal accuracy 0.4762886597938144 2.7284533977508545 
2022-04-13 15:50:37,037 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 15:50:37,037 reid_baseline.train INFO: Accuracy: 47.6% Mean Entropy: 272.8%
2022-04-13 15:51:00,617 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.423, Acc: 0.819, Base Lr: 7.21e-03
2022-04-13 15:51:09,350 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.210[s] Speed: 76.1[samples/s]
2022-04-13 15:51:40,902 reid_baseline.train INFO: normal accuracy 0.47835051546391755 2.5620999336242676 
2022-04-13 15:51:42,363 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 15:51:42,364 reid_baseline.train INFO: Accuracy: 47.8% Mean Entropy: 256.2%
2022-04-13 15:52:02,958 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.319, Acc: 0.851, Base Lr: 1.60e-05
2022-04-13 15:52:14,635 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.212[s] Speed: 75.5[samples/s]
2022-04-13 15:52:46,985 reid_baseline.train INFO: normal accuracy 0.4760595647193585 2.5991342067718506 
2022-04-13 15:52:46,986 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 15:52:46,986 reid_baseline.train INFO: Accuracy: 47.6% Mean Entropy: 259.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_6/transformer_best_model.pth
2022-04-13 15:53:17,456 reid_baseline.train INFO: normal accuracy 0.47835051546391755 2.5620999336242676 
2022-04-13 15:53:17,456 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:53:17,456 reid_baseline.train INFO: Accuracy: 47.8%
2022-04-13 15:53:47,391 reid_baseline.train INFO: normal accuracy 0.3347079037800687 2.647176742553711 
2022-04-13 15:53:47,392 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:53:47,392 reid_baseline.train INFO: Shuffled Accuracy: 33.5%
