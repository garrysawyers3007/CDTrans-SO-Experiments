2022-04-21 15:09:08,048 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1
2022-04-21 15:09:08,048 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-21 15:09:08,049 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 15:09:08,049 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 15:09:08,049 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 15:09:16,193 reid_baseline.train INFO: start training
2022-04-21 15:10:04,895 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.017, Acc: 0.280, Base Lr: 8.72e-04
2022-04-21 15:10:47,627 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.965, Acc: 0.376, Base Lr: 8.72e-04
2022-04-21 15:11:14,314 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.429[s] Speed: 37.3[samples/s]
2022-04-21 15:11:55,578 reid_baseline.train INFO: normal accuracy 0.5092707045735476 4.166680335998535 
2022-04-21 15:12:25,470 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 15:12:25,470 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-21 15:13:01,027 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.538, Acc: 0.551, Base Lr: 1.66e-03
2022-04-21 15:13:46,887 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.374, Acc: 0.555, Base Lr: 1.66e-03
2022-04-21 15:14:10,785 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.386[s] Speed: 41.5[samples/s]
2022-04-21 15:14:56,992 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.029121398925781 
2022-04-21 15:15:26,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 15:15:26,956 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-21 15:16:05,769 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.589, Acc: 0.602, Base Lr: 2.46e-03
2022-04-21 15:16:47,585 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.459, Acc: 0.610, Base Lr: 2.46e-03
2022-04-21 15:17:18,443 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.408[s] Speed: 39.2[samples/s]
2022-04-21 15:18:01,554 reid_baseline.train INFO: normal accuracy 0.6258755665430573 3.461315393447876 
2022-04-21 15:18:31,527 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 15:18:31,528 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 346.1%
2022-04-21 15:19:20,622 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.895, Acc: 0.684, Base Lr: 3.25e-03
2022-04-21 15:19:56,104 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.807, Acc: 0.710, Base Lr: 3.25e-03
2022-04-21 15:20:27,683 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.425[s] Speed: 37.6[samples/s]
2022-04-21 15:21:01,232 reid_baseline.train INFO: normal accuracy 0.6839719818706221 2.8138985633850098 
2022-04-21 15:21:31,210 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 15:21:31,210 reid_baseline.train INFO: Accuracy: 68.4% Mean Entropy: 281.4%
2022-04-21 15:21:59,553 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.542, Acc: 0.773, Base Lr: 4.04e-03
2022-04-21 15:22:27,548 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.502, Acc: 0.765, Base Lr: 4.04e-03
2022-04-21 15:22:46,552 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.276[s] Speed: 58.0[samples/s]
2022-04-21 15:23:15,912 reid_baseline.train INFO: normal accuracy 0.7066337041615163 2.510465145111084 
2022-04-21 15:23:45,869 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 15:23:45,870 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 251.0%
2022-04-21 15:24:14,008 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.344, Acc: 0.805, Base Lr: 4.83e-03
2022-04-21 15:24:39,199 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.343, Acc: 0.800, Base Lr: 4.83e-03
2022-04-21 15:24:58,730 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.267[s] Speed: 60.0[samples/s]
2022-04-21 15:25:32,674 reid_baseline.train INFO: normal accuracy 0.7218788627935723 2.284379005432129 
2022-04-21 15:26:02,637 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 15:26:02,638 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 228.4%
2022-04-21 15:26:32,484 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.274, Acc: 0.824, Base Lr: 5.62e-03
2022-04-21 15:26:58,261 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.252, Acc: 0.837, Base Lr: 5.62e-03
2022-04-21 15:27:15,330 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.266[s] Speed: 60.1[samples/s]
2022-04-21 15:27:51,640 reid_baseline.train INFO: normal accuracy 0.7313555830243098 2.158849000930786 
2022-04-21 15:28:21,657 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 15:28:21,658 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 215.9%
2022-04-21 15:28:51,325 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.168, Acc: 0.861, Base Lr: 6.42e-03
2022-04-21 15:29:17,580 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.169, Acc: 0.856, Base Lr: 6.42e-03
2022-04-21 15:29:34,595 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-21 15:30:06,815 reid_baseline.train INFO: normal accuracy 0.7437165224557066 2.011650562286377 
2022-04-21 15:30:36,781 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 15:30:36,782 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 201.2%
2022-04-21 15:31:05,150 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.105, Acc: 0.873, Base Lr: 7.21e-03
2022-04-21 15:31:33,454 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.101, Acc: 0.880, Base Lr: 7.21e-03
2022-04-21 15:31:52,747 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.278[s] Speed: 57.6[samples/s]
2022-04-21 15:32:25,000 reid_baseline.train INFO: normal accuracy 0.7362999587968686 1.9473611116409302 
2022-04-21 15:32:54,964 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 15:32:54,965 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 194.7%
2022-04-21 15:33:23,761 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.041, Acc: 0.894, Base Lr: 4.01e-03
2022-04-21 15:33:51,184 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.021, Acc: 0.904, Base Lr: 4.01e-03
2022-04-21 15:34:10,016 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.275[s] Speed: 58.2[samples/s]
2022-04-21 15:35:11,815 reid_baseline.train INFO: normal accuracy 0.7424804285125669 1.9437158107757568 
2022-04-21 15:35:41,796 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 15:35:41,797 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 194.4%
2022-04-21 15:36:13,342 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.002, Acc: 0.915, Base Lr: 3.38e-03
2022-04-21 15:36:38,253 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.016, Acc: 0.913, Base Lr: 3.38e-03
2022-04-21 15:36:58,218 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.279[s] Speed: 57.3[samples/s]
2022-04-21 15:37:32,848 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.8595298528671265 
2022-04-21 15:38:02,823 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 15:38:02,823 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 186.0%
2022-04-21 15:38:28,881 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.036, Acc: 0.898, Base Lr: 2.77e-03
2022-04-21 15:38:57,181 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.009, Acc: 0.911, Base Lr: 2.77e-03
2022-04-21 15:39:17,505 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.274[s] Speed: 58.5[samples/s]
2022-04-21 15:39:51,004 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.838883876800537 
2022-04-21 15:40:21,004 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 15:40:21,004 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.9%
2022-04-21 15:40:50,155 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.993, Acc: 0.914, Base Lr: 2.20e-03
2022-04-21 15:41:13,350 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.990, Acc: 0.921, Base Lr: 2.20e-03
2022-04-21 15:41:31,108 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.257[s] Speed: 62.3[samples/s]
2022-04-21 15:42:03,460 reid_baseline.train INFO: normal accuracy 0.746188710341986 1.903485894203186 
2022-04-21 15:42:03,461 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 15:42:03,461 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 190.3%
2022-04-21 15:42:30,765 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.969, Acc: 0.914, Base Lr: 1.66e-03
2022-04-21 15:42:52,973 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.946, Acc: 0.924, Base Lr: 1.66e-03
2022-04-21 15:43:11,499 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.249[s] Speed: 64.2[samples/s]
2022-04-21 15:43:45,125 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.8681881427764893 
2022-04-21 15:43:45,125 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 15:43:45,126 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 186.8%
2022-04-21 15:44:14,914 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.910, Acc: 0.933, Base Lr: 1.19e-03
2022-04-21 15:44:40,511 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.931, Acc: 0.928, Base Lr: 1.19e-03
2022-04-21 15:45:00,051 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.274[s] Speed: 58.3[samples/s]
2022-04-21 15:45:34,804 reid_baseline.train INFO: normal accuracy 0.7511330861145447 1.8821384906768799 
2022-04-21 15:45:34,805 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 15:45:34,805 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 188.2%
2022-04-21 15:46:01,061 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.939, Acc: 0.932, Base Lr: 7.78e-04
2022-04-21 15:46:26,023 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.943, Acc: 0.929, Base Lr: 7.78e-04
2022-04-21 15:46:43,503 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.252[s] Speed: 63.6[samples/s]
2022-04-21 15:47:14,837 reid_baseline.train INFO: normal accuracy 0.749896992171405 1.8509759902954102 
2022-04-21 15:47:14,837 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 15:47:14,838 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 185.1%
2022-04-21 15:47:42,630 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.956, Acc: 0.921, Base Lr: 4.51e-04
2022-04-21 15:48:09,668 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.941, Acc: 0.924, Base Lr: 4.51e-04
2022-04-21 15:48:26,778 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.263[s] Speed: 60.9[samples/s]
2022-04-21 15:48:58,483 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.8709384202957153 
2022-04-21 15:48:58,485 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 15:48:58,485 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 187.1%
2022-04-21 15:49:27,050 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.923, Acc: 0.938, Base Lr: 2.11e-04
2022-04-21 15:49:54,203 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.921, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 15:50:13,670 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.275[s] Speed: 58.1[samples/s]
2022-04-21 15:50:46,963 reid_baseline.train INFO: normal accuracy 0.7478368355995055 1.8456364870071411 
2022-04-21 15:50:46,964 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 15:50:46,964 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 184.6%
2022-04-21 15:51:12,970 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.915, Acc: 0.934, Base Lr: 6.51e-05
2022-04-21 15:51:38,162 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.932, Acc: 0.927, Base Lr: 6.51e-05
2022-04-21 15:51:56,697 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.255[s] Speed: 62.6[samples/s]
2022-04-21 15:52:32,071 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.8325484991073608 
2022-04-21 15:53:02,055 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 15:53:02,055 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.3%
2022-04-21 15:53:30,874 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.903, Acc: 0.939, Base Lr: 1.60e-05
2022-04-21 15:53:56,013 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.914, Acc: 0.936, Base Lr: 1.60e-05
2022-04-21 15:54:12,560 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-21 15:55:16,481 reid_baseline.train INFO: normal accuracy 0.7531932426864442 1.7944072484970093 
2022-04-21 15:55:46,535 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 15:55:46,536 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 179.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-21 15:56:45,758 reid_baseline.train INFO: normal accuracy 0.7531932426864442 1.7944072484970093 
2022-04-21 15:56:45,759 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 15:56:45,759 reid_baseline.train INFO: Accuracy: 75.3%
2022-04-21 15:57:20,700 reid_baseline.train INFO: normal accuracy 0.7531932426864442 1.7944072484970093 
2022-04-21 15:57:20,700 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 15:57:20,700 reid_baseline.train INFO: Shuffled Accuracy: 75.3%
2022-04-21 15:58:02,459 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7763171195983887 
2022-04-21 15:58:02,460 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 15:58:02,460 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-21 15:58:08,100 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1
2022-04-21 15:58:08,100 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-21 15:58:08,100 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 15:58:08,100 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 15:58:08,101 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 15:58:16,282 reid_baseline.train INFO: start training
2022-04-21 15:58:49,061 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.017, Acc: 0.280, Base Lr: 8.72e-04
2022-04-21 15:59:17,202 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.965, Acc: 0.376, Base Lr: 8.72e-04
2022-04-21 15:59:34,444 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.283[s] Speed: 56.5[samples/s]
2022-04-21 16:00:18,367 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.16417932510376 
2022-04-21 16:00:48,291 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 16:00:48,291 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-21 16:01:17,490 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.538, Acc: 0.550, Base Lr: 1.66e-03
2022-04-21 16:01:46,389 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.374, Acc: 0.555, Base Lr: 1.66e-03
2022-04-21 16:02:06,117 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.285[s] Speed: 56.1[samples/s]
2022-04-21 16:02:52,354 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.968367099761963 
2022-04-21 16:03:22,582 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 16:03:22,583 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-21 16:03:48,830 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.589, Acc: 0.601, Base Lr: 2.46e-03
2022-04-21 16:04:14,791 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.459, Acc: 0.610, Base Lr: 2.46e-03
2022-04-21 16:04:37,052 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.273[s] Speed: 58.7[samples/s]
2022-04-21 16:05:22,230 reid_baseline.train INFO: normal accuracy 0.6451903581887812 3.2464523315429688 
2022-04-21 16:05:52,240 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 16:05:52,241 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.6%
2022-04-21 16:06:23,954 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.895, Acc: 0.683, Base Lr: 3.25e-03
2022-04-21 16:06:50,171 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.807, Acc: 0.709, Base Lr: 3.25e-03
2022-04-21 16:07:07,965 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.277[s] Speed: 57.7[samples/s]
2022-04-21 16:07:43,835 reid_baseline.train INFO: normal accuracy 0.7087181797702186 2.5375359058380127 
2022-04-21 16:08:13,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 16:08:13,813 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 253.8%
2022-04-21 16:08:41,622 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.542, Acc: 0.773, Base Lr: 4.04e-03
2022-04-21 16:09:09,521 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.502, Acc: 0.765, Base Lr: 4.04e-03
2022-04-21 16:09:28,862 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.275[s] Speed: 58.3[samples/s]
2022-04-21 16:10:13,543 reid_baseline.train INFO: normal accuracy 0.7253886010362695 2.206571340560913 
2022-04-21 16:10:43,523 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 16:10:43,523 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 220.7%
2022-04-21 16:11:09,659 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.344, Acc: 0.805, Base Lr: 4.83e-03
2022-04-21 16:11:40,247 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.343, Acc: 0.800, Base Lr: 4.83e-03
2022-04-21 16:11:59,447 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.278[s] Speed: 57.5[samples/s]
2022-04-21 16:12:42,069 reid_baseline.train INFO: normal accuracy 0.7384546068934444 1.9948639869689941 
2022-04-21 16:13:12,071 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 16:13:12,072 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 199.5%
2022-04-21 16:13:43,796 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.274, Acc: 0.824, Base Lr: 5.62e-03
2022-04-21 16:14:13,130 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.252, Acc: 0.836, Base Lr: 5.62e-03
2022-04-21 16:14:33,701 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 16:15:17,253 reid_baseline.train INFO: normal accuracy 0.7553503041225501 1.8889191150665283 
2022-04-21 16:15:47,246 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 16:15:47,247 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 188.9%
2022-04-21 16:16:18,618 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.169, Acc: 0.862, Base Lr: 6.42e-03
2022-04-21 16:16:43,373 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.170, Acc: 0.856, Base Lr: 6.42e-03
2022-04-21 16:17:06,405 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-21 16:17:48,665 reid_baseline.train INFO: normal accuracy 0.7600810993466998 1.822234034538269 
2022-04-21 16:18:18,637 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 16:18:18,637 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 182.2%
2022-04-21 16:18:45,975 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.105, Acc: 0.873, Base Lr: 7.21e-03
2022-04-21 16:19:14,910 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.101, Acc: 0.880, Base Lr: 7.21e-03
2022-04-21 16:19:33,766 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.275[s] Speed: 58.1[samples/s]
2022-04-21 16:20:14,252 reid_baseline.train INFO: normal accuracy 0.7609822031989186 1.7494919300079346 
2022-04-21 16:20:44,259 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 16:20:44,260 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 174.9%
2022-04-21 16:21:15,406 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.041, Acc: 0.894, Base Lr: 4.01e-03
2022-04-21 16:21:43,878 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.021, Acc: 0.904, Base Lr: 4.01e-03
2022-04-21 16:22:02,768 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-21 16:23:13,164 reid_baseline.train INFO: normal accuracy 0.7657129984230683 1.7917851209640503 
2022-04-21 16:23:13,165 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 16:23:13,165 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 179.2%
2022-04-21 16:23:40,312 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.002, Acc: 0.915, Base Lr: 3.38e-03
2022-04-21 16:24:08,764 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.016, Acc: 0.914, Base Lr: 3.38e-03
2022-04-21 16:24:29,890 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-21 16:25:14,976 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.699769139289856 
2022-04-21 16:25:44,967 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 16:25:44,967 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.0%
2022-04-21 16:26:18,704 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.036, Acc: 0.899, Base Lr: 2.77e-03
2022-04-21 16:26:48,388 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.009, Acc: 0.912, Base Lr: 2.77e-03
2022-04-21 16:27:10,686 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.314[s] Speed: 51.0[samples/s]
2022-04-21 16:27:53,366 reid_baseline.train INFO: normal accuracy 0.7695426897949988 1.6824992895126343 
2022-04-21 16:28:23,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 16:28:23,366 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.2%
2022-04-21 16:28:54,927 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.993, Acc: 0.914, Base Lr: 2.20e-03
2022-04-21 16:29:23,554 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.990, Acc: 0.921, Base Lr: 2.20e-03
2022-04-21 16:29:45,005 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-21 16:30:31,148 reid_baseline.train INFO: normal accuracy 0.7735976571299842 1.7563570737838745 
2022-04-21 16:30:31,149 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 16:30:31,149 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 175.6%
2022-04-21 16:31:00,282 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.969, Acc: 0.914, Base Lr: 1.66e-03
2022-04-21 16:31:28,923 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.947, Acc: 0.924, Base Lr: 1.66e-03
2022-04-21 16:31:49,096 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.285[s] Speed: 56.1[samples/s]
2022-04-21 16:32:33,661 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7238166332244873 
2022-04-21 16:32:33,662 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 16:32:33,662 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.4%
2022-04-21 16:33:01,974 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.910, Acc: 0.933, Base Lr: 1.19e-03
2022-04-21 16:33:32,222 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.931, Acc: 0.928, Base Lr: 1.19e-03
2022-04-21 16:33:50,564 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.282[s] Speed: 56.8[samples/s]
2022-04-21 16:34:34,381 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7530981302261353 
2022-04-21 16:34:34,381 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 16:34:34,381 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 175.3%
2022-04-21 16:35:05,757 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.939, Acc: 0.932, Base Lr: 7.78e-04
2022-04-21 16:35:34,657 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.943, Acc: 0.929, Base Lr: 7.78e-04
2022-04-21 16:35:52,193 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.285[s] Speed: 56.1[samples/s]
2022-04-21 16:36:32,032 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7083312273025513 
2022-04-21 16:36:32,033 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 16:36:32,033 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.8%
2022-04-21 16:36:58,304 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.956, Acc: 0.921, Base Lr: 4.51e-04
2022-04-21 16:37:20,925 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.941, Acc: 0.924, Base Lr: 4.51e-04
2022-04-21 16:37:41,092 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.253[s] Speed: 63.3[samples/s]
2022-04-21 16:38:20,021 reid_baseline.train INFO: normal accuracy 0.7776526244649696 1.7305066585540771 
2022-04-21 16:38:20,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 16:38:20,022 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 173.1%
2022-04-21 16:38:47,586 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.923, Acc: 0.937, Base Lr: 2.11e-04
2022-04-21 16:39:10,435 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.921, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 16:39:28,769 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.252[s] Speed: 63.6[samples/s]
2022-04-21 16:40:09,136 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.712935209274292 
2022-04-21 16:40:09,136 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 16:40:09,136 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 171.3%
2022-04-21 16:40:34,218 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.915, Acc: 0.934, Base Lr: 6.51e-05
2022-04-21 16:41:01,810 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.932, Acc: 0.927, Base Lr: 6.51e-05
2022-04-21 16:41:19,652 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.258[s] Speed: 61.9[samples/s]
2022-04-21 16:42:01,783 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.6835460662841797 
2022-04-21 16:42:01,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 16:42:01,783 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.4%
2022-04-21 16:42:29,937 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.903, Acc: 0.939, Base Lr: 1.60e-05
2022-04-21 16:42:52,533 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.914, Acc: 0.936, Base Lr: 1.60e-05
2022-04-21 16:43:09,908 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.249[s] Speed: 64.2[samples/s]
2022-04-21 16:44:18,696 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6502457857131958 
2022-04-21 16:44:48,701 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 16:44:48,702 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-21 16:46:01,652 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6502457857131958 
2022-04-21 16:46:01,653 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 16:46:01,653 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-21 16:46:43,128 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6502457857131958 
2022-04-21 16:46:43,129 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 16:46:43,129 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-21 16:47:24,824 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7760961651802063 
2022-04-21 16:47:24,824 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 16:47:24,825 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-21 16:47:30,937 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1
2022-04-21 16:47:30,937 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-21 16:47:30,937 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 16:47:30,937 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 16:47:30,938 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 16:47:38,157 reid_baseline.train INFO: start training
2022-04-21 16:48:11,628 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.017, Acc: 0.280, Base Lr: 8.72e-04
2022-04-21 16:48:34,859 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.965, Acc: 0.376, Base Lr: 8.72e-04
2022-04-21 16:48:52,947 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.270[s] Speed: 59.4[samples/s]
2022-04-21 16:50:29,561 reid_baseline.train INFO: normal accuracy 0.5685104429653431 4.165801525115967 
2022-04-21 16:50:59,507 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 16:50:59,507 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 416.6%
2022-04-21 16:51:25,755 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.538, Acc: 0.551, Base Lr: 1.66e-03
2022-04-21 16:51:49,739 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.374, Acc: 0.555, Base Lr: 1.66e-03
2022-04-21 16:52:09,833 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.257[s] Speed: 62.2[samples/s]
2022-04-21 16:53:52,093 reid_baseline.train INFO: normal accuracy 0.602708285517558 3.9952638149261475 
2022-04-21 16:54:22,075 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 16:54:22,075 reid_baseline.train INFO: Accuracy: 60.3% Mean Entropy: 399.5%
2022-04-21 16:54:51,378 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.589, Acc: 0.601, Base Lr: 2.46e-03
2022-04-21 16:55:17,719 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.459, Acc: 0.610, Base Lr: 2.46e-03
2022-04-21 16:55:38,375 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.279[s] Speed: 57.4[samples/s]
2022-04-21 16:57:25,517 reid_baseline.train INFO: normal accuracy 0.6750057378930456 3.3014965057373047 
2022-04-21 16:57:55,497 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 16:57:55,497 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 330.1%
2022-04-21 16:58:22,079 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.895, Acc: 0.683, Base Lr: 3.25e-03
2022-04-21 16:58:44,434 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.807, Acc: 0.709, Base Lr: 3.25e-03
2022-04-21 16:59:00,542 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.238[s] Speed: 67.3[samples/s]
2022-04-21 17:00:40,800 reid_baseline.train INFO: normal accuracy 0.7346798255680514 2.587684392929077 
2022-04-21 17:01:10,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 17:01:10,800 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 258.8%
2022-04-21 17:01:38,926 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.542, Acc: 0.773, Base Lr: 4.04e-03
2022-04-21 17:02:02,940 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.502, Acc: 0.765, Base Lr: 4.04e-03
2022-04-21 17:02:21,493 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.259[s] Speed: 61.8[samples/s]
2022-04-21 17:04:01,663 reid_baseline.train INFO: normal accuracy 0.7601560706908423 2.26674747467041 
2022-04-21 17:04:32,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 17:04:32,301 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 226.7%
2022-04-21 17:04:59,328 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.344, Acc: 0.805, Base Lr: 4.83e-03
2022-04-21 17:05:24,027 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.343, Acc: 0.800, Base Lr: 4.83e-03
2022-04-21 17:05:41,730 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.254[s] Speed: 62.9[samples/s]
2022-04-21 17:07:27,685 reid_baseline.train INFO: normal accuracy 0.7775992655496902 2.0544610023498535 
2022-04-21 17:07:57,664 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 17:07:57,664 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 205.4%
2022-04-21 17:08:24,725 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.274, Acc: 0.822, Base Lr: 5.62e-03
2022-04-21 17:08:49,270 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.251, Acc: 0.836, Base Lr: 5.62e-03
2022-04-21 17:09:07,586 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-21 17:10:47,614 reid_baseline.train INFO: normal accuracy 0.7780582969933441 1.950050711631775 
2022-04-21 17:11:17,604 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 17:11:17,604 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 195.0%
2022-04-21 17:11:46,602 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.169, Acc: 0.862, Base Lr: 6.42e-03
2022-04-21 17:12:11,377 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.170, Acc: 0.856, Base Lr: 6.42e-03
2022-04-21 17:12:31,357 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.270[s] Speed: 59.2[samples/s]
2022-04-21 17:14:09,018 reid_baseline.train INFO: normal accuracy 0.786550378700941 1.8343048095703125 
2022-04-21 17:14:39,019 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 17:14:39,019 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 183.4%
2022-04-21 17:15:05,806 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.105, Acc: 0.872, Base Lr: 7.21e-03
2022-04-21 17:15:30,569 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.100, Acc: 0.879, Base Lr: 7.21e-03
2022-04-21 17:15:47,243 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.250[s] Speed: 64.0[samples/s]
2022-04-21 17:17:24,757 reid_baseline.train INFO: normal accuracy 0.7833371585953638 1.766855239868164 
2022-04-21 17:17:54,734 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 17:17:54,735 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 176.7%
2022-04-21 17:18:21,331 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.039, Acc: 0.894, Base Lr: 4.01e-03
2022-04-21 17:18:47,662 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.020, Acc: 0.904, Base Lr: 4.01e-03
2022-04-21 17:19:05,868 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.260[s] Speed: 61.4[samples/s]
2022-04-21 17:21:13,387 reid_baseline.train INFO: normal accuracy 0.7913702088593069 1.7974520921707153 
2022-04-21 17:21:13,387 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 17:21:13,388 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 179.7%
2022-04-21 17:21:39,338 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.002, Acc: 0.913, Base Lr: 3.38e-03
2022-04-21 17:22:02,901 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.016, Acc: 0.913, Base Lr: 3.38e-03
2022-04-21 17:22:19,215 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.241[s] Speed: 66.4[samples/s]
2022-04-21 17:23:59,361 reid_baseline.train INFO: normal accuracy 0.7934358503557494 1.7154908180236816 
2022-04-21 17:24:29,364 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 17:24:29,365 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 171.5%
2022-04-21 17:24:56,636 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.036, Acc: 0.898, Base Lr: 2.77e-03
2022-04-21 17:25:21,513 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.009, Acc: 0.911, Base Lr: 2.77e-03
2022-04-21 17:25:41,162 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.263[s] Speed: 60.9[samples/s]
2022-04-21 17:27:19,712 reid_baseline.train INFO: normal accuracy 0.7902226302501721 1.6964833736419678 
2022-04-21 17:27:50,379 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 17:27:50,380 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 169.6%
2022-04-21 17:28:17,598 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.993, Acc: 0.914, Base Lr: 2.20e-03
2022-04-21 17:28:50,763 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.990, Acc: 0.921, Base Lr: 2.20e-03
2022-04-21 17:29:11,612 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-21 17:30:53,752 reid_baseline.train INFO: normal accuracy 0.7971081019049805 1.771094560623169 
2022-04-21 17:30:53,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 17:30:53,753 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 177.1%
2022-04-21 17:31:21,188 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.969, Acc: 0.912, Base Lr: 1.66e-03
2022-04-21 17:31:47,595 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.947, Acc: 0.923, Base Lr: 1.66e-03
2022-04-21 17:32:06,770 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-21 17:33:39,991 reid_baseline.train INFO: normal accuracy 0.7929768189120955 1.732045292854309 
2022-04-21 17:33:39,992 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 17:33:39,992 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 173.2%
2022-04-21 17:34:07,145 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.910, Acc: 0.933, Base Lr: 1.19e-03
2022-04-21 17:34:31,719 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.931, Acc: 0.928, Base Lr: 1.19e-03
2022-04-21 17:34:49,708 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.255[s] Speed: 62.7[samples/s]
2022-04-21 17:36:29,345 reid_baseline.train INFO: normal accuracy 0.790681661693826 1.756016731262207 
2022-04-21 17:36:29,348 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 17:36:29,348 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 175.6%
2022-04-21 17:36:56,538 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.939, Acc: 0.933, Base Lr: 7.78e-04
2022-04-21 17:37:22,609 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.943, Acc: 0.929, Base Lr: 7.78e-04
2022-04-21 17:37:41,506 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.264[s] Speed: 60.6[samples/s]
2022-04-21 17:39:20,489 reid_baseline.train INFO: normal accuracy 0.7941243975212302 1.718586802482605 
2022-04-21 17:39:20,490 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 17:39:20,490 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 171.9%
2022-04-21 17:39:45,788 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.957, Acc: 0.922, Base Lr: 4.51e-04
2022-04-21 17:40:10,303 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.942, Acc: 0.923, Base Lr: 4.51e-04
2022-04-21 17:40:28,862 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.250[s] Speed: 64.0[samples/s]
2022-04-21 17:42:04,982 reid_baseline.train INFO: normal accuracy 0.7943539132430572 1.7417031526565552 
2022-04-21 17:42:04,983 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 17:42:04,983 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 174.2%
2022-04-21 17:42:33,618 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.923, Acc: 0.938, Base Lr: 2.11e-04
2022-04-21 17:42:58,035 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.921, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 17:43:16,172 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.261[s] Speed: 61.4[samples/s]
2022-04-21 17:44:56,299 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.725784182548523 
2022-04-21 17:44:56,299 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 17:44:56,300 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 172.6%
2022-04-21 17:45:25,361 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.915, Acc: 0.934, Base Lr: 6.51e-05
2022-04-21 17:45:51,721 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.932, Acc: 0.928, Base Lr: 6.51e-05
2022-04-21 17:46:10,321 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-21 17:47:49,018 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.6985220909118652 
2022-04-21 17:47:49,018 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 17:47:49,019 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 169.9%
2022-04-21 17:48:15,733 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.903, Acc: 0.939, Base Lr: 1.60e-05
2022-04-21 17:48:42,147 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.914, Acc: 0.935, Base Lr: 1.60e-05
2022-04-21 17:49:01,830 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.266[s] Speed: 60.1[samples/s]
2022-04-21 17:51:13,598 reid_baseline.train INFO: normal accuracy 0.7977966490704613 1.6607080698013306 
2022-04-21 17:51:43,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 17:51:43,602 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 166.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-21 17:53:51,574 reid_baseline.train INFO: normal accuracy 0.7977966490704613 1.6607080698013306 
2022-04-21 17:53:51,575 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 17:53:51,575 reid_baseline.train INFO: Accuracy: 79.8%
2022-04-21 17:55:27,529 reid_baseline.train INFO: normal accuracy 0.7977966490704613 1.6607080698013306 
2022-04-21 17:55:27,530 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 17:55:27,530 reid_baseline.train INFO: Shuffled Accuracy: 79.8%
2022-04-21 17:56:08,954 reid_baseline.train INFO: normal accuracy 0.9599083619702177 0.7756245136260986 
2022-04-21 17:56:08,954 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 17:56:08,955 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-21 17:56:14,110 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2
2022-04-21 17:56:14,110 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-21 17:56:14,110 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 17:56:14,110 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 17:56:14,111 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 17:56:21,109 reid_baseline.train INFO: start training
2022-04-21 17:56:53,950 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.982, Acc: 0.280, Base Lr: 8.72e-04
2022-04-21 17:57:21,924 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.903, Acc: 0.376, Base Lr: 8.72e-04
2022-04-21 17:57:41,961 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-21 17:58:12,690 reid_baseline.train INFO: normal accuracy 0.5092707045735476 4.166680335998535 
2022-04-21 17:58:42,607 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 17:58:42,608 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-21 17:59:10,996 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.484, Acc: 0.551, Base Lr: 1.66e-03
2022-04-21 17:59:36,511 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.318, Acc: 0.555, Base Lr: 1.66e-03
2022-04-21 17:59:55,574 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-21 18:00:26,251 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.029119491577148 
2022-04-21 18:00:56,232 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 18:00:56,232 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-21 18:01:25,204 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.543, Acc: 0.601, Base Lr: 2.46e-03
2022-04-21 18:01:53,126 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.391, Acc: 0.610, Base Lr: 2.46e-03
2022-04-21 18:02:14,899 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-21 18:02:49,732 reid_baseline.train INFO: normal accuracy 0.6258755665430573 3.4613373279571533 
2022-04-21 18:03:19,742 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 18:03:19,742 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 346.1%
2022-04-21 18:03:48,299 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.827, Acc: 0.683, Base Lr: 3.25e-03
2022-04-21 18:04:14,182 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.752, Acc: 0.709, Base Lr: 3.25e-03
2022-04-21 18:04:33,929 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.272[s] Speed: 58.9[samples/s]
2022-04-21 18:05:05,929 reid_baseline.train INFO: normal accuracy 0.6839719818706221 2.813891887664795 
2022-04-21 18:05:35,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 18:05:35,910 reid_baseline.train INFO: Accuracy: 68.4% Mean Entropy: 281.4%
2022-04-21 18:06:04,169 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.481, Acc: 0.773, Base Lr: 4.04e-03
2022-04-21 18:06:29,216 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.444, Acc: 0.765, Base Lr: 4.04e-03
2022-04-21 18:06:45,849 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-21 18:07:14,943 reid_baseline.train INFO: normal accuracy 0.7066337041615163 2.510343313217163 
2022-04-21 18:07:44,918 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 18:07:44,919 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 251.0%
2022-04-21 18:08:12,795 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.290, Acc: 0.805, Base Lr: 4.83e-03
2022-04-21 18:08:38,699 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.283, Acc: 0.800, Base Lr: 4.83e-03
2022-04-21 18:08:57,584 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.266[s] Speed: 60.1[samples/s]
2022-04-21 18:09:30,570 reid_baseline.train INFO: normal accuracy 0.723114956736712 2.283700942993164 
2022-04-21 18:10:00,576 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 18:10:00,576 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 228.4%
2022-04-21 18:10:29,923 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.199, Acc: 0.824, Base Lr: 5.62e-03
2022-04-21 18:10:55,150 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.174, Acc: 0.836, Base Lr: 5.62e-03
2022-04-21 18:11:14,013 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.269[s] Speed: 59.6[samples/s]
2022-04-21 18:11:44,238 reid_baseline.train INFO: normal accuracy 0.7321796456530696 2.1587326526641846 
2022-04-21 18:12:14,215 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 18:12:14,215 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 215.9%
2022-04-21 18:12:42,493 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.093, Acc: 0.861, Base Lr: 6.42e-03
2022-04-21 18:13:07,497 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.095, Acc: 0.857, Base Lr: 6.42e-03
2022-04-21 18:13:25,796 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.262[s] Speed: 61.0[samples/s]
2022-04-21 18:13:57,551 reid_baseline.train INFO: normal accuracy 0.7441285537700866 2.0106053352355957 
2022-04-21 18:14:27,523 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 18:14:27,524 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 201.1%
2022-04-21 18:14:56,864 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.030, Acc: 0.872, Base Lr: 7.21e-03
2022-04-21 18:15:21,426 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.018, Acc: 0.878, Base Lr: 7.21e-03
2022-04-21 18:15:41,070 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.269[s] Speed: 59.4[samples/s]
2022-04-21 18:16:12,251 reid_baseline.train INFO: normal accuracy 0.7367119901112484 1.9449421167373657 
2022-04-21 18:16:42,235 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 18:16:42,235 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 194.5%
2022-04-21 18:17:10,221 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.961, Acc: 0.895, Base Lr: 4.01e-03
2022-04-21 18:17:37,957 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.950, Acc: 0.905, Base Lr: 4.01e-03
2022-04-21 18:17:55,100 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-21 18:18:56,486 reid_baseline.train INFO: normal accuracy 0.7412443345694273 1.9450722932815552 
2022-04-21 18:18:56,486 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 18:18:56,487 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 194.5%
2022-04-21 18:19:20,962 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.917, Acc: 0.913, Base Lr: 3.38e-03
2022-04-21 18:19:43,295 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.927, Acc: 0.914, Base Lr: 3.38e-03
2022-04-21 18:20:03,408 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.245[s] Speed: 65.4[samples/s]
2022-04-21 18:20:35,541 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.858926773071289 
2022-04-21 18:21:05,514 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 18:21:05,515 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 185.9%
2022-04-21 18:21:33,869 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.945, Acc: 0.898, Base Lr: 2.77e-03
2022-04-21 18:21:57,736 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.914, Acc: 0.911, Base Lr: 2.77e-03
2022-04-21 18:22:15,919 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-21 18:22:48,539 reid_baseline.train INFO: normal accuracy 0.749896992171405 1.840006709098816 
2022-04-21 18:23:18,559 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 18:23:18,559 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 184.0%
2022-04-21 18:23:47,354 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.909, Acc: 0.914, Base Lr: 2.20e-03
2022-04-21 18:24:13,022 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.898, Acc: 0.921, Base Lr: 2.20e-03
2022-04-21 18:24:30,959 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-21 18:25:01,169 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.9046204090118408 
2022-04-21 18:25:01,169 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 18:25:01,169 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 190.5%
2022-04-21 18:25:28,211 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.910, Acc: 0.912, Base Lr: 1.66e-03
2022-04-21 18:25:52,426 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.888, Acc: 0.923, Base Lr: 1.66e-03
2022-04-21 18:26:12,252 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.260[s] Speed: 61.5[samples/s]
2022-04-21 18:26:42,872 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.8688914775848389 
2022-04-21 18:26:42,874 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 18:26:42,875 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 186.9%
2022-04-21 18:27:09,547 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.855, Acc: 0.933, Base Lr: 1.19e-03
2022-04-21 18:27:34,094 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.873, Acc: 0.928, Base Lr: 1.19e-03
2022-04-21 18:27:53,633 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.259[s] Speed: 61.8[samples/s]
2022-04-21 18:28:27,788 reid_baseline.train INFO: normal accuracy 0.7515451174289246 1.8814146518707275 
2022-04-21 18:28:27,788 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 18:28:27,788 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 188.1%
2022-04-21 18:28:53,935 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.882, Acc: 0.933, Base Lr: 7.78e-04
2022-04-21 18:29:21,083 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.869, Acc: 0.929, Base Lr: 7.78e-04
2022-04-21 18:29:39,662 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.263[s] Speed: 60.8[samples/s]
2022-04-21 18:30:11,694 reid_baseline.train INFO: normal accuracy 0.7519571487433044 1.8505525588989258 
2022-04-21 18:30:11,695 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 18:30:11,695 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 185.1%
2022-04-21 18:30:39,361 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.862, Acc: 0.921, Base Lr: 4.51e-04
2022-04-21 18:31:03,774 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.868, Acc: 0.923, Base Lr: 4.51e-04
2022-04-21 18:31:23,245 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.262[s] Speed: 61.2[samples/s]
2022-04-21 18:31:51,280 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8709193468093872 
2022-04-21 18:31:51,281 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 18:31:51,281 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 187.1%
2022-04-21 18:32:19,547 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.844, Acc: 0.937, Base Lr: 2.11e-04
2022-04-21 18:32:46,163 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.855, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 18:33:05,723 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.273[s] Speed: 58.7[samples/s]
2022-04-21 18:33:38,064 reid_baseline.train INFO: normal accuracy 0.7470127729707458 1.8453415632247925 
2022-04-21 18:33:38,064 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 18:33:38,065 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 184.5%
2022-04-21 18:34:01,715 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.848, Acc: 0.934, Base Lr: 6.51e-05
2022-04-21 18:34:27,143 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.856, Acc: 0.927, Base Lr: 6.51e-05
2022-04-21 18:34:47,136 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.253[s] Speed: 63.3[samples/s]
2022-04-21 18:35:19,491 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.832193374633789 
2022-04-21 18:35:49,464 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 18:35:49,465 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.2%
2022-04-21 18:36:16,663 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.847, Acc: 0.939, Base Lr: 1.60e-05
2022-04-21 18:36:40,913 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.854, Acc: 0.935, Base Lr: 1.60e-05
2022-04-21 18:36:57,087 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.248[s] Speed: 64.6[samples/s]
2022-04-21 18:38:00,827 reid_baseline.train INFO: normal accuracy 0.7515451174289246 1.793925166130066 
2022-04-21 18:38:30,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 18:38:30,852 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 179.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-21 18:39:30,359 reid_baseline.train INFO: normal accuracy 0.7515451174289246 1.793925166130066 
2022-04-21 18:39:30,359 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 18:39:30,360 reid_baseline.train INFO: Accuracy: 75.2%
2022-04-21 18:40:02,784 reid_baseline.train INFO: normal accuracy 0.7515451174289246 1.793925166130066 
2022-04-21 18:40:02,784 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 18:40:02,785 reid_baseline.train INFO: Shuffled Accuracy: 75.2%
2022-04-21 18:40:44,075 reid_baseline.train INFO: normal accuracy 0.9601374570446736 0.7758464217185974 
2022-04-21 18:40:44,076 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 18:40:44,076 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-21 18:40:49,359 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2
2022-04-21 18:40:49,359 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-21 18:40:49,360 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 18:40:49,360 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 18:40:49,360 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 18:40:56,241 reid_baseline.train INFO: start training
2022-04-21 18:41:27,709 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.982, Acc: 0.280, Base Lr: 8.72e-04
2022-04-21 18:41:51,772 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.903, Acc: 0.376, Base Lr: 8.72e-04
2022-04-21 18:42:09,366 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-21 18:42:51,649 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.164180278778076 
2022-04-21 18:43:21,566 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 18:43:21,566 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-21 18:43:46,329 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.484, Acc: 0.551, Base Lr: 1.66e-03
2022-04-21 18:44:08,947 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.318, Acc: 0.555, Base Lr: 1.66e-03
2022-04-21 18:44:28,424 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.245[s] Speed: 65.3[samples/s]
2022-04-21 18:45:07,527 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.9683773517608643 
2022-04-21 18:45:37,511 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 18:45:37,511 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-21 18:46:04,608 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.543, Acc: 0.601, Base Lr: 2.46e-03
2022-04-21 18:46:27,834 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.391, Acc: 0.610, Base Lr: 2.46e-03
2022-04-21 18:46:47,390 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-21 18:47:27,770 reid_baseline.train INFO: normal accuracy 0.6449650822257265 3.2464523315429688 
2022-04-21 18:47:57,773 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 18:47:57,774 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.6%
2022-04-21 18:48:24,729 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.827, Acc: 0.684, Base Lr: 3.25e-03
2022-04-21 18:48:49,632 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.752, Acc: 0.710, Base Lr: 3.25e-03
2022-04-21 18:49:08,415 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.259[s] Speed: 61.9[samples/s]
2022-04-21 18:49:48,195 reid_baseline.train INFO: normal accuracy 0.7087181797702186 2.5374226570129395 
2022-04-21 18:50:18,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 18:50:18,194 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 253.7%
2022-04-21 18:50:45,200 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.481, Acc: 0.773, Base Lr: 4.04e-03
2022-04-21 18:51:09,874 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.444, Acc: 0.765, Base Lr: 4.04e-03
2022-04-21 18:51:27,358 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.253[s] Speed: 63.3[samples/s]
2022-04-21 18:52:02,918 reid_baseline.train INFO: normal accuracy 0.7256138769993242 2.2066469192504883 
2022-04-21 18:52:32,898 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 18:52:32,898 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 220.7%
2022-04-21 18:52:58,349 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.290, Acc: 0.805, Base Lr: 4.83e-03
2022-04-21 18:53:23,379 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.284, Acc: 0.800, Base Lr: 4.83e-03
2022-04-21 18:53:43,607 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.259[s] Speed: 61.8[samples/s]
2022-04-21 18:54:27,634 reid_baseline.train INFO: normal accuracy 0.7382293309303898 1.9949312210083008 
2022-04-21 18:54:57,618 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 18:54:57,618 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 199.5%
2022-04-21 18:55:24,233 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.199, Acc: 0.823, Base Lr: 5.62e-03
2022-04-21 18:55:48,700 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.174, Acc: 0.836, Base Lr: 5.62e-03
2022-04-21 18:56:07,273 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.255[s] Speed: 62.7[samples/s]
2022-04-21 18:56:47,767 reid_baseline.train INFO: normal accuracy 0.7551250281594953 1.8890392780303955 
2022-04-21 18:57:17,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 18:57:17,752 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 188.9%
2022-04-21 18:57:45,182 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.094, Acc: 0.861, Base Lr: 6.42e-03
2022-04-21 18:58:12,094 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.094, Acc: 0.855, Base Lr: 6.42e-03
2022-04-21 18:58:31,510 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.270[s] Speed: 59.2[samples/s]
2022-04-21 18:59:13,462 reid_baseline.train INFO: normal accuracy 0.7603063753097544 1.8209192752838135 
2022-04-21 18:59:43,419 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 18:59:43,419 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 182.1%
2022-04-21 19:00:09,526 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.030, Acc: 0.872, Base Lr: 7.21e-03
2022-04-21 19:00:34,847 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.018, Acc: 0.879, Base Lr: 7.21e-03
2022-04-21 19:00:54,328 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.260[s] Speed: 61.6[samples/s]
2022-04-21 19:01:35,888 reid_baseline.train INFO: normal accuracy 0.7621085830141924 1.747604250907898 
2022-04-21 19:02:05,869 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 19:02:05,869 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 174.8%
2022-04-21 19:02:34,363 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.960, Acc: 0.894, Base Lr: 4.01e-03
2022-04-21 19:02:57,405 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.950, Acc: 0.904, Base Lr: 4.01e-03
2022-04-21 19:03:17,676 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.263[s] Speed: 60.8[samples/s]
2022-04-21 19:04:28,882 reid_baseline.train INFO: normal accuracy 0.7652624464969587 1.7921600341796875 
2022-04-21 19:04:28,883 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 19:04:28,883 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 179.2%
2022-04-21 19:04:56,388 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.917, Acc: 0.913, Base Lr: 3.38e-03
2022-04-21 19:05:21,212 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.927, Acc: 0.912, Base Lr: 3.38e-03
2022-04-21 19:05:40,055 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.261[s] Speed: 61.4[samples/s]
2022-04-21 19:06:17,029 reid_baseline.train INFO: normal accuracy 0.7693174138319442 1.6998118162155151 
2022-04-21 19:06:47,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 19:06:47,009 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.0%
2022-04-21 19:07:15,404 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.945, Acc: 0.898, Base Lr: 2.77e-03
2022-04-21 19:07:38,946 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.914, Acc: 0.911, Base Lr: 2.77e-03
2022-04-21 19:07:57,103 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.257[s] Speed: 62.3[samples/s]
2022-04-21 19:08:37,148 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.6859458684921265 
2022-04-21 19:09:07,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 19:09:07,143 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.6%
2022-04-21 19:09:33,322 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.909, Acc: 0.913, Base Lr: 2.20e-03
2022-04-21 19:09:59,300 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.898, Acc: 0.921, Base Lr: 2.20e-03
2022-04-21 19:10:17,257 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.257[s] Speed: 62.3[samples/s]
2022-04-21 19:10:59,647 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.7574150562286377 
2022-04-21 19:10:59,648 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 19:10:59,648 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.7%
2022-04-21 19:11:23,716 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.910, Acc: 0.913, Base Lr: 1.66e-03
2022-04-21 19:11:47,880 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.888, Acc: 0.924, Base Lr: 1.66e-03
2022-04-21 19:12:07,380 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.248[s] Speed: 64.5[samples/s]
2022-04-21 19:12:48,563 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.724307894706726 
2022-04-21 19:12:48,563 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 19:12:48,564 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.4%
2022-04-21 19:13:14,796 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.855, Acc: 0.933, Base Lr: 1.19e-03
2022-04-21 19:13:39,175 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.873, Acc: 0.928, Base Lr: 1.19e-03
2022-04-21 19:13:57,313 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.252[s] Speed: 63.5[samples/s]
2022-04-21 19:14:35,049 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.753348469734192 
2022-04-21 19:14:35,050 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 19:14:35,050 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.3%
2022-04-21 19:15:00,461 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.881, Acc: 0.932, Base Lr: 7.78e-04
2022-04-21 19:15:25,889 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.869, Acc: 0.929, Base Lr: 7.78e-04
2022-04-21 19:15:44,292 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.254[s] Speed: 63.1[samples/s]
2022-04-21 19:16:24,808 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7086536884307861 
2022-04-21 19:16:24,809 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 19:16:24,810 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.9%
2022-04-21 19:16:51,516 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.862, Acc: 0.922, Base Lr: 4.51e-04
2022-04-21 19:17:16,135 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.868, Acc: 0.923, Base Lr: 4.51e-04
2022-04-21 19:17:33,917 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.253[s] Speed: 63.3[samples/s]
2022-04-21 19:18:13,492 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.7307730913162231 
2022-04-21 19:18:13,493 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 19:18:13,493 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 173.1%
2022-04-21 19:18:40,059 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.844, Acc: 0.938, Base Lr: 2.11e-04
2022-04-21 19:19:05,590 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.855, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 19:19:21,204 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.248[s] Speed: 64.5[samples/s]
2022-04-21 19:20:01,125 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.7128783464431763 
2022-04-21 19:20:01,126 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 19:20:01,126 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 171.3%
2022-04-21 19:20:27,566 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.848, Acc: 0.934, Base Lr: 6.51e-05
2022-04-21 19:20:52,049 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.856, Acc: 0.927, Base Lr: 6.51e-05
2022-04-21 19:21:10,019 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.252[s] Speed: 63.4[samples/s]
2022-04-21 19:21:47,557 reid_baseline.train INFO: normal accuracy 0.7735976571299842 1.683821439743042 
2022-04-21 19:22:17,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 19:22:17,533 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.4%
2022-04-21 19:22:42,976 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.847, Acc: 0.939, Base Lr: 1.60e-05
2022-04-21 19:23:08,166 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.854, Acc: 0.935, Base Lr: 1.60e-05
2022-04-21 19:23:27,039 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.255[s] Speed: 62.8[samples/s]
2022-04-21 19:24:34,211 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6500825881958008 
2022-04-21 19:25:04,192 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 19:25:04,193 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-21 19:26:19,349 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6500825881958008 
2022-04-21 19:26:19,349 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 19:26:19,349 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-21 19:26:56,169 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6500825881958008 
2022-04-21 19:26:56,169 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 19:26:56,169 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-21 19:27:38,147 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7758615612983704 
2022-04-21 19:27:38,147 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 19:27:38,148 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-21 19:27:43,537 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2
2022-04-21 19:27:43,537 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-21 19:27:43,537 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 19:27:43,537 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 19:27:43,539 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 19:27:51,317 reid_baseline.train INFO: start training
2022-04-21 19:28:25,585 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 5.982, Acc: 0.280, Base Lr: 8.72e-04
2022-04-21 19:28:51,064 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.903, Acc: 0.377, Base Lr: 8.72e-04
2022-04-21 19:29:10,752 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-21 19:30:53,690 reid_baseline.train INFO: normal accuracy 0.5685104429653431 4.165801525115967 
2022-04-21 19:31:23,615 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 19:31:23,615 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 416.6%
2022-04-21 19:31:48,264 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.484, Acc: 0.550, Base Lr: 1.66e-03
2022-04-21 19:32:11,769 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.318, Acc: 0.555, Base Lr: 1.66e-03
2022-04-21 19:32:32,105 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.251[s] Speed: 63.8[samples/s]
2022-04-21 19:34:20,697 reid_baseline.train INFO: normal accuracy 0.602478769795731 3.995260715484619 
2022-04-21 19:34:50,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 19:34:50,688 reid_baseline.train INFO: Accuracy: 60.2% Mean Entropy: 399.5%
2022-04-21 19:35:20,916 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.543, Acc: 0.602, Base Lr: 2.46e-03
2022-04-21 19:35:45,864 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.391, Acc: 0.610, Base Lr: 2.46e-03
2022-04-21 19:36:04,393 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.269[s] Speed: 59.4[samples/s]
2022-04-21 19:37:43,678 reid_baseline.train INFO: normal accuracy 0.6750057378930456 3.30145263671875 
2022-04-21 19:38:13,660 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 19:38:13,660 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 330.1%
2022-04-21 19:38:40,817 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.827, Acc: 0.684, Base Lr: 3.25e-03
2022-04-21 19:39:06,789 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.752, Acc: 0.710, Base Lr: 3.25e-03
2022-04-21 19:39:25,642 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.263[s] Speed: 60.8[samples/s]
2022-04-21 19:41:13,065 reid_baseline.train INFO: normal accuracy 0.7339912784025706 2.587632417678833 
2022-04-21 19:41:43,024 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 19:41:43,024 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 258.8%
2022-04-21 19:42:12,319 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.481, Acc: 0.773, Base Lr: 4.04e-03
2022-04-21 19:42:40,152 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.444, Acc: 0.765, Base Lr: 4.04e-03
2022-04-21 19:42:58,444 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.276[s] Speed: 57.9[samples/s]
2022-04-21 19:45:03,035 reid_baseline.train INFO: normal accuracy 0.7599265549690154 2.2665762901306152 
2022-04-21 19:45:33,003 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 19:45:33,004 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 226.7%
2022-04-21 19:46:03,980 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.290, Acc: 0.806, Base Lr: 4.83e-03
2022-04-21 19:46:31,391 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.283, Acc: 0.800, Base Lr: 4.83e-03
2022-04-21 19:46:49,301 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.279[s] Speed: 57.3[samples/s]
2022-04-21 19:49:02,547 reid_baseline.train INFO: normal accuracy 0.7769107183842093 2.054814338684082 
2022-04-21 19:49:32,526 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 19:49:32,527 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 205.5%
2022-04-21 19:50:04,164 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.200, Acc: 0.824, Base Lr: 5.62e-03
2022-04-21 19:50:32,814 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.174, Acc: 0.836, Base Lr: 5.62e-03
2022-04-21 19:50:55,450 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-21 19:53:10,503 reid_baseline.train INFO: normal accuracy 0.7775992655496902 1.9473010301589966 
2022-04-21 19:53:40,468 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 19:53:40,469 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 194.7%
2022-04-21 19:54:17,191 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.094, Acc: 0.860, Base Lr: 6.42e-03
2022-04-21 19:54:44,570 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.095, Acc: 0.855, Base Lr: 6.42e-03
2022-04-21 19:55:03,089 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-21 19:57:15,545 reid_baseline.train INFO: normal accuracy 0.7863208629791141 1.834808111190796 
2022-04-21 19:57:45,525 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 19:57:45,525 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 183.5%
2022-04-21 19:58:18,412 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.030, Acc: 0.873, Base Lr: 7.21e-03
2022-04-21 19:58:45,976 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.018, Acc: 0.880, Base Lr: 7.21e-03
2022-04-21 19:59:09,179 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.306[s] Speed: 52.2[samples/s]
2022-04-21 20:01:18,051 reid_baseline.train INFO: normal accuracy 0.7844847372044985 1.769212007522583 
2022-04-21 20:01:48,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 20:01:48,204 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 176.9%
2022-04-21 20:02:22,409 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.961, Acc: 0.894, Base Lr: 4.01e-03
2022-04-21 20:02:55,796 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.950, Acc: 0.904, Base Lr: 4.01e-03
2022-04-21 20:03:15,521 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-21 20:06:01,182 reid_baseline.train INFO: normal accuracy 0.7902226302501721 1.7961236238479614 
2022-04-21 20:06:01,184 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 20:06:01,185 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 179.6%
2022-04-21 20:06:40,045 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.918, Acc: 0.915, Base Lr: 3.38e-03
2022-04-21 20:07:07,067 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.928, Acc: 0.914, Base Lr: 3.38e-03
2022-04-21 20:07:29,815 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.324[s] Speed: 49.3[samples/s]
2022-04-21 20:09:39,402 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.7147197723388672 
2022-04-21 20:10:09,443 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 20:10:09,444 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 171.5%
2022-04-21 20:10:48,625 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 2.945, Acc: 0.898, Base Lr: 2.77e-03
2022-04-21 20:11:22,363 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.914, Acc: 0.911, Base Lr: 2.77e-03
2022-04-21 20:11:43,703 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.345[s] Speed: 46.3[samples/s]
2022-04-21 20:14:00,150 reid_baseline.train INFO: normal accuracy 0.790681661693826 1.6966521739959717 
2022-04-21 20:14:30,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 20:14:30,123 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 169.7%
2022-04-21 20:15:03,775 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.909, Acc: 0.914, Base Lr: 2.20e-03
2022-04-21 20:15:33,969 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.898, Acc: 0.921, Base Lr: 2.20e-03
2022-04-21 20:15:55,491 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.312[s] Speed: 51.2[samples/s]
2022-04-21 20:18:22,555 reid_baseline.train INFO: normal accuracy 0.7959605232958458 1.7697436809539795 
2022-04-21 20:18:22,556 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 20:18:22,556 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 177.0%
2022-04-21 20:18:59,845 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.911, Acc: 0.913, Base Lr: 1.66e-03
2022-04-21 20:19:34,806 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.888, Acc: 0.924, Base Lr: 1.66e-03
2022-04-21 20:19:56,490 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-21 20:22:22,615 reid_baseline.train INFO: normal accuracy 0.7927473031902685 1.73134446144104 
2022-04-21 20:22:22,617 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 20:22:22,618 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 173.1%
2022-04-21 20:23:04,408 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.855, Acc: 0.933, Base Lr: 1.19e-03
2022-04-21 20:23:44,977 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.873, Acc: 0.928, Base Lr: 1.19e-03
2022-04-21 20:24:08,470 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.388[s] Speed: 41.3[samples/s]
2022-04-21 20:26:19,409 reid_baseline.train INFO: normal accuracy 0.7920587560247877 1.7554130554199219 
2022-04-21 20:26:19,409 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 20:26:19,410 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 175.5%
2022-04-21 20:26:47,852 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.882, Acc: 0.932, Base Lr: 7.78e-04
2022-04-21 20:27:23,025 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.869, Acc: 0.929, Base Lr: 7.78e-04
2022-04-21 20:27:44,036 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.310[s] Speed: 51.7[samples/s]
2022-04-21 20:30:08,820 reid_baseline.train INFO: normal accuracy 0.7936653660775763 1.7179008722305298 
2022-04-21 20:30:08,821 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 20:30:08,821 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 171.8%
2022-04-21 20:30:52,983 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.862, Acc: 0.921, Base Lr: 4.51e-04
2022-04-21 20:31:27,084 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.868, Acc: 0.924, Base Lr: 4.51e-04
2022-04-21 20:31:53,651 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-04-21 20:34:43,568 reid_baseline.train INFO: normal accuracy 0.7941243975212302 1.740737795829773 
2022-04-21 20:34:43,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 20:34:43,569 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 174.1%
2022-04-21 20:35:26,091 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.844, Acc: 0.937, Base Lr: 2.11e-04
2022-04-21 20:36:03,497 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.855, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 20:36:31,053 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.394[s] Speed: 40.7[samples/s]
2022-04-21 20:39:10,922 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.725472092628479 
2022-04-21 20:39:10,923 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 20:39:10,923 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 172.5%
2022-04-21 20:39:49,160 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.849, Acc: 0.934, Base Lr: 6.51e-05
2022-04-21 20:40:24,177 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.856, Acc: 0.927, Base Lr: 6.51e-05
2022-04-21 20:40:45,257 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.345[s] Speed: 46.3[samples/s]
2022-04-21 20:43:14,553 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.6980940103530884 
2022-04-21 20:43:14,554 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 20:43:14,554 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 169.8%
2022-04-21 20:43:53,352 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.847, Acc: 0.939, Base Lr: 1.60e-05
2022-04-21 20:44:29,188 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.855, Acc: 0.936, Base Lr: 1.60e-05
2022-04-21 20:44:54,999 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.368[s] Speed: 43.5[samples/s]
2022-04-21 20:48:12,899 reid_baseline.train INFO: normal accuracy 0.7975671333486344 1.6609915494918823 
2022-04-21 20:48:42,873 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 20:48:42,873 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 166.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-21 20:51:46,617 reid_baseline.train INFO: normal accuracy 0.7975671333486344 1.6609915494918823 
2022-04-21 20:51:46,619 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 20:51:46,619 reid_baseline.train INFO: Accuracy: 79.8%
2022-04-21 20:54:16,110 reid_baseline.train INFO: normal accuracy 0.7975671333486344 1.6609915494918823 
2022-04-21 20:54:16,111 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 20:54:16,111 reid_baseline.train INFO: Shuffled Accuracy: 79.8%
2022-04-21 20:55:11,439 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7763740420341492 
2022-04-21 20:55:11,440 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 20:55:11,440 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-21 20:55:18,424 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3
2022-04-21 20:55:18,425 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-21 20:55:18,426 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 20:55:18,427 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 20:55:18,428 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 20:55:27,008 reid_baseline.train INFO: start training
2022-04-21 20:56:13,807 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.022, Acc: 0.280, Base Lr: 8.72e-04
2022-04-21 20:56:49,785 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.956, Acc: 0.376, Base Lr: 8.72e-04
2022-04-21 20:57:12,176 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.382[s] Speed: 41.8[samples/s]
2022-04-21 20:57:56,388 reid_baseline.train INFO: normal accuracy 0.5092707045735476 4.166679859161377 
2022-04-21 20:58:26,448 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 20:58:26,451 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-21 20:59:06,845 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.556, Acc: 0.551, Base Lr: 1.66e-03
2022-04-21 20:59:49,249 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.380, Acc: 0.555, Base Lr: 1.66e-03
2022-04-21 21:00:16,283 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.402[s] Speed: 39.8[samples/s]
2022-04-21 21:01:07,162 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.029122829437256 
2022-04-21 21:01:37,137 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 21:01:37,139 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-21 21:02:16,292 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.598, Acc: 0.602, Base Lr: 2.46e-03
2022-04-21 21:02:47,471 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.451, Acc: 0.611, Base Lr: 2.46e-03
2022-04-21 21:03:14,518 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.357[s] Speed: 44.9[samples/s]
2022-04-21 21:03:59,177 reid_baseline.train INFO: normal accuracy 0.6258755665430573 3.4612934589385986 
2022-04-21 21:04:29,329 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 21:04:29,329 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 346.1%
2022-04-21 21:05:07,793 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.877, Acc: 0.684, Base Lr: 3.25e-03
2022-04-21 21:05:37,313 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.795, Acc: 0.710, Base Lr: 3.25e-03
2022-04-21 21:05:57,653 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.323[s] Speed: 49.5[samples/s]
2022-04-21 21:06:41,201 reid_baseline.train INFO: normal accuracy 0.6839719818706221 2.813971757888794 
2022-04-21 21:07:11,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 21:07:11,203 reid_baseline.train INFO: Accuracy: 68.4% Mean Entropy: 281.4%
2022-04-21 21:07:48,307 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.536, Acc: 0.773, Base Lr: 4.04e-03
2022-04-21 21:08:26,484 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.508, Acc: 0.765, Base Lr: 4.04e-03
2022-04-21 21:08:50,866 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-21 21:09:35,956 reid_baseline.train INFO: normal accuracy 0.7066337041615163 2.510418653488159 
2022-04-21 21:10:05,954 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 21:10:05,954 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 251.0%
2022-04-21 21:10:49,915 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.344, Acc: 0.805, Base Lr: 4.83e-03
2022-04-21 21:11:26,415 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.358, Acc: 0.800, Base Lr: 4.83e-03
2022-04-21 21:11:51,951 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.388[s] Speed: 41.2[samples/s]
2022-04-21 21:12:38,987 reid_baseline.train INFO: normal accuracy 0.722702925422332 2.284461498260498 
2022-04-21 21:13:08,949 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 21:13:08,949 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 228.4%
2022-04-21 21:13:50,315 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.298, Acc: 0.824, Base Lr: 5.62e-03
2022-04-21 21:14:18,024 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.251, Acc: 0.837, Base Lr: 5.62e-03
2022-04-21 21:14:38,850 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-21 21:15:23,845 reid_baseline.train INFO: normal accuracy 0.7321796456530696 2.1593236923217773 
2022-04-21 21:15:53,811 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 21:15:53,811 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 215.9%
2022-04-21 21:16:28,936 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.178, Acc: 0.861, Base Lr: 6.42e-03
2022-04-21 21:16:58,411 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.190, Acc: 0.856, Base Lr: 6.42e-03
2022-04-21 21:17:16,526 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-21 21:17:52,097 reid_baseline.train INFO: normal accuracy 0.7441285537700866 2.0120537281036377 
2022-04-21 21:18:22,278 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 21:18:22,279 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 201.2%
2022-04-21 21:18:56,560 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.128, Acc: 0.872, Base Lr: 7.21e-03
2022-04-21 21:19:27,385 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.110, Acc: 0.879, Base Lr: 7.21e-03
2022-04-21 21:19:44,766 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-21 21:20:18,483 reid_baseline.train INFO: normal accuracy 0.7354758961681088 1.9471197128295898 
2022-04-21 21:20:48,447 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 21:20:48,448 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 194.7%
2022-04-21 21:21:13,829 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.056, Acc: 0.894, Base Lr: 4.01e-03
2022-04-21 21:21:37,775 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.044, Acc: 0.904, Base Lr: 4.01e-03
2022-04-21 21:21:54,986 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.243[s] Speed: 65.8[samples/s]
2022-04-21 21:22:57,632 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.9451419115066528 
2022-04-21 21:23:27,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 21:23:27,621 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 194.5%
2022-04-21 21:23:54,731 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.996, Acc: 0.915, Base Lr: 3.38e-03
2022-04-21 21:24:24,980 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.009, Acc: 0.914, Base Lr: 3.38e-03
2022-04-21 21:24:44,849 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.282[s] Speed: 56.6[samples/s]
2022-04-21 21:25:15,200 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.859508752822876 
2022-04-21 21:25:45,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 21:25:45,173 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 186.0%
2022-04-21 21:26:11,322 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.032, Acc: 0.899, Base Lr: 2.77e-03
2022-04-21 21:26:38,147 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.000, Acc: 0.911, Base Lr: 2.77e-03
2022-04-21 21:26:58,624 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.269[s] Speed: 59.5[samples/s]
2022-04-21 21:27:34,317 reid_baseline.train INFO: normal accuracy 0.7478368355995055 1.839514136314392 
2022-04-21 21:28:04,323 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 21:28:04,323 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 184.0%
2022-04-21 21:28:30,744 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.995, Acc: 0.913, Base Lr: 2.20e-03
2022-04-21 21:28:58,444 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.988, Acc: 0.920, Base Lr: 2.20e-03
2022-04-21 21:29:16,756 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-21 21:29:51,838 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.903860330581665 
2022-04-21 21:29:51,839 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 21:29:51,839 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 190.4%
2022-04-21 21:30:21,100 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.986, Acc: 0.914, Base Lr: 1.66e-03
2022-04-21 21:30:47,606 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.982, Acc: 0.925, Base Lr: 1.66e-03
2022-04-21 21:31:08,497 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.281[s] Speed: 57.0[samples/s]
2022-04-21 21:31:43,038 reid_baseline.train INFO: normal accuracy 0.749896992171405 1.8682477474212646 
2022-04-21 21:31:43,040 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 21:31:43,041 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 186.8%
2022-04-21 21:32:12,260 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.947, Acc: 0.933, Base Lr: 1.19e-03
2022-04-21 21:32:42,077 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.945, Acc: 0.928, Base Lr: 1.19e-03
2022-04-21 21:33:03,478 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-21 21:33:38,780 reid_baseline.train INFO: normal accuracy 0.7511330861145447 1.8820708990097046 
2022-04-21 21:33:38,781 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 21:33:38,782 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 188.2%
2022-04-21 21:34:08,945 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.982, Acc: 0.932, Base Lr: 7.78e-04
2022-04-21 21:34:36,690 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.968, Acc: 0.929, Base Lr: 7.78e-04
2022-04-21 21:34:56,015 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.283[s] Speed: 56.6[samples/s]
2022-04-21 21:35:31,400 reid_baseline.train INFO: normal accuracy 0.7507210548001648 1.8509275913238525 
2022-04-21 21:35:31,400 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 21:35:31,401 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 185.1%
2022-04-21 21:36:01,926 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.946, Acc: 0.921, Base Lr: 4.51e-04
2022-04-21 21:36:24,896 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.947, Acc: 0.924, Base Lr: 4.51e-04
2022-04-21 21:36:45,562 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.272[s] Speed: 58.9[samples/s]
2022-04-21 21:37:16,954 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.870896577835083 
2022-04-21 21:37:16,956 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 21:37:16,957 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 187.1%
2022-04-21 21:37:46,425 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.918, Acc: 0.938, Base Lr: 2.11e-04
2022-04-21 21:38:12,542 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.923, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 21:38:31,732 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.274[s] Speed: 58.4[samples/s]
2022-04-21 21:39:11,150 reid_baseline.train INFO: normal accuracy 0.7470127729707458 1.845494270324707 
2022-04-21 21:39:11,150 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 21:39:11,151 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 184.5%
2022-04-21 21:39:43,067 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.920, Acc: 0.934, Base Lr: 6.51e-05
2022-04-21 21:40:10,693 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.938, Acc: 0.926, Base Lr: 6.51e-05
2022-04-21 21:40:31,060 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-21 21:41:08,405 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8325269222259521 
2022-04-21 21:41:38,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 21:41:38,395 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.3%
2022-04-21 21:42:05,234 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.936, Acc: 0.939, Base Lr: 1.60e-05
2022-04-21 21:42:28,039 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.938, Acc: 0.936, Base Lr: 1.60e-05
2022-04-21 21:42:49,713 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.261[s] Speed: 61.3[samples/s]
2022-04-21 21:43:56,428 reid_baseline.train INFO: normal accuracy 0.7527812113720643 1.7943072319030762 
2022-04-21 21:44:26,381 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 21:44:26,382 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 179.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-21 21:45:29,997 reid_baseline.train INFO: normal accuracy 0.7527812113720643 1.7943072319030762 
2022-04-21 21:45:29,998 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 21:45:29,998 reid_baseline.train INFO: Accuracy: 75.3%
2022-04-21 21:46:08,481 reid_baseline.train INFO: normal accuracy 0.7527812113720643 1.7943072319030762 
2022-04-21 21:46:08,481 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 21:46:08,482 reid_baseline.train INFO: Shuffled Accuracy: 75.3%
2022-04-21 21:46:54,630 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7761543393135071 
2022-04-21 21:46:54,630 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 21:46:54,631 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-21 21:47:01,552 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3
2022-04-21 21:47:01,553 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-21 21:47:01,553 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 21:47:01,553 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 21:47:01,553 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 21:47:08,579 reid_baseline.train INFO: start training
2022-04-21 21:47:46,116 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.022, Acc: 0.280, Base Lr: 8.72e-04
2022-04-21 21:48:11,632 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.956, Acc: 0.376, Base Lr: 8.72e-04
2022-04-21 21:48:29,225 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-21 21:49:06,505 reid_baseline.train INFO: normal accuracy 0.5433656228880378 4.164179801940918 
2022-04-21 21:49:36,414 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 21:49:36,415 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-21 21:50:05,329 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.556, Acc: 0.550, Base Lr: 1.66e-03
2022-04-21 21:50:32,063 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.380, Acc: 0.555, Base Lr: 1.66e-03
2022-04-21 21:50:49,293 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-21 21:51:31,246 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.968388795852661 
2022-04-21 21:52:01,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 21:52:01,195 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-21 21:52:30,390 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.598, Acc: 0.601, Base Lr: 2.46e-03
2022-04-21 21:52:54,036 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.451, Acc: 0.610, Base Lr: 2.46e-03
2022-04-21 21:53:14,783 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.269[s] Speed: 59.4[samples/s]
2022-04-21 21:53:56,339 reid_baseline.train INFO: normal accuracy 0.6449650822257265 3.2463815212249756 
2022-04-21 21:54:26,351 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 21:54:26,351 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.6%
2022-04-21 21:54:53,444 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.877, Acc: 0.684, Base Lr: 3.25e-03
2022-04-21 21:55:18,498 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.794, Acc: 0.710, Base Lr: 3.25e-03
2022-04-21 21:55:36,603 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.257[s] Speed: 62.2[samples/s]
2022-04-21 21:56:13,172 reid_baseline.train INFO: normal accuracy 0.7084929038071638 2.537485361099243 
2022-04-21 21:56:43,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 21:56:43,162 reid_baseline.train INFO: Accuracy: 70.8% Mean Entropy: 253.7%
2022-04-21 21:57:11,075 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.536, Acc: 0.773, Base Lr: 4.04e-03
2022-04-21 21:57:38,024 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.508, Acc: 0.765, Base Lr: 4.04e-03
2022-04-21 21:57:57,296 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.272[s] Speed: 58.9[samples/s]
2022-04-21 21:58:36,957 reid_baseline.train INFO: normal accuracy 0.7256138769993242 2.20666766166687 
2022-04-21 21:59:06,948 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 21:59:06,948 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 220.7%
2022-04-21 21:59:34,510 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.344, Acc: 0.805, Base Lr: 4.83e-03
2022-04-21 22:00:01,753 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.359, Acc: 0.800, Base Lr: 4.83e-03
2022-04-21 22:00:19,895 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-21 22:01:04,362 reid_baseline.train INFO: normal accuracy 0.7384546068934444 1.9951939582824707 
2022-04-21 22:01:34,332 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 22:01:34,332 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 199.5%
2022-04-21 22:02:01,112 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.298, Acc: 0.824, Base Lr: 5.62e-03
2022-04-21 22:02:26,892 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.251, Acc: 0.837, Base Lr: 5.62e-03
2022-04-21 22:02:44,654 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.258[s] Speed: 62.1[samples/s]
2022-04-21 22:03:29,207 reid_baseline.train INFO: normal accuracy 0.7558008560486597 1.8880232572555542 
2022-04-21 22:03:59,204 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 22:03:59,204 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 188.8%
2022-04-21 22:04:27,661 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.178, Acc: 0.861, Base Lr: 6.42e-03
2022-04-21 22:04:53,996 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.190, Acc: 0.855, Base Lr: 6.42e-03
2022-04-21 22:05:11,951 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.266[s] Speed: 60.0[samples/s]
2022-04-21 22:05:50,777 reid_baseline.train INFO: normal accuracy 0.7600810993466998 1.821487545967102 
2022-04-21 22:06:20,784 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 22:06:20,784 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 182.1%
2022-04-21 22:06:47,492 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.128, Acc: 0.872, Base Lr: 7.21e-03
2022-04-21 22:07:15,597 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.110, Acc: 0.879, Base Lr: 7.21e-03
2022-04-21 22:07:34,182 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.269[s] Speed: 59.5[samples/s]
2022-04-21 22:08:18,351 reid_baseline.train INFO: normal accuracy 0.7627844109033566 1.7488157749176025 
2022-04-21 22:08:48,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 22:08:48,322 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 174.9%
2022-04-21 22:09:16,350 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.056, Acc: 0.895, Base Lr: 4.01e-03
2022-04-21 22:09:43,573 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.045, Acc: 0.905, Base Lr: 4.01e-03
2022-04-21 22:10:05,260 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.282[s] Speed: 56.8[samples/s]
2022-04-21 22:11:13,834 reid_baseline.train INFO: normal accuracy 0.765938274386123 1.7927640676498413 
2022-04-21 22:11:13,837 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 22:11:13,837 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 179.3%
2022-04-21 22:11:40,787 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.997, Acc: 0.915, Base Lr: 3.38e-03
2022-04-21 22:12:06,737 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.010, Acc: 0.913, Base Lr: 3.38e-03
2022-04-21 22:12:25,786 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.264[s] Speed: 60.7[samples/s]
2022-04-21 22:13:02,449 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.699938178062439 
2022-04-21 22:13:32,423 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 22:13:32,424 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.0%
2022-04-21 22:14:01,576 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.032, Acc: 0.900, Base Lr: 2.77e-03
2022-04-21 22:14:26,026 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.000, Acc: 0.912, Base Lr: 2.77e-03
2022-04-21 22:14:43,717 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.261[s] Speed: 61.3[samples/s]
2022-04-21 22:15:23,376 reid_baseline.train INFO: normal accuracy 0.7693174138319442 1.682700514793396 
2022-04-21 22:15:53,360 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 22:15:53,361 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 168.3%
2022-04-21 22:16:22,510 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.994, Acc: 0.914, Base Lr: 2.20e-03
2022-04-21 22:16:48,746 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.988, Acc: 0.921, Base Lr: 2.20e-03
2022-04-21 22:17:08,826 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.276[s] Speed: 57.9[samples/s]
2022-04-21 22:17:53,445 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.7568038702011108 
2022-04-21 22:17:53,447 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 22:17:53,448 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 175.7%
2022-04-21 22:18:22,312 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.986, Acc: 0.913, Base Lr: 1.66e-03
2022-04-21 22:18:49,225 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.982, Acc: 0.924, Base Lr: 1.66e-03
2022-04-21 22:19:10,759 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.283[s] Speed: 56.5[samples/s]
2022-04-21 22:19:53,513 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7242532968521118 
2022-04-21 22:19:53,513 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 22:19:53,513 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.4%
2022-04-21 22:20:23,855 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.946, Acc: 0.933, Base Lr: 1.19e-03
2022-04-21 22:20:49,954 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.945, Acc: 0.928, Base Lr: 1.19e-03
2022-04-21 22:21:10,705 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.282[s] Speed: 56.7[samples/s]
2022-04-21 22:21:56,948 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7534772157669067 
2022-04-21 22:21:56,948 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 22:21:56,948 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 175.3%
2022-04-21 22:22:29,062 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.983, Acc: 0.932, Base Lr: 7.78e-04
2022-04-21 22:23:03,637 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.969, Acc: 0.929, Base Lr: 7.78e-04
2022-04-21 22:23:23,092 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.316[s] Speed: 50.7[samples/s]
2022-04-21 22:23:58,990 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7085566520690918 
2022-04-21 22:23:58,991 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 22:23:58,991 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.9%
2022-04-21 22:24:30,430 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.946, Acc: 0.921, Base Lr: 4.51e-04
2022-04-21 22:24:58,530 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.947, Acc: 0.923, Base Lr: 4.51e-04
2022-04-21 22:25:20,956 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-21 22:26:05,105 reid_baseline.train INFO: normal accuracy 0.7776526244649696 1.73110830783844 
2022-04-21 22:26:05,105 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 22:26:05,106 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 173.1%
2022-04-21 22:26:32,041 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.919, Acc: 0.936, Base Lr: 2.11e-04
2022-04-21 22:26:55,388 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.923, Acc: 0.934, Base Lr: 2.11e-04
2022-04-21 22:27:15,731 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.259[s] Speed: 61.9[samples/s]
2022-04-21 22:28:01,281 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.7139954566955566 
2022-04-21 22:28:01,282 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 22:28:01,282 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 171.4%
2022-04-21 22:28:31,796 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.921, Acc: 0.934, Base Lr: 6.51e-05
2022-04-21 22:29:01,562 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.938, Acc: 0.927, Base Lr: 6.51e-05
2022-04-21 22:29:19,931 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-21 22:30:04,955 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.6845824718475342 
2022-04-21 22:30:04,956 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 22:30:04,956 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.5%
2022-04-21 22:30:36,404 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.936, Acc: 0.939, Base Lr: 1.60e-05
2022-04-21 22:31:05,954 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.938, Acc: 0.936, Base Lr: 1.60e-05
2022-04-21 22:31:28,949 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-21 22:32:46,066 reid_baseline.train INFO: normal accuracy 0.7767515206127507 1.6512939929962158 
2022-04-21 22:33:16,039 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 22:33:16,039 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-21 22:34:29,001 reid_baseline.train INFO: normal accuracy 0.7767515206127507 1.6512939929962158 
2022-04-21 22:34:29,002 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 22:34:29,002 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-21 22:35:11,770 reid_baseline.train INFO: normal accuracy 0.7767515206127507 1.6512939929962158 
2022-04-21 22:35:11,770 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 22:35:11,770 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-21 22:35:56,522 reid_baseline.train INFO: normal accuracy 0.9601374570446736 0.7764069437980652 
2022-04-21 22:35:56,522 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 22:35:56,522 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-21 22:36:01,678 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3
2022-04-21 22:36:01,678 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-21 22:36:01,678 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 22:36:01,679 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 22:36:01,679 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 22:36:10,241 reid_baseline.train INFO: start training
2022-04-21 22:36:47,895 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.022, Acc: 0.280, Base Lr: 8.72e-04
2022-04-21 22:37:17,984 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.956, Acc: 0.376, Base Lr: 8.72e-04
2022-04-21 22:37:35,126 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-21 22:39:32,365 reid_baseline.train INFO: normal accuracy 0.5685104429653431 4.165801525115967 
2022-04-21 22:40:02,254 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 22:40:02,255 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 416.6%
2022-04-21 22:40:31,935 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.556, Acc: 0.551, Base Lr: 1.66e-03
2022-04-21 22:40:56,371 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.380, Acc: 0.555, Base Lr: 1.66e-03
2022-04-21 22:41:17,852 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.277[s] Speed: 57.8[samples/s]
2022-04-21 22:43:17,418 reid_baseline.train INFO: normal accuracy 0.602708285517558 3.995256185531616 
2022-04-21 22:43:47,374 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 22:43:47,374 reid_baseline.train INFO: Accuracy: 60.3% Mean Entropy: 399.5%
2022-04-21 22:44:17,320 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.598, Acc: 0.602, Base Lr: 2.46e-03
2022-04-21 22:44:46,884 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.451, Acc: 0.610, Base Lr: 2.46e-03
2022-04-21 22:45:06,451 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-21 22:47:01,468 reid_baseline.train INFO: normal accuracy 0.6752352536148726 3.301483631134033 
2022-04-21 22:47:31,417 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 22:47:31,417 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 330.1%
2022-04-21 22:48:02,667 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.877, Acc: 0.684, Base Lr: 3.25e-03
2022-04-21 22:48:31,269 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.795, Acc: 0.710, Base Lr: 3.25e-03
2022-04-21 22:48:50,990 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-21 22:50:45,749 reid_baseline.train INFO: normal accuracy 0.7339912784025706 2.587672472000122 
2022-04-21 22:51:15,701 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-21 22:51:15,702 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 258.8%
2022-04-21 22:51:43,476 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.536, Acc: 0.773, Base Lr: 4.04e-03
2022-04-21 22:52:08,596 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.508, Acc: 0.765, Base Lr: 4.04e-03
2022-04-21 22:52:27,801 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.264[s] Speed: 60.7[samples/s]
2022-04-21 22:54:22,493 reid_baseline.train INFO: normal accuracy 0.7594675235253615 2.2667129039764404 
2022-04-21 22:54:52,454 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-21 22:54:52,454 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 226.7%
2022-04-21 22:55:18,386 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.344, Acc: 0.805, Base Lr: 4.83e-03
2022-04-21 22:55:43,447 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.358, Acc: 0.800, Base Lr: 4.83e-03
2022-04-21 22:56:04,484 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.264[s] Speed: 60.7[samples/s]
2022-04-21 22:58:04,392 reid_baseline.train INFO: normal accuracy 0.7773697498278632 2.0558223724365234 
2022-04-21 22:58:34,351 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-21 22:58:34,351 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 205.6%
2022-04-21 22:59:02,789 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.298, Acc: 0.824, Base Lr: 5.62e-03
2022-04-21 22:59:29,554 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.251, Acc: 0.837, Base Lr: 5.62e-03
2022-04-21 22:59:48,046 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.270[s] Speed: 59.3[samples/s]
2022-04-21 23:01:32,205 reid_baseline.train INFO: normal accuracy 0.7778287812715171 1.948387622833252 
2022-04-21 23:02:02,161 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-21 23:02:02,161 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 194.8%
2022-04-21 23:02:30,548 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.178, Acc: 0.861, Base Lr: 6.42e-03
2022-04-21 23:02:54,765 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.190, Acc: 0.855, Base Lr: 6.42e-03
2022-04-21 23:03:12,650 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-21 23:04:57,493 reid_baseline.train INFO: normal accuracy 0.786779894422768 1.8342691659927368 
2022-04-21 23:05:27,449 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-21 23:05:27,449 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 183.4%
2022-04-21 23:05:55,266 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.128, Acc: 0.872, Base Lr: 7.21e-03
2022-04-21 23:06:19,508 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.110, Acc: 0.880, Base Lr: 7.21e-03
2022-04-21 23:06:40,561 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.268[s] Speed: 59.7[samples/s]
2022-04-21 23:08:31,124 reid_baseline.train INFO: normal accuracy 0.7844847372044985 1.7684508562088013 
2022-04-21 23:09:01,074 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-21 23:09:01,074 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 176.8%
2022-04-21 23:09:31,734 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.056, Acc: 0.894, Base Lr: 4.01e-03
2022-04-21 23:09:58,640 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.044, Acc: 0.904, Base Lr: 4.01e-03
2022-04-21 23:10:17,481 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-21 23:12:33,428 reid_baseline.train INFO: normal accuracy 0.790911177415653 1.7964905500411987 
2022-04-21 23:12:33,429 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-21 23:12:33,429 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 179.6%
2022-04-21 23:13:00,180 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.996, Acc: 0.915, Base Lr: 3.38e-03
2022-04-21 23:13:26,784 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.010, Acc: 0.914, Base Lr: 3.38e-03
2022-04-21 23:13:44,487 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.260[s] Speed: 61.5[samples/s]
2022-04-21 23:15:44,894 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.7146626710891724 
2022-04-21 23:16:14,864 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-21 23:16:14,865 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 171.5%
2022-04-21 23:16:44,704 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.032, Acc: 0.899, Base Lr: 2.77e-03
2022-04-21 23:17:14,326 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.000, Acc: 0.912, Base Lr: 2.77e-03
2022-04-21 23:17:33,467 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-21 23:19:23,326 reid_baseline.train INFO: normal accuracy 0.790681661693826 1.6966321468353271 
2022-04-21 23:19:53,280 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-21 23:19:53,281 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 169.7%
2022-04-21 23:20:23,048 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.994, Acc: 0.913, Base Lr: 2.20e-03
2022-04-21 23:20:51,573 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.988, Acc: 0.921, Base Lr: 2.20e-03
2022-04-21 23:21:09,353 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.279[s] Speed: 57.4[samples/s]
2022-04-21 23:23:04,702 reid_baseline.train INFO: normal accuracy 0.7961900390176727 1.7692525386810303 
2022-04-21 23:23:04,702 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-21 23:23:04,703 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 176.9%
2022-04-21 23:23:36,798 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.986, Acc: 0.914, Base Lr: 1.66e-03
2022-04-21 23:24:03,527 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.981, Acc: 0.925, Base Lr: 1.66e-03
2022-04-21 23:24:22,665 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-21 23:26:17,815 reid_baseline.train INFO: normal accuracy 0.7932063346339224 1.7312153577804565 
2022-04-21 23:26:17,817 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-21 23:26:17,817 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 173.1%
2022-04-21 23:26:53,444 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.946, Acc: 0.933, Base Lr: 1.19e-03
2022-04-21 23:27:21,150 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.945, Acc: 0.928, Base Lr: 1.19e-03
2022-04-21 23:27:39,861 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.300[s] Speed: 53.2[samples/s]
2022-04-21 23:29:37,303 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.7562636137008667 
2022-04-21 23:29:37,303 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-21 23:29:37,304 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 175.6%
2022-04-21 23:30:05,611 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.982, Acc: 0.932, Base Lr: 7.78e-04
2022-04-21 23:30:34,150 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.968, Acc: 0.929, Base Lr: 7.78e-04
2022-04-21 23:30:54,927 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.284[s] Speed: 56.4[samples/s]
2022-04-21 23:32:47,959 reid_baseline.train INFO: normal accuracy 0.7941243975212302 1.7180182933807373 
2022-04-21 23:32:47,960 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-21 23:32:47,960 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 171.8%
2022-04-21 23:33:20,850 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.945, Acc: 0.921, Base Lr: 4.51e-04
2022-04-21 23:33:46,533 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.947, Acc: 0.924, Base Lr: 4.51e-04
2022-04-21 23:34:03,904 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.278[s] Speed: 57.5[samples/s]
2022-04-21 23:36:02,470 reid_baseline.train INFO: normal accuracy 0.7941243975212302 1.740902066230774 
2022-04-21 23:36:02,470 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-21 23:36:02,471 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 174.1%
2022-04-21 23:36:31,342 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.918, Acc: 0.938, Base Lr: 2.11e-04
2022-04-21 23:36:58,540 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.923, Acc: 0.935, Base Lr: 2.11e-04
2022-04-21 23:37:18,344 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.278[s] Speed: 57.6[samples/s]
2022-04-21 23:39:16,315 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.7255477905273438 
2022-04-21 23:39:16,316 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-21 23:39:16,316 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 172.6%
2022-04-21 23:39:46,075 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.920, Acc: 0.934, Base Lr: 6.51e-05
2022-04-21 23:40:08,020 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.937, Acc: 0.926, Base Lr: 6.51e-05
2022-04-21 23:40:26,307 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-21 23:42:17,077 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.6983330249786377 
2022-04-21 23:42:17,077 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-21 23:42:17,078 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 169.8%
2022-04-21 23:42:48,491 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.935, Acc: 0.939, Base Lr: 1.60e-05
2022-04-21 23:43:16,711 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.938, Acc: 0.936, Base Lr: 1.60e-05
2022-04-21 23:43:34,614 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.284[s] Speed: 56.3[samples/s]
2022-04-21 23:45:52,597 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6611652374267578 
2022-04-21 23:46:22,550 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-21 23:46:22,551 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 166.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-21 23:48:49,383 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6611652374267578 
2022-04-21 23:48:49,385 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 23:48:49,385 reid_baseline.train INFO: Accuracy: 79.7%
2022-04-21 23:50:52,212 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6611652374267578 
2022-04-21 23:50:52,212 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 23:50:52,212 reid_baseline.train INFO: Shuffled Accuracy: 79.7%
2022-04-21 23:51:33,149 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.776353120803833 
2022-04-21 23:51:33,150 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-21 23:51:33,150 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-21 23:51:38,641 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4
2022-04-21 23:51:38,641 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-21 23:51:38,641 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-21 23:51:38,642 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-21 23:51:38,642 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-21 23:51:45,714 reid_baseline.train INFO: start training
2022-04-21 23:52:21,553 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.013, Acc: 0.280, Base Lr: 8.72e-04
2022-04-21 23:52:48,484 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.944, Acc: 0.376, Base Lr: 8.72e-04
2022-04-21 23:53:07,722 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-21 23:53:40,913 reid_baseline.train INFO: normal accuracy 0.5092707045735476 4.166680335998535 
2022-04-21 23:54:10,809 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-21 23:54:10,810 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-21 23:54:39,977 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.530, Acc: 0.551, Base Lr: 1.66e-03
2022-04-21 23:55:03,928 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.347, Acc: 0.555, Base Lr: 1.66e-03
2022-04-21 23:55:24,569 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.270[s] Speed: 59.2[samples/s]
2022-04-21 23:55:59,155 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.029122829437256 
2022-04-21 23:56:29,096 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-21 23:56:29,097 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-21 23:56:55,265 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.594, Acc: 0.602, Base Lr: 2.46e-03
2022-04-21 23:57:20,818 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.445, Acc: 0.610, Base Lr: 2.46e-03
2022-04-21 23:57:40,030 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.260[s] Speed: 61.6[samples/s]
2022-04-21 23:58:09,854 reid_baseline.train INFO: normal accuracy 0.6258755665430573 3.461327314376831 
2022-04-21 23:58:39,805 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-21 23:58:39,806 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 346.1%
2022-04-21 23:59:09,552 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.873, Acc: 0.683, Base Lr: 3.25e-03
2022-04-21 23:59:35,473 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.783, Acc: 0.709, Base Lr: 3.25e-03
2022-04-21 23:59:56,162 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.280[s] Speed: 57.2[samples/s]
2022-04-22 00:00:30,671 reid_baseline.train INFO: normal accuracy 0.6831479192418624 2.8138463497161865 
2022-04-22 00:01:00,631 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 00:01:00,632 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 281.4%
2022-04-22 00:01:26,472 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.534, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 00:01:52,352 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.501, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 00:02:11,173 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.258[s] Speed: 61.9[samples/s]
2022-04-22 00:02:44,402 reid_baseline.train INFO: normal accuracy 0.7066337041615163 2.5103909969329834 
2022-04-22 00:03:14,345 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 00:03:14,345 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 251.0%
2022-04-22 00:03:42,182 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.351, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 00:04:08,902 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.339, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 00:04:27,685 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.268[s] Speed: 59.7[samples/s]
2022-04-22 00:04:59,639 reid_baseline.train INFO: normal accuracy 0.722702925422332 2.284461498260498 
2022-04-22 00:05:29,589 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 00:05:29,590 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 228.4%
2022-04-22 00:05:54,899 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.250, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 00:06:20,293 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.221, Acc: 0.836, Base Lr: 5.62e-03
2022-04-22 00:06:38,836 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.254[s] Speed: 63.1[samples/s]
2022-04-22 00:07:11,644 reid_baseline.train INFO: normal accuracy 0.7317676143386898 2.1599631309509277 
2022-04-22 00:07:41,604 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 00:07:41,605 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 216.0%
2022-04-22 00:08:13,409 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.151, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 00:08:40,212 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.158, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 00:08:58,601 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.282[s] Speed: 56.7[samples/s]
2022-04-22 00:09:28,583 reid_baseline.train INFO: normal accuracy 0.7457766790276061 2.010615348815918 
2022-04-22 00:09:58,527 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 00:09:58,528 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 201.1%
2022-04-22 00:10:25,813 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.104, Acc: 0.871, Base Lr: 7.21e-03
2022-04-22 00:10:51,621 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.106, Acc: 0.878, Base Lr: 7.21e-03
2022-04-22 00:11:09,741 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.261[s] Speed: 61.3[samples/s]
2022-04-22 00:11:38,992 reid_baseline.train INFO: normal accuracy 0.7371240214256284 1.9467887878417969 
2022-04-22 00:12:08,943 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 00:12:08,943 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 194.7%
2022-04-22 00:12:33,325 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.029, Acc: 0.893, Base Lr: 4.01e-03
2022-04-22 00:12:59,532 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.012, Acc: 0.903, Base Lr: 4.01e-03
2022-04-22 00:13:15,738 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.245[s] Speed: 65.4[samples/s]
2022-04-22 00:14:16,370 reid_baseline.train INFO: normal accuracy 0.7408323032550473 1.946373701095581 
2022-04-22 00:14:46,315 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 00:14:46,315 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 194.6%
2022-04-22 00:15:14,131 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.977, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 00:15:38,755 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.985, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 00:15:57,453 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.261[s] Speed: 61.4[samples/s]
2022-04-22 00:16:27,248 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.8593029975891113 
2022-04-22 00:16:57,197 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 00:16:57,197 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 185.9%
2022-04-22 00:17:23,915 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.019, Acc: 0.898, Base Lr: 2.77e-03
2022-04-22 00:17:51,304 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.982, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 00:18:09,983 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.266[s] Speed: 60.1[samples/s]
2022-04-22 00:18:41,754 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.84052574634552 
2022-04-22 00:19:11,704 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 00:19:11,704 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 184.1%
2022-04-22 00:19:36,102 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.957, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 00:20:02,768 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.944, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 00:20:20,703 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.253[s] Speed: 63.3[samples/s]
2022-04-22 00:20:53,637 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.904333472251892 
2022-04-22 00:20:53,638 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 00:20:53,638 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 190.4%
2022-04-22 00:21:21,166 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.959, Acc: 0.912, Base Lr: 1.66e-03
2022-04-22 00:21:47,714 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.935, Acc: 0.923, Base Lr: 1.66e-03
2022-04-22 00:22:05,963 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.265[s] Speed: 60.4[samples/s]
2022-04-22 00:22:39,437 reid_baseline.train INFO: normal accuracy 0.7503090234857849 1.8689335584640503 
2022-04-22 00:22:39,438 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 00:22:39,438 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 186.9%
2022-04-22 00:23:08,255 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.914, Acc: 0.934, Base Lr: 1.19e-03
2022-04-22 00:23:35,533 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.927, Acc: 0.929, Base Lr: 1.19e-03
2022-04-22 00:23:53,270 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.270[s] Speed: 59.3[samples/s]
2022-04-22 00:24:29,486 reid_baseline.train INFO: normal accuracy 0.7511330861145447 1.8820083141326904 
2022-04-22 00:24:29,487 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 00:24:29,487 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 188.2%
2022-04-22 00:24:58,771 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.908, Acc: 0.933, Base Lr: 7.78e-04
2022-04-22 00:25:24,449 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.928, Acc: 0.930, Base Lr: 7.78e-04
2022-04-22 00:25:46,492 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.282[s] Speed: 56.7[samples/s]
2022-04-22 00:26:22,056 reid_baseline.train INFO: normal accuracy 0.7519571487433044 1.8509042263031006 
2022-04-22 00:26:22,057 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 00:26:22,057 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 185.1%
2022-04-22 00:26:52,781 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.915, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 00:27:19,814 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.920, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 00:27:42,677 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-22 00:28:14,915 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.8712307214736938 
2022-04-22 00:28:14,915 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 00:28:14,916 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 187.1%
2022-04-22 00:28:43,798 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.926, Acc: 0.938, Base Lr: 2.11e-04
2022-04-22 00:29:11,273 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.921, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 00:29:28,961 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-22 00:30:06,801 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.8457716703414917 
2022-04-22 00:30:06,802 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 00:30:06,802 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 184.6%
2022-04-22 00:30:36,366 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.913, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 00:31:01,642 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.930, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 00:31:19,693 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-22 00:31:57,153 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.8325140476226807 
2022-04-22 00:32:27,263 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 00:32:27,263 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.3%
2022-04-22 00:32:55,324 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.904, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 00:33:25,893 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.917, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 00:33:49,277 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 00:34:51,748 reid_baseline.train INFO: normal accuracy 0.7519571487433044 1.7943397760391235 
2022-04-22 00:35:21,701 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 00:35:21,702 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 179.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-22 00:36:20,712 reid_baseline.train INFO: normal accuracy 0.7519571487433044 1.7943397760391235 
2022-04-22 00:36:20,712 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 00:36:20,712 reid_baseline.train INFO: Accuracy: 75.2%
2022-04-22 00:36:49,038 reid_baseline.train INFO: normal accuracy 0.7519571487433044 1.7943397760391235 
2022-04-22 00:36:49,038 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 00:36:49,038 reid_baseline.train INFO: Shuffled Accuracy: 75.2%
2022-04-22 00:37:30,577 reid_baseline.train INFO: normal accuracy 0.9594501718213059 0.7760089039802551 
2022-04-22 00:37:30,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 00:37:30,578 reid_baseline.train INFO: Source Clean Accuracy: 95.9%
2022-04-22 00:37:35,899 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4
2022-04-22 00:37:35,899 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-22 00:37:35,899 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 00:37:35,900 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 00:37:35,900 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 00:37:44,181 reid_baseline.train INFO: start training
2022-04-22 00:38:17,142 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.013, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 00:38:44,298 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.944, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 00:39:02,099 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.282[s] Speed: 56.6[samples/s]
2022-04-22 00:39:41,924 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.16417932510376 
2022-04-22 00:40:11,805 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 00:40:11,805 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-22 00:40:42,650 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.530, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 00:41:07,764 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.347, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 00:41:28,927 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.282[s] Speed: 56.6[samples/s]
2022-04-22 00:42:14,449 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.968358278274536 
2022-04-22 00:42:44,398 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 00:42:44,398 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-22 00:43:11,669 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.594, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 00:43:39,148 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.445, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 00:44:01,041 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.280[s] Speed: 57.1[samples/s]
2022-04-22 00:44:41,531 reid_baseline.train INFO: normal accuracy 0.645415634151836 3.2464499473571777 
2022-04-22 00:45:11,487 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 00:45:11,487 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.6%
2022-04-22 00:45:36,805 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.873, Acc: 0.684, Base Lr: 3.25e-03
2022-04-22 00:46:03,329 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.783, Acc: 0.710, Base Lr: 3.25e-03
2022-04-22 00:46:24,293 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.267[s] Speed: 60.0[samples/s]
2022-04-22 00:47:08,713 reid_baseline.train INFO: normal accuracy 0.7087181797702186 2.5374059677124023 
2022-04-22 00:47:38,698 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 00:47:38,699 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 253.7%
2022-04-22 00:48:06,803 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.534, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 00:48:31,551 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.501, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 00:48:47,794 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.253[s] Speed: 63.2[samples/s]
2022-04-22 00:49:26,226 reid_baseline.train INFO: normal accuracy 0.7253886010362695 2.20684814453125 
2022-04-22 00:49:56,168 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 00:49:56,169 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 220.7%
2022-04-22 00:50:23,953 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.351, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 00:50:49,804 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.339, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 00:51:07,035 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.260[s] Speed: 61.6[samples/s]
2022-04-22 00:51:53,146 reid_baseline.train INFO: normal accuracy 0.738004054967335 1.995147466659546 
2022-04-22 00:52:23,140 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 00:52:23,140 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 199.5%
2022-04-22 00:52:49,229 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.250, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 00:53:13,478 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.222, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 00:53:32,062 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.252[s] Speed: 63.4[samples/s]
2022-04-22 00:54:14,310 reid_baseline.train INFO: normal accuracy 0.7560261320117143 1.8879212141036987 
2022-04-22 00:54:44,266 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 00:54:44,267 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 188.8%
2022-04-22 00:55:09,482 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.152, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 00:55:34,350 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.158, Acc: 0.855, Base Lr: 6.42e-03
2022-04-22 00:55:50,870 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.243[s] Speed: 65.7[samples/s]
2022-04-22 00:56:31,106 reid_baseline.train INFO: normal accuracy 0.7603063753097544 1.8211045265197754 
2022-04-22 00:57:01,054 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 00:57:01,055 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 182.1%
2022-04-22 00:57:30,222 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.105, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 00:58:04,626 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.106, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 00:58:23,857 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-22 00:59:05,916 reid_baseline.train INFO: normal accuracy 0.7618833070511376 1.748801827430725 
2022-04-22 00:59:35,919 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 00:59:35,919 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 174.9%
2022-04-22 01:00:02,629 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.029, Acc: 0.895, Base Lr: 4.01e-03
2022-04-22 01:00:30,107 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.012, Acc: 0.905, Base Lr: 4.01e-03
2022-04-22 01:00:49,338 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.269[s] Speed: 59.5[samples/s]
2022-04-22 01:01:57,044 reid_baseline.train INFO: normal accuracy 0.7661635503491777 1.7927981615066528 
2022-04-22 01:01:57,045 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 01:01:57,046 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 179.3%
2022-04-22 01:02:23,925 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.978, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 01:02:48,477 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.985, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 01:03:07,428 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.258[s] Speed: 62.1[samples/s]
2022-04-22 01:03:49,751 reid_baseline.train INFO: normal accuracy 0.7684163099797252 1.6992284059524536 
2022-04-22 01:04:19,703 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 01:04:19,703 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 169.9%
2022-04-22 01:04:48,376 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.018, Acc: 0.900, Base Lr: 2.77e-03
2022-04-22 01:05:15,634 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.982, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 01:05:35,121 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.276[s] Speed: 57.9[samples/s]
2022-04-22 01:06:15,449 reid_baseline.train INFO: normal accuracy 0.7697679657580536 1.6832271814346313 
2022-04-22 01:06:45,399 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 01:06:45,400 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.3%
2022-04-22 01:07:14,643 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.957, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 01:07:41,152 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.944, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 01:08:00,649 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.276[s] Speed: 58.0[samples/s]
2022-04-22 01:08:45,744 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7568403482437134 
2022-04-22 01:08:45,745 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 01:08:45,745 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 175.7%
2022-04-22 01:09:11,517 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.959, Acc: 0.913, Base Lr: 1.66e-03
2022-04-22 01:09:35,895 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.934, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 01:09:54,609 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.252[s] Speed: 63.4[samples/s]
2022-04-22 01:10:34,587 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7237722873687744 
2022-04-22 01:10:34,587 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 01:10:34,588 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.4%
2022-04-22 01:11:03,682 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.914, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 01:11:28,814 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.926, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 01:11:46,846 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.265[s] Speed: 60.5[samples/s]
2022-04-22 01:12:34,158 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.753278374671936 
2022-04-22 01:12:34,159 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 01:12:34,159 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 175.3%
2022-04-22 01:13:04,073 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.908, Acc: 0.933, Base Lr: 7.78e-04
2022-04-22 01:13:31,496 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.928, Acc: 0.930, Base Lr: 7.78e-04
2022-04-22 01:13:50,702 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.280[s] Speed: 57.1[samples/s]
2022-04-22 01:14:31,400 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.7084336280822754 
2022-04-22 01:14:31,401 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 01:14:31,401 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 170.8%
2022-04-22 01:15:01,720 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.914, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 01:15:29,446 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.919, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 01:15:50,317 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-22 01:16:35,135 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.7309412956237793 
2022-04-22 01:16:35,136 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 01:16:35,136 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 173.1%
2022-04-22 01:17:04,652 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.925, Acc: 0.936, Base Lr: 2.11e-04
2022-04-22 01:17:30,432 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.920, Acc: 0.934, Base Lr: 2.11e-04
2022-04-22 01:17:51,256 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.279[s] Speed: 57.4[samples/s]
2022-04-22 01:18:40,870 reid_baseline.train INFO: normal accuracy 0.7758504167605317 1.713777780532837 
2022-04-22 01:18:40,871 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 01:18:40,871 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 171.4%
2022-04-22 01:19:11,831 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.913, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 01:19:40,122 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.929, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 01:19:58,956 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.286[s] Speed: 55.9[samples/s]
2022-04-22 01:20:48,895 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.6845139265060425 
2022-04-22 01:20:48,896 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 01:20:48,896 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.5%
2022-04-22 01:21:20,414 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.903, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 01:21:48,333 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.916, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 01:22:08,075 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 01:23:22,385 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6512291431427002 
2022-04-22 01:23:52,325 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 01:23:52,326 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-22 01:25:04,674 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6512291431427002 
2022-04-22 01:25:04,674 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 01:25:04,674 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-22 01:25:42,037 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6512291431427002 
2022-04-22 01:25:42,037 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 01:25:42,037 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-22 01:26:19,914 reid_baseline.train INFO: normal accuracy 0.9601374570446736 0.7762886881828308 
2022-04-22 01:26:19,914 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 01:26:19,914 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 01:26:24,886 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4
2022-04-22 01:26:24,886 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-22 01:26:24,886 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 01:26:24,886 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 01:26:24,887 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 01:26:31,800 reid_baseline.train INFO: start training
2022-04-22 01:27:05,164 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.013, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 01:27:32,874 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.944, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 01:27:53,639 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-22 01:29:51,598 reid_baseline.train INFO: normal accuracy 0.5685104429653431 4.165801525115967 
2022-04-22 01:30:22,075 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 01:30:22,076 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 416.6%
2022-04-22 01:30:48,500 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.530, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 01:31:13,803 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.347, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 01:31:33,763 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.263[s] Speed: 60.9[samples/s]
2022-04-22 01:33:25,761 reid_baseline.train INFO: normal accuracy 0.602708285517558 3.9952549934387207 
2022-04-22 01:33:55,703 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 01:33:55,703 reid_baseline.train INFO: Accuracy: 60.3% Mean Entropy: 399.5%
2022-04-22 01:34:25,416 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.594, Acc: 0.602, Base Lr: 2.46e-03
2022-04-22 01:34:56,690 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.445, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 01:35:19,385 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-22 01:37:13,928 reid_baseline.train INFO: normal accuracy 0.6750057378930456 3.3015100955963135 
2022-04-22 01:37:43,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 01:37:43,899 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 330.2%
2022-04-22 01:38:12,923 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.873, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 01:38:41,268 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.783, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 01:39:01,758 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.285[s] Speed: 56.2[samples/s]
2022-04-22 01:40:55,581 reid_baseline.train INFO: normal accuracy 0.7342207941243976 2.587698221206665 
2022-04-22 01:41:25,551 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 01:41:25,551 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 258.8%
2022-04-22 01:41:51,595 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.534, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 01:42:19,736 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.501, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 01:42:39,976 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.273[s] Speed: 58.7[samples/s]
2022-04-22 01:44:34,983 reid_baseline.train INFO: normal accuracy 0.7594675235253615 2.2668545246124268 
2022-04-22 01:45:04,925 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 01:45:04,925 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 226.7%
2022-04-22 01:45:35,804 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.351, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 01:46:02,313 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.339, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 01:46:19,092 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.272[s] Speed: 58.9[samples/s]
2022-04-22 01:48:15,603 reid_baseline.train INFO: normal accuracy 0.7773697498278632 2.0550405979156494 
2022-04-22 01:48:45,543 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 01:48:45,543 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 205.5%
2022-04-22 01:49:13,065 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.251, Acc: 0.823, Base Lr: 5.62e-03
2022-04-22 01:49:39,165 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.222, Acc: 0.836, Base Lr: 5.62e-03
2022-04-22 01:49:58,008 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-22 01:51:51,435 reid_baseline.train INFO: normal accuracy 0.7778287812715171 1.9474363327026367 
2022-04-22 01:52:21,390 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 01:52:21,391 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 194.7%
2022-04-22 01:52:51,261 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.151, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 01:53:16,436 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.158, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 01:53:35,135 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.270[s] Speed: 59.3[samples/s]
2022-04-22 01:55:25,546 reid_baseline.train INFO: normal accuracy 0.7858618315354602 1.8348958492279053 
2022-04-22 01:55:55,502 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 01:55:55,503 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 183.5%
2022-04-22 01:56:31,055 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.105, Acc: 0.873, Base Lr: 7.21e-03
2022-04-22 01:56:58,043 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.107, Acc: 0.880, Base Lr: 7.21e-03
2022-04-22 01:57:18,711 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.305[s] Speed: 52.5[samples/s]
2022-04-22 01:59:10,850 reid_baseline.train INFO: normal accuracy 0.7840257057608446 1.7694523334503174 
2022-04-22 01:59:40,854 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 01:59:40,855 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 176.9%
2022-04-22 02:00:08,502 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.030, Acc: 0.895, Base Lr: 4.01e-03
2022-04-22 02:00:33,545 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.013, Acc: 0.905, Base Lr: 4.01e-03
2022-04-22 02:00:49,807 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.252[s] Speed: 63.4[samples/s]
2022-04-22 02:03:06,954 reid_baseline.train INFO: normal accuracy 0.7902226302501721 1.7963060140609741 
2022-04-22 02:03:06,955 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 02:03:06,956 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 179.6%
2022-04-22 02:03:34,137 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.979, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 02:03:58,112 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.986, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 02:04:16,941 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-22 02:06:12,268 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.7154192924499512 
2022-04-22 02:06:42,245 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 02:06:42,245 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 171.5%
2022-04-22 02:07:09,693 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.020, Acc: 0.898, Base Lr: 2.77e-03
2022-04-22 02:07:35,530 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.983, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 02:07:56,041 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.270[s] Speed: 59.3[samples/s]
2022-04-22 02:09:53,293 reid_baseline.train INFO: normal accuracy 0.790911177415653 1.6964689493179321 
2022-04-22 02:10:23,237 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 02:10:23,237 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 169.6%
2022-04-22 02:10:52,618 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.958, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 02:11:17,421 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.945, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 02:11:35,312 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.264[s] Speed: 60.6[samples/s]
2022-04-22 02:13:20,427 reid_baseline.train INFO: normal accuracy 0.7959605232958458 1.7708213329315186 
2022-04-22 02:13:20,430 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 02:13:20,430 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 177.1%
2022-04-22 02:13:49,334 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.960, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 02:14:15,248 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.935, Acc: 0.923, Base Lr: 1.66e-03
2022-04-22 02:14:34,524 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-22 02:16:32,977 reid_baseline.train INFO: normal accuracy 0.7927473031902685 1.7317320108413696 
2022-04-22 02:16:32,978 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 02:16:32,978 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 173.2%
2022-04-22 02:17:07,886 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.915, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 02:17:37,173 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.927, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 02:17:56,486 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-22 02:19:47,965 reid_baseline.train INFO: normal accuracy 0.7920587560247877 1.7557134628295898 
2022-04-22 02:19:47,966 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 02:19:47,966 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 175.6%
2022-04-22 02:20:16,487 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.908, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 02:20:42,998 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.929, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 02:21:01,110 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.268[s] Speed: 59.7[samples/s]
2022-04-22 02:22:41,802 reid_baseline.train INFO: normal accuracy 0.7938948817994033 1.7178953886032104 
2022-04-22 02:22:41,804 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 02:22:41,804 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 171.8%
2022-04-22 02:23:10,963 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.914, Acc: 0.923, Base Lr: 4.51e-04
2022-04-22 02:23:42,278 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.919, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 02:24:03,191 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-22 02:25:58,722 reid_baseline.train INFO: normal accuracy 0.795042460408538 1.7411653995513916 
2022-04-22 02:25:58,722 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 02:25:58,722 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 174.1%
2022-04-22 02:26:25,382 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.926, Acc: 0.938, Base Lr: 2.11e-04
2022-04-22 02:26:51,049 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.921, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 02:27:08,649 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-22 02:29:10,366 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.725448727607727 
2022-04-22 02:29:10,367 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 02:29:10,367 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 172.5%
2022-04-22 02:29:49,750 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.913, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 02:30:19,120 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.930, Acc: 0.926, Base Lr: 6.51e-05
2022-04-22 02:30:37,979 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-22 02:32:25,691 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.697803258895874 
2022-04-22 02:32:25,692 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 02:32:25,692 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 169.8%
2022-04-22 02:32:59,285 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.904, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 02:33:26,456 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.917, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 02:33:46,642 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 02:36:13,915 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6609742641448975 
2022-04-22 02:36:43,870 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 02:36:43,870 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 166.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-22 02:39:07,039 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6609742641448975 
2022-04-22 02:39:07,040 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 02:39:07,040 reid_baseline.train INFO: Accuracy: 79.7%
2022-04-22 02:40:59,637 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6609742641448975 
2022-04-22 02:40:59,637 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 02:40:59,637 reid_baseline.train INFO: Shuffled Accuracy: 79.7%
2022-04-22 02:41:49,027 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7767283320426941 
2022-04-22 02:41:49,028 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 02:41:49,028 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 02:41:55,014 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5
2022-04-22 02:41:55,015 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-22 02:41:55,015 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 02:41:55,015 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 02:41:55,016 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 02:42:04,150 reid_baseline.train INFO: start training
2022-04-22 02:42:40,732 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.128, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 02:43:09,928 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.059, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 02:43:29,530 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.7[samples/s]
2022-04-22 02:44:01,027 reid_baseline.train INFO: normal accuracy 0.5092707045735476 4.166680335998535 
2022-04-22 02:44:30,907 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 02:44:30,908 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-22 02:44:59,244 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.652, Acc: 0.550, Base Lr: 1.66e-03
2022-04-22 02:45:27,127 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.468, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 02:45:46,183 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.276[s] Speed: 58.0[samples/s]
2022-04-22 02:46:20,767 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.029117107391357 
2022-04-22 02:46:50,728 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 02:46:50,729 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-22 02:47:16,628 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.718, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 02:47:43,403 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.565, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 02:48:01,711 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.260[s] Speed: 61.5[samples/s]
2022-04-22 02:48:33,947 reid_baseline.train INFO: normal accuracy 0.6254635352286774 3.461337089538574 
2022-04-22 02:49:03,898 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 02:49:03,898 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 346.1%
2022-04-22 02:49:33,803 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.008, Acc: 0.684, Base Lr: 3.25e-03
2022-04-22 02:49:59,105 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.908, Acc: 0.710, Base Lr: 3.25e-03
2022-04-22 02:50:16,097 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.264[s] Speed: 60.6[samples/s]
2022-04-22 02:50:49,855 reid_baseline.train INFO: normal accuracy 0.6839719818706221 2.813880443572998 
2022-04-22 02:51:19,814 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 02:51:19,814 reid_baseline.train INFO: Accuracy: 68.4% Mean Entropy: 281.4%
2022-04-22 02:51:48,187 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.677, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 02:52:13,446 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.648, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 02:52:34,275 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.272[s] Speed: 58.8[samples/s]
2022-04-22 02:53:01,932 reid_baseline.train INFO: normal accuracy 0.7066337041615163 2.5106256008148193 
2022-04-22 02:53:31,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 02:53:31,905 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 251.1%
2022-04-22 02:53:59,156 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.460, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 02:54:25,129 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.456, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 02:54:45,669 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.270[s] Speed: 59.2[samples/s]
2022-04-22 02:55:17,316 reid_baseline.train INFO: normal accuracy 0.7222908941079522 2.2835183143615723 
2022-04-22 02:55:47,278 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 02:55:47,279 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 228.4%
2022-04-22 02:56:15,440 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.375, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 02:56:41,801 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.351, Acc: 0.836, Base Lr: 5.62e-03
2022-04-22 02:56:59,655 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.265[s] Speed: 60.4[samples/s]
2022-04-22 02:57:33,359 reid_baseline.train INFO: normal accuracy 0.7313555830243098 2.1586194038391113 
2022-04-22 02:58:03,314 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 02:58:03,315 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 215.9%
2022-04-22 02:58:28,853 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.268, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 02:58:54,933 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.262, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 02:59:15,015 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.263[s] Speed: 60.9[samples/s]
2022-04-22 02:59:49,284 reid_baseline.train INFO: normal accuracy 0.7453646477132262 2.0120670795440674 
2022-04-22 03:00:19,219 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 03:00:19,219 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 201.2%
2022-04-22 03:00:47,587 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.256, Acc: 0.873, Base Lr: 7.21e-03
2022-04-22 03:01:10,686 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.228, Acc: 0.880, Base Lr: 7.21e-03
2022-04-22 03:01:31,217 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.263[s] Speed: 60.7[samples/s]
2022-04-22 03:02:10,523 reid_baseline.train INFO: normal accuracy 0.7350638648537289 1.9471722841262817 
2022-04-22 03:02:40,512 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 03:02:40,513 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 194.7%
2022-04-22 03:03:08,229 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.178, Acc: 0.895, Base Lr: 4.01e-03
2022-04-22 03:03:32,682 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.156, Acc: 0.904, Base Lr: 4.01e-03
2022-04-22 03:03:48,602 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.249[s] Speed: 64.2[samples/s]
2022-04-22 03:04:46,851 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.9438233375549316 
2022-04-22 03:05:16,794 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 03:05:16,795 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 194.4%
2022-04-22 03:05:45,363 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.144, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 03:06:10,537 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.138, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 03:06:27,564 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.259[s] Speed: 61.7[samples/s]
2022-04-22 03:06:57,874 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.8587498664855957 
2022-04-22 03:07:27,825 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 03:07:27,825 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 185.9%
2022-04-22 03:07:55,856 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.139, Acc: 0.898, Base Lr: 2.77e-03
2022-04-22 03:08:20,561 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.124, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 03:08:40,572 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.266[s] Speed: 60.1[samples/s]
2022-04-22 03:09:13,062 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.8398922681808472 
2022-04-22 03:09:43,012 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 03:09:43,012 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 184.0%
2022-04-22 03:10:10,826 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.098, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 03:10:36,262 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.079, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 03:10:53,767 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.259[s] Speed: 61.7[samples/s]
2022-04-22 03:11:33,300 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.9035993814468384 
2022-04-22 03:11:33,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 03:11:33,301 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 190.4%
2022-04-22 03:12:06,181 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.089, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 03:12:33,341 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.081, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 03:12:50,414 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.282[s] Speed: 56.6[samples/s]
2022-04-22 03:13:20,998 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.8681294918060303 
2022-04-22 03:13:20,999 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 03:13:20,999 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 186.8%
2022-04-22 03:13:49,065 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.063, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 03:14:14,375 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.080, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 03:14:31,399 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-22 03:15:05,701 reid_baseline.train INFO: normal accuracy 0.7515451174289246 1.8820101022720337 
2022-04-22 03:15:05,703 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 03:15:05,703 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 188.2%
2022-04-22 03:15:33,535 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.063, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 03:16:00,929 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.069, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 03:16:20,600 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.274[s] Speed: 58.3[samples/s]
2022-04-22 03:16:51,486 reid_baseline.train INFO: normal accuracy 0.7507210548001648 1.850702166557312 
2022-04-22 03:16:51,487 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 03:16:51,487 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 185.1%
2022-04-22 03:17:23,953 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.062, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 03:17:51,400 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.054, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 03:18:13,003 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 03:18:44,806 reid_baseline.train INFO: normal accuracy 0.7503090234857849 1.8703362941741943 
2022-04-22 03:18:44,807 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 03:18:44,807 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 187.0%
2022-04-22 03:19:13,490 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.043, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 03:19:39,044 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.046, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 03:19:59,197 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.272[s] Speed: 58.7[samples/s]
2022-04-22 03:20:32,731 reid_baseline.train INFO: normal accuracy 0.7478368355995055 1.8454021215438843 
2022-04-22 03:20:32,732 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 03:20:32,732 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 184.5%
2022-04-22 03:21:02,742 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.075, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 03:21:27,113 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.067, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 03:21:45,919 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.268[s] Speed: 59.7[samples/s]
2022-04-22 03:22:23,909 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.8320746421813965 
2022-04-22 03:22:53,871 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 03:22:53,871 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.2%
2022-04-22 03:23:21,324 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.035, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 03:23:45,592 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.054, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 03:24:04,004 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.257[s] Speed: 62.4[samples/s]
2022-04-22 03:25:04,529 reid_baseline.train INFO: normal accuracy 0.7527812113720643 1.794458270072937 
2022-04-22 03:25:34,472 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 03:25:34,472 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 179.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-22 03:26:37,218 reid_baseline.train INFO: normal accuracy 0.7527812113720643 1.794458270072937 
2022-04-22 03:26:37,218 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 03:26:37,219 reid_baseline.train INFO: Accuracy: 75.3%
2022-04-22 03:27:11,500 reid_baseline.train INFO: normal accuracy 0.7527812113720643 1.794458270072937 
2022-04-22 03:27:11,501 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 03:27:11,501 reid_baseline.train INFO: Shuffled Accuracy: 75.3%
2022-04-22 03:27:55,644 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7766504287719727 
2022-04-22 03:27:55,645 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 03:27:55,645 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 03:28:01,218 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5
2022-04-22 03:28:01,218 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-22 03:28:01,219 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 03:28:01,219 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 03:28:01,219 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 03:28:08,636 reid_baseline.train INFO: start training
2022-04-22 03:28:41,817 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.128, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 03:29:10,110 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.059, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 03:29:26,543 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.283[s] Speed: 56.6[samples/s]
2022-04-22 03:30:12,542 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.164179801940918 
2022-04-22 03:30:42,426 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 03:30:42,427 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-22 03:31:11,576 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.652, Acc: 0.550, Base Lr: 1.66e-03
2022-04-22 03:31:40,323 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.468, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 03:32:01,552 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 03:32:42,134 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.968371629714966 
2022-04-22 03:33:12,121 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 03:33:12,122 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-22 03:33:36,125 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.718, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 03:34:02,213 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.565, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 03:34:22,300 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.257[s] Speed: 62.3[samples/s]
2022-04-22 03:35:00,502 reid_baseline.train INFO: normal accuracy 0.6451903581887812 3.246450424194336 
2022-04-22 03:35:30,460 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 03:35:30,460 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.6%
2022-04-22 03:35:58,789 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.008, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 03:36:25,861 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.908, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 03:36:44,315 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.270[s] Speed: 59.3[samples/s]
2022-04-22 03:37:23,900 reid_baseline.train INFO: normal accuracy 0.7084929038071638 2.5375595092773438 
2022-04-22 03:37:53,847 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 03:37:53,847 reid_baseline.train INFO: Accuracy: 70.8% Mean Entropy: 253.8%
2022-04-22 03:38:19,592 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.677, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 03:38:45,774 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.648, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 03:39:03,433 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.255[s] Speed: 62.8[samples/s]
2022-04-22 03:39:40,758 reid_baseline.train INFO: normal accuracy 0.7256138769993242 2.206890344619751 
2022-04-22 03:40:10,722 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 03:40:10,723 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 220.7%
2022-04-22 03:40:34,759 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.460, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 03:40:57,164 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.456, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 03:41:14,329 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.233[s] Speed: 68.7[samples/s]
2022-04-22 03:41:58,087 reid_baseline.train INFO: normal accuracy 0.7386798828564992 1.9953105449676514 
2022-04-22 03:42:28,043 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 03:42:28,044 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 199.5%
2022-04-22 03:42:56,961 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.375, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 03:43:21,091 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.350, Acc: 0.836, Base Lr: 5.62e-03
2022-04-22 03:43:38,578 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.258[s] Speed: 61.9[samples/s]
2022-04-22 03:44:19,728 reid_baseline.train INFO: normal accuracy 0.7558008560486597 1.8881468772888184 
2022-04-22 03:44:49,681 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 03:44:49,682 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 188.8%
2022-04-22 03:45:17,085 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.268, Acc: 0.862, Base Lr: 6.42e-03
2022-04-22 03:45:40,153 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.262, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 03:45:59,863 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.257[s] Speed: 62.2[samples/s]
2022-04-22 03:46:39,815 reid_baseline.train INFO: normal accuracy 0.7596305474205902 1.8218437433242798 
2022-04-22 03:47:09,806 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 03:47:09,806 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 182.2%
2022-04-22 03:47:35,376 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.255, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 03:48:01,683 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.228, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 03:48:21,355 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.262[s] Speed: 61.1[samples/s]
2022-04-22 03:48:59,385 reid_baseline.train INFO: normal accuracy 0.7616580310880829 1.749617338180542 
2022-04-22 03:49:29,329 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 03:49:29,329 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 175.0%
2022-04-22 03:49:57,077 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.178, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 03:50:20,296 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.156, Acc: 0.904, Base Lr: 4.01e-03
2022-04-22 03:50:38,448 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.253[s] Speed: 63.2[samples/s]
2022-04-22 03:51:46,817 reid_baseline.train INFO: normal accuracy 0.7661635503491777 1.7925306558609009 
2022-04-22 03:51:46,819 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 03:51:46,820 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 179.3%
2022-04-22 03:52:14,990 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.144, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 03:52:39,679 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.138, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 03:52:56,177 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.254[s] Speed: 63.0[samples/s]
2022-04-22 03:53:31,539 reid_baseline.train INFO: normal accuracy 0.7686415859427799 1.7001254558563232 
2022-04-22 03:54:01,558 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 03:54:01,559 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.0%
2022-04-22 03:54:29,960 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.139, Acc: 0.900, Base Lr: 2.77e-03
2022-04-22 03:54:53,299 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.124, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 03:55:11,569 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.256[s] Speed: 62.4[samples/s]
2022-04-22 03:55:52,055 reid_baseline.train INFO: normal accuracy 0.7697679657580536 1.6852608919143677 
2022-04-22 03:56:22,029 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 03:56:22,030 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.5%
2022-04-22 03:56:57,116 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.098, Acc: 0.913, Base Lr: 2.20e-03
2022-04-22 03:57:21,864 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.079, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 03:57:39,423 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.283[s] Speed: 56.4[samples/s]
2022-04-22 03:58:19,165 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.756780743598938 
2022-04-22 03:58:19,166 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 03:58:19,166 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.7%
2022-04-22 03:58:45,864 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.089, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 03:59:08,316 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.081, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 03:59:28,377 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.253[s] Speed: 63.1[samples/s]
2022-04-22 04:00:09,288 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.724597692489624 
2022-04-22 04:00:09,291 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 04:00:09,291 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.5%
2022-04-22 04:00:36,424 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.063, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 04:01:00,147 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.080, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 04:01:18,872 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.255[s] Speed: 62.8[samples/s]
2022-04-22 04:02:01,567 reid_baseline.train INFO: normal accuracy 0.771119621536382 1.7541507482528687 
2022-04-22 04:02:01,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 04:02:01,568 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 175.4%
2022-04-22 04:02:28,133 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.063, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 04:02:53,333 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.069, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 04:03:09,436 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.249[s] Speed: 64.4[samples/s]
2022-04-22 04:03:49,404 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7089968919754028 
2022-04-22 04:03:49,405 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 04:03:49,405 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.9%
2022-04-22 04:04:16,290 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.063, Acc: 0.921, Base Lr: 4.51e-04
2022-04-22 04:04:38,670 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.055, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 04:04:57,013 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.247[s] Speed: 64.7[samples/s]
2022-04-22 04:05:34,131 reid_baseline.train INFO: normal accuracy 0.7767515206127507 1.7306853532791138 
2022-04-22 04:05:34,132 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 04:05:34,132 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 173.1%
2022-04-22 04:05:59,429 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.043, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 04:06:24,996 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.046, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 04:06:42,663 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.251[s] Speed: 63.7[samples/s]
2022-04-22 04:07:21,193 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.7135058641433716 
2022-04-22 04:07:21,193 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 04:07:21,194 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 171.4%
2022-04-22 04:07:50,277 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.075, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 04:08:18,589 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.067, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 04:08:38,593 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.283[s] Speed: 56.6[samples/s]
2022-04-22 04:09:19,087 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.684209942817688 
2022-04-22 04:09:49,060 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 04:09:49,061 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.4%
2022-04-22 04:10:17,238 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.036, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 04:10:44,064 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.054, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 04:11:00,842 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.263[s] Speed: 60.9[samples/s]
2022-04-22 04:12:08,097 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6511354446411133 
2022-04-22 04:12:38,066 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 04:12:38,067 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-22 04:13:46,842 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6511354446411133 
2022-04-22 04:13:46,843 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 04:13:46,843 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-22 04:14:25,910 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6511354446411133 
2022-04-22 04:14:25,910 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 04:14:25,910 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-22 04:15:03,752 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7764670848846436 
2022-04-22 04:15:03,753 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 04:15:03,753 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 04:15:09,803 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5
2022-04-22 04:15:09,803 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-22 04:15:09,803 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 04:15:09,804 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 04:15:09,804 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 04:15:19,252 reid_baseline.train INFO: start training
2022-04-22 04:15:53,120 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.128, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 04:16:23,181 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.059, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 04:16:44,428 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-22 04:18:48,484 reid_baseline.train INFO: normal accuracy 0.5685104429653431 4.165801525115967 
2022-04-22 04:19:18,393 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 04:19:18,393 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 416.6%
2022-04-22 04:19:51,221 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.652, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 04:20:22,965 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.468, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 04:20:45,818 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-22 04:22:17,143 reid_baseline.train INFO: normal accuracy 0.602478769795731 3.9952611923217773 
2022-04-22 04:22:47,117 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 04:22:47,118 reid_baseline.train INFO: Accuracy: 60.2% Mean Entropy: 399.5%
2022-04-22 04:23:14,167 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.718, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 04:23:38,782 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.565, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 04:23:58,401 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.261[s] Speed: 61.3[samples/s]
2022-04-22 04:25:41,298 reid_baseline.train INFO: normal accuracy 0.6752352536148726 3.3014631271362305 
2022-04-22 04:26:11,268 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 04:26:11,268 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 330.1%
2022-04-22 04:26:39,090 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.008, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 04:27:06,189 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.908, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 04:27:26,340 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.275[s] Speed: 58.2[samples/s]
2022-04-22 04:29:12,118 reid_baseline.train INFO: normal accuracy 0.7339912784025706 2.5876073837280273 
2022-04-22 04:29:42,092 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 04:29:42,092 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 258.8%
2022-04-22 04:30:12,854 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.677, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 04:30:39,041 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.648, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 04:30:56,175 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-22 04:32:48,356 reid_baseline.train INFO: normal accuracy 0.7592380078035346 2.2667953968048096 
2022-04-22 04:33:18,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 04:33:18,335 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 226.7%
2022-04-22 04:33:45,631 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.460, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 04:34:12,389 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.456, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 04:34:32,555 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.272[s] Speed: 58.9[samples/s]
2022-04-22 04:36:36,580 reid_baseline.train INFO: normal accuracy 0.7769107183842093 2.0552666187286377 
2022-04-22 04:37:06,574 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 04:37:06,575 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 205.5%
2022-04-22 04:37:33,308 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.375, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 04:37:59,757 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.350, Acc: 0.836, Base Lr: 5.62e-03
2022-04-22 04:38:19,471 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-22 04:40:07,969 reid_baseline.train INFO: normal accuracy 0.7778287812715171 1.9476605653762817 
2022-04-22 04:40:37,961 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 04:40:37,961 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 194.8%
2022-04-22 04:41:05,428 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.267, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 04:41:28,466 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.261, Acc: 0.855, Base Lr: 6.42e-03
2022-04-22 04:41:47,756 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.256[s] Speed: 62.6[samples/s]
2022-04-22 04:43:30,390 reid_baseline.train INFO: normal accuracy 0.7860913472572871 1.8345489501953125 
2022-04-22 04:44:00,353 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 04:44:00,354 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 183.5%
2022-04-22 04:44:27,313 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.255, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 04:44:51,258 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.228, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 04:45:10,454 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.257[s] Speed: 62.4[samples/s]
2022-04-22 04:46:58,886 reid_baseline.train INFO: normal accuracy 0.7844847372044985 1.7686362266540527 
2022-04-22 04:47:28,881 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 04:47:28,881 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 176.9%
2022-04-22 04:47:59,363 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.178, Acc: 0.895, Base Lr: 4.01e-03
2022-04-22 04:48:23,781 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.156, Acc: 0.905, Base Lr: 4.01e-03
2022-04-22 04:48:41,811 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-22 04:50:55,996 reid_baseline.train INFO: normal accuracy 0.790681661693826 1.7949438095092773 
2022-04-22 04:50:55,997 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 04:50:55,997 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 179.5%
2022-04-22 04:51:26,809 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.143, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 04:51:55,744 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.138, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 04:52:18,092 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-22 04:54:17,580 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.7155284881591797 
2022-04-22 04:54:47,572 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 04:54:47,573 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 171.6%
2022-04-22 04:55:17,033 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.138, Acc: 0.898, Base Lr: 2.77e-03
2022-04-22 04:55:41,178 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.123, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 04:55:59,998 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-22 04:57:46,105 reid_baseline.train INFO: normal accuracy 0.7902226302501721 1.697083830833435 
2022-04-22 04:58:16,117 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 04:58:16,117 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 169.7%
2022-04-22 04:58:42,436 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.098, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 04:59:09,894 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.079, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 04:59:27,608 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.262[s] Speed: 61.1[samples/s]
2022-04-22 05:01:18,637 reid_baseline.train INFO: normal accuracy 0.7961900390176727 1.7700966596603394 
2022-04-22 05:01:18,637 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 05:01:18,638 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 177.0%
2022-04-22 05:01:47,460 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.088, Acc: 0.913, Base Lr: 1.66e-03
2022-04-22 05:02:14,073 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.081, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 05:02:33,358 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.274[s] Speed: 58.5[samples/s]
2022-04-22 05:04:28,347 reid_baseline.train INFO: normal accuracy 0.7927473031902685 1.731042742729187 
2022-04-22 05:04:28,348 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 05:04:28,348 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 173.1%
2022-04-22 05:04:55,593 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.062, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 05:05:20,468 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.080, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 05:05:41,288 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-22 05:07:36,552 reid_baseline.train INFO: normal accuracy 0.7920587560247877 1.7559950351715088 
2022-04-22 05:07:36,552 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 05:07:36,553 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 175.6%
2022-04-22 05:08:05,144 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.063, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 05:08:29,873 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.069, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 05:08:47,754 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.261[s] Speed: 61.4[samples/s]
2022-04-22 05:10:37,126 reid_baseline.train INFO: normal accuracy 0.7936653660775763 1.7180345058441162 
2022-04-22 05:10:37,126 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 05:10:37,127 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 171.8%
2022-04-22 05:11:09,453 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.062, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 05:11:36,070 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.054, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 05:11:55,860 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-22 05:13:45,752 reid_baseline.train INFO: normal accuracy 0.7943539132430572 1.7410736083984375 
2022-04-22 05:13:45,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 05:13:45,753 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 174.1%
2022-04-22 05:14:11,176 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.042, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 05:14:33,865 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.045, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 05:14:49,429 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.233[s] Speed: 68.8[samples/s]
2022-04-22 05:16:39,716 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.725401759147644 
2022-04-22 05:16:39,717 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 05:16:39,717 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 172.5%
2022-04-22 05:17:12,335 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.075, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 05:17:40,446 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.067, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 05:17:58,811 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-22 05:19:38,458 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.6981340646743774 
2022-04-22 05:19:38,458 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 05:19:38,458 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 169.8%
2022-04-22 05:20:06,983 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.035, Acc: 0.940, Base Lr: 1.60e-05
2022-04-22 05:20:36,432 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.054, Acc: 0.937, Base Lr: 1.60e-05
2022-04-22 05:20:56,515 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-22 05:23:15,277 reid_baseline.train INFO: normal accuracy 0.7975671333486344 1.660927653312683 
2022-04-22 05:23:45,240 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 05:23:45,240 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 166.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-22 05:26:05,175 reid_baseline.train INFO: normal accuracy 0.7975671333486344 1.660927653312683 
2022-04-22 05:26:05,175 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 05:26:05,176 reid_baseline.train INFO: Accuracy: 79.8%
2022-04-22 05:27:59,347 reid_baseline.train INFO: normal accuracy 0.7975671333486344 1.660927653312683 
2022-04-22 05:27:59,347 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 05:27:59,347 reid_baseline.train INFO: Shuffled Accuracy: 79.8%
2022-04-22 05:28:40,239 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7764840126037598 
2022-04-22 05:28:40,239 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 05:28:40,240 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 05:28:45,496 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6
2022-04-22 05:28:45,496 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-22 05:28:45,496 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 05:28:45,496 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 05:28:45,496 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 05:28:52,046 reid_baseline.train INFO: start training
2022-04-22 05:29:24,895 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.061, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 05:29:58,694 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.006, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 05:30:16,814 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-22 05:30:46,063 reid_baseline.train INFO: normal accuracy 0.5092707045735476 4.166680335998535 
2022-04-22 05:31:16,027 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 05:31:16,028 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-22 05:31:45,236 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.596, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 05:32:08,495 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.432, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 05:32:27,923 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.263[s] Speed: 60.8[samples/s]
2022-04-22 05:33:02,093 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.02911901473999 
2022-04-22 05:33:32,057 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 05:33:32,058 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-22 05:34:01,415 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.699, Acc: 0.602, Base Lr: 2.46e-03
2022-04-22 05:34:28,237 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.550, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 05:34:49,044 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.282[s] Speed: 56.8[samples/s]
2022-04-22 05:35:24,320 reid_baseline.train INFO: normal accuracy 0.6258755665430573 3.461350679397583 
2022-04-22 05:35:54,285 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 05:35:54,286 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 346.1%
2022-04-22 05:36:22,624 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.975, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 05:36:48,930 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.898, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 05:37:08,946 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.273[s] Speed: 58.5[samples/s]
2022-04-22 05:37:41,932 reid_baseline.train INFO: normal accuracy 0.6831479192418624 2.8139140605926514 
2022-04-22 05:38:11,921 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 05:38:11,922 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 281.4%
2022-04-22 05:38:39,142 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.624, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 05:39:03,492 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.593, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 05:39:20,280 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.250[s] Speed: 63.9[samples/s]
2022-04-22 05:39:49,067 reid_baseline.train INFO: normal accuracy 0.7066337041615163 2.510345458984375 
2022-04-22 05:40:19,031 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 05:40:19,031 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 251.0%
2022-04-22 05:40:44,867 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.433, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 05:41:10,118 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.436, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 05:41:27,189 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.250[s] Speed: 64.1[samples/s]
2022-04-22 05:41:58,175 reid_baseline.train INFO: normal accuracy 0.722702925422332 2.284128427505493 
2022-04-22 05:42:28,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 05:42:28,143 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 228.4%
2022-04-22 05:42:55,892 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.371, Acc: 0.825, Base Lr: 5.62e-03
2022-04-22 05:43:25,327 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.353, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 05:43:42,493 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.272[s] Speed: 58.8[samples/s]
2022-04-22 05:44:12,819 reid_baseline.train INFO: normal accuracy 0.7317676143386898 2.1585021018981934 
2022-04-22 05:44:42,798 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 05:44:42,799 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 215.9%
2022-04-22 05:45:10,884 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.268, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 05:45:35,077 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.248, Acc: 0.855, Base Lr: 6.42e-03
2022-04-22 05:45:53,932 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.261[s] Speed: 61.4[samples/s]
2022-04-22 05:46:25,302 reid_baseline.train INFO: normal accuracy 0.7441285537700866 2.012136459350586 
2022-04-22 05:46:55,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 05:46:55,268 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 201.2%
2022-04-22 05:47:21,899 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.193, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 05:47:46,581 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.180, Acc: 0.880, Base Lr: 7.21e-03
2022-04-22 05:48:04,837 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.255[s] Speed: 62.8[samples/s]
2022-04-22 05:48:37,643 reid_baseline.train INFO: normal accuracy 0.7350638648537289 1.9477347135543823 
2022-04-22 05:49:07,605 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 05:49:07,605 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 194.8%
2022-04-22 05:49:31,932 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.146, Acc: 0.895, Base Lr: 4.01e-03
2022-04-22 05:49:57,350 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.125, Acc: 0.904, Base Lr: 4.01e-03
2022-04-22 05:50:16,575 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.253[s] Speed: 63.3[samples/s]
2022-04-22 05:51:17,343 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.9428775310516357 
2022-04-22 05:51:47,310 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 05:51:47,310 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 194.3%
2022-04-22 05:52:13,635 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.062, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 05:52:39,851 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.081, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 05:52:58,805 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.262[s] Speed: 61.1[samples/s]
2022-04-22 05:53:29,357 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.8587257862091064 
2022-04-22 05:53:59,325 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 05:53:59,326 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 185.9%
2022-04-22 05:54:27,678 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.121, Acc: 0.899, Base Lr: 2.77e-03
2022-04-22 05:54:52,878 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.082, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 05:55:11,593 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.265[s] Speed: 60.4[samples/s]
2022-04-22 05:55:44,141 reid_baseline.train INFO: normal accuracy 0.749896992171405 1.839320182800293 
2022-04-22 05:56:14,136 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 05:56:14,137 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 183.9%
2022-04-22 05:56:42,551 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.052, Acc: 0.913, Base Lr: 2.20e-03
2022-04-22 05:57:06,529 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.044, Acc: 0.920, Base Lr: 2.20e-03
2022-04-22 05:57:21,728 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.247[s] Speed: 64.7[samples/s]
2022-04-22 05:57:54,890 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.9035927057266235 
2022-04-22 05:57:54,891 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 05:57:54,891 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 190.4%
2022-04-22 05:58:24,074 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.016, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 05:58:49,639 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.004, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 05:59:06,586 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.262[s] Speed: 61.0[samples/s]
2022-04-22 05:59:37,453 reid_baseline.train INFO: normal accuracy 0.7482488669138855 1.8680566549301147 
2022-04-22 05:59:37,453 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 05:59:37,453 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 186.8%
2022-04-22 06:00:01,849 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.003, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 06:00:26,050 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.022, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 06:00:44,417 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.245[s] Speed: 65.2[samples/s]
2022-04-22 06:01:17,695 reid_baseline.train INFO: normal accuracy 0.7511330861145447 1.8819366693496704 
2022-04-22 06:01:17,695 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 06:01:17,695 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 188.2%
2022-04-22 06:01:42,074 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.993, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 06:02:06,617 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.001, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 06:02:23,311 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.240[s] Speed: 66.6[samples/s]
2022-04-22 06:02:55,206 reid_baseline.train INFO: normal accuracy 0.7507210548001648 1.8505862951278687 
2022-04-22 06:02:55,208 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 06:02:55,208 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 185.1%
2022-04-22 06:03:24,178 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.004, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 06:03:50,853 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.002, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 06:04:07,696 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-22 06:04:37,937 reid_baseline.train INFO: normal accuracy 0.749896992171405 1.8707082271575928 
2022-04-22 06:04:37,938 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 06:04:37,938 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 187.1%
2022-04-22 06:05:08,404 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.003, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 06:05:33,216 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.998, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 06:05:49,453 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.262[s] Speed: 61.1[samples/s]
2022-04-22 06:06:21,723 reid_baseline.train INFO: normal accuracy 0.7482488669138855 1.845320463180542 
2022-04-22 06:06:21,723 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 06:06:21,723 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 184.5%
2022-04-22 06:06:49,823 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.996, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 06:07:19,149 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.003, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 06:07:37,333 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.277[s] Speed: 57.8[samples/s]
2022-04-22 06:08:10,645 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.8321869373321533 
2022-04-22 06:08:40,615 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 06:08:40,615 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.2%
2022-04-22 06:09:07,723 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.957, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 06:09:32,014 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.989, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 06:09:50,715 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.256[s] Speed: 62.4[samples/s]
2022-04-22 06:10:54,473 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.7943263053894043 
2022-04-22 06:11:24,451 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 06:11:24,451 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 179.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-22 06:12:24,815 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.7943263053894043 
2022-04-22 06:12:24,816 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 06:12:24,816 reid_baseline.train INFO: Accuracy: 75.2%
2022-04-22 06:12:54,775 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.7943263053894043 
2022-04-22 06:12:54,776 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 06:12:54,776 reid_baseline.train INFO: Shuffled Accuracy: 75.2%
2022-04-22 06:13:34,207 reid_baseline.train INFO: normal accuracy 0.9599083619702177 0.7765343189239502 
2022-04-22 06:13:34,207 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 06:13:34,207 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 06:13:39,371 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6
2022-04-22 06:13:39,372 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-22 06:13:39,372 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 06:13:39,372 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 06:13:39,372 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 06:13:46,291 reid_baseline.train INFO: start training
2022-04-22 06:14:19,267 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.061, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 06:14:45,462 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.006, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 06:15:04,195 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.283[s] Speed: 56.6[samples/s]
2022-04-22 06:15:44,299 reid_baseline.train INFO: normal accuracy 0.5433656228880378 4.16417932510376 
2022-04-22 06:16:14,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 06:16:14,194 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-22 06:16:41,751 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.596, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 06:17:05,749 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.432, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 06:17:23,615 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.254[s] Speed: 63.0[samples/s]
2022-04-22 06:18:05,966 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.968374490737915 
2022-04-22 06:18:35,927 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 06:18:35,927 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-22 06:19:00,438 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.699, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 06:19:27,498 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.550, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 06:19:46,514 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.258[s] Speed: 61.9[samples/s]
2022-04-22 06:20:25,881 reid_baseline.train INFO: normal accuracy 0.6449650822257265 3.2464330196380615 
2022-04-22 06:20:55,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 06:20:55,860 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.6%
2022-04-22 06:21:23,834 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.975, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 06:21:47,047 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.898, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 06:22:03,108 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.246[s] Speed: 65.1[samples/s]
2022-04-22 06:22:43,265 reid_baseline.train INFO: normal accuracy 0.7084929038071638 2.5374765396118164 
2022-04-22 06:23:13,227 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 06:23:13,228 reid_baseline.train INFO: Accuracy: 70.8% Mean Entropy: 253.7%
2022-04-22 06:23:41,845 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.624, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 06:24:08,499 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.593, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 06:24:28,282 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.275[s] Speed: 58.2[samples/s]
2022-04-22 06:25:05,297 reid_baseline.train INFO: normal accuracy 0.7253886010362695 2.2067463397979736 
2022-04-22 06:25:35,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 06:25:35,256 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 220.7%
2022-04-22 06:26:02,244 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.433, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 06:26:27,626 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.436, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 06:26:46,156 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.260[s] Speed: 61.6[samples/s]
2022-04-22 06:27:27,216 reid_baseline.train INFO: normal accuracy 0.7382293309303898 1.9951529502868652 
2022-04-22 06:27:57,197 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 06:27:57,197 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 199.5%
2022-04-22 06:28:25,679 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.372, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 06:28:52,067 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.353, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 06:29:09,136 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.263[s] Speed: 60.7[samples/s]
2022-04-22 06:29:52,060 reid_baseline.train INFO: normal accuracy 0.7558008560486597 1.8881973028182983 
2022-04-22 06:30:22,023 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 06:30:22,024 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 188.8%
2022-04-22 06:30:51,179 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.269, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 06:31:18,300 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.249, Acc: 0.855, Base Lr: 6.42e-03
2022-04-22 06:31:38,513 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.280[s] Speed: 57.1[samples/s]
2022-04-22 06:32:17,822 reid_baseline.train INFO: normal accuracy 0.7594052714575354 1.821281909942627 
2022-04-22 06:32:47,789 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 06:32:47,790 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 182.1%
2022-04-22 06:33:13,795 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.193, Acc: 0.873, Base Lr: 7.21e-03
2022-04-22 06:33:42,582 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.180, Acc: 0.880, Base Lr: 7.21e-03
2022-04-22 06:34:03,167 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.276[s] Speed: 58.0[samples/s]
2022-04-22 06:34:46,463 reid_baseline.train INFO: normal accuracy 0.7614327551250282 1.7487618923187256 
2022-04-22 06:35:16,454 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 06:35:16,455 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 174.9%
2022-04-22 06:35:42,895 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.146, Acc: 0.895, Base Lr: 4.01e-03
2022-04-22 06:36:07,107 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.126, Acc: 0.905, Base Lr: 4.01e-03
2022-04-22 06:36:26,297 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-22 06:37:36,178 reid_baseline.train INFO: normal accuracy 0.7654877224600135 1.7921257019042969 
2022-04-22 06:37:36,178 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 06:37:36,179 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 179.2%
2022-04-22 06:38:04,628 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.062, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 06:38:31,516 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.082, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 06:38:48,555 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.265[s] Speed: 60.5[samples/s]
2022-04-22 06:39:26,959 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.6994776725769043 
2022-04-22 06:39:56,928 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 06:39:56,929 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 169.9%
2022-04-22 06:40:23,407 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.122, Acc: 0.899, Base Lr: 2.77e-03
2022-04-22 06:40:49,298 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.082, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 06:41:09,196 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.265[s] Speed: 60.4[samples/s]
2022-04-22 06:41:48,920 reid_baseline.train INFO: normal accuracy 0.7693174138319442 1.685122013092041 
2022-04-22 06:42:18,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 06:42:18,891 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 168.5%
2022-04-22 06:42:48,444 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.053, Acc: 0.913, Base Lr: 2.20e-03
2022-04-22 06:43:14,816 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.044, Acc: 0.920, Base Lr: 2.20e-03
2022-04-22 06:43:32,730 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.270[s] Speed: 59.2[samples/s]
2022-04-22 06:44:16,093 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.7561583518981934 
2022-04-22 06:44:16,094 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 06:44:16,094 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.6%
2022-04-22 06:44:41,267 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.016, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 06:45:06,606 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.004, Acc: 0.925, Base Lr: 1.66e-03
2022-04-22 06:45:23,153 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.246[s] Speed: 65.1[samples/s]
2022-04-22 06:46:02,708 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7245173454284668 
2022-04-22 06:46:02,708 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 06:46:02,709 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.5%
2022-04-22 06:46:32,196 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.003, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 06:46:57,319 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.022, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 06:47:18,557 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.277[s] Speed: 57.7[samples/s]
2022-04-22 06:48:02,531 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.754030466079712 
2022-04-22 06:48:02,532 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 06:48:02,532 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 175.4%
2022-04-22 06:48:31,541 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.993, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 06:48:56,630 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.001, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 06:49:16,945 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.273[s] Speed: 58.7[samples/s]
2022-04-22 06:49:56,716 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7088446617126465 
2022-04-22 06:49:56,716 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 06:49:56,716 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.9%
2022-04-22 06:50:26,313 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.004, Acc: 0.921, Base Lr: 4.51e-04
2022-04-22 06:50:51,091 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.002, Acc: 0.923, Base Lr: 4.51e-04
2022-04-22 06:51:10,045 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.269[s] Speed: 59.6[samples/s]
2022-04-22 06:51:48,724 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.7308669090270996 
2022-04-22 06:51:48,724 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 06:51:48,725 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 173.1%
2022-04-22 06:52:15,452 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.002, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 06:52:37,021 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.997, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 06:52:54,957 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.243[s] Speed: 66.0[samples/s]
2022-04-22 06:53:38,162 reid_baseline.train INFO: normal accuracy 0.7760756927235863 1.7132614850997925 
2022-04-22 06:53:38,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 06:53:38,163 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 171.3%
2022-04-22 06:54:05,313 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.996, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 06:54:31,104 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.003, Acc: 0.926, Base Lr: 6.51e-05
2022-04-22 06:54:52,155 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.271[s] Speed: 59.0[samples/s]
2022-04-22 06:55:36,689 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.6842272281646729 
2022-04-22 06:56:06,652 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 06:56:06,652 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.4%
2022-04-22 06:56:31,942 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.957, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 06:56:58,402 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.989, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 06:57:17,250 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.259[s] Speed: 61.9[samples/s]
2022-04-22 06:58:26,305 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6511147022247314 
2022-04-22 06:58:56,278 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 06:58:56,278 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-22 07:00:07,753 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6511147022247314 
2022-04-22 07:00:07,754 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 07:00:07,754 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-22 07:00:44,939 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6511147022247314 
2022-04-22 07:00:44,940 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 07:00:44,940 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-22 07:01:24,309 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7765130996704102 
2022-04-22 07:01:24,309 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 07:01:24,309 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 07:01:29,889 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6
2022-04-22 07:01:29,889 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-22 07:01:29,890 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 07:01:29,890 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 07:01:29,891 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 07:01:37,465 reid_baseline.train INFO: start training
2022-04-22 07:02:10,047 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.061, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 07:02:35,077 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.006, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 07:02:52,818 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.273[s] Speed: 58.6[samples/s]
2022-04-22 07:04:30,419 reid_baseline.train INFO: normal accuracy 0.5685104429653431 4.165801525115967 
2022-04-22 07:05:00,312 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 07:05:00,313 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 416.6%
2022-04-22 07:05:30,965 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.596, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 07:05:58,005 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.432, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 07:06:18,541 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.287[s] Speed: 55.8[samples/s]
2022-04-22 07:08:16,917 reid_baseline.train INFO: normal accuracy 0.602708285517558 3.9952635765075684 
2022-04-22 07:08:46,884 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 07:08:46,885 reid_baseline.train INFO: Accuracy: 60.3% Mean Entropy: 399.5%
2022-04-22 07:09:16,831 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.699, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 07:09:42,555 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.550, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 07:10:00,778 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.271[s] Speed: 59.1[samples/s]
2022-04-22 07:11:57,598 reid_baseline.train INFO: normal accuracy 0.6750057378930456 3.3014581203460693 
2022-04-22 07:12:27,562 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 07:12:27,563 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 330.1%
2022-04-22 07:12:53,339 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.975, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 07:13:17,817 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.898, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 07:13:37,873 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.257[s] Speed: 62.2[samples/s]
2022-04-22 07:15:17,862 reid_baseline.train INFO: normal accuracy 0.7339912784025706 2.587610960006714 
2022-04-22 07:15:47,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 07:15:47,843 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 258.8%
2022-04-22 07:16:15,139 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.624, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 07:16:41,912 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.593, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 07:17:01,629 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.270[s] Speed: 59.2[samples/s]
2022-04-22 07:18:44,711 reid_baseline.train INFO: normal accuracy 0.7592380078035346 2.2668509483337402 
2022-04-22 07:19:14,675 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 07:19:14,676 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 226.7%
2022-04-22 07:19:41,381 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.433, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 07:20:08,539 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.436, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 07:20:27,751 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.268[s] Speed: 59.8[samples/s]
2022-04-22 07:22:21,509 reid_baseline.train INFO: normal accuracy 0.7773697498278632 2.055793285369873 
2022-04-22 07:22:51,480 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 07:22:51,481 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 205.6%
2022-04-22 07:23:19,228 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.372, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 07:23:43,077 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.353, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 07:24:00,812 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.254[s] Speed: 63.1[samples/s]
2022-04-22 07:25:43,288 reid_baseline.train INFO: normal accuracy 0.7780582969933441 1.9490768909454346 
2022-04-22 07:26:13,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 07:26:13,267 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 194.9%
2022-04-22 07:26:43,181 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.268, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 07:27:06,578 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.248, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 07:27:23,430 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.257[s] Speed: 62.3[samples/s]
2022-04-22 07:29:07,689 reid_baseline.train INFO: normal accuracy 0.786779894422768 1.835270643234253 
2022-04-22 07:29:37,682 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 07:29:37,683 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 183.5%
2022-04-22 07:30:04,252 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.193, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 07:30:30,937 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.180, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 07:30:49,206 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.262[s] Speed: 61.2[samples/s]
2022-04-22 07:32:38,397 reid_baseline.train INFO: normal accuracy 0.7837961900390177 1.7669421434402466 
2022-04-22 07:33:08,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 07:33:08,365 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 176.7%
2022-04-22 07:33:33,772 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.145, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 07:33:55,801 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.125, Acc: 0.905, Base Lr: 4.01e-03
2022-04-22 07:34:13,430 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.238[s] Speed: 67.1[samples/s]
2022-04-22 07:36:29,601 reid_baseline.train INFO: normal accuracy 0.7913702088593069 1.796162486076355 
2022-04-22 07:36:29,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 07:36:29,602 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 179.6%
2022-04-22 07:36:57,961 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.061, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 07:37:21,669 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.081, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 07:37:40,784 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.261[s] Speed: 61.4[samples/s]
2022-04-22 07:39:28,886 reid_baseline.train INFO: normal accuracy 0.7915997245811338 1.715529203414917 
2022-04-22 07:39:58,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 07:39:58,857 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 171.6%
2022-04-22 07:40:25,439 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.121, Acc: 0.899, Base Lr: 2.77e-03
2022-04-22 07:40:47,268 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.082, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 07:41:08,447 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.255[s] Speed: 62.8[samples/s]
2022-04-22 07:42:55,916 reid_baseline.train INFO: normal accuracy 0.7902226302501721 1.696284294128418 
2022-04-22 07:43:25,880 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 07:43:25,880 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 169.6%
2022-04-22 07:43:54,945 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.052, Acc: 0.913, Base Lr: 2.20e-03
2022-04-22 07:44:20,821 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.043, Acc: 0.920, Base Lr: 2.20e-03
2022-04-22 07:44:37,362 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.261[s] Speed: 61.2[samples/s]
2022-04-22 07:46:21,805 reid_baseline.train INFO: normal accuracy 0.7966490704613266 1.7699453830718994 
2022-04-22 07:46:21,806 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 07:46:21,806 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 177.0%
2022-04-22 07:46:50,383 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.015, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 07:47:18,337 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.004, Acc: 0.925, Base Lr: 1.66e-03
2022-04-22 07:47:37,388 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.276[s] Speed: 57.9[samples/s]
2022-04-22 07:49:25,489 reid_baseline.train INFO: normal accuracy 0.7936653660775763 1.7314127683639526 
2022-04-22 07:49:25,489 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 07:49:25,490 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 173.1%
2022-04-22 07:49:53,677 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.002, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 07:50:18,988 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.021, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 07:50:39,159 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.269[s] Speed: 59.4[samples/s]
2022-04-22 07:52:35,740 reid_baseline.train INFO: normal accuracy 0.7911406931374799 1.7561310529708862 
2022-04-22 07:52:35,741 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 07:52:35,741 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 175.6%
2022-04-22 07:53:05,931 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.992, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 07:53:34,702 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.000, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 07:53:53,585 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.285[s] Speed: 56.1[samples/s]
2022-04-22 07:55:45,497 reid_baseline.train INFO: normal accuracy 0.7938948817994033 1.7183454036712646 
2022-04-22 07:55:45,498 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 07:55:45,498 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 171.8%
2022-04-22 07:56:17,782 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.003, Acc: 0.923, Base Lr: 4.51e-04
2022-04-22 07:56:44,156 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.002, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 07:57:02,982 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.284[s] Speed: 56.4[samples/s]
2022-04-22 07:58:48,337 reid_baseline.train INFO: normal accuracy 0.7943539132430572 1.7412428855895996 
2022-04-22 07:58:48,338 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 07:58:48,338 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 174.1%
2022-04-22 07:59:12,146 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.002, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 07:59:33,451 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.997, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 07:59:52,785 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.236[s] Speed: 67.8[samples/s]
2022-04-22 08:01:38,301 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.7255011796951294 
2022-04-22 08:01:38,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 08:01:38,302 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 172.6%
2022-04-22 08:02:07,884 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.995, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 08:02:30,566 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.003, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 08:02:49,542 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.261[s] Speed: 61.3[samples/s]
2022-04-22 08:04:39,231 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.6987076997756958 
2022-04-22 08:04:39,231 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 08:04:39,232 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 169.9%
2022-04-22 08:05:08,311 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.957, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 08:05:33,013 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.988, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 08:05:56,093 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-22 08:08:13,354 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6611931324005127 
2022-04-22 08:08:43,304 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 08:08:43,305 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 166.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-22 08:11:03,991 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6611931324005127 
2022-04-22 08:11:03,992 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 08:11:03,992 reid_baseline.train INFO: Accuracy: 79.7%
2022-04-22 08:12:51,161 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6611931324005127 
2022-04-22 08:12:51,161 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 08:12:51,162 reid_baseline.train INFO: Shuffled Accuracy: 79.7%
2022-04-22 08:13:31,534 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7762433886528015 
2022-04-22 08:13:31,535 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 08:13:31,535 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 08:13:36,929 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_7
2022-04-22 08:13:36,929 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_7', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=7)
2022-04-22 08:13:36,930 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 08:13:36,930 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 08:13:36,931 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_7
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 08:13:43,512 reid_baseline.train INFO: start training
2022-04-22 08:14:12,746 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.084, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 08:14:40,502 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.011, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 08:14:59,667 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.277[s] Speed: 57.8[samples/s]
2022-04-22 08:15:29,041 reid_baseline.train INFO: normal accuracy 0.5092707045735476 4.166680335998535 
2022-04-22 08:15:58,927 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 08:15:58,927 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-22 08:16:24,512 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.596, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 08:16:46,196 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.417, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 08:17:03,087 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.235[s] Speed: 68.1[samples/s]
2022-04-22 08:17:33,475 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.029133319854736 
2022-04-22 08:18:03,443 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 08:18:03,444 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-22 08:18:31,856 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.683, Acc: 0.602, Base Lr: 2.46e-03
2022-04-22 08:18:56,445 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.526, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 08:19:14,911 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.262[s] Speed: 61.1[samples/s]
2022-04-22 08:19:46,021 reid_baseline.train INFO: normal accuracy 0.6254635352286774 3.461412191390991 
2022-04-22 08:20:15,980 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 08:20:15,980 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 346.1%
2022-04-22 08:20:42,118 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.939, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 08:21:07,698 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.865, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 08:21:26,705 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.259[s] Speed: 61.8[samples/s]
2022-04-22 08:21:57,459 reid_baseline.train INFO: normal accuracy 0.6835599505562423 2.8139445781707764 
2022-04-22 08:22:27,409 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 08:22:27,410 reid_baseline.train INFO: Accuracy: 68.4% Mean Entropy: 281.4%
2022-04-22 08:22:54,363 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.602, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 08:23:19,462 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.562, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 08:23:36,109 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.252[s] Speed: 63.6[samples/s]
2022-04-22 08:24:07,375 reid_baseline.train INFO: normal accuracy 0.7070457354758962 2.5105133056640625 
2022-04-22 08:24:37,349 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 08:24:37,350 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 251.1%
2022-04-22 08:25:10,421 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.410, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 08:25:42,370 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.403, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 08:26:01,835 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-22 08:26:33,259 reid_baseline.train INFO: normal accuracy 0.7222908941079522 2.2837953567504883 
2022-04-22 08:27:03,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 08:27:03,203 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 228.4%
2022-04-22 08:27:27,680 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.315, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 08:27:49,773 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.298, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 08:28:06,283 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.231[s] Speed: 69.2[samples/s]
2022-04-22 08:28:40,412 reid_baseline.train INFO: normal accuracy 0.7317676143386898 2.1586573123931885 
2022-04-22 08:29:10,380 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 08:29:10,381 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 215.9%
2022-04-22 08:29:40,481 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.235, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 08:30:05,337 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.232, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 08:30:23,783 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.269[s] Speed: 59.5[samples/s]
2022-04-22 08:30:52,448 reid_baseline.train INFO: normal accuracy 0.7437165224557066 2.0115103721618652 
2022-04-22 08:31:22,437 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 08:31:22,438 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 201.2%
2022-04-22 08:31:51,128 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.185, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 08:32:17,480 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.182, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 08:32:35,550 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.268[s] Speed: 59.7[samples/s]
2022-04-22 08:33:10,651 reid_baseline.train INFO: normal accuracy 0.7371240214256284 1.9477218389511108 
2022-04-22 08:33:40,621 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 08:33:40,622 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 194.8%
2022-04-22 08:34:04,263 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.094, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 08:34:29,091 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.087, Acc: 0.905, Base Lr: 4.01e-03
2022-04-22 08:34:45,640 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.238[s] Speed: 67.3[samples/s]
2022-04-22 08:35:46,463 reid_baseline.train INFO: normal accuracy 0.7420683971981871 1.945780873298645 
2022-04-22 08:36:16,435 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 08:36:16,436 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 194.6%
2022-04-22 08:36:43,203 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.039, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 08:37:07,711 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.060, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 08:37:26,852 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-22 08:37:54,773 reid_baseline.train INFO: normal accuracy 0.746188710341986 1.8593887090682983 
2022-04-22 08:38:24,724 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 08:38:24,725 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 185.9%
2022-04-22 08:38:50,836 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.043, Acc: 0.899, Base Lr: 2.77e-03
2022-04-22 08:39:17,921 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.035, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 08:39:36,052 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.261[s] Speed: 61.2[samples/s]
2022-04-22 08:40:06,348 reid_baseline.train INFO: normal accuracy 0.7482488669138855 1.8402764797210693 
2022-04-22 08:40:36,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 08:40:36,296 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 184.0%
2022-04-22 08:41:06,682 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.062, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 08:41:29,589 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.042, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 08:41:47,243 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.260[s] Speed: 61.6[samples/s]
2022-04-22 08:42:20,701 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.9040091037750244 
2022-04-22 08:42:20,701 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 08:42:20,701 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 190.4%
2022-04-22 08:42:45,864 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.059, Acc: 0.913, Base Lr: 1.66e-03
2022-04-22 08:43:13,589 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.025, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 08:43:31,110 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-22 08:44:04,198 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.8684650659561157 
2022-04-22 08:44:04,198 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 08:44:04,199 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 186.8%
2022-04-22 08:44:29,605 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.000, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 08:44:53,129 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.006, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 08:45:12,443 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.250[s] Speed: 64.0[samples/s]
2022-04-22 08:45:45,531 reid_baseline.train INFO: normal accuracy 0.7519571487433044 1.8823803663253784 
2022-04-22 08:45:45,532 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 08:45:45,533 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 188.2%
2022-04-22 08:46:10,224 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.014, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 08:46:37,414 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.006, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 08:46:54,205 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.252[s] Speed: 63.6[samples/s]
2022-04-22 08:47:24,775 reid_baseline.train INFO: normal accuracy 0.7503090234857849 1.8504760265350342 
2022-04-22 08:47:24,778 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 08:47:24,778 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 185.0%
2022-04-22 08:47:55,025 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.987, Acc: 0.921, Base Lr: 4.51e-04
2022-04-22 08:48:19,156 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.994, Acc: 0.923, Base Lr: 4.51e-04
2022-04-22 08:48:37,881 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.268[s] Speed: 59.8[samples/s]
2022-04-22 08:49:08,884 reid_baseline.train INFO: normal accuracy 0.7486608982282653 1.870978593826294 
2022-04-22 08:49:08,885 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 08:49:08,885 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 187.1%
2022-04-22 08:49:35,748 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.955, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 08:50:00,748 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.981, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 08:50:19,329 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-22 08:50:48,232 reid_baseline.train INFO: normal accuracy 0.7478368355995055 1.8459699153900146 
2022-04-22 08:50:48,233 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 08:50:48,233 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 184.6%
2022-04-22 08:51:15,800 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.986, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 08:51:42,928 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.004, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 08:52:01,207 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.267[s] Speed: 59.9[samples/s]
2022-04-22 08:52:30,137 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.8327196836471558 
2022-04-22 08:53:00,098 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 08:53:00,099 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.3%
2022-04-22 08:53:27,214 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.987, Acc: 0.940, Base Lr: 1.60e-05
2022-04-22 08:53:52,988 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.978, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 08:54:12,505 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.265[s] Speed: 60.4[samples/s]
2022-04-22 08:55:12,301 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.7946844100952148 
2022-04-22 08:55:42,249 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 08:55:42,249 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 179.5%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_7/transformer_best_model.pth
2022-04-22 08:56:43,216 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.7946844100952148 
2022-04-22 08:56:43,217 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 08:56:43,217 reid_baseline.train INFO: Accuracy: 75.2%
2022-04-22 08:57:14,590 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.7946844100952148 
2022-04-22 08:57:14,590 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 08:57:14,590 reid_baseline.train INFO: Shuffled Accuracy: 75.2%
2022-04-22 08:57:55,863 reid_baseline.train INFO: normal accuracy 0.9601374570446736 0.7763364315032959 
2022-04-22 08:57:55,864 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 08:57:55,864 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 08:58:01,540 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_7
2022-04-22 08:58:01,540 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_7', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=7)
2022-04-22 08:58:01,540 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 08:58:01,540 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 08:58:01,541 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_7
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 08:58:08,823 reid_baseline.train INFO: start training
2022-04-22 08:58:42,154 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.084, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 08:59:08,801 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.011, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 08:59:26,684 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.283[s] Speed: 56.6[samples/s]
2022-04-22 09:00:10,339 reid_baseline.train INFO: normal accuracy 0.5433656228880378 4.16417932510376 
2022-04-22 09:00:40,234 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 09:00:40,234 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-22 09:01:08,455 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.596, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 09:01:31,931 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.417, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 09:01:53,440 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.268[s] Speed: 59.7[samples/s]
2022-04-22 09:02:36,718 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.9683690071105957 
2022-04-22 09:03:06,674 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 09:03:06,674 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-22 09:03:33,854 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.683, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 09:03:58,568 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.526, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 09:04:17,486 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.259[s] Speed: 61.7[samples/s]
2022-04-22 09:04:53,509 reid_baseline.train INFO: normal accuracy 0.6449650822257265 3.246500253677368 
2022-04-22 09:05:23,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 09:05:23,465 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.7%
2022-04-22 09:05:51,616 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.939, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 09:06:15,723 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.865, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 09:06:32,781 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.254[s] Speed: 63.0[samples/s]
2022-04-22 09:07:09,728 reid_baseline.train INFO: normal accuracy 0.7087181797702186 2.5373876094818115 
2022-04-22 09:07:39,694 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 09:07:39,695 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 253.7%
2022-04-22 09:08:08,112 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.602, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 09:08:32,657 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.562, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 09:08:50,980 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.261[s] Speed: 61.3[samples/s]
2022-04-22 09:09:29,384 reid_baseline.train INFO: normal accuracy 0.7251633250732147 2.206547975540161 
2022-04-22 09:09:59,363 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 09:09:59,364 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 220.7%
2022-04-22 09:10:24,241 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.410, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 09:10:49,759 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.403, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 09:11:09,274 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.256[s] Speed: 62.6[samples/s]
2022-04-22 09:11:50,412 reid_baseline.train INFO: normal accuracy 0.7382293309303898 1.9951974153518677 
2022-04-22 09:12:20,360 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 09:12:20,360 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 199.5%
2022-04-22 09:12:45,476 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.315, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 09:13:09,030 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.298, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 09:13:28,980 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.251[s] Speed: 63.7[samples/s]
2022-04-22 09:14:10,786 reid_baseline.train INFO: normal accuracy 0.7555755800856049 1.8886579275131226 
2022-04-22 09:14:40,740 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 09:14:40,741 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 188.9%
2022-04-22 09:15:09,000 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.235, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 09:15:33,097 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.232, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 09:15:50,334 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.254[s] Speed: 62.9[samples/s]
2022-04-22 09:16:28,255 reid_baseline.train INFO: normal accuracy 0.759855823383645 1.8221750259399414 
2022-04-22 09:16:58,207 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 09:16:58,207 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 182.2%
2022-04-22 09:17:26,885 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.186, Acc: 0.873, Base Lr: 7.21e-03
2022-04-22 09:17:52,009 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.182, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 09:18:10,728 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.266[s] Speed: 60.2[samples/s]
2022-04-22 09:18:47,879 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.7475775480270386 
2022-04-22 09:19:17,832 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 09:19:17,832 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 174.8%
2022-04-22 09:19:46,049 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.096, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 09:20:11,196 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.088, Acc: 0.904, Base Lr: 4.01e-03
2022-04-22 09:20:28,463 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.259[s] Speed: 61.8[samples/s]
2022-04-22 09:21:36,795 reid_baseline.train INFO: normal accuracy 0.7654877224600135 1.7911601066589355 
2022-04-22 09:21:36,796 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 09:21:36,796 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 179.1%
2022-04-22 09:22:01,485 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.039, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 09:22:28,377 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.061, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 09:22:49,133 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.265[s] Speed: 60.4[samples/s]
2022-04-22 09:23:30,919 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.6996567249298096 
2022-04-22 09:24:00,908 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 09:24:00,909 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.0%
2022-04-22 09:24:27,966 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.043, Acc: 0.900, Base Lr: 2.77e-03
2022-04-22 09:24:53,719 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.035, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 09:25:13,382 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-22 09:25:53,890 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.6852463483810425 
2022-04-22 09:26:23,839 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 09:26:23,840 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.5%
2022-04-22 09:26:52,318 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.061, Acc: 0.913, Base Lr: 2.20e-03
2022-04-22 09:27:17,701 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.042, Acc: 0.920, Base Lr: 2.20e-03
2022-04-22 09:27:35,924 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.264[s] Speed: 60.6[samples/s]
2022-04-22 09:28:17,529 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.7558239698410034 
2022-04-22 09:28:17,529 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 09:28:17,530 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.6%
2022-04-22 09:28:45,219 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.060, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 09:29:11,229 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.025, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 09:29:29,100 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.262[s] Speed: 61.0[samples/s]
2022-04-22 09:30:08,065 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.7239068746566772 
2022-04-22 09:30:08,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 09:30:08,065 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.4%
2022-04-22 09:30:37,328 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.000, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 09:31:02,640 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.006, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 09:31:22,469 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.272[s] Speed: 58.8[samples/s]
2022-04-22 09:32:05,079 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.753389596939087 
2022-04-22 09:32:05,080 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 09:32:05,081 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 175.3%
2022-04-22 09:32:30,267 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.014, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 09:32:57,420 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.006, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 09:33:18,096 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.267[s] Speed: 59.8[samples/s]
2022-04-22 09:34:02,399 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7083384990692139 
2022-04-22 09:34:02,401 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 09:34:02,401 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.8%
2022-04-22 09:34:30,876 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.987, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 09:34:55,980 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.994, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 09:35:14,383 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.264[s] Speed: 60.7[samples/s]
2022-04-22 09:35:52,989 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.7305405139923096 
2022-04-22 09:35:52,989 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 09:35:52,990 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 173.1%
2022-04-22 09:36:23,878 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.955, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 09:36:46,883 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.981, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 09:37:04,950 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.264[s] Speed: 60.7[samples/s]
2022-04-22 09:37:47,198 reid_baseline.train INFO: normal accuracy 0.7758504167605317 1.7129671573638916 
2022-04-22 09:37:47,198 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 09:37:47,198 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 171.3%
2022-04-22 09:38:17,446 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.986, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 09:38:44,499 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.004, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 09:39:06,572 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-22 09:39:48,078 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.6838324069976807 
2022-04-22 09:40:18,040 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 09:40:18,041 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.4%
2022-04-22 09:40:46,503 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.987, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 09:41:16,612 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.978, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 09:41:36,067 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-22 09:42:45,928 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6504772901535034 
2022-04-22 09:43:15,880 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 09:43:15,881 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_7/transformer_best_model.pth
2022-04-22 09:44:26,322 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6504772901535034 
2022-04-22 09:44:26,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 09:44:26,323 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-22 09:45:05,116 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6504772901535034 
2022-04-22 09:45:05,116 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 09:45:05,116 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-22 09:45:44,500 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7761055827140808 
2022-04-22 09:45:44,501 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 09:45:44,501 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 09:45:49,700 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_7
2022-04-22 09:45:49,700 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_7', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=7)
2022-04-22 09:45:49,700 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 09:45:49,700 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 09:45:49,701 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_7
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 09:45:56,502 reid_baseline.train INFO: start training
2022-04-22 09:46:28,716 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.084, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 09:46:55,203 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.011, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 09:47:15,450 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-22 09:48:58,951 reid_baseline.train INFO: normal accuracy 0.5687399586871701 4.165801525115967 
2022-04-22 09:49:28,832 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 09:49:28,833 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 416.6%
2022-04-22 09:49:54,699 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.596, Acc: 0.550, Base Lr: 1.66e-03
2022-04-22 09:50:20,978 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.417, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 09:50:39,306 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.258[s] Speed: 62.0[samples/s]
2022-04-22 09:52:21,196 reid_baseline.train INFO: normal accuracy 0.602478769795731 3.995262622833252 
2022-04-22 09:52:51,161 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 09:52:51,162 reid_baseline.train INFO: Accuracy: 60.2% Mean Entropy: 399.5%
2022-04-22 09:53:19,088 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.683, Acc: 0.602, Base Lr: 2.46e-03
2022-04-22 09:53:42,972 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.526, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 09:54:02,750 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.262[s] Speed: 61.0[samples/s]
2022-04-22 09:55:41,498 reid_baseline.train INFO: normal accuracy 0.6750057378930456 3.3015060424804688 
2022-04-22 09:56:11,464 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 09:56:11,465 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 330.2%
2022-04-22 09:56:58,069 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.939, Acc: 0.684, Base Lr: 3.25e-03
2022-04-22 09:57:45,748 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.865, Acc: 0.710, Base Lr: 3.25e-03
2022-04-22 09:58:18,173 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.464[s] Speed: 34.5[samples/s]
2022-04-22 09:59:58,995 reid_baseline.train INFO: normal accuracy 0.7342207941243976 2.5876169204711914 
2022-04-22 10:00:28,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 10:00:28,946 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 258.8%
2022-04-22 10:01:17,632 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.602, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 10:02:01,718 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.562, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 10:02:36,120 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.466[s] Speed: 34.3[samples/s]
2022-04-22 10:04:27,594 reid_baseline.train INFO: normal accuracy 0.7596970392471885 2.2668557167053223 
2022-04-22 10:04:57,572 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 10:04:57,573 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 226.7%
2022-04-22 10:05:44,531 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.410, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 10:06:34,493 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.403, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 10:07:10,639 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.487[s] Speed: 32.8[samples/s]
2022-04-22 10:09:06,853 reid_baseline.train INFO: normal accuracy 0.7771402341060363 2.0554182529449463 
2022-04-22 10:09:36,803 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 10:09:36,803 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 205.5%
2022-04-22 10:10:27,123 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.316, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 10:11:15,161 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.298, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 10:11:48,660 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.483[s] Speed: 33.1[samples/s]
2022-04-22 10:13:33,921 reid_baseline.train INFO: normal accuracy 0.7778287812715171 1.9492249488830566 
2022-04-22 10:14:03,888 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 10:14:03,889 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 194.9%
2022-04-22 10:14:50,770 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.236, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 10:15:41,281 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.232, Acc: 0.855, Base Lr: 6.42e-03
2022-04-22 10:16:08,991 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.458[s] Speed: 34.9[samples/s]
2022-04-22 10:17:40,769 reid_baseline.train INFO: normal accuracy 0.786550378700941 1.8352478742599487 
2022-04-22 10:18:10,743 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 10:18:10,744 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 183.5%
2022-04-22 10:18:35,443 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.185, Acc: 0.873, Base Lr: 7.21e-03
2022-04-22 10:19:03,227 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.182, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 10:19:21,765 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.260[s] Speed: 61.5[samples/s]
2022-04-22 10:21:03,594 reid_baseline.train INFO: normal accuracy 0.7840257057608446 1.7687236070632935 
2022-04-22 10:21:33,542 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 10:21:33,543 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 176.9%
2022-04-22 10:22:01,054 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.095, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 10:22:25,069 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.087, Acc: 0.904, Base Lr: 4.01e-03
2022-04-22 10:22:42,389 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.252[s] Speed: 63.4[samples/s]
2022-04-22 10:24:55,999 reid_baseline.train INFO: normal accuracy 0.7913702088593069 1.795342206954956 
2022-04-22 10:24:56,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 10:24:56,001 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 179.5%
2022-04-22 10:25:27,023 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.038, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 10:25:56,844 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.060, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 10:26:16,169 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-22 10:28:05,191 reid_baseline.train INFO: normal accuracy 0.7920587560247877 1.715469479560852 
2022-04-22 10:28:35,157 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 10:28:35,157 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 171.5%
2022-04-22 10:29:05,087 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.043, Acc: 0.899, Base Lr: 2.77e-03
2022-04-22 10:29:34,657 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.035, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 10:29:54,237 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-22 10:31:33,969 reid_baseline.train INFO: normal accuracy 0.7902226302501721 1.6948537826538086 
2022-04-22 10:32:03,950 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 10:32:03,950 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 169.5%
2022-04-22 10:32:31,561 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.061, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 10:32:58,376 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.042, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 10:33:14,173 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.257[s] Speed: 62.2[samples/s]
2022-04-22 10:34:58,085 reid_baseline.train INFO: normal accuracy 0.7961900390176727 1.7697747945785522 
2022-04-22 10:34:58,085 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 10:34:58,085 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 177.0%
2022-04-22 10:35:28,530 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.060, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 10:35:55,171 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.025, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 10:36:12,268 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.272[s] Speed: 58.9[samples/s]
2022-04-22 10:37:46,698 reid_baseline.train INFO: normal accuracy 0.7929768189120955 1.7310267686843872 
2022-04-22 10:37:46,698 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 10:37:46,699 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 173.1%
2022-04-22 10:38:14,496 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.000, Acc: 0.932, Base Lr: 1.19e-03
2022-04-22 10:38:40,529 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.006, Acc: 0.927, Base Lr: 1.19e-03
2022-04-22 10:38:56,769 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.257[s] Speed: 62.3[samples/s]
2022-04-22 10:40:39,791 reid_baseline.train INFO: normal accuracy 0.7911406931374799 1.7562592029571533 
2022-04-22 10:40:39,791 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 10:40:39,792 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 175.6%
2022-04-22 10:41:10,351 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.014, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 10:41:38,224 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.006, Acc: 0.930, Base Lr: 7.78e-04
2022-04-22 10:41:57,165 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.283[s] Speed: 56.5[samples/s]
2022-04-22 10:43:41,514 reid_baseline.train INFO: normal accuracy 0.7941243975212302 1.7185957431793213 
2022-04-22 10:43:41,515 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 10:43:41,515 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 171.9%
2022-04-22 10:44:08,430 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.987, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 10:44:30,447 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.994, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 10:44:48,437 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.245[s] Speed: 65.3[samples/s]
2022-04-22 10:46:35,050 reid_baseline.train INFO: normal accuracy 0.7941243975212302 1.741575837135315 
2022-04-22 10:46:35,051 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 10:46:35,051 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 174.2%
2022-04-22 10:47:00,329 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.955, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 10:47:25,837 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.981, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 10:47:43,419 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.250[s] Speed: 63.9[samples/s]
2022-04-22 10:49:21,698 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.7256590127944946 
2022-04-22 10:49:21,699 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 10:49:21,700 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 172.6%
2022-04-22 10:49:51,491 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.986, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 10:50:18,410 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.004, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 10:50:36,649 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.275[s] Speed: 58.3[samples/s]
2022-04-22 10:52:21,918 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.698487639427185 
2022-04-22 10:52:21,919 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 10:52:21,919 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 169.8%
2022-04-22 10:52:48,280 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.987, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 10:53:13,715 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.978, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 10:53:32,680 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.259[s] Speed: 61.9[samples/s]
2022-04-22 10:56:22,661 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6609922647476196 
2022-04-22 10:56:52,632 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 10:56:52,632 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 166.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_7/transformer_best_model.pth
2022-04-22 10:59:12,743 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6609922647476196 
2022-04-22 10:59:12,744 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 10:59:12,744 reid_baseline.train INFO: Accuracy: 79.7%
2022-04-22 11:00:41,456 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6609922647476196 
2022-04-22 11:00:41,457 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:00:41,457 reid_baseline.train INFO: Shuffled Accuracy: 79.7%
2022-04-22 11:01:16,840 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7761331796646118 
2022-04-22 11:01:16,841 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:01:16,841 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 11:01:22,137 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_8
2022-04-22 11:01:22,137 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=8)
2022-04-22 11:01:22,137 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 11:01:22,137 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 11:01:22,138 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 11:01:30,698 reid_baseline.train INFO: start training
2022-04-22 11:02:01,576 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.040, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 11:02:23,396 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.969, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 11:02:39,151 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.247[s] Speed: 64.7[samples/s]
2022-04-22 11:03:06,068 reid_baseline.train INFO: normal accuracy 0.5092707045735476 4.166680335998535 
2022-04-22 11:03:36,023 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 11:03:36,024 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-22 11:04:00,902 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.560, Acc: 0.550, Base Lr: 1.66e-03
2022-04-22 11:04:22,911 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.388, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 11:04:40,084 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.234[s] Speed: 68.3[samples/s]
2022-04-22 11:05:08,947 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.029130458831787 
2022-04-22 11:05:38,934 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 11:05:38,934 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-22 11:06:03,168 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.643, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 11:06:25,484 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.490, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 11:06:42,033 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.231[s] Speed: 69.4[samples/s]
2022-04-22 11:07:09,514 reid_baseline.train INFO: normal accuracy 0.6258755665430573 3.461355209350586 
2022-04-22 11:07:39,519 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 11:07:39,519 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 346.1%
2022-04-22 11:08:03,225 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.908, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 11:08:24,937 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.830, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 11:08:41,381 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.227[s] Speed: 70.6[samples/s]
2022-04-22 11:09:09,363 reid_baseline.train INFO: normal accuracy 0.6831479192418624 2.8139522075653076 
2022-04-22 11:09:39,346 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 11:09:39,347 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 281.4%
2022-04-22 11:10:03,113 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.537, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 11:10:25,226 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.507, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 11:10:41,692 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-22 11:11:08,894 reid_baseline.train INFO: normal accuracy 0.7066337041615163 2.5103225708007812 
2022-04-22 11:11:38,978 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 11:11:38,979 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 251.0%
2022-04-22 11:12:02,873 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.368, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 11:12:25,874 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.360, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 11:12:42,209 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.232[s] Speed: 69.1[samples/s]
2022-04-22 11:13:10,132 reid_baseline.train INFO: normal accuracy 0.7222908941079522 2.2844605445861816 
2022-04-22 11:13:40,965 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 11:13:40,966 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 228.4%
2022-04-22 11:14:05,364 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.248, Acc: 0.825, Base Lr: 5.62e-03
2022-04-22 11:14:27,645 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.223, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 11:14:43,644 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.230[s] Speed: 69.7[samples/s]
2022-04-22 11:15:12,231 reid_baseline.train INFO: normal accuracy 0.7313555830243098 2.158698320388794 
2022-04-22 11:15:43,058 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 11:15:43,058 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 215.9%
2022-04-22 11:16:08,090 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.161, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 11:16:30,306 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.161, Acc: 0.855, Base Lr: 6.42e-03
2022-04-22 11:16:46,888 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.234[s] Speed: 68.4[samples/s]
2022-04-22 11:17:14,294 reid_baseline.train INFO: normal accuracy 0.7437165224557066 2.011547803878784 
2022-04-22 11:17:45,118 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 11:17:45,118 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 201.2%
2022-04-22 11:18:09,278 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.096, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 11:18:31,287 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.106, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 11:18:47,746 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-22 11:19:15,196 reid_baseline.train INFO: normal accuracy 0.7358879274824887 1.9472168684005737 
2022-04-22 11:19:45,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 11:19:45,204 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 194.7%
2022-04-22 11:20:08,691 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.052, Acc: 0.893, Base Lr: 4.01e-03
2022-04-22 11:20:30,536 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.027, Acc: 0.903, Base Lr: 4.01e-03
2022-04-22 11:20:46,236 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.224[s] Speed: 71.6[samples/s]
2022-04-22 11:21:44,060 reid_baseline.train INFO: normal accuracy 0.7424804285125669 1.9434123039245605 
2022-04-22 11:22:14,044 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 11:22:14,045 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 194.3%
2022-04-22 11:22:37,863 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.003, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 11:23:00,102 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.015, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 11:23:16,334 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-22 11:23:43,495 reid_baseline.train INFO: normal accuracy 0.746188710341986 1.859138011932373 
2022-04-22 11:24:13,503 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 11:24:13,503 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 185.9%
2022-04-22 11:24:38,036 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.019, Acc: 0.900, Base Lr: 2.77e-03
2022-04-22 11:24:59,956 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.983, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 11:25:16,267 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.230[s] Speed: 69.6[samples/s]
2022-04-22 11:25:43,627 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8396024703979492 
2022-04-22 11:26:13,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 11:26:13,598 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 184.0%
2022-04-22 11:26:37,729 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.988, Acc: 0.913, Base Lr: 2.20e-03
2022-04-22 11:26:59,706 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.974, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 11:27:15,129 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.225[s] Speed: 71.0[samples/s]
2022-04-22 11:27:43,613 reid_baseline.train INFO: normal accuracy 0.746188710341986 1.903420329093933 
2022-04-22 11:27:43,614 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 11:27:43,614 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 190.3%
2022-04-22 11:28:07,271 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.977, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 11:28:29,364 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.960, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 11:28:45,610 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-22 11:29:13,351 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.867773175239563 
2022-04-22 11:29:13,351 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 11:29:13,351 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 186.8%
2022-04-22 11:29:36,942 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.925, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 11:29:59,080 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.934, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 11:30:15,161 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-22 11:30:44,801 reid_baseline.train INFO: normal accuracy 0.7515451174289246 1.8823397159576416 
2022-04-22 11:30:44,802 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 11:30:44,803 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 188.2%
2022-04-22 11:31:08,382 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.954, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 11:31:30,211 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.947, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 11:31:46,287 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.225[s] Speed: 71.1[samples/s]
2022-04-22 11:32:13,556 reid_baseline.train INFO: normal accuracy 0.7511330861145447 1.8509074449539185 
2022-04-22 11:32:13,556 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 11:32:13,556 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 185.1%
2022-04-22 11:32:37,279 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.938, Acc: 0.921, Base Lr: 4.51e-04
2022-04-22 11:32:59,103 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.938, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 11:33:15,773 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.228[s] Speed: 70.2[samples/s]
2022-04-22 11:33:43,265 reid_baseline.train INFO: normal accuracy 0.749896992171405 1.870934009552002 
2022-04-22 11:33:43,265 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 11:33:43,265 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 187.1%
2022-04-22 11:34:06,857 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.925, Acc: 0.938, Base Lr: 2.11e-04
2022-04-22 11:34:28,359 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.927, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 11:34:44,236 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.223[s] Speed: 71.6[samples/s]
2022-04-22 11:35:12,995 reid_baseline.train INFO: normal accuracy 0.7466007416563659 1.8454029560089111 
2022-04-22 11:35:12,996 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 11:35:12,996 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 184.5%
2022-04-22 11:35:36,358 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.901, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 11:35:58,283 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.924, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 11:36:14,472 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.225[s] Speed: 71.1[samples/s]
2022-04-22 11:36:41,978 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8323355913162231 
2022-04-22 11:37:11,942 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 11:37:11,942 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.2%
2022-04-22 11:37:35,582 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.916, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 11:37:58,173 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.919, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 11:38:14,462 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-22 11:39:11,974 reid_baseline.train INFO: normal accuracy 0.7527812113720643 1.7944345474243164 
2022-04-22 11:39:41,950 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 11:39:41,950 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 179.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_8/transformer_best_model.pth
2022-04-22 11:40:39,929 reid_baseline.train INFO: normal accuracy 0.7527812113720643 1.7944345474243164 
2022-04-22 11:40:39,929 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:40:39,929 reid_baseline.train INFO: Accuracy: 75.3%
2022-04-22 11:41:08,059 reid_baseline.train INFO: normal accuracy 0.7527812113720643 1.7944345474243164 
2022-04-22 11:41:08,059 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:41:08,059 reid_baseline.train INFO: Shuffled Accuracy: 75.3%
2022-04-22 11:41:43,478 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7765057682991028 
2022-04-22 11:41:43,478 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 11:41:43,478 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 11:41:48,633 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_8
2022-04-22 11:41:48,634 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=8)
2022-04-22 11:41:48,634 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 11:41:48,634 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 11:41:48,635 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 11:41:56,303 reid_baseline.train INFO: start training
2022-04-22 11:42:27,669 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.040, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 11:42:49,919 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.969, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 11:43:06,162 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.252[s] Speed: 63.4[samples/s]
2022-04-22 11:43:42,070 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.16417932510376 
2022-04-22 11:44:11,982 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 11:44:11,982 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-22 11:44:35,887 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.560, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 11:44:57,606 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.388, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 11:45:15,143 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.231[s] Speed: 69.2[samples/s]
2022-04-22 11:45:51,366 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.968374252319336 
2022-04-22 11:46:21,350 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 11:46:21,350 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-22 11:46:46,018 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.643, Acc: 0.602, Base Lr: 2.46e-03
2022-04-22 11:47:08,909 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.490, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 11:47:25,457 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.234[s] Speed: 68.3[samples/s]
2022-04-22 11:48:01,135 reid_baseline.train INFO: normal accuracy 0.6451903581887812 3.2464258670806885 
2022-04-22 11:48:31,097 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 11:48:31,098 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.6%
2022-04-22 11:48:54,916 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.908, Acc: 0.684, Base Lr: 3.25e-03
2022-04-22 11:49:16,766 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.830, Acc: 0.710, Base Lr: 3.25e-03
2022-04-22 11:49:33,145 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-22 11:50:07,889 reid_baseline.train INFO: normal accuracy 0.7084929038071638 2.537496566772461 
2022-04-22 11:50:37,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 11:50:37,852 reid_baseline.train INFO: Accuracy: 70.8% Mean Entropy: 253.7%
2022-04-22 11:51:01,606 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.537, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 11:51:23,883 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.507, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 11:51:39,926 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.227[s] Speed: 70.4[samples/s]
2022-04-22 11:52:15,237 reid_baseline.train INFO: normal accuracy 0.7253886010362695 2.2067360877990723 
2022-04-22 11:52:45,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 11:52:45,256 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 220.7%
2022-04-22 11:53:08,871 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.368, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 11:53:31,764 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.360, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 11:53:48,041 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.230[s] Speed: 69.6[samples/s]
2022-04-22 11:54:26,562 reid_baseline.train INFO: normal accuracy 0.7375535030412255 1.9955213069915771 
2022-04-22 11:54:56,526 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 11:54:56,527 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 199.6%
2022-04-22 11:55:20,553 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.248, Acc: 0.825, Base Lr: 5.62e-03
2022-04-22 11:55:42,527 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.223, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 11:55:58,467 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-22 11:56:34,648 reid_baseline.train INFO: normal accuracy 0.7562514079747691 1.887711763381958 
2022-04-22 11:57:04,623 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 11:57:04,624 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 188.8%
2022-04-22 11:57:29,449 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.161, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 11:57:51,728 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.161, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 11:58:07,945 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.232[s] Speed: 69.1[samples/s]
2022-04-22 11:58:42,566 reid_baseline.train INFO: normal accuracy 0.7600810993466998 1.8224161863327026 
2022-04-22 11:59:12,543 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 11:59:12,543 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 182.2%
2022-04-22 11:59:36,412 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.096, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 11:59:58,277 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.106, Acc: 0.878, Base Lr: 7.21e-03
2022-04-22 12:00:14,716 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.228[s] Speed: 70.3[samples/s]
2022-04-22 12:00:49,326 reid_baseline.train INFO: normal accuracy 0.7618833070511376 1.7474952936172485 
2022-04-22 12:01:19,290 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 12:01:19,291 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 174.7%
2022-04-22 12:01:42,687 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.053, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 12:02:04,772 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.027, Acc: 0.904, Base Lr: 4.01e-03
2022-04-22 12:02:20,309 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.223[s] Speed: 71.6[samples/s]
2022-04-22 12:03:26,014 reid_baseline.train INFO: normal accuracy 0.765938274386123 1.7928876876831055 
2022-04-22 12:03:26,015 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 12:03:26,015 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 179.3%
2022-04-22 12:03:49,611 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.004, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 12:04:11,766 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.015, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 12:04:28,120 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-22 12:05:03,291 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.6999458074569702 
2022-04-22 12:05:33,274 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 12:05:33,274 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.0%
2022-04-22 12:05:57,753 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.020, Acc: 0.899, Base Lr: 2.77e-03
2022-04-22 12:06:20,034 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.984, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 12:06:36,308 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.231[s] Speed: 69.3[samples/s]
2022-04-22 12:07:10,993 reid_baseline.train INFO: normal accuracy 0.7693174138319442 1.6866298913955688 
2022-04-22 12:07:40,963 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 12:07:40,963 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 168.7%
2022-04-22 12:08:05,269 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.988, Acc: 0.913, Base Lr: 2.20e-03
2022-04-22 12:08:27,654 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.975, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 12:08:42,575 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-22 12:09:19,889 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.7572534084320068 
2022-04-22 12:09:19,889 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 12:09:19,890 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.7%
2022-04-22 12:09:43,868 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.977, Acc: 0.913, Base Lr: 1.66e-03
2022-04-22 12:10:06,044 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.959, Acc: 0.923, Base Lr: 1.66e-03
2022-04-22 12:10:22,618 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.230[s] Speed: 69.6[samples/s]
2022-04-22 12:10:58,770 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7242294549942017 
2022-04-22 12:10:58,770 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 12:10:58,771 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.4%
2022-04-22 12:11:22,113 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.925, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 12:11:44,265 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.934, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 12:12:00,641 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.227[s] Speed: 70.6[samples/s]
2022-04-22 12:12:36,335 reid_baseline.train INFO: normal accuracy 0.771119621536382 1.753685474395752 
2022-04-22 12:12:36,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 12:12:36,335 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 175.4%
2022-04-22 12:13:00,233 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.954, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 12:13:22,542 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.947, Acc: 0.930, Base Lr: 7.78e-04
2022-04-22 12:13:38,597 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.228[s] Speed: 70.2[samples/s]
2022-04-22 12:14:12,997 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.7083544731140137 
2022-04-22 12:14:12,997 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 12:14:12,998 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.8%
2022-04-22 12:14:37,109 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.938, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 12:14:58,875 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.938, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 12:15:15,672 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-22 12:15:50,383 reid_baseline.train INFO: normal accuracy 0.7776526244649696 1.7307820320129395 
2022-04-22 12:15:50,383 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 12:15:50,384 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 173.1%
2022-04-22 12:16:14,519 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.925, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 12:16:35,954 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.927, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 12:16:51,989 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.225[s] Speed: 71.1[samples/s]
2022-04-22 12:17:27,834 reid_baseline.train INFO: normal accuracy 0.7758504167605317 1.7131363153457642 
2022-04-22 12:17:27,834 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 12:17:27,835 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 171.3%
2022-04-22 12:17:51,491 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.901, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 12:18:13,539 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.924, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 12:18:29,753 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.226[s] Speed: 70.7[samples/s]
2022-04-22 12:19:05,590 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.6838843822479248 
2022-04-22 12:19:35,560 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 12:19:35,560 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.4%
2022-04-22 12:19:59,284 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.916, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 12:20:21,831 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.919, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 12:20:38,223 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-22 12:21:42,778 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6508184671401978 
2022-04-22 12:22:12,765 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 12:22:12,766 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_8/transformer_best_model.pth
2022-04-22 12:23:18,897 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6508184671401978 
2022-04-22 12:23:18,897 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 12:23:18,897 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-22 12:23:53,596 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6508184671401978 
2022-04-22 12:23:53,596 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 12:23:53,596 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-22 12:24:29,245 reid_baseline.train INFO: normal accuracy 0.9599083619702177 0.7763930559158325 
2022-04-22 12:24:29,245 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 12:24:29,245 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 12:24:34,553 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_8
2022-04-22 12:24:34,553 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=8)
2022-04-22 12:24:34,553 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 12:24:34,554 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 12:24:34,554 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 12:24:42,535 reid_baseline.train INFO: start training
2022-04-22 12:25:12,603 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.040, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 12:25:34,659 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.969, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 12:25:50,836 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.247[s] Speed: 64.7[samples/s]
2022-04-22 12:27:17,954 reid_baseline.train INFO: normal accuracy 0.5685104429653431 4.165801525115967 
2022-04-22 12:27:47,863 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 12:27:47,864 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 416.6%
2022-04-22 12:28:12,672 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.561, Acc: 0.550, Base Lr: 1.66e-03
2022-04-22 12:28:34,377 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.388, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 12:28:51,411 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.232[s] Speed: 68.9[samples/s]
2022-04-22 12:30:21,636 reid_baseline.train INFO: normal accuracy 0.602708285517558 3.995255470275879 
2022-04-22 12:30:51,607 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 12:30:51,608 reid_baseline.train INFO: Accuracy: 60.3% Mean Entropy: 399.5%
2022-04-22 12:31:15,452 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.643, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 12:31:37,923 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.490, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 12:31:54,228 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-22 12:33:25,747 reid_baseline.train INFO: normal accuracy 0.6750057378930456 3.3014602661132812 
2022-04-22 12:33:55,726 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 12:33:55,727 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 330.1%
2022-04-22 12:34:19,389 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.908, Acc: 0.684, Base Lr: 3.25e-03
2022-04-22 12:34:41,029 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.830, Acc: 0.710, Base Lr: 3.25e-03
2022-04-22 12:34:56,945 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.224[s] Speed: 71.4[samples/s]
2022-04-22 12:36:22,024 reid_baseline.train INFO: normal accuracy 0.7342207941243976 2.5876827239990234 
2022-04-22 12:36:52,007 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 12:36:52,007 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 258.8%
2022-04-22 12:37:15,657 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.537, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 12:37:37,599 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.507, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 12:37:53,610 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-22 12:39:23,228 reid_baseline.train INFO: normal accuracy 0.7599265549690154 2.266601800918579 
2022-04-22 12:39:53,226 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 12:39:53,226 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 226.7%
2022-04-22 12:40:16,720 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.368, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 12:40:39,439 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.360, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 12:40:55,961 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.230[s] Speed: 69.6[samples/s]
2022-04-22 12:42:32,960 reid_baseline.train INFO: normal accuracy 0.7771402341060363 2.0552759170532227 
2022-04-22 12:43:02,944 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 12:43:02,945 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 205.5%
2022-04-22 12:43:26,973 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.248, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 12:43:48,877 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.223, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 12:44:04,648 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-22 12:45:31,815 reid_baseline.train INFO: normal accuracy 0.7773697498278632 1.9482964277267456 
2022-04-22 12:46:01,795 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 12:46:01,796 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 194.8%
2022-04-22 12:46:26,497 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.161, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 12:46:48,786 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.161, Acc: 0.855, Base Lr: 6.42e-03
2022-04-22 12:47:04,844 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.231[s] Speed: 69.3[samples/s]
2022-04-22 12:48:31,237 reid_baseline.train INFO: normal accuracy 0.786779894422768 1.8342161178588867 
2022-04-22 12:49:01,199 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 12:49:01,199 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 183.4%
2022-04-22 12:49:45,537 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.096, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 12:50:28,135 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.106, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 12:50:59,693 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.433[s] Speed: 36.9[samples/s]
2022-04-22 12:52:29,731 reid_baseline.train INFO: normal accuracy 0.7842552214826716 1.7671005725860596 
2022-04-22 12:52:59,713 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 12:52:59,714 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 176.7%
2022-04-22 12:53:43,219 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.052, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 12:54:25,996 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.027, Acc: 0.904, Base Lr: 4.01e-03
2022-04-22 12:54:56,208 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.427[s] Speed: 37.5[samples/s]
2022-04-22 12:56:53,967 reid_baseline.train INFO: normal accuracy 0.7904521459719991 1.7946542501449585 
2022-04-22 12:56:53,969 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 12:56:53,969 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 179.5%
2022-04-22 12:57:37,799 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.003, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 12:58:20,942 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.015, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 12:58:52,690 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.435[s] Speed: 36.8[samples/s]
2022-04-22 13:00:25,816 reid_baseline.train INFO: normal accuracy 0.7920587560247877 1.7149320840835571 
2022-04-22 13:00:55,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 13:00:55,784 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 171.5%
2022-04-22 13:01:41,387 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.019, Acc: 0.900, Base Lr: 2.77e-03
2022-04-22 13:02:23,543 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.983, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 13:02:55,261 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.438[s] Speed: 36.6[samples/s]
2022-04-22 13:04:28,109 reid_baseline.train INFO: normal accuracy 0.790681661693826 1.6966356039047241 
2022-04-22 13:04:58,095 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 13:04:58,095 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 169.7%
2022-04-22 13:05:38,058 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.988, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 13:06:00,089 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.974, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 13:06:15,124 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.282[s] Speed: 56.7[samples/s]
2022-04-22 13:07:45,454 reid_baseline.train INFO: normal accuracy 0.7966490704613266 1.7694332599639893 
2022-04-22 13:07:45,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 13:07:45,455 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 176.9%
2022-04-22 13:08:08,973 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.977, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 13:08:30,534 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.959, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 13:08:47,113 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.225[s] Speed: 71.0[samples/s]
2022-04-22 13:10:15,613 reid_baseline.train INFO: normal accuracy 0.7932063346339224 1.730775237083435 
2022-04-22 13:10:15,615 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 13:10:15,615 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 173.1%
2022-04-22 13:11:00,122 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.925, Acc: 0.932, Base Lr: 1.19e-03
2022-04-22 13:11:42,906 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.934, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 13:12:14,023 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.434[s] Speed: 36.9[samples/s]
2022-04-22 13:13:44,681 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.7558834552764893 
2022-04-22 13:13:44,684 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 13:13:44,684 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 175.6%
2022-04-22 13:14:28,529 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.954, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 13:15:11,550 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.947, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 13:15:43,506 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.435[s] Speed: 36.8[samples/s]
2022-04-22 13:17:13,034 reid_baseline.train INFO: normal accuracy 0.7936653660775763 1.717957615852356 
2022-04-22 13:17:13,036 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 13:17:13,036 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 171.8%
2022-04-22 13:17:58,574 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.937, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 13:18:41,644 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.937, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 13:19:14,518 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.445[s] Speed: 36.0[samples/s]
2022-04-22 13:20:46,721 reid_baseline.train INFO: normal accuracy 0.7945834289648841 1.7410526275634766 
2022-04-22 13:20:46,723 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 13:20:46,724 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 174.1%
2022-04-22 13:21:31,987 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.924, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 13:22:14,626 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.927, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 13:22:45,431 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.434[s] Speed: 36.8[samples/s]
2022-04-22 13:24:16,166 reid_baseline.train INFO: normal accuracy 0.7952719761303649 1.725588321685791 
2022-04-22 13:24:16,169 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 13:24:16,169 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 172.6%
2022-04-22 13:25:00,378 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.901, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 13:25:44,237 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.924, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 13:26:15,956 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.439[s] Speed: 36.5[samples/s]
2022-04-22 13:27:47,474 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.6981847286224365 
2022-04-22 13:27:47,476 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 13:27:47,476 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 169.8%
2022-04-22 13:28:32,931 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.916, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 13:28:58,476 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.919, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 13:29:15,134 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-22 13:31:16,276 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6610912084579468 
2022-04-22 13:31:46,241 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 13:31:46,241 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 166.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_8/transformer_best_model.pth
2022-04-22 13:33:48,803 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6610912084579468 
2022-04-22 13:33:48,803 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 13:33:48,803 reid_baseline.train INFO: Accuracy: 79.7%
2022-04-22 13:35:19,291 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.6610912084579468 
2022-04-22 13:35:19,291 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 13:35:19,291 reid_baseline.train INFO: Shuffled Accuracy: 79.7%
2022-04-22 13:35:58,489 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7766056656837463 
2022-04-22 13:35:58,489 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 13:35:58,489 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 13:36:04,508 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_9
2022-04-22 13:36:04,508 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_9', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=9)
2022-04-22 13:36:04,509 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 13:36:04,509 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 13:36:04,509 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_9
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 13:36:14,140 reid_baseline.train INFO: start training
2022-04-22 13:36:46,079 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.024, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 13:37:08,729 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.970, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 13:37:25,177 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.258[s] Speed: 62.1[samples/s]
2022-04-22 13:37:53,292 reid_baseline.train INFO: normal accuracy 0.5092707045735476 4.166680812835693 
2022-04-22 13:38:23,234 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 13:38:23,234 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-22 13:38:48,655 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.559, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 13:39:11,164 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.365, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 13:39:28,736 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.240[s] Speed: 66.7[samples/s]
2022-04-22 13:39:58,355 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.029135704040527 
2022-04-22 13:40:28,314 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 13:40:28,314 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-22 13:40:53,518 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.620, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 13:41:16,635 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.454, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 13:41:33,390 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.238[s] Speed: 67.1[samples/s]
2022-04-22 13:42:01,854 reid_baseline.train INFO: normal accuracy 0.6254635352286774 3.461395263671875 
2022-04-22 13:42:31,816 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 13:42:31,816 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 346.1%
2022-04-22 13:42:56,305 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.893, Acc: 0.684, Base Lr: 3.25e-03
2022-04-22 13:43:18,665 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.798, Acc: 0.710, Base Lr: 3.25e-03
2022-04-22 13:43:35,151 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.232[s] Speed: 69.0[samples/s]
2022-04-22 13:44:04,148 reid_baseline.train INFO: normal accuracy 0.6839719818706221 2.813981771469116 
2022-04-22 13:44:34,121 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 13:44:34,122 reid_baseline.train INFO: Accuracy: 68.4% Mean Entropy: 281.4%
2022-04-22 13:44:58,738 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.522, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 13:45:21,132 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.497, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 13:45:37,444 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.231[s] Speed: 69.1[samples/s]
2022-04-22 13:46:05,625 reid_baseline.train INFO: normal accuracy 0.7062216728471363 2.51039719581604 
2022-04-22 13:46:35,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 13:46:35,586 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 251.0%
2022-04-22 13:46:59,778 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.353, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 13:47:23,226 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.337, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 13:47:42,439 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.245[s] Speed: 65.3[samples/s]
2022-04-22 13:48:12,566 reid_baseline.train INFO: normal accuracy 0.7214668314791924 2.2840001583099365 
2022-04-22 13:48:42,526 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 13:48:42,526 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 228.4%
2022-04-22 13:49:07,891 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.238, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 13:49:30,363 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.216, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 13:49:46,756 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.234[s] Speed: 68.2[samples/s]
2022-04-22 13:50:16,449 reid_baseline.train INFO: normal accuracy 0.7313555830243098 2.1590542793273926 
2022-04-22 13:50:46,427 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 13:50:46,428 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 215.9%
2022-04-22 13:51:11,848 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.148, Acc: 0.862, Base Lr: 6.42e-03
2022-04-22 13:51:34,216 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.147, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 13:51:50,907 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.236[s] Speed: 67.9[samples/s]
2022-04-22 13:52:19,325 reid_baseline.train INFO: normal accuracy 0.7441285537700866 2.012078285217285 
2022-04-22 13:52:49,297 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 13:52:49,297 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 201.2%
2022-04-22 13:53:13,680 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.122, Acc: 0.873, Base Lr: 7.21e-03
2022-04-22 13:53:35,860 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.099, Acc: 0.880, Base Lr: 7.21e-03
2022-04-22 13:53:52,224 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.230[s] Speed: 69.4[samples/s]
2022-04-22 13:54:21,466 reid_baseline.train INFO: normal accuracy 0.7362999587968686 1.9456838369369507 
2022-04-22 13:54:51,457 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 13:54:51,458 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 194.6%
2022-04-22 13:55:15,528 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.999, Acc: 0.895, Base Lr: 4.01e-03
2022-04-22 13:55:37,993 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.996, Acc: 0.905, Base Lr: 4.01e-03
2022-04-22 13:55:54,109 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.229[s] Speed: 69.7[samples/s]
2022-04-22 13:56:52,886 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.944513201713562 
2022-04-22 13:57:22,866 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 13:57:22,867 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 194.5%
2022-04-22 13:57:46,941 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.977, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 13:58:09,844 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.991, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 13:58:26,568 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.233[s] Speed: 68.6[samples/s]
2022-04-22 13:58:56,802 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.8587335348129272 
2022-04-22 13:59:26,787 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 13:59:26,788 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 185.9%
2022-04-22 13:59:51,628 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.005, Acc: 0.900, Base Lr: 2.77e-03
2022-04-22 14:00:15,066 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.981, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 14:00:31,728 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.238[s] Speed: 67.3[samples/s]
2022-04-22 14:01:00,326 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.8398139476776123 
2022-04-22 14:01:32,879 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 14:01:32,879 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 184.0%
2022-04-22 14:01:57,746 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.956, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 14:02:20,787 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.951, Acc: 0.920, Base Lr: 2.20e-03
2022-04-22 14:02:36,199 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.232[s] Speed: 69.1[samples/s]
2022-04-22 14:03:04,906 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.9037226438522339 
2022-04-22 14:03:04,906 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 14:03:04,907 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 190.4%
2022-04-22 14:03:28,816 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.954, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 14:03:50,599 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.943, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 14:04:06,999 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.227[s] Speed: 70.4[samples/s]
2022-04-22 14:04:35,410 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8682477474212646 
2022-04-22 14:04:35,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 14:04:35,411 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 186.8%
2022-04-22 14:04:59,115 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.919, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 14:05:21,184 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.935, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 14:05:37,577 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.228[s] Speed: 70.3[samples/s]
2022-04-22 14:06:07,155 reid_baseline.train INFO: normal accuracy 0.7515451174289246 1.8822507858276367 
2022-04-22 14:06:07,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 14:06:07,155 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 188.2%
2022-04-22 14:06:30,836 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.933, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 14:06:52,869 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.928, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 14:07:09,209 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-22 14:07:37,041 reid_baseline.train INFO: normal accuracy 0.7507210548001648 1.8507883548736572 
2022-04-22 14:07:37,042 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 14:07:37,042 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 185.1%
2022-04-22 14:08:02,077 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.931, Acc: 0.921, Base Lr: 4.51e-04
2022-04-22 14:08:24,067 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.934, Acc: 0.923, Base Lr: 4.51e-04
2022-04-22 14:08:40,843 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.234[s] Speed: 68.5[samples/s]
2022-04-22 14:09:08,231 reid_baseline.train INFO: normal accuracy 0.7503090234857849 1.870342493057251 
2022-04-22 14:09:08,231 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 14:09:08,232 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 187.0%
2022-04-22 14:09:32,323 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.887, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 14:09:54,080 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.891, Acc: 0.934, Base Lr: 2.11e-04
2022-04-22 14:10:10,029 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-22 14:10:39,340 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8453773260116577 
2022-04-22 14:10:39,341 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 14:10:39,341 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 184.5%
2022-04-22 14:11:03,205 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.905, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 14:11:25,375 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.923, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 14:11:41,666 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.228[s] Speed: 70.2[samples/s]
2022-04-22 14:12:09,660 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.8322396278381348 
2022-04-22 14:12:41,258 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 14:12:41,258 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.2%
2022-04-22 14:13:05,391 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.915, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 14:13:27,676 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.918, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 14:13:44,087 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.230[s] Speed: 69.6[samples/s]
2022-04-22 14:14:42,093 reid_baseline.train INFO: normal accuracy 0.7531932426864442 1.794390320777893 
2022-04-22 14:15:12,075 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 14:15:12,076 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 179.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_9/transformer_best_model.pth
2022-04-22 14:16:16,054 reid_baseline.train INFO: normal accuracy 0.7531932426864442 1.794390320777893 
2022-04-22 14:16:16,054 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 14:16:16,055 reid_baseline.train INFO: Accuracy: 75.3%
2022-04-22 14:16:43,844 reid_baseline.train INFO: normal accuracy 0.7531932426864442 1.794390320777893 
2022-04-22 14:16:43,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 14:16:43,845 reid_baseline.train INFO: Shuffled Accuracy: 75.3%
2022-04-22 14:17:19,636 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7765661478042603 
2022-04-22 14:17:19,636 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 14:17:19,637 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 14:17:24,904 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_9
2022-04-22 14:17:24,904 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_9', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=9)
2022-04-22 14:17:24,905 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 14:17:24,905 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 14:17:24,905 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_9
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 14:17:33,208 reid_baseline.train INFO: start training
2022-04-22 14:18:04,183 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.024, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 14:18:26,562 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.970, Acc: 0.377, Base Lr: 8.72e-04
2022-04-22 14:18:42,375 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.250[s] Speed: 64.1[samples/s]
2022-04-22 14:19:18,820 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.164180278778076 
2022-04-22 14:19:48,734 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 14:19:48,734 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-22 14:20:13,308 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.559, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 14:20:35,526 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.365, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 14:20:52,701 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.234[s] Speed: 68.3[samples/s]
2022-04-22 14:21:28,855 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.9683737754821777 
2022-04-22 14:21:58,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 14:21:58,843 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-22 14:22:23,867 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.620, Acc: 0.602, Base Lr: 2.46e-03
2022-04-22 14:22:46,202 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.454, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 14:23:03,075 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.234[s] Speed: 68.3[samples/s]
2022-04-22 14:23:39,753 reid_baseline.train INFO: normal accuracy 0.6449650822257265 3.2464447021484375 
2022-04-22 14:24:09,736 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 14:24:09,737 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.6%
2022-04-22 14:24:33,678 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.893, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 14:24:56,196 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.798, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 14:25:12,853 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.231[s] Speed: 69.2[samples/s]
2022-04-22 14:25:48,420 reid_baseline.train INFO: normal accuracy 0.7084929038071638 2.5374364852905273 
2022-04-22 14:26:18,403 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 14:26:18,403 reid_baseline.train INFO: Accuracy: 70.8% Mean Entropy: 253.7%
2022-04-22 14:26:42,730 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.522, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 14:27:05,172 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.496, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 14:27:21,686 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.232[s] Speed: 69.0[samples/s]
2022-04-22 14:27:57,259 reid_baseline.train INFO: normal accuracy 0.7253886010362695 2.206726312637329 
2022-04-22 14:28:27,239 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 14:28:27,239 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 220.7%
2022-04-22 14:28:51,450 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.353, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 14:29:14,101 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.337, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 14:29:30,444 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.231[s] Speed: 69.2[samples/s]
2022-04-22 14:30:08,918 reid_baseline.train INFO: normal accuracy 0.7384546068934444 1.9950746297836304 
2022-04-22 14:30:38,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 14:30:38,905 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 199.5%
2022-04-22 14:31:02,877 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.238, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 14:31:25,038 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.216, Acc: 0.836, Base Lr: 5.62e-03
2022-04-22 14:31:41,043 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.228[s] Speed: 70.3[samples/s]
2022-04-22 14:32:17,872 reid_baseline.train INFO: normal accuracy 0.7558008560486597 1.888728141784668 
2022-04-22 14:32:47,844 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 14:32:47,844 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 188.9%
2022-04-22 14:33:12,644 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.149, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 14:33:34,932 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.147, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 14:33:51,647 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.234[s] Speed: 68.5[samples/s]
2022-04-22 14:34:26,459 reid_baseline.train INFO: normal accuracy 0.7594052714575354 1.8223520517349243 
2022-04-22 14:34:56,460 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 14:34:56,460 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 182.2%
2022-04-22 14:35:20,365 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.122, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 14:35:42,485 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.099, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 14:35:59,019 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.229[s] Speed: 69.8[samples/s]
2022-04-22 14:36:33,857 reid_baseline.train INFO: normal accuracy 0.7609822031989186 1.7487808465957642 
2022-04-22 14:37:04,175 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 14:37:04,176 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 174.9%
2022-04-22 14:37:31,496 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.999, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 14:37:54,319 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.996, Acc: 0.904, Base Lr: 4.01e-03
2022-04-22 14:38:09,873 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.240[s] Speed: 66.6[samples/s]
2022-04-22 14:39:16,128 reid_baseline.train INFO: normal accuracy 0.765938274386123 1.7926678657531738 
2022-04-22 14:39:16,129 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 14:39:16,129 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 179.3%
2022-04-22 14:39:39,974 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.977, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 14:40:02,243 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.991, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 14:40:18,927 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.230[s] Speed: 69.6[samples/s]
2022-04-22 14:40:54,425 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.700022578239441 
2022-04-22 14:41:24,439 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 14:41:24,440 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.0%
2022-04-22 14:41:49,217 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.005, Acc: 0.899, Base Lr: 2.77e-03
2022-04-22 14:42:11,519 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.981, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 14:42:27,986 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.232[s] Speed: 68.9[samples/s]
2022-04-22 14:43:03,140 reid_baseline.train INFO: normal accuracy 0.7695426897949988 1.6854522228240967 
2022-04-22 14:43:33,133 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 14:43:33,134 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.5%
2022-04-22 14:43:57,369 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.956, Acc: 0.913, Base Lr: 2.20e-03
2022-04-22 14:44:19,562 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.951, Acc: 0.920, Base Lr: 2.20e-03
2022-04-22 14:44:34,913 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-22 14:45:12,475 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.7565398216247559 
2022-04-22 14:45:12,475 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 14:45:12,476 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.7%
2022-04-22 14:45:36,063 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.954, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 14:45:58,031 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.943, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 14:46:14,508 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-22 14:46:50,465 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.72431218624115 
2022-04-22 14:46:50,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 14:46:50,466 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.4%
2022-04-22 14:47:14,516 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.919, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 14:47:36,597 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.935, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 14:47:52,933 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-22 14:48:29,009 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7538617849349976 
2022-04-22 14:48:29,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 14:48:29,010 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 175.4%
2022-04-22 14:48:52,786 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.933, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 14:49:15,949 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.928, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 14:49:32,222 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.231[s] Speed: 69.3[samples/s]
2022-04-22 14:50:06,952 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7087788581848145 
2022-04-22 14:50:06,953 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 14:50:06,953 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.9%
2022-04-22 14:50:31,097 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.931, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 14:50:53,308 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.934, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 14:51:10,089 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.231[s] Speed: 69.4[samples/s]
2022-04-22 14:51:45,526 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.730798363685608 
2022-04-22 14:51:45,527 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 14:51:45,527 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 173.1%
2022-04-22 14:52:09,469 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.887, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 14:52:31,277 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.891, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 14:52:47,289 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.226[s] Speed: 70.7[samples/s]
2022-04-22 14:53:23,532 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.713255524635315 
2022-04-22 14:53:23,532 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 14:53:23,533 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 171.3%
2022-04-22 14:53:47,103 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.906, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 14:54:09,372 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.923, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 14:54:25,560 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.227[s] Speed: 70.4[samples/s]
2022-04-22 14:55:00,806 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.683995246887207 
2022-04-22 14:55:30,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 14:55:30,852 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.4%
2022-04-22 14:55:54,490 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.915, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 14:56:16,824 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.918, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 14:56:33,307 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-22 14:57:37,661 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6506950855255127 
2022-04-22 14:58:07,652 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 14:58:07,653 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_9/transformer_best_model.pth
2022-04-22 14:59:13,000 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6506950855255127 
2022-04-22 14:59:13,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 14:59:13,001 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-22 14:59:47,520 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6506950855255127 
2022-04-22 14:59:47,520 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 14:59:47,521 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-22 15:00:23,792 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7760733962059021 
2022-04-22 15:00:23,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 15:00:23,792 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 15:00:29,657 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_9
2022-04-22 15:00:29,658 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_9', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=9)
2022-04-22 15:00:29,658 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 15:00:29,658 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 15:00:29,658 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_9
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 15:00:39,161 reid_baseline.train INFO: start training
2022-04-22 15:01:12,050 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.024, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 15:01:33,957 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.970, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 15:01:49,886 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.255[s] Speed: 62.7[samples/s]
2022-04-22 15:03:17,954 reid_baseline.train INFO: normal accuracy 0.5685104429653431 4.165801525115967 
2022-04-22 15:03:47,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 15:03:47,899 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 416.6%
2022-04-22 15:04:12,570 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.558, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 15:04:34,377 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.365, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 15:04:51,603 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.233[s] Speed: 68.6[samples/s]
2022-04-22 15:06:22,984 reid_baseline.train INFO: normal accuracy 0.602478769795731 3.9952642917633057 
2022-04-22 15:06:52,980 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 15:06:52,980 reid_baseline.train INFO: Accuracy: 60.2% Mean Entropy: 399.5%
2022-04-22 15:07:17,437 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.620, Acc: 0.601, Base Lr: 2.46e-03
2022-04-22 15:07:40,259 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.454, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 15:07:56,431 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.232[s] Speed: 68.9[samples/s]
2022-04-22 15:09:26,773 reid_baseline.train INFO: normal accuracy 0.6750057378930456 3.3015084266662598 
2022-04-22 15:09:56,769 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 15:09:56,769 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 330.2%
2022-04-22 15:10:20,319 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.893, Acc: 0.684, Base Lr: 3.25e-03
2022-04-22 15:10:41,642 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.798, Acc: 0.710, Base Lr: 3.25e-03
2022-04-22 15:10:57,659 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.223[s] Speed: 71.8[samples/s]
2022-04-22 15:12:21,905 reid_baseline.train INFO: normal accuracy 0.7342207941243976 2.587606430053711 
2022-04-22 15:12:51,913 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 15:12:51,914 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 258.8%
2022-04-22 15:13:15,473 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.522, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 15:13:37,482 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.496, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 15:13:53,711 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-22 15:15:22,966 reid_baseline.train INFO: normal accuracy 0.7599265549690154 2.266718626022339 
2022-04-22 15:15:52,958 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 15:15:52,958 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 226.7%
2022-04-22 15:16:16,505 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.353, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 15:16:38,914 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.337, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 15:16:54,884 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.227[s] Speed: 70.6[samples/s]
2022-04-22 15:18:30,794 reid_baseline.train INFO: normal accuracy 0.7771402341060363 2.0555899143218994 
2022-04-22 15:19:00,795 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 15:19:00,796 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 205.6%
2022-04-22 15:19:24,752 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.238, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 15:19:46,679 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.216, Acc: 0.836, Base Lr: 5.62e-03
2022-04-22 15:20:02,508 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-22 15:21:29,527 reid_baseline.train INFO: normal accuracy 0.7780582969933441 1.9492738246917725 
2022-04-22 15:21:59,549 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 15:21:59,550 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 194.9%
2022-04-22 15:22:24,040 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.149, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 15:22:45,991 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.147, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 15:23:02,092 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-22 15:24:27,351 reid_baseline.train INFO: normal accuracy 0.786779894422768 1.8356034755706787 
2022-04-22 15:24:57,356 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 15:24:57,356 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 183.6%
2022-04-22 15:25:20,658 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.122, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 15:25:42,046 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.099, Acc: 0.879, Base Lr: 7.21e-03
2022-04-22 15:25:58,184 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.223[s] Speed: 71.8[samples/s]
2022-04-22 15:27:26,697 reid_baseline.train INFO: normal accuracy 0.7844847372044985 1.7680819034576416 
2022-04-22 15:27:57,344 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 15:27:57,344 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 176.8%
2022-04-22 15:28:20,977 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 2.999, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 15:28:42,770 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 2.996, Acc: 0.904, Base Lr: 4.01e-03
2022-04-22 15:28:58,448 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.223[s] Speed: 71.6[samples/s]
2022-04-22 15:30:55,201 reid_baseline.train INFO: normal accuracy 0.7913702088593069 1.7964154481887817 
2022-04-22 15:30:55,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 15:30:55,202 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 179.6%
2022-04-22 15:31:18,919 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.977, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 15:31:41,260 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.991, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 15:31:57,647 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.229[s] Speed: 70.0[samples/s]
2022-04-22 15:33:29,890 reid_baseline.train INFO: normal accuracy 0.7918292403029608 1.715630054473877 
2022-04-22 15:33:59,881 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 15:33:59,881 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 171.6%
2022-04-22 15:34:24,483 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.005, Acc: 0.898, Base Lr: 2.77e-03
2022-04-22 15:34:46,366 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.981, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 15:35:02,707 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.230[s] Speed: 69.7[samples/s]
2022-04-22 15:36:33,740 reid_baseline.train INFO: normal accuracy 0.7904521459719991 1.6963000297546387 
2022-04-22 15:37:03,755 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 15:37:03,756 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 169.6%
2022-04-22 15:37:27,677 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.956, Acc: 0.913, Base Lr: 2.20e-03
2022-04-22 15:37:49,947 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.951, Acc: 0.920, Base Lr: 2.20e-03
2022-04-22 15:38:05,058 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.225[s] Speed: 71.3[samples/s]
2022-04-22 15:39:37,839 reid_baseline.train INFO: normal accuracy 0.7966490704613266 1.7699002027511597 
2022-04-22 15:39:37,840 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 15:39:37,840 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 177.0%
2022-04-22 15:40:01,510 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.954, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 15:40:23,409 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.943, Acc: 0.925, Base Lr: 1.66e-03
2022-04-22 15:40:39,513 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-22 15:42:08,394 reid_baseline.train INFO: normal accuracy 0.7932063346339224 1.7314863204956055 
2022-04-22 15:42:08,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 15:42:08,395 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 173.1%
2022-04-22 15:42:31,772 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.919, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 15:42:53,813 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.935, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 15:43:10,031 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-22 15:44:40,275 reid_baseline.train INFO: normal accuracy 0.7911406931374799 1.7564157247543335 
2022-04-22 15:44:40,276 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 15:44:40,276 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 175.6%
2022-04-22 15:45:03,918 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.933, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 15:45:25,919 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.928, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 15:45:42,065 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-22 15:47:08,903 reid_baseline.train INFO: normal accuracy 0.7938948817994033 1.7184585332870483 
2022-04-22 15:47:08,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 15:47:08,904 reid_baseline.train INFO: Accuracy: 79.4% Mean Entropy: 171.8%
2022-04-22 15:47:32,954 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.931, Acc: 0.922, Base Lr: 4.51e-04
2022-04-22 15:47:54,685 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.934, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 15:48:11,198 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.228[s] Speed: 70.2[samples/s]
2022-04-22 15:49:42,129 reid_baseline.train INFO: normal accuracy 0.7945834289648841 1.7415114641189575 
2022-04-22 15:49:42,129 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 15:49:42,129 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 174.2%
2022-04-22 15:50:05,515 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.887, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 15:50:27,710 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.891, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 15:50:43,765 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.226[s] Speed: 70.9[samples/s]
2022-04-22 15:52:13,677 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.7255845069885254 
2022-04-22 15:52:13,678 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 15:52:13,678 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 172.6%
2022-04-22 15:52:39,143 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.906, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 15:53:01,274 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.924, Acc: 0.927, Base Lr: 6.51e-05
2022-04-22 15:53:18,174 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.236[s] Speed: 67.9[samples/s]
2022-04-22 15:54:47,636 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.698487401008606 
2022-04-22 15:54:47,636 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 15:54:47,637 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 169.8%
2022-04-22 15:55:11,450 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.916, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 15:55:34,200 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.918, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 15:55:50,534 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.230[s] Speed: 69.5[samples/s]
2022-04-22 15:57:54,834 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.660951852798462 
2022-04-22 15:58:26,332 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 15:58:26,333 reid_baseline.train INFO: Accuracy: 79.7% Mean Entropy: 166.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_9/transformer_best_model.pth
2022-04-22 16:00:27,576 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.660951852798462 
2022-04-22 16:00:27,576 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 16:00:27,576 reid_baseline.train INFO: Accuracy: 79.7%
2022-04-22 16:01:58,028 reid_baseline.train INFO: normal accuracy 0.7973376176268074 1.660951852798462 
2022-04-22 16:01:58,029 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 16:01:58,029 reid_baseline.train INFO: Shuffled Accuracy: 79.7%
2022-04-22 16:02:34,194 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7759503126144409 
2022-04-22 16:02:34,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 16:02:34,194 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 16:02:39,370 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_10
2022-04-22 16:02:39,370 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=10)
2022-04-22 16:02:39,370 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 16:02:39,370 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 16:02:39,370 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 16:02:47,137 reid_baseline.train INFO: start training
2022-04-22 16:03:17,320 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.108, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 16:03:39,629 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.034, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 16:03:55,756 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.248[s] Speed: 64.5[samples/s]
2022-04-22 16:04:24,000 reid_baseline.train INFO: normal accuracy 0.5092707045735476 4.166680335998535 
2022-04-22 16:04:53,925 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 16:04:53,925 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 416.7%
2022-04-22 16:05:18,669 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.620, Acc: 0.551, Base Lr: 1.66e-03
2022-04-22 16:05:41,154 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.454, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 16:05:58,982 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.238[s] Speed: 67.1[samples/s]
2022-04-22 16:06:28,142 reid_baseline.train INFO: normal accuracy 0.546353522867738 4.029130935668945 
2022-04-22 16:06:58,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 16:06:58,156 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 402.9%
2022-04-22 16:07:23,287 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.712, Acc: 0.602, Base Lr: 2.46e-03
2022-04-22 16:07:46,616 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.563, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 16:08:02,962 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.237[s] Speed: 67.4[samples/s]
2022-04-22 16:08:30,518 reid_baseline.train INFO: normal accuracy 0.6262875978574372 3.461406707763672 
2022-04-22 16:09:00,519 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 16:09:00,519 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 346.1%
2022-04-22 16:09:24,220 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.978, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 16:09:45,846 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.907, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 16:10:01,999 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.225[s] Speed: 71.1[samples/s]
2022-04-22 16:10:29,629 reid_baseline.train INFO: normal accuracy 0.6843840131850021 2.8139359951019287 
2022-04-22 16:10:59,618 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 16:10:59,619 reid_baseline.train INFO: Accuracy: 68.4% Mean Entropy: 281.4%
2022-04-22 16:11:22,992 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.667, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 16:11:44,917 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.629, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 16:12:01,135 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.225[s] Speed: 71.0[samples/s]
2022-04-22 16:12:28,053 reid_baseline.train INFO: normal accuracy 0.7070457354758962 2.510270833969116 
2022-04-22 16:12:58,050 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 16:12:58,050 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 251.0%
2022-04-22 16:13:21,542 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.470, Acc: 0.806, Base Lr: 4.83e-03
2022-04-22 16:13:43,859 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.465, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 16:13:59,948 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.226[s] Speed: 70.7[samples/s]
2022-04-22 16:14:27,916 reid_baseline.train INFO: normal accuracy 0.7218788627935723 2.2844932079315186 
2022-04-22 16:14:57,912 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 16:14:57,913 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 228.4%
2022-04-22 16:15:21,700 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.374, Acc: 0.824, Base Lr: 5.62e-03
2022-04-22 16:15:43,278 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.357, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 16:15:59,031 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.224[s] Speed: 71.5[samples/s]
2022-04-22 16:16:27,189 reid_baseline.train INFO: normal accuracy 0.7321796456530696 2.15906023979187 
2022-04-22 16:16:57,218 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 16:16:57,219 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 215.9%
2022-04-22 16:17:21,579 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.275, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 16:17:43,380 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.280, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 16:17:59,572 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-22 16:18:26,365 reid_baseline.train INFO: normal accuracy 0.7441285537700866 2.01202130317688 
2022-04-22 16:18:56,366 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 16:18:56,367 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 201.2%
2022-04-22 16:19:19,819 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.254, Acc: 0.873, Base Lr: 7.21e-03
2022-04-22 16:19:41,435 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.248, Acc: 0.880, Base Lr: 7.21e-03
2022-04-22 16:19:57,589 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.224[s] Speed: 71.4[samples/s]
2022-04-22 16:20:24,902 reid_baseline.train INFO: normal accuracy 0.7354758961681088 1.946999430656433 
2022-04-22 16:20:54,896 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 16:20:54,896 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 194.7%
2022-04-22 16:21:18,196 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.150, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 16:21:39,969 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.143, Acc: 0.905, Base Lr: 4.01e-03
2022-04-22 16:21:55,597 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.222[s] Speed: 72.0[samples/s]
2022-04-22 16:22:53,131 reid_baseline.train INFO: normal accuracy 0.7428924598269468 1.944061040878296 
2022-04-22 16:23:23,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 16:23:23,142 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 194.4%
2022-04-22 16:23:46,278 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.102, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 16:24:08,134 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.131, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 16:24:24,160 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.224[s] Speed: 71.6[samples/s]
2022-04-22 16:24:51,786 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.8590832948684692 
2022-04-22 16:25:21,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 16:25:21,783 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 185.9%
2022-04-22 16:25:45,976 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.144, Acc: 0.900, Base Lr: 2.77e-03
2022-04-22 16:26:07,788 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.102, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 16:26:23,957 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.228[s] Speed: 70.3[samples/s]
2022-04-22 16:26:51,010 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8393279314041138 
2022-04-22 16:27:20,994 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 16:27:20,995 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.9%
2022-04-22 16:27:44,738 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.131, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 16:28:06,652 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.113, Acc: 0.920, Base Lr: 2.20e-03
2022-04-22 16:28:21,580 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.222[s] Speed: 72.1[samples/s]
2022-04-22 16:28:49,638 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.9038987159729004 
2022-04-22 16:28:49,638 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 16:28:49,638 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 190.4%
2022-04-22 16:29:12,939 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.101, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 16:29:34,531 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.091, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 16:29:50,549 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.222[s] Speed: 71.9[samples/s]
2022-04-22 16:30:18,733 reid_baseline.train INFO: normal accuracy 0.7482488669138855 1.8683946132659912 
2022-04-22 16:30:18,733 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 16:30:18,734 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 186.8%
2022-04-22 16:30:42,094 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.053, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 16:31:03,813 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.067, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 16:31:19,783 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.224[s] Speed: 71.6[samples/s]
2022-04-22 16:31:49,009 reid_baseline.train INFO: normal accuracy 0.7515451174289246 1.8820465803146362 
2022-04-22 16:31:49,009 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 16:31:49,009 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 188.2%
2022-04-22 16:32:12,993 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.045, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 16:32:37,076 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.070, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 16:32:53,185 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.235[s] Speed: 68.1[samples/s]
2022-04-22 16:33:20,064 reid_baseline.train INFO: normal accuracy 0.7507210548001648 1.8509507179260254 
2022-04-22 16:33:20,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 16:33:20,065 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 185.1%
2022-04-22 16:33:43,901 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.052, Acc: 0.923, Base Lr: 4.51e-04
2022-04-22 16:34:05,749 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.052, Acc: 0.924, Base Lr: 4.51e-04
2022-04-22 16:34:22,408 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.228[s] Speed: 70.1[samples/s]
2022-04-22 16:34:49,401 reid_baseline.train INFO: normal accuracy 0.7494849608570251 1.870902419090271 
2022-04-22 16:34:49,402 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 16:34:49,402 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 187.1%
2022-04-22 16:35:12,738 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.053, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 16:35:34,048 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.062, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 16:35:49,723 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.221[s] Speed: 72.4[samples/s]
2022-04-22 16:36:18,333 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.8457496166229248 
2022-04-22 16:36:18,333 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 16:36:18,333 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 184.6%
2022-04-22 16:36:41,469 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.058, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 16:37:03,408 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.049, Acc: 0.926, Base Lr: 6.51e-05
2022-04-22 16:37:19,384 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.224[s] Speed: 71.6[samples/s]
2022-04-22 16:37:46,737 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8326202630996704 
2022-04-22 16:38:16,727 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 16:38:16,727 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 183.3%
2022-04-22 16:38:40,337 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.036, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 16:39:02,594 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.041, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 16:39:18,804 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-22 16:40:16,379 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.794450283050537 
2022-04-22 16:40:46,387 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 16:40:46,388 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 179.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_10/transformer_best_model.pth
2022-04-22 16:41:43,593 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.794450283050537 
2022-04-22 16:41:43,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 16:41:43,594 reid_baseline.train INFO: Accuracy: 75.2%
2022-04-22 16:42:10,825 reid_baseline.train INFO: normal accuracy 0.7523691800576844 1.794450283050537 
2022-04-22 16:42:10,825 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 16:42:10,825 reid_baseline.train INFO: Shuffled Accuracy: 75.2%
2022-04-22 16:42:45,544 reid_baseline.train INFO: normal accuracy 0.9596792668957618 0.7764171957969666 
2022-04-22 16:42:45,559 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 16:42:45,559 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-22 16:42:50,956 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_10
2022-04-22 16:42:50,956 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=10)
2022-04-22 16:42:50,956 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 16:42:50,956 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 16:42:50,957 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 16:42:58,158 reid_baseline.train INFO: start training
2022-04-22 16:43:27,712 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.108, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 16:43:49,519 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.034, Acc: 0.376, Base Lr: 8.72e-04
2022-04-22 16:44:05,325 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.243[s] Speed: 65.9[samples/s]
2022-04-22 16:44:41,418 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.16417932510376 
2022-04-22 16:45:11,363 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 16:45:11,364 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 416.4%
2022-04-22 16:45:36,636 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.620, Acc: 0.550, Base Lr: 1.66e-03
2022-04-22 16:45:58,379 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.454, Acc: 0.555, Base Lr: 1.66e-03
2022-04-22 16:46:15,415 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.235[s] Speed: 68.2[samples/s]
2022-04-22 16:46:51,062 reid_baseline.train INFO: normal accuracy 0.5733273259743186 3.968384265899658 
2022-04-22 16:47:21,055 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 16:47:21,056 reid_baseline.train INFO: Accuracy: 57.3% Mean Entropy: 396.8%
2022-04-22 16:47:45,407 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.712, Acc: 0.602, Base Lr: 2.46e-03
2022-04-22 16:48:08,894 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.563, Acc: 0.610, Base Lr: 2.46e-03
2022-04-22 16:48:25,589 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.236[s] Speed: 67.7[samples/s]
2022-04-22 16:49:01,843 reid_baseline.train INFO: normal accuracy 0.6451903581887812 3.246452808380127 
2022-04-22 16:49:31,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 16:49:31,849 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.6%
2022-04-22 16:49:55,727 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 3.978, Acc: 0.683, Base Lr: 3.25e-03
2022-04-22 16:50:17,484 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 3.907, Acc: 0.709, Base Lr: 3.25e-03
2022-04-22 16:50:34,324 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.229[s] Speed: 69.9[samples/s]
2022-04-22 16:51:09,798 reid_baseline.train INFO: normal accuracy 0.7087181797702186 2.5374979972839355 
2022-04-22 16:51:39,810 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 16:51:39,811 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 253.7%
2022-04-22 16:52:03,150 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.667, Acc: 0.773, Base Lr: 4.04e-03
2022-04-22 16:52:25,175 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.629, Acc: 0.765, Base Lr: 4.04e-03
2022-04-22 16:52:42,766 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.231[s] Speed: 69.4[samples/s]
2022-04-22 16:53:18,741 reid_baseline.train INFO: normal accuracy 0.7251633250732147 2.206576347351074 
2022-04-22 16:53:48,738 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 16:53:48,739 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 220.7%
2022-04-22 16:54:14,429 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.470, Acc: 0.805, Base Lr: 4.83e-03
2022-04-22 16:54:37,413 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.465, Acc: 0.800, Base Lr: 4.83e-03
2022-04-22 16:54:58,797 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.257[s] Speed: 62.4[samples/s]
2022-04-22 16:55:49,397 reid_baseline.train INFO: normal accuracy 0.7384546068934444 1.9952234029769897 
2022-04-22 16:56:19,417 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 16:56:19,417 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 199.5%
2022-04-22 16:56:44,448 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.374, Acc: 0.825, Base Lr: 5.62e-03
2022-04-22 16:57:18,981 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.357, Acc: 0.837, Base Lr: 5.62e-03
2022-04-22 16:57:45,033 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.313[s] Speed: 51.0[samples/s]
2022-04-22 16:58:25,987 reid_baseline.train INFO: normal accuracy 0.7558008560486597 1.887793779373169 
2022-04-22 16:58:56,019 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 16:58:56,020 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 188.8%
2022-04-22 16:59:20,748 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.275, Acc: 0.861, Base Lr: 6.42e-03
2022-04-22 16:59:42,587 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.280, Acc: 0.856, Base Lr: 6.42e-03
2022-04-22 16:59:58,733 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.230[s] Speed: 69.7[samples/s]
2022-04-22 17:00:34,096 reid_baseline.train INFO: normal accuracy 0.758954719531426 1.8217233419418335 
2022-04-22 17:01:04,101 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 17:01:04,101 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 182.2%
2022-04-22 17:01:34,726 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.254, Acc: 0.872, Base Lr: 7.21e-03
2022-04-22 17:02:11,484 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.248, Acc: 0.880, Base Lr: 7.21e-03
2022-04-22 17:02:35,073 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.333[s] Speed: 48.0[samples/s]
2022-04-22 17:03:18,361 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.7490497827529907 
2022-04-22 17:03:48,362 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 17:03:48,363 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 174.9%
2022-04-22 17:04:27,625 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.150, Acc: 0.894, Base Lr: 4.01e-03
2022-04-22 17:05:00,606 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.142, Acc: 0.904, Base Lr: 4.01e-03
2022-04-22 17:05:25,595 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.356[s] Speed: 44.9[samples/s]
2022-04-22 17:06:39,805 reid_baseline.train INFO: normal accuracy 0.7661635503491777 1.7925195693969727 
2022-04-22 17:06:39,808 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 17:06:39,808 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 179.3%
2022-04-22 17:07:18,194 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.102, Acc: 0.915, Base Lr: 3.38e-03
2022-04-22 17:07:54,253 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.131, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 17:08:23,081 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.378[s] Speed: 42.3[samples/s]
2022-04-22 17:09:15,386 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.699922800064087 
2022-04-22 17:09:45,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 17:09:45,412 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.0%
2022-04-22 17:10:26,191 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.143, Acc: 0.900, Base Lr: 2.77e-03
2022-04-22 17:11:04,545 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.102, Acc: 0.912, Base Lr: 2.77e-03
2022-04-22 17:11:34,318 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.399[s] Speed: 40.1[samples/s]
2022-04-22 17:12:26,288 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.6849453449249268 
2022-04-22 17:12:56,292 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 17:12:56,293 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.5%
2022-04-22 17:13:36,591 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.130, Acc: 0.914, Base Lr: 2.20e-03
2022-04-22 17:14:12,961 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.113, Acc: 0.921, Base Lr: 2.20e-03
2022-04-22 17:14:39,517 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.378[s] Speed: 42.3[samples/s]
2022-04-22 17:15:37,219 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.7562577724456787 
2022-04-22 17:15:37,221 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 17:15:37,222 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.6%
2022-04-22 17:16:18,679 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.101, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 17:16:56,553 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.090, Acc: 0.924, Base Lr: 1.66e-03
2022-04-22 17:17:23,226 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.388[s] Speed: 41.2[samples/s]
2022-04-22 17:18:15,946 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.7241123914718628 
2022-04-22 17:18:15,947 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 17:18:15,947 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.4%
2022-04-22 17:19:02,117 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.053, Acc: 0.933, Base Lr: 1.19e-03
2022-04-22 17:19:38,634 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.066, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 17:20:08,031 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.411[s] Speed: 39.0[samples/s]
2022-04-22 17:21:00,556 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7535027265548706 
2022-04-22 17:21:00,557 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 17:21:00,557 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 175.4%
2022-04-22 17:21:47,975 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.045, Acc: 0.932, Base Lr: 7.78e-04
2022-04-22 17:22:28,377 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.070, Acc: 0.929, Base Lr: 7.78e-04
2022-04-22 17:22:56,293 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.424[s] Speed: 37.7[samples/s]
2022-04-22 17:23:47,436 reid_baseline.train INFO: normal accuracy 0.7735976571299842 1.7087507247924805 
2022-04-22 17:23:47,437 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 17:23:47,437 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.9%
2022-04-22 17:24:29,439 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.051, Acc: 0.923, Base Lr: 4.51e-04
2022-04-22 17:25:13,064 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.051, Acc: 0.925, Base Lr: 4.51e-04
2022-04-22 17:25:41,247 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.417[s] Speed: 38.4[samples/s]
2022-04-22 17:26:35,087 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.7307379245758057 
2022-04-22 17:26:35,088 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 17:26:35,088 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 173.1%
2022-04-22 17:27:14,096 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.053, Acc: 0.937, Base Lr: 2.11e-04
2022-04-22 17:27:56,430 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.061, Acc: 0.935, Base Lr: 2.11e-04
2022-04-22 17:28:25,384 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.404[s] Speed: 39.6[samples/s]
2022-04-22 17:29:19,322 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.7134095430374146 
2022-04-22 17:29:19,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 17:29:19,323 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 171.3%
2022-04-22 17:29:58,335 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.058, Acc: 0.934, Base Lr: 6.51e-05
2022-04-22 17:30:39,209 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.048, Acc: 0.926, Base Lr: 6.51e-05
2022-04-22 17:31:12,634 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.415[s] Speed: 38.5[samples/s]
2022-04-22 17:32:08,279 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.684264063835144 
2022-04-22 17:32:38,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 17:32:38,279 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 168.4%
2022-04-22 17:33:19,832 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.035, Acc: 0.939, Base Lr: 1.60e-05
2022-04-22 17:34:05,459 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.041, Acc: 0.936, Base Lr: 1.60e-05
2022-04-22 17:34:37,653 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.437[s] Speed: 36.6[samples/s]
2022-04-22 17:36:03,409 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6510283946990967 
2022-04-22 17:36:33,420 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 17:36:33,421 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 165.1%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_10/transformer_best_model.pth
2022-04-22 17:37:59,867 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6510283946990967 
2022-04-22 17:37:59,868 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 17:37:59,868 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-22 17:38:54,989 reid_baseline.train INFO: normal accuracy 0.7774273485019149 1.6510283946990967 
2022-04-22 17:38:54,990 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 17:38:54,991 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-22 17:39:51,026 reid_baseline.train INFO: normal accuracy 0.9594501718213059 0.7765536904335022 
2022-04-22 17:39:51,026 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 17:39:51,027 reid_baseline.train INFO: Source Clean Accuracy: 95.9%
2022-04-22 17:39:58,962 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_10
2022-04-22 17:39:58,962 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=10)
2022-04-22 17:39:58,962 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 17:39:58,962 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 17:39:58,963 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 17:40:11,706 reid_baseline.train INFO: start training
2022-04-22 17:41:07,916 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.111, Acc: 0.167, Base Lr: 8.72e-04
2022-04-22 17:41:47,906 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.057, Acc: 0.285, Base Lr: 8.72e-04
2022-04-22 17:42:18,002 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.459[s] Speed: 34.9[samples/s]
2022-04-22 17:44:43,185 reid_baseline.train INFO: normal accuracy 0.5338535689694744 4.171948432922363 
2022-04-22 17:45:13,113 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 17:45:13,113 reid_baseline.train INFO: Accuracy: 53.4% Mean Entropy: 417.2%
2022-04-22 17:45:58,798 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.810, Acc: 0.514, Base Lr: 1.66e-03
2022-04-22 17:46:41,599 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.734, Acc: 0.523, Base Lr: 1.66e-03
2022-04-22 17:47:17,470 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.456[s] Speed: 35.1[samples/s]
2022-04-22 17:49:43,517 reid_baseline.train INFO: normal accuracy 0.5579527197613037 4.151760101318359 
2022-04-22 17:50:13,515 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 17:50:13,516 reid_baseline.train INFO: Accuracy: 55.8% Mean Entropy: 415.2%
2022-04-22 17:51:00,409 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 5.306, Acc: 0.565, Base Lr: 2.46e-03
2022-04-22 17:51:37,273 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 5.161, Acc: 0.566, Base Lr: 2.46e-03
2022-04-22 17:52:05,210 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.409[s] Speed: 39.1[samples/s]
2022-04-22 17:54:22,785 reid_baseline.train INFO: normal accuracy 0.5912324994262107 3.939138889312744 
2022-04-22 17:54:52,781 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 17:54:52,782 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 393.9%
2022-04-22 17:55:30,572 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.487, Acc: 0.589, Base Lr: 3.25e-03
2022-04-22 17:56:11,180 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.340, Acc: 0.617, Base Lr: 3.25e-03
2022-04-22 17:56:43,538 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.406[s] Speed: 39.4[samples/s]
2022-04-22 17:58:47,319 reid_baseline.train INFO: normal accuracy 0.6614643103052559 3.2916858196258545 
2022-04-22 17:59:17,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 17:59:17,343 reid_baseline.train INFO: Accuracy: 66.1% Mean Entropy: 329.2%
2022-04-22 18:00:02,645 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.877, Acc: 0.688, Base Lr: 4.04e-03
2022-04-22 18:00:41,756 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.805, Acc: 0.691, Base Lr: 4.04e-03
2022-04-22 18:01:10,957 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.416[s] Speed: 38.5[samples/s]
2022-04-22 18:03:17,997 reid_baseline.train INFO: normal accuracy 0.7147119577691072 2.746891975402832 
2022-04-22 18:03:47,994 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 18:03:47,995 reid_baseline.train INFO: Accuracy: 71.5% Mean Entropy: 274.7%
2022-04-22 18:04:30,117 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.506, Acc: 0.755, Base Lr: 4.83e-03
2022-04-22 18:05:04,915 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.494, Acc: 0.755, Base Lr: 4.83e-03
2022-04-22 18:05:30,177 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.374[s] Speed: 42.7[samples/s]
2022-04-22 18:07:54,337 reid_baseline.train INFO: normal accuracy 0.7438604544411292 2.390143632888794 
2022-04-22 18:08:24,360 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 18:08:24,361 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 239.0%
2022-04-22 18:09:04,415 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.352, Acc: 0.780, Base Lr: 5.62e-03
2022-04-22 18:09:42,983 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.319, Acc: 0.795, Base Lr: 5.62e-03
2022-04-22 18:10:13,614 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.400[s] Speed: 40.0[samples/s]
2022-04-22 18:12:26,095 reid_baseline.train INFO: normal accuracy 0.7606151021344962 2.1781275272369385 
2022-04-22 18:12:56,096 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 18:12:56,096 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 217.8%
2022-04-22 18:13:44,263 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.213, Acc: 0.821, Base Lr: 6.42e-03
2022-04-22 18:14:24,023 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.201, Acc: 0.821, Base Lr: 6.42e-03
2022-04-22 18:14:52,280 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.426[s] Speed: 37.6[samples/s]
2022-04-22 18:16:57,530 reid_baseline.train INFO: normal accuracy 0.765893963736516 2.043928623199463 
2022-04-22 18:17:27,519 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 18:17:27,519 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 204.4%
2022-04-22 18:18:06,959 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.124, Acc: 0.838, Base Lr: 7.21e-03
2022-04-22 18:18:43,940 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.104, Acc: 0.839, Base Lr: 7.21e-03
2022-04-22 18:19:11,135 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.380[s] Speed: 42.2[samples/s]
2022-04-22 18:21:19,431 reid_baseline.train INFO: normal accuracy 0.7815010328207482 1.9341881275177002 
2022-04-22 18:21:49,409 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 18:21:49,410 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 193.4%
2022-04-22 18:22:32,088 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.019, Acc: 0.863, Base Lr: 4.01e-03
2022-04-22 18:23:13,831 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.002, Acc: 0.871, Base Lr: 4.01e-03
2022-04-22 18:23:39,282 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.402[s] Speed: 39.8[samples/s]
2022-04-22 18:26:21,373 reid_baseline.train INFO: normal accuracy 0.782419095708056 1.878978967666626 
2022-04-22 18:26:51,359 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 18:26:51,360 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 187.9%
2022-04-22 18:27:31,062 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.976, Acc: 0.885, Base Lr: 3.38e-03
2022-04-22 18:28:05,771 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.998, Acc: 0.877, Base Lr: 3.38e-03
2022-04-22 18:28:37,232 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.388[s] Speed: 41.3[samples/s]
2022-04-22 18:30:56,957 reid_baseline.train INFO: normal accuracy 0.7863208629791141 1.8469830751419067 
2022-04-22 18:31:26,968 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 18:31:27,139 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 184.7%
2022-04-22 18:32:14,288 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.018, Acc: 0.861, Base Lr: 2.77e-03
2022-04-22 18:32:52,494 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.964, Acc: 0.883, Base Lr: 2.77e-03
2022-04-22 18:33:20,777 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.416[s] Speed: 38.5[samples/s]
2022-04-22 18:35:33,276 reid_baseline.train INFO: normal accuracy 0.7812715170989213 1.828758716583252 
2022-04-22 18:36:03,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 18:36:03,289 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 182.9%
2022-04-22 18:36:44,114 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.972, Acc: 0.881, Base Lr: 2.20e-03
2022-04-22 18:37:19,565 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.957, Acc: 0.886, Base Lr: 2.20e-03
2022-04-22 18:37:49,152 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.388[s] Speed: 41.3[samples/s]
2022-04-22 18:40:05,683 reid_baseline.train INFO: normal accuracy 0.7835666743171907 1.8891949653625488 
2022-04-22 18:40:05,685 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 18:40:05,687 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 188.9%
2022-04-22 18:40:48,787 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.942, Acc: 0.882, Base Lr: 1.66e-03
2022-04-22 18:41:30,945 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.917, Acc: 0.892, Base Lr: 1.66e-03
2022-04-22 18:41:58,518 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.413[s] Speed: 38.7[samples/s]
2022-04-22 18:44:03,704 reid_baseline.train INFO: normal accuracy 0.7847142529263255 1.8649722337722778 
2022-04-22 18:44:03,705 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 18:44:03,705 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 186.5%
2022-04-22 18:44:49,106 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.911, Acc: 0.902, Base Lr: 1.19e-03
2022-04-22 18:45:26,646 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.928, Acc: 0.901, Base Lr: 1.19e-03
2022-04-22 18:45:53,626 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.402[s] Speed: 39.8[samples/s]
2022-04-22 18:48:04,823 reid_baseline.train INFO: normal accuracy 0.782648611429883 1.8576579093933105 
2022-04-22 18:48:04,824 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 18:48:04,824 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 185.8%
2022-04-22 18:48:43,863 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.918, Acc: 0.902, Base Lr: 7.78e-04
2022-04-22 18:49:22,882 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.919, Acc: 0.898, Base Lr: 7.78e-04
2022-04-22 18:49:52,613 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.395[s] Speed: 40.5[samples/s]
2022-04-22 18:52:19,714 reid_baseline.train INFO: normal accuracy 0.7870094101445949 1.8353874683380127 
2022-04-22 18:52:19,714 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 18:52:19,714 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 183.5%
2022-04-22 18:52:57,884 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.912, Acc: 0.901, Base Lr: 4.51e-04
2022-04-22 18:53:39,617 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.891, Acc: 0.903, Base Lr: 4.51e-04
2022-04-22 18:54:09,721 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.402[s] Speed: 39.8[samples/s]
2022-04-22 18:56:21,550 reid_baseline.train INFO: normal accuracy 0.7849437686481524 1.8293869495391846 
2022-04-22 18:56:21,551 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 18:56:21,551 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 182.9%
2022-04-22 18:57:07,505 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.883, Acc: 0.912, Base Lr: 2.11e-04
2022-04-22 18:57:44,095 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.877, Acc: 0.907, Base Lr: 2.11e-04
2022-04-22 18:58:11,856 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.403[s] Speed: 39.7[samples/s]
2022-04-22 19:00:24,768 reid_baseline.train INFO: normal accuracy 0.7856323158136332 1.8405295610427856 
2022-04-22 19:00:24,769 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 19:00:24,769 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 184.1%
2022-04-22 19:01:03,328 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.870, Acc: 0.906, Base Lr: 6.51e-05
2022-04-22 19:01:38,409 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.868, Acc: 0.901, Base Lr: 6.51e-05
2022-04-22 19:02:05,304 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.368[s] Speed: 43.5[samples/s]
2022-04-22 19:04:19,028 reid_baseline.train INFO: normal accuracy 0.7856323158136332 1.8070542812347412 
2022-04-22 19:04:49,063 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 19:04:49,064 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 180.7%
2022-04-22 19:05:29,888 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.863, Acc: 0.911, Base Lr: 1.60e-05
2022-04-22 19:06:14,547 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.874, Acc: 0.907, Base Lr: 1.60e-05
2022-04-22 19:06:43,829 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.420[s] Speed: 38.1[samples/s]
2022-04-22 19:09:24,672 reid_baseline.train INFO: normal accuracy 0.786779894422768 1.7727630138397217 
2022-04-22 19:09:54,689 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 19:09:54,690 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 177.3%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_10/transformer_best_model.pth
2022-04-22 19:12:32,778 reid_baseline.train INFO: normal accuracy 0.786779894422768 1.7727630138397217 
2022-04-22 19:12:32,780 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 19:12:32,780 reid_baseline.train INFO: Accuracy: 78.7%
2022-04-22 19:14:46,632 reid_baseline.train INFO: normal accuracy 0.786779894422768 1.7727630138397217 
2022-04-22 19:14:46,633 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 19:14:46,633 reid_baseline.train INFO: Shuffled Accuracy: 78.7%
2022-04-22 19:15:39,838 reid_baseline.train INFO: normal accuracy 0.938602520045819 0.8882536888122559 
2022-04-22 19:15:39,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 19:15:39,839 reid_baseline.train INFO: Source Clean Accuracy: 93.9%
2022-04-22 19:15:48,025 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_12
2022-04-22 19:15:48,025 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-22 19:15:48,025 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 19:15:48,026 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 19:15:48,026 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 19:15:58,296 reid_baseline.train INFO: start training
2022-04-22 19:16:41,681 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.040, Acc: 0.159, Base Lr: 8.72e-04
2022-04-22 19:17:18,586 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.001, Acc: 0.284, Base Lr: 8.72e-04
2022-04-22 19:17:44,879 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.387[s] Speed: 41.4[samples/s]
2022-04-22 19:18:24,904 reid_baseline.train INFO: normal accuracy 0.4610630407911001 4.172257900238037 
2022-04-22 19:18:54,841 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 19:18:54,842 reid_baseline.train INFO: Accuracy: 46.1% Mean Entropy: 417.2%
2022-04-22 19:19:34,899 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.811, Acc: 0.519, Base Lr: 1.66e-03
2022-04-22 19:20:17,384 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.727, Acc: 0.528, Base Lr: 1.66e-03
2022-04-22 19:20:45,875 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.407[s] Speed: 39.3[samples/s]
2022-04-22 19:21:28,005 reid_baseline.train INFO: normal accuracy 0.5051503914297487 4.159175872802734 
2022-04-22 19:21:57,984 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 19:21:57,984 reid_baseline.train INFO: Accuracy: 50.5% Mean Entropy: 415.9%
2022-04-22 19:22:36,527 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 5.362, Acc: 0.575, Base Lr: 2.46e-03
2022-04-22 19:23:13,040 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 5.251, Acc: 0.567, Base Lr: 2.46e-03
2022-04-22 19:23:38,627 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-04-22 19:24:21,171 reid_baseline.train INFO: normal accuracy 0.5368768026370004 4.042422294616699 
2022-04-22 19:24:51,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 19:24:51,178 reid_baseline.train INFO: Accuracy: 53.7% Mean Entropy: 404.2%
2022-04-22 19:25:29,161 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.648, Acc: 0.589, Base Lr: 3.25e-03
2022-04-22 19:26:12,454 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.487, Acc: 0.607, Base Lr: 3.25e-03
2022-04-22 19:26:38,628 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.393[s] Speed: 40.7[samples/s]
2022-04-22 19:27:18,016 reid_baseline.train INFO: normal accuracy 0.604037906880923 3.53950834274292 
2022-04-22 19:27:48,049 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 19:27:48,049 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 354.0%
2022-04-22 19:28:28,335 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.953, Acc: 0.675, Base Lr: 4.04e-03
2022-04-22 19:29:03,888 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.869, Acc: 0.676, Base Lr: 4.04e-03
2022-04-22 19:29:28,646 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.368[s] Speed: 43.4[samples/s]
2022-04-22 19:30:10,415 reid_baseline.train INFO: normal accuracy 0.6505974454058508 3.06829833984375 
2022-04-22 19:30:40,433 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 19:30:40,434 reid_baseline.train INFO: Accuracy: 65.1% Mean Entropy: 306.8%
2022-04-22 19:31:19,947 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.557, Acc: 0.751, Base Lr: 4.83e-03
2022-04-22 19:32:04,955 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.539, Acc: 0.752, Base Lr: 4.83e-03
2022-04-22 19:32:31,749 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.408[s] Speed: 39.2[samples/s]
2022-04-22 19:33:15,226 reid_baseline.train INFO: normal accuracy 0.688504326328801 2.672482967376709 
2022-04-22 19:33:45,255 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 19:33:45,256 reid_baseline.train INFO: Accuracy: 68.9% Mean Entropy: 267.2%
2022-04-22 19:34:22,350 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.382, Acc: 0.775, Base Lr: 5.62e-03
2022-04-22 19:34:58,529 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.344, Acc: 0.784, Base Lr: 5.62e-03
2022-04-22 19:35:23,319 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.358[s] Speed: 44.6[samples/s]
2022-04-22 19:36:06,309 reid_baseline.train INFO: normal accuracy 0.7070457354758962 2.396404504776001 
2022-04-22 19:36:36,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 19:36:36,344 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 239.6%
2022-04-22 19:37:17,905 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.221, Acc: 0.814, Base Lr: 6.42e-03
2022-04-22 19:38:00,429 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.209, Acc: 0.816, Base Lr: 6.42e-03
2022-04-22 19:38:25,549 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.400[s] Speed: 40.0[samples/s]
2022-04-22 19:39:02,452 reid_baseline.train INFO: normal accuracy 0.734651833539349 2.2774486541748047 
2022-04-22 19:39:32,450 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 19:39:32,451 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 227.7%
2022-04-22 19:40:11,442 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.117, Acc: 0.840, Base Lr: 7.21e-03
2022-04-22 19:40:48,093 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.110, Acc: 0.840, Base Lr: 7.21e-03
2022-04-22 19:41:13,462 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.370[s] Speed: 43.2[samples/s]
2022-04-22 19:41:55,575 reid_baseline.train INFO: normal accuracy 0.7280593325092707 2.148200035095215 
2022-04-22 19:42:25,604 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 19:42:25,605 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 214.8%
2022-04-22 19:43:07,954 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.019, Acc: 0.859, Base Lr: 4.01e-03
2022-04-22 19:43:49,664 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.004, Acc: 0.868, Base Lr: 4.01e-03
2022-04-22 19:44:14,043 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.397[s] Speed: 40.3[samples/s]
2022-04-22 19:45:23,858 reid_baseline.train INFO: normal accuracy 0.7358879274824887 2.042943000793457 
2022-04-22 19:45:53,850 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 19:45:53,850 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 204.3%
2022-04-22 19:46:33,629 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.986, Acc: 0.884, Base Lr: 3.38e-03
2022-04-22 19:47:10,053 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.998, Acc: 0.877, Base Lr: 3.38e-03
2022-04-22 19:47:34,707 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.369[s] Speed: 43.3[samples/s]
2022-04-22 19:48:12,139 reid_baseline.train INFO: normal accuracy 0.7404202719406675 2.026334285736084 
2022-04-22 19:48:42,210 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 19:48:42,211 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 202.6%
2022-04-22 19:49:28,056 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.019, Acc: 0.867, Base Lr: 2.77e-03
2022-04-22 19:50:01,743 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.965, Acc: 0.886, Base Lr: 2.77e-03
2022-04-22 19:50:27,417 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.385[s] Speed: 41.5[samples/s]
2022-04-22 19:51:10,350 reid_baseline.train INFO: normal accuracy 0.7400082406262876 1.968010425567627 
2022-04-22 19:51:58,141 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 19:51:58,142 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 196.8%
2022-04-22 19:52:37,954 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.972, Acc: 0.875, Base Lr: 2.20e-03
2022-04-22 19:53:14,650 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.953, Acc: 0.887, Base Lr: 2.20e-03
2022-04-22 19:53:39,298 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.371[s] Speed: 43.2[samples/s]
2022-04-22 19:54:18,524 reid_baseline.train INFO: normal accuracy 0.7358879274824887 2.0218923091888428 
2022-04-22 19:54:18,527 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 19:54:18,527 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 202.2%
2022-04-22 19:55:03,685 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.958, Acc: 0.877, Base Lr: 1.66e-03
2022-04-22 19:55:41,080 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.929, Acc: 0.891, Base Lr: 1.66e-03
2022-04-22 19:56:06,188 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.394[s] Speed: 40.6[samples/s]
2022-04-22 19:56:51,052 reid_baseline.train INFO: normal accuracy 0.7420683971981871 2.004836320877075 
2022-04-22 19:56:51,053 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 19:56:51,053 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 200.5%
2022-04-22 19:57:28,725 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.895, Acc: 0.905, Base Lr: 1.19e-03
2022-04-22 19:58:03,290 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.912, Acc: 0.901, Base Lr: 1.19e-03
2022-04-22 19:58:27,181 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.352[s] Speed: 45.4[samples/s]
2022-04-22 19:59:04,760 reid_baseline.train INFO: normal accuracy 0.7437165224557066 2.0076019763946533 
2022-04-22 19:59:04,761 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 19:59:04,761 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 200.8%
2022-04-22 19:59:42,296 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.916, Acc: 0.900, Base Lr: 7.78e-04
2022-04-22 20:00:17,299 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.907, Acc: 0.901, Base Lr: 7.78e-04
2022-04-22 20:00:49,764 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.385[s] Speed: 41.6[samples/s]
2022-04-22 20:01:32,283 reid_baseline.train INFO: normal accuracy 0.7441285537700866 1.9799339771270752 
2022-04-22 20:01:32,283 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 20:01:32,284 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 198.0%
2022-04-22 20:02:10,341 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.922, Acc: 0.899, Base Lr: 4.51e-04
2022-04-22 20:02:45,767 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.899, Acc: 0.898, Base Lr: 4.51e-04
2022-04-22 20:03:12,413 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-22 20:03:52,647 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.971547245979309 
2022-04-22 20:03:52,648 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 20:03:52,648 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 197.2%
2022-04-22 20:04:31,238 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.878, Acc: 0.908, Base Lr: 2.11e-04
2022-04-22 20:05:07,600 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.876, Acc: 0.906, Base Lr: 2.11e-04
2022-04-22 20:05:30,728 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.359[s] Speed: 44.5[samples/s]
2022-04-22 20:06:09,535 reid_baseline.train INFO: normal accuracy 0.7416563658838071 1.9505221843719482 
2022-04-22 20:06:39,622 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 20:06:39,623 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 195.1%
2022-04-22 20:07:23,771 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.869, Acc: 0.907, Base Lr: 6.51e-05
2022-04-22 20:07:57,135 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.879, Acc: 0.901, Base Lr: 6.51e-05
2022-04-22 20:08:22,176 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-04-22 20:09:06,350 reid_baseline.train INFO: normal accuracy 0.7404202719406675 1.9501101970672607 
2022-04-22 20:09:36,467 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 20:09:36,467 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 195.0%
2022-04-22 20:10:14,720 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.866, Acc: 0.918, Base Lr: 1.60e-05
2022-04-22 20:10:50,212 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.879, Acc: 0.911, Base Lr: 1.60e-05
2022-04-22 20:11:15,797 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.364[s] Speed: 44.0[samples/s]
2022-04-22 20:12:23,633 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.9095124006271362 
2022-04-22 20:12:53,709 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 20:12:53,709 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 191.0%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_CEL_layer_12/transformer_best_model.pth
2022-04-22 20:14:06,644 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.9095124006271362 
2022-04-22 20:14:06,645 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 20:14:06,645 reid_baseline.train INFO: Accuracy: 73.9%
2022-04-22 20:14:48,809 reid_baseline.train INFO: normal accuracy 0.738772146683148 1.9095124006271362 
2022-04-22 20:14:48,809 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 20:14:48,810 reid_baseline.train INFO: Shuffled Accuracy: 73.9%
2022-04-22 20:15:44,120 reid_baseline.train INFO: normal accuracy 0.9383734249713631 0.9031408429145813 
2022-04-22 20:15:44,121 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 20:15:44,121 reid_baseline.train INFO: Source Clean Accuracy: 93.8%
2022-04-22 20:15:51,187 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_12
2022-04-22 20:15:51,187 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-22 20:15:51,188 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 20:15:51,188 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 20:15:51,189 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 20:16:02,303 reid_baseline.train INFO: start training
2022-04-22 20:16:45,932 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.039, Acc: 0.156, Base Lr: 8.72e-04
2022-04-22 20:17:19,940 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.001, Acc: 0.280, Base Lr: 8.72e-04
2022-04-22 20:17:41,981 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-22 20:18:36,082 reid_baseline.train INFO: normal accuracy 0.5269204775850417 4.17196798324585 
2022-04-22 20:19:06,088 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 20:19:06,089 reid_baseline.train INFO: Accuracy: 52.7% Mean Entropy: 417.2%
2022-04-22 20:19:45,776 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.810, Acc: 0.530, Base Lr: 1.66e-03
2022-04-22 20:20:20,967 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.730, Acc: 0.532, Base Lr: 1.66e-03
2022-04-22 20:20:47,659 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-22 20:21:42,586 reid_baseline.train INFO: normal accuracy 0.551926109484118 4.154913425445557 
2022-04-22 20:22:12,706 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 20:22:12,707 reid_baseline.train INFO: Accuracy: 55.2% Mean Entropy: 415.5%
2022-04-22 20:22:49,037 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 5.355, Acc: 0.573, Base Lr: 2.46e-03
2022-04-22 20:23:22,628 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 5.248, Acc: 0.568, Base Lr: 2.46e-03
2022-04-22 20:23:48,081 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.349[s] Speed: 45.8[samples/s]
2022-04-22 20:24:43,136 reid_baseline.train INFO: normal accuracy 0.5717503942329354 3.991375207901001 
2022-04-22 20:25:13,246 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 20:25:13,247 reid_baseline.train INFO: Accuracy: 57.2% Mean Entropy: 399.1%
2022-04-22 20:25:51,550 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.634, Acc: 0.590, Base Lr: 3.25e-03
2022-04-22 20:26:27,794 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.476, Acc: 0.610, Base Lr: 3.25e-03
2022-04-22 20:26:54,080 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.369[s] Speed: 43.3[samples/s]
2022-04-22 20:27:46,914 reid_baseline.train INFO: normal accuracy 0.6294210407749493 3.345435619354248 
2022-04-22 20:28:16,999 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 20:28:17,000 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 334.5%
2022-04-22 20:28:52,775 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.948, Acc: 0.666, Base Lr: 4.04e-03
2022-04-22 20:29:24,091 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.858, Acc: 0.675, Base Lr: 4.04e-03
2022-04-22 20:29:50,122 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-22 20:30:45,044 reid_baseline.train INFO: normal accuracy 0.680333408425321 2.769665479660034 
2022-04-22 20:31:15,157 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 20:31:15,157 reid_baseline.train INFO: Accuracy: 68.0% Mean Entropy: 277.0%
2022-04-22 20:31:49,058 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.543, Acc: 0.746, Base Lr: 4.83e-03
2022-04-22 20:32:25,151 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.527, Acc: 0.746, Base Lr: 4.83e-03
2022-04-22 20:32:50,313 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-04-22 20:33:47,824 reid_baseline.train INFO: normal accuracy 0.7071412480288354 2.3584096431732178 
2022-04-22 20:34:17,911 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 20:34:17,911 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 235.8%
2022-04-22 20:34:54,177 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.363, Acc: 0.778, Base Lr: 5.62e-03
2022-04-22 20:35:26,423 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.334, Acc: 0.788, Base Lr: 5.62e-03
2022-04-22 20:35:57,547 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-22 20:36:51,672 reid_baseline.train INFO: normal accuracy 0.7330479837801307 2.115567445755005 
2022-04-22 20:37:21,762 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 20:37:21,763 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 211.6%
2022-04-22 20:37:55,994 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.217, Acc: 0.808, Base Lr: 6.42e-03
2022-04-22 20:38:30,280 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.209, Acc: 0.810, Base Lr: 6.42e-03
2022-04-22 20:38:56,982 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.348[s] Speed: 45.9[samples/s]
2022-04-22 20:39:48,459 reid_baseline.train INFO: normal accuracy 0.7382293309303898 2.016746997833252 
2022-04-22 20:40:18,985 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 20:40:18,985 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 201.7%
2022-04-22 20:40:53,271 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.124, Acc: 0.840, Base Lr: 7.21e-03
2022-04-22 20:41:31,352 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.112, Acc: 0.839, Base Lr: 7.21e-03
2022-04-22 20:42:01,650 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-04-22 20:42:53,092 reid_baseline.train INFO: normal accuracy 0.7494931290831268 1.9101271629333496 
2022-04-22 20:43:23,176 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 20:43:23,177 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 191.0%
2022-04-22 20:43:59,067 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.023, Acc: 0.859, Base Lr: 4.01e-03
2022-04-22 20:44:31,133 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.003, Acc: 0.870, Base Lr: 4.01e-03
2022-04-22 20:44:56,646 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.342[s] Speed: 46.7[samples/s]
2022-04-22 20:46:19,189 reid_baseline.train INFO: normal accuracy 0.7548997521964407 1.8597872257232666 
2022-04-22 20:46:49,270 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 20:46:49,270 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 186.0%
2022-04-22 20:47:34,003 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.982, Acc: 0.878, Base Lr: 3.38e-03
2022-04-22 20:48:12,524 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.997, Acc: 0.874, Base Lr: 3.38e-03
2022-04-22 20:48:36,388 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.392[s] Speed: 40.8[samples/s]
2022-04-22 20:49:28,529 reid_baseline.train INFO: normal accuracy 0.760756927235864 1.848684310913086 
2022-04-22 20:49:58,611 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 20:49:58,612 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 184.9%
2022-04-22 20:50:34,366 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.010, Acc: 0.864, Base Lr: 2.77e-03
2022-04-22 20:51:07,614 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.961, Acc: 0.884, Base Lr: 2.77e-03
2022-04-22 20:51:30,897 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-22 20:52:19,019 reid_baseline.train INFO: normal accuracy 0.765938274386123 1.8016127347946167 
2022-04-22 20:52:49,064 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 20:52:49,064 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 180.2%
2022-04-22 20:53:33,029 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.966, Acc: 0.878, Base Lr: 2.20e-03
2022-04-22 20:54:05,867 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.945, Acc: 0.888, Base Lr: 2.20e-03
2022-04-22 20:54:29,223 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.366[s] Speed: 43.7[samples/s]
2022-04-22 20:55:20,857 reid_baseline.train INFO: normal accuracy 0.7706690696102726 1.850040316581726 
2022-04-22 20:55:20,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 20:55:20,858 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 185.0%
2022-04-22 20:55:56,710 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.952, Acc: 0.882, Base Lr: 1.66e-03
2022-04-22 20:56:28,582 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.928, Acc: 0.893, Base Lr: 1.66e-03
2022-04-22 20:56:48,857 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-22 20:57:39,474 reid_baseline.train INFO: normal accuracy 0.7681910340166704 1.8433831930160522 
2022-04-22 20:57:39,475 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 20:57:39,475 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 184.3%
2022-04-22 20:58:10,645 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.886, Acc: 0.909, Base Lr: 1.19e-03
2022-04-22 20:58:44,875 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.910, Acc: 0.903, Base Lr: 1.19e-03
2022-04-22 20:59:13,883 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.346[s] Speed: 46.3[samples/s]
2022-04-22 21:00:06,730 reid_baseline.train INFO: normal accuracy 0.7672899301644515 1.8335747718811035 
2022-04-22 21:00:06,731 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 21:00:06,732 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 183.4%
2022-04-22 21:00:41,707 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.920, Acc: 0.896, Base Lr: 7.78e-04
2022-04-22 21:01:13,946 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.910, Acc: 0.893, Base Lr: 7.78e-04
2022-04-22 21:01:39,364 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-22 21:02:31,375 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.801669955253601 
2022-04-22 21:02:31,376 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 21:02:31,376 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 180.2%
2022-04-22 21:03:03,263 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.923, Acc: 0.902, Base Lr: 4.51e-04
2022-04-22 21:03:34,356 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.897, Acc: 0.901, Base Lr: 4.51e-04
2022-04-22 21:03:56,220 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-22 21:04:46,113 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.8023293018341064 
2022-04-22 21:04:46,114 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 21:04:46,114 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 180.2%
2022-04-22 21:05:28,115 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.876, Acc: 0.905, Base Lr: 2.11e-04
2022-04-22 21:05:58,125 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.876, Acc: 0.905, Base Lr: 2.11e-04
2022-04-22 21:06:20,657 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.346[s] Speed: 46.3[samples/s]
2022-04-22 21:07:14,609 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.795957326889038 
2022-04-22 21:07:44,636 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 21:07:44,637 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 179.6%
2022-04-22 21:08:22,842 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.863, Acc: 0.907, Base Lr: 6.51e-05
2022-04-22 21:08:57,795 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.876, Acc: 0.899, Base Lr: 6.51e-05
2022-04-22 21:09:21,141 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.353[s] Speed: 45.3[samples/s]
2022-04-22 21:10:12,824 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7714561223983765 
2022-04-22 21:10:42,863 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 21:10:42,864 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 177.1%
2022-04-22 21:11:17,908 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.863, Acc: 0.915, Base Lr: 1.60e-05
2022-04-22 21:11:49,668 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.874, Acc: 0.910, Base Lr: 1.60e-05
2022-04-22 21:12:13,175 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-22 21:13:34,185 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.7455837726593018 
2022-04-22 21:14:04,201 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 21:14:04,201 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 174.6%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_layer_12/transformer_best_model.pth
2022-04-22 21:15:22,454 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.7455837726593018 
2022-04-22 21:15:22,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 21:15:22,456 reid_baseline.train INFO: Accuracy: 77.3%
2022-04-22 21:16:13,826 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.7455837726593018 
2022-04-22 21:16:13,827 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 21:16:13,828 reid_baseline.train INFO: Shuffled Accuracy: 77.3%
2022-04-22 21:17:05,152 reid_baseline.train INFO: normal accuracy 0.9367697594501718 0.9005813002586365 
2022-04-22 21:17:05,153 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 21:17:05,153 reid_baseline.train INFO: Source Clean Accuracy: 93.7%
2022-04-22 21:17:11,242 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_12
2022-04-22 21:17:11,243 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-22 21:17:11,243 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 21:17:11,243 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 21:17:11,244 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 21:17:24,950 reid_baseline.train INFO: start training
2022-04-22 21:18:08,114 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.037, Acc: 0.156, Base Lr: 8.72e-04
2022-04-22 21:18:39,802 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 5.998, Acc: 0.276, Base Lr: 8.72e-04
2022-04-22 21:19:01,088 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.344[s] Speed: 46.6[samples/s]
2022-04-22 21:20:51,827 reid_baseline.train INFO: normal accuracy 0.5278861602019739 4.172172546386719 
2022-04-22 21:21:21,817 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 21:21:21,818 reid_baseline.train INFO: Accuracy: 52.8% Mean Entropy: 417.2%
2022-04-22 21:21:49,263 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.815, Acc: 0.520, Base Lr: 1.66e-03
2022-04-22 21:22:13,918 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.731, Acc: 0.525, Base Lr: 1.66e-03
2022-04-22 21:22:33,012 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.260[s] Speed: 61.4[samples/s]
2022-04-22 21:24:13,790 reid_baseline.train INFO: normal accuracy 0.5696580215744779 4.15720796585083 
2022-04-22 21:24:43,793 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 21:24:43,794 reid_baseline.train INFO: Accuracy: 57.0% Mean Entropy: 415.7%
2022-04-22 21:25:11,187 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 5.347, Acc: 0.567, Base Lr: 2.46e-03
2022-04-22 21:25:35,210 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 5.236, Acc: 0.561, Base Lr: 2.46e-03
2022-04-22 21:25:52,197 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.250[s] Speed: 63.9[samples/s]
2022-04-22 21:27:33,576 reid_baseline.train INFO: normal accuracy 0.5914620151480376 4.002152442932129 
2022-04-22 21:28:03,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 21:28:03,602 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 400.2%
2022-04-22 21:28:29,725 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.624, Acc: 0.590, Base Lr: 3.25e-03
2022-04-22 21:28:54,261 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.463, Acc: 0.613, Base Lr: 3.25e-03
2022-04-22 21:29:12,558 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.253[s] Speed: 63.4[samples/s]
2022-04-22 21:30:47,858 reid_baseline.train INFO: normal accuracy 0.6502180399357356 3.3641350269317627 
2022-04-22 21:31:17,856 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 21:31:17,856 reid_baseline.train INFO: Accuracy: 65.0% Mean Entropy: 336.4%
2022-04-22 21:31:45,269 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.928, Acc: 0.674, Base Lr: 4.04e-03
2022-04-22 21:32:10,679 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.847, Acc: 0.679, Base Lr: 4.04e-03
2022-04-22 21:32:27,739 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.256[s] Speed: 62.5[samples/s]
2022-04-22 21:34:07,590 reid_baseline.train INFO: normal accuracy 0.7131053477163186 2.8131814002990723 
2022-04-22 21:34:37,595 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 21:34:37,595 reid_baseline.train INFO: Accuracy: 71.3% Mean Entropy: 281.3%
2022-04-22 21:35:04,905 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.531, Acc: 0.751, Base Lr: 4.83e-03
2022-04-22 21:35:28,963 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.521, Acc: 0.749, Base Lr: 4.83e-03
2022-04-22 21:35:45,520 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.249[s] Speed: 64.3[samples/s]
2022-04-22 21:37:37,717 reid_baseline.train INFO: normal accuracy 0.7399586871700712 2.3741846084594727 
2022-04-22 21:38:08,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 21:38:08,318 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 237.4%
2022-04-22 21:38:34,368 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.364, Acc: 0.775, Base Lr: 5.62e-03
2022-04-22 21:38:58,652 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.327, Acc: 0.792, Base Lr: 5.62e-03
2022-04-22 21:39:16,574 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.250[s] Speed: 64.0[samples/s]
2022-04-22 21:40:55,583 reid_baseline.train INFO: normal accuracy 0.7590084920817076 2.1455111503601074 
2022-04-22 21:41:25,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 21:41:25,598 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 214.6%
2022-04-22 21:41:53,147 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.216, Acc: 0.814, Base Lr: 6.42e-03
2022-04-22 21:42:17,342 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.205, Acc: 0.814, Base Lr: 6.42e-03
2022-04-22 21:42:35,215 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.255[s] Speed: 62.8[samples/s]
2022-04-22 21:44:13,968 reid_baseline.train INFO: normal accuracy 0.7702547624512279 2.0406715869903564 
2022-04-22 21:44:43,962 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 21:44:43,962 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 204.1%
2022-04-22 21:45:18,052 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.122, Acc: 0.840, Base Lr: 7.21e-03
2022-04-22 21:45:51,036 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.113, Acc: 0.840, Base Lr: 7.21e-03
2022-04-22 21:46:14,118 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-22 21:48:11,973 reid_baseline.train INFO: normal accuracy 0.7759926554969016 1.9165194034576416 
2022-04-22 21:48:42,068 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 21:48:42,068 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 191.7%
2022-04-22 21:49:16,308 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.020, Acc: 0.862, Base Lr: 4.01e-03
2022-04-22 21:49:47,534 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.000, Acc: 0.873, Base Lr: 4.01e-03
2022-04-22 21:50:06,997 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-22 21:52:14,704 reid_baseline.train INFO: normal accuracy 0.7792058756024788 1.859950304031372 
2022-04-22 21:52:44,780 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 21:52:44,780 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 186.0%
2022-04-22 21:53:12,504 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 2.982, Acc: 0.878, Base Lr: 3.38e-03
2022-04-22 21:53:38,316 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 2.994, Acc: 0.874, Base Lr: 3.38e-03
2022-04-22 21:53:57,174 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.265[s] Speed: 60.3[samples/s]
2022-04-22 21:55:40,089 reid_baseline.train INFO: normal accuracy 0.7851732843699794 1.8377543687820435 
2022-04-22 21:56:10,167 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 21:56:10,168 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 183.8%
2022-04-22 21:56:37,594 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.016, Acc: 0.862, Base Lr: 2.77e-03
2022-04-22 21:57:02,868 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 2.964, Acc: 0.882, Base Lr: 2.77e-03
2022-04-22 21:57:21,859 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.263[s] Speed: 60.9[samples/s]
2022-04-22 21:59:03,638 reid_baseline.train INFO: normal accuracy 0.7847142529263255 1.7942622900009155 
2022-04-22 21:59:33,702 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 21:59:33,702 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 179.4%
2022-04-22 22:00:01,339 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 2.965, Acc: 0.880, Base Lr: 2.20e-03
2022-04-22 22:00:26,991 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 2.947, Acc: 0.886, Base Lr: 2.20e-03
2022-04-22 22:00:44,027 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.258[s] Speed: 62.1[samples/s]
2022-04-22 22:02:25,763 reid_baseline.train INFO: normal accuracy 0.7872389258664219 1.8474807739257812 
2022-04-22 22:02:25,764 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 22:02:25,764 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 184.7%
2022-04-22 22:02:52,459 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 2.958, Acc: 0.881, Base Lr: 1.66e-03
2022-04-22 22:03:17,583 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 2.931, Acc: 0.892, Base Lr: 1.66e-03
2022-04-22 22:03:36,104 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.258[s] Speed: 62.1[samples/s]
2022-04-22 22:05:15,441 reid_baseline.train INFO: normal accuracy 0.7842552214826716 1.834617018699646 
2022-04-22 22:05:15,441 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 22:05:15,441 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 183.5%
2022-04-22 22:05:42,721 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 2.888, Acc: 0.908, Base Lr: 1.19e-03
2022-04-22 22:06:08,118 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 2.908, Acc: 0.903, Base Lr: 1.19e-03
2022-04-22 22:06:26,704 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.261[s] Speed: 61.3[samples/s]
2022-04-22 22:08:09,845 reid_baseline.train INFO: normal accuracy 0.7870094101445949 1.8516738414764404 
2022-04-22 22:08:09,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 22:08:09,845 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 185.2%
2022-04-22 22:08:39,349 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 2.917, Acc: 0.892, Base Lr: 7.78e-04
2022-04-22 22:09:05,045 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 2.908, Acc: 0.894, Base Lr: 7.78e-04
2022-04-22 22:09:23,454 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.270[s] Speed: 59.3[samples/s]
2022-04-22 22:11:00,325 reid_baseline.train INFO: normal accuracy 0.7911406931374799 1.808838963508606 
2022-04-22 22:11:00,325 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 22:11:00,325 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 180.9%
2022-04-22 22:11:28,436 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 2.923, Acc: 0.897, Base Lr: 4.51e-04
2022-04-22 22:11:53,726 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 2.898, Acc: 0.899, Base Lr: 4.51e-04
2022-04-22 22:12:12,768 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.265[s] Speed: 60.4[samples/s]
2022-04-22 22:13:54,514 reid_baseline.train INFO: normal accuracy 0.7895340830846913 1.8066779375076294 
2022-04-22 22:13:54,514 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 22:13:54,515 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 180.7%
2022-04-22 22:14:21,170 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 2.872, Acc: 0.904, Base Lr: 2.11e-04
2022-04-22 22:14:45,836 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 2.874, Acc: 0.904, Base Lr: 2.11e-04
2022-04-22 22:15:04,273 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.256[s] Speed: 62.6[samples/s]
2022-04-22 22:16:42,203 reid_baseline.train INFO: normal accuracy 0.7897635988065183 1.8097025156021118 
2022-04-22 22:16:42,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 22:16:42,203 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 181.0%
2022-04-22 22:17:09,412 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 2.873, Acc: 0.906, Base Lr: 6.51e-05
2022-04-22 22:17:34,664 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 2.881, Acc: 0.900, Base Lr: 6.51e-05
2022-04-22 22:17:53,097 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.260[s] Speed: 61.6[samples/s]
2022-04-22 22:19:31,892 reid_baseline.train INFO: normal accuracy 0.7876979573100757 1.7847208976745605 
2022-04-22 22:20:01,966 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 22:20:01,966 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 178.5%
2022-04-22 22:20:29,429 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 2.869, Acc: 0.912, Base Lr: 1.60e-05
2022-04-22 22:20:55,324 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 2.877, Acc: 0.908, Base Lr: 1.60e-05
2022-04-22 22:21:14,452 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.266[s] Speed: 60.3[samples/s]
2022-04-22 22:23:27,292 reid_baseline.train INFO: normal accuracy 0.7929768189120955 1.7484482526779175 
2022-04-22 22:23:57,370 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 22:23:57,370 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 174.8%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_CEL_layer_12/transformer_best_model.pth
2022-04-22 22:26:09,420 reid_baseline.train INFO: normal accuracy 0.7929768189120955 1.7484482526779175 
2022-04-22 22:26:09,420 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 22:26:09,420 reid_baseline.train INFO: Accuracy: 79.3%
2022-04-22 22:27:49,082 reid_baseline.train INFO: normal accuracy 0.7929768189120955 1.7484482526779175 
2022-04-22 22:27:49,083 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 22:27:49,083 reid_baseline.train INFO: Shuffled Accuracy: 79.3%
2022-04-22 22:28:29,174 reid_baseline.train INFO: normal accuracy 0.938602520045819 0.9039900302886963 
2022-04-22 22:28:29,174 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 22:28:29,174 reid_baseline.train INFO: Source Clean Accuracy: 93.9%
