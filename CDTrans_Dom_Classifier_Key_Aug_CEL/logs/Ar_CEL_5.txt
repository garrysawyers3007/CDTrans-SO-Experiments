2022-04-22 17:54:48,629 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1
2022-04-22 17:54:48,630 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-22 17:54:48,630 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 17:54:48,643 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 17:54:48,643 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 17:54:56,899 reid_baseline.train INFO: start training
2022-04-22 17:55:30,234 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.995, Acc: 0.289, Base Lr: 8.72e-04
2022-04-22 17:55:48,464 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-22 17:56:30,453 reid_baseline.train INFO: normal accuracy 0.3983963344788087 4.171774864196777 
2022-04-22 17:57:03,605 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 17:57:03,606 reid_baseline.train INFO: Accuracy: 39.8% Mean Entropy: 417.2%
2022-04-22 17:57:35,012 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.676, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 17:57:50,039 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 17:58:27,860 reid_baseline.train INFO: normal accuracy 0.427262313860252 4.154049873352051 
2022-04-22 17:59:02,618 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 17:59:02,618 reid_baseline.train INFO: Accuracy: 42.7% Mean Entropy: 415.4%
2022-04-22 17:59:34,438 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.111, Acc: 0.621, Base Lr: 2.46e-03
2022-04-22 17:59:49,471 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-22 18:00:28,066 reid_baseline.train INFO: normal accuracy 0.44810996563573885 4.000279903411865 
2022-04-22 18:01:01,529 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 18:01:01,529 reid_baseline.train INFO: Accuracy: 44.8% Mean Entropy: 400.0%
2022-04-22 18:01:33,624 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.325, Acc: 0.664, Base Lr: 3.25e-03
2022-04-22 18:01:49,380 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.315[s] Speed: 50.8[samples/s]
2022-04-22 18:02:28,580 reid_baseline.train INFO: normal accuracy 0.4820160366552119 3.4804799556732178 
2022-04-22 18:03:04,561 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 18:03:04,562 reid_baseline.train INFO: Accuracy: 48.2% Mean Entropy: 348.0%
2022-04-22 18:03:35,636 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.803, Acc: 0.698, Base Lr: 4.04e-03
2022-04-22 18:03:51,042 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-22 18:04:28,248 reid_baseline.train INFO: normal accuracy 0.5482245131729668 3.005488157272339 
2022-04-22 18:05:12,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 18:05:12,752 reid_baseline.train INFO: Accuracy: 54.8% Mean Entropy: 300.5%
2022-04-22 18:05:50,177 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.494, Acc: 0.764, Base Lr: 4.83e-03
2022-04-22 18:06:04,971 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.344[s] Speed: 46.6[samples/s]
2022-04-22 18:07:00,461 reid_baseline.train INFO: normal accuracy 0.6036655211912944 2.658555269241333 
2022-04-22 18:07:36,730 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 18:07:36,731 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 265.9%
2022-04-22 18:08:08,834 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.325, Acc: 0.790, Base Lr: 5.62e-03
2022-04-22 18:08:23,515 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-22 18:08:59,159 reid_baseline.train INFO: normal accuracy 0.6050400916380297 2.359640121459961 
2022-04-22 18:09:33,248 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 18:09:33,248 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 236.0%
2022-04-22 18:10:04,195 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.120, Acc: 0.852, Base Lr: 6.42e-03
2022-04-22 18:10:18,834 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-22 18:10:57,476 reid_baseline.train INFO: normal accuracy 0.6112256586483391 2.122817039489746 
2022-04-22 18:11:33,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 18:11:33,783 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 212.3%
2022-04-22 18:12:06,813 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.077, Acc: 0.874, Base Lr: 7.21e-03
2022-04-22 18:12:21,735 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.315[s] Speed: 50.7[samples/s]
2022-04-22 18:12:59,275 reid_baseline.train INFO: normal accuracy 0.6077892325315005 2.0037944316864014 
2022-04-22 18:13:34,585 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 18:13:34,585 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 200.4%
2022-04-22 18:14:13,846 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.991, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 18:14:32,240 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.379[s] Speed: 42.2[samples/s]
2022-04-22 18:16:03,612 reid_baseline.train INFO: normal accuracy 0.6199312714776632 1.9460340738296509 
2022-04-22 18:16:40,042 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 18:16:40,043 reid_baseline.train INFO: Accuracy: 62.0% Mean Entropy: 194.6%
2022-04-22 18:17:11,465 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.955, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 18:17:26,040 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-22 18:18:04,534 reid_baseline.train INFO: normal accuracy 0.6210767468499427 1.8956416845321655 
2022-04-22 18:18:38,864 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 18:18:38,864 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 189.6%
2022-04-22 18:19:10,133 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.920, Acc: 0.917, Base Lr: 2.77e-03
2022-04-22 18:19:24,826 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-22 18:19:59,868 reid_baseline.train INFO: normal accuracy 0.624971363115693 1.8889859914779663 
2022-04-22 18:20:42,972 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 18:20:42,972 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.9%
2022-04-22 18:21:14,349 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.923, Acc: 0.907, Base Lr: 2.20e-03
2022-04-22 18:21:30,105 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-22 18:22:09,262 reid_baseline.train INFO: normal accuracy 0.6219931271477663 1.9275187253952026 
2022-04-22 18:22:09,262 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 18:22:09,263 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 192.8%
2022-04-22 18:22:40,996 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.896, Acc: 0.916, Base Lr: 1.66e-03
2022-04-22 18:22:59,764 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-22 18:23:37,841 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.8802249431610107 
2022-04-22 18:24:13,919 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 18:24:13,920 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 188.0%
2022-04-22 18:24:45,669 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.875, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 18:25:01,452 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-22 18:25:42,550 reid_baseline.train INFO: normal accuracy 0.6336769759450172 1.878434658050537 
2022-04-22 18:26:15,508 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 18:26:15,508 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 187.8%
2022-04-22 18:26:46,747 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.880, Acc: 0.918, Base Lr: 7.78e-04
2022-04-22 18:27:01,543 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-22 18:27:40,227 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.773756504058838 
2022-04-22 18:28:14,799 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 18:28:14,800 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 177.4%
2022-04-22 18:28:45,820 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.861, Acc: 0.933, Base Lr: 4.51e-04
2022-04-22 18:29:00,666 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-22 18:29:56,693 reid_baseline.train INFO: normal accuracy 0.63184421534937 1.8847992420196533 
2022-04-22 18:29:56,693 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 18:29:56,694 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 188.5%
2022-04-22 18:30:27,822 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.863, Acc: 0.928, Base Lr: 2.11e-04
2022-04-22 18:30:42,192 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-22 18:31:19,767 reid_baseline.train INFO: normal accuracy 0.6311569301260023 1.8447693586349487 
2022-04-22 18:31:19,767 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 18:31:19,768 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 184.5%
2022-04-22 18:31:55,223 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.866, Acc: 0.920, Base Lr: 6.51e-05
2022-04-22 18:32:13,673 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.355[s] Speed: 45.1[samples/s]
2022-04-22 18:32:51,779 reid_baseline.train INFO: normal accuracy 0.6284077892325315 1.8807350397109985 
2022-04-22 18:32:51,780 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 18:32:51,780 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 188.1%
2022-04-22 18:33:22,659 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.872, Acc: 0.920, Base Lr: 1.60e-05
2022-04-22 18:33:37,086 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 18:34:50,672 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.8683611154556274 
2022-04-22 18:34:50,672 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 18:34:50,673 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-22 18:36:03,011 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.773756504058838 
2022-04-22 18:36:03,011 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 18:36:03,011 reid_baseline.train INFO: Accuracy: 62.9%
2022-04-22 18:36:39,455 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.773756504058838 
2022-04-22 18:36:39,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 18:36:39,455 reid_baseline.train INFO: Shuffled Accuracy: 62.9%
2022-04-22 18:37:07,028 reid_baseline.train INFO: normal accuracy 0.9736299958796869 0.7965825200080872 
2022-04-22 18:37:07,028 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 18:37:07,028 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-22 18:37:13,210 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1
2022-04-22 18:37:13,211 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-22 18:37:13,211 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 18:37:13,212 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 18:37:13,213 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 18:37:20,884 reid_baseline.train INFO: start training
2022-04-22 18:37:54,544 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.995, Acc: 0.288, Base Lr: 8.72e-04
2022-04-22 18:38:10,694 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.326[s] Speed: 49.2[samples/s]
2022-04-22 18:39:03,722 reid_baseline.train INFO: normal accuracy 0.5172336111736877 4.171998023986816 
2022-04-22 18:39:38,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 18:39:38,534 reid_baseline.train INFO: Accuracy: 51.7% Mean Entropy: 417.2%
2022-04-22 18:40:09,953 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.676, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 18:40:25,126 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.307[s] Speed: 52.2[samples/s]
2022-04-22 18:41:23,064 reid_baseline.train INFO: normal accuracy 0.5431403469249831 4.15315055847168 
2022-04-22 18:41:56,221 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 18:41:56,222 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 415.3%
2022-04-22 18:42:29,566 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.111, Acc: 0.621, Base Lr: 2.46e-03
2022-04-22 18:42:44,847 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-22 18:43:38,673 reid_baseline.train INFO: normal accuracy 0.5489975219644064 3.992161989212036 
2022-04-22 18:44:13,414 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 18:44:13,415 reid_baseline.train INFO: Accuracy: 54.9% Mean Entropy: 399.2%
2022-04-22 18:44:45,791 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.325, Acc: 0.664, Base Lr: 3.25e-03
2022-04-22 18:45:01,044 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-22 18:45:38,245 reid_baseline.train INFO: normal accuracy 0.5890966433881505 3.431769371032715 
2022-04-22 18:46:12,583 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 18:46:12,583 reid_baseline.train INFO: Accuracy: 58.9% Mean Entropy: 343.2%
2022-04-22 18:46:43,732 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.803, Acc: 0.698, Base Lr: 4.04e-03
2022-04-22 18:46:59,023 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 18:47:34,561 reid_baseline.train INFO: normal accuracy 0.6638882631223249 2.83229923248291 
2022-04-22 18:48:08,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 18:48:08,890 reid_baseline.train INFO: Accuracy: 66.4% Mean Entropy: 283.2%
2022-04-22 18:48:42,380 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.494, Acc: 0.764, Base Lr: 4.83e-03
2022-04-22 18:48:57,104 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.317[s] Speed: 50.4[samples/s]
2022-04-22 18:49:30,566 reid_baseline.train INFO: normal accuracy 0.7258391529623789 2.4414141178131104 
2022-04-22 18:50:04,429 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 18:50:04,429 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 244.1%
2022-04-22 18:50:43,412 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.325, Acc: 0.791, Base Lr: 5.62e-03
2022-04-22 18:50:58,169 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.354[s] Speed: 45.3[samples/s]
2022-04-22 18:51:34,424 reid_baseline.train INFO: normal accuracy 0.7537733723811669 2.1200685501098633 
2022-04-22 18:52:08,918 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 18:52:08,918 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 212.0%
2022-04-22 18:52:41,335 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.120, Acc: 0.852, Base Lr: 6.42e-03
2022-04-22 18:52:57,717 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-22 18:53:34,509 reid_baseline.train INFO: normal accuracy 0.7679657580536157 1.8861364126205444 
2022-04-22 18:54:08,847 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 18:54:08,848 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 188.6%
2022-04-22 18:54:40,905 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.077, Acc: 0.873, Base Lr: 7.21e-03
2022-04-22 18:54:55,767 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-22 18:55:31,572 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.78244948387146 
2022-04-22 18:56:07,258 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 18:56:07,259 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 178.2%
2022-04-22 18:56:39,860 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.992, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 18:56:54,734 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.312[s] Speed: 51.2[samples/s]
2022-04-22 18:58:07,899 reid_baseline.train INFO: normal accuracy 0.7776526244649696 1.7462007999420166 
2022-04-22 18:58:46,303 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 18:58:46,303 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 174.6%
2022-04-22 18:59:24,995 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.955, Acc: 0.913, Base Lr: 3.38e-03
2022-04-22 18:59:43,426 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-04-22 19:00:19,072 reid_baseline.train INFO: normal accuracy 0.7794548321694075 1.707226276397705 
2022-04-22 19:00:57,917 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 19:00:57,917 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 170.7%
2022-04-22 19:01:30,161 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.920, Acc: 0.917, Base Lr: 2.77e-03
2022-04-22 19:01:45,057 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-22 19:02:20,653 reid_baseline.train INFO: normal accuracy 0.7812570398738454 1.6852598190307617 
2022-04-22 19:02:56,218 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 19:02:56,219 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 168.5%
2022-04-22 19:03:27,909 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.924, Acc: 0.907, Base Lr: 2.20e-03
2022-04-22 19:03:43,821 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-22 19:04:20,678 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.7418055534362793 
2022-04-22 19:04:20,678 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 19:04:20,678 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 174.2%
2022-04-22 19:04:51,882 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.897, Acc: 0.915, Base Lr: 1.66e-03
2022-04-22 19:05:07,086 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 19:05:42,224 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.6819874048233032 
2022-04-22 19:06:18,159 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 19:06:18,159 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 168.2%
2022-04-22 19:06:49,599 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.875, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 19:07:05,043 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-22 19:07:45,162 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.6920061111450195 
2022-04-22 19:07:45,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 19:07:45,163 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 169.2%
2022-04-22 19:08:24,258 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.880, Acc: 0.918, Base Lr: 7.78e-04
2022-04-22 19:08:43,248 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.382[s] Speed: 41.9[samples/s]
2022-04-22 19:09:22,529 reid_baseline.train INFO: normal accuracy 0.782608695652174 1.5753697156906128 
2022-04-22 19:10:14,255 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 19:10:14,256 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 157.5%
2022-04-22 19:10:45,506 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.861, Acc: 0.933, Base Lr: 4.51e-04
2022-04-22 19:11:00,447 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-22 19:11:38,311 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.6804754734039307 
2022-04-22 19:11:38,311 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 19:11:38,311 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 168.0%
2022-04-22 19:12:10,563 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.863, Acc: 0.928, Base Lr: 2.11e-04
2022-04-22 19:12:25,185 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-22 19:13:03,669 reid_baseline.train INFO: normal accuracy 0.7857625591349403 1.6457327604293823 
2022-04-22 19:13:03,669 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 19:13:03,669 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 164.6%
2022-04-22 19:13:34,971 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.866, Acc: 0.920, Base Lr: 6.51e-05
2022-04-22 19:13:50,055 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 19:14:28,504 reid_baseline.train INFO: normal accuracy 0.7853120072088308 1.6873421669006348 
2022-04-22 19:14:28,505 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 19:14:28,505 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 168.7%
2022-04-22 19:14:59,735 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.872, Acc: 0.920, Base Lr: 1.60e-05
2022-04-22 19:15:14,199 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-22 19:16:29,177 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.6740702390670776 
2022-04-22 19:16:29,178 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 19:16:29,178 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 167.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-22 19:17:51,591 reid_baseline.train INFO: normal accuracy 0.782608695652174 1.5753697156906128 
2022-04-22 19:17:51,592 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 19:17:51,592 reid_baseline.train INFO: Accuracy: 78.3%
2022-04-22 19:18:28,082 reid_baseline.train INFO: normal accuracy 0.782608695652174 1.5753697156906128 
2022-04-22 19:18:28,083 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 19:18:28,083 reid_baseline.train INFO: Shuffled Accuracy: 78.3%
2022-04-22 19:18:55,352 reid_baseline.train INFO: normal accuracy 0.9736299958796869 0.7965911030769348 
2022-04-22 19:18:55,352 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 19:18:55,352 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-22 19:19:01,792 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1
2022-04-22 19:19:01,792 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=1)
2022-04-22 19:19:01,793 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 19:19:01,794 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 19:19:01,795 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 19:19:10,123 reid_baseline.train INFO: start training
2022-04-22 19:19:43,598 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.995, Acc: 0.288, Base Lr: 8.72e-04
2022-04-22 19:19:59,651 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-22 19:21:23,717 reid_baseline.train INFO: normal accuracy 0.5967408767500574 4.171725273132324 
2022-04-22 19:21:59,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 19:21:59,289 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 417.2%
2022-04-22 19:22:30,512 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.676, Acc: 0.593, Base Lr: 1.66e-03
2022-04-22 19:22:45,660 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.305[s] Speed: 52.5[samples/s]
2022-04-22 19:24:12,806 reid_baseline.train INFO: normal accuracy 0.6215285747073674 4.144160747528076 
2022-04-22 19:24:47,513 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 19:24:47,513 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 414.4%
2022-04-22 19:25:19,659 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.111, Acc: 0.619, Base Lr: 2.46e-03
2022-04-22 19:25:37,548 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-22 19:27:09,746 reid_baseline.train INFO: normal accuracy 0.6307092035804452 3.8938651084899902 
2022-04-22 19:27:43,591 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 19:27:43,591 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 389.4%
2022-04-22 19:28:15,858 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.325, Acc: 0.664, Base Lr: 3.25e-03
2022-04-22 19:28:31,163 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-22 19:29:41,082 reid_baseline.train INFO: normal accuracy 0.6750057378930456 3.166455030441284 
2022-04-22 19:30:15,192 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 19:30:15,192 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 316.6%
2022-04-22 19:30:46,503 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.803, Acc: 0.697, Base Lr: 4.04e-03
2022-04-22 19:31:01,667 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-22 19:32:11,814 reid_baseline.train INFO: normal accuracy 0.7383520771172826 2.512187957763672 
2022-04-22 19:32:50,965 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 19:32:50,965 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 251.2%
2022-04-22 19:33:23,271 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.494, Acc: 0.764, Base Lr: 4.83e-03
2022-04-22 19:33:38,326 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.312[s] Speed: 51.4[samples/s]
2022-04-22 19:34:54,140 reid_baseline.train INFO: normal accuracy 0.782419095708056 2.1209940910339355 
2022-04-22 19:35:28,938 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 19:35:28,938 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 212.1%
2022-04-22 19:36:04,611 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.325, Acc: 0.790, Base Lr: 5.62e-03
2022-04-22 19:36:19,354 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-22 19:37:30,893 reid_baseline.train INFO: normal accuracy 0.8069772779435391 1.8519721031188965 
2022-04-22 19:38:04,922 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 19:38:04,923 reid_baseline.train INFO: Accuracy: 80.7% Mean Entropy: 185.2%
2022-04-22 19:38:37,941 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.120, Acc: 0.852, Base Lr: 6.42e-03
2022-04-22 19:38:53,906 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-22 19:40:10,836 reid_baseline.train INFO: normal accuracy 0.8150103282074822 1.6351568698883057 
2022-04-22 19:40:45,589 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 19:40:45,590 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 163.5%
2022-04-22 19:41:17,995 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.077, Acc: 0.874, Base Lr: 7.21e-03
2022-04-22 19:41:34,201 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-22 19:42:52,474 reid_baseline.train INFO: normal accuracy 0.8223548313059444 1.5254958868026733 
2022-04-22 19:43:27,442 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 19:43:27,442 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 152.5%
2022-04-22 19:44:07,921 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.991, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 19:44:26,942 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.391[s] Speed: 40.9[samples/s]
2022-04-22 19:46:16,934 reid_baseline.train INFO: normal accuracy 0.8260270828551756 1.4982308149337769 
2022-04-22 19:46:53,133 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 19:46:53,133 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 149.8%
2022-04-22 19:47:26,056 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.955, Acc: 0.914, Base Lr: 3.38e-03
2022-04-22 19:47:41,961 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-22 19:48:59,436 reid_baseline.train INFO: normal accuracy 0.8296993344044067 1.453593373298645 
2022-04-22 19:49:34,823 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 19:49:34,823 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 145.4%
2022-04-22 19:50:06,845 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.920, Acc: 0.917, Base Lr: 2.77e-03
2022-04-22 19:50:22,038 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-22 19:51:40,819 reid_baseline.train INFO: normal accuracy 0.8299288501262336 1.4404698610305786 
2022-04-22 19:52:15,522 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 19:52:15,523 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 144.0%
2022-04-22 19:52:54,642 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.923, Acc: 0.907, Base Lr: 2.20e-03
2022-04-22 19:53:14,665 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.389[s] Speed: 41.2[samples/s]
2022-04-22 19:54:45,666 reid_baseline.train INFO: normal accuracy 0.8306173972917145 1.4927866458892822 
2022-04-22 19:54:45,666 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 19:54:45,666 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 149.3%
2022-04-22 19:55:17,102 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.896, Acc: 0.916, Base Lr: 1.66e-03
2022-04-22 19:55:32,417 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 19:57:03,708 reid_baseline.train INFO: normal accuracy 0.8315354601790222 1.4546165466308594 
2022-04-22 19:57:03,709 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 19:57:03,709 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 145.5%
2022-04-22 19:57:35,131 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.875, Acc: 0.928, Base Lr: 1.19e-03
2022-04-22 19:57:50,473 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 19:59:19,172 reid_baseline.train INFO: normal accuracy 0.8329125545099839 1.4678139686584473 
2022-04-22 19:59:19,172 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 19:59:19,172 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 146.8%
2022-04-22 19:59:50,772 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.880, Acc: 0.918, Base Lr: 7.78e-04
2022-04-22 20:00:05,552 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 20:01:29,468 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.3604217767715454 
2022-04-22 20:02:05,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 20:02:05,202 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 136.0%
2022-04-22 20:02:42,227 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.861, Acc: 0.933, Base Lr: 4.51e-04
2022-04-22 20:02:57,338 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.343[s] Speed: 46.7[samples/s]
2022-04-22 20:04:12,339 reid_baseline.train INFO: normal accuracy 0.8331420702318109 1.4673506021499634 
2022-04-22 20:04:12,339 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 20:04:12,340 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 146.7%
2022-04-22 20:04:43,913 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.863, Acc: 0.928, Base Lr: 2.11e-04
2022-04-22 20:04:58,442 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-22 20:06:27,108 reid_baseline.train INFO: normal accuracy 0.8315354601790222 1.4327833652496338 
2022-04-22 20:06:27,108 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 20:06:27,109 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.3%
2022-04-22 20:06:58,087 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.866, Acc: 0.920, Base Lr: 6.51e-05
2022-04-22 20:07:13,153 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-22 20:08:49,514 reid_baseline.train INFO: normal accuracy 0.8336011016754648 1.4691416025161743 
2022-04-22 20:08:49,515 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 20:08:49,515 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.9%
2022-04-22 20:09:21,376 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.872, Acc: 0.921, Base Lr: 1.60e-05
2022-04-22 20:09:35,902 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 20:11:31,453 reid_baseline.train INFO: normal accuracy 0.8331420702318109 1.455940842628479 
2022-04-22 20:11:31,454 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 20:11:31,454 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 145.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_1/transformer_best_model.pth
2022-04-22 20:13:22,560 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.3604217767715454 
2022-04-22 20:13:22,560 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 20:13:22,560 reid_baseline.train INFO: Accuracy: 83.6%
2022-04-22 20:14:35,246 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.3604217767715454 
2022-04-22 20:14:35,247 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 20:14:35,247 reid_baseline.train INFO: Shuffled Accuracy: 83.6%
2022-04-22 20:15:03,738 reid_baseline.train INFO: normal accuracy 0.9736299958796869 0.7964574694633484 
2022-04-22 20:15:03,738 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 20:15:03,738 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-22 20:15:08,937 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2
2022-04-22 20:15:08,938 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-22 20:15:08,938 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 20:15:08,939 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 20:15:08,939 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 20:15:16,622 reid_baseline.train INFO: start training
2022-04-22 20:15:50,155 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.988, Acc: 0.285, Base Lr: 8.72e-04
2022-04-22 20:16:06,382 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-22 20:16:42,014 reid_baseline.train INFO: normal accuracy 0.3967926689576174 4.171799182891846 
2022-04-22 20:17:16,199 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 20:17:16,200 reid_baseline.train INFO: Accuracy: 39.7% Mean Entropy: 417.2%
2022-04-22 20:17:48,152 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.674, Acc: 0.597, Base Lr: 1.66e-03
2022-04-22 20:18:03,470 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-22 20:18:41,339 reid_baseline.train INFO: normal accuracy 0.4229095074455899 4.154156684875488 
2022-04-22 20:19:16,446 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 20:19:16,447 reid_baseline.train INFO: Accuracy: 42.3% Mean Entropy: 415.4%
2022-04-22 20:19:56,158 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.112, Acc: 0.635, Base Lr: 2.46e-03
2022-04-22 20:20:14,860 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.384[s] Speed: 41.6[samples/s]
2022-04-22 20:20:53,981 reid_baseline.train INFO: normal accuracy 0.44627720504009166 4.0075297355651855 
2022-04-22 20:21:28,407 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 20:21:28,407 reid_baseline.train INFO: Accuracy: 44.6% Mean Entropy: 400.8%
2022-04-22 20:22:00,956 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.331, Acc: 0.658, Base Lr: 3.25e-03
2022-04-22 20:22:16,431 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.316[s] Speed: 50.7[samples/s]
2022-04-22 20:22:51,146 reid_baseline.train INFO: normal accuracy 0.47972508591065294 3.503910779953003 
2022-04-22 20:23:27,472 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 20:23:27,472 reid_baseline.train INFO: Accuracy: 48.0% Mean Entropy: 350.4%
2022-04-22 20:24:00,370 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.802, Acc: 0.699, Base Lr: 4.04e-03
2022-04-22 20:24:15,770 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.318[s] Speed: 50.4[samples/s]
2022-04-22 20:24:51,748 reid_baseline.train INFO: normal accuracy 0.5461626575028636 3.0051252841949463 
2022-04-22 20:25:25,101 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 20:25:25,102 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 300.5%
2022-04-22 20:25:57,104 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.493, Acc: 0.757, Base Lr: 4.83e-03
2022-04-22 20:26:12,431 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-22 20:26:57,948 reid_baseline.train INFO: normal accuracy 0.6018327605956472 2.659637212753296 
2022-04-22 20:27:33,448 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 20:27:33,449 reid_baseline.train INFO: Accuracy: 60.2% Mean Entropy: 266.0%
2022-04-22 20:28:06,188 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.326, Acc: 0.787, Base Lr: 5.62e-03
2022-04-22 20:28:22,141 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-22 20:29:08,770 reid_baseline.train INFO: normal accuracy 0.60893470790378 2.3610293865203857 
2022-04-22 20:29:45,061 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 20:29:45,062 reid_baseline.train INFO: Accuracy: 60.9% Mean Entropy: 236.1%
2022-04-22 20:30:16,436 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.135, Acc: 0.853, Base Lr: 6.42e-03
2022-04-22 20:30:30,978 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-22 20:31:06,125 reid_baseline.train INFO: normal accuracy 0.6144329896907217 2.135576009750366 
2022-04-22 20:31:40,391 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 20:31:40,391 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 213.6%
2022-04-22 20:32:12,179 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.070, Acc: 0.871, Base Lr: 7.21e-03
2022-04-22 20:32:27,090 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 20:33:00,741 reid_baseline.train INFO: normal accuracy 0.6073310423825887 1.9980230331420898 
2022-04-22 20:33:35,086 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 20:33:35,087 reid_baseline.train INFO: Accuracy: 60.7% Mean Entropy: 199.8%
2022-04-22 20:34:07,410 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.980, Acc: 0.890, Base Lr: 4.01e-03
2022-04-22 20:34:22,394 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-22 20:35:45,580 reid_baseline.train INFO: normal accuracy 0.616036655211913 1.9553298950195312 
2022-04-22 20:36:22,115 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 20:36:22,115 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 195.5%
2022-04-22 20:36:54,116 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.950, Acc: 0.909, Base Lr: 3.38e-03
2022-04-22 20:37:09,140 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-22 20:37:48,156 reid_baseline.train INFO: normal accuracy 0.6148911798396335 1.9070369005203247 
2022-04-22 20:38:22,389 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 20:38:22,390 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 190.7%
2022-04-22 20:38:56,129 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.915, Acc: 0.914, Base Lr: 2.77e-03
2022-04-22 20:39:12,231 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-22 20:39:49,159 reid_baseline.train INFO: normal accuracy 0.6215349369988545 1.8853129148483276 
2022-04-22 20:40:23,690 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 20:40:23,690 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 188.5%
2022-04-22 20:40:55,271 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.907, Acc: 0.905, Base Lr: 2.20e-03
2022-04-22 20:41:11,339 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.313[s] Speed: 51.0[samples/s]
2022-04-22 20:42:07,274 reid_baseline.train INFO: normal accuracy 0.618327605956472 1.9214450120925903 
2022-04-22 20:42:07,274 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 20:42:07,275 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 192.1%
2022-04-22 20:42:38,450 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.887, Acc: 0.914, Base Lr: 1.66e-03
2022-04-22 20:42:53,919 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 20:43:32,789 reid_baseline.train INFO: normal accuracy 0.6277205040091638 1.8808634281158447 
2022-04-22 20:44:06,448 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 20:44:06,448 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 188.1%
2022-04-22 20:44:38,386 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.876, Acc: 0.929, Base Lr: 1.19e-03
2022-04-22 20:44:54,131 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.314[s] Speed: 51.0[samples/s]
2022-04-22 20:45:39,301 reid_baseline.train INFO: normal accuracy 0.6274914089347079 1.8695685863494873 
2022-04-22 20:46:13,917 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 20:46:13,918 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 187.0%
2022-04-22 20:46:53,350 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.869, Acc: 0.925, Base Lr: 7.78e-04
2022-04-22 20:47:11,923 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.382[s] Speed: 41.9[samples/s]
2022-04-22 20:48:09,001 reid_baseline.train INFO: normal accuracy 0.6256586483390607 1.7780667543411255 
2022-04-22 20:48:44,207 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 20:48:44,207 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 177.8%
2022-04-22 20:49:16,280 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.843, Acc: 0.932, Base Lr: 4.51e-04
2022-04-22 20:49:31,408 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-22 20:50:10,291 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.894232153892517 
2022-04-22 20:50:10,291 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 20:50:10,292 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 189.4%
2022-04-22 20:50:41,663 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.861, Acc: 0.931, Base Lr: 2.11e-04
2022-04-22 20:50:56,706 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 20:51:41,354 reid_baseline.train INFO: normal accuracy 0.6313860252004582 1.8469738960266113 
2022-04-22 20:51:41,355 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 20:51:41,355 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 184.7%
2022-04-22 20:52:12,535 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.853, Acc: 0.925, Base Lr: 6.51e-05
2022-04-22 20:52:27,615 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-22 20:53:07,956 reid_baseline.train INFO: normal accuracy 0.6265750286368843 1.8789454698562622 
2022-04-22 20:53:07,956 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 20:53:07,957 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 187.9%
2022-04-22 20:53:39,351 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.858, Acc: 0.921, Base Lr: 1.60e-05
2022-04-22 20:53:54,148 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-22 20:55:01,228 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.8789671659469604 
2022-04-22 20:55:01,229 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 20:55:01,229 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-22 20:56:17,130 reid_baseline.train INFO: normal accuracy 0.6256586483390607 1.7780667543411255 
2022-04-22 20:56:17,131 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 20:56:17,131 reid_baseline.train INFO: Accuracy: 62.6%
2022-04-22 20:57:12,995 reid_baseline.train INFO: normal accuracy 0.6256586483390607 1.7780667543411255 
2022-04-22 20:57:12,996 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 20:57:12,996 reid_baseline.train INFO: Shuffled Accuracy: 62.6%
2022-04-22 20:57:41,170 reid_baseline.train INFO: normal accuracy 0.9719818706221672 0.8021050691604614 
2022-04-22 20:57:41,171 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 20:57:41,171 reid_baseline.train INFO: Source Clean Accuracy: 97.2%
2022-04-22 20:57:46,116 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2
2022-04-22 20:57:46,116 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-22 20:57:46,117 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 20:57:46,117 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 20:57:46,118 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 20:57:53,862 reid_baseline.train INFO: start training
2022-04-22 20:58:27,430 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.988, Acc: 0.284, Base Lr: 8.72e-04
2022-04-22 20:58:43,732 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.326[s] Speed: 49.1[samples/s]
2022-04-22 20:59:21,962 reid_baseline.train INFO: normal accuracy 0.5199369227303446 4.172039985656738 
2022-04-22 20:59:57,161 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 20:59:57,162 reid_baseline.train INFO: Accuracy: 52.0% Mean Entropy: 417.2%
2022-04-22 21:00:34,046 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.674, Acc: 0.597, Base Lr: 1.66e-03
2022-04-22 21:00:49,191 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.342[s] Speed: 46.7[samples/s]
2022-04-22 21:01:27,350 reid_baseline.train INFO: normal accuracy 0.5415634151836 4.1534271240234375 
2022-04-22 21:02:03,490 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 21:02:03,490 reid_baseline.train INFO: Accuracy: 54.2% Mean Entropy: 415.3%
2022-04-22 21:02:40,137 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.112, Acc: 0.635, Base Lr: 2.46e-03
2022-04-22 21:02:55,358 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-22 21:03:55,147 reid_baseline.train INFO: normal accuracy 0.5465194863708043 3.998955011367798 
2022-04-22 21:04:35,087 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 21:04:35,087 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 399.9%
2022-04-22 21:05:14,960 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.331, Acc: 0.660, Base Lr: 3.25e-03
2022-04-22 21:05:30,404 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.364[s] Speed: 44.0[samples/s]
2022-04-22 21:06:06,319 reid_baseline.train INFO: normal accuracy 0.5836900202748366 3.456566572189331 
2022-04-22 21:06:41,136 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 21:06:41,137 reid_baseline.train INFO: Accuracy: 58.4% Mean Entropy: 345.7%
2022-04-22 21:07:16,598 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.802, Acc: 0.699, Base Lr: 4.04e-03
2022-04-22 21:07:32,105 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.335[s] Speed: 47.7[samples/s]
2022-04-22 21:08:12,804 reid_baseline.train INFO: normal accuracy 0.6591574678981753 2.836405038833618 
2022-04-22 21:08:55,835 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 21:08:55,835 reid_baseline.train INFO: Accuracy: 65.9% Mean Entropy: 283.6%
2022-04-22 21:09:37,072 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.493, Acc: 0.757, Base Lr: 4.83e-03
2022-04-22 21:09:52,988 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-04-22 21:10:27,095 reid_baseline.train INFO: normal accuracy 0.7249380491101599 2.4514033794403076 
2022-04-22 21:11:01,745 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 21:11:01,745 reid_baseline.train INFO: Accuracy: 72.5% Mean Entropy: 245.1%
2022-04-22 21:11:34,253 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.327, Acc: 0.788, Base Lr: 5.62e-03
2022-04-22 21:11:49,023 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-22 21:12:23,926 reid_baseline.train INFO: normal accuracy 0.7512953367875648 2.1208479404449463 
2022-04-22 21:12:57,384 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 21:12:57,384 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 212.1%
2022-04-22 21:13:36,201 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.135, Acc: 0.852, Base Lr: 6.42e-03
2022-04-22 21:13:54,513 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-04-22 21:14:32,531 reid_baseline.train INFO: normal accuracy 0.765938274386123 1.9088102579116821 
2022-04-22 21:15:05,929 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 21:15:05,930 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 190.9%
2022-04-22 21:15:38,262 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.069, Acc: 0.871, Base Lr: 7.21e-03
2022-04-22 21:15:53,347 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-22 21:16:33,343 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.7560938596725464 
2022-04-22 21:17:08,712 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 21:17:08,713 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.6%
2022-04-22 21:17:41,478 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.980, Acc: 0.889, Base Lr: 4.01e-03
2022-04-22 21:17:56,403 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.314[s] Speed: 51.0[samples/s]
2022-04-22 21:19:08,506 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.7478594779968262 
2022-04-22 21:19:44,738 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 21:19:44,738 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 174.8%
2022-04-22 21:20:16,426 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.950, Acc: 0.910, Base Lr: 3.38e-03
2022-04-22 21:20:31,451 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 21:21:11,216 reid_baseline.train INFO: normal accuracy 0.780806487947736 1.7116997241973877 
2022-04-22 21:21:45,564 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 21:21:45,564 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 171.2%
2022-04-22 21:22:20,833 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.915, Acc: 0.914, Base Lr: 2.77e-03
2022-04-22 21:22:39,299 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.353[s] Speed: 45.3[samples/s]
2022-04-22 21:23:19,290 reid_baseline.train INFO: normal accuracy 0.7801306600585718 1.6791675090789795 
2022-04-22 21:23:54,407 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 21:23:54,408 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 167.9%
2022-04-22 21:24:26,491 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.907, Acc: 0.905, Base Lr: 2.20e-03
2022-04-22 21:24:44,039 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.326[s] Speed: 49.0[samples/s]
2022-04-22 21:25:22,103 reid_baseline.train INFO: normal accuracy 0.779905384095517 1.7253996133804321 
2022-04-22 21:25:22,104 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 21:25:22,104 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 172.5%
2022-04-22 21:25:53,568 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.887, Acc: 0.915, Base Lr: 1.66e-03
2022-04-22 21:26:08,956 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-22 21:26:48,744 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.6812633275985718 
2022-04-22 21:26:48,744 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 21:26:48,744 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 168.1%
2022-04-22 21:27:20,685 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.876, Acc: 0.929, Base Lr: 1.19e-03
2022-04-22 21:27:37,903 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.323[s] Speed: 49.5[samples/s]
2022-04-22 21:28:13,055 reid_baseline.train INFO: normal accuracy 0.7844109033566119 1.682844877243042 
2022-04-22 21:28:13,056 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 21:28:13,057 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 168.3%
2022-04-22 21:28:44,135 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.869, Acc: 0.925, Base Lr: 7.78e-04
2022-04-22 21:28:59,227 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-22 21:29:59,062 reid_baseline.train INFO: normal accuracy 0.7830592475782834 1.5810497999191284 
2022-04-22 21:30:34,287 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 21:30:34,287 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 158.1%
2022-04-22 21:31:12,259 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.843, Acc: 0.933, Base Lr: 4.51e-04
2022-04-22 21:31:30,599 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.370[s] Speed: 43.2[samples/s]
2022-04-22 21:32:10,458 reid_baseline.train INFO: normal accuracy 0.7837350754674476 1.69321870803833 
2022-04-22 21:32:10,459 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 21:32:10,459 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 169.3%
2022-04-22 21:32:44,172 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.861, Acc: 0.930, Base Lr: 2.11e-04
2022-04-22 21:32:58,892 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-22 21:33:34,718 reid_baseline.train INFO: normal accuracy 0.7830592475782834 1.6504319906234741 
2022-04-22 21:33:34,719 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 21:33:34,719 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 165.0%
2022-04-22 21:34:06,389 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.853, Acc: 0.926, Base Lr: 6.51e-05
2022-04-22 21:34:21,741 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-22 21:35:14,316 reid_baseline.train INFO: normal accuracy 0.780806487947736 1.6899425983428955 
2022-04-22 21:35:14,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 21:35:14,317 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 169.0%
2022-04-22 21:35:45,802 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.858, Acc: 0.921, Base Lr: 1.60e-05
2022-04-22 21:36:00,330 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-22 21:37:11,014 reid_baseline.train INFO: normal accuracy 0.781707591799955 1.6889795064926147 
2022-04-22 21:37:11,014 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 21:37:11,014 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 168.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-22 21:38:42,988 reid_baseline.train INFO: normal accuracy 0.7830592475782834 1.5810497999191284 
2022-04-22 21:38:42,988 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 21:38:42,989 reid_baseline.train INFO: Accuracy: 78.3%
2022-04-22 21:39:18,856 reid_baseline.train INFO: normal accuracy 0.7830592475782834 1.5810497999191284 
2022-04-22 21:39:18,856 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 21:39:18,856 reid_baseline.train INFO: Shuffled Accuracy: 78.3%
2022-04-22 21:39:45,038 reid_baseline.train INFO: normal accuracy 0.9719818706221672 0.802662193775177 
2022-04-22 21:39:45,039 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 21:39:45,039 reid_baseline.train INFO: Source Clean Accuracy: 97.2%
2022-04-22 21:39:51,057 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2
2022-04-22 21:39:51,057 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=2)
2022-04-22 21:39:51,057 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 21:39:51,064 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 21:39:51,065 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 21:39:59,477 reid_baseline.train INFO: start training
2022-04-22 21:40:40,668 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.988, Acc: 0.283, Base Lr: 8.72e-04
2022-04-22 21:41:00,560 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.400[s] Speed: 40.0[samples/s]
2022-04-22 21:42:33,898 reid_baseline.train INFO: normal accuracy 0.6001836125774616 4.171780109405518 
2022-04-22 21:43:10,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 21:43:10,289 reid_baseline.train INFO: Accuracy: 60.0% Mean Entropy: 417.2%
2022-04-22 21:43:42,062 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.674, Acc: 0.597, Base Lr: 1.66e-03
2022-04-22 21:43:57,097 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-22 21:45:23,591 reid_baseline.train INFO: normal accuracy 0.6231351847601561 4.145033359527588 
2022-04-22 21:45:57,969 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 21:45:57,970 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 414.5%
2022-04-22 21:46:29,816 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.112, Acc: 0.635, Base Lr: 2.46e-03
2022-04-22 21:46:44,944 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-22 21:48:21,457 reid_baseline.train INFO: normal accuracy 0.6346109708515033 3.9000768661499023 
2022-04-22 21:48:57,440 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 21:48:57,441 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 390.0%
2022-04-22 21:49:34,768 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.331, Acc: 0.658, Base Lr: 3.25e-03
2022-04-22 21:49:53,540 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-04-22 21:51:21,963 reid_baseline.train INFO: normal accuracy 0.6701859077346798 3.1778481006622314 
2022-04-22 21:52:09,951 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 21:52:09,951 reid_baseline.train INFO: Accuracy: 67.0% Mean Entropy: 317.8%
2022-04-22 21:52:40,689 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.802, Acc: 0.699, Base Lr: 4.04e-03
2022-04-22 21:52:55,753 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-22 21:54:07,809 reid_baseline.train INFO: normal accuracy 0.7319256369061281 2.516273260116577 
2022-04-22 21:54:43,932 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 21:54:43,932 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 251.6%
2022-04-22 21:55:20,280 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.493, Acc: 0.757, Base Lr: 4.83e-03
2022-04-22 21:55:35,007 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.336[s] Speed: 47.6[samples/s]
2022-04-22 21:56:50,261 reid_baseline.train INFO: normal accuracy 0.7815010328207482 2.1295642852783203 
2022-04-22 21:57:25,811 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 21:57:25,811 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 213.0%
2022-04-22 21:57:58,136 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.327, Acc: 0.788, Base Lr: 5.62e-03
2022-04-22 21:58:16,005 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-22 21:59:39,690 reid_baseline.train INFO: normal accuracy 0.8088134037181547 1.8507486581802368 
2022-04-22 22:00:13,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 22:00:13,846 reid_baseline.train INFO: Accuracy: 80.9% Mean Entropy: 185.1%
2022-04-22 22:00:44,922 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.135, Acc: 0.852, Base Lr: 6.42e-03
2022-04-22 22:00:59,623 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-22 22:02:29,583 reid_baseline.train INFO: normal accuracy 0.8182235483130594 1.6562869548797607 
2022-04-22 22:03:05,126 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 22:03:05,126 reid_baseline.train INFO: Accuracy: 81.8% Mean Entropy: 165.6%
2022-04-22 22:03:37,113 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.069, Acc: 0.870, Base Lr: 7.21e-03
2022-04-22 22:03:51,900 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 22:05:08,046 reid_baseline.train INFO: normal accuracy 0.8207482212531558 1.5152766704559326 
2022-04-22 22:05:43,905 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 22:05:43,905 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 151.5%
2022-04-22 22:06:15,977 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 2.980, Acc: 0.889, Base Lr: 4.01e-03
2022-04-22 22:06:30,686 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 22:08:35,313 reid_baseline.train INFO: normal accuracy 0.8260270828551756 1.4973030090332031 
2022-04-22 22:09:09,054 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 22:09:09,054 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 149.7%
2022-04-22 22:09:44,333 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.950, Acc: 0.910, Base Lr: 3.38e-03
2022-04-22 22:09:59,175 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-22 22:11:14,900 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4503406286239624 
2022-04-22 22:11:50,668 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 22:11:50,669 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 145.0%
2022-04-22 22:12:22,381 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.915, Acc: 0.914, Base Lr: 2.77e-03
2022-04-22 22:12:37,210 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-22 22:13:52,070 reid_baseline.train INFO: normal accuracy 0.8322240073445031 1.4359214305877686 
2022-04-22 22:14:22,867 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 22:14:22,868 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.6%
2022-04-22 22:14:53,263 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.907, Acc: 0.905, Base Lr: 2.20e-03
2022-04-22 22:15:08,802 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-22 22:16:18,978 reid_baseline.train INFO: normal accuracy 0.8331420702318109 1.4855310916900635 
2022-04-22 22:16:18,978 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 22:16:18,978 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 148.6%
2022-04-22 22:17:00,389 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.887, Acc: 0.915, Base Lr: 1.66e-03
2022-04-22 22:17:18,775 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.393[s] Speed: 40.7[samples/s]
2022-04-22 22:18:23,555 reid_baseline.train INFO: normal accuracy 0.8333715859536378 1.454524278640747 
2022-04-22 22:18:23,556 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 22:18:23,556 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 145.5%
2022-04-22 22:18:53,849 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.876, Acc: 0.929, Base Lr: 1.19e-03
2022-04-22 22:19:09,025 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 22:20:11,810 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4570766687393188 
2022-04-22 22:20:11,811 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 22:20:11,811 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.7%
2022-04-22 22:20:42,137 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.869, Acc: 0.925, Base Lr: 7.78e-04
2022-04-22 22:20:56,700 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-22 22:21:57,441 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.363275170326233 
2022-04-22 22:22:28,324 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 22:22:28,325 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 136.3%
2022-04-22 22:22:58,517 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.843, Acc: 0.933, Base Lr: 4.51e-04
2022-04-22 22:23:13,101 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-22 22:24:19,142 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4740029573440552 
2022-04-22 22:24:19,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 22:24:19,142 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 147.4%
2022-04-22 22:24:49,732 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.861, Acc: 0.930, Base Lr: 2.11e-04
2022-04-22 22:25:03,884 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-22 22:26:11,065 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4325395822525024 
2022-04-22 22:26:11,066 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 22:26:11,067 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 143.3%
2022-04-22 22:26:43,673 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.853, Acc: 0.926, Base Lr: 6.51e-05
2022-04-22 22:26:58,605 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-22 22:28:01,611 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4659523963928223 
2022-04-22 22:28:01,611 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 22:28:01,611 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-22 22:28:31,723 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.858, Acc: 0.921, Base Lr: 1.60e-05
2022-04-22 22:28:45,971 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-22 22:30:18,424 reid_baseline.train INFO: normal accuracy 0.836584806059215 1.4659628868103027 
2022-04-22 22:30:18,424 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 22:30:18,424 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 146.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_2/transformer_best_model.pth
2022-04-22 22:31:55,812 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.363275170326233 
2022-04-22 22:31:55,813 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 22:31:55,813 reid_baseline.train INFO: Accuracy: 83.7%
2022-04-22 22:32:57,193 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.363275170326233 
2022-04-22 22:32:57,193 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 22:32:57,194 reid_baseline.train INFO: Shuffled Accuracy: 83.7%
2022-04-22 22:33:17,262 reid_baseline.train INFO: normal accuracy 0.9719818706221672 0.8022933602333069 
2022-04-22 22:33:17,262 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 22:33:17,262 reid_baseline.train INFO: Source Clean Accuracy: 97.2%
2022-04-22 22:33:21,861 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3
2022-04-22 22:33:21,861 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-22 22:33:21,862 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 22:33:21,862 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 22:33:21,863 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 22:33:29,564 reid_baseline.train INFO: start training
2022-04-22 22:34:02,464 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.005, Acc: 0.275, Base Lr: 8.72e-04
2022-04-22 22:34:20,621 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.334[s] Speed: 47.9[samples/s]
2022-04-22 22:34:51,942 reid_baseline.train INFO: normal accuracy 0.3935853379152348 4.172083377838135 
2022-04-22 22:35:22,027 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 22:35:22,027 reid_baseline.train INFO: Accuracy: 39.4% Mean Entropy: 417.2%
2022-04-22 22:35:52,792 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.719, Acc: 0.587, Base Lr: 1.66e-03
2022-04-22 22:36:07,716 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-22 22:36:42,282 reid_baseline.train INFO: normal accuracy 0.422680412371134 4.158843517303467 
2022-04-22 22:37:13,043 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 22:37:13,043 reid_baseline.train INFO: Accuracy: 42.3% Mean Entropy: 415.9%
2022-04-22 22:37:44,012 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.205, Acc: 0.630, Base Lr: 2.46e-03
2022-04-22 22:37:59,055 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-22 22:38:48,674 reid_baseline.train INFO: normal accuracy 0.4449026345933562 4.050985336303711 
2022-04-22 22:39:19,248 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 22:39:19,249 reid_baseline.train INFO: Accuracy: 44.5% Mean Entropy: 405.1%
2022-04-22 22:39:50,733 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.441, Acc: 0.654, Base Lr: 3.25e-03
2022-04-22 22:40:05,901 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-22 22:40:45,970 reid_baseline.train INFO: normal accuracy 0.46987399770904925 3.5948967933654785 
2022-04-22 22:41:17,199 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 22:41:17,199 reid_baseline.train INFO: Accuracy: 47.0% Mean Entropy: 359.5%
2022-04-22 22:41:47,646 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.885, Acc: 0.689, Base Lr: 4.04e-03
2022-04-22 22:42:02,807 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 22:42:29,370 reid_baseline.train INFO: normal accuracy 0.52737686139748 3.1239655017852783 
2022-04-22 22:43:00,294 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 22:43:00,294 reid_baseline.train INFO: Accuracy: 52.7% Mean Entropy: 312.4%
2022-04-22 22:43:38,372 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.541, Acc: 0.745, Base Lr: 4.83e-03
2022-04-22 22:43:56,887 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-22 22:44:31,710 reid_baseline.train INFO: normal accuracy 0.5958762886597938 2.766300678253174 
2022-04-22 22:45:02,571 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 22:45:02,571 reid_baseline.train INFO: Accuracy: 59.6% Mean Entropy: 276.6%
2022-04-22 22:45:34,003 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.354, Acc: 0.788, Base Lr: 5.62e-03
2022-04-22 22:45:48,633 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-22 22:46:14,211 reid_baseline.train INFO: normal accuracy 0.6006872852233677 2.440082550048828 
2022-04-22 22:46:44,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 22:46:44,752 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 244.0%
2022-04-22 22:47:15,203 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.156, Acc: 0.846, Base Lr: 6.42e-03
2022-04-22 22:47:29,806 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-22 22:47:56,708 reid_baseline.train INFO: normal accuracy 0.6050400916380297 2.1904213428497314 
2022-04-22 22:48:27,152 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 22:48:27,153 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 219.0%
2022-04-22 22:48:58,329 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.102, Acc: 0.863, Base Lr: 7.21e-03
2022-04-22 22:49:13,054 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.302[s] Speed: 53.1[samples/s]
2022-04-22 22:49:42,758 reid_baseline.train INFO: normal accuracy 0.606643757159221 2.0510025024414062 
2022-04-22 22:50:14,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 22:50:14,277 reid_baseline.train INFO: Accuracy: 60.7% Mean Entropy: 205.1%
2022-04-22 22:50:45,798 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.017, Acc: 0.887, Base Lr: 4.01e-03
2022-04-22 22:51:00,907 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.306[s] Speed: 52.2[samples/s]
2022-04-22 22:52:41,004 reid_baseline.train INFO: normal accuracy 0.6144329896907217 2.0100247859954834 
2022-04-22 22:53:11,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 22:53:11,587 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 201.0%
2022-04-22 22:53:43,268 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.957, Acc: 0.906, Base Lr: 3.38e-03
2022-04-22 22:53:58,059 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 22:54:24,208 reid_baseline.train INFO: normal accuracy 0.6155784650630012 1.9334743022918701 
2022-04-22 22:54:54,811 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 22:54:54,812 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 193.3%
2022-04-22 22:55:25,492 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.934, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 22:55:40,209 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 22:56:05,844 reid_baseline.train INFO: normal accuracy 0.6206185567010309 1.9370914697647095 
2022-04-22 22:56:05,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 22:56:05,845 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 193.7%
2022-04-22 22:56:36,611 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.942, Acc: 0.905, Base Lr: 2.20e-03
2022-04-22 22:56:52,309 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-22 22:57:18,934 reid_baseline.train INFO: normal accuracy 0.6210767468499427 1.9496655464172363 
2022-04-22 22:57:18,935 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 22:57:18,935 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 195.0%
2022-04-22 22:57:49,151 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.909, Acc: 0.908, Base Lr: 1.66e-03
2022-04-22 22:58:04,153 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-22 22:58:30,332 reid_baseline.train INFO: normal accuracy 0.622680412371134 1.9242550134658813 
2022-04-22 22:59:01,085 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 22:59:01,086 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 192.4%
2022-04-22 22:59:31,863 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.896, Acc: 0.925, Base Lr: 1.19e-03
2022-04-22 22:59:47,149 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-22 23:00:12,408 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.9051544666290283 
2022-04-22 23:00:43,077 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 23:00:43,078 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 190.5%
2022-04-22 23:01:16,767 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.899, Acc: 0.914, Base Lr: 7.78e-04
2022-04-22 23:01:35,034 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-22 23:02:04,933 reid_baseline.train INFO: normal accuracy 0.6263459335624284 1.812718391418457 
2022-04-22 23:02:49,762 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 23:02:49,762 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 181.3%
2022-04-22 23:03:22,967 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.868, Acc: 0.927, Base Lr: 4.51e-04
2022-04-22 23:03:38,157 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-22 23:04:06,779 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.9088703393936157 
2022-04-22 23:04:06,780 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 23:04:06,780 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 190.9%
2022-04-22 23:04:37,281 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.877, Acc: 0.923, Base Lr: 2.11e-04
2022-04-22 23:04:51,730 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-22 23:05:16,918 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.8755083084106445 
2022-04-22 23:05:16,918 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 23:05:16,919 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 187.6%
2022-04-22 23:05:47,639 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.872, Acc: 0.922, Base Lr: 6.51e-05
2022-04-22 23:06:02,592 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.300[s] Speed: 53.2[samples/s]
2022-04-22 23:06:29,152 reid_baseline.train INFO: normal accuracy 0.6270332187857961 1.9023406505584717 
2022-04-22 23:06:29,153 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 23:06:29,153 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 190.2%
2022-04-22 23:06:59,545 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.869, Acc: 0.913, Base Lr: 1.60e-05
2022-04-22 23:07:13,887 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-22 23:08:10,209 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.9001083374023438 
2022-04-22 23:08:10,210 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 23:08:10,210 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 190.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-22 23:09:31,668 reid_baseline.train INFO: normal accuracy 0.6263459335624284 1.812718391418457 
2022-04-22 23:09:31,669 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 23:09:31,669 reid_baseline.train INFO: Accuracy: 62.6%
2022-04-22 23:10:15,055 reid_baseline.train INFO: normal accuracy 0.6263459335624284 1.812718391418457 
2022-04-22 23:10:15,055 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 23:10:15,056 reid_baseline.train INFO: Shuffled Accuracy: 62.6%
2022-04-22 23:10:38,764 reid_baseline.train INFO: normal accuracy 0.9670374948496085 0.8316613435745239 
2022-04-22 23:10:38,764 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 23:10:38,764 reid_baseline.train INFO: Source Clean Accuracy: 96.7%
2022-04-22 23:10:43,427 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3
2022-04-22 23:10:43,427 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-22 23:10:43,427 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 23:10:43,428 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 23:10:43,428 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 23:10:52,825 reid_baseline.train INFO: start training
2022-04-22 23:11:31,022 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.005, Acc: 0.275, Base Lr: 8.72e-04
2022-04-22 23:11:47,076 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.355[s] Speed: 45.1[samples/s]
2022-04-22 23:12:24,363 reid_baseline.train INFO: normal accuracy 0.5149808515431403 4.172292709350586 
2022-04-22 23:12:55,764 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 23:12:55,764 reid_baseline.train INFO: Accuracy: 51.5% Mean Entropy: 417.2%
2022-04-22 23:13:26,761 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.719, Acc: 0.586, Base Lr: 1.66e-03
2022-04-22 23:13:41,891 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.303[s] Speed: 52.7[samples/s]
2022-04-22 23:14:07,783 reid_baseline.train INFO: normal accuracy 0.5447172786663663 4.1585540771484375 
2022-04-22 23:14:38,872 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 23:14:38,873 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 415.9%
2022-04-22 23:15:10,049 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.205, Acc: 0.630, Base Lr: 2.46e-03
2022-04-22 23:15:25,612 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.307[s] Speed: 52.0[samples/s]
2022-04-22 23:16:24,695 reid_baseline.train INFO: normal accuracy 0.5487722460013517 4.037757873535156 
2022-04-22 23:16:56,053 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 23:16:56,054 reid_baseline.train INFO: Accuracy: 54.9% Mean Entropy: 403.8%
2022-04-22 23:17:27,727 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.441, Acc: 0.654, Base Lr: 3.25e-03
2022-04-22 23:17:42,877 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-22 23:18:08,823 reid_baseline.train INFO: normal accuracy 0.5710745663437711 3.5590033531188965 
2022-04-22 23:18:40,457 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 23:18:40,458 reid_baseline.train INFO: Accuracy: 57.1% Mean Entropy: 355.9%
2022-04-22 23:19:12,367 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.885, Acc: 0.689, Base Lr: 4.04e-03
2022-04-22 23:19:31,481 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.336[s] Speed: 47.7[samples/s]
2022-04-22 23:20:02,290 reid_baseline.train INFO: normal accuracy 0.643613426447398 2.9685299396514893 
2022-04-22 23:20:33,658 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-22 23:20:33,658 reid_baseline.train INFO: Accuracy: 64.4% Mean Entropy: 296.9%
2022-04-22 23:21:04,452 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.541, Acc: 0.743, Base Lr: 4.83e-03
2022-04-22 23:21:19,198 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-22 23:21:45,511 reid_baseline.train INFO: normal accuracy 0.7206578058121198 2.563278913497925 
2022-04-22 23:22:16,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-22 23:22:16,491 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 256.3%
2022-04-22 23:22:48,018 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.354, Acc: 0.788, Base Lr: 5.62e-03
2022-04-22 23:23:02,706 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-22 23:23:29,241 reid_baseline.train INFO: normal accuracy 0.7481414733047984 2.1890790462493896 
2022-04-22 23:24:00,956 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-22 23:24:00,957 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 218.9%
2022-04-22 23:24:31,535 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.156, Acc: 0.845, Base Lr: 6.42e-03
2022-04-22 23:24:46,326 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-22 23:25:13,109 reid_baseline.train INFO: normal accuracy 0.7612074791619734 1.9540966749191284 
2022-04-22 23:25:44,063 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-22 23:25:44,064 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 195.4%
2022-04-22 23:26:15,260 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.102, Acc: 0.864, Base Lr: 7.21e-03
2022-04-22 23:26:30,104 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-22 23:26:56,694 reid_baseline.train INFO: normal accuracy 0.7672899301644515 1.8289196491241455 
2022-04-22 23:27:27,327 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-22 23:27:27,327 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 182.9%
2022-04-22 23:27:58,956 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.017, Acc: 0.887, Base Lr: 4.01e-03
2022-04-22 23:28:16,147 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-22 23:29:25,757 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.8020786046981812 
2022-04-22 23:29:56,060 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-22 23:29:56,061 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 180.2%
2022-04-22 23:30:26,790 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.957, Acc: 0.905, Base Lr: 3.38e-03
2022-04-22 23:30:41,665 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-22 23:31:08,463 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.734289526939392 
2022-04-22 23:31:42,143 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-22 23:31:42,144 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 173.4%
2022-04-22 23:32:12,975 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.934, Acc: 0.911, Base Lr: 2.77e-03
2022-04-22 23:32:27,680 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-22 23:33:03,597 reid_baseline.train INFO: normal accuracy 0.7760756927235863 1.7159372568130493 
2022-04-22 23:34:24,050 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-22 23:34:24,050 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 171.6%
2022-04-22 23:34:55,082 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.942, Acc: 0.906, Base Lr: 2.20e-03
2022-04-22 23:35:10,977 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-22 23:35:37,498 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.7499749660491943 
2022-04-22 23:35:37,499 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-22 23:35:37,499 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.0%
2022-04-22 23:36:07,883 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.910, Acc: 0.908, Base Lr: 1.66e-03
2022-04-22 23:36:22,928 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-22 23:36:49,639 reid_baseline.train INFO: normal accuracy 0.7810317639107908 1.7129403352737427 
2022-04-22 23:37:20,643 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-22 23:37:20,644 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 171.3%
2022-04-22 23:37:59,467 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.896, Acc: 0.925, Base Lr: 1.19e-03
2022-04-22 23:38:18,284 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.379[s] Speed: 42.2[samples/s]
2022-04-22 23:38:44,828 reid_baseline.train INFO: normal accuracy 0.779004280243298 1.697361707687378 
2022-04-22 23:39:16,043 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-22 23:39:16,044 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 169.7%
2022-04-22 23:39:47,042 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.899, Acc: 0.914, Base Lr: 7.78e-04
2022-04-22 23:40:01,972 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-22 23:40:28,496 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.6025419235229492 
2022-04-22 23:40:59,279 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-22 23:40:59,280 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 160.3%
2022-04-22 23:41:29,779 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.868, Acc: 0.927, Base Lr: 4.51e-04
2022-04-22 23:41:44,659 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-22 23:42:11,047 reid_baseline.train INFO: normal accuracy 0.782608695652174 1.6941933631896973 
2022-04-22 23:42:11,048 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-22 23:42:11,048 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 169.4%
2022-04-22 23:42:41,849 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.877, Acc: 0.923, Base Lr: 2.11e-04
2022-04-22 23:42:56,392 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-22 23:43:48,276 reid_baseline.train INFO: normal accuracy 0.7805812119846812 1.6689180135726929 
2022-04-22 23:43:48,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-22 23:43:48,277 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 166.9%
2022-04-22 23:44:21,204 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.872, Acc: 0.922, Base Lr: 6.51e-05
2022-04-22 23:44:36,329 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-22 23:45:12,649 reid_baseline.train INFO: normal accuracy 0.7812570398738454 1.7014672756195068 
2022-04-22 23:45:12,649 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-22 23:45:12,649 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 170.1%
2022-04-22 23:45:43,396 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.869, Acc: 0.913, Base Lr: 1.60e-05
2022-04-22 23:45:57,900 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-22 23:47:07,858 reid_baseline.train INFO: normal accuracy 0.7794548321694075 1.6998646259307861 
2022-04-22 23:47:07,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-22 23:47:07,859 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 170.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-22 23:48:08,717 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.6025419235229492 
2022-04-22 23:48:08,717 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 23:48:08,717 reid_baseline.train INFO: Accuracy: 77.8%
2022-04-22 23:48:37,489 reid_baseline.train INFO: normal accuracy 0.7778779004280243 1.6025419235229492 
2022-04-22 23:48:37,489 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 23:48:37,489 reid_baseline.train INFO: Shuffled Accuracy: 77.8%
2022-04-22 23:48:57,610 reid_baseline.train INFO: normal accuracy 0.9670374948496085 0.8317424654960632 
2022-04-22 23:48:57,611 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-22 23:48:57,611 reid_baseline.train INFO: Source Clean Accuracy: 96.7%
2022-04-22 23:49:02,202 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3
2022-04-22 23:49:02,202 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=3)
2022-04-22 23:49:02,202 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-22 23:49:02,203 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-22 23:49:02,204 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-22 23:49:09,988 reid_baseline.train INFO: start training
2022-04-22 23:49:43,046 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.005, Acc: 0.276, Base Lr: 8.72e-04
2022-04-22 23:49:59,166 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.322[s] Speed: 49.8[samples/s]
2022-04-22 23:51:05,086 reid_baseline.train INFO: normal accuracy 0.5891668579297682 4.172091960906982 
2022-04-22 23:51:44,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-22 23:51:44,173 reid_baseline.train INFO: Accuracy: 58.9% Mean Entropy: 417.2%
2022-04-22 23:52:17,417 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.719, Acc: 0.586, Base Lr: 1.66e-03
2022-04-22 23:52:32,922 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-22 23:53:41,930 reid_baseline.train INFO: normal accuracy 0.6224466375946752 4.152470111846924 
2022-04-22 23:54:17,714 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-22 23:54:17,714 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 415.2%
2022-04-22 23:54:49,214 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.205, Acc: 0.630, Base Lr: 2.46e-03
2022-04-22 23:55:06,383 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-22 23:56:16,996 reid_baseline.train INFO: normal accuracy 0.635758549460638 3.962306499481201 
2022-04-22 23:56:48,111 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-22 23:56:48,111 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 396.2%
2022-04-22 23:57:19,932 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.441, Acc: 0.654, Base Lr: 3.25e-03
2022-04-22 23:57:35,228 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-22 23:58:36,519 reid_baseline.train INFO: normal accuracy 0.6639889832453523 3.320791244506836 
2022-04-22 23:59:09,967 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-22 23:59:09,968 reid_baseline.train INFO: Accuracy: 66.4% Mean Entropy: 332.1%
2022-04-22 23:59:41,137 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.885, Acc: 0.688, Base Lr: 4.04e-03
2022-04-22 23:59:56,443 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-23 00:01:30,147 reid_baseline.train INFO: normal accuracy 0.7236630709203581 2.648493528366089 
2022-04-23 00:02:27,353 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 00:02:27,353 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 264.8%
2022-04-23 00:02:58,189 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.541, Acc: 0.745, Base Lr: 4.83e-03
2022-04-23 00:03:12,983 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-23 00:04:17,213 reid_baseline.train INFO: normal accuracy 0.7730089511131513 2.239985942840576 
2022-04-23 00:04:47,843 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 00:04:47,843 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 224.0%
2022-04-23 00:05:22,810 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.354, Acc: 0.788, Base Lr: 5.62e-03
2022-04-23 00:05:37,492 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.327[s] Speed: 49.0[samples/s]
2022-04-23 00:06:40,003 reid_baseline.train INFO: normal accuracy 0.8019279320633463 1.9194852113723755 
2022-04-23 00:07:11,318 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 00:07:11,318 reid_baseline.train INFO: Accuracy: 80.2% Mean Entropy: 191.9%
2022-04-23 00:07:42,340 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.156, Acc: 0.846, Base Lr: 6.42e-03
2022-04-23 00:07:56,891 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-23 00:08:55,945 reid_baseline.train INFO: normal accuracy 0.8104200137709433 1.6965569257736206 
2022-04-23 00:09:38,934 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 00:09:38,934 reid_baseline.train INFO: Accuracy: 81.0% Mean Entropy: 169.7%
2022-04-23 00:10:12,289 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.102, Acc: 0.863, Base Lr: 7.21e-03
2022-04-23 00:10:27,524 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.320[s] Speed: 50.1[samples/s]
2022-04-23 00:11:32,952 reid_baseline.train INFO: normal accuracy 0.8175350011475786 1.561235785484314 
2022-04-23 00:12:03,707 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 00:12:03,707 reid_baseline.train INFO: Accuracy: 81.8% Mean Entropy: 156.1%
2022-04-23 00:12:35,473 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.017, Acc: 0.887, Base Lr: 4.01e-03
2022-04-23 00:12:50,519 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-23 00:14:26,973 reid_baseline.train INFO: normal accuracy 0.8239614413587331 1.5351788997650146 
2022-04-23 00:14:57,570 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 00:14:57,570 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 153.5%
2022-04-23 00:15:28,248 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.957, Acc: 0.906, Base Lr: 3.38e-03
2022-04-23 00:15:43,062 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 00:16:45,236 reid_baseline.train INFO: normal accuracy 0.828322240073445 1.4701480865478516 
2022-04-23 00:17:15,761 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 00:17:15,762 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 147.0%
2022-04-23 00:17:46,671 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.934, Acc: 0.911, Base Lr: 2.77e-03
2022-04-23 00:18:01,345 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-23 00:18:59,936 reid_baseline.train INFO: normal accuracy 0.8287812715170989 1.4719141721725464 
2022-04-23 00:18:59,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 00:18:59,937 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 147.2%
2022-04-23 00:19:30,959 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.942, Acc: 0.906, Base Lr: 2.20e-03
2022-04-23 00:19:46,920 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-23 00:20:47,153 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.5019893646240234 
2022-04-23 00:20:47,153 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 00:20:47,154 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 150.2%
2022-04-23 00:21:17,751 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.910, Acc: 0.908, Base Lr: 1.66e-03
2022-04-23 00:21:33,015 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-23 00:22:44,023 reid_baseline.train INFO: normal accuracy 0.8274041771861372 1.4766579866409302 
2022-04-23 00:22:44,023 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 00:22:44,024 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 147.7%
2022-04-23 00:23:17,520 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.896, Acc: 0.925, Base Lr: 1.19e-03
2022-04-23 00:23:32,857 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-23 00:24:35,107 reid_baseline.train INFO: normal accuracy 0.83245352306633 1.4679425954818726 
2022-04-23 00:25:05,547 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 00:25:05,547 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 146.8%
2022-04-23 00:25:36,463 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.899, Acc: 0.914, Base Lr: 7.78e-04
2022-04-23 00:25:51,328 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-23 00:26:52,007 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.380190134048462 
2022-04-23 00:27:22,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 00:27:22,687 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 138.0%
2022-04-23 00:27:53,373 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.868, Acc: 0.927, Base Lr: 4.51e-04
2022-04-23 00:28:08,407 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-23 00:29:20,890 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.4741950035095215 
2022-04-23 00:29:20,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 00:29:20,891 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 147.4%
2022-04-23 00:29:54,114 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.877, Acc: 0.923, Base Lr: 2.11e-04
2022-04-23 00:30:08,753 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.315[s] Speed: 50.8[samples/s]
2022-04-23 00:31:11,667 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.4493043422698975 
2022-04-23 00:31:11,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 00:31:11,668 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 144.9%
2022-04-23 00:31:50,532 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.872, Acc: 0.922, Base Lr: 6.51e-05
2022-04-23 00:32:08,085 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.371[s] Speed: 43.1[samples/s]
2022-04-23 00:33:10,939 reid_baseline.train INFO: normal accuracy 0.8322240073445031 1.4765311479568481 
2022-04-23 00:33:10,939 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 00:33:10,939 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 147.7%
2022-04-23 00:33:41,851 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.869, Acc: 0.914, Base Lr: 1.60e-05
2022-04-23 00:33:56,275 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 00:35:28,697 reid_baseline.train INFO: normal accuracy 0.8322240073445031 1.4762883186340332 
2022-04-23 00:35:28,698 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 00:35:28,698 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 147.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_3/transformer_best_model.pth
2022-04-23 00:37:00,256 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.380190134048462 
2022-04-23 00:37:00,257 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 00:37:00,257 reid_baseline.train INFO: Accuracy: 83.4%
2022-04-23 00:38:00,119 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.380190134048462 
2022-04-23 00:38:00,119 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 00:38:00,120 reid_baseline.train INFO: Shuffled Accuracy: 83.4%
2022-04-23 00:38:20,269 reid_baseline.train INFO: normal accuracy 0.9670374948496085 0.8315738439559937 
2022-04-23 00:38:20,269 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 00:38:20,269 reid_baseline.train INFO: Source Clean Accuracy: 96.7%
2022-04-23 00:38:24,914 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4
2022-04-23 00:38:24,914 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-23 00:38:24,915 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 00:38:24,916 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 00:38:24,916 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 00:38:32,750 reid_baseline.train INFO: start training
2022-04-23 00:39:05,790 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.997, Acc: 0.259, Base Lr: 8.72e-04
2022-04-23 00:39:21,799 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-23 00:39:48,854 reid_baseline.train INFO: normal accuracy 0.38579610538373427 4.172267436981201 
2022-04-23 00:40:19,400 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 00:40:19,401 reid_baseline.train INFO: Accuracy: 38.6% Mean Entropy: 417.2%
2022-04-23 00:40:58,005 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.721, Acc: 0.578, Base Lr: 1.66e-03
2022-04-23 00:41:14,452 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.362[s] Speed: 44.2[samples/s]
2022-04-23 00:41:40,396 reid_baseline.train INFO: normal accuracy 0.42107674684994273 4.16094446182251 
2022-04-23 00:42:10,951 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 00:42:10,951 reid_baseline.train INFO: Accuracy: 42.1% Mean Entropy: 416.1%
2022-04-23 00:42:42,461 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.276, Acc: 0.627, Base Lr: 2.46e-03
2022-04-23 00:42:57,626 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-23 00:43:24,813 reid_baseline.train INFO: normal accuracy 0.43963344788087055 4.076175212860107 
2022-04-23 00:43:55,329 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 00:43:55,330 reid_baseline.train INFO: Accuracy: 44.0% Mean Entropy: 407.6%
2022-04-23 00:44:27,142 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.560, Acc: 0.649, Base Lr: 3.25e-03
2022-04-23 00:44:42,428 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-23 00:45:07,466 reid_baseline.train INFO: normal accuracy 0.4584192439862543 3.672304391860962 
2022-04-23 00:45:37,990 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 00:45:37,990 reid_baseline.train INFO: Accuracy: 45.8% Mean Entropy: 367.2%
2022-04-23 00:46:08,639 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.949, Acc: 0.670, Base Lr: 4.04e-03
2022-04-23 00:46:23,787 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-23 00:46:49,867 reid_baseline.train INFO: normal accuracy 0.518213058419244 3.17121958732605 
2022-04-23 00:47:20,462 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 00:47:20,462 reid_baseline.train INFO: Accuracy: 51.8% Mean Entropy: 317.1%
2022-04-23 00:47:51,416 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.598, Acc: 0.732, Base Lr: 4.83e-03
2022-04-23 00:48:06,169 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-23 00:48:31,370 reid_baseline.train INFO: normal accuracy 0.5800687285223368 2.838430881500244 
2022-04-23 00:49:01,878 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 00:49:01,878 reid_baseline.train INFO: Accuracy: 58.0% Mean Entropy: 283.8%
2022-04-23 00:49:41,699 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.414, Acc: 0.777, Base Lr: 5.62e-03
2022-04-23 00:50:00,094 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-04-23 00:50:27,121 reid_baseline.train INFO: normal accuracy 0.5986254295532646 2.5031652450561523 
2022-04-23 00:50:57,784 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 00:50:57,785 reid_baseline.train INFO: Accuracy: 59.9% Mean Entropy: 250.3%
2022-04-23 00:51:28,486 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.201, Acc: 0.831, Base Lr: 6.42e-03
2022-04-23 00:51:43,213 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 00:52:10,267 reid_baseline.train INFO: normal accuracy 0.604352806414662 2.2444751262664795 
2022-04-23 00:52:41,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 00:52:41,021 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 224.4%
2022-04-23 00:53:12,111 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.147, Acc: 0.858, Base Lr: 7.21e-03
2022-04-23 00:53:27,014 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-23 00:53:52,840 reid_baseline.train INFO: normal accuracy 0.6059564719358533 2.071667194366455 
2022-04-23 00:54:23,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 00:54:23,492 reid_baseline.train INFO: Accuracy: 60.6% Mean Entropy: 207.2%
2022-04-23 00:54:55,193 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.050, Acc: 0.880, Base Lr: 4.01e-03
2022-04-23 00:55:10,157 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.307[s] Speed: 52.2[samples/s]
2022-04-23 00:56:07,272 reid_baseline.train INFO: normal accuracy 0.6167239404352807 2.0109808444976807 
2022-04-23 00:56:37,876 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 00:56:37,876 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 201.1%
2022-04-23 00:57:08,653 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.976, Acc: 0.900, Base Lr: 3.38e-03
2022-04-23 00:57:23,540 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-23 00:57:49,871 reid_baseline.train INFO: normal accuracy 0.6235967926689576 1.938843011856079 
2022-04-23 00:58:20,510 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 00:58:20,510 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 193.9%
2022-04-23 00:58:59,651 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.967, Acc: 0.903, Base Lr: 2.77e-03
2022-04-23 00:59:16,367 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-23 00:59:42,351 reid_baseline.train INFO: normal accuracy 0.6306987399770905 1.9335459470748901 
2022-04-23 01:00:13,002 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 01:00:13,003 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 193.4%
2022-04-23 01:00:44,231 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.949, Acc: 0.901, Base Lr: 2.20e-03
2022-04-23 01:01:00,250 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-23 01:01:26,501 reid_baseline.train INFO: normal accuracy 0.6215349369988545 1.9427580833435059 
2022-04-23 01:01:26,502 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 01:01:26,502 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 194.3%
2022-04-23 01:01:56,935 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.932, Acc: 0.909, Base Lr: 1.66e-03
2022-04-23 01:02:12,096 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-23 01:02:38,288 reid_baseline.train INFO: normal accuracy 0.6332187857961054 1.9116650819778442 
2022-04-23 01:03:08,993 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 01:03:08,993 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 191.2%
2022-04-23 01:03:39,927 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.912, Acc: 0.915, Base Lr: 1.19e-03
2022-04-23 01:03:55,307 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-23 01:04:20,726 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.9094117879867554 
2022-04-23 01:04:51,213 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 01:04:51,213 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 190.9%
2022-04-23 01:05:22,153 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.913, Acc: 0.909, Base Lr: 7.78e-04
2022-04-23 01:05:37,011 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-23 01:06:02,923 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.8168585300445557 
2022-04-23 01:06:33,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 01:06:33,602 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 181.7%
2022-04-23 01:07:07,001 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.877, Acc: 0.929, Base Lr: 4.51e-04
2022-04-23 01:07:25,750 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-23 01:07:55,931 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.9098963737487793 
2022-04-23 01:07:55,932 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 01:07:55,932 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 191.0%
2022-04-23 01:08:30,474 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.892, Acc: 0.914, Base Lr: 2.11e-04
2022-04-23 01:08:44,925 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.322[s] Speed: 49.6[samples/s]
2022-04-23 01:09:10,395 reid_baseline.train INFO: normal accuracy 0.6311569301260023 1.8726749420166016 
2022-04-23 01:09:10,396 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 01:09:10,396 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 187.3%
2022-04-23 01:09:41,325 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.880, Acc: 0.914, Base Lr: 6.51e-05
2022-04-23 01:09:56,474 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-23 01:10:23,107 reid_baseline.train INFO: normal accuracy 0.6297823596792669 1.8972574472427368 
2022-04-23 01:10:23,107 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 01:10:23,107 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 189.7%
2022-04-23 01:10:53,647 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.901, Acc: 0.910, Base Lr: 1.60e-05
2022-04-23 01:11:08,041 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 01:12:03,698 reid_baseline.train INFO: normal accuracy 0.6311569301260023 1.9077138900756836 
2022-04-23 01:12:03,698 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 01:12:03,699 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 190.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-23 01:12:59,316 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.8168585300445557 
2022-04-23 01:12:59,316 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 01:12:59,316 reid_baseline.train INFO: Accuracy: 62.9%
2022-04-23 01:13:25,470 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.8168585300445557 
2022-04-23 01:13:25,470 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 01:13:25,471 reid_baseline.train INFO: Shuffled Accuracy: 62.9%
2022-04-23 01:13:45,450 reid_baseline.train INFO: normal accuracy 0.9645653069633292 0.8607357144355774 
2022-04-23 01:13:45,450 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 01:13:45,450 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-23 01:13:50,045 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4
2022-04-23 01:13:50,045 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-23 01:13:50,045 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 01:13:50,045 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 01:13:50,046 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 01:13:57,771 reid_baseline.train INFO: start training
2022-04-23 01:14:31,006 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.997, Acc: 0.259, Base Lr: 8.72e-04
2022-04-23 01:14:47,014 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-23 01:15:13,153 reid_baseline.train INFO: normal accuracy 0.5131786438387024 4.172454357147217 
2022-04-23 01:15:43,728 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 01:15:43,728 reid_baseline.train INFO: Accuracy: 51.3% Mean Entropy: 417.2%
2022-04-23 01:16:18,790 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.721, Acc: 0.578, Base Lr: 1.66e-03
2022-04-23 01:16:37,516 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-23 01:17:07,865 reid_baseline.train INFO: normal accuracy 0.5384095517008335 4.160860061645508 
2022-04-23 01:17:38,506 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 01:17:38,507 reid_baseline.train INFO: Accuracy: 53.8% Mean Entropy: 416.1%
2022-04-23 01:18:10,331 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.276, Acc: 0.627, Base Lr: 2.46e-03
2022-04-23 01:18:25,892 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-23 01:19:13,502 reid_baseline.train INFO: normal accuracy 0.5449425546294211 4.064828872680664 
2022-04-23 01:19:44,133 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 01:19:44,134 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 406.5%
2022-04-23 01:20:15,906 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.560, Acc: 0.649, Base Lr: 3.25e-03
2022-04-23 01:20:31,122 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.309[s] Speed: 51.8[samples/s]
2022-04-23 01:20:57,077 reid_baseline.train INFO: normal accuracy 0.5618382518585266 3.6394317150115967 
2022-04-23 01:21:27,656 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 01:21:27,657 reid_baseline.train INFO: Accuracy: 56.2% Mean Entropy: 363.9%
2022-04-23 01:21:58,380 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.949, Acc: 0.670, Base Lr: 4.04e-03
2022-04-23 01:22:13,747 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-23 01:22:40,082 reid_baseline.train INFO: normal accuracy 0.6231133138094165 3.034824848175049 
2022-04-23 01:23:10,688 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 01:23:10,688 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 303.5%
2022-04-23 01:23:41,657 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.598, Acc: 0.731, Base Lr: 4.83e-03
2022-04-23 01:23:56,436 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-23 01:24:22,769 reid_baseline.train INFO: normal accuracy 0.7048884883982879 2.6331946849823 
2022-04-23 01:24:53,428 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 01:24:53,429 reid_baseline.train INFO: Accuracy: 70.5% Mean Entropy: 263.3%
2022-04-23 01:25:31,261 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.414, Acc: 0.777, Base Lr: 5.62e-03
2022-04-23 01:25:49,521 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-04-23 01:26:19,699 reid_baseline.train INFO: normal accuracy 0.7382293309303898 2.2730679512023926 
2022-04-23 01:26:50,245 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 01:26:50,245 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 227.3%
2022-04-23 01:27:20,944 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.201, Acc: 0.831, Base Lr: 6.42e-03
2022-04-23 01:27:35,566 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 01:28:02,331 reid_baseline.train INFO: normal accuracy 0.752872268528948 2.012432336807251 
2022-04-23 01:28:32,995 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 01:28:32,996 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 201.2%
2022-04-23 01:29:03,993 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.147, Acc: 0.858, Base Lr: 7.21e-03
2022-04-23 01:29:18,864 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-23 01:29:45,227 reid_baseline.train INFO: normal accuracy 0.7672899301644515 1.8514317274093628 
2022-04-23 01:30:16,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 01:30:16,001 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 185.1%
2022-04-23 01:30:47,534 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.050, Acc: 0.879, Base Lr: 4.01e-03
2022-04-23 01:31:02,369 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.305[s] Speed: 52.5[samples/s]
2022-04-23 01:32:00,109 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.8088558912277222 
2022-04-23 01:32:30,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 01:32:30,668 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 180.9%
2022-04-23 01:33:01,186 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.976, Acc: 0.901, Base Lr: 3.38e-03
2022-04-23 01:33:16,134 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 01:33:42,908 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.7545655965805054 
2022-04-23 01:34:13,473 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 01:34:13,473 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 175.5%
2022-04-23 01:34:52,573 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.967, Acc: 0.903, Base Lr: 2.77e-03
2022-04-23 01:35:10,886 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.378[s] Speed: 42.4[samples/s]
2022-04-23 01:35:38,660 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7400215864181519 
2022-04-23 01:36:09,338 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 01:36:09,339 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 174.0%
2022-04-23 01:36:40,211 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.949, Acc: 0.901, Base Lr: 2.20e-03
2022-04-23 01:36:55,994 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-23 01:37:22,167 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.7608387470245361 
2022-04-23 01:37:22,168 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 01:37:22,168 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 176.1%
2022-04-23 01:37:52,434 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.932, Acc: 0.908, Base Lr: 1.66e-03
2022-04-23 01:38:07,462 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 01:38:33,992 reid_baseline.train INFO: normal accuracy 0.7785537283171886 1.7237212657928467 
2022-04-23 01:39:04,749 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 01:39:04,749 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 172.4%
2022-04-23 01:39:35,672 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.912, Acc: 0.916, Base Lr: 1.19e-03
2022-04-23 01:39:50,958 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-23 01:40:17,179 reid_baseline.train INFO: normal accuracy 0.7805812119846812 1.727470874786377 
2022-04-23 01:40:17,179 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 01:40:17,179 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 172.7%
2022-04-23 01:40:47,956 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.913, Acc: 0.909, Base Lr: 7.78e-04
2022-04-23 01:41:02,745 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-23 01:41:28,823 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.630025029182434 
2022-04-23 01:41:59,347 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 01:41:59,348 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 163.0%
2022-04-23 01:42:30,042 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.877, Acc: 0.929, Base Lr: 4.51e-04
2022-04-23 01:42:44,965 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-23 01:43:11,129 reid_baseline.train INFO: normal accuracy 0.779905384095517 1.7177807092666626 
2022-04-23 01:43:11,130 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 01:43:11,130 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 171.8%
2022-04-23 01:43:49,883 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.892, Acc: 0.914, Base Lr: 2.11e-04
2022-04-23 01:44:07,979 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-23 01:44:37,567 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.6864454746246338 
2022-04-23 01:44:37,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 01:44:37,568 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 168.6%
2022-04-23 01:45:08,414 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.880, Acc: 0.914, Base Lr: 6.51e-05
2022-04-23 01:45:23,523 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-23 01:45:50,957 reid_baseline.train INFO: normal accuracy 0.779905384095517 1.714818000793457 
2022-04-23 01:45:50,957 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 01:45:50,958 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 171.5%
2022-04-23 01:46:21,667 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.901, Acc: 0.910, Base Lr: 1.60e-05
2022-04-23 01:46:36,060 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-23 01:47:32,561 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.7272453308105469 
2022-04-23 01:47:32,562 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 01:47:32,562 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 172.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-23 01:48:29,092 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.630025029182434 
2022-04-23 01:48:29,093 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 01:48:29,093 reid_baseline.train INFO: Accuracy: 77.6%
2022-04-23 01:48:55,440 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.630025029182434 
2022-04-23 01:48:55,441 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 01:48:55,441 reid_baseline.train INFO: Shuffled Accuracy: 77.6%
2022-04-23 01:49:15,522 reid_baseline.train INFO: normal accuracy 0.9645653069633292 0.8606024384498596 
2022-04-23 01:49:15,522 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 01:49:15,522 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-23 01:49:20,193 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4
2022-04-23 01:49:20,193 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=4)
2022-04-23 01:49:20,193 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 01:49:20,194 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 01:49:20,195 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 01:49:27,992 reid_baseline.train INFO: start training
2022-04-23 01:50:00,990 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 5.997, Acc: 0.258, Base Lr: 8.72e-04
2022-04-23 01:50:17,484 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.324[s] Speed: 49.4[samples/s]
2022-04-23 01:51:21,849 reid_baseline.train INFO: normal accuracy 0.5854946063805371 4.172276020050049 
2022-04-23 01:51:52,382 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 01:51:52,382 reid_baseline.train INFO: Accuracy: 58.5% Mean Entropy: 417.2%
2022-04-23 01:52:24,296 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.721, Acc: 0.578, Base Lr: 1.66e-03
2022-04-23 01:52:43,000 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.333[s] Speed: 48.0[samples/s]
2022-04-23 01:53:47,320 reid_baseline.train INFO: normal accuracy 0.6194629332109249 4.156224727630615 
2022-04-23 01:54:17,807 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 01:54:17,807 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 415.6%
2022-04-23 01:54:49,097 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.276, Acc: 0.626, Base Lr: 2.46e-03
2022-04-23 01:55:04,231 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-23 01:56:07,371 reid_baseline.train INFO: normal accuracy 0.6291025935276566 4.005496978759766 
2022-04-23 01:56:37,961 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 01:56:37,961 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 400.5%
2022-04-23 01:57:09,952 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.560, Acc: 0.649, Base Lr: 3.25e-03
2022-04-23 01:57:25,440 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.312[s] Speed: 51.2[samples/s]
2022-04-23 01:58:41,475 reid_baseline.train INFO: normal accuracy 0.6488409456047739 3.427265167236328 
2022-04-23 01:59:11,778 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 01:59:11,778 reid_baseline.train INFO: Accuracy: 64.9% Mean Entropy: 342.7%
2022-04-23 01:59:42,469 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.949, Acc: 0.670, Base Lr: 4.04e-03
2022-04-23 01:59:57,766 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-23 02:00:57,627 reid_baseline.train INFO: normal accuracy 0.7119577691071839 2.740352153778076 
2022-04-23 02:01:28,219 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 02:01:28,219 reid_baseline.train INFO: Accuracy: 71.2% Mean Entropy: 274.0%
2022-04-23 02:02:07,424 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.598, Acc: 0.731, Base Lr: 4.83e-03
2022-04-23 02:02:25,547 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.377[s] Speed: 42.4[samples/s]
2022-04-23 02:03:26,756 reid_baseline.train INFO: normal accuracy 0.7633692907964196 2.303607225418091 
2022-04-23 02:03:57,401 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 02:03:57,402 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 230.4%
2022-04-23 02:04:29,025 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.414, Acc: 0.777, Base Lr: 5.62e-03
2022-04-23 02:04:43,746 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.305[s] Speed: 52.5[samples/s]
2022-04-23 02:05:42,375 reid_baseline.train INFO: normal accuracy 0.7897635988065183 1.9869869947433472 
2022-04-23 02:06:12,930 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 02:06:12,931 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 198.7%
2022-04-23 02:06:43,617 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.201, Acc: 0.831, Base Lr: 6.42e-03
2022-04-23 02:06:58,194 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 02:07:57,668 reid_baseline.train INFO: normal accuracy 0.8026164792288272 1.7416640520095825 
2022-04-23 02:08:28,362 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 02:08:28,362 reid_baseline.train INFO: Accuracy: 80.3% Mean Entropy: 174.2%
2022-04-23 02:08:59,564 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.147, Acc: 0.858, Base Lr: 7.21e-03
2022-04-23 02:09:14,391 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-23 02:10:15,462 reid_baseline.train INFO: normal accuracy 0.8113380766582511 1.5956741571426392 
2022-04-23 02:10:46,023 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 02:10:46,023 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 159.6%
2022-04-23 02:11:25,562 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.050, Acc: 0.880, Base Lr: 4.01e-03
2022-04-23 02:11:43,662 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.379[s] Speed: 42.2[samples/s]
2022-04-23 02:13:15,071 reid_baseline.train INFO: normal accuracy 0.8202891898095019 1.54903244972229 
2022-04-23 02:13:45,539 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 02:13:45,539 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 154.9%
2022-04-23 02:14:15,986 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.976, Acc: 0.901, Base Lr: 3.38e-03
2022-04-23 02:14:30,799 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 02:15:33,467 reid_baseline.train INFO: normal accuracy 0.8269451457424833 1.4905929565429688 
2022-04-23 02:16:04,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 02:16:04,122 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 149.1%
2022-04-23 02:16:35,088 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.967, Acc: 0.903, Base Lr: 2.77e-03
2022-04-23 02:16:49,799 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-23 02:17:47,759 reid_baseline.train INFO: normal accuracy 0.8274041771861372 1.4841257333755493 
2022-04-23 02:18:18,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 02:18:18,317 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 148.4%
2022-04-23 02:18:49,257 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.949, Acc: 0.901, Base Lr: 2.20e-03
2022-04-23 02:19:05,196 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.308[s] Speed: 51.9[samples/s]
2022-04-23 02:20:10,023 reid_baseline.train INFO: normal accuracy 0.8267156300206564 1.502488613128662 
2022-04-23 02:20:10,024 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 02:20:10,024 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 150.2%
2022-04-23 02:20:48,222 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.932, Acc: 0.908, Base Lr: 1.66e-03
2022-04-23 02:21:03,482 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.352[s] Speed: 45.5[samples/s]
2022-04-23 02:22:06,783 reid_baseline.train INFO: normal accuracy 0.8310764287353684 1.481728434562683 
2022-04-23 02:22:37,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 02:22:37,296 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 148.2%
2022-04-23 02:23:07,928 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.912, Acc: 0.915, Base Lr: 1.19e-03
2022-04-23 02:23:23,195 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-23 02:24:24,573 reid_baseline.train INFO: normal accuracy 0.8315354601790222 1.4861418008804321 
2022-04-23 02:24:24,573 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 02:24:24,573 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 148.6%
2022-04-23 02:24:55,571 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.913, Acc: 0.909, Base Lr: 7.78e-04
2022-04-23 02:25:10,307 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-23 02:26:10,861 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.3947770595550537 
2022-04-23 02:26:41,500 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 02:26:41,500 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 139.5%
2022-04-23 02:27:11,853 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.877, Acc: 0.929, Base Lr: 4.51e-04
2022-04-23 02:27:26,723 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-23 02:28:28,166 reid_baseline.train INFO: normal accuracy 0.8319944916226761 1.4854094982147217 
2022-04-23 02:28:28,166 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 02:28:28,167 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 148.5%
2022-04-23 02:29:06,845 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.892, Acc: 0.914, Base Lr: 2.11e-04
2022-04-23 02:29:24,808 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-04-23 02:30:27,727 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4548588991165161 
2022-04-23 02:30:27,727 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 02:30:27,727 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 145.5%
2022-04-23 02:30:58,612 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.880, Acc: 0.913, Base Lr: 6.51e-05
2022-04-23 02:31:13,885 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-23 02:32:16,843 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.4787333011627197 
2022-04-23 02:32:16,844 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 02:32:16,844 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 147.9%
2022-04-23 02:32:47,450 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.901, Acc: 0.909, Base Lr: 1.60e-05
2022-04-23 02:33:01,801 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 02:34:33,717 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4906378984451294 
2022-04-23 02:34:33,717 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 02:34:33,718 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 149.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_4/transformer_best_model.pth
2022-04-23 02:36:07,005 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.3947770595550537 
2022-04-23 02:36:07,005 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 02:36:07,005 reid_baseline.train INFO: Accuracy: 83.4%
2022-04-23 02:37:07,613 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.3947770595550537 
2022-04-23 02:37:07,613 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 02:37:07,613 reid_baseline.train INFO: Shuffled Accuracy: 83.4%
2022-04-23 02:37:27,821 reid_baseline.train INFO: normal accuracy 0.9645653069633292 0.8605980277061462 
2022-04-23 02:37:27,822 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 02:37:27,822 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-23 02:37:32,533 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5
2022-04-23 02:37:32,534 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-23 02:37:32,534 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 02:37:32,535 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 02:37:32,535 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 02:37:40,369 reid_baseline.train INFO: start training
2022-04-23 02:38:21,008 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.060, Acc: 0.246, Base Lr: 8.72e-04
2022-04-23 02:38:40,589 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.394[s] Speed: 40.6[samples/s]
2022-04-23 02:39:10,246 reid_baseline.train INFO: normal accuracy 0.38625429553264606 4.172366619110107 
2022-04-23 02:39:40,522 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 02:39:40,522 reid_baseline.train INFO: Accuracy: 38.6% Mean Entropy: 417.2%
2022-04-23 02:40:11,337 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.750, Acc: 0.578, Base Lr: 1.66e-03
2022-04-23 02:40:26,334 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-23 02:40:51,766 reid_baseline.train INFO: normal accuracy 0.422680412371134 4.161931991577148 
2022-04-23 02:41:22,246 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 02:41:22,247 reid_baseline.train INFO: Accuracy: 42.3% Mean Entropy: 416.2%
2022-04-23 02:41:53,220 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.319, Acc: 0.618, Base Lr: 2.46e-03
2022-04-23 02:42:08,244 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-23 02:42:35,085 reid_baseline.train INFO: normal accuracy 0.43184421534937 4.085130214691162 
2022-04-23 02:43:05,526 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 02:43:05,526 reid_baseline.train INFO: Accuracy: 43.2% Mean Entropy: 408.5%
2022-04-23 02:43:37,084 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.590, Acc: 0.648, Base Lr: 3.25e-03
2022-04-23 02:43:52,111 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.306[s] Speed: 52.2[samples/s]
2022-04-23 02:44:16,928 reid_baseline.train INFO: normal accuracy 0.45017182130584193 3.700808525085449 
2022-04-23 02:44:47,584 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 02:44:47,584 reid_baseline.train INFO: Accuracy: 45.0% Mean Entropy: 370.1%
2022-04-23 02:45:18,050 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.993, Acc: 0.662, Base Lr: 4.04e-03
2022-04-23 02:45:33,132 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-23 02:45:59,223 reid_baseline.train INFO: normal accuracy 0.5147766323024054 3.2133193016052246 
2022-04-23 02:46:29,761 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 02:46:29,761 reid_baseline.train INFO: Accuracy: 51.5% Mean Entropy: 321.3%
2022-04-23 02:47:05,501 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.610, Acc: 0.736, Base Lr: 4.83e-03
2022-04-23 02:47:23,749 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.355[s] Speed: 45.1[samples/s]
2022-04-23 02:47:52,986 reid_baseline.train INFO: normal accuracy 0.5839633447880871 2.8454291820526123 
2022-04-23 02:48:23,386 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 02:48:23,387 reid_baseline.train INFO: Accuracy: 58.4% Mean Entropy: 284.5%
2022-04-23 02:48:54,913 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.433, Acc: 0.769, Base Lr: 5.62e-03
2022-04-23 02:49:09,469 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-23 02:49:34,968 reid_baseline.train INFO: normal accuracy 0.5981672394043528 2.5103533267974854 
2022-04-23 02:50:05,503 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 02:50:05,503 reid_baseline.train INFO: Accuracy: 59.8% Mean Entropy: 251.0%
2022-04-23 02:50:35,888 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.210, Acc: 0.828, Base Lr: 6.42e-03
2022-04-23 02:50:50,459 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 02:51:17,573 reid_baseline.train INFO: normal accuracy 0.6052691867124856 2.2309091091156006 
2022-04-23 02:51:48,159 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 02:51:48,159 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 223.1%
2022-04-23 02:52:18,855 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.149, Acc: 0.856, Base Lr: 7.21e-03
2022-04-23 02:52:33,514 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-23 02:52:59,171 reid_baseline.train INFO: normal accuracy 0.6084765177548682 2.0684654712677 
2022-04-23 02:53:29,756 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 02:53:29,756 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 206.8%
2022-04-23 02:54:01,199 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.046, Acc: 0.879, Base Lr: 4.01e-03
2022-04-23 02:54:15,912 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-23 02:55:12,832 reid_baseline.train INFO: normal accuracy 0.6162657502863689 2.0264713764190674 
2022-04-23 02:55:43,363 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 02:55:43,363 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 202.6%
2022-04-23 02:56:22,144 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.995, Acc: 0.890, Base Lr: 3.38e-03
2022-04-23 02:56:40,430 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.375[s] Speed: 42.6[samples/s]
2022-04-23 02:57:10,223 reid_baseline.train INFO: normal accuracy 0.6162657502863689 1.9486312866210938 
2022-04-23 02:57:40,829 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 02:57:40,829 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 194.9%
2022-04-23 02:58:11,548 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.961, Acc: 0.902, Base Lr: 2.77e-03
2022-04-23 02:58:26,226 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-23 02:58:52,119 reid_baseline.train INFO: normal accuracy 0.6256586483390607 1.927753210067749 
2022-04-23 02:59:22,953 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 02:59:22,953 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 192.8%
2022-04-23 02:59:53,911 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.961, Acc: 0.889, Base Lr: 2.20e-03
2022-04-23 03:00:09,517 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.306[s] Speed: 52.2[samples/s]
2022-04-23 03:00:35,860 reid_baseline.train INFO: normal accuracy 0.6231386025200458 1.9709913730621338 
2022-04-23 03:00:35,860 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 03:00:35,860 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 197.1%
2022-04-23 03:01:05,976 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.923, Acc: 0.901, Base Lr: 1.66e-03
2022-04-23 03:01:20,924 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 03:01:47,158 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.9145370721817017 
2022-04-23 03:02:17,726 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 03:02:17,726 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 191.5%
2022-04-23 03:02:48,407 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.925, Acc: 0.918, Base Lr: 1.19e-03
2022-04-23 03:03:03,596 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-23 03:03:28,931 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.9042123556137085 
2022-04-23 03:03:59,448 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 03:03:59,449 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 190.4%
2022-04-23 03:04:30,301 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.916, Acc: 0.909, Base Lr: 7.78e-04
2022-04-23 03:04:44,953 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 03:05:14,407 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.813904881477356 
2022-04-23 03:05:44,881 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 03:05:44,881 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 181.4%
2022-04-23 03:06:18,707 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.879, Acc: 0.921, Base Lr: 4.51e-04
2022-04-23 03:06:33,661 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-23 03:06:59,379 reid_baseline.train INFO: normal accuracy 0.6320733104238259 1.9032865762710571 
2022-04-23 03:06:59,379 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 03:06:59,380 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 190.3%
2022-04-23 03:07:29,990 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.881, Acc: 0.915, Base Lr: 2.11e-04
2022-04-23 03:07:44,391 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 03:08:09,854 reid_baseline.train INFO: normal accuracy 0.6334478808705613 1.8711186647415161 
2022-04-23 03:08:09,854 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 03:08:09,855 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 187.1%
2022-04-23 03:08:40,574 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.880, Acc: 0.906, Base Lr: 6.51e-05
2022-04-23 03:08:55,682 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-23 03:09:22,169 reid_baseline.train INFO: normal accuracy 0.6290950744558992 1.9031332731246948 
2022-04-23 03:09:22,169 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 03:09:22,169 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 190.3%
2022-04-23 03:09:52,565 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.913, Acc: 0.906, Base Lr: 1.60e-05
2022-04-23 03:10:06,804 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-23 03:11:02,311 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8972210884094238 
2022-04-23 03:11:02,311 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 03:11:02,312 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 189.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-23 03:11:57,890 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.813904881477356 
2022-04-23 03:11:57,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 03:11:57,890 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-23 03:12:23,787 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.813904881477356 
2022-04-23 03:12:23,787 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 03:12:23,788 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-23 03:12:43,676 reid_baseline.train INFO: normal accuracy 0.9645653069633292 0.8719733357429504 
2022-04-23 03:12:43,676 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 03:12:43,676 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-23 03:12:48,277 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5
2022-04-23 03:12:48,278 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-23 03:12:48,278 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 03:12:48,279 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 03:12:48,280 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 03:12:56,096 reid_baseline.train INFO: start training
2022-04-23 03:13:28,997 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.060, Acc: 0.246, Base Lr: 8.72e-04
2022-04-23 03:13:44,818 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-23 03:14:14,744 reid_baseline.train INFO: normal accuracy 0.5086731245776076 4.1725544929504395 
2022-04-23 03:14:45,224 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 03:14:45,224 reid_baseline.train INFO: Accuracy: 50.9% Mean Entropy: 417.3%
2022-04-23 03:15:18,628 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.750, Acc: 0.578, Base Lr: 1.66e-03
2022-04-23 03:15:33,538 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-23 03:15:59,568 reid_baseline.train INFO: normal accuracy 0.5393106555530525 4.16203498840332 
2022-04-23 03:16:30,169 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 03:16:30,170 reid_baseline.train INFO: Accuracy: 53.9% Mean Entropy: 416.2%
2022-04-23 03:17:01,113 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.319, Acc: 0.617, Base Lr: 2.46e-03
2022-04-23 03:17:16,188 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-23 03:17:42,798 reid_baseline.train INFO: normal accuracy 0.539761207479162 4.07628059387207 
2022-04-23 03:18:13,338 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 03:18:13,338 reid_baseline.train INFO: Accuracy: 54.0% Mean Entropy: 407.6%
2022-04-23 03:18:44,743 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.590, Acc: 0.649, Base Lr: 3.25e-03
2022-04-23 03:18:59,916 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.306[s] Speed: 52.2[samples/s]
2022-04-23 03:19:26,176 reid_baseline.train INFO: normal accuracy 0.5555305248929939 3.669884204864502 
2022-04-23 03:19:56,719 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 03:19:56,719 reid_baseline.train INFO: Accuracy: 55.6% Mean Entropy: 367.0%
2022-04-23 03:20:27,073 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.993, Acc: 0.662, Base Lr: 4.04e-03
2022-04-23 03:20:42,188 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 03:21:09,731 reid_baseline.train INFO: normal accuracy 0.6208605541788691 3.0945987701416016 
2022-04-23 03:21:41,156 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 03:21:41,156 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 309.5%
2022-04-23 03:22:12,107 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.610, Acc: 0.737, Base Lr: 4.83e-03
2022-04-23 03:22:26,849 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-23 03:22:56,667 reid_baseline.train INFO: normal accuracy 0.6999324172110836 2.649212598800659 
2022-04-23 03:23:28,004 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 03:23:28,004 reid_baseline.train INFO: Accuracy: 70.0% Mean Entropy: 264.9%
2022-04-23 03:24:04,752 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.434, Acc: 0.769, Base Lr: 5.62e-03
2022-04-23 03:24:19,437 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-23 03:24:47,106 reid_baseline.train INFO: normal accuracy 0.7384546068934444 2.2779746055603027 
2022-04-23 03:25:18,536 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 03:25:18,537 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 227.8%
2022-04-23 03:25:48,915 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.210, Acc: 0.828, Base Lr: 6.42e-03
2022-04-23 03:26:03,521 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 03:26:31,605 reid_baseline.train INFO: normal accuracy 0.7544492002703311 1.992647647857666 
2022-04-23 03:27:02,886 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 03:27:02,886 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 199.3%
2022-04-23 03:27:33,809 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.149, Acc: 0.856, Base Lr: 7.21e-03
2022-04-23 03:27:48,828 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-23 03:28:16,521 reid_baseline.train INFO: normal accuracy 0.7686415859427799 1.8649109601974487 
2022-04-23 03:28:47,748 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 03:28:47,749 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 186.5%
2022-04-23 03:29:19,130 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.046, Acc: 0.880, Base Lr: 4.01e-03
2022-04-23 03:29:33,892 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.304[s] Speed: 52.7[samples/s]
2022-04-23 03:30:35,426 reid_baseline.train INFO: normal accuracy 0.7690921378688894 1.8318477869033813 
2022-04-23 03:31:07,146 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 03:31:07,147 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 183.2%
2022-04-23 03:31:37,629 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.995, Acc: 0.890, Base Lr: 3.38e-03
2022-04-23 03:31:55,906 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-23 03:32:30,664 reid_baseline.train INFO: normal accuracy 0.7767515206127507 1.747355580329895 
2022-04-23 03:33:02,507 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 03:33:02,507 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 174.7%
2022-04-23 03:33:33,525 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.961, Acc: 0.902, Base Lr: 2.77e-03
2022-04-23 03:33:48,166 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-23 03:34:17,304 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7154040336608887 
2022-04-23 03:34:49,018 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 03:34:49,019 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 171.5%
2022-04-23 03:35:19,859 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.961, Acc: 0.888, Base Lr: 2.20e-03
2022-04-23 03:35:35,595 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.306[s] Speed: 52.2[samples/s]
2022-04-23 03:36:04,439 reid_baseline.train INFO: normal accuracy 0.7753998648344221 1.776061773300171 
2022-04-23 03:36:04,439 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 03:36:04,439 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 177.6%
2022-04-23 03:36:34,593 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.923, Acc: 0.901, Base Lr: 1.66e-03
2022-04-23 03:36:49,655 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-23 03:37:19,035 reid_baseline.train INFO: normal accuracy 0.7787790042802433 1.7142544984817505 
2022-04-23 03:37:50,686 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 03:37:50,686 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 171.4%
2022-04-23 03:38:21,493 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.925, Acc: 0.919, Base Lr: 1.19e-03
2022-04-23 03:38:36,779 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-23 03:39:05,907 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.7095263004302979 
2022-04-23 03:39:37,708 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 03:39:37,709 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 171.0%
2022-04-23 03:40:08,454 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.916, Acc: 0.909, Base Lr: 7.78e-04
2022-04-23 03:40:23,168 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 03:40:55,301 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.6093591451644897 
2022-04-23 03:41:27,035 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 03:41:27,035 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 160.9%
2022-04-23 03:42:01,191 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.879, Acc: 0.920, Base Lr: 4.51e-04
2022-04-23 03:42:16,017 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-23 03:42:44,489 reid_baseline.train INFO: normal accuracy 0.7796801081324622 1.6968587636947632 
2022-04-23 03:42:44,490 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 03:42:44,490 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 169.7%
2022-04-23 03:43:15,260 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.881, Acc: 0.914, Base Lr: 2.11e-04
2022-04-23 03:43:29,673 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-23 03:43:58,567 reid_baseline.train INFO: normal accuracy 0.7792295562063528 1.6728404760360718 
2022-04-23 03:43:58,567 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 03:43:58,567 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 167.3%
2022-04-23 03:44:29,377 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.880, Acc: 0.906, Base Lr: 6.51e-05
2022-04-23 03:44:44,367 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-23 03:45:13,984 reid_baseline.train INFO: normal accuracy 0.7819328677630096 1.7073805332183838 
2022-04-23 03:45:13,985 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 03:45:13,985 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 170.7%
2022-04-23 03:45:44,476 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.913, Acc: 0.906, Base Lr: 1.60e-05
2022-04-23 03:45:58,884 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 03:46:59,439 reid_baseline.train INFO: normal accuracy 0.7787790042802433 1.7019721269607544 
2022-04-23 03:46:59,439 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 03:46:59,439 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 170.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-23 03:48:04,464 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.6093591451644897 
2022-04-23 03:48:04,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 03:48:04,465 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-23 03:48:33,064 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.6093591451644897 
2022-04-23 03:48:33,064 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 03:48:33,065 reid_baseline.train INFO: Shuffled Accuracy: 77.7%
2022-04-23 03:48:54,785 reid_baseline.train INFO: normal accuracy 0.9645653069633292 0.8720930218696594 
2022-04-23 03:48:54,785 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 03:48:54,785 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-23 03:48:59,716 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5
2022-04-23 03:48:59,717 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=5)
2022-04-23 03:48:59,717 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 03:48:59,718 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 03:48:59,718 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 03:49:07,450 reid_baseline.train INFO: start training
2022-04-23 03:49:42,832 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.060, Acc: 0.247, Base Lr: 8.72e-04
2022-04-23 03:50:02,308 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.359[s] Speed: 44.6[samples/s]
2022-04-23 03:51:12,165 reid_baseline.train INFO: normal accuracy 0.5831994491622676 4.172395706176758 
2022-04-23 03:51:43,494 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 03:51:43,495 reid_baseline.train INFO: Accuracy: 58.3% Mean Entropy: 417.2%
2022-04-23 03:52:14,274 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.750, Acc: 0.578, Base Lr: 1.66e-03
2022-04-23 03:52:29,315 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-23 03:53:30,527 reid_baseline.train INFO: normal accuracy 0.6173972917144824 4.158028602600098 
2022-04-23 03:54:02,271 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 03:54:02,272 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 415.8%
2022-04-23 03:54:33,203 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.319, Acc: 0.617, Base Lr: 2.46e-03
2022-04-23 03:54:48,278 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.303[s] Speed: 52.9[samples/s]
2022-04-23 03:55:52,961 reid_baseline.train INFO: normal accuracy 0.6240532476474638 4.023772716522217 
2022-04-23 03:56:23,811 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 03:56:23,812 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 402.4%
2022-04-23 03:56:55,313 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.590, Acc: 0.648, Base Lr: 3.25e-03
2022-04-23 03:57:10,280 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-23 03:58:10,999 reid_baseline.train INFO: normal accuracy 0.6426440211154464 3.4538381099700928 
2022-04-23 03:58:41,536 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 03:58:41,537 reid_baseline.train INFO: Accuracy: 64.3% Mean Entropy: 345.4%
2022-04-23 03:59:19,777 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 3.993, Acc: 0.662, Base Lr: 4.04e-03
2022-04-23 03:59:38,534 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.375[s] Speed: 42.7[samples/s]
2022-04-23 04:00:42,227 reid_baseline.train INFO: normal accuracy 0.7053018131742025 2.7848944664001465 
2022-04-23 04:01:14,186 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 04:01:14,186 reid_baseline.train INFO: Accuracy: 70.5% Mean Entropy: 278.5%
2022-04-23 04:01:44,880 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.610, Acc: 0.737, Base Lr: 4.83e-03
2022-04-23 04:01:59,483 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 04:03:01,549 reid_baseline.train INFO: normal accuracy 0.7599265549690154 2.3298585414886475 
2022-04-23 04:03:32,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 04:03:32,243 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 233.0%
2022-04-23 04:04:03,568 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.434, Acc: 0.770, Base Lr: 5.62e-03
2022-04-23 04:04:18,109 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-23 04:05:18,513 reid_baseline.train INFO: normal accuracy 0.7911406931374799 1.9950183629989624 
2022-04-23 04:05:49,176 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 04:05:49,177 reid_baseline.train INFO: Accuracy: 79.1% Mean Entropy: 199.5%
2022-04-23 04:06:19,470 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.210, Acc: 0.828, Base Lr: 6.42e-03
2022-04-23 04:06:33,858 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 04:07:35,464 reid_baseline.train INFO: normal accuracy 0.8092724351618086 1.7307568788528442 
2022-04-23 04:08:06,328 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 04:08:06,328 reid_baseline.train INFO: Accuracy: 80.9% Mean Entropy: 173.1%
2022-04-23 04:08:45,073 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.149, Acc: 0.855, Base Lr: 7.21e-03
2022-04-23 04:09:02,154 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-23 04:10:05,026 reid_baseline.train INFO: normal accuracy 0.8145512967638283 1.6026679277420044 
2022-04-23 04:10:35,746 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 04:10:35,746 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 160.3%
2022-04-23 04:11:06,987 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.046, Acc: 0.879, Base Lr: 4.01e-03
2022-04-23 04:11:21,655 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-23 04:12:54,473 reid_baseline.train INFO: normal accuracy 0.8189120954785403 1.5744307041168213 
2022-04-23 04:13:25,296 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 04:13:25,297 reid_baseline.train INFO: Accuracy: 81.9% Mean Entropy: 157.4%
2022-04-23 04:13:55,728 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.995, Acc: 0.890, Base Lr: 3.38e-03
2022-04-23 04:14:10,559 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 04:15:12,619 reid_baseline.train INFO: normal accuracy 0.8294698186825797 1.4974265098571777 
2022-04-23 04:15:43,361 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 04:15:43,361 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 149.7%
2022-04-23 04:16:14,039 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.961, Acc: 0.903, Base Lr: 2.77e-03
2022-04-23 04:16:28,657 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 04:17:34,996 reid_baseline.train INFO: normal accuracy 0.828551755795272 1.4778447151184082 
2022-04-23 04:18:05,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 04:18:05,851 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 147.8%
2022-04-23 04:18:36,512 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.961, Acc: 0.889, Base Lr: 2.20e-03
2022-04-23 04:18:52,093 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-23 04:19:53,270 reid_baseline.train INFO: normal accuracy 0.8278632086297911 1.5329657793045044 
2022-04-23 04:19:53,271 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 04:19:53,271 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 153.3%
2022-04-23 04:20:23,405 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.923, Acc: 0.902, Base Lr: 1.66e-03
2022-04-23 04:20:38,283 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 04:21:43,270 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.488805890083313 
2022-04-23 04:21:43,271 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 04:21:43,271 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 148.9%
2022-04-23 04:22:13,753 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.925, Acc: 0.918, Base Lr: 1.19e-03
2022-04-23 04:22:28,910 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-23 04:23:31,971 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.4894323348999023 
2022-04-23 04:23:31,972 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 04:23:31,972 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 148.9%
2022-04-23 04:24:02,629 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.916, Acc: 0.909, Base Lr: 7.78e-04
2022-04-23 04:24:17,339 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-23 04:25:18,475 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.3969500064849854 
2022-04-23 04:25:49,137 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 04:25:49,137 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 139.7%
2022-04-23 04:26:27,549 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.879, Acc: 0.920, Base Lr: 4.51e-04
2022-04-23 04:26:46,010 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-23 04:27:48,737 reid_baseline.train INFO: normal accuracy 0.8315354601790222 1.4855897426605225 
2022-04-23 04:27:48,737 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 04:27:48,738 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 148.6%
2022-04-23 04:28:18,769 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.881, Acc: 0.914, Base Lr: 2.11e-04
2022-04-23 04:28:32,647 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 04:29:34,159 reid_baseline.train INFO: normal accuracy 0.83245352306633 1.4616268873214722 
2022-04-23 04:29:34,159 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 04:29:34,160 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 146.2%
2022-04-23 04:30:04,434 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.880, Acc: 0.907, Base Lr: 6.51e-05
2022-04-23 04:30:18,969 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 04:31:23,255 reid_baseline.train INFO: normal accuracy 0.83245352306633 1.4923624992370605 
2022-04-23 04:31:23,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 04:31:23,256 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 149.2%
2022-04-23 04:31:53,324 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.913, Acc: 0.906, Base Lr: 1.60e-05
2022-04-23 04:32:07,233 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-23 04:33:41,195 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.4864580631256104 
2022-04-23 04:33:41,196 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 04:33:41,196 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 148.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_5/transformer_best_model.pth
2022-04-23 04:35:13,769 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.3969500064849854 
2022-04-23 04:35:13,770 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 04:35:13,770 reid_baseline.train INFO: Accuracy: 83.4%
2022-04-23 04:36:14,838 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.3969500064849854 
2022-04-23 04:36:14,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 04:36:14,838 reid_baseline.train INFO: Shuffled Accuracy: 83.4%
2022-04-23 04:36:35,977 reid_baseline.train INFO: normal accuracy 0.9645653069633292 0.872044563293457 
2022-04-23 04:36:35,977 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 04:36:35,978 reid_baseline.train INFO: Source Clean Accuracy: 96.5%
2022-04-23 04:36:40,726 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6
2022-04-23 04:36:40,726 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-23 04:36:40,726 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 04:36:40,731 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 04:36:40,731 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 04:36:48,083 reid_baseline.train INFO: start training
2022-04-23 04:37:20,549 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.038, Acc: 0.238, Base Lr: 8.72e-04
2022-04-23 04:37:36,118 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.314[s] Speed: 50.9[samples/s]
2022-04-23 04:38:03,608 reid_baseline.train INFO: normal accuracy 0.38235967926689574 4.172494888305664 
2022-04-23 04:38:34,270 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 04:38:34,270 reid_baseline.train INFO: Accuracy: 38.2% Mean Entropy: 417.2%
2022-04-23 04:39:04,645 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.771, Acc: 0.580, Base Lr: 1.66e-03
2022-04-23 04:39:19,236 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 04:39:46,356 reid_baseline.train INFO: normal accuracy 0.41786941580756015 4.163949966430664 
2022-04-23 04:40:17,297 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 04:40:17,298 reid_baseline.train INFO: Accuracy: 41.8% Mean Entropy: 416.4%
2022-04-23 04:40:48,003 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.379, Acc: 0.616, Base Lr: 2.46e-03
2022-04-23 04:41:02,746 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 04:41:30,812 reid_baseline.train INFO: normal accuracy 0.4334478808705613 4.104063510894775 
2022-04-23 04:42:01,444 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 04:42:01,445 reid_baseline.train INFO: Accuracy: 43.3% Mean Entropy: 410.4%
2022-04-23 04:42:32,625 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.701, Acc: 0.646, Base Lr: 3.25e-03
2022-04-23 04:42:47,474 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.303[s] Speed: 52.8[samples/s]
2022-04-23 04:43:14,223 reid_baseline.train INFO: normal accuracy 0.4517754868270332 3.8031532764434814 
2022-04-23 04:43:45,089 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 04:43:45,090 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 380.3%
2022-04-23 04:44:15,037 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.106, Acc: 0.666, Base Lr: 4.04e-03
2022-04-23 04:44:29,858 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-23 04:44:56,908 reid_baseline.train INFO: normal accuracy 0.49759450171821307 3.333033561706543 
2022-04-23 04:45:27,653 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 04:45:27,653 reid_baseline.train INFO: Accuracy: 49.8% Mean Entropy: 333.3%
2022-04-23 04:45:57,912 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.706, Acc: 0.718, Base Lr: 4.83e-03
2022-04-23 04:46:12,225 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 04:46:38,804 reid_baseline.train INFO: normal accuracy 0.5697594501718213 2.9472904205322266 
2022-04-23 04:47:09,777 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 04:47:09,777 reid_baseline.train INFO: Accuracy: 57.0% Mean Entropy: 294.7%
2022-04-23 04:47:40,959 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.481, Acc: 0.768, Base Lr: 5.62e-03
2022-04-23 04:47:55,198 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-23 04:48:22,408 reid_baseline.train INFO: normal accuracy 0.5919816723940435 2.597598075866699 
2022-04-23 04:48:53,020 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 04:48:53,020 reid_baseline.train INFO: Accuracy: 59.2% Mean Entropy: 259.8%
2022-04-23 04:49:23,048 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.258, Acc: 0.830, Base Lr: 6.42e-03
2022-04-23 04:49:37,341 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-23 04:50:05,810 reid_baseline.train INFO: normal accuracy 0.6059564719358533 2.32930588722229 
2022-04-23 04:50:36,539 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 04:50:36,539 reid_baseline.train INFO: Accuracy: 60.6% Mean Entropy: 232.9%
2022-04-23 04:51:06,935 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.149, Acc: 0.851, Base Lr: 7.21e-03
2022-04-23 04:51:21,222 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 04:51:48,523 reid_baseline.train INFO: normal accuracy 0.6075601374570446 2.1304991245269775 
2022-04-23 04:52:18,998 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 04:52:18,998 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 213.0%
2022-04-23 04:52:50,016 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.046, Acc: 0.877, Base Lr: 4.01e-03
2022-04-23 04:53:04,396 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-23 04:54:02,606 reid_baseline.train INFO: normal accuracy 0.6164948453608248 2.0907230377197266 
2022-04-23 04:54:33,189 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 04:54:33,189 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 209.1%
2022-04-23 04:55:03,130 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.000, Acc: 0.891, Base Lr: 3.38e-03
2022-04-23 04:55:17,572 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 04:55:44,982 reid_baseline.train INFO: normal accuracy 0.6185567010309279 2.0094051361083984 
2022-04-23 04:56:15,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 04:56:15,465 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 200.9%
2022-04-23 04:56:45,677 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.979, Acc: 0.890, Base Lr: 2.77e-03
2022-04-23 04:57:00,082 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-23 04:57:26,576 reid_baseline.train INFO: normal accuracy 0.6238258877434135 1.9862957000732422 
2022-04-23 04:57:56,976 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 04:57:56,976 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 198.6%
2022-04-23 04:58:27,263 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.979, Acc: 0.891, Base Lr: 2.20e-03
2022-04-23 04:58:42,589 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-23 04:59:10,115 reid_baseline.train INFO: normal accuracy 0.6222222222222222 1.979763150215149 
2022-04-23 04:59:40,523 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 04:59:40,523 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 198.0%
2022-04-23 05:00:10,459 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.944, Acc: 0.899, Base Lr: 1.66e-03
2022-04-23 05:00:25,062 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-23 05:00:51,490 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.9542007446289062 
2022-04-23 05:01:22,926 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 05:01:22,927 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 195.4%
2022-04-23 05:01:53,287 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.949, Acc: 0.914, Base Lr: 1.19e-03
2022-04-23 05:02:08,247 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.298[s] Speed: 53.8[samples/s]
2022-04-23 05:02:34,399 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.9246553182601929 
2022-04-23 05:03:04,833 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 05:03:04,833 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 192.5%
2022-04-23 05:03:35,090 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.936, Acc: 0.904, Base Lr: 7.78e-04
2022-04-23 05:03:49,657 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 05:04:20,703 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8435026407241821 
2022-04-23 05:04:51,055 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 05:04:51,055 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 184.4%
2022-04-23 05:05:21,018 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.893, Acc: 0.920, Base Lr: 4.51e-04
2022-04-23 05:05:35,476 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 05:06:01,693 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.9253548383712769 
2022-04-23 05:06:01,694 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 05:06:01,694 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 192.5%
2022-04-23 05:06:31,945 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.911, Acc: 0.908, Base Lr: 2.11e-04
2022-04-23 05:06:45,994 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 05:07:12,687 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.8908008337020874 
2022-04-23 05:07:12,688 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 05:07:12,688 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 189.1%
2022-04-23 05:07:42,956 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.893, Acc: 0.904, Base Lr: 6.51e-05
2022-04-23 05:07:57,620 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 05:08:24,424 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.914544939994812 
2022-04-23 05:08:24,425 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 05:08:24,425 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 191.5%
2022-04-23 05:08:54,364 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.908, Acc: 0.901, Base Lr: 1.60e-05
2022-04-23 05:09:08,384 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-23 05:10:04,708 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.9195921421051025 
2022-04-23 05:10:04,709 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 05:10:04,709 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 192.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-23 05:11:01,306 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8435026407241821 
2022-04-23 05:11:01,307 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 05:11:01,307 reid_baseline.train INFO: Accuracy: 63.0%
2022-04-23 05:11:27,845 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8435026407241821 
2022-04-23 05:11:27,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 05:11:27,846 reid_baseline.train INFO: Shuffled Accuracy: 63.0%
2022-04-23 05:11:48,547 reid_baseline.train INFO: normal accuracy 0.9616810877626699 0.9001969695091248 
2022-04-23 05:11:48,547 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 05:11:48,547 reid_baseline.train INFO: Source Clean Accuracy: 96.2%
2022-04-23 05:11:53,279 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6
2022-04-23 05:11:53,280 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-23 05:11:53,280 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 05:11:53,281 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 05:11:53,281 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 05:12:00,648 reid_baseline.train INFO: start training
2022-04-23 05:12:32,736 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.038, Acc: 0.238, Base Lr: 8.72e-04
2022-04-23 05:12:48,168 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-23 05:13:15,605 reid_baseline.train INFO: normal accuracy 0.5034917774273485 4.172644138336182 
2022-04-23 05:13:45,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 05:13:45,846 reid_baseline.train INFO: Accuracy: 50.3% Mean Entropy: 417.3%
2022-04-23 05:14:16,089 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.771, Acc: 0.579, Base Lr: 1.66e-03
2022-04-23 05:14:30,733 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 05:14:57,556 reid_baseline.train INFO: normal accuracy 0.5377337238116693 4.163933753967285 
2022-04-23 05:15:28,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 05:15:28,009 reid_baseline.train INFO: Accuracy: 53.8% Mean Entropy: 416.4%
2022-04-23 05:15:58,582 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.379, Acc: 0.616, Base Lr: 2.46e-03
2022-04-23 05:16:13,170 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-23 05:16:40,962 reid_baseline.train INFO: normal accuracy 0.5390853795899977 4.096205234527588 
2022-04-23 05:17:11,404 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 05:17:11,405 reid_baseline.train INFO: Accuracy: 53.9% Mean Entropy: 409.6%
2022-04-23 05:17:42,492 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.701, Acc: 0.646, Base Lr: 3.25e-03
2022-04-23 05:17:57,248 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.302[s] Speed: 53.1[samples/s]
2022-04-23 05:18:23,568 reid_baseline.train INFO: normal accuracy 0.5507997296688444 3.7707908153533936 
2022-04-23 05:18:54,012 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 05:18:54,013 reid_baseline.train INFO: Accuracy: 55.1% Mean Entropy: 377.1%
2022-04-23 05:19:24,015 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.106, Acc: 0.665, Base Lr: 4.04e-03
2022-04-23 05:19:38,782 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-23 05:20:04,977 reid_baseline.train INFO: normal accuracy 0.602613201171435 3.217193126678467 
2022-04-23 05:20:35,387 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 05:20:35,387 reid_baseline.train INFO: Accuracy: 60.3% Mean Entropy: 321.7%
2022-04-23 05:21:05,486 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.706, Acc: 0.717, Base Lr: 4.83e-03
2022-04-23 05:21:19,843 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-23 05:21:47,074 reid_baseline.train INFO: normal accuracy 0.6877675152061276 2.764014959335327 
2022-04-23 05:22:17,593 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 05:22:17,593 reid_baseline.train INFO: Accuracy: 68.8% Mean Entropy: 276.4%
2022-04-23 05:22:48,674 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.481, Acc: 0.768, Base Lr: 5.62e-03
2022-04-23 05:23:02,934 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-23 05:23:29,995 reid_baseline.train INFO: normal accuracy 0.7269655327776526 2.3622896671295166 
2022-04-23 05:24:00,490 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 05:24:00,490 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 236.2%
2022-04-23 05:24:30,296 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.257, Acc: 0.830, Base Lr: 6.42e-03
2022-04-23 05:24:44,520 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 05:25:12,437 reid_baseline.train INFO: normal accuracy 0.7465645415634152 2.1019093990325928 
2022-04-23 05:25:42,882 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 05:25:42,882 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 210.2%
2022-04-23 05:26:13,466 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.149, Acc: 0.851, Base Lr: 7.21e-03
2022-04-23 05:26:27,813 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 05:26:55,019 reid_baseline.train INFO: normal accuracy 0.7623338589772471 1.9019867181777954 
2022-04-23 05:27:25,561 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 05:27:25,562 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 190.2%
2022-04-23 05:27:56,514 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.046, Acc: 0.877, Base Lr: 4.01e-03
2022-04-23 05:28:10,932 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-23 05:29:09,437 reid_baseline.train INFO: normal accuracy 0.7677404820905609 1.8799471855163574 
2022-04-23 05:29:39,808 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 05:29:39,809 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 188.0%
2022-04-23 05:30:09,837 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.000, Acc: 0.891, Base Lr: 3.38e-03
2022-04-23 05:30:24,172 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 05:30:51,987 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.8244712352752686 
2022-04-23 05:31:22,387 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 05:31:22,387 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 182.4%
2022-04-23 05:31:52,503 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.979, Acc: 0.890, Base Lr: 2.77e-03
2022-04-23 05:32:06,869 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-23 05:32:32,764 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7859138250350952 
2022-04-23 05:33:03,159 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 05:33:03,160 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 178.6%
2022-04-23 05:33:33,498 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.979, Acc: 0.891, Base Lr: 2.20e-03
2022-04-23 05:33:48,827 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-23 05:34:15,319 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.8063738346099854 
2022-04-23 05:34:15,319 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 05:34:15,319 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 180.6%
2022-04-23 05:34:45,006 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.944, Acc: 0.899, Base Lr: 1.66e-03
2022-04-23 05:34:59,781 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-23 05:35:26,051 reid_baseline.train INFO: normal accuracy 0.7753998648344221 1.776492953300476 
2022-04-23 05:35:56,512 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 05:35:56,513 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 177.6%
2022-04-23 05:36:26,651 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.949, Acc: 0.914, Base Lr: 1.19e-03
2022-04-23 05:36:41,522 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 05:37:07,984 reid_baseline.train INFO: normal accuracy 0.7769767965758053 1.749511957168579 
2022-04-23 05:37:38,370 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 05:37:38,370 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 175.0%
2022-04-23 05:38:08,402 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.935, Acc: 0.903, Base Lr: 7.78e-04
2022-04-23 05:38:22,662 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 05:38:49,227 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.6619176864624023 
2022-04-23 05:39:19,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 05:39:19,842 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 166.2%
2022-04-23 05:39:49,905 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.893, Acc: 0.920, Base Lr: 4.51e-04
2022-04-23 05:40:04,512 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-23 05:40:31,621 reid_baseline.train INFO: normal accuracy 0.7769767965758053 1.7417441606521606 
2022-04-23 05:40:31,622 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 05:40:31,622 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 174.2%
2022-04-23 05:41:01,979 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.911, Acc: 0.909, Base Lr: 2.11e-04
2022-04-23 05:41:16,132 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 05:41:42,488 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.7145437002182007 
2022-04-23 05:41:42,488 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 05:41:42,489 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 171.5%
2022-04-23 05:42:12,664 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.893, Acc: 0.904, Base Lr: 6.51e-05
2022-04-23 05:42:27,256 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-23 05:42:55,482 reid_baseline.train INFO: normal accuracy 0.7769767965758053 1.7421550750732422 
2022-04-23 05:42:55,483 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 05:42:55,483 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 174.2%
2022-04-23 05:43:25,439 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.908, Acc: 0.902, Base Lr: 1.60e-05
2022-04-23 05:43:39,339 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-23 05:44:35,819 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7480413913726807 
2022-04-23 05:44:35,819 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 05:44:35,820 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 174.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-23 05:45:33,503 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.6619176864624023 
2022-04-23 05:45:33,504 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 05:45:33,504 reid_baseline.train INFO: Accuracy: 77.5%
2022-04-23 05:46:00,838 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.6619176864624023 
2022-04-23 05:46:00,839 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 05:46:00,839 reid_baseline.train INFO: Shuffled Accuracy: 77.5%
2022-04-23 05:46:21,050 reid_baseline.train INFO: normal accuracy 0.9616810877626699 0.9000039100646973 
2022-04-23 05:46:21,050 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 05:46:21,050 reid_baseline.train INFO: Source Clean Accuracy: 96.2%
2022-04-23 05:46:25,725 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6
2022-04-23 05:46:25,725 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=6)
2022-04-23 05:46:25,725 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 05:46:25,726 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 05:46:25,727 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 05:46:33,118 reid_baseline.train INFO: start training
2022-04-23 05:47:05,424 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.038, Acc: 0.238, Base Lr: 8.72e-04
2022-04-23 05:47:20,944 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-23 05:48:24,055 reid_baseline.train INFO: normal accuracy 0.577461556116594 4.172520637512207 
2022-04-23 05:48:54,397 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 05:48:54,397 reid_baseline.train INFO: Accuracy: 57.7% Mean Entropy: 417.3%
2022-04-23 05:49:24,602 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.771, Acc: 0.580, Base Lr: 1.66e-03
2022-04-23 05:49:39,234 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 05:50:39,614 reid_baseline.train INFO: normal accuracy 0.6130364929997705 4.1606831550598145 
2022-04-23 05:51:10,067 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 05:51:10,067 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 416.1%
2022-04-23 05:51:40,756 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.379, Acc: 0.616, Base Lr: 2.46e-03
2022-04-23 05:51:55,510 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 05:52:59,367 reid_baseline.train INFO: normal accuracy 0.619003901767271 4.053557872772217 
2022-04-23 05:53:29,833 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 05:53:29,833 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 405.4%
2022-04-23 05:54:00,832 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.701, Acc: 0.646, Base Lr: 3.25e-03
2022-04-23 05:54:15,687 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-23 05:55:15,314 reid_baseline.train INFO: normal accuracy 0.6355290337388111 3.5864341259002686 
2022-04-23 05:55:45,661 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 05:55:45,661 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 358.6%
2022-04-23 05:56:15,708 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.106, Acc: 0.665, Base Lr: 4.04e-03
2022-04-23 05:56:30,464 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 05:57:31,346 reid_baseline.train INFO: normal accuracy 0.6922194170300665 2.9226233959198 
2022-04-23 05:58:01,707 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 05:58:01,707 reid_baseline.train INFO: Accuracy: 69.2% Mean Entropy: 292.3%
2022-04-23 05:58:31,986 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.706, Acc: 0.717, Base Lr: 4.83e-03
2022-04-23 05:58:46,227 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 05:59:47,282 reid_baseline.train INFO: normal accuracy 0.7498278632086298 2.4399845600128174 
2022-04-23 06:00:17,827 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 06:00:17,828 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 244.0%
2022-04-23 06:00:48,748 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.481, Acc: 0.768, Base Lr: 5.62e-03
2022-04-23 06:01:03,017 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-23 06:02:03,008 reid_baseline.train INFO: normal accuracy 0.7828781271517099 2.0740883350372314 
2022-04-23 06:02:33,467 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 06:02:33,467 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 207.4%
2022-04-23 06:03:03,564 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.258, Acc: 0.831, Base Lr: 6.42e-03
2022-04-23 06:03:17,857 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 06:04:18,258 reid_baseline.train INFO: normal accuracy 0.8026164792288272 1.8239578008651733 
2022-04-23 06:04:48,580 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 06:04:48,580 reid_baseline.train INFO: Accuracy: 80.3% Mean Entropy: 182.4%
2022-04-23 06:05:19,067 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.149, Acc: 0.851, Base Lr: 7.21e-03
2022-04-23 06:05:33,466 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 06:06:35,589 reid_baseline.train INFO: normal accuracy 0.8081248565526739 1.6364926099777222 
2022-04-23 06:07:06,099 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 06:07:06,099 reid_baseline.train INFO: Accuracy: 80.8% Mean Entropy: 163.6%
2022-04-23 06:07:37,076 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.046, Acc: 0.876, Base Lr: 4.01e-03
2022-04-23 06:07:51,434 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 06:09:23,471 reid_baseline.train INFO: normal accuracy 0.8191416112003672 1.614436149597168 
2022-04-23 06:09:53,823 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 06:09:53,823 reid_baseline.train INFO: Accuracy: 81.9% Mean Entropy: 161.4%
2022-04-23 06:10:23,852 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.000, Acc: 0.891, Base Lr: 3.38e-03
2022-04-23 06:10:38,200 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 06:11:40,448 reid_baseline.train INFO: normal accuracy 0.8221253155841175 1.5495578050613403 
2022-04-23 06:12:10,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 06:12:10,891 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 155.0%
2022-04-23 06:12:41,279 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.979, Acc: 0.891, Base Lr: 2.77e-03
2022-04-23 06:12:55,733 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-23 06:13:54,716 reid_baseline.train INFO: normal accuracy 0.8267156300206564 1.5320377349853516 
2022-04-23 06:14:25,169 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 06:14:25,169 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 153.2%
2022-04-23 06:14:55,353 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.980, Acc: 0.890, Base Lr: 2.20e-03
2022-04-23 06:15:10,801 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-23 06:16:11,294 reid_baseline.train INFO: normal accuracy 0.8232728941932522 1.549483060836792 
2022-04-23 06:16:11,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 06:16:11,295 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 154.9%
2022-04-23 06:16:41,225 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.944, Acc: 0.899, Base Lr: 1.66e-03
2022-04-23 06:16:56,025 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-23 06:18:00,663 reid_baseline.train INFO: normal accuracy 0.8253385356896947 1.537116289138794 
2022-04-23 06:18:00,664 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 06:18:00,664 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 153.7%
2022-04-23 06:18:30,842 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.949, Acc: 0.913, Base Lr: 1.19e-03
2022-04-23 06:18:45,650 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.295[s] Speed: 54.1[samples/s]
2022-04-23 06:19:47,986 reid_baseline.train INFO: normal accuracy 0.8278632086297911 1.5114928483963013 
2022-04-23 06:20:18,298 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 06:20:18,298 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 151.1%
2022-04-23 06:20:48,442 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.936, Acc: 0.903, Base Lr: 7.78e-04
2022-04-23 06:21:02,860 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 06:22:04,913 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.4316298961639404 
2022-04-23 06:22:35,224 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 06:22:35,224 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 143.2%
2022-04-23 06:23:05,123 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.893, Acc: 0.919, Base Lr: 4.51e-04
2022-04-23 06:23:19,559 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-23 06:24:20,881 reid_baseline.train INFO: normal accuracy 0.8269451457424833 1.5137444734573364 
2022-04-23 06:24:20,881 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 06:24:20,882 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 151.4%
2022-04-23 06:24:50,816 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.911, Acc: 0.909, Base Lr: 2.11e-04
2022-04-23 06:25:04,752 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 06:26:04,947 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.4848206043243408 
2022-04-23 06:26:04,947 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 06:26:04,948 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 148.5%
2022-04-23 06:26:35,190 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.893, Acc: 0.904, Base Lr: 6.51e-05
2022-04-23 06:26:49,748 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 06:27:53,468 reid_baseline.train INFO: normal accuracy 0.8274041771861372 1.5093482732772827 
2022-04-23 06:27:53,469 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 06:27:53,469 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 150.9%
2022-04-23 06:28:23,309 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.908, Acc: 0.903, Base Lr: 1.60e-05
2022-04-23 06:28:37,230 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-23 06:30:10,207 reid_baseline.train INFO: normal accuracy 0.8294698186825797 1.5144531726837158 
2022-04-23 06:30:10,208 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 06:30:10,208 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 151.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_6/transformer_best_model.pth
2022-04-23 06:31:42,915 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.4316298961639404 
2022-04-23 06:31:42,916 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 06:31:42,916 reid_baseline.train INFO: Accuracy: 83.2%
2022-04-23 06:32:43,836 reid_baseline.train INFO: normal accuracy 0.8317649759008492 1.4316298961639404 
2022-04-23 06:32:43,836 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 06:32:43,837 reid_baseline.train INFO: Shuffled Accuracy: 83.2%
2022-04-23 06:33:03,824 reid_baseline.train INFO: normal accuracy 0.9616810877626699 0.900071918964386 
2022-04-23 06:33:03,825 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 06:33:03,825 reid_baseline.train INFO: Source Clean Accuracy: 96.2%
2022-04-23 06:33:08,522 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_7
2022-04-23 06:33:08,522 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_7', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=7)
2022-04-23 06:33:08,522 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 06:33:08,524 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 06:33:08,524 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_7
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 06:33:15,836 reid_baseline.train INFO: start training
2022-04-23 06:33:47,927 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.058, Acc: 0.231, Base Lr: 8.72e-04
2022-04-23 06:34:03,291 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-23 06:34:30,283 reid_baseline.train INFO: normal accuracy 0.3747995418098511 4.172599792480469 
2022-04-23 06:35:00,625 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 06:35:00,626 reid_baseline.train INFO: Accuracy: 37.5% Mean Entropy: 417.3%
2022-04-23 06:35:30,721 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.807, Acc: 0.571, Base Lr: 1.66e-03
2022-04-23 06:35:45,300 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 06:36:11,133 reid_baseline.train INFO: normal accuracy 0.41030927835051545 4.164904594421387 
2022-04-23 06:36:41,615 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 06:36:41,615 reid_baseline.train INFO: Accuracy: 41.0% Mean Entropy: 416.5%
2022-04-23 06:37:12,261 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.393, Acc: 0.613, Base Lr: 2.46e-03
2022-04-23 06:37:26,911 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 06:37:54,097 reid_baseline.train INFO: normal accuracy 0.4247422680412371 4.110392093658447 
2022-04-23 06:38:24,545 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 06:38:24,545 reid_baseline.train INFO: Accuracy: 42.5% Mean Entropy: 411.0%
2022-04-23 06:38:55,422 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.728, Acc: 0.636, Base Lr: 3.25e-03
2022-04-23 06:39:10,037 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 06:39:35,199 reid_baseline.train INFO: normal accuracy 0.45040091638029783 3.8203506469726562 
2022-04-23 06:40:05,689 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 06:40:05,689 reid_baseline.train INFO: Accuracy: 45.0% Mean Entropy: 382.0%
2022-04-23 06:40:35,493 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.120, Acc: 0.654, Base Lr: 4.04e-03
2022-04-23 06:40:50,194 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-23 06:41:16,350 reid_baseline.train INFO: normal accuracy 0.49828178694158076 3.348400831222534 
2022-04-23 06:41:46,849 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 06:41:46,849 reid_baseline.train INFO: Accuracy: 49.8% Mean Entropy: 334.8%
2022-04-23 06:42:17,195 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.723, Acc: 0.721, Base Lr: 4.83e-03
2022-04-23 06:42:31,456 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 06:42:57,451 reid_baseline.train INFO: normal accuracy 0.5640320733104238 2.9577231407165527 
2022-04-23 06:43:27,828 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 06:43:27,829 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 295.8%
2022-04-23 06:43:58,717 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.495, Acc: 0.756, Base Lr: 5.62e-03
2022-04-23 06:44:12,939 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 06:44:38,778 reid_baseline.train INFO: normal accuracy 0.5880870561282933 2.616030693054199 
2022-04-23 06:45:09,206 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 06:45:09,206 reid_baseline.train INFO: Accuracy: 58.8% Mean Entropy: 261.6%
2022-04-23 06:45:38,982 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.256, Acc: 0.827, Base Lr: 6.42e-03
2022-04-23 06:45:53,180 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 06:46:19,850 reid_baseline.train INFO: normal accuracy 0.6071019473081328 2.3302948474884033 
2022-04-23 06:46:50,281 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 06:46:50,281 reid_baseline.train INFO: Accuracy: 60.7% Mean Entropy: 233.0%
2022-04-23 06:47:20,711 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.174, Acc: 0.841, Base Lr: 7.21e-03
2022-04-23 06:47:34,911 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 06:48:01,031 reid_baseline.train INFO: normal accuracy 0.6096219931271478 2.141669273376465 
2022-04-23 06:48:31,473 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 06:48:31,473 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 214.2%
2022-04-23 06:49:02,226 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.058, Acc: 0.877, Base Lr: 4.01e-03
2022-04-23 06:49:16,529 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 06:50:14,033 reid_baseline.train INFO: normal accuracy 0.6144329896907217 2.0834999084472656 
2022-04-23 06:50:44,309 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 06:50:44,310 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 208.3%
2022-04-23 06:51:14,316 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.997, Acc: 0.886, Base Lr: 3.38e-03
2022-04-23 06:51:28,606 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 06:51:55,798 reid_baseline.train INFO: normal accuracy 0.6169530355097366 2.0013928413391113 
2022-04-23 06:52:26,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 06:52:26,301 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 200.1%
2022-04-23 06:52:56,410 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.988, Acc: 0.899, Base Lr: 2.77e-03
2022-04-23 06:53:10,592 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 06:53:36,470 reid_baseline.train INFO: normal accuracy 0.6213058419243986 1.9888652563095093 
2022-04-23 06:54:06,926 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 06:54:06,927 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 198.9%
2022-04-23 06:54:37,068 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.993, Acc: 0.887, Base Lr: 2.20e-03
2022-04-23 06:54:52,255 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 06:55:19,194 reid_baseline.train INFO: normal accuracy 0.6180985108820161 1.9763790369033813 
2022-04-23 06:55:49,567 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 06:55:49,567 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 197.6%
2022-04-23 06:56:19,186 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.934, Acc: 0.896, Base Lr: 1.66e-03
2022-04-23 06:56:33,810 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-23 06:57:00,899 reid_baseline.train INFO: normal accuracy 0.6215349369988545 1.942455530166626 
2022-04-23 06:57:31,431 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 06:57:31,432 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 194.2%
2022-04-23 06:58:01,574 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.955, Acc: 0.915, Base Lr: 1.19e-03
2022-04-23 06:58:16,371 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 06:58:41,792 reid_baseline.train INFO: normal accuracy 0.6256586483390607 1.9353832006454468 
2022-04-23 06:59:12,237 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 06:59:12,237 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 193.5%
2022-04-23 06:59:42,322 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.943, Acc: 0.903, Base Lr: 7.78e-04
2022-04-23 06:59:56,600 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 07:00:23,069 reid_baseline.train INFO: normal accuracy 0.6235967926689576 1.8478972911834717 
2022-04-23 07:00:53,563 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 07:00:53,563 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 184.8%
2022-04-23 07:01:23,254 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.887, Acc: 0.915, Base Lr: 4.51e-04
2022-04-23 07:01:37,602 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 07:02:04,471 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.9402321577072144 
2022-04-23 07:02:04,472 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 07:02:04,472 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 194.0%
2022-04-23 07:02:34,449 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.906, Acc: 0.910, Base Lr: 2.11e-04
2022-04-23 07:02:48,504 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 07:03:14,296 reid_baseline.train INFO: normal accuracy 0.6261168384879725 1.9070254564285278 
2022-04-23 07:03:14,296 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 07:03:14,296 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 190.7%
2022-04-23 07:03:44,385 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.906, Acc: 0.899, Base Lr: 6.51e-05
2022-04-23 07:03:58,938 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-23 07:04:25,401 reid_baseline.train INFO: normal accuracy 0.6242840778923253 1.9258593320846558 
2022-04-23 07:04:25,401 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 07:04:25,402 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 192.6%
2022-04-23 07:04:55,223 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.927, Acc: 0.900, Base Lr: 1.60e-05
2022-04-23 07:05:09,146 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-23 07:06:04,755 reid_baseline.train INFO: normal accuracy 0.6258877434135166 1.9329110383987427 
2022-04-23 07:06:04,756 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 07:06:04,756 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 193.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_7/transformer_best_model.pth
2022-04-23 07:07:01,426 reid_baseline.train INFO: normal accuracy 0.6235967926689576 1.8478972911834717 
2022-04-23 07:07:01,426 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 07:07:01,427 reid_baseline.train INFO: Accuracy: 62.4%
2022-04-23 07:07:27,983 reid_baseline.train INFO: normal accuracy 0.6235967926689576 1.8478972911834717 
2022-04-23 07:07:27,984 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 07:07:27,984 reid_baseline.train INFO: Shuffled Accuracy: 62.4%
2022-04-23 07:07:48,041 reid_baseline.train INFO: normal accuracy 0.9604449938195303 0.9035684466362 
2022-04-23 07:07:48,041 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 07:07:48,041 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-23 07:07:52,851 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_7
2022-04-23 07:07:52,852 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_7', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=7)
2022-04-23 07:07:52,852 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 07:07:52,853 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 07:07:52,854 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_7
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 07:08:00,415 reid_baseline.train INFO: start training
2022-04-23 07:08:32,550 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.058, Acc: 0.231, Base Lr: 8.72e-04
2022-04-23 07:08:47,972 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-23 07:09:14,488 reid_baseline.train INFO: normal accuracy 0.4906510475332282 4.172748565673828 
2022-04-23 07:09:44,798 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 07:09:44,799 reid_baseline.train INFO: Accuracy: 49.1% Mean Entropy: 417.3%
2022-04-23 07:10:14,813 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.807, Acc: 0.571, Base Lr: 1.66e-03
2022-04-23 07:10:29,506 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 07:10:55,398 reid_baseline.train INFO: normal accuracy 0.5296237891416986 4.165019989013672 
2022-04-23 07:11:25,653 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 07:11:25,654 reid_baseline.train INFO: Accuracy: 53.0% Mean Entropy: 416.5%
2022-04-23 07:11:56,261 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.393, Acc: 0.612, Base Lr: 2.46e-03
2022-04-23 07:12:10,814 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-23 07:12:37,456 reid_baseline.train INFO: normal accuracy 0.5375084478486145 4.102828502655029 
2022-04-23 07:13:07,884 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 07:13:07,884 reid_baseline.train INFO: Accuracy: 53.8% Mean Entropy: 410.3%
2022-04-23 07:13:38,796 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.728, Acc: 0.636, Base Lr: 3.25e-03
2022-04-23 07:13:53,593 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.301[s] Speed: 53.2[samples/s]
2022-04-23 07:14:19,230 reid_baseline.train INFO: normal accuracy 0.5435908988510926 3.7982230186462402 
2022-04-23 07:14:49,640 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 07:14:49,640 reid_baseline.train INFO: Accuracy: 54.4% Mean Entropy: 379.8%
2022-04-23 07:15:19,364 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.120, Acc: 0.653, Base Lr: 4.04e-03
2022-04-23 07:15:34,036 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 07:15:59,633 reid_baseline.train INFO: normal accuracy 0.6028384771344898 3.2175071239471436 
2022-04-23 07:16:30,115 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 07:16:30,116 reid_baseline.train INFO: Accuracy: 60.3% Mean Entropy: 321.8%
2022-04-23 07:17:00,317 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.723, Acc: 0.719, Base Lr: 4.83e-03
2022-04-23 07:17:14,638 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 07:17:40,492 reid_baseline.train INFO: normal accuracy 0.6832619959450327 2.77105712890625 
2022-04-23 07:18:10,984 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 07:18:10,984 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 277.1%
2022-04-23 07:18:41,788 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.495, Acc: 0.757, Base Lr: 5.62e-03
2022-04-23 07:18:55,999 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 07:19:22,323 reid_baseline.train INFO: normal accuracy 0.7256138769993242 2.388362169265747 
2022-04-23 07:19:52,866 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 07:19:52,866 reid_baseline.train INFO: Accuracy: 72.6% Mean Entropy: 238.8%
2022-04-23 07:20:22,670 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.257, Acc: 0.828, Base Lr: 6.42e-03
2022-04-23 07:20:36,794 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 07:21:03,611 reid_baseline.train INFO: normal accuracy 0.7488173011939626 2.1046135425567627 
2022-04-23 07:21:34,069 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 07:21:34,069 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 210.5%
2022-04-23 07:22:04,413 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.174, Acc: 0.842, Base Lr: 7.21e-03
2022-04-23 07:22:18,895 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 07:22:44,739 reid_baseline.train INFO: normal accuracy 0.7600810993466998 1.9341111183166504 
2022-04-23 07:23:15,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 07:23:15,177 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 193.4%
2022-04-23 07:23:45,902 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.058, Acc: 0.876, Base Lr: 4.01e-03
2022-04-23 07:24:00,197 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 07:24:57,288 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.882999062538147 
2022-04-23 07:25:27,513 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 07:25:27,514 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 188.3%
2022-04-23 07:25:57,378 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.997, Acc: 0.885, Base Lr: 3.38e-03
2022-04-23 07:26:11,679 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-23 07:26:38,015 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.8107516765594482 
2022-04-23 07:27:08,303 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 07:27:08,303 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 181.1%
2022-04-23 07:27:38,517 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.988, Acc: 0.897, Base Lr: 2.77e-03
2022-04-23 07:27:52,813 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 07:28:18,432 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.7815194129943848 
2022-04-23 07:28:48,656 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 07:28:48,656 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 178.2%
2022-04-23 07:29:18,804 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.993, Acc: 0.888, Base Lr: 2.20e-03
2022-04-23 07:29:33,985 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 07:30:00,085 reid_baseline.train INFO: normal accuracy 0.7758504167605317 1.7905961275100708 
2022-04-23 07:30:00,085 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 07:30:00,085 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 179.1%
2022-04-23 07:30:29,498 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.934, Acc: 0.895, Base Lr: 1.66e-03
2022-04-23 07:30:44,067 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-23 07:31:10,174 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.7444382905960083 
2022-04-23 07:31:40,364 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 07:31:40,365 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 174.4%
2022-04-23 07:32:10,291 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.955, Acc: 0.914, Base Lr: 1.19e-03
2022-04-23 07:32:25,064 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 07:32:51,121 reid_baseline.train INFO: normal accuracy 0.7801306600585718 1.7454575300216675 
2022-04-23 07:32:51,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 07:32:51,122 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 174.5%
2022-04-23 07:33:21,187 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.943, Acc: 0.902, Base Lr: 7.78e-04
2022-04-23 07:33:35,506 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 07:34:01,587 reid_baseline.train INFO: normal accuracy 0.7785537283171886 1.6512800455093384 
2022-04-23 07:34:31,900 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 07:34:31,900 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 165.1%
2022-04-23 07:35:01,616 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.887, Acc: 0.913, Base Lr: 4.51e-04
2022-04-23 07:35:15,964 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 07:35:41,721 reid_baseline.train INFO: normal accuracy 0.7801306600585718 1.743219017982483 
2022-04-23 07:35:41,721 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 07:35:41,721 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 174.3%
2022-04-23 07:36:11,755 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.906, Acc: 0.909, Base Lr: 2.11e-04
2022-04-23 07:36:25,762 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 07:36:52,063 reid_baseline.train INFO: normal accuracy 0.7803559360216265 1.7159188985824585 
2022-04-23 07:36:52,064 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 07:36:52,064 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 171.6%
2022-04-23 07:37:22,283 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.906, Acc: 0.899, Base Lr: 6.51e-05
2022-04-23 07:37:36,808 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 07:38:04,389 reid_baseline.train INFO: normal accuracy 0.7801306600585718 1.7368237972259521 
2022-04-23 07:38:04,390 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 07:38:04,390 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 173.7%
2022-04-23 07:38:34,147 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.927, Acc: 0.899, Base Lr: 1.60e-05
2022-04-23 07:38:48,175 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-23 07:39:44,135 reid_baseline.train INFO: normal accuracy 0.7787790042802433 1.7463117837905884 
2022-04-23 07:39:44,136 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 07:39:44,136 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 174.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_7/transformer_best_model.pth
2022-04-23 07:40:40,136 reid_baseline.train INFO: normal accuracy 0.7785537283171886 1.6512800455093384 
2022-04-23 07:40:40,136 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 07:40:40,136 reid_baseline.train INFO: Accuracy: 77.9%
2022-04-23 07:41:06,119 reid_baseline.train INFO: normal accuracy 0.7785537283171886 1.6512800455093384 
2022-04-23 07:41:06,119 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 07:41:06,119 reid_baseline.train INFO: Shuffled Accuracy: 77.9%
2022-04-23 07:41:25,986 reid_baseline.train INFO: normal accuracy 0.9604449938195303 0.9035062789916992 
2022-04-23 07:41:25,987 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 07:41:25,987 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-04-23 07:41:30,548 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_7
2022-04-23 07:41:30,549 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_7', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=7)
2022-04-23 07:41:30,549 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 07:41:30,550 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 07:41:30,550 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_7
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 07:41:37,866 reid_baseline.train INFO: start training
2022-04-23 07:42:10,044 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.058, Acc: 0.231, Base Lr: 8.72e-04
2022-04-23 07:42:25,505 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-23 07:43:26,724 reid_baseline.train INFO: normal accuracy 0.5673628643562084 4.172635078430176 
2022-04-23 07:43:56,971 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 07:43:56,971 reid_baseline.train INFO: Accuracy: 56.7% Mean Entropy: 417.3%
2022-04-23 07:44:27,036 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.807, Acc: 0.571, Base Lr: 1.66e-03
2022-04-23 07:44:41,721 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-23 07:45:40,597 reid_baseline.train INFO: normal accuracy 0.6146431030525591 4.162346839904785 
2022-04-23 07:46:10,852 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 07:46:10,853 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 416.2%
2022-04-23 07:46:41,222 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.393, Acc: 0.612, Base Lr: 2.46e-03
2022-04-23 07:46:55,835 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 07:47:58,895 reid_baseline.train INFO: normal accuracy 0.6196924489327519 4.066563129425049 
2022-04-23 07:48:29,138 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 07:48:29,139 reid_baseline.train INFO: Accuracy: 62.0% Mean Entropy: 406.7%
2022-04-23 07:49:00,092 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.728, Acc: 0.636, Base Lr: 3.25e-03
2022-04-23 07:49:14,768 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-23 07:50:13,941 reid_baseline.train INFO: normal accuracy 0.6339224236860225 3.6244943141937256 
2022-04-23 07:50:44,165 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 07:50:44,166 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 362.4%
2022-04-23 07:51:13,922 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.120, Acc: 0.653, Base Lr: 4.04e-03
2022-04-23 07:51:28,623 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-23 07:52:28,958 reid_baseline.train INFO: normal accuracy 0.6933669956392012 2.940476417541504 
2022-04-23 07:52:59,328 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 07:52:59,329 reid_baseline.train INFO: Accuracy: 69.3% Mean Entropy: 294.0%
2022-04-23 07:53:29,387 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.722, Acc: 0.721, Base Lr: 4.83e-03
2022-04-23 07:53:43,771 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-23 07:54:44,188 reid_baseline.train INFO: normal accuracy 0.7459260959375718 2.4540717601776123 
2022-04-23 07:55:14,466 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 07:55:14,466 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 245.4%
2022-04-23 07:55:45,209 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.495, Acc: 0.757, Base Lr: 5.62e-03
2022-04-23 07:55:59,413 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 07:56:57,864 reid_baseline.train INFO: normal accuracy 0.7844847372044985 2.093524932861328 
2022-04-23 07:57:30,013 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 07:57:30,014 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 209.4%
2022-04-23 07:57:59,936 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.256, Acc: 0.827, Base Lr: 6.42e-03
2022-04-23 07:58:14,125 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 07:59:13,169 reid_baseline.train INFO: normal accuracy 0.8005508377323847 1.822295904159546 
2022-04-23 07:59:43,426 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 07:59:43,426 reid_baseline.train INFO: Accuracy: 80.1% Mean Entropy: 182.2%
2022-04-23 08:00:13,835 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.173, Acc: 0.842, Base Lr: 7.21e-03
2022-04-23 08:00:28,307 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 08:01:29,036 reid_baseline.train INFO: normal accuracy 0.8085838879963277 1.6583373546600342 
2022-04-23 08:01:59,352 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 08:01:59,353 reid_baseline.train INFO: Accuracy: 80.9% Mean Entropy: 165.8%
2022-04-23 08:02:30,198 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.059, Acc: 0.875, Base Lr: 4.01e-03
2022-04-23 08:02:44,576 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-23 08:04:15,650 reid_baseline.train INFO: normal accuracy 0.8189120954785403 1.6249560117721558 
2022-04-23 08:04:45,995 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 08:04:45,996 reid_baseline.train INFO: Accuracy: 81.9% Mean Entropy: 162.5%
2022-04-23 08:05:15,893 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 2.997, Acc: 0.885, Base Lr: 3.38e-03
2022-04-23 08:05:30,296 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 08:06:31,510 reid_baseline.train INFO: normal accuracy 0.8216662841404636 1.557554841041565 
2022-04-23 08:07:01,893 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 08:07:01,894 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 155.8%
2022-04-23 08:07:32,053 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.987, Acc: 0.899, Base Lr: 2.77e-03
2022-04-23 08:07:46,407 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-23 08:08:44,144 reid_baseline.train INFO: normal accuracy 0.8246499885242139 1.537345290184021 
2022-04-23 08:09:14,335 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 08:09:14,336 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 153.7%
2022-04-23 08:09:44,406 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.993, Acc: 0.887, Base Lr: 2.20e-03
2022-04-23 08:09:59,654 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.8[samples/s]
2022-04-23 08:10:59,837 reid_baseline.train INFO: normal accuracy 0.824420472802387 1.545703411102295 
2022-04-23 08:10:59,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 08:10:59,838 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 154.6%
2022-04-23 08:11:29,421 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.934, Acc: 0.895, Base Lr: 1.66e-03
2022-04-23 08:11:44,130 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 08:12:47,101 reid_baseline.train INFO: normal accuracy 0.8248795042460408 1.513135552406311 
2022-04-23 08:13:17,225 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 08:13:17,225 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 151.3%
2022-04-23 08:13:47,303 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.955, Acc: 0.912, Base Lr: 1.19e-03
2022-04-23 08:14:02,215 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 08:15:03,535 reid_baseline.train INFO: normal accuracy 0.8257975671333486 1.5155792236328125 
2022-04-23 08:15:03,536 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 08:15:03,536 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 151.6%
2022-04-23 08:15:33,494 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.944, Acc: 0.902, Base Lr: 7.78e-04
2022-04-23 08:15:47,882 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-23 08:16:48,286 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.4280847311019897 
2022-04-23 08:17:18,483 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 08:17:18,484 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 142.8%
2022-04-23 08:17:48,257 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.887, Acc: 0.915, Base Lr: 4.51e-04
2022-04-23 08:18:02,606 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 08:19:04,121 reid_baseline.train INFO: normal accuracy 0.8267156300206564 1.5209547281265259 
2022-04-23 08:19:04,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 08:19:04,122 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 152.1%
2022-04-23 08:19:34,067 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.906, Acc: 0.908, Base Lr: 2.11e-04
2022-04-23 08:19:48,013 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 08:20:47,754 reid_baseline.train INFO: normal accuracy 0.8262565985770025 1.4941190481185913 
2022-04-23 08:20:47,755 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 08:20:47,755 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 149.4%
2022-04-23 08:21:17,858 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.906, Acc: 0.900, Base Lr: 6.51e-05
2022-04-23 08:21:32,356 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-23 08:22:35,233 reid_baseline.train INFO: normal accuracy 0.8280927243516181 1.5132930278778076 
2022-04-23 08:22:35,233 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 08:22:35,233 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 151.3%
2022-04-23 08:23:05,058 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.927, Acc: 0.902, Base Lr: 1.60e-05
2022-04-23 08:23:18,896 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.287[s] Speed: 55.7[samples/s]
2022-04-23 08:24:51,003 reid_baseline.train INFO: normal accuracy 0.8294698186825797 1.5215498208999634 
2022-04-23 08:24:51,004 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 08:24:51,004 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 152.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_7/transformer_best_model.pth
2022-04-23 08:26:22,975 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.4280847311019897 
2022-04-23 08:26:22,976 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 08:26:22,976 reid_baseline.train INFO: Accuracy: 82.9%
2022-04-23 08:27:23,962 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.4280847311019897 
2022-04-23 08:27:23,962 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 08:27:23,962 reid_baseline.train INFO: Shuffled Accuracy: 82.9%
2022-04-23 08:27:43,878 reid_baseline.train INFO: normal accuracy 0.9608570251339101 0.9036943316459656 
2022-04-23 08:27:43,878 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 08:27:43,879 reid_baseline.train INFO: Source Clean Accuracy: 96.1%
2022-04-23 08:27:48,579 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_8
2022-04-23 08:27:48,580 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=8)
2022-04-23 08:27:48,580 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 08:27:48,581 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 08:27:48,581 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 08:27:55,917 reid_baseline.train INFO: start training
2022-04-23 08:28:28,112 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.041, Acc: 0.219, Base Lr: 8.72e-04
2022-04-23 08:28:43,549 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-23 08:29:10,448 reid_baseline.train INFO: normal accuracy 0.3656357388316151 4.172720909118652 
2022-04-23 08:29:40,725 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 08:29:40,726 reid_baseline.train INFO: Accuracy: 36.6% Mean Entropy: 417.3%
2022-04-23 08:30:10,876 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.853, Acc: 0.569, Base Lr: 1.66e-03
2022-04-23 08:30:25,400 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 08:30:50,645 reid_baseline.train INFO: normal accuracy 0.41328751431844213 4.16672420501709 
2022-04-23 08:31:20,943 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 08:31:20,944 reid_baseline.train INFO: Accuracy: 41.3% Mean Entropy: 416.7%
2022-04-23 08:31:51,187 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.481, Acc: 0.615, Base Lr: 2.46e-03
2022-04-23 08:32:05,947 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 08:32:32,980 reid_baseline.train INFO: normal accuracy 0.4281786941580756 4.125286102294922 
2022-04-23 08:33:03,220 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 08:33:03,221 reid_baseline.train INFO: Accuracy: 42.8% Mean Entropy: 412.5%
2022-04-23 08:33:34,180 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.839, Acc: 0.631, Base Lr: 3.25e-03
2022-04-23 08:33:49,015 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.301[s] Speed: 53.1[samples/s]
2022-04-23 08:34:14,003 reid_baseline.train INFO: normal accuracy 0.44009163802978235 3.8810532093048096 
2022-04-23 08:34:44,355 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 08:34:44,355 reid_baseline.train INFO: Accuracy: 44.0% Mean Entropy: 388.1%
2022-04-23 08:35:14,109 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.185, Acc: 0.644, Base Lr: 4.04e-03
2022-04-23 08:35:28,807 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-23 08:35:54,769 reid_baseline.train INFO: normal accuracy 0.4882016036655212 3.410768985748291 
2022-04-23 08:36:25,013 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 08:36:25,013 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 341.1%
2022-04-23 08:36:55,164 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.792, Acc: 0.710, Base Lr: 4.83e-03
2022-04-23 08:37:09,394 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 08:37:34,566 reid_baseline.train INFO: normal accuracy 0.5550973654066438 3.0350050926208496 
2022-04-23 08:38:04,736 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 08:38:04,736 reid_baseline.train INFO: Accuracy: 55.5% Mean Entropy: 303.5%
2022-04-23 08:38:35,547 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.541, Acc: 0.749, Base Lr: 5.62e-03
2022-04-23 08:38:49,777 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 08:39:15,343 reid_baseline.train INFO: normal accuracy 0.5775486827033218 2.6811742782592773 
2022-04-23 08:39:45,640 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 08:39:45,641 reid_baseline.train INFO: Accuracy: 57.8% Mean Entropy: 268.1%
2022-04-23 08:40:15,623 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.305, Acc: 0.826, Base Lr: 6.42e-03
2022-04-23 08:40:29,740 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 08:40:56,373 reid_baseline.train INFO: normal accuracy 0.5983963344788087 2.419524669647217 
2022-04-23 08:41:26,585 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 08:41:26,585 reid_baseline.train INFO: Accuracy: 59.8% Mean Entropy: 242.0%
2022-04-23 08:41:56,943 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.186, Acc: 0.842, Base Lr: 7.21e-03
2022-04-23 08:42:11,252 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-23 08:42:36,686 reid_baseline.train INFO: normal accuracy 0.5967926689576174 2.171801805496216 
2022-04-23 08:43:07,030 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 08:43:07,030 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 217.2%
2022-04-23 08:43:37,713 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.099, Acc: 0.872, Base Lr: 4.01e-03
2022-04-23 08:43:51,923 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 08:44:48,081 reid_baseline.train INFO: normal accuracy 0.6048109965635738 2.097219944000244 
2022-04-23 08:45:18,584 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 08:45:18,584 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 209.7%
2022-04-23 08:45:48,563 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.026, Acc: 0.891, Base Lr: 3.38e-03
2022-04-23 08:46:02,837 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-23 08:46:28,903 reid_baseline.train INFO: normal accuracy 0.6107674684994273 2.026381731033325 
2022-04-23 08:46:59,143 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 08:46:59,144 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 202.6%
2022-04-23 08:47:29,224 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.995, Acc: 0.884, Base Lr: 2.77e-03
2022-04-23 08:47:43,346 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 08:48:08,971 reid_baseline.train INFO: normal accuracy 0.6112256586483391 2.0274438858032227 
2022-04-23 08:48:08,971 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 08:48:08,972 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 202.7%
2022-04-23 08:48:39,154 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.998, Acc: 0.885, Base Lr: 2.20e-03
2022-04-23 08:48:54,309 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 08:49:20,345 reid_baseline.train INFO: normal accuracy 0.6098510882016037 2.024986505508423 
2022-04-23 08:49:50,619 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 08:49:50,619 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 202.5%
2022-04-23 08:50:20,146 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.972, Acc: 0.896, Base Lr: 1.66e-03
2022-04-23 08:50:34,710 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 08:51:00,514 reid_baseline.train INFO: normal accuracy 0.6158075601374571 1.9718273878097534 
2022-04-23 08:51:30,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 08:51:30,783 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 197.2%
2022-04-23 08:52:00,715 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.970, Acc: 0.903, Base Lr: 1.19e-03
2022-04-23 08:52:15,495 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-23 08:52:40,562 reid_baseline.train INFO: normal accuracy 0.6169530355097366 1.9644173383712769 
2022-04-23 08:53:10,837 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 08:53:10,837 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 196.4%
2022-04-23 08:53:40,805 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.960, Acc: 0.898, Base Lr: 7.78e-04
2022-04-23 08:53:55,187 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 08:54:20,584 reid_baseline.train INFO: normal accuracy 0.618327605956472 1.8792434930801392 
2022-04-23 08:54:50,745 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 08:54:50,745 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 187.9%
2022-04-23 08:55:20,603 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.914, Acc: 0.907, Base Lr: 4.51e-04
2022-04-23 08:55:35,058 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 08:56:00,488 reid_baseline.train INFO: normal accuracy 0.6174112256586484 1.9616848230361938 
2022-04-23 08:56:00,489 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 08:56:00,489 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 196.2%
2022-04-23 08:56:30,359 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.926, Acc: 0.903, Base Lr: 2.11e-04
2022-04-23 08:56:44,229 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-23 08:57:09,431 reid_baseline.train INFO: normal accuracy 0.6164948453608248 1.9438227415084839 
2022-04-23 08:57:09,432 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 08:57:09,432 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 194.4%
2022-04-23 08:57:39,700 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.930, Acc: 0.900, Base Lr: 6.51e-05
2022-04-23 08:57:54,103 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 08:58:20,063 reid_baseline.train INFO: normal accuracy 0.6162657502863689 1.9615567922592163 
2022-04-23 08:58:20,064 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 08:58:20,064 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 196.2%
2022-04-23 08:58:49,910 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.965, Acc: 0.894, Base Lr: 1.60e-05
2022-04-23 08:59:03,757 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.287[s] Speed: 55.7[samples/s]
2022-04-23 08:59:58,744 reid_baseline.train INFO: normal accuracy 0.6180985108820161 1.9628329277038574 
2022-04-23 08:59:58,744 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 08:59:58,744 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 196.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_8/transformer_best_model.pth
2022-04-23 09:00:53,795 reid_baseline.train INFO: normal accuracy 0.618327605956472 1.8792434930801392 
2022-04-23 09:00:53,795 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 09:00:53,795 reid_baseline.train INFO: Accuracy: 61.8%
2022-04-23 09:01:19,298 reid_baseline.train INFO: normal accuracy 0.618327605956472 1.8792434930801392 
2022-04-23 09:01:19,298 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 09:01:19,298 reid_baseline.train INFO: Shuffled Accuracy: 61.8%
2022-04-23 09:01:39,019 reid_baseline.train INFO: normal accuracy 0.957972805933251 0.9314171075820923 
2022-04-23 09:01:39,020 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 09:01:39,020 reid_baseline.train INFO: Source Clean Accuracy: 95.8%
2022-04-23 09:01:43,718 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_8
2022-04-23 09:01:43,719 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=8)
2022-04-23 09:01:43,719 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 09:01:43,720 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 09:01:43,721 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 09:01:51,044 reid_baseline.train INFO: start training
2022-04-23 09:02:22,865 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.041, Acc: 0.219, Base Lr: 8.72e-04
2022-04-23 09:02:38,346 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-23 09:03:04,681 reid_baseline.train INFO: normal accuracy 0.48727190808740706 4.172857284545898 
2022-04-23 09:03:34,757 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 09:03:34,757 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 417.3%
2022-04-23 09:04:04,876 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.853, Acc: 0.571, Base Lr: 1.66e-03
2022-04-23 09:04:19,465 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 09:04:45,691 reid_baseline.train INFO: normal accuracy 0.5332282045505744 4.167092323303223 
2022-04-23 09:05:15,914 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 09:05:15,914 reid_baseline.train INFO: Accuracy: 53.3% Mean Entropy: 416.7%
2022-04-23 09:05:46,366 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.481, Acc: 0.610, Base Lr: 2.46e-03
2022-04-23 09:06:01,021 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-23 09:06:27,703 reid_baseline.train INFO: normal accuracy 0.5363820680333409 4.1214141845703125 
2022-04-23 09:06:58,031 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 09:06:58,031 reid_baseline.train INFO: Accuracy: 53.6% Mean Entropy: 412.1%
2022-04-23 09:07:28,789 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.841, Acc: 0.631, Base Lr: 3.25e-03
2022-04-23 09:07:43,474 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 09:08:23,268 reid_baseline.train INFO: normal accuracy 0.5429150709619284 3.873443126678467 
2022-04-23 09:09:06,330 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 09:09:06,330 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 387.3%
2022-04-23 09:09:35,935 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.192, Acc: 0.645, Base Lr: 4.04e-03
2022-04-23 09:09:50,688 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 09:10:16,780 reid_baseline.train INFO: normal accuracy 0.5974318540211759 3.3239662647247314 
2022-04-23 09:10:47,175 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 09:10:47,176 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 332.4%
2022-04-23 09:11:17,231 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.797, Acc: 0.710, Base Lr: 4.83e-03
2022-04-23 09:11:31,449 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 09:11:57,459 reid_baseline.train INFO: normal accuracy 0.6728993016445145 2.8586466312408447 
2022-04-23 09:12:27,642 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 09:12:27,643 reid_baseline.train INFO: Accuracy: 67.3% Mean Entropy: 285.9%
2022-04-23 09:12:58,421 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.546, Acc: 0.749, Base Lr: 5.62e-03
2022-04-23 09:13:12,458 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 09:13:38,438 reid_baseline.train INFO: normal accuracy 0.7138995269204775 2.4809350967407227 
2022-04-23 09:14:18,063 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 09:14:18,063 reid_baseline.train INFO: Accuracy: 71.4% Mean Entropy: 248.1%
2022-04-23 09:14:47,612 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.304, Acc: 0.823, Base Lr: 6.42e-03
2022-04-23 09:15:01,737 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.287[s] Speed: 55.7[samples/s]
2022-04-23 09:15:28,169 reid_baseline.train INFO: normal accuracy 0.7368776751520613 2.1829280853271484 
2022-04-23 09:15:58,435 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 09:15:58,436 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 218.3%
2022-04-23 09:16:28,790 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.188, Acc: 0.842, Base Lr: 7.21e-03
2022-04-23 09:16:43,018 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 09:17:09,059 reid_baseline.train INFO: normal accuracy 0.7567019599008786 1.9395473003387451 
2022-04-23 09:17:43,631 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 09:17:43,632 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 194.0%
2022-04-23 09:18:14,442 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.099, Acc: 0.872, Base Lr: 4.01e-03
2022-04-23 09:18:29,182 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-23 09:19:59,646 reid_baseline.train INFO: normal accuracy 0.7641360666816851 1.8810982704162598 
2022-04-23 09:20:30,330 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 09:20:30,331 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 188.1%
2022-04-23 09:20:59,963 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.026, Acc: 0.886, Base Lr: 3.38e-03
2022-04-23 09:21:14,203 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 09:21:40,506 reid_baseline.train INFO: normal accuracy 0.7670646542013967 1.8102911710739136 
2022-04-23 09:22:11,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 09:22:11,195 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 181.0%
2022-04-23 09:22:41,048 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.996, Acc: 0.885, Base Lr: 2.77e-03
2022-04-23 09:22:55,288 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 09:23:21,167 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.8251489400863647 
2022-04-23 09:23:21,167 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 09:23:21,167 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 182.5%
2022-04-23 09:23:51,216 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.999, Acc: 0.887, Base Lr: 2.20e-03
2022-04-23 09:24:06,413 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.8[samples/s]
2022-04-23 09:24:32,444 reid_baseline.train INFO: normal accuracy 0.7679657580536157 1.8390570878982544 
2022-04-23 09:24:32,444 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 09:24:32,445 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 183.9%
2022-04-23 09:25:04,792 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.971, Acc: 0.897, Base Lr: 1.66e-03
2022-04-23 09:25:20,041 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-23 09:25:58,044 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7830040454864502 
2022-04-23 09:26:28,742 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 09:26:28,743 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 178.3%
2022-04-23 09:26:58,666 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.968, Acc: 0.903, Base Lr: 1.19e-03
2022-04-23 09:27:13,487 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 09:27:39,335 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.773903250694275 
2022-04-23 09:28:09,870 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 09:28:09,871 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 177.4%
2022-04-23 09:28:39,872 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.961, Acc: 0.898, Base Lr: 7.78e-04
2022-04-23 09:28:54,168 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 09:29:20,200 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.6837962865829468 
2022-04-23 09:29:50,865 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 09:29:50,866 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 168.4%
2022-04-23 09:30:20,523 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.914, Acc: 0.904, Base Lr: 4.51e-04
2022-04-23 09:30:34,913 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 09:31:16,632 reid_baseline.train INFO: normal accuracy 0.7758504167605317 1.7666351795196533 
2022-04-23 09:31:16,633 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 09:31:16,633 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 176.7%
2022-04-23 09:31:48,810 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.926, Acc: 0.904, Base Lr: 2.11e-04
2022-04-23 09:32:02,900 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-23 09:32:28,789 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.7531988620758057 
2022-04-23 09:32:28,790 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 09:32:28,790 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 175.3%
2022-04-23 09:32:58,861 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.930, Acc: 0.897, Base Lr: 6.51e-05
2022-04-23 09:33:13,515 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 09:33:40,911 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.774949550628662 
2022-04-23 09:33:40,911 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 09:33:40,912 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 177.5%
2022-04-23 09:34:12,212 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.965, Acc: 0.894, Base Lr: 1.60e-05
2022-04-23 09:34:26,156 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.298[s] Speed: 53.8[samples/s]
2022-04-23 09:35:21,970 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.7779079675674438 
2022-04-23 09:35:21,970 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 09:35:21,971 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 177.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_8/transformer_best_model.pth
2022-04-23 09:36:17,930 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.6837962865829468 
2022-04-23 09:36:17,930 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 09:36:17,930 reid_baseline.train INFO: Accuracy: 77.5%
2022-04-23 09:36:44,093 reid_baseline.train INFO: normal accuracy 0.7747240369452579 1.6837962865829468 
2022-04-23 09:36:44,094 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 09:36:44,094 reid_baseline.train INFO: Shuffled Accuracy: 77.5%
2022-04-23 09:37:03,940 reid_baseline.train INFO: normal accuracy 0.957560774618871 0.9318826198577881 
2022-04-23 09:37:03,941 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 09:37:03,941 reid_baseline.train INFO: Source Clean Accuracy: 95.8%
2022-04-23 09:37:08,654 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_8
2022-04-23 09:37:08,654 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=8)
2022-04-23 09:37:08,654 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 09:37:08,656 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 09:37:08,656 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 09:37:15,972 reid_baseline.train INFO: start training
2022-04-23 09:37:48,490 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.041, Acc: 0.218, Base Lr: 8.72e-04
2022-04-23 09:38:04,432 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-23 09:39:14,895 reid_baseline.train INFO: normal accuracy 0.5627725499196695 4.172771453857422 
2022-04-23 09:39:45,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 09:39:45,603 reid_baseline.train INFO: Accuracy: 56.3% Mean Entropy: 417.3%
2022-04-23 09:40:15,703 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.853, Acc: 0.570, Base Lr: 1.66e-03
2022-04-23 09:40:30,360 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-23 09:41:29,431 reid_baseline.train INFO: normal accuracy 0.6118889143906358 4.1649651527404785 
2022-04-23 09:41:59,999 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 09:42:00,000 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 416.5%
2022-04-23 09:42:30,324 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.481, Acc: 0.613, Base Lr: 2.46e-03
2022-04-23 09:42:44,997 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 09:43:57,247 reid_baseline.train INFO: normal accuracy 0.6183153546017902 4.093623638153076 
2022-04-23 09:45:09,501 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 09:45:09,502 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 409.4%
2022-04-23 09:45:40,732 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.841, Acc: 0.630, Base Lr: 3.25e-03
2022-04-23 09:45:55,448 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.302[s] Speed: 52.9[samples/s]
2022-04-23 09:46:54,640 reid_baseline.train INFO: normal accuracy 0.631627266467753 3.723724365234375 
2022-04-23 09:47:25,282 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 09:47:25,282 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 372.4%
2022-04-23 09:47:55,036 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.191, Acc: 0.644, Base Lr: 4.04e-03
2022-04-23 09:48:09,823 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 09:49:10,195 reid_baseline.train INFO: normal accuracy 0.6846453982097773 3.0425660610198975 
2022-04-23 09:49:40,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 09:49:40,909 reid_baseline.train INFO: Accuracy: 68.5% Mean Entropy: 304.3%
2022-04-23 09:50:11,025 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.795, Acc: 0.708, Base Lr: 4.83e-03
2022-04-23 09:50:25,623 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 09:51:53,024 reid_baseline.train INFO: normal accuracy 0.7392701400045903 2.5204877853393555 
2022-04-23 09:52:23,660 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 09:52:23,660 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 252.0%
2022-04-23 09:52:54,363 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.546, Acc: 0.752, Base Lr: 5.62e-03
2022-04-23 09:53:08,619 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 09:54:07,571 reid_baseline.train INFO: normal accuracy 0.7746155611659399 2.1533546447753906 
2022-04-23 09:54:38,198 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 09:54:38,198 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 215.3%
2022-04-23 09:55:08,091 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.304, Acc: 0.818, Base Lr: 6.42e-03
2022-04-23 09:55:22,256 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-23 09:56:21,673 reid_baseline.train INFO: normal accuracy 0.8000918062887308 1.8801920413970947 
2022-04-23 09:57:12,141 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 09:57:12,142 reid_baseline.train INFO: Accuracy: 80.0% Mean Entropy: 188.0%
2022-04-23 09:57:44,775 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.184, Acc: 0.846, Base Lr: 7.21e-03
2022-04-23 09:57:59,362 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-23 09:59:00,601 reid_baseline.train INFO: normal accuracy 0.8058296993344044 1.6728113889694214 
2022-04-23 09:59:31,309 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 09:59:31,309 reid_baseline.train INFO: Accuracy: 80.6% Mean Entropy: 167.3%
2022-04-23 10:00:02,013 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.100, Acc: 0.873, Base Lr: 4.01e-03
2022-04-23 10:00:16,290 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 10:01:55,555 reid_baseline.train INFO: normal accuracy 0.8154693596511361 1.6349345445632935 
2022-04-23 10:02:26,136 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 10:02:26,136 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 163.5%
2022-04-23 10:02:55,880 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.025, Acc: 0.889, Base Lr: 3.38e-03
2022-04-23 10:03:10,186 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-23 10:04:11,482 reid_baseline.train INFO: normal accuracy 0.819830158365848 1.5620118379592896 
2022-04-23 10:04:42,148 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 10:04:42,149 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 156.2%
2022-04-23 10:05:12,180 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 2.995, Acc: 0.886, Base Lr: 2.77e-03
2022-04-23 10:05:26,304 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 10:06:24,229 reid_baseline.train INFO: normal accuracy 0.8207482212531558 1.5631500482559204 
2022-04-23 10:06:24,229 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 10:06:24,229 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 156.3%
2022-04-23 10:06:54,392 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 2.996, Acc: 0.892, Base Lr: 2.20e-03
2022-04-23 10:07:09,651 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-23 10:08:10,034 reid_baseline.train INFO: normal accuracy 0.8251090199678678 1.5810983180999756 
2022-04-23 10:08:10,034 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 10:08:10,035 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 158.1%
2022-04-23 10:08:39,687 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 2.969, Acc: 0.896, Base Lr: 1.66e-03
2022-04-23 10:08:54,272 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.291[s] Speed: 55.1[samples/s]
2022-04-23 10:09:58,156 reid_baseline.train INFO: normal accuracy 0.8260270828551756 1.545174241065979 
2022-04-23 10:10:28,747 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 10:10:28,748 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 154.5%
2022-04-23 10:10:58,822 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.967, Acc: 0.904, Base Lr: 1.19e-03
2022-04-23 10:11:13,661 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 10:12:14,849 reid_baseline.train INFO: normal accuracy 0.8280927243516181 1.5366407632827759 
2022-04-23 10:12:45,471 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 10:12:45,471 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 153.7%
2022-04-23 10:13:15,453 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.960, Acc: 0.901, Base Lr: 7.78e-04
2022-04-23 10:13:29,777 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 10:14:59,274 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.45122230052948 
2022-04-23 10:15:30,175 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 10:15:30,176 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 145.1%
2022-04-23 10:15:59,882 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.912, Acc: 0.902, Base Lr: 4.51e-04
2022-04-23 10:16:14,217 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 10:17:14,852 reid_baseline.train INFO: normal accuracy 0.828551755795272 1.534875512123108 
2022-04-23 10:17:14,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 10:17:14,853 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 153.5%
2022-04-23 10:17:44,858 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.926, Acc: 0.906, Base Lr: 2.11e-04
2022-04-23 10:17:58,833 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-23 10:18:58,865 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.5231589078903198 
2022-04-23 10:18:58,865 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 10:18:58,866 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 152.3%
2022-04-23 10:19:28,828 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.929, Acc: 0.895, Base Lr: 6.51e-05
2022-04-23 10:19:43,384 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 10:20:46,276 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.5393985509872437 
2022-04-23 10:20:46,276 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 10:20:46,277 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 153.9%
2022-04-23 10:21:15,959 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.963, Acc: 0.894, Base Lr: 1.60e-05
2022-04-23 10:21:29,822 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 55.9[samples/s]
2022-04-23 10:23:02,619 reid_baseline.train INFO: normal accuracy 0.8280927243516181 1.5429435968399048 
2022-04-23 10:23:02,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 10:23:02,620 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 154.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_8/transformer_best_model.pth
2022-04-23 10:24:34,352 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.45122230052948 
2022-04-23 10:24:34,352 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 10:24:34,353 reid_baseline.train INFO: Accuracy: 83.0%
2022-04-23 10:25:56,995 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.45122230052948 
2022-04-23 10:25:56,995 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 10:25:56,995 reid_baseline.train INFO: Shuffled Accuracy: 83.0%
2022-04-23 10:26:25,291 reid_baseline.train INFO: normal accuracy 0.9571487433044912 0.9303227663040161 
2022-04-23 10:26:25,291 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 10:26:25,291 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-04-23 10:26:29,930 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_9
2022-04-23 10:26:29,930 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_9', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=9)
2022-04-23 10:26:29,930 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 10:26:29,931 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 10:26:29,932 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_9
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 10:26:37,326 reid_baseline.train INFO: start training
2022-04-23 10:27:09,387 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.065, Acc: 0.200, Base Lr: 8.72e-04
2022-04-23 10:27:24,817 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.5[samples/s]
2022-04-23 10:27:51,525 reid_baseline.train INFO: normal accuracy 0.3516609392898053 4.1728692054748535 
2022-04-23 10:28:22,279 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 10:28:22,280 reid_baseline.train INFO: Accuracy: 35.2% Mean Entropy: 417.3%
2022-04-23 10:28:52,381 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.864, Acc: 0.558, Base Lr: 1.66e-03
2022-04-23 10:29:06,880 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-23 10:29:32,429 reid_baseline.train INFO: normal accuracy 0.41168384879725084 4.168239116668701 
2022-04-23 10:30:03,071 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 10:30:03,071 reid_baseline.train INFO: Accuracy: 41.2% Mean Entropy: 416.8%
2022-04-23 10:30:33,464 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.542, Acc: 0.605, Base Lr: 2.46e-03
2022-04-23 10:30:48,078 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 10:31:14,966 reid_baseline.train INFO: normal accuracy 0.422680412371134 4.137170791625977 
2022-04-23 10:31:45,688 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 10:31:45,688 reid_baseline.train INFO: Accuracy: 42.3% Mean Entropy: 413.7%
2022-04-23 10:32:16,560 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.966, Acc: 0.622, Base Lr: 3.25e-03
2022-04-23 10:32:31,183 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 10:32:56,048 reid_baseline.train INFO: normal accuracy 0.4343642611683849 3.9326484203338623 
2022-04-23 10:33:26,662 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 10:33:26,663 reid_baseline.train INFO: Accuracy: 43.4% Mean Entropy: 393.3%
2022-04-23 10:33:56,343 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.322, Acc: 0.636, Base Lr: 4.04e-03
2022-04-23 10:34:11,009 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 10:34:36,530 reid_baseline.train INFO: normal accuracy 0.47124856815578464 3.4980289936065674 
2022-04-23 10:35:07,293 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 10:35:07,293 reid_baseline.train INFO: Accuracy: 47.1% Mean Entropy: 349.8%
2022-04-23 10:35:37,435 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.862, Acc: 0.695, Base Lr: 4.83e-03
2022-04-23 10:35:51,794 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-23 10:36:17,281 reid_baseline.train INFO: normal accuracy 0.5438717067583047 3.123889207839966 
2022-04-23 10:37:06,193 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 10:37:06,193 reid_baseline.train INFO: Accuracy: 54.4% Mean Entropy: 312.4%
2022-04-23 10:37:39,161 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.627, Acc: 0.746, Base Lr: 5.62e-03
2022-04-23 10:37:53,628 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-23 10:38:19,782 reid_baseline.train INFO: normal accuracy 0.5773195876288659 2.761035442352295 
2022-04-23 10:38:50,350 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 10:38:50,350 reid_baseline.train INFO: Accuracy: 57.7% Mean Entropy: 276.1%
2022-04-23 10:39:20,084 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.351, Acc: 0.807, Base Lr: 6.42e-03
2022-04-23 10:39:34,302 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 10:40:00,731 reid_baseline.train INFO: normal accuracy 0.5945017182130584 2.4434242248535156 
2022-04-23 10:40:31,298 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 10:40:31,299 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 244.3%
2022-04-23 10:41:01,632 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.235, Acc: 0.828, Base Lr: 7.21e-03
2022-04-23 10:41:15,903 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 10:41:41,151 reid_baseline.train INFO: normal accuracy 0.5967926689576174 2.190845251083374 
2022-04-23 10:42:11,883 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 10:42:11,884 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 219.1%
2022-04-23 10:42:42,587 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.141, Acc: 0.860, Base Lr: 4.01e-03
2022-04-23 10:42:56,854 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 10:43:53,827 reid_baseline.train INFO: normal accuracy 0.6123711340206186 2.1316635608673096 
2022-04-23 10:44:24,483 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 10:44:24,483 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 213.2%
2022-04-23 10:44:54,180 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.069, Acc: 0.879, Base Lr: 3.38e-03
2022-04-23 10:45:08,472 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 10:45:34,405 reid_baseline.train INFO: normal accuracy 0.6109965635738832 2.041952133178711 
2022-04-23 10:46:05,408 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 10:46:05,408 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 204.2%
2022-04-23 10:46:38,961 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.027, Acc: 0.880, Base Lr: 2.77e-03
2022-04-23 10:46:53,137 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.313[s] Speed: 51.0[samples/s]
2022-04-23 10:47:18,663 reid_baseline.train INFO: normal accuracy 0.6192439862542956 2.0177948474884033 
2022-04-23 10:47:49,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 10:47:49,365 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 201.8%
2022-04-23 10:48:19,539 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.028, Acc: 0.875, Base Lr: 2.20e-03
2022-04-23 10:48:34,849 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-23 10:49:23,377 reid_baseline.train INFO: normal accuracy 0.6119129438717068 2.013772964477539 
2022-04-23 10:49:54,109 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 10:49:54,109 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 201.4%
2022-04-23 10:50:23,682 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.014, Acc: 0.891, Base Lr: 1.66e-03
2022-04-23 10:50:38,369 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 10:51:15,694 reid_baseline.train INFO: normal accuracy 0.6185567010309279 1.977636694908142 
2022-04-23 10:51:46,368 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 10:51:46,368 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 197.8%
2022-04-23 10:52:16,334 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.991, Acc: 0.898, Base Lr: 1.19e-03
2022-04-23 10:52:31,230 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 10:52:56,549 reid_baseline.train INFO: normal accuracy 0.620389461626575 1.9422045946121216 
2022-04-23 10:53:27,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 10:53:27,317 reid_baseline.train INFO: Accuracy: 62.0% Mean Entropy: 194.2%
2022-04-23 10:53:57,306 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.970, Acc: 0.889, Base Lr: 7.78e-04
2022-04-23 10:54:11,670 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 10:55:22,755 reid_baseline.train INFO: normal accuracy 0.6233676975945017 1.87523353099823 
2022-04-23 10:55:53,338 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 10:55:53,338 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 187.5%
2022-04-23 10:56:23,171 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.953, Acc: 0.898, Base Lr: 4.51e-04
2022-04-23 10:56:37,971 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.294[s] Speed: 54.5[samples/s]
2022-04-23 10:57:16,451 reid_baseline.train INFO: normal accuracy 0.6210767468499427 1.9572350978851318 
2022-04-23 10:57:16,452 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 10:57:16,452 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 195.7%
2022-04-23 10:57:46,164 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.962, Acc: 0.902, Base Lr: 2.11e-04
2022-04-23 10:58:00,987 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 10:59:01,119 reid_baseline.train INFO: normal accuracy 0.6233676975945017 1.9213528633117676 
2022-04-23 10:59:01,120 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 10:59:01,120 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 192.1%
2022-04-23 10:59:31,592 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.961, Acc: 0.891, Base Lr: 6.51e-05
2022-04-23 10:59:46,183 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 11:00:12,468 reid_baseline.train INFO: normal accuracy 0.6222222222222222 1.9411073923110962 
2022-04-23 11:00:12,469 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 11:00:12,469 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 194.1%
2022-04-23 11:00:42,386 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.984, Acc: 0.891, Base Lr: 1.60e-05
2022-04-23 11:00:59,231 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-23 11:02:01,082 reid_baseline.train INFO: normal accuracy 0.6229095074455899 1.9563878774642944 
2022-04-23 11:02:01,082 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 11:02:01,082 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 195.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_9/transformer_best_model.pth
2022-04-23 11:02:56,749 reid_baseline.train INFO: normal accuracy 0.6233676975945017 1.87523353099823 
2022-04-23 11:02:56,749 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 11:02:56,750 reid_baseline.train INFO: Accuracy: 62.3%
2022-04-23 11:03:44,499 reid_baseline.train INFO: normal accuracy 0.6233676975945017 1.87523353099823 
2022-04-23 11:03:44,500 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 11:03:44,500 reid_baseline.train INFO: Shuffled Accuracy: 62.3%
2022-04-23 11:04:04,663 reid_baseline.train INFO: normal accuracy 0.9550885867325917 0.9616542458534241 
2022-04-23 11:04:04,663 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 11:04:04,664 reid_baseline.train INFO: Source Clean Accuracy: 95.5%
2022-04-23 11:04:23,034 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_9
2022-04-23 11:04:23,034 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_9', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=9)
2022-04-23 11:04:23,035 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 11:04:23,050 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 11:04:23,051 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_9
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 11:04:36,364 reid_baseline.train INFO: start training
2022-04-23 11:05:08,689 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.065, Acc: 0.200, Base Lr: 8.72e-04
2022-04-23 11:05:27,705 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.334[s] Speed: 47.9[samples/s]
2022-04-23 11:05:59,423 reid_baseline.train INFO: normal accuracy 0.474205902230232 4.1729888916015625 
2022-04-23 11:06:30,107 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 11:06:30,107 reid_baseline.train INFO: Accuracy: 47.4% Mean Entropy: 417.3%
2022-04-23 11:07:00,103 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.864, Acc: 0.558, Base Lr: 1.66e-03
2022-04-23 11:07:15,028 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 11:08:20,954 reid_baseline.train INFO: normal accuracy 0.5273710295111511 4.16856575012207 
2022-04-23 11:08:51,688 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 11:08:51,689 reid_baseline.train INFO: Accuracy: 52.7% Mean Entropy: 416.9%
2022-04-23 11:09:22,076 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.541, Acc: 0.600, Base Lr: 2.46e-03
2022-04-23 11:09:36,756 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 11:10:26,433 reid_baseline.train INFO: normal accuracy 0.5296237891416986 4.13520622253418 
2022-04-23 11:10:57,651 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 11:10:57,652 reid_baseline.train INFO: Accuracy: 53.0% Mean Entropy: 413.5%
2022-04-23 11:11:31,408 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.968, Acc: 0.624, Base Lr: 3.25e-03
2022-04-23 11:11:46,055 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.318[s] Speed: 50.2[samples/s]
2022-04-23 11:12:34,745 reid_baseline.train INFO: normal accuracy 0.530074341067808 3.9225704669952393 
2022-04-23 11:13:05,250 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 11:13:05,251 reid_baseline.train INFO: Accuracy: 53.0% Mean Entropy: 392.3%
2022-04-23 11:13:35,305 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.328, Acc: 0.637, Base Lr: 4.04e-03
2022-04-23 11:13:51,787 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.306[s] Speed: 52.3[samples/s]
2022-04-23 11:14:45,351 reid_baseline.train INFO: normal accuracy 0.5830141923856724 3.415574789047241 
2022-04-23 11:15:16,378 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 11:15:16,379 reid_baseline.train INFO: Accuracy: 58.3% Mean Entropy: 341.6%
2022-04-23 11:15:48,469 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.860, Acc: 0.697, Base Lr: 4.83e-03
2022-04-23 11:16:02,725 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.305[s] Speed: 52.5[samples/s]
2022-04-23 11:16:28,631 reid_baseline.train INFO: normal accuracy 0.6519486370804235 2.9366326332092285 
2022-04-23 11:16:59,329 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 11:16:59,329 reid_baseline.train INFO: Accuracy: 65.2% Mean Entropy: 293.7%
2022-04-23 11:17:40,191 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.623, Acc: 0.746, Base Lr: 5.62e-03
2022-04-23 11:17:58,139 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.387[s] Speed: 41.4[samples/s]
2022-04-23 11:18:25,197 reid_baseline.train INFO: normal accuracy 0.7008335210633025 2.5290441513061523 
2022-04-23 11:18:56,036 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 11:18:56,036 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 252.9%
2022-04-23 11:19:25,830 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.350, Acc: 0.809, Base Lr: 6.42e-03
2022-04-23 11:19:40,132 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 11:21:04,051 reid_baseline.train INFO: normal accuracy 0.7339490876323497 2.2209787368774414 
2022-04-23 11:21:34,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 11:21:34,729 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 222.1%
2022-04-23 11:22:04,920 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.237, Acc: 0.831, Base Lr: 7.21e-03
2022-04-23 11:22:19,337 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-23 11:22:45,479 reid_baseline.train INFO: normal accuracy 0.7521964406397837 2.0041749477386475 
2022-04-23 11:23:16,766 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 11:23:16,767 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 200.4%
2022-04-23 11:23:51,276 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.141, Acc: 0.863, Base Lr: 4.01e-03
2022-04-23 11:24:05,821 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.323[s] Speed: 49.6[samples/s]
2022-04-23 11:25:03,696 reid_baseline.train INFO: normal accuracy 0.7625591349403019 1.934536337852478 
2022-04-23 11:25:34,434 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 11:25:34,435 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 193.5%
2022-04-23 11:26:04,332 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.072, Acc: 0.881, Base Lr: 3.38e-03
2022-04-23 11:26:19,043 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-23 11:27:40,555 reid_baseline.train INFO: normal accuracy 0.7636855147555756 1.8577723503112793 
2022-04-23 11:28:10,988 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 11:28:10,988 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 185.8%
2022-04-23 11:28:40,923 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.028, Acc: 0.884, Base Lr: 2.77e-03
2022-04-23 11:28:55,133 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 11:29:21,178 reid_baseline.train INFO: normal accuracy 0.7686415859427799 1.820049524307251 
2022-04-23 11:29:51,908 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 11:29:51,908 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 182.0%
2022-04-23 11:30:23,954 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.026, Acc: 0.878, Base Lr: 2.20e-03
2022-04-23 11:30:44,146 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.344[s] Speed: 46.6[samples/s]
2022-04-23 11:31:26,234 reid_baseline.train INFO: normal accuracy 0.7679657580536157 1.8402137756347656 
2022-04-23 11:31:26,235 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 11:31:26,235 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 184.0%
2022-04-23 11:31:55,546 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.016, Acc: 0.890, Base Lr: 1.66e-03
2022-04-23 11:32:10,131 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 11:32:36,187 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.7901586294174194 
2022-04-23 11:33:07,204 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 11:33:07,204 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 179.0%
2022-04-23 11:33:39,099 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.990, Acc: 0.903, Base Lr: 1.19e-03
2022-04-23 11:33:53,845 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-23 11:34:24,795 reid_baseline.train INFO: normal accuracy 0.7722460013516558 1.7663227319717407 
2022-04-23 11:34:55,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 11:34:55,890 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 176.6%
2022-04-23 11:35:26,624 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.972, Acc: 0.889, Base Lr: 7.78e-04
2022-04-23 11:35:46,069 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-23 11:36:12,274 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7029004096984863 
2022-04-23 11:36:42,855 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 11:36:42,855 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 170.3%
2022-04-23 11:37:12,378 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.952, Acc: 0.894, Base Lr: 4.51e-04
2022-04-23 11:37:26,658 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-23 11:37:52,897 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7785212993621826 
2022-04-23 11:37:52,898 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 11:37:52,898 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 177.9%
2022-04-23 11:38:22,706 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.961, Acc: 0.902, Base Lr: 2.11e-04
2022-04-23 11:38:36,714 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-23 11:39:02,958 reid_baseline.train INFO: normal accuracy 0.7722460013516558 1.7431026697158813 
2022-04-23 11:39:02,958 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 11:39:02,959 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 174.3%
2022-04-23 11:39:32,928 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.962, Acc: 0.892, Base Lr: 6.51e-05
2022-04-23 11:39:47,453 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-23 11:40:37,376 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.7712476253509521 
2022-04-23 11:40:37,376 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 11:40:37,377 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 177.1%
2022-04-23 11:41:07,017 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.984, Acc: 0.891, Base Lr: 1.60e-05
2022-04-23 11:41:20,832 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.286[s] Speed: 56.0[samples/s]
2022-04-23 11:42:25,655 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7830584049224854 
2022-04-23 11:42:25,655 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 11:42:25,656 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 178.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_9/transformer_best_model.pth
2022-04-23 11:43:22,977 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7029004096984863 
2022-04-23 11:43:22,977 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 11:43:22,977 reid_baseline.train INFO: Accuracy: 77.2%
2022-04-23 11:43:49,908 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7029004096984863 
2022-04-23 11:43:49,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 11:43:49,909 reid_baseline.train INFO: Shuffled Accuracy: 77.2%
2022-04-23 11:44:09,875 reid_baseline.train INFO: normal accuracy 0.9526163988463123 0.9635791778564453 
2022-04-23 11:44:09,875 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 11:44:09,875 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-23 11:44:14,750 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_9
2022-04-23 11:44:14,751 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_9', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=9)
2022-04-23 11:44:14,751 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 11:44:14,752 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 11:44:14,752 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_9
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 11:44:22,398 reid_baseline.train INFO: start training
2022-04-23 11:44:58,858 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.065, Acc: 0.200, Base Lr: 8.72e-04
2022-04-23 11:45:14,674 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-23 11:46:33,747 reid_baseline.train INFO: normal accuracy 0.5409685563461097 4.172927379608154 
2022-04-23 11:47:04,889 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 11:47:04,889 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 417.3%
2022-04-23 11:47:39,919 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.864, Acc: 0.557, Base Lr: 1.66e-03
2022-04-23 11:47:54,569 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.327[s] Speed: 49.0[samples/s]
2022-04-23 11:48:54,490 reid_baseline.train INFO: normal accuracy 0.6075281156759238 4.167198181152344 
2022-04-23 11:49:27,281 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 11:49:27,281 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 416.7%
2022-04-23 11:50:03,912 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.542, Acc: 0.606, Base Lr: 2.46e-03
2022-04-23 11:50:21,915 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.359[s] Speed: 44.5[samples/s]
2022-04-23 11:51:25,600 reid_baseline.train INFO: normal accuracy 0.6123479458342896 4.116394519805908 
2022-04-23 11:51:57,251 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 11:51:57,251 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 411.6%
2022-04-23 11:52:35,852 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.973, Acc: 0.619, Base Lr: 3.25e-03
2022-04-23 11:52:51,213 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.355[s] Speed: 45.1[samples/s]
2022-04-23 11:54:17,936 reid_baseline.train INFO: normal accuracy 0.6208400275418866 3.7979965209960938 
2022-04-23 11:54:48,874 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 11:54:48,875 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 379.8%
2022-04-23 11:55:18,778 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.321, Acc: 0.636, Base Lr: 4.04e-03
2022-04-23 11:55:33,418 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 11:56:50,531 reid_baseline.train INFO: normal accuracy 0.6713334863438145 3.1552202701568604 
2022-04-23 11:57:21,388 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 11:57:21,389 reid_baseline.train INFO: Accuracy: 67.1% Mean Entropy: 315.5%
2022-04-23 11:57:51,450 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.853, Acc: 0.694, Base Lr: 4.83e-03
2022-04-23 11:58:05,612 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 11:59:23,953 reid_baseline.train INFO: normal accuracy 0.7316961211843012 2.602147102355957 
2022-04-23 11:59:55,973 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 11:59:55,974 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 260.2%
2022-04-23 12:00:33,642 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.614, Acc: 0.741, Base Lr: 5.62e-03
2022-04-23 12:00:47,950 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-23 12:02:04,337 reid_baseline.train INFO: normal accuracy 0.7670415423456507 2.224637031555176 
2022-04-23 12:02:35,196 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 12:02:35,196 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 222.5%
2022-04-23 12:03:05,931 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.356, Acc: 0.809, Base Lr: 6.42e-03
2022-04-23 12:03:24,187 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-23 12:04:57,790 reid_baseline.train INFO: normal accuracy 0.7927473031902685 1.9256691932678223 
2022-04-23 12:05:28,734 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 12:05:28,735 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 192.6%
2022-04-23 12:05:59,134 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.229, Acc: 0.831, Base Lr: 7.21e-03
2022-04-23 12:06:13,448 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 12:07:44,334 reid_baseline.train INFO: normal accuracy 0.8085838879963277 1.7082438468933105 
2022-04-23 12:08:16,381 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 12:08:16,382 reid_baseline.train INFO: Accuracy: 80.9% Mean Entropy: 170.8%
2022-04-23 12:08:47,381 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.137, Acc: 0.863, Base Lr: 4.01e-03
2022-04-23 12:09:01,988 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.300[s] Speed: 53.3[samples/s]
2022-04-23 12:11:33,713 reid_baseline.train INFO: normal accuracy 0.8145512967638283 1.6559473276138306 
2022-04-23 12:12:04,803 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 12:12:04,803 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 165.6%
2022-04-23 12:12:34,630 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.065, Acc: 0.882, Base Lr: 3.38e-03
2022-04-23 12:12:49,128 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.292[s] Speed: 54.9[samples/s]
2022-04-23 12:13:50,824 reid_baseline.train INFO: normal accuracy 0.8191416112003672 1.5902529954910278 
2022-04-23 12:14:21,512 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 12:14:21,512 reid_baseline.train INFO: Accuracy: 81.9% Mean Entropy: 159.0%
2022-04-23 12:14:55,759 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.024, Acc: 0.887, Base Lr: 2.77e-03
2022-04-23 12:15:11,444 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.328[s] Speed: 48.7[samples/s]
2022-04-23 12:16:10,041 reid_baseline.train INFO: normal accuracy 0.8193711269221942 1.5692718029022217 
2022-04-23 12:16:40,856 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 12:16:40,856 reid_baseline.train INFO: Accuracy: 81.9% Mean Entropy: 156.9%
2022-04-23 12:17:11,007 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.026, Acc: 0.881, Base Lr: 2.20e-03
2022-04-23 12:17:26,248 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-23 12:18:44,422 reid_baseline.train INFO: normal accuracy 0.8209777369749828 1.573789358139038 
2022-04-23 12:18:44,422 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 12:18:44,423 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 157.4%
2022-04-23 12:19:14,072 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.013, Acc: 0.889, Base Lr: 1.66e-03
2022-04-23 12:19:28,610 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 12:20:32,882 reid_baseline.train INFO: normal accuracy 0.8205187055313289 1.5410542488098145 
2022-04-23 12:21:03,993 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 12:21:03,993 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 154.1%
2022-04-23 12:21:33,960 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 2.983, Acc: 0.906, Base Lr: 1.19e-03
2022-04-23 12:21:48,821 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 12:23:06,904 reid_baseline.train INFO: normal accuracy 0.8223548313059444 1.5140501260757446 
2022-04-23 12:23:37,815 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 12:23:37,815 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 151.4%
2022-04-23 12:24:07,819 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 2.969, Acc: 0.891, Base Lr: 7.78e-04
2022-04-23 12:24:22,112 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 12:25:23,087 reid_baseline.train INFO: normal accuracy 0.82419095708056 1.4473440647125244 
2022-04-23 12:25:56,730 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 12:25:56,730 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 144.7%
2022-04-23 12:26:35,333 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.949, Acc: 0.897, Base Lr: 4.51e-04
2022-04-23 12:26:49,691 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.348[s] Speed: 45.9[samples/s]
2022-04-23 12:27:50,963 reid_baseline.train INFO: normal accuracy 0.8216662841404636 1.5191316604614258 
2022-04-23 12:27:50,964 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 12:27:50,964 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 151.9%
2022-04-23 12:28:29,905 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.962, Acc: 0.896, Base Lr: 2.11e-04
2022-04-23 12:28:43,957 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-04-23 12:30:18,794 reid_baseline.train INFO: normal accuracy 0.8223548313059444 1.493712306022644 
2022-04-23 12:30:18,794 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 12:30:18,794 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 149.4%
2022-04-23 12:30:49,181 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.962, Acc: 0.889, Base Lr: 6.51e-05
2022-04-23 12:31:04,060 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 12:32:35,973 reid_baseline.train INFO: normal accuracy 0.8248795042460408 1.5130194425582886 
2022-04-23 12:32:35,974 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 12:32:35,974 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 151.3%
2022-04-23 12:33:05,822 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.981, Acc: 0.895, Base Lr: 1.60e-05
2022-04-23 12:33:19,806 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-23 12:34:53,443 reid_baseline.train INFO: normal accuracy 0.8218957998622906 1.5309644937515259 
2022-04-23 12:34:53,444 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 12:34:53,444 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 153.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_9/transformer_best_model.pth
2022-04-23 12:36:30,696 reid_baseline.train INFO: normal accuracy 0.82419095708056 1.4473440647125244 
2022-04-23 12:36:30,697 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 12:36:30,697 reid_baseline.train INFO: Accuracy: 82.4%
2022-04-23 12:38:01,296 reid_baseline.train INFO: normal accuracy 0.82419095708056 1.4473440647125244 
2022-04-23 12:38:01,296 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 12:38:01,296 reid_baseline.train INFO: Shuffled Accuracy: 82.4%
2022-04-23 12:38:21,976 reid_baseline.train INFO: normal accuracy 0.9559126493613515 0.9557571411132812 
2022-04-23 12:38:21,976 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 12:38:21,976 reid_baseline.train INFO: Source Clean Accuracy: 95.6%
2022-04-23 12:38:26,710 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_10
2022-04-23 12:38:26,710 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=10)
2022-04-23 12:38:26,710 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 12:38:26,712 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 12:38:26,713 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 12:38:33,945 reid_baseline.train INFO: start training
2022-04-23 12:39:06,081 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.108, Acc: 0.176, Base Lr: 8.72e-04
2022-04-23 12:39:21,516 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-23 12:39:49,522 reid_baseline.train INFO: normal accuracy 0.3321878579610538 4.172986030578613 
2022-04-23 12:40:20,474 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 12:40:20,474 reid_baseline.train INFO: Accuracy: 33.2% Mean Entropy: 417.3%
2022-04-23 12:40:55,172 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.921, Acc: 0.546, Base Lr: 1.66e-03
2022-04-23 12:41:13,986 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.352[s] Speed: 45.4[samples/s]
2022-04-23 12:41:50,172 reid_baseline.train INFO: normal accuracy 0.4054982817869416 4.169567108154297 
2022-04-23 12:42:21,270 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 12:42:21,270 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 417.0%
2022-04-23 12:42:52,946 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.602, Acc: 0.593, Base Lr: 2.46e-03
2022-04-23 12:43:07,555 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.304[s] Speed: 52.5[samples/s]
2022-04-23 12:43:35,585 reid_baseline.train INFO: normal accuracy 0.41649484536082476 4.150212287902832 
2022-04-23 12:44:06,805 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 12:44:06,806 reid_baseline.train INFO: Accuracy: 41.6% Mean Entropy: 415.0%
2022-04-23 12:44:38,037 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 5.129, Acc: 0.621, Base Lr: 3.25e-03
2022-04-23 12:44:53,011 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.304[s] Speed: 52.6[samples/s]
2022-04-23 12:46:03,587 reid_baseline.train INFO: normal accuracy 0.4268041237113402 4.026819229125977 
2022-04-23 12:46:34,646 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 12:46:34,646 reid_baseline.train INFO: Accuracy: 42.7% Mean Entropy: 402.7%
2022-04-23 12:47:05,223 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.518, Acc: 0.619, Base Lr: 4.04e-03
2022-04-23 12:47:24,894 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-23 12:48:34,553 reid_baseline.train INFO: normal accuracy 0.4579610538373425 3.6247920989990234 
2022-04-23 12:49:14,069 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 12:49:14,069 reid_baseline.train INFO: Accuracy: 45.8% Mean Entropy: 362.5%
2022-04-23 12:49:44,159 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.971, Acc: 0.683, Base Lr: 4.83e-03
2022-04-23 12:50:00,752 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-23 12:51:20,683 reid_baseline.train INFO: normal accuracy 0.5221076746849943 3.2324013710021973 
2022-04-23 12:51:56,623 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 12:51:56,623 reid_baseline.train INFO: Accuracy: 52.2% Mean Entropy: 323.2%
2022-04-23 12:52:27,513 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.683, Acc: 0.721, Base Lr: 5.62e-03
2022-04-23 12:52:41,624 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 12:53:09,849 reid_baseline.train INFO: normal accuracy 0.5516609392898053 2.9275453090667725 
2022-04-23 12:53:43,684 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 12:53:43,685 reid_baseline.train INFO: Accuracy: 55.2% Mean Entropy: 292.8%
2022-04-23 12:54:13,787 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.438, Acc: 0.790, Base Lr: 6.42e-03
2022-04-23 12:54:27,946 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 12:55:18,440 reid_baseline.train INFO: normal accuracy 0.5880870561282933 2.5801749229431152 
2022-04-23 12:55:52,231 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 12:55:52,231 reid_baseline.train INFO: Accuracy: 58.8% Mean Entropy: 258.0%
2022-04-23 12:56:22,565 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.317, Acc: 0.818, Base Lr: 7.21e-03
2022-04-23 12:56:36,983 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.294[s] Speed: 54.3[samples/s]
2022-04-23 12:57:04,911 reid_baseline.train INFO: normal accuracy 0.5885452462772051 2.3262009620666504 
2022-04-23 12:57:42,618 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 12:57:42,619 reid_baseline.train INFO: Accuracy: 58.9% Mean Entropy: 232.6%
2022-04-23 12:58:16,239 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.167, Acc: 0.857, Base Lr: 4.01e-03
2022-04-23 12:58:30,649 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-23 12:59:58,023 reid_baseline.train INFO: normal accuracy 0.5993127147766323 2.2450199127197266 
2022-04-23 13:00:29,656 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 13:00:29,657 reid_baseline.train INFO: Accuracy: 59.9% Mean Entropy: 224.5%
2022-04-23 13:01:07,193 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.103, Acc: 0.876, Base Lr: 3.38e-03
2022-04-23 13:01:21,589 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-23 13:01:48,487 reid_baseline.train INFO: normal accuracy 0.604352806414662 2.1329925060272217 
2022-04-23 13:02:19,514 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 13:02:19,515 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 213.3%
2022-04-23 13:02:53,764 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.096, Acc: 0.877, Base Lr: 2.77e-03
2022-04-23 13:03:09,135 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.326[s] Speed: 49.1[samples/s]
2022-04-23 13:03:36,040 reid_baseline.train INFO: normal accuracy 0.60893470790378 2.1131539344787598 
2022-04-23 13:04:06,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 13:04:06,859 reid_baseline.train INFO: Accuracy: 60.9% Mean Entropy: 211.3%
2022-04-23 13:04:36,980 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.065, Acc: 0.869, Base Lr: 2.20e-03
2022-04-23 13:04:52,412 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 13:05:19,651 reid_baseline.train INFO: normal accuracy 0.6036655211912944 2.1029179096221924 
2022-04-23 13:05:50,914 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 13:05:50,915 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 210.3%
2022-04-23 13:06:20,691 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.034, Acc: 0.878, Base Lr: 1.66e-03
2022-04-23 13:06:38,019 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-23 13:07:13,175 reid_baseline.train INFO: normal accuracy 0.60893470790378 2.0593786239624023 
2022-04-23 13:07:45,543 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 13:07:45,543 reid_baseline.train INFO: Accuracy: 60.9% Mean Entropy: 205.9%
2022-04-23 13:08:20,944 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.026, Acc: 0.887, Base Lr: 1.19e-03
2022-04-23 13:08:35,751 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-23 13:09:01,879 reid_baseline.train INFO: normal accuracy 0.6155784650630012 2.039074659347534 
2022-04-23 13:09:49,920 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 13:09:49,920 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 203.9%
2022-04-23 13:10:22,546 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.026, Acc: 0.886, Base Lr: 7.78e-04
2022-04-23 13:10:44,867 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-23 13:11:11,631 reid_baseline.train INFO: normal accuracy 0.6151202749140894 1.9780733585357666 
2022-04-23 13:11:44,518 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 13:11:44,519 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 197.8%
2022-04-23 13:12:19,579 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.995, Acc: 0.890, Base Lr: 4.51e-04
2022-04-23 13:12:38,210 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.353[s] Speed: 45.3[samples/s]
2022-04-23 13:13:05,044 reid_baseline.train INFO: normal accuracy 0.6155784650630012 2.047462224960327 
2022-04-23 13:13:05,045 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 13:13:05,045 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 204.7%
2022-04-23 13:13:35,069 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.010, Acc: 0.886, Base Lr: 2.11e-04
2022-04-23 13:13:49,027 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-23 13:14:14,792 reid_baseline.train INFO: normal accuracy 0.6153493699885453 2.019656181335449 
2022-04-23 13:14:14,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 13:14:14,792 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 202.0%
2022-04-23 13:14:44,911 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.995, Acc: 0.884, Base Lr: 6.51e-05
2022-04-23 13:15:04,095 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.324[s] Speed: 49.3[samples/s]
2022-04-23 13:15:53,085 reid_baseline.train INFO: normal accuracy 0.6144329896907217 2.0359647274017334 
2022-04-23 13:15:53,085 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 13:15:53,086 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 203.6%
2022-04-23 13:16:23,014 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.012, Acc: 0.882, Base Lr: 1.60e-05
2022-04-23 13:16:36,972 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 13:17:34,062 reid_baseline.train INFO: normal accuracy 0.6155784650630012 2.042963981628418 
2022-04-23 13:17:34,062 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 13:17:34,063 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 204.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_10/transformer_best_model.pth
2022-04-23 13:18:30,519 reid_baseline.train INFO: normal accuracy 0.6151202749140894 1.9780733585357666 
2022-04-23 13:18:30,520 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 13:18:30,520 reid_baseline.train INFO: Accuracy: 61.5%
2022-04-23 13:19:41,666 reid_baseline.train INFO: normal accuracy 0.6151202749140894 1.9780733585357666 
2022-04-23 13:19:41,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 13:19:41,667 reid_baseline.train INFO: Shuffled Accuracy: 61.5%
2022-04-23 13:20:02,318 reid_baseline.train INFO: normal accuracy 0.9513803049031726 1.019910454750061 
2022-04-23 13:20:02,319 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 13:20:02,319 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
2022-04-23 13:20:07,079 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_10
2022-04-23 13:20:07,079 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=10)
2022-04-23 13:20:07,079 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 13:20:07,080 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 13:20:07,081 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 13:20:14,392 reid_baseline.train INFO: start training
2022-04-23 13:20:46,440 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.108, Acc: 0.176, Base Lr: 8.72e-04
2022-04-23 13:21:01,801 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.310[s] Speed: 51.6[samples/s]
2022-04-23 13:21:28,791 reid_baseline.train INFO: normal accuracy 0.4514530299617031 4.173089504241943 
2022-04-23 13:21:59,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 13:21:59,395 reid_baseline.train INFO: Accuracy: 45.1% Mean Entropy: 417.3%
2022-04-23 13:22:29,473 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.922, Acc: 0.546, Base Lr: 1.66e-03
2022-04-23 13:22:44,115 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 13:23:28,928 reid_baseline.train INFO: normal accuracy 0.5262446496958775 4.169798374176025 
2022-04-23 13:24:00,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 13:24:00,256 reid_baseline.train INFO: Accuracy: 52.6% Mean Entropy: 417.0%
2022-04-23 13:24:30,718 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.607, Acc: 0.594, Base Lr: 2.46e-03
2022-04-23 13:24:45,378 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.297[s] Speed: 53.9[samples/s]
2022-04-23 13:25:12,887 reid_baseline.train INFO: normal accuracy 0.532777652624465 4.149055004119873 
2022-04-23 13:25:43,805 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 13:25:43,806 reid_baseline.train INFO: Accuracy: 53.3% Mean Entropy: 414.9%
2022-04-23 13:26:14,611 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 5.137, Acc: 0.622, Base Lr: 3.25e-03
2022-04-23 13:26:29,340 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-23 13:26:55,995 reid_baseline.train INFO: normal accuracy 0.5224149583239468 4.0214524269104 
2022-04-23 13:27:28,125 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 13:27:28,126 reid_baseline.train INFO: Accuracy: 52.2% Mean Entropy: 402.1%
2022-04-23 13:28:01,460 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.525, Acc: 0.624, Base Lr: 4.04e-03
2022-04-23 13:28:16,142 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.316[s] Speed: 50.7[samples/s]
2022-04-23 13:28:42,737 reid_baseline.train INFO: normal accuracy 0.5690470826762785 3.6038124561309814 
2022-04-23 13:29:13,987 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 13:29:13,988 reid_baseline.train INFO: Accuracy: 56.9% Mean Entropy: 360.4%
2022-04-23 13:29:44,188 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.992, Acc: 0.684, Base Lr: 4.83e-03
2022-04-23 13:29:58,495 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-23 13:30:25,529 reid_baseline.train INFO: normal accuracy 0.6328001802207704 3.1046714782714844 
2022-04-23 13:30:56,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 13:30:56,492 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 310.5%
2022-04-23 13:31:35,269 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.691, Acc: 0.726, Base Lr: 5.62e-03
2022-04-23 13:31:49,665 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-23 13:32:39,467 reid_baseline.train INFO: normal accuracy 0.6877675152061276 2.7131476402282715 
2022-04-23 13:33:10,475 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 13:33:10,476 reid_baseline.train INFO: Accuracy: 68.8% Mean Entropy: 271.3%
2022-04-23 13:33:40,364 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.439, Acc: 0.792, Base Lr: 6.42e-03
2022-04-23 13:33:54,513 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 13:34:22,135 reid_baseline.train INFO: normal accuracy 0.7208830817751746 2.32346248626709 
2022-04-23 13:34:53,788 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 13:34:53,789 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 232.3%
2022-04-23 13:35:30,936 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.316, Acc: 0.818, Base Lr: 7.21e-03
2022-04-23 13:35:45,226 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-23 13:36:12,477 reid_baseline.train INFO: normal accuracy 0.7474656454156342 2.09004545211792 
2022-04-23 13:36:43,702 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 13:36:43,703 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 209.0%
2022-04-23 13:37:14,523 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.179, Acc: 0.851, Base Lr: 4.01e-03
2022-04-23 13:37:28,914 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.297[s] Speed: 53.8[samples/s]
2022-04-23 13:38:27,267 reid_baseline.train INFO: normal accuracy 0.7562514079747691 2.0373265743255615 
2022-04-23 13:38:59,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 13:38:59,164 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 203.7%
2022-04-23 13:39:32,289 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.105, Acc: 0.870, Base Lr: 3.38e-03
2022-04-23 13:39:46,681 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-23 13:40:14,477 reid_baseline.train INFO: normal accuracy 0.7648118945708493 1.9039853811264038 
2022-04-23 13:40:46,843 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 13:40:46,843 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 190.4%
2022-04-23 13:41:22,342 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.093, Acc: 0.878, Base Lr: 2.77e-03
2022-04-23 13:41:36,557 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.327[s] Speed: 48.9[samples/s]
2022-04-23 13:42:03,039 reid_baseline.train INFO: normal accuracy 0.7679657580536157 1.8842732906341553 
2022-04-23 13:42:34,132 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 13:42:34,133 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 188.4%
2022-04-23 13:43:04,414 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.066, Acc: 0.865, Base Lr: 2.20e-03
2022-04-23 13:43:19,710 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.300[s] Speed: 53.4[samples/s]
2022-04-23 13:43:47,673 reid_baseline.train INFO: normal accuracy 0.7695426897949988 1.9172981977462769 
2022-04-23 13:43:47,674 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 13:43:47,674 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 191.7%
2022-04-23 13:44:17,240 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.036, Acc: 0.876, Base Lr: 1.66e-03
2022-04-23 13:44:31,763 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.290[s] Speed: 55.2[samples/s]
2022-04-23 13:44:59,081 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.855055570602417 
2022-04-23 13:45:30,379 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 13:45:30,379 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 185.5%
2022-04-23 13:46:00,393 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.024, Acc: 0.887, Base Lr: 1.19e-03
2022-04-23 13:46:15,231 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 13:47:27,108 reid_baseline.train INFO: normal accuracy 0.7722460013516558 1.8289490938186646 
2022-04-23 13:47:58,168 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 13:47:58,169 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 182.9%
2022-04-23 13:48:28,158 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.027, Acc: 0.888, Base Lr: 7.78e-04
2022-04-23 13:48:42,539 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 13:49:30,365 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.7577357292175293 
2022-04-23 13:50:01,545 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 13:50:01,546 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.8%
2022-04-23 13:50:31,262 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.000, Acc: 0.882, Base Lr: 4.51e-04
2022-04-23 13:50:45,833 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 13:51:54,848 reid_baseline.train INFO: normal accuracy 0.7731471052038748 1.8209853172302246 
2022-04-23 13:51:54,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 13:51:54,849 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 182.1%
2022-04-23 13:52:24,842 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.012, Acc: 0.893, Base Lr: 2.11e-04
2022-04-23 13:52:38,747 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 13:53:05,599 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.8020354509353638 
2022-04-23 13:53:05,599 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 13:53:05,600 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 180.2%
2022-04-23 13:53:35,674 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.998, Acc: 0.886, Base Lr: 6.51e-05
2022-04-23 13:53:50,214 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-23 13:54:17,795 reid_baseline.train INFO: normal accuracy 0.7760756927235863 1.8274126052856445 
2022-04-23 13:54:17,795 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 13:54:17,796 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 182.7%
2022-04-23 13:54:47,858 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.012, Acc: 0.884, Base Lr: 1.60e-05
2022-04-23 13:55:01,809 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.290[s] Speed: 55.3[samples/s]
2022-04-23 13:56:00,127 reid_baseline.train INFO: normal accuracy 0.7735976571299842 1.824543833732605 
2022-04-23 13:56:00,127 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 13:56:00,127 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 182.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_10/transformer_best_model.pth
2022-04-23 13:56:56,806 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.7577357292175293 
2022-04-23 13:56:56,806 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 13:56:56,807 reid_baseline.train INFO: Accuracy: 77.3%
2022-04-23 13:57:23,451 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.7577357292175293 
2022-04-23 13:57:23,451 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 13:57:23,451 reid_baseline.train INFO: Shuffled Accuracy: 77.3%
2022-04-23 13:57:44,023 reid_baseline.train INFO: normal accuracy 0.9513803049031726 1.0101503133773804 
2022-04-23 13:57:44,024 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 13:57:44,024 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
2022-04-23 13:57:48,767 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_10
2022-04-23 13:57:48,767 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=10)
2022-04-23 13:57:48,767 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 13:57:48,768 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 13:57:48,769 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 13:57:56,146 reid_baseline.train INFO: start training
2022-04-23 13:58:28,210 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.108, Acc: 0.175, Base Lr: 8.72e-04
2022-04-23 13:58:43,711 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-23 14:00:02,379 reid_baseline.train INFO: normal accuracy 0.5164103741106266 4.17303991317749 
2022-04-23 14:00:33,680 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 14:00:33,681 reid_baseline.train INFO: Accuracy: 51.6% Mean Entropy: 417.3%
2022-04-23 14:01:03,778 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.922, Acc: 0.548, Base Lr: 1.66e-03
2022-04-23 14:01:18,349 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 14:02:35,595 reid_baseline.train INFO: normal accuracy 0.5988065182464999 4.1688737869262695 
2022-04-23 14:03:06,552 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 14:03:06,552 reid_baseline.train INFO: Accuracy: 59.9% Mean Entropy: 416.9%
2022-04-23 14:03:36,769 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.606, Acc: 0.600, Base Lr: 2.46e-03
2022-04-23 14:03:51,452 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 14:05:11,699 reid_baseline.train INFO: normal accuracy 0.6125774615561166 4.1385931968688965 
2022-04-23 14:05:42,753 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 14:05:42,754 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 413.9%
2022-04-23 14:06:13,577 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 5.150, Acc: 0.616, Base Lr: 3.25e-03
2022-04-23 14:06:28,209 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-23 14:07:44,050 reid_baseline.train INFO: normal accuracy 0.610970851503328 3.939038038253784 
2022-04-23 14:08:15,989 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 14:08:15,989 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 393.9%
2022-04-23 14:08:45,744 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.531, Acc: 0.625, Base Lr: 4.04e-03
2022-04-23 14:09:00,423 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.292[s] Speed: 54.7[samples/s]
2022-04-23 14:10:18,299 reid_baseline.train INFO: normal accuracy 0.6504475556575625 3.3705220222473145 
2022-04-23 14:10:49,285 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 14:10:49,285 reid_baseline.train INFO: Accuracy: 65.0% Mean Entropy: 337.1%
2022-04-23 14:11:19,288 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.991, Acc: 0.682, Base Lr: 4.83e-03
2022-04-23 14:11:33,593 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-23 14:12:52,561 reid_baseline.train INFO: normal accuracy 0.7066789075051642 2.7925684452056885 
2022-04-23 14:13:23,585 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 14:13:23,586 reid_baseline.train INFO: Accuracy: 70.7% Mean Entropy: 279.3%
2022-04-23 14:13:54,581 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.706, Acc: 0.725, Base Lr: 5.62e-03
2022-04-23 14:14:11,231 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-23 14:15:32,894 reid_baseline.train INFO: normal accuracy 0.7502868946522837 2.397235155105591 
2022-04-23 14:16:04,846 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 14:16:04,846 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 239.7%
2022-04-23 14:16:38,563 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.446, Acc: 0.799, Base Lr: 6.42e-03
2022-04-23 14:16:53,064 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.317[s] Speed: 50.4[samples/s]
2022-04-23 14:18:05,496 reid_baseline.train INFO: normal accuracy 0.7771402341060363 2.0483415126800537 
2022-04-23 14:18:37,085 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 14:18:37,086 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 204.8%
2022-04-23 14:19:07,193 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.325, Acc: 0.813, Base Lr: 7.21e-03
2022-04-23 14:19:23,384 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.305[s] Speed: 52.5[samples/s]
2022-04-23 14:20:31,832 reid_baseline.train INFO: normal accuracy 0.8016984163415194 1.8096357583999634 
2022-04-23 14:21:03,171 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 14:21:03,171 reid_baseline.train INFO: Accuracy: 80.2% Mean Entropy: 181.0%
2022-04-23 14:21:41,001 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.179, Acc: 0.848, Base Lr: 4.01e-03
2022-04-23 14:21:55,373 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-23 14:23:32,234 reid_baseline.train INFO: normal accuracy 0.8101904980491164 1.7299573421478271 
2022-04-23 14:24:03,252 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 14:24:03,252 reid_baseline.train INFO: Accuracy: 81.0% Mean Entropy: 173.0%
2022-04-23 14:24:32,963 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.111, Acc: 0.878, Base Lr: 3.38e-03
2022-04-23 14:24:50,444 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.310[s] Speed: 51.5[samples/s]
2022-04-23 14:26:14,233 reid_baseline.train INFO: normal accuracy 0.8173054854257517 1.637452483177185 
2022-04-23 14:26:45,549 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 14:26:45,549 reid_baseline.train INFO: Accuracy: 81.7% Mean Entropy: 163.7%
2022-04-23 14:27:19,286 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.093, Acc: 0.880, Base Lr: 2.77e-03
2022-04-23 14:27:35,180 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.326[s] Speed: 49.0[samples/s]
2022-04-23 14:28:51,807 reid_baseline.train INFO: normal accuracy 0.8212072526968097 1.6283674240112305 
2022-04-23 14:29:22,234 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 14:29:22,234 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.8%
2022-04-23 14:29:52,313 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.068, Acc: 0.865, Base Lr: 2.20e-03
2022-04-23 14:30:07,561 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.7[samples/s]
2022-04-23 14:31:25,399 reid_baseline.train INFO: normal accuracy 0.8202891898095019 1.653465747833252 
2022-04-23 14:31:25,400 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 14:31:25,400 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 165.3%
2022-04-23 14:31:55,027 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.034, Acc: 0.884, Base Lr: 1.66e-03
2022-04-23 14:32:09,639 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 14:33:31,324 reid_baseline.train INFO: normal accuracy 0.8216662841404636 1.602457880973816 
2022-04-23 14:34:02,172 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 14:34:02,173 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 160.2%
2022-04-23 14:34:32,047 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.028, Acc: 0.886, Base Lr: 1.19e-03
2022-04-23 14:34:46,737 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 14:36:23,208 reid_baseline.train INFO: normal accuracy 0.8253385356896947 1.5821008682250977 
2022-04-23 14:36:53,813 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 14:36:53,814 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 158.2%
2022-04-23 14:37:23,689 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.029, Acc: 0.883, Base Lr: 7.78e-04
2022-04-23 14:37:37,949 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 14:38:55,341 reid_baseline.train INFO: normal accuracy 0.8269451457424833 1.5187925100326538 
2022-04-23 14:39:26,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 14:39:26,002 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 151.9%
2022-04-23 14:39:55,771 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.002, Acc: 0.892, Base Lr: 4.51e-04
2022-04-23 14:40:10,133 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 14:41:28,533 reid_baseline.train INFO: normal accuracy 0.8239614413587331 1.582427740097046 
2022-04-23 14:41:28,534 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 14:41:28,534 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 158.2%
2022-04-23 14:42:07,002 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.015, Acc: 0.884, Base Lr: 2.11e-04
2022-04-23 14:42:20,994 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-23 14:43:50,891 reid_baseline.train INFO: normal accuracy 0.8274041771861372 1.5687177181243896 
2022-04-23 14:43:50,892 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 14:43:50,892 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 156.9%
2022-04-23 14:44:24,558 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.995, Acc: 0.888, Base Lr: 6.51e-05
2022-04-23 14:44:39,429 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.319[s] Speed: 50.1[samples/s]
2022-04-23 14:46:13,171 reid_baseline.train INFO: normal accuracy 0.8260270828551756 1.5767822265625 
2022-04-23 14:46:13,171 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 14:46:13,172 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 157.7%
2022-04-23 14:46:43,103 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.021, Acc: 0.880, Base Lr: 1.60e-05
2022-04-23 14:46:57,170 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.289[s] Speed: 55.3[samples/s]
2022-04-23 14:48:39,904 reid_baseline.train INFO: normal accuracy 0.8255680514115217 1.5806126594543457 
2022-04-23 14:48:39,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 14:48:39,905 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 158.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_10/transformer_best_model.pth
2022-04-23 14:50:13,207 reid_baseline.train INFO: normal accuracy 0.8269451457424833 1.5187925100326538 
2022-04-23 14:50:13,208 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 14:50:13,208 reid_baseline.train INFO: Accuracy: 82.7%
2022-04-23 14:51:48,304 reid_baseline.train INFO: normal accuracy 0.8269451457424833 1.5187925100326538 
2022-04-23 14:51:48,305 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 14:51:48,305 reid_baseline.train INFO: Shuffled Accuracy: 82.7%
2022-04-23 14:52:09,031 reid_baseline.train INFO: normal accuracy 0.9534404614750721 1.0223877429962158 
2022-04-23 14:52:09,031 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 14:52:09,032 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-23 14:52:13,772 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_12
2022-04-23 14:52:13,772 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-23 14:52:13,772 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 14:52:13,773 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 14:52:13,774 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 14:52:21,228 reid_baseline.train INFO: start training
2022-04-23 14:52:53,234 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.057, Acc: 0.168, Base Lr: 8.72e-04
2022-04-23 14:53:08,554 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.309[s] Speed: 51.7[samples/s]
2022-04-23 14:54:12,004 reid_baseline.train INFO: normal accuracy 0.3223367697594502 4.173038482666016 
2022-04-23 14:54:44,286 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 14:54:44,286 reid_baseline.train INFO: Accuracy: 32.2% Mean Entropy: 417.3%
2022-04-23 14:55:14,317 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.904, Acc: 0.543, Base Lr: 1.66e-03
2022-04-23 14:55:28,810 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 14:55:55,425 reid_baseline.train INFO: normal accuracy 0.39908361970217643 4.170173645019531 
2022-04-23 14:56:26,201 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 14:56:26,202 reid_baseline.train INFO: Accuracy: 39.9% Mean Entropy: 417.0%
2022-04-23 14:56:57,116 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.645, Acc: 0.598, Base Lr: 2.46e-03
2022-04-23 14:57:15,686 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.326[s] Speed: 49.2[samples/s]
2022-04-23 14:57:43,756 reid_baseline.train INFO: normal accuracy 0.40939289805269186 4.1559247970581055 
2022-04-23 14:58:14,604 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 14:58:14,604 reid_baseline.train INFO: Accuracy: 40.9% Mean Entropy: 415.6%
2022-04-23 14:58:45,245 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 5.186, Acc: 0.626, Base Lr: 3.25e-03
2022-04-23 14:58:59,995 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-23 14:59:25,963 reid_baseline.train INFO: normal accuracy 0.41947308132875144 4.070236682891846 
2022-04-23 14:59:58,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 14:59:58,533 reid_baseline.train INFO: Accuracy: 41.9% Mean Entropy: 407.0%
2022-04-23 15:00:31,201 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.585, Acc: 0.610, Base Lr: 4.04e-03
2022-04-23 15:00:45,826 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.311[s] Speed: 51.4[samples/s]
2022-04-23 15:01:13,079 reid_baseline.train INFO: normal accuracy 0.44948453608247424 3.733474016189575 
2022-04-23 15:01:43,832 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 15:01:43,833 reid_baseline.train INFO: Accuracy: 44.9% Mean Entropy: 373.3%
2022-04-23 15:02:16,272 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 4.052, Acc: 0.674, Base Lr: 4.83e-03
2022-04-23 15:02:35,104 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.337[s] Speed: 47.4[samples/s]
2022-04-23 15:03:15,251 reid_baseline.train INFO: normal accuracy 0.506758304696449 3.31343936920166 
2022-04-23 15:03:45,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 15:03:45,909 reid_baseline.train INFO: Accuracy: 50.7% Mean Entropy: 331.3%
2022-04-23 15:04:16,620 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.748, Acc: 0.728, Base Lr: 5.62e-03
2022-04-23 15:04:30,892 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 15:04:57,574 reid_baseline.train INFO: normal accuracy 0.5502863688430699 2.930541753768921 
2022-04-23 15:05:29,511 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 15:05:29,511 reid_baseline.train INFO: Accuracy: 55.0% Mean Entropy: 293.1%
2022-04-23 15:06:05,902 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.424, Acc: 0.790, Base Lr: 6.42e-03
2022-04-23 15:06:20,053 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-23 15:06:47,850 reid_baseline.train INFO: normal accuracy 0.5876288659793815 2.616410732269287 
2022-04-23 15:07:18,780 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 15:07:18,781 reid_baseline.train INFO: Accuracy: 58.8% Mean Entropy: 261.6%
2022-04-23 15:07:49,016 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.301, Acc: 0.814, Base Lr: 7.21e-03
2022-04-23 15:08:03,398 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 15:09:14,620 reid_baseline.train INFO: normal accuracy 0.5983963344788087 2.3341777324676514 
2022-04-23 15:09:45,668 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 15:09:45,669 reid_baseline.train INFO: Accuracy: 59.8% Mean Entropy: 233.4%
2022-04-23 15:10:16,576 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.183, Acc: 0.856, Base Lr: 4.01e-03
2022-04-23 15:10:30,790 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 15:12:12,566 reid_baseline.train INFO: normal accuracy 0.6100801832760596 2.2547526359558105 
2022-04-23 15:13:00,993 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 15:13:00,995 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 225.5%
2022-04-23 15:13:31,051 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.117, Acc: 0.872, Base Lr: 3.38e-03
2022-04-23 15:13:45,610 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.293[s] Speed: 54.6[samples/s]
2022-04-23 15:14:30,962 reid_baseline.train INFO: normal accuracy 0.613745704467354 2.133495569229126 
2022-04-23 15:15:01,758 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 15:15:01,758 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 213.3%
2022-04-23 15:15:31,814 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.077, Acc: 0.879, Base Lr: 2.77e-03
2022-04-23 15:15:47,244 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.299[s] Speed: 53.6[samples/s]
2022-04-23 15:16:26,974 reid_baseline.train INFO: normal accuracy 0.6213058419243986 2.1102211475372314 
2022-04-23 15:16:58,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 15:16:58,533 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 211.0%
2022-04-23 15:17:39,371 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.068, Acc: 0.871, Base Lr: 2.20e-03
2022-04-23 15:17:57,409 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.387[s] Speed: 41.4[samples/s]
2022-04-23 15:18:25,106 reid_baseline.train INFO: normal accuracy 0.6153493699885453 2.099199056625366 
2022-04-23 15:18:56,111 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 15:18:56,112 reid_baseline.train INFO: Accuracy: 61.5% Mean Entropy: 209.9%
2022-04-23 15:19:25,727 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.035, Acc: 0.885, Base Lr: 1.66e-03
2022-04-23 15:19:40,312 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 15:20:07,578 reid_baseline.train INFO: normal accuracy 0.6194730813287515 2.0542352199554443 
2022-04-23 15:20:43,509 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 15:20:43,509 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 205.4%
2022-04-23 15:21:21,377 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.029, Acc: 0.895, Base Lr: 1.19e-03
2022-04-23 15:21:36,410 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-23 15:22:03,557 reid_baseline.train INFO: normal accuracy 0.6190148911798397 2.0475990772247314 
2022-04-23 15:22:34,102 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 15:22:34,103 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 204.8%
2022-04-23 15:23:04,327 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.038, Acc: 0.882, Base Lr: 7.78e-04
2022-04-23 15:23:18,784 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 15:24:19,606 reid_baseline.train INFO: normal accuracy 0.6213058419243986 1.9557387828826904 
2022-04-23 15:24:52,023 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 15:24:52,024 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 195.6%
2022-04-23 15:25:21,987 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.994, Acc: 0.889, Base Lr: 4.51e-04
2022-04-23 15:25:36,403 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-23 15:26:03,628 reid_baseline.train INFO: normal accuracy 0.6219931271477663 2.03308367729187 
2022-04-23 15:26:03,628 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 15:26:03,628 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 203.3%
2022-04-23 15:26:33,735 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.004, Acc: 0.893, Base Lr: 2.11e-04
2022-04-23 15:26:47,815 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 15:27:36,812 reid_baseline.train INFO: normal accuracy 0.6224513172966781 2.0022521018981934 
2022-04-23 15:27:36,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 15:27:36,813 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 200.2%
2022-04-23 15:28:06,993 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.984, Acc: 0.889, Base Lr: 6.51e-05
2022-04-23 15:28:21,592 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 15:28:49,592 reid_baseline.train INFO: normal accuracy 0.6208476517754868 2.0224123001098633 
2022-04-23 15:28:49,593 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 15:28:49,593 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 202.2%
2022-04-23 15:29:19,396 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.005, Acc: 0.890, Base Lr: 1.60e-05
2022-04-23 15:29:33,300 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-23 15:30:49,843 reid_baseline.train INFO: normal accuracy 0.6217640320733104 2.0260748863220215 
2022-04-23 15:30:49,843 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 15:30:49,843 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 202.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_layer_12/transformer_best_model.pth
2022-04-23 15:31:47,490 reid_baseline.train INFO: normal accuracy 0.6213058419243986 1.9557387828826904 
2022-04-23 15:31:47,490 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 15:31:47,491 reid_baseline.train INFO: Accuracy: 62.1%
2022-04-23 15:32:15,022 reid_baseline.train INFO: normal accuracy 0.6213058419243986 1.9557387828826904 
2022-04-23 15:32:15,023 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 15:32:15,023 reid_baseline.train INFO: Shuffled Accuracy: 62.1%
2022-04-23 15:32:36,073 reid_baseline.train INFO: normal accuracy 0.9509682735887928 1.0246703624725342 
2022-04-23 15:32:36,074 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 15:32:36,074 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
2022-04-23 15:32:40,896 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_12
2022-04-23 15:32:40,896 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-23 15:32:40,896 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 15:32:40,897 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 15:32:40,897 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 15:32:48,325 reid_baseline.train INFO: start training
2022-04-23 15:33:22,607 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.056, Acc: 0.168, Base Lr: 8.72e-04
2022-04-23 15:33:40,594 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-23 15:34:08,867 reid_baseline.train INFO: normal accuracy 0.4338815048434332 4.1731438636779785 
2022-04-23 15:34:40,352 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 15:34:40,352 reid_baseline.train INFO: Accuracy: 43.4% Mean Entropy: 417.3%
2022-04-23 15:35:18,971 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.899, Acc: 0.546, Base Lr: 1.66e-03
2022-04-23 15:35:33,500 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.350[s] Speed: 45.8[samples/s]
2022-04-23 15:36:00,742 reid_baseline.train INFO: normal accuracy 0.51971164676729 4.170406341552734 
2022-04-23 15:36:51,217 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 15:36:51,218 reid_baseline.train INFO: Accuracy: 52.0% Mean Entropy: 417.0%
2022-04-23 15:37:21,641 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.632, Acc: 0.600, Base Lr: 2.46e-03
2022-04-23 15:37:36,242 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.0[samples/s]
2022-04-23 15:38:04,927 reid_baseline.train INFO: normal accuracy 0.5183599909889615 4.153512954711914 
2022-04-23 15:38:35,728 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 15:38:35,728 reid_baseline.train INFO: Accuracy: 51.8% Mean Entropy: 415.4%
2022-04-23 15:39:06,765 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 5.161, Acc: 0.619, Base Lr: 3.25e-03
2022-04-23 15:39:23,540 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.315[s] Speed: 50.9[samples/s]
2022-04-23 15:39:57,453 reid_baseline.train INFO: normal accuracy 0.5127280919125929 4.042412757873535 
2022-04-23 15:40:28,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 15:40:28,242 reid_baseline.train INFO: Accuracy: 51.3% Mean Entropy: 404.2%
2022-04-23 15:40:58,211 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.530, Acc: 0.615, Base Lr: 4.04e-03
2022-04-23 15:41:12,956 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 15:41:40,884 reid_baseline.train INFO: normal accuracy 0.5544041450777202 3.654810667037964 
2022-04-23 15:42:14,626 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 15:42:14,627 reid_baseline.train INFO: Accuracy: 55.4% Mean Entropy: 365.5%
2022-04-23 15:42:51,142 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 4.009, Acc: 0.677, Base Lr: 4.83e-03
2022-04-23 15:43:10,286 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.366[s] Speed: 43.7[samples/s]
2022-04-23 15:43:38,489 reid_baseline.train INFO: normal accuracy 0.6224374859202523 3.1454708576202393 
2022-04-23 15:44:09,767 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 15:44:09,767 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 314.5%
2022-04-23 15:44:47,650 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.717, Acc: 0.729, Base Lr: 5.62e-03
2022-04-23 15:45:02,170 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-23 15:45:45,423 reid_baseline.train INFO: normal accuracy 0.6819103401667043 2.672100782394409 
2022-04-23 15:46:16,709 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 15:46:16,710 reid_baseline.train INFO: Accuracy: 68.2% Mean Entropy: 267.2%
2022-04-23 15:46:55,458 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.401, Acc: 0.798, Base Lr: 6.42e-03
2022-04-23 15:47:09,541 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-23 15:47:37,169 reid_baseline.train INFO: normal accuracy 0.7195314259968462 2.355112314224243 
2022-04-23 15:48:21,907 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 15:48:21,908 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 235.5%
2022-04-23 15:48:54,713 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.286, Acc: 0.824, Base Lr: 7.21e-03
2022-04-23 15:49:08,979 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.310[s] Speed: 51.7[samples/s]
2022-04-23 15:49:36,726 reid_baseline.train INFO: normal accuracy 0.7436359540437035 2.124289035797119 
2022-04-23 15:50:07,304 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 15:50:07,305 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 212.4%
2022-04-23 15:50:37,976 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.172, Acc: 0.854, Base Lr: 4.01e-03
2022-04-23 15:50:52,168 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 15:51:59,749 reid_baseline.train INFO: normal accuracy 0.7546744762333859 2.0221974849700928 
2022-04-23 15:52:30,354 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 15:52:30,354 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 202.2%
2022-04-23 15:52:59,984 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.108, Acc: 0.870, Base Lr: 3.38e-03
2022-04-23 15:53:14,156 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.288[s] Speed: 55.5[samples/s]
2022-04-23 15:53:41,784 reid_baseline.train INFO: normal accuracy 0.7618833070511376 1.9472711086273193 
2022-04-23 15:54:12,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 15:54:12,322 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 194.7%
2022-04-23 15:54:44,115 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.065, Acc: 0.880, Base Lr: 2.77e-03
2022-04-23 15:55:01,113 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-23 15:55:28,860 reid_baseline.train INFO: normal accuracy 0.7654877224600135 1.8778433799743652 
2022-04-23 15:55:59,551 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 15:55:59,551 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 187.8%
2022-04-23 15:56:29,615 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.054, Acc: 0.873, Base Lr: 2.20e-03
2022-04-23 15:56:44,918 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.298[s] Speed: 53.6[samples/s]
2022-04-23 15:57:12,626 reid_baseline.train INFO: normal accuracy 0.7643613426447398 1.8896970748901367 
2022-04-23 15:57:12,627 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 15:57:12,627 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 189.0%
2022-04-23 15:57:42,239 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.016, Acc: 0.884, Base Lr: 1.66e-03
2022-04-23 15:57:56,782 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 15:58:24,341 reid_baseline.train INFO: normal accuracy 0.7681910340166704 1.8379645347595215 
2022-04-23 15:58:55,157 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 15:58:55,158 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 183.8%
2022-04-23 15:59:27,677 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.019, Acc: 0.895, Base Lr: 1.19e-03
2022-04-23 15:59:44,613 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-23 16:00:12,447 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.8559813499450684 
2022-04-23 16:00:12,447 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 16:00:12,447 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 185.6%
2022-04-23 16:00:42,589 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.036, Acc: 0.887, Base Lr: 7.78e-04
2022-04-23 16:00:56,943 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.293[s] Speed: 54.7[samples/s]
2022-04-23 16:01:24,208 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.7670854330062866 
2022-04-23 16:01:54,921 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 16:01:54,922 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 176.7%
2022-04-23 16:02:24,770 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.980, Acc: 0.895, Base Lr: 4.51e-04
2022-04-23 16:02:39,135 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.291[s] Speed: 55.0[samples/s]
2022-04-23 16:03:07,220 reid_baseline.train INFO: normal accuracy 0.771119621536382 1.8403960466384888 
2022-04-23 16:03:07,220 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 16:03:07,220 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 184.0%
2022-04-23 16:03:37,207 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 2.999, Acc: 0.896, Base Lr: 2.11e-04
2022-04-23 16:03:52,031 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 16:04:32,738 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.811415433883667 
2022-04-23 16:04:32,739 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 16:04:32,739 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 181.1%
2022-04-23 16:05:02,930 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.974, Acc: 0.888, Base Lr: 6.51e-05
2022-04-23 16:05:17,462 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 16:05:46,411 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.8356733322143555 
2022-04-23 16:05:46,412 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 16:05:46,412 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 183.6%
2022-04-23 16:06:16,218 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 2.997, Acc: 0.887, Base Lr: 1.60e-05
2022-04-23 16:06:30,154 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-23 16:07:28,113 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.839136004447937 
2022-04-23 16:07:28,113 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 16:07:28,113 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 183.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_CEL_layer_12/transformer_best_model.pth
2022-04-23 16:08:47,628 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.7670854330062866 
2022-04-23 16:08:47,628 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 16:08:47,628 reid_baseline.train INFO: Accuracy: 77.2%
2022-04-23 16:09:15,200 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.7670854330062866 
2022-04-23 16:09:15,200 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 16:09:15,201 reid_baseline.train INFO: Shuffled Accuracy: 77.2%
2022-04-23 16:09:55,717 reid_baseline.train INFO: normal accuracy 0.9534404614750721 1.0126283168792725 
2022-04-23 16:09:55,717 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 16:09:55,717 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-23 16:10:00,514 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_12
2022-04-23 16:10:00,515 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('2')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False, layer_num=12)
2022-04-23 16:10:00,515 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-23 16:10:00,516 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-23 16:10:00,517 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 2
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-23 16:10:07,854 reid_baseline.train INFO: start training
2022-04-23 16:10:40,107 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.056, Acc: 0.167, Base Lr: 8.72e-04
2022-04-23 16:10:55,584 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.312[s] Speed: 51.3[samples/s]
2022-04-23 16:12:15,015 reid_baseline.train INFO: normal accuracy 0.5097544181776452 4.173099040985107 
2022-04-23 16:12:47,378 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-23 16:12:47,379 reid_baseline.train INFO: Accuracy: 51.0% Mean Entropy: 417.3%
2022-04-23 16:13:30,375 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.902, Acc: 0.543, Base Lr: 1.66e-03
2022-04-23 16:13:46,205 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.387[s] Speed: 41.3[samples/s]
2022-04-23 16:14:47,086 reid_baseline.train INFO: normal accuracy 0.598347486802846 4.169717788696289 
2022-04-23 16:15:17,900 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-23 16:15:17,900 reid_baseline.train INFO: Accuracy: 59.8% Mean Entropy: 417.0%
2022-04-23 16:15:48,280 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.638, Acc: 0.599, Base Lr: 2.46e-03
2022-04-23 16:16:02,883 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.296[s] Speed: 54.1[samples/s]
2022-04-23 16:17:07,696 reid_baseline.train INFO: normal accuracy 0.6043148955703466 4.1455888748168945 
2022-04-23 16:17:42,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-23 16:17:42,569 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 414.6%
2022-04-23 16:18:17,873 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 5.161, Acc: 0.612, Base Lr: 3.25e-03
2022-04-23 16:18:32,651 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-23 16:19:32,845 reid_baseline.train INFO: normal accuracy 0.6070690842322699 3.9809985160827637 
2022-04-23 16:20:03,513 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-23 16:20:03,514 reid_baseline.train INFO: Accuracy: 60.7% Mean Entropy: 398.1%
2022-04-23 16:20:33,385 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.558, Acc: 0.613, Base Lr: 4.04e-03
2022-04-23 16:20:48,395 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.295[s] Speed: 54.2[samples/s]
2022-04-23 16:22:07,541 reid_baseline.train INFO: normal accuracy 0.6470048198301583 3.454699754714966 
2022-04-23 16:22:59,409 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-23 16:22:59,410 reid_baseline.train INFO: Accuracy: 64.7% Mean Entropy: 345.5%
2022-04-23 16:23:29,643 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 4.037, Acc: 0.676, Base Lr: 4.83e-03
2022-04-23 16:23:44,241 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-23 16:24:45,412 reid_baseline.train INFO: normal accuracy 0.7053018131742025 2.877253293991089 
2022-04-23 16:25:16,154 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-23 16:25:16,154 reid_baseline.train INFO: Accuracy: 70.5% Mean Entropy: 287.7%
2022-04-23 16:25:54,225 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.741, Acc: 0.725, Base Lr: 5.62e-03
2022-04-23 16:26:08,388 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.344[s] Speed: 46.6[samples/s]
2022-04-23 16:27:25,712 reid_baseline.train INFO: normal accuracy 0.7454670644939179 2.4077308177948 
2022-04-23 16:27:56,315 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-23 16:27:56,315 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 240.8%
2022-04-23 16:28:26,174 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.421, Acc: 0.790, Base Lr: 6.42e-03
2022-04-23 16:28:40,430 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.290[s] Speed: 55.1[samples/s]
2022-04-23 16:29:41,682 reid_baseline.train INFO: normal accuracy 0.782419095708056 2.078747272491455 
2022-04-23 16:30:18,301 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-23 16:30:18,302 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 207.9%
2022-04-23 16:30:48,536 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.293, Acc: 0.819, Base Lr: 7.21e-03
2022-04-23 16:31:02,894 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.293[s] Speed: 54.5[samples/s]
2022-04-23 16:32:20,283 reid_baseline.train INFO: normal accuracy 0.8005508377323847 1.8425880670547485 
2022-04-23 16:32:51,199 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-23 16:32:51,200 reid_baseline.train INFO: Accuracy: 80.1% Mean Entropy: 184.3%
2022-04-23 16:33:21,990 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.174, Acc: 0.858, Base Lr: 4.01e-03
2022-04-23 16:33:37,538 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.305[s] Speed: 52.5[samples/s]
2022-04-23 16:35:27,889 reid_baseline.train INFO: normal accuracy 0.8088134037181547 1.7616190910339355 
2022-04-23 16:35:59,185 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-23 16:35:59,185 reid_baseline.train INFO: Accuracy: 80.9% Mean Entropy: 176.2%
2022-04-23 16:36:33,388 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.108, Acc: 0.868, Base Lr: 3.38e-03
2022-04-23 16:36:48,607 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-23 16:37:51,896 reid_baseline.train INFO: normal accuracy 0.8150103282074822 1.6897170543670654 
2022-04-23 16:38:23,274 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-23 16:38:23,275 reid_baseline.train INFO: Accuracy: 81.5% Mean Entropy: 169.0%
2022-04-23 16:39:01,557 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.070, Acc: 0.880, Base Lr: 2.77e-03
2022-04-23 16:39:15,814 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.346[s] Speed: 46.3[samples/s]
2022-04-23 16:40:15,334 reid_baseline.train INFO: normal accuracy 0.8193711269221942 1.6346956491470337 
2022-04-23 16:40:50,944 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-23 16:40:50,944 reid_baseline.train INFO: Accuracy: 81.9% Mean Entropy: 163.5%
2022-04-23 16:41:25,448 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.065, Acc: 0.868, Base Lr: 2.20e-03
2022-04-23 16:41:40,653 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.327[s] Speed: 48.9[samples/s]
2022-04-23 16:42:42,346 reid_baseline.train INFO: normal accuracy 0.8170759697039247 1.6506868600845337 
2022-04-23 16:42:42,346 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-23 16:42:42,347 reid_baseline.train INFO: Accuracy: 81.7% Mean Entropy: 165.1%
2022-04-23 16:43:17,635 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.036, Acc: 0.882, Base Lr: 1.66e-03
2022-04-23 16:43:32,193 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-23 16:44:37,518 reid_baseline.train INFO: normal accuracy 0.8173054854257517 1.6133899688720703 
2022-04-23 16:45:09,581 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-23 16:45:09,581 reid_baseline.train INFO: Accuracy: 81.7% Mean Entropy: 161.3%
2022-04-23 16:45:47,424 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.029, Acc: 0.890, Base Lr: 1.19e-03
2022-04-23 16:46:02,211 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.346[s] Speed: 46.2[samples/s]
2022-04-23 16:47:07,749 reid_baseline.train INFO: normal accuracy 0.8205187055313289 1.6249170303344727 
2022-04-23 16:47:07,750 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-23 16:47:07,750 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.5%
2022-04-23 16:47:44,930 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.040, Acc: 0.886, Base Lr: 7.78e-04
2022-04-23 16:47:59,095 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.338[s] Speed: 47.4[samples/s]
2022-04-23 16:49:00,843 reid_baseline.train INFO: normal accuracy 0.8228138627495983 1.5347226858139038 
2022-04-23 16:49:32,038 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-23 16:49:32,038 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 153.5%
2022-04-23 16:50:01,716 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 2.986, Acc: 0.891, Base Lr: 4.51e-04
2022-04-23 16:50:16,062 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.290[s] Speed: 55.3[samples/s]
2022-04-23 16:51:18,579 reid_baseline.train INFO: normal accuracy 0.8205187055313289 1.6129721403121948 
2022-04-23 16:51:18,580 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-23 16:51:18,580 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 161.3%
2022-04-23 16:51:51,466 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.003, Acc: 0.891, Base Lr: 2.11e-04
2022-04-23 16:52:08,021 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-23 16:53:09,272 reid_baseline.train INFO: normal accuracy 0.8223548313059444 1.5839365720748901 
2022-04-23 16:53:09,272 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-23 16:53:09,272 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 158.4%
2022-04-23 16:53:39,340 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 2.984, Acc: 0.885, Base Lr: 6.51e-05
2022-04-23 16:53:53,994 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.294[s] Speed: 54.4[samples/s]
2022-04-23 16:54:58,294 reid_baseline.train INFO: normal accuracy 0.8232728941932522 1.6018753051757812 
2022-04-23 16:54:58,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-23 16:54:58,295 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 160.2%
2022-04-23 16:55:28,332 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.004, Acc: 0.885, Base Lr: 1.60e-05
2022-04-23 16:55:42,197 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.289[s] Speed: 55.4[samples/s]
2022-04-23 16:57:30,924 reid_baseline.train INFO: normal accuracy 0.8221253155841175 1.6053463220596313 
2022-04-23 16:57:30,925 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-23 16:57:30,925 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 160.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_layer_12/transformer_best_model.pth
2022-04-23 16:59:21,737 reid_baseline.train INFO: normal accuracy 0.8228138627495983 1.5347226858139038 
2022-04-23 16:59:21,749 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 16:59:21,750 reid_baseline.train INFO: Accuracy: 82.3%
2022-04-23 17:00:23,985 reid_baseline.train INFO: normal accuracy 0.8228138627495983 1.5347226858139038 
2022-04-23 17:00:23,986 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 17:00:23,986 reid_baseline.train INFO: Shuffled Accuracy: 82.3%
2022-04-23 17:00:44,970 reid_baseline.train INFO: normal accuracy 0.9489081170168933 1.0295335054397583 
2022-04-23 17:00:44,970 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-23 17:00:44,971 reid_baseline.train INFO: Source Clean Accuracy: 94.9%
