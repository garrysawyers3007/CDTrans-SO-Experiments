2022-04-19 04:08:55,010 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_1
2022-04-19 04:08:55,010 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-19 04:08:55,010 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 04:08:55,010 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 04:08:55,011 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 04:09:11,765 reid_baseline.train INFO: start training
2022-04-19 04:10:23,664 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.272, Acc: 0.247, Base Lr: 8.72e-04
2022-04-19 04:11:11,471 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.182, Acc: 0.374, Base Lr: 8.72e-04
2022-04-19 04:11:45,247 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.548[s] Speed: 29.2[samples/s]
2022-04-19 04:12:33,970 reid_baseline.train INFO: normal accuracy 0.5717503942329354 4.165098667144775 
2022-04-19 04:12:35,920 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 04:12:35,921 reid_baseline.train INFO: Accuracy: 57.2% Mean Entropy: 416.5%
2022-04-19 04:13:42,857 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.792, Acc: 0.552, Base Lr: 1.66e-03
2022-04-19 04:14:41,040 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.617, Acc: 0.557, Base Lr: 1.66e-03
2022-04-19 04:15:15,951 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.586[s] Speed: 27.3[samples/s]
2022-04-19 04:16:08,186 reid_baseline.train INFO: normal accuracy 0.5945032665014643 3.984976291656494 
2022-04-19 04:16:09,286 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 04:16:09,287 reid_baseline.train INFO: Accuracy: 59.5% Mean Entropy: 398.5%
2022-04-19 04:17:12,856 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.830, Acc: 0.606, Base Lr: 2.46e-03
2022-04-19 04:18:15,665 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.689, Acc: 0.616, Base Lr: 2.46e-03
2022-04-19 04:18:50,832 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.591[s] Speed: 27.1[samples/s]
2022-04-19 04:19:38,971 reid_baseline.train INFO: normal accuracy 0.644514530299617 3.2489192485809326 
2022-04-19 04:19:39,880 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 04:19:39,880 reid_baseline.train INFO: Accuracy: 64.5% Mean Entropy: 324.9%
2022-04-19 04:20:30,834 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.163, Acc: 0.694, Base Lr: 3.25e-03
2022-04-19 04:21:23,647 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.111, Acc: 0.702, Base Lr: 3.25e-03
2022-04-19 04:22:06,435 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.537[s] Speed: 29.8[samples/s]
2022-04-19 04:23:02,858 reid_baseline.train INFO: normal accuracy 0.6956521739130435 2.600464344024658 
2022-04-19 04:23:04,219 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 04:23:04,219 reid_baseline.train INFO: Accuracy: 69.6% Mean Entropy: 260.0%
2022-04-19 04:23:53,952 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.839, Acc: 0.757, Base Lr: 4.04e-03
2022-04-19 04:24:51,787 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.809, Acc: 0.765, Base Lr: 4.04e-03
2022-04-19 04:25:34,223 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.549[s] Speed: 29.1[samples/s]
2022-04-19 04:26:28,818 reid_baseline.train INFO: normal accuracy 0.7337238116692949 2.276953935623169 
2022-04-19 04:26:29,781 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 04:26:29,781 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 227.7%
2022-04-19 04:27:22,237 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.668, Acc: 0.796, Base Lr: 4.83e-03
2022-04-19 04:28:04,823 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.636, Acc: 0.807, Base Lr: 4.83e-03
2022-04-19 04:28:38,001 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.470[s] Speed: 34.1[samples/s]
2022-04-19 04:29:34,784 reid_baseline.train INFO: normal accuracy 0.7393557107456634 2.0818967819213867 
2022-04-19 04:29:36,221 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 04:29:36,221 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 208.2%
2022-04-19 04:30:35,844 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.553, Acc: 0.823, Base Lr: 5.62e-03
2022-04-19 04:31:37,311 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.564, Acc: 0.825, Base Lr: 5.62e-03
2022-04-19 04:32:09,448 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.561[s] Speed: 28.5[samples/s]
2022-04-19 04:33:01,956 reid_baseline.train INFO: normal accuracy 0.7404820905609372 1.967042088508606 
2022-04-19 04:33:03,049 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 04:33:03,049 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 196.7%
2022-04-19 04:34:10,588 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.466, Acc: 0.854, Base Lr: 6.42e-03
2022-04-19 04:35:08,790 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.452, Acc: 0.855, Base Lr: 6.42e-03
2022-04-19 04:35:41,002 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.579[s] Speed: 27.7[samples/s]
2022-04-19 04:36:30,273 reid_baseline.train INFO: normal accuracy 0.7560261320117143 1.862228274345398 
2022-04-19 04:36:31,388 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 04:36:31,388 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 186.2%
2022-04-19 04:37:18,160 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.450, Acc: 0.858, Base Lr: 7.21e-03
2022-04-19 04:38:15,935 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.423, Acc: 0.868, Base Lr: 7.21e-03
2022-04-19 04:39:00,097 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.545[s] Speed: 29.4[samples/s]
2022-04-19 04:39:52,748 reid_baseline.train INFO: normal accuracy 0.7546744762333859 1.7807537317276 
2022-04-19 04:39:53,724 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 04:39:53,724 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 178.1%
2022-04-19 04:40:44,088 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.302, Acc: 0.894, Base Lr: 4.01e-03
2022-04-19 04:41:37,929 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.321, Acc: 0.887, Base Lr: 4.01e-03
2022-04-19 04:42:21,590 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.541[s] Speed: 29.6[samples/s]
2022-04-19 04:43:20,719 reid_baseline.train INFO: normal accuracy 0.7632349628294661 1.7475732564926147 
2022-04-19 04:43:21,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 04:43:21,594 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 174.8%
2022-04-19 04:44:12,925 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.269, Acc: 0.912, Base Lr: 3.38e-03
2022-04-19 04:44:55,870 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.316, Acc: 0.910, Base Lr: 3.38e-03
2022-04-19 04:45:29,583 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.469[s] Speed: 34.1[samples/s]
2022-04-19 04:46:19,560 reid_baseline.train INFO: normal accuracy 0.7733723811669295 1.735485315322876 
2022-04-19 04:46:22,364 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 04:46:22,365 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 173.5%
2022-04-19 04:47:24,159 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.292, Acc: 0.910, Base Lr: 2.77e-03
2022-04-19 04:48:27,827 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.323, Acc: 0.906, Base Lr: 2.77e-03
2022-04-19 04:49:01,667 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.584[s] Speed: 27.4[samples/s]
2022-04-19 04:49:57,533 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.6993342638015747 
2022-04-19 04:49:58,531 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 04:49:58,531 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 169.9%
2022-04-19 04:50:58,656 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.264, Acc: 0.916, Base Lr: 2.20e-03
2022-04-19 04:51:54,189 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.225, Acc: 0.921, Base Lr: 2.20e-03
2022-04-19 04:52:32,288 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.563[s] Speed: 28.4[samples/s]
2022-04-19 04:53:21,154 reid_baseline.train INFO: normal accuracy 0.771119621536382 1.6893794536590576 
2022-04-19 04:53:22,524 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 04:53:22,524 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 168.9%
2022-04-19 04:54:10,945 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.251, Acc: 0.920, Base Lr: 1.66e-03
2022-04-19 04:54:58,926 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.232, Acc: 0.926, Base Lr: 1.66e-03
2022-04-19 04:55:39,176 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.501[s] Speed: 32.0[samples/s]
2022-04-19 04:56:30,744 reid_baseline.train INFO: normal accuracy 0.7735976571299842 1.736934781074524 
2022-04-19 04:56:30,749 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 04:56:30,749 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 173.7%
2022-04-19 04:57:22,159 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.226, Acc: 0.927, Base Lr: 1.19e-03
2022-04-19 04:58:15,037 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.253, Acc: 0.925, Base Lr: 1.19e-03
2022-04-19 04:58:57,142 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.536[s] Speed: 29.8[samples/s]
2022-04-19 04:59:58,630 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.6946113109588623 
2022-04-19 04:59:58,633 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 04:59:58,633 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 169.5%
2022-04-19 05:00:47,473 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.245, Acc: 0.921, Base Lr: 7.78e-04
2022-04-19 05:01:34,148 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.240, Acc: 0.928, Base Lr: 7.78e-04
2022-04-19 05:02:06,965 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.470[s] Speed: 34.0[samples/s]
2022-04-19 05:02:56,353 reid_baseline.train INFO: normal accuracy 0.7801306600585718 1.745293378829956 
2022-04-19 05:02:56,356 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 05:02:56,356 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 174.5%
2022-04-19 05:04:00,067 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.241, Acc: 0.928, Base Lr: 4.51e-04
2022-04-19 05:04:58,099 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.243, Acc: 0.929, Base Lr: 4.51e-04
2022-04-19 05:05:31,769 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.569[s] Speed: 28.1[samples/s]
2022-04-19 05:06:25,477 reid_baseline.train INFO: normal accuracy 0.7785537283171886 1.712744116783142 
2022-04-19 05:06:25,478 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 05:06:25,479 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 171.3%
2022-04-19 05:07:29,408 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.242, Acc: 0.930, Base Lr: 2.11e-04
2022-04-19 05:08:28,907 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.226, Acc: 0.930, Base Lr: 2.11e-04
2022-04-19 05:09:02,122 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.574[s] Speed: 27.9[samples/s]
2022-04-19 05:09:51,052 reid_baseline.train INFO: normal accuracy 0.7776526244649696 1.7479196786880493 
2022-04-19 05:09:51,053 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 05:09:51,053 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 174.8%
2022-04-19 05:10:40,458 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.236, Acc: 0.929, Base Lr: 6.51e-05
2022-04-19 05:11:29,746 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.218, Acc: 0.930, Base Lr: 6.51e-05
2022-04-19 05:12:12,082 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.516[s] Speed: 31.0[samples/s]
2022-04-19 05:13:08,280 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.6917399168014526 
2022-04-19 05:13:08,285 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 05:13:08,285 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 169.2%
2022-04-19 05:14:01,327 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.276, Acc: 0.930, Base Lr: 1.60e-05
2022-04-19 05:14:53,645 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.255, Acc: 0.929, Base Lr: 1.60e-05
2022-04-19 05:15:35,543 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.539[s] Speed: 29.7[samples/s]
2022-04-19 05:16:30,418 reid_baseline.train INFO: normal accuracy 0.7763009686866411 1.7220693826675415 
2022-04-19 05:16:30,419 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 05:16:30,419 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 172.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_1/transformer_best_model.pth
2022-04-19 05:17:28,505 reid_baseline.train INFO: normal accuracy 0.771119621536382 1.6893794536590576 
2022-04-19 05:17:28,505 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:17:28,505 reid_baseline.train INFO: Accuracy: 77.1%
2022-04-19 05:18:16,185 reid_baseline.train INFO: normal accuracy 0.771119621536382 1.6893794536590576 
2022-04-19 05:18:16,185 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:18:16,185 reid_baseline.train INFO: Shuffled Accuracy: 77.1%
2022-04-19 05:19:08,188 reid_baseline.train INFO: normal accuracy 0.952119129438717 0.8060944676399231 
2022-04-19 05:19:08,189 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:19:08,189 reid_baseline.train INFO: Source Clean Accuracy: 95.2%
2022-04-19 05:19:14,751 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_2
2022-04-19 05:19:14,751 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-19 05:19:14,752 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 05:19:14,752 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 05:19:14,752 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 05:19:26,471 reid_baseline.train INFO: start training
2022-04-19 05:20:33,594 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.278, Acc: 0.258, Base Lr: 8.72e-04
2022-04-19 05:21:37,237 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.182, Acc: 0.377, Base Lr: 8.72e-04
2022-04-19 05:22:12,555 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.604[s] Speed: 26.5[samples/s]
2022-04-19 05:23:05,460 reid_baseline.train INFO: normal accuracy 0.5656679432304573 4.164944171905518 
2022-04-19 05:23:06,473 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 05:23:06,474 reid_baseline.train INFO: Accuracy: 56.6% Mean Entropy: 416.5%
2022-04-19 05:24:03,663 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.802, Acc: 0.545, Base Lr: 1.66e-03
2022-04-19 05:24:58,225 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.626, Acc: 0.553, Base Lr: 1.66e-03
2022-04-19 05:25:35,675 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.547[s] Speed: 29.3[samples/s]
2022-04-19 05:26:29,003 reid_baseline.train INFO: normal accuracy 0.5906735751295337 3.9876291751861572 
2022-04-19 05:26:29,944 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 05:26:29,944 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 398.8%
2022-04-19 05:27:24,705 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.840, Acc: 0.601, Base Lr: 2.46e-03
2022-04-19 05:28:21,464 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.687, Acc: 0.611, Base Lr: 2.46e-03
2022-04-19 05:28:57,737 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.541[s] Speed: 29.6[samples/s]
2022-04-19 05:29:47,119 reid_baseline.train INFO: normal accuracy 0.6433881504843433 3.240629196166992 
2022-04-19 05:29:48,447 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 05:29:48,447 reid_baseline.train INFO: Accuracy: 64.3% Mean Entropy: 324.1%
2022-04-19 05:30:39,933 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.180, Acc: 0.687, Base Lr: 3.25e-03
2022-04-19 05:31:24,815 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.107, Acc: 0.695, Base Lr: 3.25e-03
2022-04-19 05:31:54,549 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.462[s] Speed: 34.6[samples/s]
2022-04-19 05:32:50,349 reid_baseline.train INFO: normal accuracy 0.7039873845460689 2.6433281898498535 
2022-04-19 05:32:52,982 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 05:32:52,982 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 264.3%
2022-04-19 05:33:48,480 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.794, Acc: 0.755, Base Lr: 4.04e-03
2022-04-19 05:34:45,382 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.778, Acc: 0.757, Base Lr: 4.04e-03
2022-04-19 05:35:21,464 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.544[s] Speed: 29.4[samples/s]
2022-04-19 05:36:11,672 reid_baseline.train INFO: normal accuracy 0.731921603964857 2.2846155166625977 
2022-04-19 05:36:13,003 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 05:36:13,003 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 228.5%
2022-04-19 05:37:11,278 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.710, Acc: 0.788, Base Lr: 4.83e-03
2022-04-19 05:38:00,279 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.647, Acc: 0.800, Base Lr: 4.83e-03
2022-04-19 05:38:33,651 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.515[s] Speed: 31.1[samples/s]
2022-04-19 05:39:29,718 reid_baseline.train INFO: normal accuracy 0.7420590223023203 2.072787284851074 
2022-04-19 05:39:31,334 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 05:39:31,334 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 207.3%
2022-04-19 05:40:20,834 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.583, Acc: 0.808, Base Lr: 5.62e-03
2022-04-19 05:41:11,256 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.549, Acc: 0.822, Base Lr: 5.62e-03
2022-04-19 05:41:49,650 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.507[s] Speed: 31.6[samples/s]
2022-04-19 05:42:33,440 reid_baseline.train INFO: normal accuracy 0.7443117819328677 1.8994547128677368 
2022-04-19 05:42:34,434 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 05:42:34,435 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 189.9%
2022-04-19 05:43:27,367 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.444, Acc: 0.858, Base Lr: 6.42e-03
2022-04-19 05:44:21,316 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.452, Acc: 0.862, Base Lr: 6.42e-03
2022-04-19 05:45:00,897 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.536[s] Speed: 29.9[samples/s]
2022-04-19 05:45:52,757 reid_baseline.train INFO: normal accuracy 0.7494931290831268 1.8087390661239624 
2022-04-19 05:45:53,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 05:45:53,858 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 180.9%
2022-04-19 05:46:43,923 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.453, Acc: 0.872, Base Lr: 7.21e-03
2022-04-19 05:47:27,173 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.413, Acc: 0.869, Base Lr: 7.21e-03
2022-04-19 05:48:05,515 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.482[s] Speed: 33.2[samples/s]
2022-04-19 05:48:59,007 reid_baseline.train INFO: normal accuracy 0.758954719531426 1.7967784404754639 
2022-04-19 05:49:00,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 05:49:00,173 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 179.7%
2022-04-19 05:49:59,284 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.282, Acc: 0.893, Base Lr: 4.01e-03
2022-04-19 05:50:49,584 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.273, Acc: 0.900, Base Lr: 4.01e-03
2022-04-19 05:51:32,087 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.556[s] Speed: 28.8[samples/s]
2022-04-19 05:52:23,442 reid_baseline.train INFO: normal accuracy 0.765938274386123 1.8018536567687988 
2022-04-19 05:52:23,443 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 05:52:23,443 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 180.2%
2022-04-19 05:53:13,902 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.330, Acc: 0.900, Base Lr: 3.38e-03
2022-04-19 05:53:58,470 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.327, Acc: 0.904, Base Lr: 3.38e-03
2022-04-19 05:54:37,025 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.489[s] Speed: 32.7[samples/s]
2022-04-19 05:55:28,997 reid_baseline.train INFO: normal accuracy 0.7677404820905609 1.7923074960708618 
2022-04-19 05:55:30,430 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 05:55:30,431 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 179.2%
2022-04-19 05:56:31,186 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.318, Acc: 0.905, Base Lr: 2.77e-03
2022-04-19 05:57:21,457 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.278, Acc: 0.912, Base Lr: 2.77e-03
2022-04-19 05:58:02,054 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.555[s] Speed: 28.8[samples/s]
2022-04-19 05:58:57,418 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.6891124248504639 
2022-04-19 05:58:58,489 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 05:58:58,489 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 168.9%
2022-04-19 05:59:49,169 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.245, Acc: 0.920, Base Lr: 2.20e-03
2022-04-19 06:00:32,904 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.255, Acc: 0.914, Base Lr: 2.20e-03
2022-04-19 06:01:01,646 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.451[s] Speed: 35.5[samples/s]
2022-04-19 06:01:52,164 reid_baseline.train INFO: normal accuracy 0.7735976571299842 1.734769582748413 
2022-04-19 06:01:52,165 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 06:01:52,165 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 173.5%
2022-04-19 06:02:52,178 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.301, Acc: 0.926, Base Lr: 1.66e-03
2022-04-19 06:03:43,164 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.274, Acc: 0.920, Base Lr: 1.66e-03
2022-04-19 06:04:18,095 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.535[s] Speed: 29.9[samples/s]
2022-04-19 06:05:17,008 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.7762465476989746 
2022-04-19 06:05:17,011 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 06:05:17,011 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 177.6%
2022-04-19 06:06:12,576 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.228, Acc: 0.926, Base Lr: 1.19e-03
2022-04-19 06:06:57,927 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.221, Acc: 0.925, Base Lr: 1.19e-03
2022-04-19 06:07:30,330 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.488[s] Speed: 32.8[samples/s]
2022-04-19 06:08:23,041 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.6868617534637451 
2022-04-19 06:08:24,307 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 06:08:24,307 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 168.7%
2022-04-19 06:09:22,878 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.285, Acc: 0.937, Base Lr: 7.78e-04
2022-04-19 06:10:19,313 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.286, Acc: 0.926, Base Lr: 7.78e-04
2022-04-19 06:10:55,533 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.553[s] Speed: 28.9[samples/s]
2022-04-19 06:11:48,850 reid_baseline.train INFO: normal accuracy 0.7742734850191485 1.7619450092315674 
2022-04-19 06:11:48,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 06:11:48,853 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 176.2%
2022-04-19 06:12:47,056 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.237, Acc: 0.924, Base Lr: 4.51e-04
2022-04-19 06:13:33,593 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.259, Acc: 0.926, Base Lr: 4.51e-04
2022-04-19 06:14:07,334 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.507[s] Speed: 31.5[samples/s]
2022-04-19 06:15:03,608 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7455103397369385 
2022-04-19 06:15:03,608 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 06:15:03,608 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 174.6%
2022-04-19 06:15:49,288 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.242, Acc: 0.934, Base Lr: 2.11e-04
2022-04-19 06:16:40,742 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.248, Acc: 0.930, Base Lr: 2.11e-04
2022-04-19 06:17:17,480 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.490[s] Speed: 32.6[samples/s]
2022-04-19 06:18:08,235 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.7647169828414917 
2022-04-19 06:18:08,237 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 06:18:08,237 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 176.5%
2022-04-19 06:19:04,180 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.266, Acc: 0.922, Base Lr: 6.51e-05
2022-04-19 06:19:54,624 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.247, Acc: 0.925, Base Lr: 6.51e-05
2022-04-19 06:20:34,546 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.536[s] Speed: 29.9[samples/s]
2022-04-19 06:21:28,700 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.7694275379180908 
2022-04-19 06:21:28,705 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 06:21:28,705 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 176.9%
2022-04-19 06:22:18,805 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.253, Acc: 0.915, Base Lr: 1.60e-05
2022-04-19 06:23:05,963 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.242, Acc: 0.923, Base Lr: 1.60e-05
2022-04-19 06:23:37,079 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.470[s] Speed: 34.0[samples/s]
2022-04-19 06:24:30,695 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.713263988494873 
2022-04-19 06:24:30,696 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 06:24:30,696 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 171.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_2/transformer_best_model.pth
2022-04-19 06:25:25,108 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.6868617534637451 
2022-04-19 06:25:25,108 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:25:25,108 reid_baseline.train INFO: Accuracy: 77.5%
2022-04-19 06:26:14,841 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.6868617534637451 
2022-04-19 06:26:14,841 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:26:14,841 reid_baseline.train INFO: Shuffled Accuracy: 77.5%
2022-04-19 06:27:08,535 reid_baseline.train INFO: normal accuracy 0.9550973654066438 0.7809789180755615 
2022-04-19 06:27:08,535 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:27:08,535 reid_baseline.train INFO: Source Clean Accuracy: 95.5%
2022-04-19 06:27:14,820 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_3
2022-04-19 06:27:14,820 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-19 06:27:14,820 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 06:27:14,820 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 06:27:14,821 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 06:27:30,109 reid_baseline.train INFO: start training
2022-04-19 06:28:50,278 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.274, Acc: 0.255, Base Lr: 8.72e-04
2022-04-19 06:29:40,249 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.181, Acc: 0.376, Base Lr: 8.72e-04
2022-04-19 06:30:12,921 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.579[s] Speed: 27.6[samples/s]
2022-04-19 06:31:02,692 reid_baseline.train INFO: normal accuracy 0.5638657355260194 4.164921283721924 
2022-04-19 06:31:03,861 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 06:31:03,861 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 416.5%
2022-04-19 06:31:47,712 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.762, Acc: 0.558, Base Lr: 1.66e-03
2022-04-19 06:32:32,338 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.596, Acc: 0.555, Base Lr: 1.66e-03
2022-04-19 06:33:03,888 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.440[s] Speed: 36.4[samples/s]
2022-04-19 06:33:58,811 reid_baseline.train INFO: normal accuracy 0.5958549222797928 3.993804454803467 
2022-04-19 06:34:00,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 06:34:00,194 reid_baseline.train INFO: Accuracy: 59.6% Mean Entropy: 399.4%
2022-04-19 06:34:50,085 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.888, Acc: 0.609, Base Lr: 2.46e-03
2022-04-19 06:35:38,524 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.703, Acc: 0.613, Base Lr: 2.46e-03
2022-04-19 06:36:19,871 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.512[s] Speed: 31.3[samples/s]
2022-04-19 06:37:07,718 reid_baseline.train INFO: normal accuracy 0.6492453255237666 3.268955707550049 
2022-04-19 06:37:08,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 06:37:08,859 reid_baseline.train INFO: Accuracy: 64.9% Mean Entropy: 326.9%
2022-04-19 06:38:02,880 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.221, Acc: 0.671, Base Lr: 3.25e-03
2022-04-19 06:38:56,766 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.142, Acc: 0.687, Base Lr: 3.25e-03
2022-04-19 06:39:34,304 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.533[s] Speed: 30.0[samples/s]
2022-04-19 06:40:27,397 reid_baseline.train INFO: normal accuracy 0.7057895922505069 2.6594438552856445 
2022-04-19 06:40:28,841 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 06:40:28,841 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 265.9%
2022-04-19 06:41:20,018 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.921, Acc: 0.752, Base Lr: 4.04e-03
2022-04-19 06:42:02,003 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.832, Acc: 0.761, Base Lr: 4.04e-03
2022-04-19 06:42:35,475 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.464[s] Speed: 34.5[samples/s]
2022-04-19 06:43:28,824 reid_baseline.train INFO: normal accuracy 0.7271908087407074 2.2334892749786377 
2022-04-19 06:43:30,062 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 06:43:30,062 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 223.3%
2022-04-19 06:44:15,710 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.727, Acc: 0.779, Base Lr: 4.83e-03
2022-04-19 06:45:02,818 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.695, Acc: 0.801, Base Lr: 4.83e-03
2022-04-19 06:45:36,431 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.463[s] Speed: 34.6[samples/s]
2022-04-19 06:46:31,196 reid_baseline.train INFO: normal accuracy 0.7375535030412255 1.9722529649734497 
2022-04-19 06:46:32,534 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 06:46:32,534 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 197.2%
2022-04-19 06:47:15,586 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.600, Acc: 0.826, Base Lr: 5.62e-03
2022-04-19 06:48:00,696 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.586, Acc: 0.819, Base Lr: 5.62e-03
2022-04-19 06:48:33,134 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.441[s] Speed: 36.3[samples/s]
2022-04-19 06:49:21,298 reid_baseline.train INFO: normal accuracy 0.7544492002703311 1.8522518873214722 
2022-04-19 06:49:23,568 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 06:49:23,568 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 185.2%
2022-04-19 06:50:13,451 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.528, Acc: 0.849, Base Lr: 6.42e-03
2022-04-19 06:51:07,298 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.517, Acc: 0.850, Base Lr: 6.42e-03
2022-04-19 06:51:42,915 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.510[s] Speed: 31.3[samples/s]
2022-04-19 06:52:28,952 reid_baseline.train INFO: normal accuracy 0.7503942329353458 1.8273826837539673 
2022-04-19 06:52:29,952 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 06:52:29,953 reid_baseline.train INFO: Accuracy: 75.0% Mean Entropy: 182.7%
2022-04-19 06:53:24,393 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.408, Acc: 0.886, Base Lr: 7.21e-03
2022-04-19 06:54:11,103 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.389, Acc: 0.881, Base Lr: 7.21e-03
2022-04-19 06:54:48,349 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.507[s] Speed: 31.6[samples/s]
2022-04-19 06:55:38,216 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.7398000955581665 
2022-04-19 06:55:39,324 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 06:55:39,324 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 174.0%
2022-04-19 06:56:23,930 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.381, Acc: 0.883, Base Lr: 4.01e-03
2022-04-19 06:57:18,458 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.385, Acc: 0.889, Base Lr: 4.01e-03
2022-04-19 06:57:57,083 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.504[s] Speed: 31.7[samples/s]
2022-04-19 06:58:51,470 reid_baseline.train INFO: normal accuracy 0.7670646542013967 1.6920382976531982 
2022-04-19 06:58:53,804 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 06:58:53,804 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 169.2%
2022-04-19 06:59:49,180 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.338, Acc: 0.898, Base Lr: 3.38e-03
2022-04-19 07:00:43,646 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.324, Acc: 0.902, Base Lr: 3.38e-03
2022-04-19 07:01:23,467 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.548[s] Speed: 29.2[samples/s]
2022-04-19 07:02:13,443 reid_baseline.train INFO: normal accuracy 0.7648118945708493 1.7859798669815063 
2022-04-19 07:02:13,443 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 07:02:13,444 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 178.6%
2022-04-19 07:02:57,878 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.295, Acc: 0.901, Base Lr: 2.77e-03
2022-04-19 07:03:42,479 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.284, Acc: 0.904, Base Lr: 2.77e-03
2022-04-19 07:04:14,544 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.444[s] Speed: 36.1[samples/s]
2022-04-19 07:05:08,281 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.774576187133789 
2022-04-19 07:05:08,282 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 07:05:08,282 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 177.5%
2022-04-19 07:06:01,874 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.327, Acc: 0.907, Base Lr: 2.20e-03
2022-04-19 07:06:53,121 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.286, Acc: 0.911, Base Lr: 2.20e-03
2022-04-19 07:07:28,188 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.512[s] Speed: 31.2[samples/s]
2022-04-19 07:08:21,201 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.732427954673767 
2022-04-19 07:08:21,203 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 07:08:21,203 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 173.2%
2022-04-19 07:09:10,064 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.177, Acc: 0.926, Base Lr: 1.66e-03
2022-04-19 07:10:06,029 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.237, Acc: 0.919, Base Lr: 1.66e-03
2022-04-19 07:10:41,132 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.512[s] Speed: 31.2[samples/s]
2022-04-19 07:11:30,019 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.7987360954284668 
2022-04-19 07:11:30,020 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 07:11:30,020 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 179.9%
2022-04-19 07:12:18,240 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.284, Acc: 0.924, Base Lr: 1.19e-03
2022-04-19 07:13:03,290 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.268, Acc: 0.929, Base Lr: 1.19e-03
2022-04-19 07:13:34,985 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.457[s] Speed: 35.0[samples/s]
2022-04-19 07:14:36,799 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.7434951066970825 
2022-04-19 07:14:36,804 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 07:14:36,804 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 174.3%
2022-04-19 07:15:25,099 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.267, Acc: 0.920, Base Lr: 7.78e-04
2022-04-19 07:16:12,194 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.234, Acc: 0.925, Base Lr: 7.78e-04
2022-04-19 07:16:42,793 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.461[s] Speed: 34.7[samples/s]
2022-04-19 07:17:35,641 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.69051992893219 
2022-04-19 07:17:36,950 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 07:17:36,951 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 169.1%
2022-04-19 07:18:25,076 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.302, Acc: 0.920, Base Lr: 4.51e-04
2022-04-19 07:19:17,355 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.286, Acc: 0.920, Base Lr: 4.51e-04
2022-04-19 07:19:55,820 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.509[s] Speed: 31.5[samples/s]
2022-04-19 07:20:44,237 reid_baseline.train INFO: normal accuracy 0.7756251407974769 1.7760015726089478 
2022-04-19 07:20:44,239 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 07:20:44,239 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 177.6%
2022-04-19 07:21:40,161 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.234, Acc: 0.920, Base Lr: 2.11e-04
2022-04-19 07:22:29,925 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.249, Acc: 0.924, Base Lr: 2.11e-04
2022-04-19 07:23:05,996 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.519[s] Speed: 30.8[samples/s]
2022-04-19 07:24:01,902 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.7361383438110352 
2022-04-19 07:24:01,906 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 07:24:01,907 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 173.6%
2022-04-19 07:24:50,325 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.256, Acc: 0.916, Base Lr: 6.51e-05
2022-04-19 07:25:43,783 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.275, Acc: 0.920, Base Lr: 6.51e-05
2022-04-19 07:26:25,090 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.524[s] Speed: 30.5[samples/s]
2022-04-19 07:27:17,457 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.713212490081787 
2022-04-19 07:27:17,461 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 07:27:17,461 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 171.3%
2022-04-19 07:28:15,167 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.277, Acc: 0.930, Base Lr: 1.60e-05
2022-04-19 07:29:08,122 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.257, Acc: 0.934, Base Lr: 1.60e-05
2022-04-19 07:29:48,762 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.554[s] Speed: 28.9[samples/s]
2022-04-19 07:30:42,835 reid_baseline.train INFO: normal accuracy 0.7740482090560937 1.7382928133010864 
2022-04-19 07:30:42,836 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 07:30:42,836 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 173.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_3/transformer_best_model.pth
2022-04-19 07:31:37,137 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.69051992893219 
2022-04-19 07:31:37,138 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:31:37,138 reid_baseline.train INFO: Accuracy: 77.3%
2022-04-19 07:32:22,199 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.69051992893219 
2022-04-19 07:32:22,200 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:32:22,200 reid_baseline.train INFO: Shuffled Accuracy: 77.3%
2022-04-19 07:33:14,020 reid_baseline.train INFO: normal accuracy 0.9583046964490264 0.7919402122497559 
2022-04-19 07:33:14,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:33:14,021 reid_baseline.train INFO: Source Clean Accuracy: 95.8%
2022-04-19 07:33:19,476 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_4
2022-04-19 07:33:19,476 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-19 07:33:19,476 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 07:33:19,476 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 07:33:19,477 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 07:33:34,781 reid_baseline.train INFO: start training
2022-04-19 07:34:51,490 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.267, Acc: 0.248, Base Lr: 8.72e-04
2022-04-19 07:35:43,555 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.173, Acc: 0.373, Base Lr: 8.72e-04
2022-04-19 07:36:20,113 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.593[s] Speed: 27.0[samples/s]
2022-04-19 07:37:14,633 reid_baseline.train INFO: normal accuracy 0.5674701509348953 4.164984703063965 
2022-04-19 07:37:15,600 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 07:37:15,600 reid_baseline.train INFO: Accuracy: 56.7% Mean Entropy: 416.5%
2022-04-19 07:38:09,355 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.786, Acc: 0.576, Base Lr: 1.66e-03
2022-04-19 07:39:00,857 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.611, Acc: 0.568, Base Lr: 1.66e-03
2022-04-19 07:39:33,277 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.504[s] Speed: 31.7[samples/s]
2022-04-19 07:40:26,502 reid_baseline.train INFO: normal accuracy 0.5854922279792746 3.975163698196411 
2022-04-19 07:40:27,457 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 07:40:27,458 reid_baseline.train INFO: Accuracy: 58.5% Mean Entropy: 397.5%
2022-04-19 07:41:25,907 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.795, Acc: 0.603, Base Lr: 2.46e-03
2022-04-19 07:42:15,854 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.634, Acc: 0.616, Base Lr: 2.46e-03
2022-04-19 07:42:52,490 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.531[s] Speed: 30.1[samples/s]
2022-04-19 07:43:52,201 reid_baseline.train INFO: normal accuracy 0.6429375985582338 3.2125139236450195 
2022-04-19 07:43:53,202 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 07:43:53,202 reid_baseline.train INFO: Accuracy: 64.3% Mean Entropy: 321.3%
2022-04-19 07:44:46,685 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.156, Acc: 0.698, Base Lr: 3.25e-03
2022-04-19 07:45:37,237 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.114, Acc: 0.695, Base Lr: 3.25e-03
2022-04-19 07:46:09,908 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.500[s] Speed: 32.0[samples/s]
2022-04-19 07:47:03,128 reid_baseline.train INFO: normal accuracy 0.6990313133588646 2.605056047439575 
2022-04-19 07:47:04,081 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 07:47:04,082 reid_baseline.train INFO: Accuracy: 69.9% Mean Entropy: 260.5%
2022-04-19 07:48:03,195 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.850, Acc: 0.754, Base Lr: 4.04e-03
2022-04-19 07:48:54,253 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.816, Acc: 0.756, Base Lr: 4.04e-03
2022-04-19 07:49:33,730 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.548[s] Speed: 29.2[samples/s]
2022-04-19 07:50:34,333 reid_baseline.train INFO: normal accuracy 0.7265149808515431 2.188063144683838 
2022-04-19 07:50:35,736 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 07:50:35,736 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 218.8%
2022-04-19 07:51:26,684 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.626, Acc: 0.804, Base Lr: 4.83e-03
2022-04-19 07:52:17,972 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.627, Acc: 0.805, Base Lr: 4.83e-03
2022-04-19 07:52:59,840 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.528[s] Speed: 30.3[samples/s]
2022-04-19 07:53:53,166 reid_baseline.train INFO: normal accuracy 0.7436359540437035 2.058410167694092 
2022-04-19 07:53:54,226 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 07:53:54,226 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 205.8%
2022-04-19 07:54:52,242 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.573, Acc: 0.838, Base Lr: 5.62e-03
2022-04-19 07:55:43,898 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.560, Acc: 0.838, Base Lr: 5.62e-03
2022-04-19 07:56:22,785 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.544[s] Speed: 29.4[samples/s]
2022-04-19 07:57:19,857 reid_baseline.train INFO: normal accuracy 0.7411579184501014 1.9108296632766724 
2022-04-19 07:57:20,982 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 07:57:20,982 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 191.1%
2022-04-19 07:58:14,798 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.490, Acc: 0.865, Base Lr: 6.42e-03
2022-04-19 07:59:11,183 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.476, Acc: 0.859, Base Lr: 6.42e-03
2022-04-19 07:59:53,027 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.557[s] Speed: 28.7[samples/s]
2022-04-19 08:00:50,741 reid_baseline.train INFO: normal accuracy 0.752872268528948 1.8556077480316162 
2022-04-19 08:00:53,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 08:00:53,277 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 185.6%
2022-04-19 08:01:50,490 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.451, Acc: 0.858, Base Lr: 7.21e-03
2022-04-19 08:02:33,205 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.422, Acc: 0.865, Base Lr: 7.21e-03
2022-04-19 08:03:03,384 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.477[s] Speed: 33.6[samples/s]
2022-04-19 08:03:56,650 reid_baseline.train INFO: normal accuracy 0.7564766839378239 1.798644781112671 
2022-04-19 08:03:59,310 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 08:03:59,310 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 179.9%
2022-04-19 08:04:58,784 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.374, Acc: 0.892, Base Lr: 4.01e-03
2022-04-19 08:05:50,197 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.369, Acc: 0.892, Base Lr: 4.01e-03
2022-04-19 08:06:31,961 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.559[s] Speed: 28.6[samples/s]
2022-04-19 08:07:31,171 reid_baseline.train INFO: normal accuracy 0.7661635503491777 1.7904136180877686 
2022-04-19 08:07:32,089 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 08:07:32,089 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 179.0%
2022-04-19 08:08:24,493 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.343, Acc: 0.896, Base Lr: 3.38e-03
2022-04-19 08:09:15,533 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.327, Acc: 0.894, Base Lr: 3.38e-03
2022-04-19 08:09:53,723 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.519[s] Speed: 30.8[samples/s]
2022-04-19 08:10:46,921 reid_baseline.train INFO: normal accuracy 0.7693174138319442 1.7015283107757568 
2022-04-19 08:10:48,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 08:10:48,155 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 170.2%
2022-04-19 08:11:46,390 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.288, Acc: 0.903, Base Lr: 2.77e-03
2022-04-19 08:12:37,768 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.278, Acc: 0.912, Base Lr: 2.77e-03
2022-04-19 08:13:19,089 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.553[s] Speed: 28.9[samples/s]
2022-04-19 08:14:10,895 reid_baseline.train INFO: normal accuracy 0.7688668619058346 1.7490836381912231 
2022-04-19 08:14:10,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 08:14:10,896 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 174.9%
2022-04-19 08:14:59,275 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.342, Acc: 0.914, Base Lr: 2.20e-03
2022-04-19 08:15:57,195 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.306, Acc: 0.915, Base Lr: 2.20e-03
2022-04-19 08:16:37,270 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.536[s] Speed: 29.9[samples/s]
2022-04-19 08:17:28,673 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7282052040100098 
2022-04-19 08:17:28,676 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 08:17:28,676 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 172.8%
2022-04-19 08:18:25,321 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.227, Acc: 0.920, Base Lr: 1.66e-03
2022-04-19 08:19:19,213 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.248, Acc: 0.917, Base Lr: 1.66e-03
2022-04-19 08:19:55,186 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.536[s] Speed: 29.8[samples/s]
2022-04-19 08:20:49,628 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.822396159172058 
2022-04-19 08:20:49,633 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 08:20:49,633 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 182.2%
2022-04-19 08:21:43,412 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.260, Acc: 0.923, Base Lr: 1.19e-03
2022-04-19 08:22:40,933 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.239, Acc: 0.927, Base Lr: 1.19e-03
2022-04-19 08:23:18,919 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.547[s] Speed: 29.3[samples/s]
2022-04-19 08:24:11,891 reid_baseline.train INFO: normal accuracy 0.7726965532777652 1.7553644180297852 
2022-04-19 08:24:11,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 08:24:11,896 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 175.5%
2022-04-19 08:25:12,418 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.254, Acc: 0.929, Base Lr: 7.78e-04
2022-04-19 08:26:01,481 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.264, Acc: 0.927, Base Lr: 7.78e-04
2022-04-19 08:26:36,919 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.531[s] Speed: 30.1[samples/s]
2022-04-19 08:27:38,400 reid_baseline.train INFO: normal accuracy 0.7756251407974769 1.7259918451309204 
2022-04-19 08:27:38,402 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 08:27:38,402 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 172.6%
2022-04-19 08:28:36,007 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.250, Acc: 0.918, Base Lr: 4.51e-04
2022-04-19 08:29:30,703 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.236, Acc: 0.928, Base Lr: 4.51e-04
2022-04-19 08:30:11,682 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.561[s] Speed: 28.5[samples/s]
2022-04-19 08:31:04,267 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.7474734783172607 
2022-04-19 08:31:04,271 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 08:31:04,271 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 174.7%
2022-04-19 08:31:55,458 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.258, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 08:32:48,119 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.258, Acc: 0.931, Base Lr: 2.11e-04
2022-04-19 08:33:27,239 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.523[s] Speed: 30.6[samples/s]
2022-04-19 08:34:27,283 reid_baseline.train INFO: normal accuracy 0.7756251407974769 1.726872205734253 
2022-04-19 08:34:27,288 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 08:34:27,288 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 172.7%
2022-04-19 08:35:20,622 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.239, Acc: 0.931, Base Lr: 6.51e-05
2022-04-19 08:36:10,971 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.236, Acc: 0.929, Base Lr: 6.51e-05
2022-04-19 08:36:54,837 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.540[s] Speed: 29.6[samples/s]
2022-04-19 08:37:45,776 reid_baseline.train INFO: normal accuracy 0.7735976571299842 1.7019681930541992 
2022-04-19 08:37:45,778 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 08:37:45,778 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 170.2%
2022-04-19 08:38:47,321 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.264, Acc: 0.918, Base Lr: 1.60e-05
2022-04-19 08:39:47,387 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.258, Acc: 0.922, Base Lr: 1.60e-05
2022-04-19 08:40:22,711 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.574[s] Speed: 27.9[samples/s]
2022-04-19 08:41:13,763 reid_baseline.train INFO: normal accuracy 0.7785537283171886 1.7084805965423584 
2022-04-19 08:41:13,766 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 08:41:13,766 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 170.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_4/transformer_best_model.pth
2022-04-19 08:42:06,491 reid_baseline.train INFO: normal accuracy 0.7693174138319442 1.7015283107757568 
2022-04-19 08:42:06,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:42:06,491 reid_baseline.train INFO: Accuracy: 76.9%
2022-04-19 08:42:48,946 reid_baseline.train INFO: normal accuracy 0.7693174138319442 1.7015283107757568 
2022-04-19 08:42:48,947 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:42:48,947 reid_baseline.train INFO: Shuffled Accuracy: 76.9%
2022-04-19 08:43:42,888 reid_baseline.train INFO: normal accuracy 0.9452462772050401 0.8425256609916687 
2022-04-19 08:43:42,889 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:43:42,889 reid_baseline.train INFO: Source Clean Accuracy: 94.5%
2022-04-19 08:43:50,182 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_6
2022-04-19 08:43:50,182 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-19 08:43:50,182 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 08:43:50,183 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 08:43:50,183 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 08:44:03,685 reid_baseline.train INFO: start training
2022-04-19 08:44:56,199 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.284, Acc: 0.248, Base Lr: 8.72e-04
2022-04-19 08:45:47,745 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.184, Acc: 0.373, Base Lr: 8.72e-04
2022-04-19 08:46:26,679 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.519[s] Speed: 30.8[samples/s]
2022-04-19 08:47:23,447 reid_baseline.train INFO: normal accuracy 0.562514079747691 4.164992332458496 
2022-04-19 08:47:24,540 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 08:47:24,541 reid_baseline.train INFO: Accuracy: 56.3% Mean Entropy: 416.5%
2022-04-19 08:48:12,865 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.801, Acc: 0.555, Base Lr: 1.66e-03
2022-04-19 08:49:04,158 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.651, Acc: 0.557, Base Lr: 1.66e-03
2022-04-19 08:49:41,719 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.502[s] Speed: 31.8[samples/s]
2022-04-19 08:50:28,129 reid_baseline.train INFO: normal accuracy 0.5893219193512053 3.979785919189453 
2022-04-19 08:50:29,060 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 08:50:29,060 reid_baseline.train INFO: Accuracy: 58.9% Mean Entropy: 398.0%
2022-04-19 08:51:03,818 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.872, Acc: 0.601, Base Lr: 2.46e-03
2022-04-19 08:51:29,708 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.690, Acc: 0.618, Base Lr: 2.46e-03
2022-04-19 08:51:48,835 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.292[s] Speed: 54.8[samples/s]
2022-04-19 08:52:38,598 reid_baseline.train INFO: normal accuracy 0.6467672899301644 3.25976824760437 
2022-04-19 08:52:39,697 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 08:52:39,697 reid_baseline.train INFO: Accuracy: 64.7% Mean Entropy: 326.0%
2022-04-19 08:53:11,416 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.238, Acc: 0.678, Base Lr: 3.25e-03
2022-04-19 08:53:45,537 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.136, Acc: 0.702, Base Lr: 3.25e-03
2022-04-19 08:54:12,787 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-19 08:54:59,454 reid_baseline.train INFO: normal accuracy 0.709168731696328 2.6503682136535645 
2022-04-19 08:55:00,443 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 08:55:00,443 reid_baseline.train INFO: Accuracy: 70.9% Mean Entropy: 265.0%
2022-04-19 08:55:35,086 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.820, Acc: 0.757, Base Lr: 4.04e-03
2022-04-19 08:56:06,942 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.828, Acc: 0.763, Base Lr: 4.04e-03
2022-04-19 08:56:35,336 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-19 08:57:18,229 reid_baseline.train INFO: normal accuracy 0.7328227078170759 2.258625030517578 
2022-04-19 08:57:19,254 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 08:57:19,254 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 225.9%
2022-04-19 08:58:00,198 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.684, Acc: 0.803, Base Lr: 4.83e-03
2022-04-19 08:58:30,500 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.656, Acc: 0.804, Base Lr: 4.83e-03
2022-04-19 08:58:51,155 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-19 08:59:32,135 reid_baseline.train INFO: normal accuracy 0.7479161973417436 2.046616792678833 
2022-04-19 08:59:33,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 08:59:33,687 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 204.7%
2022-04-19 09:00:02,356 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.504, Acc: 0.835, Base Lr: 5.62e-03
2022-04-19 09:00:42,231 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.508, Acc: 0.834, Base Lr: 5.62e-03
2022-04-19 09:01:12,936 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.364[s] Speed: 44.0[samples/s]
2022-04-19 09:01:57,865 reid_baseline.train INFO: normal accuracy 0.7582788916422618 1.9032206535339355 
2022-04-19 09:01:58,795 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 09:01:58,795 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 190.3%
2022-04-19 09:02:26,419 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.463, Acc: 0.863, Base Lr: 6.42e-03
2022-04-19 09:02:55,369 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.487, Acc: 0.854, Base Lr: 6.42e-03
2022-04-19 09:03:25,107 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-19 09:04:12,686 reid_baseline.train INFO: normal accuracy 0.7681910340166704 1.8608249425888062 
2022-04-19 09:04:13,847 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 09:04:13,847 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 186.1%
2022-04-19 09:04:49,144 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.427, Acc: 0.870, Base Lr: 7.21e-03
2022-04-19 09:05:14,839 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.462, Acc: 0.867, Base Lr: 7.21e-03
2022-04-19 09:05:33,483 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.291[s] Speed: 54.9[samples/s]
2022-04-19 09:06:22,310 reid_baseline.train INFO: normal accuracy 0.7677404820905609 1.8523218631744385 
2022-04-19 09:06:23,521 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 09:06:23,521 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 185.2%
2022-04-19 09:06:59,211 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.364, Acc: 0.889, Base Lr: 4.01e-03
2022-04-19 09:07:32,165 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.370, Acc: 0.892, Base Lr: 4.01e-03
2022-04-19 09:07:54,012 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.331[s] Speed: 48.3[samples/s]
2022-04-19 09:08:43,712 reid_baseline.train INFO: normal accuracy 0.7648118945708493 1.724666953086853 
2022-04-19 09:08:44,923 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 09:08:44,924 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 172.5%
2022-04-19 09:09:20,246 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.341, Acc: 0.904, Base Lr: 3.38e-03
2022-04-19 09:09:52,789 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.329, Acc: 0.903, Base Lr: 3.38e-03
2022-04-19 09:10:11,647 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.317[s] Speed: 50.4[samples/s]
2022-04-19 09:10:58,192 reid_baseline.train INFO: normal accuracy 0.7695426897949988 1.7419748306274414 
2022-04-19 09:10:58,192 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 09:10:58,193 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 174.2%
2022-04-19 09:11:37,241 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.288, Acc: 0.917, Base Lr: 2.77e-03
2022-04-19 09:12:15,907 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.310, Acc: 0.911, Base Lr: 2.77e-03
2022-04-19 09:12:37,437 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.363[s] Speed: 44.1[samples/s]
2022-04-19 09:13:14,860 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.7102200984954834 
2022-04-19 09:13:15,776 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 09:13:15,776 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 171.0%
2022-04-19 09:13:54,124 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.276, Acc: 0.918, Base Lr: 2.20e-03
2022-04-19 09:14:34,344 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.315, Acc: 0.919, Base Lr: 2.20e-03
2022-04-19 09:15:01,351 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.386[s] Speed: 41.4[samples/s]
2022-04-19 09:15:40,305 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.688875436782837 
2022-04-19 09:15:41,199 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 09:15:41,199 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 168.9%
2022-04-19 09:16:11,137 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.260, Acc: 0.916, Base Lr: 1.66e-03
2022-04-19 09:16:42,233 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.274, Acc: 0.919, Base Lr: 1.66e-03
2022-04-19 09:17:05,162 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-19 09:17:43,122 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.7947908639907837 
2022-04-19 09:17:43,123 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 09:17:43,123 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 179.5%
2022-04-19 09:18:21,910 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.285, Acc: 0.918, Base Lr: 1.19e-03
2022-04-19 09:18:57,737 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.267, Acc: 0.922, Base Lr: 1.19e-03
2022-04-19 09:19:22,783 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.365[s] Speed: 43.9[samples/s]
2022-04-19 09:20:06,894 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.7225381135940552 
2022-04-19 09:20:06,894 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 09:20:06,894 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 172.3%
2022-04-19 09:20:37,459 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.228, Acc: 0.939, Base Lr: 7.78e-04
2022-04-19 09:21:13,124 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.255, Acc: 0.930, Base Lr: 7.78e-04
2022-04-19 09:21:42,045 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-04-19 09:22:23,867 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.752018690109253 
2022-04-19 09:22:23,867 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 09:22:23,868 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 175.2%
2022-04-19 09:22:52,305 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.296, Acc: 0.928, Base Lr: 4.51e-04
2022-04-19 09:23:19,088 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.276, Acc: 0.930, Base Lr: 4.51e-04
2022-04-19 09:23:42,542 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.288[s] Speed: 55.6[samples/s]
2022-04-19 09:24:20,947 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.7186826467514038 
2022-04-19 09:24:20,948 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 09:24:20,948 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 171.9%
2022-04-19 09:24:58,296 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.181, Acc: 0.939, Base Lr: 2.11e-04
2022-04-19 09:25:37,222 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.220, Acc: 0.935, Base Lr: 2.11e-04
2022-04-19 09:26:03,829 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.376[s] Speed: 42.5[samples/s]
2022-04-19 09:26:43,834 reid_baseline.train INFO: normal accuracy 0.7756251407974769 1.71399986743927 
2022-04-19 09:26:43,835 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 09:26:43,835 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 171.4%
2022-04-19 09:27:21,470 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.226, Acc: 0.930, Base Lr: 6.51e-05
2022-04-19 09:27:57,288 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.235, Acc: 0.928, Base Lr: 6.51e-05
2022-04-19 09:28:25,730 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-04-19 09:29:08,340 reid_baseline.train INFO: normal accuracy 0.773822933093039 1.7288011312484741 
2022-04-19 09:29:08,340 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 09:29:08,340 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 172.9%
2022-04-19 09:29:36,300 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.250, Acc: 0.930, Base Lr: 1.60e-05
2022-04-19 09:30:03,466 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.244, Acc: 0.931, Base Lr: 1.60e-05
2022-04-19 09:30:23,071 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.273[s] Speed: 58.5[samples/s]
2022-04-19 09:31:06,607 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.7287427186965942 
2022-04-19 09:31:06,608 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 09:31:06,608 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 172.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_6/transformer_best_model.pth
2022-04-19 09:31:50,516 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.688875436782837 
2022-04-19 09:31:50,517 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:31:50,517 reid_baseline.train INFO: Accuracy: 77.2%
2022-04-19 09:32:29,990 reid_baseline.train INFO: normal accuracy 0.7717954494255463 1.688875436782837 
2022-04-19 09:32:29,991 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:32:29,991 reid_baseline.train INFO: Shuffled Accuracy: 77.2%
2022-04-19 09:33:10,665 reid_baseline.train INFO: normal accuracy 0.9537227949599084 0.8074916005134583 
2022-04-19 09:33:10,665 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 09:33:10,666 reid_baseline.train INFO: Source Clean Accuracy: 95.4%
2022-04-19 09:33:16,344 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_8
2022-04-19 09:33:16,344 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-19 09:33:16,344 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 09:33:16,345 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 09:33:16,345 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 09:33:25,290 reid_baseline.train INFO: start training
2022-04-19 09:34:12,937 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 6.268, Acc: 0.251, Base Lr: 8.72e-04
2022-04-19 09:34:53,933 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 6.175, Acc: 0.379, Base Lr: 8.72e-04
2022-04-19 09:35:19,462 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.414[s] Speed: 38.7[samples/s]
2022-04-19 09:35:58,106 reid_baseline.train INFO: normal accuracy 0.5760306375309755 4.164953708648682 
2022-04-19 09:35:59,014 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 09:35:59,015 reid_baseline.train INFO: Accuracy: 57.6% Mean Entropy: 416.5%
2022-04-19 09:36:30,110 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 5.761, Acc: 0.527, Base Lr: 1.66e-03
2022-04-19 09:36:55,771 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 5.610, Acc: 0.540, Base Lr: 1.66e-03
2022-04-19 09:37:15,763 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.281[s] Speed: 56.9[samples/s]
2022-04-19 09:37:59,658 reid_baseline.train INFO: normal accuracy 0.5969813020950665 3.9774253368377686 
2022-04-19 09:38:00,680 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 09:38:00,680 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 397.7%
2022-04-19 09:38:41,617 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 4.872, Acc: 0.577, Base Lr: 2.46e-03
2022-04-19 09:39:11,483 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 4.678, Acc: 0.607, Base Lr: 2.46e-03
2022-04-19 09:39:30,150 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-19 09:40:12,320 reid_baseline.train INFO: normal accuracy 0.6521739130434783 3.2288081645965576 
2022-04-19 09:40:13,650 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 09:40:13,651 reid_baseline.train INFO: Accuracy: 65.2% Mean Entropy: 322.9%
2022-04-19 09:40:53,515 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 4.236, Acc: 0.678, Base Lr: 3.25e-03
2022-04-19 09:41:29,757 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 4.158, Acc: 0.696, Base Lr: 3.25e-03
2022-04-19 09:41:52,446 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.362[s] Speed: 44.2[samples/s]
2022-04-19 09:42:32,236 reid_baseline.train INFO: normal accuracy 0.7057895922505069 2.582538604736328 
2022-04-19 09:42:33,134 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 09:42:33,135 reid_baseline.train INFO: Accuracy: 70.6% Mean Entropy: 258.3%
2022-04-19 09:43:00,816 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 3.794, Acc: 0.774, Base Lr: 4.04e-03
2022-04-19 09:43:30,214 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 3.798, Acc: 0.768, Base Lr: 4.04e-03
2022-04-19 09:43:59,643 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-19 09:44:44,911 reid_baseline.train INFO: normal accuracy 0.738004054967335 2.2762794494628906 
2022-04-19 09:44:45,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 09:44:45,899 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 227.6%
2022-04-19 09:45:21,401 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 3.625, Acc: 0.800, Base Lr: 4.83e-03
2022-04-19 09:45:49,507 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 3.611, Acc: 0.807, Base Lr: 4.83e-03
2022-04-19 09:46:13,568 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-19 09:46:57,262 reid_baseline.train INFO: normal accuracy 0.7479161973417436 2.1012966632843018 
2022-04-19 09:46:58,249 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 09:46:58,249 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 210.1%
2022-04-19 09:47:40,479 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 3.526, Acc: 0.831, Base Lr: 5.62e-03
2022-04-19 09:48:07,649 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 3.540, Acc: 0.822, Base Lr: 5.62e-03
2022-04-19 09:48:24,990 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.318[s] Speed: 50.4[samples/s]
2022-04-19 09:49:06,327 reid_baseline.train INFO: normal accuracy 0.7524217166028385 1.9753929376602173 
2022-04-19 09:49:08,901 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 09:49:08,901 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 197.5%
2022-04-19 09:49:39,070 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 3.530, Acc: 0.866, Base Lr: 6.42e-03
2022-04-19 09:50:19,305 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 3.482, Acc: 0.858, Base Lr: 6.42e-03
2022-04-19 09:50:47,936 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.363[s] Speed: 44.1[samples/s]
2022-04-19 09:51:30,189 reid_baseline.train INFO: normal accuracy 0.7585041676053165 1.866011619567871 
2022-04-19 09:51:31,069 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 09:51:31,069 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 186.6%
2022-04-19 09:51:57,220 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 3.385, Acc: 0.876, Base Lr: 7.21e-03
2022-04-19 09:52:30,324 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 3.387, Acc: 0.872, Base Lr: 7.21e-03
2022-04-19 09:52:57,509 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-19 09:53:41,854 reid_baseline.train INFO: normal accuracy 0.7596305474205902 1.8042247295379639 
2022-04-19 09:53:42,849 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 09:53:42,849 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 180.4%
2022-04-19 09:54:12,267 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 3.298, Acc: 0.887, Base Lr: 4.01e-03
2022-04-19 09:54:37,615 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 3.324, Acc: 0.892, Base Lr: 4.01e-03
2022-04-19 09:54:56,538 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.270[s] Speed: 59.3[samples/s]
2022-04-19 09:55:39,613 reid_baseline.train INFO: normal accuracy 0.7627844109033566 1.6938806772232056 
2022-04-19 09:55:40,479 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 09:55:40,480 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 169.4%
2022-04-19 09:56:19,232 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 3.277, Acc: 0.903, Base Lr: 3.38e-03
2022-04-19 09:56:57,491 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 3.302, Acc: 0.903, Base Lr: 3.38e-03
2022-04-19 09:57:26,292 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.387[s] Speed: 41.3[samples/s]
2022-04-19 09:58:04,797 reid_baseline.train INFO: normal accuracy 0.7650371705339041 1.7364991903305054 
2022-04-19 09:58:04,798 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 09:58:04,798 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 173.6%
2022-04-19 09:58:42,552 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 3.282, Acc: 0.915, Base Lr: 2.77e-03
2022-04-19 09:59:22,327 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 3.285, Acc: 0.913, Base Lr: 2.77e-03
2022-04-19 09:59:50,516 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.387[s] Speed: 41.4[samples/s]
2022-04-19 10:00:28,615 reid_baseline.train INFO: normal accuracy 0.7704437936472178 1.7264487743377686 
2022-04-19 10:00:28,616 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 10:00:28,616 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 172.6%
2022-04-19 10:00:58,363 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 3.276, Acc: 0.909, Base Lr: 2.20e-03
2022-04-19 10:01:25,741 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 3.271, Acc: 0.909, Base Lr: 2.20e-03
2022-04-19 10:01:42,783 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.272[s] Speed: 58.9[samples/s]
2022-04-19 10:02:25,090 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.769577145576477 
2022-04-19 10:02:25,093 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 10:02:25,093 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 177.0%
2022-04-19 10:03:06,780 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 3.245, Acc: 0.917, Base Lr: 1.66e-03
2022-04-19 10:03:40,748 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 3.240, Acc: 0.919, Base Lr: 1.66e-03
2022-04-19 10:03:58,972 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-19 10:04:40,544 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.7341382503509521 
2022-04-19 10:04:40,546 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 10:04:40,547 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 173.4%
2022-04-19 10:05:21,094 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 3.240, Acc: 0.904, Base Lr: 1.19e-03
2022-04-19 10:05:57,999 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 3.220, Acc: 0.913, Base Lr: 1.19e-03
2022-04-19 10:06:20,711 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-19 10:07:03,486 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.7590655088424683 
2022-04-19 10:07:03,486 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 10:07:03,487 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 175.9%
2022-04-19 10:07:31,634 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 3.235, Acc: 0.925, Base Lr: 7.78e-04
2022-04-19 10:07:56,681 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 3.218, Acc: 0.927, Base Lr: 7.78e-04
2022-04-19 10:08:25,942 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.302[s] Speed: 53.0[samples/s]
2022-04-19 10:09:11,537 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.7321441173553467 
2022-04-19 10:09:11,537 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 10:09:11,537 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 173.2%
2022-04-19 10:09:47,865 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 3.179, Acc: 0.933, Base Lr: 4.51e-04
2022-04-19 10:10:16,419 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 3.216, Acc: 0.926, Base Lr: 4.51e-04
2022-04-19 10:10:38,635 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-19 10:11:23,268 reid_baseline.train INFO: normal accuracy 0.7756251407974769 1.7549489736557007 
2022-04-19 10:11:23,270 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 10:11:23,270 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 175.5%
2022-04-19 10:12:01,288 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 3.201, Acc: 0.939, Base Lr: 2.11e-04
2022-04-19 10:12:34,984 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 3.223, Acc: 0.936, Base Lr: 2.11e-04
2022-04-19 10:12:53,609 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.331[s] Speed: 48.4[samples/s]
2022-04-19 10:13:32,338 reid_baseline.train INFO: normal accuracy 0.7749493129083127 1.7108068466186523 
2022-04-19 10:13:32,339 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 10:13:32,339 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 171.1%
2022-04-19 10:14:03,928 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 3.240, Acc: 0.922, Base Lr: 6.51e-05
2022-04-19 10:14:37,423 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 3.214, Acc: 0.930, Base Lr: 6.51e-05
2022-04-19 10:15:07,230 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-19 10:15:49,348 reid_baseline.train INFO: normal accuracy 0.7744987609822032 1.75261390209198 
2022-04-19 10:15:49,350 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 10:15:49,351 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 175.3%
2022-04-19 10:16:21,022 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 3.235, Acc: 0.926, Base Lr: 1.60e-05
2022-04-19 10:16:51,245 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 3.211, Acc: 0.926, Base Lr: 1.60e-05
2022-04-19 10:17:18,319 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.326[s] Speed: 49.1[samples/s]
2022-04-19 10:18:03,134 reid_baseline.train INFO: normal accuracy 0.7758504167605317 1.7888104915618896 
2022-04-19 10:18:03,136 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 10:18:03,137 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 178.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_CEL_8/transformer_best_model.pth
2022-04-19 10:18:45,371 reid_baseline.train INFO: normal accuracy 0.7627844109033566 1.6938806772232056 
2022-04-19 10:18:45,371 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:18:45,371 reid_baseline.train INFO: Accuracy: 76.3%
2022-04-19 10:19:22,664 reid_baseline.train INFO: normal accuracy 0.7627844109033566 1.6938806772232056 
2022-04-19 10:19:22,665 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:19:22,665 reid_baseline.train INFO: Shuffled Accuracy: 76.3%
2022-04-19 10:20:04,797 reid_baseline.train INFO: normal accuracy 0.9379152348224513 0.8615929484367371 
2022-04-19 10:20:04,798 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 10:20:04,798 reid_baseline.train INFO: Source Clean Accuracy: 93.8%
