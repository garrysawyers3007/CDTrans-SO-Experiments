2022-04-19 04:07:21,966 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_1
2022-04-19 04:07:21,966 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-19 04:07:21,966 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 04:07:21,966 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 04:07:21,966 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 04:07:31,247 reid_baseline.train INFO: start training
2022-04-19 04:08:09,095 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.273, Acc: 0.290, Base Lr: 8.72e-04
2022-04-19 04:08:33,898 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.406[s] Speed: 39.4[samples/s]
2022-04-19 04:09:19,174 reid_baseline.train INFO: normal accuracy 0.3949599083619702 4.171747207641602 
2022-04-19 04:09:20,151 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 04:09:20,152 reid_baseline.train INFO: Accuracy: 39.5% Mean Entropy: 417.2%
2022-04-19 04:10:19,986 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.952, Acc: 0.602, Base Lr: 1.66e-03
2022-04-19 04:10:42,758 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.543[s] Speed: 29.4[samples/s]
2022-04-19 04:11:31,857 reid_baseline.train INFO: normal accuracy 0.41718213058419246 4.152456760406494 
2022-04-19 04:11:32,797 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 04:11:32,798 reid_baseline.train INFO: Accuracy: 41.7% Mean Entropy: 415.2%
2022-04-19 04:12:22,645 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.385, Acc: 0.626, Base Lr: 2.46e-03
2022-04-19 04:12:49,127 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.502[s] Speed: 31.9[samples/s]
2022-04-19 04:13:41,992 reid_baseline.train INFO: normal accuracy 0.44032073310423825 3.988405227661133 
2022-04-19 04:13:43,004 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 04:13:43,004 reid_baseline.train INFO: Accuracy: 44.0% Mean Entropy: 398.8%
2022-04-19 04:14:45,211 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.665, Acc: 0.660, Base Lr: 3.25e-03
2022-04-19 04:15:11,278 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.580[s] Speed: 27.6[samples/s]
2022-04-19 04:16:00,966 reid_baseline.train INFO: normal accuracy 0.4962199312714777 3.528317451477051 
2022-04-19 04:16:02,026 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 04:16:02,026 reid_baseline.train INFO: Accuracy: 49.6% Mean Entropy: 352.8%
2022-04-19 04:17:03,343 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.137, Acc: 0.716, Base Lr: 4.04e-03
2022-04-19 04:17:34,883 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.610[s] Speed: 26.2[samples/s]
2022-04-19 04:18:26,759 reid_baseline.train INFO: normal accuracy 0.5484536082474227 3.0425384044647217 
2022-04-19 04:18:27,692 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 04:18:27,692 reid_baseline.train INFO: Accuracy: 54.8% Mean Entropy: 304.3%
2022-04-19 04:19:15,875 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.912, Acc: 0.769, Base Lr: 4.83e-03
2022-04-19 04:19:40,590 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.480[s] Speed: 33.4[samples/s]
2022-04-19 04:20:31,655 reid_baseline.train INFO: normal accuracy 0.5906071019473081 2.7053146362304688 
2022-04-19 04:20:32,574 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 04:20:32,575 reid_baseline.train INFO: Accuracy: 59.1% Mean Entropy: 270.5%
2022-04-19 04:21:28,797 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.690, Acc: 0.818, Base Lr: 5.62e-03
2022-04-19 04:21:59,228 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.570[s] Speed: 28.1[samples/s]
2022-04-19 04:22:56,128 reid_baseline.train INFO: normal accuracy 0.6041237113402061 2.388476848602295 
2022-04-19 04:22:57,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 04:22:57,122 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 238.8%
2022-04-19 04:23:47,890 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.536, Acc: 0.849, Base Lr: 6.42e-03
2022-04-19 04:24:09,892 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.478[s] Speed: 33.5[samples/s]
2022-04-19 04:25:00,193 reid_baseline.train INFO: normal accuracy 0.6098510882016037 2.1900746822357178 
2022-04-19 04:25:02,419 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 04:25:02,420 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 219.0%
2022-04-19 04:26:07,837 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.502, Acc: 0.871, Base Lr: 7.21e-03
2022-04-19 04:26:40,673 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.646[s] Speed: 24.8[samples/s]
2022-04-19 04:27:25,895 reid_baseline.train INFO: normal accuracy 0.611454753722795 2.0343267917633057 
2022-04-19 04:27:27,778 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 04:27:27,778 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 203.4%
2022-04-19 04:28:13,640 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.379, Acc: 0.889, Base Lr: 4.01e-03
2022-04-19 04:28:37,412 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.458[s] Speed: 34.9[samples/s]
2022-04-19 04:29:34,795 reid_baseline.train INFO: normal accuracy 0.6229095074455899 1.9673446416854858 
2022-04-19 04:29:36,212 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 04:29:36,212 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 196.7%
2022-04-19 04:30:37,490 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.384, Acc: 0.907, Base Lr: 3.38e-03
2022-04-19 04:31:07,759 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.602[s] Speed: 26.6[samples/s]
2022-04-19 04:31:59,293 reid_baseline.train INFO: normal accuracy 0.622680412371134 1.8235273361206055 
2022-04-19 04:32:00,328 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 04:32:00,328 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 182.4%
2022-04-19 04:32:56,654 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.360, Acc: 0.919, Base Lr: 2.77e-03
2022-04-19 04:33:26,132 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.564[s] Speed: 28.4[samples/s]
2022-04-19 04:34:17,892 reid_baseline.train INFO: normal accuracy 0.6245131729667812 1.9492332935333252 
2022-04-19 04:34:17,893 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 04:34:17,893 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 194.9%
2022-04-19 04:35:14,927 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.302, Acc: 0.915, Base Lr: 2.20e-03
2022-04-19 04:35:39,205 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.535[s] Speed: 29.9[samples/s]
2022-04-19 04:36:28,505 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.855025291442871 
2022-04-19 04:36:28,506 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 04:36:28,506 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 185.5%
2022-04-19 04:37:15,366 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.355, Acc: 0.919, Base Lr: 1.66e-03
2022-04-19 04:37:42,305 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.484[s] Speed: 33.0[samples/s]
2022-04-19 04:38:37,588 reid_baseline.train INFO: normal accuracy 0.6256586483390607 1.8784445524215698 
2022-04-19 04:38:37,591 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 04:38:37,591 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 187.8%
2022-04-19 04:39:44,546 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.321, Acc: 0.932, Base Lr: 1.19e-03
2022-04-19 04:40:13,661 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.632[s] Speed: 25.3[samples/s]
2022-04-19 04:41:00,035 reid_baseline.train INFO: normal accuracy 0.6309278350515464 1.8455431461334229 
2022-04-19 04:41:00,037 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 04:41:00,038 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 184.6%
2022-04-19 04:42:02,446 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.299, Acc: 0.934, Base Lr: 7.78e-04
2022-04-19 04:42:31,397 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.601[s] Speed: 26.6[samples/s]
2022-04-19 04:43:27,695 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.8477531671524048 
2022-04-19 04:43:27,700 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 04:43:27,700 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 184.8%
2022-04-19 04:44:18,587 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.299, Acc: 0.937, Base Lr: 4.51e-04
2022-04-19 04:44:39,357 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.471[s] Speed: 34.0[samples/s]
2022-04-19 04:45:27,719 reid_baseline.train INFO: normal accuracy 0.627262313860252 1.823783040046692 
2022-04-19 04:45:27,719 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 04:45:27,720 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 182.4%
2022-04-19 04:46:22,627 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.293, Acc: 0.931, Base Lr: 2.11e-04
2022-04-19 04:46:53,853 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.566[s] Speed: 28.3[samples/s]
2022-04-19 04:47:44,777 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.8376967906951904 
2022-04-19 04:47:44,782 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 04:47:44,782 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 183.8%
2022-04-19 04:48:42,911 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.273, Acc: 0.934, Base Lr: 6.51e-05
2022-04-19 04:49:02,918 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.514[s] Speed: 31.1[samples/s]
2022-04-19 04:49:59,104 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.8626604080200195 
2022-04-19 04:49:59,105 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 04:49:59,105 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.3%
2022-04-19 04:51:01,394 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.280, Acc: 0.940, Base Lr: 1.60e-05
2022-04-19 04:51:32,169 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.611[s] Speed: 26.2[samples/s]
2022-04-19 04:52:18,836 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.8394858837127686 
2022-04-19 04:52:18,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 04:52:18,838 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 183.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_1/transformer_best_model.pth
2022-04-19 04:53:10,953 reid_baseline.train INFO: normal accuracy 0.622680412371134 1.8235273361206055 
2022-04-19 04:53:10,953 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:53:10,954 reid_baseline.train INFO: Accuracy: 62.3%
2022-04-19 04:53:58,652 reid_baseline.train INFO: normal accuracy 0.622680412371134 1.8235273361206055 
2022-04-19 04:53:58,652 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:53:58,652 reid_baseline.train INFO: Shuffled Accuracy: 62.3%
2022-04-19 04:54:39,056 reid_baseline.train INFO: normal accuracy 0.9620931190770499 0.8871877789497375 
2022-04-19 04:54:39,057 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 04:54:39,057 reid_baseline.train INFO: Source Clean Accuracy: 96.2%
2022-04-19 04:54:45,987 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_2
2022-04-19 04:54:45,987 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-19 04:54:45,987 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 04:54:45,988 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 04:54:45,988 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 04:54:59,308 reid_baseline.train INFO: start training
2022-04-19 04:56:10,290 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.258, Acc: 0.287, Base Lr: 8.72e-04
2022-04-19 04:56:44,129 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.683[s] Speed: 23.4[samples/s]
2022-04-19 04:57:30,531 reid_baseline.train INFO: normal accuracy 0.39014891179839634 4.1717634201049805 
2022-04-19 04:57:32,638 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 04:57:32,639 reid_baseline.train INFO: Accuracy: 39.0% Mean Entropy: 417.2%
2022-04-19 04:58:30,530 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.938, Acc: 0.572, Base Lr: 1.66e-03
2022-04-19 04:58:57,859 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.561[s] Speed: 28.5[samples/s]
2022-04-19 04:59:58,176 reid_baseline.train INFO: normal accuracy 0.4311569301260023 4.152251720428467 
2022-04-19 04:59:59,096 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 04:59:59,097 reid_baseline.train INFO: Accuracy: 43.1% Mean Entropy: 415.2%
2022-04-19 05:00:46,532 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.421, Acc: 0.609, Base Lr: 2.46e-03
2022-04-19 05:01:09,572 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.464[s] Speed: 34.5[samples/s]
2022-04-19 05:01:55,206 reid_baseline.train INFO: normal accuracy 0.44032073310423825 3.995522975921631 
2022-04-19 05:01:56,198 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 05:01:56,198 reid_baseline.train INFO: Accuracy: 44.0% Mean Entropy: 399.6%
2022-04-19 05:02:46,553 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.680, Acc: 0.654, Base Lr: 3.25e-03
2022-04-19 05:03:16,030 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.524[s] Speed: 30.5[samples/s]
2022-04-19 05:04:07,229 reid_baseline.train INFO: normal accuracy 0.49186712485681555 3.527661085128784 
2022-04-19 05:04:08,282 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 05:04:08,282 reid_baseline.train INFO: Accuracy: 49.2% Mean Entropy: 352.8%
2022-04-19 05:05:07,466 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.219, Acc: 0.706, Base Lr: 4.04e-03
2022-04-19 05:05:28,903 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.530[s] Speed: 30.2[samples/s]
2022-04-19 05:06:21,467 reid_baseline.train INFO: normal accuracy 0.5457044673539518 3.0355536937713623 
2022-04-19 05:06:22,468 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 05:06:22,468 reid_baseline.train INFO: Accuracy: 54.6% Mean Entropy: 303.6%
2022-04-19 05:07:21,946 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.860, Acc: 0.769, Base Lr: 4.83e-03
2022-04-19 05:07:50,377 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.578[s] Speed: 27.7[samples/s]
2022-04-19 05:08:41,419 reid_baseline.train INFO: normal accuracy 0.5846506300114548 2.685917854309082 
2022-04-19 05:08:42,376 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 05:08:42,376 reid_baseline.train INFO: Accuracy: 58.5% Mean Entropy: 268.6%
2022-04-19 05:09:25,326 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.708, Acc: 0.813, Base Lr: 5.62e-03
2022-04-19 05:09:49,979 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.445[s] Speed: 36.0[samples/s]
2022-04-19 05:10:38,681 reid_baseline.train INFO: normal accuracy 0.6119129438717068 2.4197285175323486 
2022-04-19 05:10:39,649 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 05:10:39,649 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 242.0%
2022-04-19 05:11:32,062 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.550, Acc: 0.838, Base Lr: 6.42e-03
2022-04-19 05:11:59,926 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.528[s] Speed: 30.3[samples/s]
2022-04-19 05:12:56,143 reid_baseline.train INFO: normal accuracy 0.6126002290950745 2.1337502002716064 
2022-04-19 05:12:57,181 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 05:12:57,182 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 213.4%
2022-04-19 05:13:49,280 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.444, Acc: 0.873, Base Lr: 7.21e-03
2022-04-19 05:14:09,819 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.478[s] Speed: 33.5[samples/s]
2022-04-19 05:14:59,118 reid_baseline.train INFO: normal accuracy 0.6155784650630012 1.9891977310180664 
2022-04-19 05:15:00,103 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 05:15:00,104 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 198.9%
2022-04-19 05:15:58,368 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.407, Acc: 0.893, Base Lr: 4.01e-03
2022-04-19 05:16:31,175 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.599[s] Speed: 26.7[samples/s]
2022-04-19 05:17:28,653 reid_baseline.train INFO: normal accuracy 0.6286368843069874 2.00960373878479 
2022-04-19 05:17:28,653 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 05:17:28,653 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 201.0%
2022-04-19 05:18:16,989 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.378, Acc: 0.899, Base Lr: 3.38e-03
2022-04-19 05:18:41,853 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.481[s] Speed: 33.2[samples/s]
2022-04-19 05:19:27,005 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.8854354619979858 
2022-04-19 05:19:28,064 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 05:19:28,064 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 188.5%
2022-04-19 05:20:23,242 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.337, Acc: 0.911, Base Lr: 2.77e-03
2022-04-19 05:20:54,761 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.569[s] Speed: 28.1[samples/s]
2022-04-19 05:21:52,137 reid_baseline.train INFO: normal accuracy 0.6368843069873997 1.9345437288284302 
2022-04-19 05:21:52,142 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 05:21:52,142 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 193.5%
2022-04-19 05:22:40,892 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.330, Acc: 0.909, Base Lr: 2.20e-03
2022-04-19 05:23:06,141 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.487[s] Speed: 32.9[samples/s]
2022-04-19 05:23:56,792 reid_baseline.train INFO: normal accuracy 0.6343642611683848 1.8709125518798828 
2022-04-19 05:23:57,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 05:23:57,899 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 187.1%
2022-04-19 05:24:54,652 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.327, Acc: 0.917, Base Lr: 1.66e-03
2022-04-19 05:25:19,972 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.540[s] Speed: 29.6[samples/s]
2022-04-19 05:26:11,078 reid_baseline.train INFO: normal accuracy 0.6357388316151202 1.8833115100860596 
2022-04-19 05:26:11,082 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 05:26:11,083 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 188.3%
2022-04-19 05:27:07,488 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.268, Acc: 0.932, Base Lr: 1.19e-03
2022-04-19 05:27:36,002 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.558[s] Speed: 28.7[samples/s]
2022-04-19 05:28:26,636 reid_baseline.train INFO: normal accuracy 0.6364261168384879 1.8592935800552368 
2022-04-19 05:28:27,684 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 05:28:27,684 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 185.9%
2022-04-19 05:29:18,138 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.261, Acc: 0.937, Base Lr: 7.78e-04
2022-04-19 05:29:43,628 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.499[s] Speed: 32.0[samples/s]
2022-04-19 05:30:37,871 reid_baseline.train INFO: normal accuracy 0.6364261168384879 1.8847094774246216 
2022-04-19 05:30:37,873 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 05:30:37,873 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 188.5%
2022-04-19 05:31:26,535 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.265, Acc: 0.929, Base Lr: 4.51e-04
2022-04-19 05:31:49,816 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.473[s] Speed: 33.8[samples/s]
2022-04-19 05:32:43,632 reid_baseline.train INFO: normal accuracy 0.6364261168384879 1.8543919324874878 
2022-04-19 05:32:44,509 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 05:32:44,510 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 185.4%
2022-04-19 05:33:40,126 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.241, Acc: 0.931, Base Lr: 2.11e-04
2022-04-19 05:34:06,865 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.542[s] Speed: 29.5[samples/s]
2022-04-19 05:34:55,327 reid_baseline.train INFO: normal accuracy 0.6405498281786941 1.8518279790878296 
2022-04-19 05:34:58,017 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 05:34:58,017 reid_baseline.train INFO: Accuracy: 64.1% Mean Entropy: 185.2%
2022-04-19 05:36:00,821 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.272, Acc: 0.932, Base Lr: 6.51e-05
2022-04-19 05:36:30,467 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.608[s] Speed: 26.3[samples/s]
2022-04-19 05:37:19,235 reid_baseline.train INFO: normal accuracy 0.636197021764032 1.8937482833862305 
2022-04-19 05:37:19,240 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 05:37:19,240 reid_baseline.train INFO: Accuracy: 63.6% Mean Entropy: 189.4%
2022-04-19 05:38:11,448 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.280, Acc: 0.921, Base Lr: 1.60e-05
2022-04-19 05:38:33,589 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.489[s] Speed: 32.7[samples/s]
2022-04-19 05:39:29,143 reid_baseline.train INFO: normal accuracy 0.6348224513172966 1.7991727590560913 
2022-04-19 05:39:30,795 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 05:39:30,796 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 179.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_2/transformer_best_model.pth
2022-04-19 05:40:25,638 reid_baseline.train INFO: normal accuracy 0.6348224513172966 1.7991727590560913 
2022-04-19 05:40:25,639 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:40:25,640 reid_baseline.train INFO: Accuracy: 63.5%
2022-04-19 05:41:13,389 reid_baseline.train INFO: normal accuracy 0.6348224513172966 1.7991727590560913 
2022-04-19 05:41:13,390 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:41:13,390 reid_baseline.train INFO: Shuffled Accuracy: 63.5%
2022-04-19 05:41:50,876 reid_baseline.train INFO: normal accuracy 0.9736299958796869 0.8281763792037964 
2022-04-19 05:41:50,876 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 05:41:50,876 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-19 05:41:57,861 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_3
2022-04-19 05:41:57,861 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-19 05:41:57,861 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 05:41:57,861 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 05:41:57,862 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 05:42:14,897 reid_baseline.train INFO: start training
2022-04-19 05:43:25,919 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.274, Acc: 0.281, Base Lr: 8.72e-04
2022-04-19 05:43:56,207 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.644[s] Speed: 24.9[samples/s]
2022-04-19 05:44:46,577 reid_baseline.train INFO: normal accuracy 0.38785796105383735 4.171729564666748 
2022-04-19 05:44:47,518 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 05:44:47,519 reid_baseline.train INFO: Accuracy: 38.8% Mean Entropy: 417.2%
2022-04-19 05:45:45,623 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.952, Acc: 0.581, Base Lr: 1.66e-03
2022-04-19 05:46:13,892 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.568[s] Speed: 28.2[samples/s]
2022-04-19 05:47:07,205 reid_baseline.train INFO: normal accuracy 0.4011454753722795 4.152358055114746 
2022-04-19 05:47:08,558 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 05:47:08,558 reid_baseline.train INFO: Accuracy: 40.1% Mean Entropy: 415.2%
2022-04-19 05:47:57,855 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.331, Acc: 0.619, Base Lr: 2.46e-03
2022-04-19 05:48:28,559 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.526[s] Speed: 30.4[samples/s]
2022-04-19 05:49:23,132 reid_baseline.train INFO: normal accuracy 0.4350515463917526 3.980225086212158 
2022-04-19 05:49:24,546 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 05:49:24,546 reid_baseline.train INFO: Accuracy: 43.5% Mean Entropy: 398.0%
2022-04-19 05:50:22,701 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.639, Acc: 0.648, Base Lr: 3.25e-03
2022-04-19 05:50:50,303 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.564[s] Speed: 28.4[samples/s]
2022-04-19 05:51:39,538 reid_baseline.train INFO: normal accuracy 0.4849942726231386 3.4932668209075928 
2022-04-19 05:51:40,925 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 05:51:40,926 reid_baseline.train INFO: Accuracy: 48.5% Mean Entropy: 349.3%
2022-04-19 05:52:43,546 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.166, Acc: 0.721, Base Lr: 4.04e-03
2022-04-19 05:53:08,206 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.574[s] Speed: 27.9[samples/s]
2022-04-19 05:53:58,107 reid_baseline.train INFO: normal accuracy 0.5445589919816723 3.0274105072021484 
2022-04-19 05:53:59,175 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 05:53:59,175 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 302.7%
2022-04-19 05:54:54,819 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.870, Acc: 0.779, Base Lr: 4.83e-03
2022-04-19 05:55:27,039 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.578[s] Speed: 27.7[samples/s]
2022-04-19 05:56:19,805 reid_baseline.train INFO: normal accuracy 0.5839633447880871 2.651949882507324 
2022-04-19 05:56:20,883 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 05:56:20,883 reid_baseline.train INFO: Accuracy: 58.4% Mean Entropy: 265.2%
2022-04-19 05:57:13,936 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.669, Acc: 0.807, Base Lr: 5.62e-03
2022-04-19 05:57:41,138 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.528[s] Speed: 30.3[samples/s]
2022-04-19 05:58:34,653 reid_baseline.train INFO: normal accuracy 0.6061855670103092 2.3676564693450928 
2022-04-19 05:58:36,076 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 05:58:36,076 reid_baseline.train INFO: Accuracy: 60.6% Mean Entropy: 236.8%
2022-04-19 05:59:33,214 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.578, Acc: 0.851, Base Lr: 6.42e-03
2022-04-19 05:59:55,399 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.522[s] Speed: 30.7[samples/s]
2022-04-19 06:00:46,934 reid_baseline.train INFO: normal accuracy 0.6105383734249714 2.159194231033325 
2022-04-19 06:00:48,205 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 06:00:48,205 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 215.9%
2022-04-19 06:01:45,129 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.528, Acc: 0.867, Base Lr: 7.21e-03
2022-04-19 06:02:12,571 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.554[s] Speed: 28.9[samples/s]
2022-04-19 06:03:03,372 reid_baseline.train INFO: normal accuracy 0.6174112256586484 2.0587782859802246 
2022-04-19 06:03:04,324 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 06:03:04,324 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 205.9%
2022-04-19 06:03:54,620 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.413, Acc: 0.895, Base Lr: 4.01e-03
2022-04-19 06:04:21,210 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.506[s] Speed: 31.6[samples/s]
2022-04-19 06:05:20,595 reid_baseline.train INFO: normal accuracy 0.6176403207331043 1.989953875541687 
2022-04-19 06:05:21,886 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 06:05:21,886 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 199.0%
2022-04-19 06:06:17,460 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.406, Acc: 0.899, Base Lr: 3.38e-03
2022-04-19 06:06:42,529 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.531[s] Speed: 30.2[samples/s]
2022-04-19 06:07:32,220 reid_baseline.train INFO: normal accuracy 0.620389461626575 1.9093577861785889 
2022-04-19 06:07:35,083 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 06:07:35,084 reid_baseline.train INFO: Accuracy: 62.0% Mean Entropy: 190.9%
2022-04-19 06:08:34,065 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.323, Acc: 0.911, Base Lr: 2.77e-03
2022-04-19 06:09:02,418 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.575[s] Speed: 27.8[samples/s]
2022-04-19 06:09:55,094 reid_baseline.train INFO: normal accuracy 0.6258877434135166 1.8749175071716309 
2022-04-19 06:09:56,039 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 06:09:56,040 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 187.5%
2022-04-19 06:10:48,990 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.348, Acc: 0.916, Base Lr: 2.20e-03
2022-04-19 06:11:19,738 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.551[s] Speed: 29.1[samples/s]
2022-04-19 06:12:14,580 reid_baseline.train INFO: normal accuracy 0.6261168384879725 1.8754533529281616 
2022-04-19 06:12:14,583 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 06:12:14,583 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 187.5%
2022-04-19 06:13:09,316 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.329, Acc: 0.917, Base Lr: 1.66e-03
2022-04-19 06:13:32,441 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.512[s] Speed: 31.2[samples/s]
2022-04-19 06:14:23,050 reid_baseline.train INFO: normal accuracy 0.6261168384879725 1.90494704246521 
2022-04-19 06:14:23,052 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 06:14:23,053 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 190.5%
2022-04-19 06:15:11,902 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.231, Acc: 0.940, Base Lr: 1.19e-03
2022-04-19 06:15:35,184 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.474[s] Speed: 33.7[samples/s]
2022-04-19 06:16:24,893 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.909682035446167 
2022-04-19 06:16:24,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 06:16:24,896 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 191.0%
2022-04-19 06:17:18,538 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.324, Acc: 0.933, Base Lr: 7.78e-04
2022-04-19 06:17:48,397 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.548[s] Speed: 29.2[samples/s]
2022-04-19 06:18:40,835 reid_baseline.train INFO: normal accuracy 0.6265750286368843 1.883788824081421 
2022-04-19 06:18:40,837 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 06:18:40,837 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 188.4%
2022-04-19 06:19:33,020 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.297, Acc: 0.920, Base Lr: 4.51e-04
2022-04-19 06:19:59,547 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.518[s] Speed: 30.9[samples/s]
2022-04-19 06:20:46,815 reid_baseline.train INFO: normal accuracy 0.6316151202749141 1.9247194528579712 
2022-04-19 06:20:46,820 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 06:20:46,820 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 192.5%
2022-04-19 06:21:46,596 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.270, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 06:22:11,135 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.555[s] Speed: 28.8[samples/s]
2022-04-19 06:22:57,731 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.8789405822753906 
2022-04-19 06:22:57,731 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 06:22:57,731 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 187.9%
2022-04-19 06:23:43,319 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.287, Acc: 0.935, Base Lr: 6.51e-05
2022-04-19 06:24:08,589 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.466[s] Speed: 34.3[samples/s]
2022-04-19 06:25:03,508 reid_baseline.train INFO: normal accuracy 0.6329896907216495 1.8484814167022705 
2022-04-19 06:25:04,505 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 06:25:04,506 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 184.8%
2022-04-19 06:26:00,497 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.297, Acc: 0.925, Base Lr: 1.60e-05
2022-04-19 06:26:27,101 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.543[s] Speed: 29.5[samples/s]
2022-04-19 06:27:18,775 reid_baseline.train INFO: normal accuracy 0.634135166093929 1.8630870580673218 
2022-04-19 06:27:18,777 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 06:27:18,778 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 186.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_3/transformer_best_model.pth
2022-04-19 06:28:06,700 reid_baseline.train INFO: normal accuracy 0.6329896907216495 1.8484814167022705 
2022-04-19 06:28:06,701 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:28:06,701 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-19 06:28:54,071 reid_baseline.train INFO: normal accuracy 0.6329896907216495 1.8484814167022705 
2022-04-19 06:28:54,072 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:28:54,072 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-19 06:29:30,100 reid_baseline.train INFO: normal accuracy 0.9736299958796869 0.8806241750717163 
2022-04-19 06:29:30,100 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 06:29:30,100 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-19 06:29:36,046 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_4
2022-04-19 06:29:36,046 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-19 06:29:36,046 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 06:29:36,046 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 06:29:36,046 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 06:29:50,380 reid_baseline.train INFO: start training
2022-04-19 06:31:02,213 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.288, Acc: 0.287, Base Lr: 8.72e-04
2022-04-19 06:31:25,584 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.609[s] Speed: 26.3[samples/s]
2022-04-19 06:32:15,933 reid_baseline.train INFO: normal accuracy 0.38854524627720505 4.171775817871094 
2022-04-19 06:32:18,397 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 06:32:18,397 reid_baseline.train INFO: Accuracy: 38.9% Mean Entropy: 417.2%
2022-04-19 06:33:03,826 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.956, Acc: 0.579, Base Lr: 1.66e-03
2022-04-19 06:33:26,075 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.445[s] Speed: 35.9[samples/s]
2022-04-19 06:34:19,085 reid_baseline.train INFO: normal accuracy 0.4245131729667812 4.153183460235596 
2022-04-19 06:34:20,456 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 06:34:20,457 reid_baseline.train INFO: Accuracy: 42.5% Mean Entropy: 415.3%
2022-04-19 06:35:11,291 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.390, Acc: 0.615, Base Lr: 2.46e-03
2022-04-19 06:35:35,545 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.494[s] Speed: 32.4[samples/s]
2022-04-19 06:36:22,606 reid_baseline.train INFO: normal accuracy 0.43711340206185567 3.9877631664276123 
2022-04-19 06:36:23,735 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 06:36:23,736 reid_baseline.train INFO: Accuracy: 43.7% Mean Entropy: 398.8%
2022-04-19 06:37:22,403 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.627, Acc: 0.666, Base Lr: 3.25e-03
2022-04-19 06:37:47,192 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.549[s] Speed: 29.1[samples/s]
2022-04-19 06:38:36,488 reid_baseline.train INFO: normal accuracy 0.4859106529209622 3.521959066390991 
2022-04-19 06:38:37,557 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 06:38:37,557 reid_baseline.train INFO: Accuracy: 48.6% Mean Entropy: 352.2%
2022-04-19 06:39:30,546 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.162, Acc: 0.723, Base Lr: 4.04e-03
2022-04-19 06:39:59,807 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.540[s] Speed: 29.6[samples/s]
2022-04-19 06:40:50,309 reid_baseline.train INFO: normal accuracy 0.5427262313860252 3.079953193664551 
2022-04-19 06:40:52,440 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 06:40:52,440 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 308.0%
2022-04-19 06:41:40,108 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.869, Acc: 0.775, Base Lr: 4.83e-03
2022-04-19 06:42:02,544 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.461[s] Speed: 34.7[samples/s]
2022-04-19 06:42:55,951 reid_baseline.train INFO: normal accuracy 0.5853379152348225 2.626202344894409 
2022-04-19 06:42:57,250 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 06:42:57,251 reid_baseline.train INFO: Accuracy: 58.5% Mean Entropy: 262.6%
2022-04-19 06:43:44,519 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.700, Acc: 0.806, Base Lr: 5.62e-03
2022-04-19 06:44:07,335 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.461[s] Speed: 34.7[samples/s]
2022-04-19 06:44:58,780 reid_baseline.train INFO: normal accuracy 0.5965635738831615 2.3478994369506836 
2022-04-19 06:45:00,090 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 06:45:00,090 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 234.8%
2022-04-19 06:45:45,886 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.574, Acc: 0.845, Base Lr: 6.42e-03
2022-04-19 06:46:08,810 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.452[s] Speed: 35.4[samples/s]
2022-04-19 06:47:00,522 reid_baseline.train INFO: normal accuracy 0.604581901489118 2.1743381023406982 
2022-04-19 06:47:01,898 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 06:47:01,899 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 217.4%
2022-04-19 06:47:48,147 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.443, Acc: 0.860, Base Lr: 7.21e-03
2022-04-19 06:48:10,286 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.450[s] Speed: 35.6[samples/s]
2022-04-19 06:49:02,320 reid_baseline.train INFO: normal accuracy 0.6139747995418099 2.038468360900879 
2022-04-19 06:49:03,409 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 06:49:03,409 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 203.8%
2022-04-19 06:49:55,831 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.461, Acc: 0.878, Base Lr: 4.01e-03
2022-04-19 06:50:19,984 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.504[s] Speed: 31.8[samples/s]
2022-04-19 06:51:07,913 reid_baseline.train INFO: normal accuracy 0.622680412371134 1.9788814783096313 
2022-04-19 06:51:08,883 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 06:51:08,884 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 197.9%
2022-04-19 06:51:59,912 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.392, Acc: 0.904, Base Lr: 3.38e-03
2022-04-19 06:52:27,923 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.520[s] Speed: 30.8[samples/s]
2022-04-19 06:53:15,844 reid_baseline.train INFO: normal accuracy 0.620389461626575 1.920551061630249 
2022-04-19 06:53:18,369 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 06:53:18,370 reid_baseline.train INFO: Accuracy: 62.0% Mean Entropy: 192.1%
2022-04-19 06:54:08,845 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.370, Acc: 0.915, Base Lr: 2.77e-03
2022-04-19 06:54:35,462 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.507[s] Speed: 31.6[samples/s]
2022-04-19 06:55:27,725 reid_baseline.train INFO: normal accuracy 0.6190148911798397 1.9467524290084839 
2022-04-19 06:55:27,730 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 06:55:27,730 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 194.7%
2022-04-19 06:56:12,869 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.345, Acc: 0.917, Base Lr: 2.20e-03
2022-04-19 06:56:35,152 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.444[s] Speed: 36.1[samples/s]
2022-04-19 06:57:25,651 reid_baseline.train INFO: normal accuracy 0.6229095074455899 1.8808468580245972 
2022-04-19 06:57:26,610 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 06:57:26,611 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 188.1%
2022-04-19 06:58:24,113 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.295, Acc: 0.926, Base Lr: 1.66e-03
2022-04-19 06:58:54,248 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.577[s] Speed: 27.8[samples/s]
2022-04-19 06:59:42,930 reid_baseline.train INFO: normal accuracy 0.6247422680412371 1.8746098279953003 
2022-04-19 06:59:43,906 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 06:59:43,906 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 187.5%
2022-04-19 07:00:39,175 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.258, Acc: 0.930, Base Lr: 1.19e-03
2022-04-19 07:01:06,346 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.542[s] Speed: 29.5[samples/s]
2022-04-19 07:01:56,667 reid_baseline.train INFO: normal accuracy 0.6277205040091638 1.885229229927063 
2022-04-19 07:01:56,669 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 07:01:56,670 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 188.5%
2022-04-19 07:02:44,327 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.288, Acc: 0.932, Base Lr: 7.78e-04
2022-04-19 07:03:06,792 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.461[s] Speed: 34.7[samples/s]
2022-04-19 07:03:57,240 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.847550868988037 
2022-04-19 07:03:58,594 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 07:03:58,594 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 184.8%
2022-04-19 07:04:47,442 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.273, Acc: 0.929, Base Lr: 4.51e-04
2022-04-19 07:05:10,044 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.470[s] Speed: 34.0[samples/s]
2022-04-19 07:05:58,276 reid_baseline.train INFO: normal accuracy 0.63184421534937 1.8598623275756836 
2022-04-19 07:05:58,278 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 07:05:58,279 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 186.0%
2022-04-19 07:06:51,632 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.298, Acc: 0.928, Base Lr: 2.11e-04
2022-04-19 07:07:16,500 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.513[s] Speed: 31.2[samples/s]
2022-04-19 07:08:08,128 reid_baseline.train INFO: normal accuracy 0.6270332187857961 1.908780813217163 
2022-04-19 07:08:08,131 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 07:08:08,131 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 190.9%
2022-04-19 07:08:57,825 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.281, Acc: 0.926, Base Lr: 6.51e-05
2022-04-19 07:09:22,722 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.491[s] Speed: 32.6[samples/s]
2022-04-19 07:10:10,393 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.822025179862976 
2022-04-19 07:10:11,377 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 07:10:11,377 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 182.2%
2022-04-19 07:11:06,460 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.290, Acc: 0.923, Base Lr: 1.60e-05
2022-04-19 07:11:34,061 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.544[s] Speed: 29.4[samples/s]
2022-04-19 07:12:24,743 reid_baseline.train INFO: normal accuracy 0.6277205040091638 1.8428785800933838 
2022-04-19 07:12:24,744 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 07:12:24,744 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 184.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_4/transformer_best_model.pth
2022-04-19 07:13:15,420 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.822025179862976 
2022-04-19 07:13:15,420 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:13:15,421 reid_baseline.train INFO: Accuracy: 62.8%
2022-04-19 07:14:00,949 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.822025179862976 
2022-04-19 07:14:00,950 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:14:00,950 reid_baseline.train INFO: Shuffled Accuracy: 62.8%
2022-04-19 07:14:43,294 reid_baseline.train INFO: normal accuracy 0.973217964565307 0.8582144379615784 
2022-04-19 07:14:43,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 07:14:43,295 reid_baseline.train INFO: Source Clean Accuracy: 97.3%
2022-04-19 07:14:49,031 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_6
2022-04-19 07:14:49,031 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-19 07:14:49,031 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 07:14:49,031 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 07:14:49,031 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 07:15:03,731 reid_baseline.train INFO: start training
2022-04-19 07:16:13,082 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.265, Acc: 0.287, Base Lr: 8.72e-04
2022-04-19 07:16:36,957 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.581[s] Speed: 27.6[samples/s]
2022-04-19 07:17:29,801 reid_baseline.train INFO: normal accuracy 0.3846506300114548 4.171742916107178 
2022-04-19 07:17:31,001 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 07:17:31,002 reid_baseline.train INFO: Accuracy: 38.5% Mean Entropy: 417.2%
2022-04-19 07:18:16,556 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.907, Acc: 0.586, Base Lr: 1.66e-03
2022-04-19 07:18:40,761 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.459[s] Speed: 34.9[samples/s]
2022-04-19 07:19:29,142 reid_baseline.train INFO: normal accuracy 0.42107674684994273 4.152719020843506 
2022-04-19 07:19:30,176 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 07:19:30,177 reid_baseline.train INFO: Accuracy: 42.1% Mean Entropy: 415.3%
2022-04-19 07:20:26,233 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.372, Acc: 0.634, Base Lr: 2.46e-03
2022-04-19 07:20:53,243 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.546[s] Speed: 29.3[samples/s]
2022-04-19 07:21:39,763 reid_baseline.train INFO: normal accuracy 0.4352806414662085 3.9931325912475586 
2022-04-19 07:21:40,799 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 07:21:40,799 reid_baseline.train INFO: Accuracy: 43.5% Mean Entropy: 399.3%
2022-04-19 07:22:34,125 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.632, Acc: 0.650, Base Lr: 3.25e-03
2022-04-19 07:22:59,607 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.517[s] Speed: 30.9[samples/s]
2022-04-19 07:23:56,654 reid_baseline.train INFO: normal accuracy 0.4868270332187858 3.5107760429382324 
2022-04-19 07:23:57,575 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 07:23:57,575 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 351.1%
2022-04-19 07:24:45,088 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.236, Acc: 0.696, Base Lr: 4.04e-03
2022-04-19 07:25:06,705 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.454[s] Speed: 35.2[samples/s]
2022-04-19 07:25:58,812 reid_baseline.train INFO: normal accuracy 0.5534936998854525 3.0864102840423584 
2022-04-19 07:25:59,945 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 07:25:59,945 reid_baseline.train INFO: Accuracy: 55.3% Mean Entropy: 308.6%
2022-04-19 07:27:05,603 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.928, Acc: 0.772, Base Lr: 4.83e-03
2022-04-19 07:27:34,173 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.620[s] Speed: 25.8[samples/s]
2022-04-19 07:28:26,503 reid_baseline.train INFO: normal accuracy 0.5839633447880871 2.687859296798706 
2022-04-19 07:28:27,473 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 07:28:27,473 reid_baseline.train INFO: Accuracy: 58.4% Mean Entropy: 268.8%
2022-04-19 07:29:21,478 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.682, Acc: 0.814, Base Lr: 5.62e-03
2022-04-19 07:29:50,926 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.549[s] Speed: 29.1[samples/s]
2022-04-19 07:30:44,504 reid_baseline.train INFO: normal accuracy 0.6006872852233677 2.4100613594055176 
2022-04-19 07:30:45,897 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 07:30:45,897 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 241.0%
2022-04-19 07:31:34,489 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.550, Acc: 0.842, Base Lr: 6.42e-03
2022-04-19 07:31:58,642 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.479[s] Speed: 33.4[samples/s]
2022-04-19 07:32:50,909 reid_baseline.train INFO: normal accuracy 0.6050400916380297 2.148766279220581 
2022-04-19 07:32:52,253 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 07:32:52,254 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 214.9%
2022-04-19 07:33:37,262 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.540, Acc: 0.869, Base Lr: 7.21e-03
2022-04-19 07:34:00,595 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.450[s] Speed: 35.6[samples/s]
2022-04-19 07:34:49,172 reid_baseline.train INFO: normal accuracy 0.6128293241695304 2.0673141479492188 
2022-04-19 07:34:50,162 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 07:34:50,163 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 206.7%
2022-04-19 07:35:43,871 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.422, Acc: 0.889, Base Lr: 4.01e-03
2022-04-19 07:36:09,047 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.518[s] Speed: 30.9[samples/s]
2022-04-19 07:37:05,633 reid_baseline.train INFO: normal accuracy 0.6155784650630012 1.982386589050293 
2022-04-19 07:37:06,528 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 07:37:06,528 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 198.2%
2022-04-19 07:38:00,997 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.376, Acc: 0.899, Base Lr: 3.38e-03
2022-04-19 07:38:26,004 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.523[s] Speed: 30.6[samples/s]
2022-04-19 07:39:09,745 reid_baseline.train INFO: normal accuracy 0.6217640320733104 1.9439620971679688 
2022-04-19 07:39:10,963 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 07:39:10,963 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 194.4%
2022-04-19 07:40:02,589 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.311, Acc: 0.926, Base Lr: 2.77e-03
2022-04-19 07:40:31,261 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.528[s] Speed: 30.3[samples/s]
2022-04-19 07:41:23,365 reid_baseline.train INFO: normal accuracy 0.6245131729667812 1.9196834564208984 
2022-04-19 07:41:24,372 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 07:41:24,372 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 192.0%
2022-04-19 07:42:18,351 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.278, Acc: 0.929, Base Lr: 2.20e-03
2022-04-19 07:42:45,358 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.533[s] Speed: 30.0[samples/s]
2022-04-19 07:43:40,659 reid_baseline.train INFO: normal accuracy 0.6213058419243986 1.9000465869903564 
2022-04-19 07:43:41,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 07:43:41,800 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 190.0%
2022-04-19 07:44:36,783 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.322, Acc: 0.915, Base Lr: 1.66e-03
2022-04-19 07:45:04,242 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.542[s] Speed: 29.5[samples/s]
2022-04-19 07:45:51,024 reid_baseline.train INFO: normal accuracy 0.6274914089347079 1.865842580795288 
2022-04-19 07:45:52,103 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 07:45:52,103 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 186.6%
2022-04-19 07:46:50,797 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.355, Acc: 0.918, Base Lr: 1.19e-03
2022-04-19 07:47:20,207 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.580[s] Speed: 27.6[samples/s]
2022-04-19 07:48:11,761 reid_baseline.train INFO: normal accuracy 0.627262313860252 1.886111855506897 
2022-04-19 07:48:11,766 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 07:48:11,766 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 188.6%
2022-04-19 07:49:06,945 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.304, Acc: 0.936, Base Lr: 7.78e-04
2022-04-19 07:49:32,753 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.533[s] Speed: 30.0[samples/s]
2022-04-19 07:50:32,144 reid_baseline.train INFO: normal accuracy 0.6252004581901489 1.7940001487731934 
2022-04-19 07:50:33,154 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 07:50:33,154 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 179.4%
2022-04-19 07:51:26,265 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.294, Acc: 0.927, Base Lr: 4.51e-04
2022-04-19 07:51:48,961 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.499[s] Speed: 32.1[samples/s]
2022-04-19 07:52:41,569 reid_baseline.train INFO: normal accuracy 0.6284077892325315 1.8107407093048096 
2022-04-19 07:52:41,572 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 07:52:41,572 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 181.1%
2022-04-19 07:53:42,333 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.259, Acc: 0.929, Base Lr: 2.11e-04
2022-04-19 07:54:08,676 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.572[s] Speed: 28.0[samples/s]
2022-04-19 07:55:00,765 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.856306552886963 
2022-04-19 07:55:00,767 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 07:55:00,767 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 185.6%
2022-04-19 07:55:54,305 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.295, Acc: 0.936, Base Lr: 6.51e-05
2022-04-19 07:56:21,753 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.531[s] Speed: 30.1[samples/s]
2022-04-19 07:57:18,993 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.8357166051864624 
2022-04-19 07:57:18,995 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 07:57:18,996 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 183.6%
2022-04-19 07:58:11,628 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.252, Acc: 0.933, Base Lr: 1.60e-05
2022-04-19 07:58:38,767 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.525[s] Speed: 30.5[samples/s]
2022-04-19 07:59:32,514 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.9197384119033813 
2022-04-19 07:59:32,519 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 07:59:32,519 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 192.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_6/transformer_best_model.pth
2022-04-19 08:00:24,572 reid_baseline.train INFO: normal accuracy 0.6252004581901489 1.7940001487731934 
2022-04-19 08:00:24,572 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:00:24,572 reid_baseline.train INFO: Accuracy: 62.5%
2022-04-19 08:01:18,713 reid_baseline.train INFO: normal accuracy 0.6252004581901489 1.7940001487731934 
2022-04-19 08:01:18,714 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:01:18,714 reid_baseline.train INFO: Shuffled Accuracy: 62.5%
2022-04-19 08:01:56,984 reid_baseline.train INFO: normal accuracy 0.9740420271940667 0.8243047595024109 
2022-04-19 08:01:56,984 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:01:56,985 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-04-19 08:02:04,167 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_8
2022-04-19 08:02:04,167 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-19 08:02:04,167 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-19 08:02:04,167 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-19 08:02:04,168 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-19 08:02:19,042 reid_baseline.train INFO: start training
2022-04-19 08:03:22,612 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.278, Acc: 0.287, Base Lr: 8.72e-04
2022-04-19 08:03:56,158 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.615[s] Speed: 26.0[samples/s]
2022-04-19 08:04:49,842 reid_baseline.train INFO: normal accuracy 0.38831615120274915 4.171756744384766 
2022-04-19 08:04:50,739 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-19 08:04:50,740 reid_baseline.train INFO: Accuracy: 38.8% Mean Entropy: 417.2%
2022-04-19 08:05:43,654 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.978, Acc: 0.584, Base Lr: 1.66e-03
2022-04-19 08:06:10,760 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.526[s] Speed: 30.4[samples/s]
2022-04-19 08:07:03,051 reid_baseline.train INFO: normal accuracy 0.41878579610538375 4.153183937072754 
2022-04-19 08:07:04,128 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-19 08:07:04,128 reid_baseline.train INFO: Accuracy: 41.9% Mean Entropy: 415.3%
2022-04-19 08:08:04,389 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.373, Acc: 0.605, Base Lr: 2.46e-03
2022-04-19 08:08:27,237 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.547[s] Speed: 29.3[samples/s]
2022-04-19 08:09:14,992 reid_baseline.train INFO: normal accuracy 0.4306987399770905 3.987243175506592 
2022-04-19 08:09:15,905 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-19 08:09:15,905 reid_baseline.train INFO: Accuracy: 43.1% Mean Entropy: 398.7%
2022-04-19 08:10:15,148 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.675, Acc: 0.657, Base Lr: 3.25e-03
2022-04-19 08:10:46,096 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.593[s] Speed: 27.0[samples/s]
2022-04-19 08:11:37,317 reid_baseline.train INFO: normal accuracy 0.4813287514318442 3.551501989364624 
2022-04-19 08:11:39,850 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-19 08:11:39,850 reid_baseline.train INFO: Accuracy: 48.1% Mean Entropy: 355.2%
2022-04-19 08:12:32,163 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.182, Acc: 0.711, Base Lr: 4.04e-03
2022-04-19 08:12:59,380 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.522[s] Speed: 30.6[samples/s]
2022-04-19 08:13:53,331 reid_baseline.train INFO: normal accuracy 0.5427262313860252 3.0620572566986084 
2022-04-19 08:13:54,747 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-19 08:13:54,747 reid_baseline.train INFO: Accuracy: 54.3% Mean Entropy: 306.2%
2022-04-19 08:14:43,286 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.875, Acc: 0.774, Base Lr: 4.83e-03
2022-04-19 08:15:09,996 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.495[s] Speed: 32.3[samples/s]
2022-04-19 08:16:01,865 reid_baseline.train INFO: normal accuracy 0.5800687285223368 2.7080609798431396 
2022-04-19 08:16:03,005 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-19 08:16:03,006 reid_baseline.train INFO: Accuracy: 58.0% Mean Entropy: 270.8%
2022-04-19 08:17:03,196 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.689, Acc: 0.820, Base Lr: 5.62e-03
2022-04-19 08:17:31,605 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.583[s] Speed: 27.4[samples/s]
2022-04-19 08:18:23,897 reid_baseline.train INFO: normal accuracy 0.5993127147766323 2.3918635845184326 
2022-04-19 08:18:24,872 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-19 08:18:24,872 reid_baseline.train INFO: Accuracy: 59.9% Mean Entropy: 239.2%
2022-04-19 08:19:20,858 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.562, Acc: 0.850, Base Lr: 6.42e-03
2022-04-19 08:19:46,792 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.538[s] Speed: 29.7[samples/s]
2022-04-19 08:20:41,173 reid_baseline.train INFO: normal accuracy 0.6126002290950745 2.193671941757202 
2022-04-19 08:20:42,088 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-19 08:20:42,089 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 219.4%
2022-04-19 08:21:34,473 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.480, Acc: 0.867, Base Lr: 7.21e-03
2022-04-19 08:22:03,586 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.535[s] Speed: 29.9[samples/s]
2022-04-19 08:22:55,266 reid_baseline.train INFO: normal accuracy 0.6098510882016037 2.0409791469573975 
2022-04-19 08:22:56,387 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-19 08:22:56,387 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 204.1%
2022-04-19 08:23:56,202 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.387, Acc: 0.896, Base Lr: 4.01e-03
2022-04-19 08:24:23,979 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.576[s] Speed: 27.8[samples/s]
2022-04-19 08:25:16,849 reid_baseline.train INFO: normal accuracy 0.6235967926689576 1.998801827430725 
2022-04-19 08:25:17,922 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-19 08:25:17,923 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 199.9%
2022-04-19 08:26:09,302 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.376, Acc: 0.899, Base Lr: 3.38e-03
2022-04-19 08:26:36,405 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.516[s] Speed: 31.0[samples/s]
2022-04-19 08:27:36,220 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.8726799488067627 
2022-04-19 08:27:37,319 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-19 08:27:37,319 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 187.3%
2022-04-19 08:28:36,551 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.366, Acc: 0.915, Base Lr: 2.77e-03
2022-04-19 08:29:03,065 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.563[s] Speed: 28.4[samples/s]
2022-04-19 08:29:55,937 reid_baseline.train INFO: normal accuracy 0.6290950744558992 1.9029604196548462 
2022-04-19 08:29:55,939 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-19 08:29:55,939 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 190.3%
2022-04-19 08:30:55,676 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.378, Acc: 0.912, Base Lr: 2.20e-03
2022-04-19 08:31:24,819 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.585[s] Speed: 27.4[samples/s]
2022-04-19 08:32:15,709 reid_baseline.train INFO: normal accuracy 0.6316151202749141 1.8791371583938599 
2022-04-19 08:32:15,711 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-19 08:32:15,711 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 187.9%
2022-04-19 08:33:09,613 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.298, Acc: 0.912, Base Lr: 1.66e-03
2022-04-19 08:33:36,950 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.534[s] Speed: 29.9[samples/s]
2022-04-19 08:34:35,783 reid_baseline.train INFO: normal accuracy 0.6320733104238259 1.8650671243667603 
2022-04-19 08:34:37,022 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-19 08:34:37,023 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 186.5%
2022-04-19 08:35:31,850 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.260, Acc: 0.928, Base Lr: 1.19e-03
2022-04-19 08:35:59,147 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.540[s] Speed: 29.6[samples/s]
2022-04-19 08:36:52,058 reid_baseline.train INFO: normal accuracy 0.634135166093929 1.875976800918579 
2022-04-19 08:36:52,063 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-19 08:36:52,063 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 187.6%
2022-04-19 08:37:43,766 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.267, Acc: 0.929, Base Lr: 7.78e-04
2022-04-19 08:38:09,677 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.510[s] Speed: 31.4[samples/s]
2022-04-19 08:39:08,731 reid_baseline.train INFO: normal accuracy 0.6316151202749141 1.87380850315094 
2022-04-19 08:39:08,736 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-19 08:39:08,736 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 187.4%
2022-04-19 08:40:06,177 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.306, Acc: 0.927, Base Lr: 4.51e-04
2022-04-19 08:40:27,256 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.516[s] Speed: 31.0[samples/s]
2022-04-19 08:41:16,676 reid_baseline.train INFO: normal accuracy 0.6329896907216495 1.829253077507019 
2022-04-19 08:41:18,056 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-19 08:41:18,056 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 182.9%
2022-04-19 08:42:06,596 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.319, Acc: 0.921, Base Lr: 2.11e-04
2022-04-19 08:42:30,214 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.475[s] Speed: 33.7[samples/s]
2022-04-19 08:43:23,850 reid_baseline.train INFO: normal accuracy 0.633906071019473 1.8739795684814453 
2022-04-19 08:43:23,850 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-19 08:43:23,851 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 187.4%
2022-04-19 08:44:07,287 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.295, Acc: 0.930, Base Lr: 6.51e-05
2022-04-19 08:44:25,119 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.402[s] Speed: 39.8[samples/s]
2022-04-19 08:45:10,510 reid_baseline.train INFO: normal accuracy 0.6350515463917525 1.8658549785614014 
2022-04-19 08:45:10,512 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-19 08:45:10,512 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 186.6%
2022-04-19 08:46:03,226 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.267, Acc: 0.937, Base Lr: 1.60e-05
2022-04-19 08:46:29,457 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.519[s] Speed: 30.8[samples/s]
2022-04-19 08:47:26,229 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.8620160818099976 
2022-04-19 08:47:26,231 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-19 08:47:26,231 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 186.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_8/transformer_best_model.pth
2022-04-19 08:48:13,055 reid_baseline.train INFO: normal accuracy 0.6329896907216495 1.829253077507019 
2022-04-19 08:48:13,055 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:48:13,056 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-19 08:48:50,971 reid_baseline.train INFO: normal accuracy 0.6329896907216495 1.829253077507019 
2022-04-19 08:48:50,971 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:48:50,971 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-19 08:49:30,585 reid_baseline.train INFO: normal accuracy 0.9715698393077874 0.8640171885490417 
2022-04-19 08:49:30,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-19 08:49:30,586 reid_baseline.train INFO: Source Clean Accuracy: 97.2%
