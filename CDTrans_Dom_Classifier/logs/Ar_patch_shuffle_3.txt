2022-04-13 20:25:09,621 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_7
2022-04-13 20:25:09,622 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_7', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=7, dom_cls=False)
2022-04-13 20:25:09,622 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 20:25:09,622 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 20:25:09,622 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_7
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 20:25:21,829 reid_baseline.train INFO: start training
2022-04-13 20:25:37,546 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.118, Acc: 0.234, Base Lr: 8.72e-04
2022-04-13 20:25:47,566 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.169[s] Speed: 94.9[samples/s]
2022-04-13 20:26:17,372 reid_baseline.train INFO: normal accuracy 0.19289805269186713 4.1714043617248535 
2022-04-13 20:26:18,647 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 20:26:18,647 reid_baseline.train INFO: Accuracy: 19.3% Mean Entropy: 417.1%
2022-04-13 20:26:38,492 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.827, Acc: 0.444, Base Lr: 1.66e-03
2022-04-13 20:26:50,824 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.212[s] Speed: 75.6[samples/s]
2022-04-13 20:27:21,248 reid_baseline.train INFO: normal accuracy 0.20458190148911798 4.149105072021484 
2022-04-13 20:27:22,430 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 20:27:22,430 reid_baseline.train INFO: Accuracy: 20.5% Mean Entropy: 414.9%
2022-04-13 20:27:43,078 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.300, Acc: 0.475, Base Lr: 2.46e-03
2022-04-13 20:27:53,608 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.205[s] Speed: 78.1[samples/s]
2022-04-13 20:28:29,150 reid_baseline.train INFO: normal accuracy 0.26804123711340205 4.055593967437744 
2022-04-13 20:28:30,903 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 20:28:30,904 reid_baseline.train INFO: Accuracy: 26.8% Mean Entropy: 405.6%
2022-04-13 20:28:49,568 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.777, Acc: 0.514, Base Lr: 3.25e-03
2022-04-13 20:28:59,117 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.185[s] Speed: 86.3[samples/s]
2022-04-13 20:29:30,044 reid_baseline.train INFO: normal accuracy 0.32875143184421535 3.831390619277954 
2022-04-13 20:29:31,809 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 20:29:31,810 reid_baseline.train INFO: Accuracy: 32.9% Mean Entropy: 383.1%
2022-04-13 20:29:57,557 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.274, Acc: 0.602, Base Lr: 4.04e-03
2022-04-13 20:30:07,372 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.234[s] Speed: 68.5[samples/s]
2022-04-13 20:30:38,905 reid_baseline.train INFO: normal accuracy 0.3713631156930126 3.554487943649292 
2022-04-13 20:30:40,148 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 20:30:40,148 reid_baseline.train INFO: Accuracy: 37.1% Mean Entropy: 355.4%
2022-04-13 20:30:59,536 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.927, Acc: 0.671, Base Lr: 4.83e-03
2022-04-13 20:31:11,519 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.205[s] Speed: 77.9[samples/s]
2022-04-13 20:31:44,715 reid_baseline.train INFO: normal accuracy 0.4297823596792669 3.245508909225464 
2022-04-13 20:31:45,856 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 20:31:45,857 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 324.6%
2022-04-13 20:32:05,462 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.687, Acc: 0.744, Base Lr: 5.62e-03
2022-04-13 20:32:15,163 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.193[s] Speed: 83.1[samples/s]
2022-04-13 20:32:47,689 reid_baseline.train INFO: normal accuracy 0.4520045819014891 2.9650931358337402 
2022-04-13 20:32:49,051 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 20:32:49,051 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 296.5%
2022-04-13 20:33:07,833 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.470, Acc: 0.816, Base Lr: 6.42e-03
2022-04-13 20:33:17,387 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.186[s] Speed: 85.9[samples/s]
2022-04-13 20:33:48,471 reid_baseline.train INFO: normal accuracy 0.4744558991981672 2.7718117237091064 
2022-04-13 20:33:49,597 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 20:33:49,597 reid_baseline.train INFO: Accuracy: 47.4% Mean Entropy: 277.2%
2022-04-13 20:34:13,754 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.346, Acc: 0.849, Base Lr: 7.21e-03
2022-04-13 20:34:23,171 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-13 20:34:55,187 reid_baseline.train INFO: normal accuracy 0.4877434135166094 2.594984292984009 
2022-04-13 20:34:56,182 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 20:34:56,182 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 259.5%
2022-04-13 20:35:14,656 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.234, Acc: 0.880, Base Lr: 4.01e-03
2022-04-13 20:35:24,831 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.188[s] Speed: 85.0[samples/s]
2022-04-13 20:35:56,581 reid_baseline.train INFO: normal accuracy 0.4872852233676976 2.5212676525115967 
2022-04-13 20:35:57,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 20:35:57,896 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 252.1%
2022-04-13 20:36:17,318 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.172, Acc: 0.899, Base Lr: 3.38e-03
2022-04-13 20:36:27,090 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.192[s] Speed: 83.5[samples/s]
2022-04-13 20:36:58,616 reid_baseline.train INFO: normal accuracy 0.4950744558991982 2.401357650756836 
2022-04-13 20:37:00,299 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 20:37:00,299 reid_baseline.train INFO: Accuracy: 49.5% Mean Entropy: 240.1%
2022-04-13 20:37:20,624 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.151, Acc: 0.903, Base Lr: 2.77e-03
2022-04-13 20:37:31,280 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.203[s] Speed: 78.7[samples/s]
2022-04-13 20:38:02,523 reid_baseline.train INFO: normal accuracy 0.4849942726231386 2.442603349685669 
2022-04-13 20:38:02,524 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 20:38:02,524 reid_baseline.train INFO: Accuracy: 48.5% Mean Entropy: 244.3%
2022-04-13 20:38:24,253 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.118, Acc: 0.919, Base Lr: 2.20e-03
2022-04-13 20:38:35,085 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.214[s] Speed: 74.8[samples/s]
2022-04-13 20:39:04,934 reid_baseline.train INFO: normal accuracy 0.4852233676975945 2.421429395675659 
2022-04-13 20:39:04,935 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 20:39:04,935 reid_baseline.train INFO: Accuracy: 48.5% Mean Entropy: 242.1%
2022-04-13 20:39:24,291 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.093, Acc: 0.922, Base Lr: 1.66e-03
2022-04-13 20:39:33,938 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.191[s] Speed: 84.0[samples/s]
2022-04-13 20:40:08,831 reid_baseline.train INFO: normal accuracy 0.49026345933562426 2.4069838523864746 
2022-04-13 20:40:08,834 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 20:40:08,834 reid_baseline.train INFO: Accuracy: 49.0% Mean Entropy: 240.7%
2022-04-13 20:40:27,548 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.084, Acc: 0.926, Base Lr: 1.19e-03
2022-04-13 20:40:37,072 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.185[s] Speed: 86.3[samples/s]
2022-04-13 20:41:07,441 reid_baseline.train INFO: normal accuracy 0.49003436426116836 2.349332571029663 
2022-04-13 20:41:08,814 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 20:41:08,815 reid_baseline.train INFO: Accuracy: 49.0% Mean Entropy: 234.9%
2022-04-13 20:41:32,402 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.065, Acc: 0.941, Base Lr: 7.78e-04
2022-04-13 20:41:41,826 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.217[s] Speed: 73.8[samples/s]
2022-04-13 20:42:13,738 reid_baseline.train INFO: normal accuracy 0.4868270332187858 2.3600339889526367 
2022-04-13 20:42:13,741 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 20:42:13,741 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 236.0%
2022-04-13 20:42:33,583 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.058, Acc: 0.939, Base Lr: 4.51e-04
2022-04-13 20:42:43,758 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.197[s] Speed: 81.4[samples/s]
2022-04-13 20:43:16,743 reid_baseline.train INFO: normal accuracy 0.4868270332187858 2.365251302719116 
2022-04-13 20:43:16,744 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 20:43:16,744 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 236.5%
2022-04-13 20:43:36,337 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.067, Acc: 0.936, Base Lr: 2.11e-04
2022-04-13 20:43:45,933 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.192[s] Speed: 83.4[samples/s]
2022-04-13 20:44:17,444 reid_baseline.train INFO: normal accuracy 0.4865979381443299 2.35330867767334 
2022-04-13 20:44:17,447 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 20:44:17,447 reid_baseline.train INFO: Accuracy: 48.7% Mean Entropy: 235.3%
2022-04-13 20:44:37,724 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.052, Acc: 0.941, Base Lr: 6.51e-05
2022-04-13 20:44:47,320 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.196[s] Speed: 81.5[samples/s]
2022-04-13 20:45:19,308 reid_baseline.train INFO: normal accuracy 0.4875143184421535 2.3320200443267822 
2022-04-13 20:45:20,500 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 20:45:20,500 reid_baseline.train INFO: Accuracy: 48.8% Mean Entropy: 233.2%
2022-04-13 20:45:41,252 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.031, Acc: 0.954, Base Lr: 1.60e-05
2022-04-13 20:45:52,241 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.209[s] Speed: 76.7[samples/s]
2022-04-13 20:46:24,270 reid_baseline.train INFO: normal accuracy 0.4854524627720504 2.350208044052124 
2022-04-13 20:46:24,272 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 20:46:24,272 reid_baseline.train INFO: Accuracy: 48.5% Mean Entropy: 235.0%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_7/transformer_best_model.pth
2022-04-13 20:46:56,117 reid_baseline.train INFO: normal accuracy 0.4875143184421535 2.3320200443267822 
2022-04-13 20:46:56,117 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 20:46:56,118 reid_baseline.train INFO: Accuracy: 48.8%
2022-04-13 20:47:30,536 reid_baseline.train INFO: normal accuracy 0.35738831615120276 2.293874740600586 
2022-04-13 20:47:30,537 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 20:47:30,537 reid_baseline.train INFO: Shuffled Accuracy: 35.7%
2022-04-13 20:47:49,553 reid_baseline.train INFO: normal accuracy 0.9526163988463123 1.1849567890167236 
2022-04-13 20:47:49,553 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 20:47:49,553 reid_baseline.train INFO: Source Clean Accuracy: 95.3%
2022-04-13 20:47:55,648 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_8
2022-04-13 20:47:55,648 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-13 20:47:55,648 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 20:47:55,648 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 20:47:55,649 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 20:48:06,061 reid_baseline.train INFO: start training
2022-04-13 20:48:27,440 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.121, Acc: 0.198, Base Lr: 8.72e-04
2022-04-13 20:48:40,171 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.223[s] Speed: 71.7[samples/s]
2022-04-13 20:49:12,608 reid_baseline.train INFO: normal accuracy 0.13768613974799543 4.170921802520752 
2022-04-13 20:49:13,899 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 20:49:13,899 reid_baseline.train INFO: Accuracy: 13.8% Mean Entropy: 417.1%
2022-04-13 20:49:35,537 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.853, Acc: 0.378, Base Lr: 1.66e-03
2022-04-13 20:49:45,165 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.206[s] Speed: 77.8[samples/s]
2022-04-13 20:50:19,630 reid_baseline.train INFO: normal accuracy 0.1434135166093929 4.1468634605407715 
2022-04-13 20:50:21,053 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 20:50:21,054 reid_baseline.train INFO: Accuracy: 14.3% Mean Entropy: 414.7%
2022-04-13 20:50:40,267 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.380, Acc: 0.406, Base Lr: 2.46e-03
2022-04-13 20:50:50,485 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.193[s] Speed: 82.7[samples/s]
2022-04-13 20:51:21,573 reid_baseline.train INFO: normal accuracy 0.19564719358533791 4.059294700622559 
2022-04-13 20:51:22,891 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 20:51:22,892 reid_baseline.train INFO: Accuracy: 19.6% Mean Entropy: 405.9%
2022-04-13 20:51:45,555 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.940, Acc: 0.440, Base Lr: 3.25e-03
2022-04-13 20:51:55,498 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.214[s] Speed: 74.7[samples/s]
2022-04-13 20:52:27,659 reid_baseline.train INFO: normal accuracy 0.26872852233676975 3.889601707458496 
2022-04-13 20:52:29,029 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 20:52:29,030 reid_baseline.train INFO: Accuracy: 26.9% Mean Entropy: 389.0%
2022-04-13 20:52:48,813 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.511, Acc: 0.522, Base Lr: 4.04e-03
2022-04-13 20:53:02,093 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.217[s] Speed: 73.7[samples/s]
2022-04-13 20:53:34,824 reid_baseline.train INFO: normal accuracy 0.32806414662084765 3.6818206310272217 
2022-04-13 20:53:36,226 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 20:53:36,227 reid_baseline.train INFO: Accuracy: 32.8% Mean Entropy: 368.2%
2022-04-13 20:53:57,158 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 2.174, Acc: 0.607, Base Lr: 4.83e-03
2022-04-13 20:54:06,817 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.200[s] Speed: 80.0[samples/s]
2022-04-13 20:54:39,832 reid_baseline.train INFO: normal accuracy 0.38258877434135163 3.426375150680542 
2022-04-13 20:54:41,139 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 20:54:41,139 reid_baseline.train INFO: Accuracy: 38.3% Mean Entropy: 342.6%
2022-04-13 20:55:04,569 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.924, Acc: 0.674, Base Lr: 5.62e-03
2022-04-13 20:55:15,684 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.227[s] Speed: 70.5[samples/s]
2022-04-13 20:55:51,797 reid_baseline.train INFO: normal accuracy 0.4048109965635739 3.1465957164764404 
2022-04-13 20:55:53,084 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 20:55:53,084 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 314.7%
2022-04-13 20:56:15,583 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.704, Acc: 0.742, Base Lr: 6.42e-03
2022-04-13 20:56:26,017 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.216[s] Speed: 73.9[samples/s]
2022-04-13 20:56:48,887 reid_baseline.train INFO: normal accuracy 0.4320733104238259 2.9601988792419434 
2022-04-13 20:56:50,252 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 20:56:50,252 reid_baseline.train INFO: Accuracy: 43.2% Mean Entropy: 296.0%
2022-04-13 20:57:09,505 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.575, Acc: 0.776, Base Lr: 7.21e-03
2022-04-13 20:57:19,125 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.189[s] Speed: 84.5[samples/s]
2022-04-13 20:57:48,552 reid_baseline.train INFO: normal accuracy 0.4517754868270332 2.8161582946777344 
2022-04-13 20:57:49,839 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 20:57:49,839 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 281.6%
2022-04-13 20:58:12,837 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.436, Acc: 0.816, Base Lr: 4.01e-03
2022-04-13 20:58:21,793 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.210[s] Speed: 76.2[samples/s]
2022-04-13 20:58:55,020 reid_baseline.train INFO: normal accuracy 0.4579610538373425 2.750462293624878 
2022-04-13 20:58:56,246 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 20:58:56,246 reid_baseline.train INFO: Accuracy: 45.8% Mean Entropy: 275.0%
2022-04-13 20:59:15,111 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.363, Acc: 0.841, Base Lr: 3.38e-03
2022-04-13 20:59:26,781 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.201[s] Speed: 79.7[samples/s]
2022-04-13 20:59:58,934 reid_baseline.train INFO: normal accuracy 0.4579610538373425 2.6349594593048096 
2022-04-13 21:00:00,814 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 21:00:00,815 reid_baseline.train INFO: Accuracy: 45.8% Mean Entropy: 263.5%
2022-04-13 21:00:21,273 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.327, Acc: 0.854, Base Lr: 2.77e-03
2022-04-13 21:00:31,274 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.200[s] Speed: 79.9[samples/s]
2022-04-13 21:01:04,873 reid_baseline.train INFO: normal accuracy 0.4634593356242841 2.6699378490448 
2022-04-13 21:01:04,876 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 21:01:04,876 reid_baseline.train INFO: Accuracy: 46.3% Mean Entropy: 267.0%
2022-04-13 21:01:23,579 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.292, Acc: 0.868, Base Lr: 2.20e-03
2022-04-13 21:01:33,254 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.186[s] Speed: 85.9[samples/s]
2022-04-13 21:02:03,831 reid_baseline.train INFO: normal accuracy 0.4611683848797251 2.6052911281585693 
2022-04-13 21:02:05,488 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 21:02:05,489 reid_baseline.train INFO: Accuracy: 46.1% Mean Entropy: 260.5%
2022-04-13 21:02:28,030 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.268, Acc: 0.870, Base Lr: 1.66e-03
2022-04-13 21:02:39,068 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.221[s] Speed: 72.5[samples/s]
2022-04-13 21:03:11,929 reid_baseline.train INFO: normal accuracy 0.46712485681557847 2.561102867126465 
2022-04-13 21:03:12,842 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 21:03:12,842 reid_baseline.train INFO: Accuracy: 46.7% Mean Entropy: 256.1%
2022-04-13 21:03:32,194 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.248, Acc: 0.881, Base Lr: 1.19e-03
2022-04-13 21:03:42,382 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.194[s] Speed: 82.4[samples/s]
2022-04-13 21:04:14,420 reid_baseline.train INFO: normal accuracy 0.4641466208476518 2.5447707176208496 
2022-04-13 21:04:15,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 21:04:15,687 reid_baseline.train INFO: Accuracy: 46.4% Mean Entropy: 254.5%
2022-04-13 21:04:35,502 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.227, Acc: 0.877, Base Lr: 7.78e-04
2022-04-13 21:04:45,119 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.193[s] Speed: 82.7[samples/s]
2022-04-13 21:05:16,050 reid_baseline.train INFO: normal accuracy 0.4623138602520046 2.5621538162231445 
2022-04-13 21:05:16,052 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 21:05:16,053 reid_baseline.train INFO: Accuracy: 46.2% Mean Entropy: 256.2%
2022-04-13 21:05:37,488 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.210, Acc: 0.899, Base Lr: 4.51e-04
2022-04-13 21:05:47,110 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.203[s] Speed: 78.7[samples/s]
2022-04-13 21:06:18,624 reid_baseline.train INFO: normal accuracy 0.4639175257731959 2.5594067573547363 
2022-04-13 21:06:18,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 21:06:18,625 reid_baseline.train INFO: Accuracy: 46.4% Mean Entropy: 255.9%
2022-04-13 21:06:39,230 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.235, Acc: 0.881, Base Lr: 2.11e-04
2022-04-13 21:06:50,928 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.212[s] Speed: 75.3[samples/s]
2022-04-13 21:07:21,600 reid_baseline.train INFO: normal accuracy 0.4666666666666667 2.566589117050171 
2022-04-13 21:07:21,601 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 21:07:21,601 reid_baseline.train INFO: Accuracy: 46.7% Mean Entropy: 256.7%
2022-04-13 21:07:41,300 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.217, Acc: 0.900, Base Lr: 6.51e-05
2022-04-13 21:07:50,983 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.192[s] Speed: 83.4[samples/s]
2022-04-13 21:08:25,288 reid_baseline.train INFO: normal accuracy 0.46895761741122566 2.5290215015411377 
2022-04-13 21:08:26,553 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 21:08:26,553 reid_baseline.train INFO: Accuracy: 46.9% Mean Entropy: 252.9%
2022-04-13 21:08:47,134 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.195, Acc: 0.898, Base Lr: 1.60e-05
2022-04-13 21:08:57,368 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.202[s] Speed: 79.3[samples/s]
2022-04-13 21:09:31,405 reid_baseline.train INFO: normal accuracy 0.4655211912943872 2.549084424972534 
2022-04-13 21:09:31,408 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 21:09:31,408 reid_baseline.train INFO: Accuracy: 46.6% Mean Entropy: 254.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_8/transformer_best_model.pth
2022-04-13 21:10:04,628 reid_baseline.train INFO: normal accuracy 0.46895761741122566 2.5290215015411377 
2022-04-13 21:10:04,628 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 21:10:04,628 reid_baseline.train INFO: Accuracy: 46.9%
2022-04-13 21:10:36,214 reid_baseline.train INFO: normal accuracy 0.3108820160366552 2.472470760345459 
2022-04-13 21:10:36,214 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 21:10:36,214 reid_baseline.train INFO: Shuffled Accuracy: 31.1%
2022-04-13 21:10:55,972 reid_baseline.train INFO: normal accuracy 0.92336217552534 1.4779305458068848 
2022-04-13 21:10:55,972 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 21:10:55,972 reid_baseline.train INFO: Source Clean Accuracy: 92.3%
2022-04-13 21:11:03,076 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_9
2022-04-13 21:11:03,077 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_9', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=9, dom_cls=False)
2022-04-13 21:11:03,077 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 21:11:03,077 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 21:11:03,077 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_9
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 21:11:22,027 reid_baseline.train INFO: start training
2022-04-13 21:11:42,884 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.122, Acc: 0.206, Base Lr: 8.72e-04
2022-04-13 21:11:52,664 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.200[s] Speed: 80.1[samples/s]
2022-04-13 21:12:21,171 reid_baseline.train INFO: normal accuracy 0.11821305841924398 4.170915603637695 
2022-04-13 21:12:22,350 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 21:12:22,350 reid_baseline.train INFO: Accuracy: 11.8% Mean Entropy: 417.1%
2022-04-13 21:12:44,845 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.856, Acc: 0.347, Base Lr: 1.66e-03
2022-04-13 21:12:53,710 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.206[s] Speed: 77.6[samples/s]
2022-04-13 21:13:25,472 reid_baseline.train INFO: normal accuracy 0.13127147766323025 4.146758079528809 
2022-04-13 21:13:26,693 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 21:13:26,693 reid_baseline.train INFO: Accuracy: 13.1% Mean Entropy: 414.7%
2022-04-13 21:13:47,280 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.402, Acc: 0.392, Base Lr: 2.46e-03
2022-04-13 21:13:58,979 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.212[s] Speed: 75.4[samples/s]
2022-04-13 21:14:29,299 reid_baseline.train INFO: normal accuracy 0.17411225658648338 4.068358898162842 
2022-04-13 21:14:30,473 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 21:14:30,473 reid_baseline.train INFO: Accuracy: 17.4% Mean Entropy: 406.8%
2022-04-13 21:14:50,235 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.988, Acc: 0.407, Base Lr: 3.25e-03
2022-04-13 21:14:59,838 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.193[s] Speed: 82.9[samples/s]
2022-04-13 21:15:31,223 reid_baseline.train INFO: normal accuracy 0.2520045819014891 3.9226624965667725 
2022-04-13 21:15:32,472 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 21:15:32,472 reid_baseline.train INFO: Accuracy: 25.2% Mean Entropy: 392.3%
2022-04-13 21:15:52,917 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.561, Acc: 0.519, Base Lr: 4.04e-03
2022-04-13 21:16:02,549 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.196[s] Speed: 81.5[samples/s]
2022-04-13 21:16:34,279 reid_baseline.train INFO: normal accuracy 0.3026345933562428 3.7252514362335205 
2022-04-13 21:16:35,542 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 21:16:35,542 reid_baseline.train INFO: Accuracy: 30.3% Mean Entropy: 372.5%
2022-04-13 21:16:59,084 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 2.235, Acc: 0.589, Base Lr: 4.83e-03
2022-04-13 21:17:09,569 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.223[s] Speed: 71.9[samples/s]
2022-04-13 21:17:40,562 reid_baseline.train INFO: normal accuracy 0.35097365406643755 3.4988949298858643 
2022-04-13 21:17:41,846 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 21:17:41,846 reid_baseline.train INFO: Accuracy: 35.1% Mean Entropy: 349.9%
2022-04-13 21:18:01,679 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.988, Acc: 0.647, Base Lr: 5.62e-03
2022-04-13 21:18:10,254 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.186[s] Speed: 85.9[samples/s]
2022-04-13 21:18:41,152 reid_baseline.train INFO: normal accuracy 0.38579610538373427 3.236077070236206 
2022-04-13 21:18:45,580 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 21:18:45,580 reid_baseline.train INFO: Accuracy: 38.6% Mean Entropy: 323.6%
2022-04-13 21:19:05,037 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.755, Acc: 0.722, Base Lr: 6.42e-03
2022-04-13 21:19:14,720 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.191[s] Speed: 83.6[samples/s]
2022-04-13 21:19:45,487 reid_baseline.train INFO: normal accuracy 0.41122565864833904 3.037257432937622 
2022-04-13 21:19:46,517 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 21:19:46,517 reid_baseline.train INFO: Accuracy: 41.1% Mean Entropy: 303.7%
2022-04-13 21:20:07,533 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.620, Acc: 0.761, Base Lr: 7.21e-03
2022-04-13 21:20:17,075 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.201[s] Speed: 79.7[samples/s]
2022-04-13 21:20:49,393 reid_baseline.train INFO: normal accuracy 0.42955326460481097 2.88104510307312 
2022-04-13 21:20:50,559 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 21:20:50,560 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 288.1%
2022-04-13 21:21:10,283 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.464, Acc: 0.806, Base Lr: 4.01e-03
2022-04-13 21:21:21,722 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.204[s] Speed: 78.3[samples/s]
2022-04-13 21:21:53,799 reid_baseline.train INFO: normal accuracy 0.44032073310423825 2.8321285247802734 
2022-04-13 21:21:55,583 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 21:21:55,584 reid_baseline.train INFO: Accuracy: 44.0% Mean Entropy: 283.2%
2022-04-13 21:22:14,868 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.391, Acc: 0.832, Base Lr: 3.38e-03
2022-04-13 21:22:24,457 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.190[s] Speed: 84.3[samples/s]
2022-04-13 21:23:01,143 reid_baseline.train INFO: normal accuracy 0.43940435280641466 2.7064108848571777 
2022-04-13 21:23:02,473 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 21:23:02,474 reid_baseline.train INFO: Accuracy: 43.9% Mean Entropy: 270.6%
2022-04-13 21:23:21,993 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.360, Acc: 0.845, Base Lr: 2.77e-03
2022-04-13 21:23:31,705 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.192[s] Speed: 83.3[samples/s]
2022-04-13 21:24:00,256 reid_baseline.train INFO: normal accuracy 0.44123711340206184 2.701078414916992 
2022-04-13 21:24:01,508 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 21:24:01,508 reid_baseline.train INFO: Accuracy: 44.1% Mean Entropy: 270.1%
2022-04-13 21:24:24,132 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.311, Acc: 0.864, Base Lr: 2.20e-03
2022-04-13 21:24:33,585 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.211[s] Speed: 75.9[samples/s]
2022-04-13 21:25:05,320 reid_baseline.train INFO: normal accuracy 0.4449026345933562 2.6800787448883057 
2022-04-13 21:25:06,543 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 21:25:06,544 reid_baseline.train INFO: Accuracy: 44.5% Mean Entropy: 268.0%
2022-04-13 21:25:24,654 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.292, Acc: 0.856, Base Lr: 1.66e-03
2022-04-13 21:25:36,224 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.195[s] Speed: 82.0[samples/s]
2022-04-13 21:26:07,008 reid_baseline.train INFO: normal accuracy 0.44329896907216493 2.642017126083374 
2022-04-13 21:26:08,231 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 21:26:08,231 reid_baseline.train INFO: Accuracy: 44.3% Mean Entropy: 264.2%
2022-04-13 21:26:29,221 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.251, Acc: 0.877, Base Lr: 1.19e-03
2022-04-13 21:26:40,142 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.209[s] Speed: 76.7[samples/s]
2022-04-13 21:27:12,800 reid_baseline.train INFO: normal accuracy 0.44077892325315005 2.6164462566375732 
2022-04-13 21:27:14,371 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 21:27:14,372 reid_baseline.train INFO: Accuracy: 44.1% Mean Entropy: 261.6%
2022-04-13 21:27:34,179 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.230, Acc: 0.885, Base Lr: 7.78e-04
2022-04-13 21:27:41,483 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.176[s] Speed: 90.8[samples/s]
2022-04-13 21:28:11,879 reid_baseline.train INFO: normal accuracy 0.44719358533791526 2.6029176712036133 
2022-04-13 21:28:13,179 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 21:28:13,179 reid_baseline.train INFO: Accuracy: 44.7% Mean Entropy: 260.3%
2022-04-13 21:28:32,956 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.230, Acc: 0.879, Base Lr: 4.51e-04
2022-04-13 21:28:41,943 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.189[s] Speed: 84.7[samples/s]
2022-04-13 21:29:18,512 reid_baseline.train INFO: normal accuracy 0.4437571592210767 2.6218857765197754 
2022-04-13 21:29:18,512 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 21:29:18,513 reid_baseline.train INFO: Accuracy: 44.4% Mean Entropy: 262.2%
2022-04-13 21:29:38,111 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.238, Acc: 0.877, Base Lr: 2.11e-04
2022-04-13 21:29:48,170 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.194[s] Speed: 82.3[samples/s]
2022-04-13 21:30:18,162 reid_baseline.train INFO: normal accuracy 0.44627720504009166 2.6112990379333496 
2022-04-13 21:30:18,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 21:30:18,163 reid_baseline.train INFO: Accuracy: 44.6% Mean Entropy: 261.1%
2022-04-13 21:30:41,436 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.220, Acc: 0.887, Base Lr: 6.51e-05
2022-04-13 21:30:50,851 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.214[s] Speed: 74.9[samples/s]
2022-04-13 21:31:22,958 reid_baseline.train INFO: normal accuracy 0.44627720504009166 2.577115297317505 
2022-04-13 21:31:24,319 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 21:31:24,319 reid_baseline.train INFO: Accuracy: 44.6% Mean Entropy: 257.7%
2022-04-13 21:31:43,346 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.188, Acc: 0.906, Base Lr: 1.60e-05
2022-04-13 21:31:54,010 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.195[s] Speed: 82.0[samples/s]
2022-04-13 21:32:25,999 reid_baseline.train INFO: normal accuracy 0.4437571592210767 2.582963705062866 
2022-04-13 21:32:25,999 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 21:32:26,000 reid_baseline.train INFO: Accuracy: 44.4% Mean Entropy: 258.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_9/transformer_best_model.pth
2022-04-13 21:32:58,295 reid_baseline.train INFO: normal accuracy 0.44627720504009166 2.577115297317505 
2022-04-13 21:32:58,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 21:32:58,295 reid_baseline.train INFO: Accuracy: 44.6%
2022-04-13 21:33:28,006 reid_baseline.train INFO: normal accuracy 0.29851088201603665 2.5019750595092773 
2022-04-13 21:33:28,011 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 21:33:28,012 reid_baseline.train INFO: Shuffled Accuracy: 29.9%
2022-04-13 21:33:48,620 reid_baseline.train INFO: normal accuracy 0.9245982694684796 1.5061635971069336 
2022-04-13 21:33:48,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 21:33:48,621 reid_baseline.train INFO: Source Clean Accuracy: 92.5%
2022-04-13 21:33:55,138 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_10
2022-04-13 21:33:55,138 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_10', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=10, dom_cls=False)
2022-04-13 21:33:55,138 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 21:33:55,138 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 21:33:55,139 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_10
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 21:34:03,432 reid_baseline.train INFO: start training
2022-04-13 21:34:24,191 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.127, Acc: 0.166, Base Lr: 8.72e-04
2022-04-13 21:34:33,306 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.195[s] Speed: 82.0[samples/s]
2022-04-13 21:35:06,196 reid_baseline.train INFO: normal accuracy 0.09049255441008018 4.1700873374938965 
2022-04-13 21:35:07,699 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 21:35:07,699 reid_baseline.train INFO: Accuracy: 9.0% Mean Entropy: 417.0%
2022-04-13 21:35:27,962 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.887, Acc: 0.296, Base Lr: 1.66e-03
2022-04-13 21:35:37,815 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.198[s] Speed: 80.8[samples/s]
2022-04-13 21:36:06,169 reid_baseline.train INFO: normal accuracy 0.08751431844215349 4.140716552734375 
2022-04-13 21:36:07,583 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 21:36:07,584 reid_baseline.train INFO: Accuracy: 8.8% Mean Entropy: 414.1%
2022-04-13 21:36:31,724 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.481, Acc: 0.316, Base Lr: 2.46e-03
2022-04-13 21:36:41,355 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.220[s] Speed: 72.8[samples/s]
2022-04-13 21:37:13,620 reid_baseline.train INFO: normal accuracy 0.11867124856815578 4.0641608238220215 
2022-04-13 21:37:14,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 21:37:14,938 reid_baseline.train INFO: Accuracy: 11.9% Mean Entropy: 406.4%
2022-04-13 21:37:37,830 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 3.116, Acc: 0.367, Base Lr: 3.25e-03
2022-04-13 21:37:49,043 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.224[s] Speed: 71.4[samples/s]
2022-04-13 21:38:19,316 reid_baseline.train INFO: normal accuracy 0.1734249713631157 3.948582172393799 
2022-04-13 21:38:20,413 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 21:38:20,414 reid_baseline.train INFO: Accuracy: 17.3% Mean Entropy: 394.9%
2022-04-13 21:38:40,536 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 2.739, Acc: 0.459, Base Lr: 4.04e-03
2022-04-13 21:38:49,283 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.190[s] Speed: 84.3[samples/s]
2022-04-13 21:39:24,032 reid_baseline.train INFO: normal accuracy 0.21741122565864834 3.810516119003296 
2022-04-13 21:39:26,274 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 21:39:26,274 reid_baseline.train INFO: Accuracy: 21.7% Mean Entropy: 381.1%
2022-04-13 21:39:46,537 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 2.435, Acc: 0.514, Base Lr: 4.83e-03
2022-04-13 21:39:56,102 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.196[s] Speed: 81.6[samples/s]
2022-04-13 21:40:23,819 reid_baseline.train INFO: normal accuracy 0.2804123711340206 3.6511380672454834 
2022-04-13 21:40:25,225 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 21:40:25,225 reid_baseline.train INFO: Accuracy: 28.0% Mean Entropy: 365.1%
2022-04-13 21:40:47,804 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 2.174, Acc: 0.595, Base Lr: 5.62e-03
2022-04-13 21:40:56,666 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.206[s] Speed: 77.5[samples/s]
2022-04-13 21:41:28,978 reid_baseline.train INFO: normal accuracy 0.33012600229095074 3.4369254112243652 
2022-04-13 21:41:30,225 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 21:41:30,225 reid_baseline.train INFO: Accuracy: 33.0% Mean Entropy: 343.7%
2022-04-13 21:41:48,473 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.945, Acc: 0.672, Base Lr: 6.42e-03
2022-04-13 21:41:59,409 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.192[s] Speed: 83.4[samples/s]
2022-04-13 21:42:30,437 reid_baseline.train INFO: normal accuracy 0.3633447880870561 3.212390661239624 
2022-04-13 21:42:31,748 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 21:42:31,749 reid_baseline.train INFO: Accuracy: 36.3% Mean Entropy: 321.2%
2022-04-13 21:42:51,566 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.784, Acc: 0.706, Base Lr: 7.21e-03
2022-04-13 21:43:01,316 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.194[s] Speed: 82.4[samples/s]
2022-04-13 21:43:33,269 reid_baseline.train INFO: normal accuracy 0.3757159221076747 3.0558719635009766 
2022-04-13 21:43:34,640 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 21:43:34,640 reid_baseline.train INFO: Accuracy: 37.6% Mean Entropy: 305.6%
2022-04-13 21:43:54,946 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.617, Acc: 0.771, Base Lr: 4.01e-03
2022-04-13 21:44:04,575 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.194[s] Speed: 82.4[samples/s]
2022-04-13 21:44:36,693 reid_baseline.train INFO: normal accuracy 0.38854524627720505 2.9932119846343994 
2022-04-13 21:44:37,915 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 21:44:37,916 reid_baseline.train INFO: Accuracy: 38.9% Mean Entropy: 299.3%
2022-04-13 21:45:01,985 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.554, Acc: 0.777, Base Lr: 3.38e-03
2022-04-13 21:45:12,696 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.229[s] Speed: 70.0[samples/s]
2022-04-13 21:45:44,848 reid_baseline.train INFO: normal accuracy 0.3942726231386025 2.874099016189575 
2022-04-13 21:45:46,106 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 21:45:46,106 reid_baseline.train INFO: Accuracy: 39.4% Mean Entropy: 287.4%
2022-04-13 21:46:07,416 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.502, Acc: 0.794, Base Lr: 2.77e-03
2022-04-13 21:46:18,642 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.214[s] Speed: 74.9[samples/s]
2022-04-13 21:46:49,318 reid_baseline.train INFO: normal accuracy 0.3993127147766323 2.8795487880706787 
2022-04-13 21:46:49,318 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 21:46:49,318 reid_baseline.train INFO: Accuracy: 39.9% Mean Entropy: 288.0%
2022-04-13 21:47:09,710 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.459, Acc: 0.818, Base Lr: 2.20e-03
2022-04-13 21:47:19,276 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.197[s] Speed: 81.3[samples/s]
2022-04-13 21:47:52,501 reid_baseline.train INFO: normal accuracy 0.4038946162657503 2.837449550628662 
2022-04-13 21:47:53,718 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 21:47:53,718 reid_baseline.train INFO: Accuracy: 40.4% Mean Entropy: 283.7%
2022-04-13 21:48:12,896 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.432, Acc: 0.814, Base Lr: 1.66e-03
2022-04-13 21:48:22,467 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.188[s] Speed: 84.9[samples/s]
2022-04-13 21:48:52,216 reid_baseline.train INFO: normal accuracy 0.40756013745704467 2.795872211456299 
2022-04-13 21:48:53,326 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 21:48:53,327 reid_baseline.train INFO: Accuracy: 40.8% Mean Entropy: 279.6%
2022-04-13 21:49:15,547 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.402, Acc: 0.831, Base Lr: 1.19e-03
2022-04-13 21:49:24,532 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.205[s] Speed: 78.0[samples/s]
2022-04-13 21:49:56,500 reid_baseline.train INFO: normal accuracy 0.4020618556701031 2.764711380004883 
2022-04-13 21:49:57,813 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 21:49:57,813 reid_baseline.train INFO: Accuracy: 40.2% Mean Entropy: 276.5%
2022-04-13 21:50:17,758 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.381, Acc: 0.839, Base Lr: 7.78e-04
2022-04-13 21:50:30,184 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.213[s] Speed: 75.2[samples/s]
2022-04-13 21:51:04,209 reid_baseline.train INFO: normal accuracy 0.41122565864833904 2.7573652267456055 
2022-04-13 21:51:05,124 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 21:51:05,124 reid_baseline.train INFO: Accuracy: 41.1% Mean Entropy: 275.7%
2022-04-13 21:51:24,663 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.354, Acc: 0.855, Base Lr: 4.51e-04
2022-04-13 21:51:34,029 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.190[s] Speed: 84.2[samples/s]
2022-04-13 21:52:10,041 reid_baseline.train INFO: normal accuracy 0.406872852233677 2.7643537521362305 
2022-04-13 21:52:10,042 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 21:52:10,042 reid_baseline.train INFO: Accuracy: 40.7% Mean Entropy: 276.4%
2022-04-13 21:52:29,468 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.378, Acc: 0.839, Base Lr: 2.11e-04
2022-04-13 21:52:39,063 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.191[s] Speed: 84.0[samples/s]
2022-04-13 21:53:08,199 reid_baseline.train INFO: normal accuracy 0.41099656357388314 2.7807886600494385 
2022-04-13 21:53:08,201 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 21:53:08,202 reid_baseline.train INFO: Accuracy: 41.1% Mean Entropy: 278.1%
2022-04-13 21:53:31,063 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.364, Acc: 0.836, Base Lr: 6.51e-05
2022-04-13 21:53:40,791 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.214[s] Speed: 74.8[samples/s]
2022-04-13 21:54:13,220 reid_baseline.train INFO: normal accuracy 0.41328751431844213 2.7370193004608154 
2022-04-13 21:54:14,264 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 21:54:14,264 reid_baseline.train INFO: Accuracy: 41.3% Mean Entropy: 273.7%
2022-04-13 21:54:32,306 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.349, Acc: 0.851, Base Lr: 1.60e-05
2022-04-13 21:54:43,338 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.191[s] Speed: 83.7[samples/s]
2022-04-13 21:55:17,357 reid_baseline.train INFO: normal accuracy 0.4061855670103093 2.738948106765747 
2022-04-13 21:55:17,358 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 21:55:17,358 reid_baseline.train INFO: Accuracy: 40.6% Mean Entropy: 273.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_2_10/transformer_best_model.pth
2022-04-13 21:55:49,858 reid_baseline.train INFO: normal accuracy 0.41328751431844213 2.7370193004608154 
2022-04-13 21:55:49,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 21:55:49,859 reid_baseline.train INFO: Accuracy: 41.3%
2022-04-13 21:56:19,130 reid_baseline.train INFO: normal accuracy 0.2558991981672394 2.634634017944336 
2022-04-13 21:56:19,130 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 21:56:19,131 reid_baseline.train INFO: Shuffled Accuracy: 25.6%
2022-04-13 21:56:36,629 reid_baseline.train INFO: normal accuracy 0.8908117016893284 1.8335280418395996 
2022-04-13 21:56:36,630 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 21:56:36,631 reid_baseline.train INFO: Source Clean Accuracy: 89.1%
