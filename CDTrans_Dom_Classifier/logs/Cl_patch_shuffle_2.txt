2022-04-13 16:23:11,501 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_2
2022-04-13 16:23:11,501 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2)
2022-04-13 16:23:11,501 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 16:23:11,501 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 16:23:11,502 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 16:23:24,925 reid_baseline.train INFO: start training
2022-04-13 16:23:49,861 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.100, Acc: 0.284, Base Lr: 8.72e-04
2022-04-13 16:24:09,112 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.018, Acc: 0.355, Base Lr: 8.72e-04
2022-04-13 16:24:22,727 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.211[s] Speed: 75.8[samples/s]
2022-04-13 16:24:55,541 reid_baseline.train INFO: normal accuracy 0.44041450777202074 4.16038179397583 
2022-04-13 16:24:56,776 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 16:24:56,777 reid_baseline.train INFO: Accuracy: 44.0% Mean Entropy: 416.0%
2022-04-13 16:25:15,691 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.547, Acc: 0.504, Base Lr: 1.66e-03
2022-04-13 16:25:34,581 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.395, Acc: 0.503, Base Lr: 1.66e-03
2022-04-13 16:25:51,558 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.201[s] Speed: 79.7[samples/s]
2022-04-13 16:26:21,240 reid_baseline.train INFO: normal accuracy 0.496057670646542 3.967172145843506 
2022-04-13 16:26:22,617 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 16:26:22,617 reid_baseline.train INFO: Accuracy: 49.6% Mean Entropy: 396.7%
2022-04-13 16:26:41,627 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.682, Acc: 0.576, Base Lr: 2.46e-03
2022-04-13 16:27:03,221 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.561, Acc: 0.591, Base Lr: 2.46e-03
2022-04-13 16:27:16,120 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.196[s] Speed: 81.8[samples/s]
2022-04-13 16:27:46,457 reid_baseline.train INFO: normal accuracy 0.631448524442442 3.3671796321868896 
2022-04-13 16:27:47,671 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 16:27:47,672 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 336.7%
2022-04-13 16:28:10,373 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.064, Acc: 0.670, Base Lr: 3.25e-03
2022-04-13 16:28:27,744 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.996, Acc: 0.679, Base Lr: 3.25e-03
2022-04-13 16:28:41,198 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.196[s] Speed: 81.7[samples/s]
2022-04-13 16:29:16,499 reid_baseline.train INFO: normal accuracy 0.7030862806938499 2.8270182609558105 
2022-04-13 16:29:17,719 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 16:29:17,720 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 282.7%
2022-04-13 16:29:36,926 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.670, Acc: 0.755, Base Lr: 4.04e-03
2022-04-13 16:29:56,147 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.658, Acc: 0.752, Base Lr: 4.04e-03
2022-04-13 16:30:13,409 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.204[s] Speed: 78.5[samples/s]
2022-04-13 16:30:43,584 reid_baseline.train INFO: normal accuracy 0.7359765712998423 2.4132583141326904 
2022-04-13 16:30:44,862 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 16:30:44,862 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 241.3%
2022-04-13 16:31:04,940 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.450, Acc: 0.808, Base Lr: 4.83e-03
2022-04-13 16:31:24,700 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.448, Acc: 0.812, Base Lr: 4.83e-03
2022-04-13 16:31:38,115 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.194[s] Speed: 82.3[samples/s]
2022-04-13 16:32:09,760 reid_baseline.train INFO: normal accuracy 0.7443117819328677 2.220135450363159 
2022-04-13 16:32:10,901 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 16:32:10,902 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 222.0%
2022-04-13 16:32:31,276 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.347, Acc: 0.842, Base Lr: 5.62e-03
2022-04-13 16:32:49,733 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.319, Acc: 0.848, Base Lr: 5.62e-03
2022-04-13 16:33:01,545 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.185[s] Speed: 86.6[samples/s]
2022-04-13 16:33:36,202 reid_baseline.train INFO: normal accuracy 0.7485920252309078 2.048872709274292 
2022-04-13 16:33:37,426 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 16:33:37,427 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 204.9%
2022-04-13 16:33:56,948 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.232, Acc: 0.875, Base Lr: 6.42e-03
2022-04-13 16:34:15,869 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.231, Acc: 0.873, Base Lr: 6.42e-03
2022-04-13 16:34:31,450 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.198[s] Speed: 80.9[samples/s]
2022-04-13 16:35:03,837 reid_baseline.train INFO: normal accuracy 0.7632349628294661 1.9630873203277588 
2022-04-13 16:35:05,090 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 16:35:05,090 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 196.3%
2022-04-13 16:35:26,857 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.134, Acc: 0.898, Base Lr: 7.21e-03
2022-04-13 16:35:46,514 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.157, Acc: 0.888, Base Lr: 7.21e-03
2022-04-13 16:36:00,036 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.201[s] Speed: 79.5[samples/s]
2022-04-13 16:36:32,510 reid_baseline.train INFO: normal accuracy 0.759855823383645 1.9158962965011597 
2022-04-13 16:36:33,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 16:36:33,851 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 191.6%
2022-04-13 16:36:53,728 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.077, Acc: 0.918, Base Lr: 4.01e-03
2022-04-13 16:37:11,411 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.074, Acc: 0.922, Base Lr: 4.01e-03
2022-04-13 16:37:26,584 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.193[s] Speed: 82.9[samples/s]
2022-04-13 16:37:59,159 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.901491403579712 
2022-04-13 16:38:01,072 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 16:38:01,072 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 190.1%
2022-04-13 16:38:20,764 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.054, Acc: 0.928, Base Lr: 3.38e-03
2022-04-13 16:38:42,346 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.042, Acc: 0.932, Base Lr: 3.38e-03
2022-04-13 16:38:55,796 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.200[s] Speed: 79.9[samples/s]
2022-04-13 16:39:24,348 reid_baseline.train INFO: normal accuracy 0.7756251407974769 1.856911063194275 
2022-04-13 16:39:26,178 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 16:39:26,179 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 185.7%
2022-04-13 16:39:52,205 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.020, Acc: 0.935, Base Lr: 2.77e-03
2022-04-13 16:40:12,881 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.022, Acc: 0.934, Base Lr: 2.77e-03
2022-04-13 16:40:27,167 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.223[s] Speed: 71.7[samples/s]
2022-04-13 16:41:01,392 reid_baseline.train INFO: normal accuracy 0.772020725388601 1.9184527397155762 
2022-04-13 16:41:01,392 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 16:41:01,393 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 191.8%
2022-04-13 16:41:22,809 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 0.991, Acc: 0.949, Base Lr: 2.20e-03
2022-04-13 16:41:44,867 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 0.990, Acc: 0.945, Base Lr: 2.20e-03
2022-04-13 16:41:59,895 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.214[s] Speed: 74.8[samples/s]
2022-04-13 16:42:31,484 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.882104516029358 
2022-04-13 16:42:31,485 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 16:42:31,486 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 188.2%
2022-04-13 16:42:54,494 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 0.979, Acc: 0.951, Base Lr: 1.66e-03
2022-04-13 16:43:14,387 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 0.979, Acc: 0.945, Base Lr: 1.66e-03
2022-04-13 16:43:28,469 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.209[s] Speed: 76.7[samples/s]
2022-04-13 16:44:02,392 reid_baseline.train INFO: normal accuracy 0.7699932417211084 1.8901642560958862 
2022-04-13 16:44:02,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 16:44:02,395 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 189.0%
2022-04-13 16:44:26,653 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 0.957, Acc: 0.954, Base Lr: 1.19e-03
2022-04-13 16:44:48,998 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 0.966, Acc: 0.953, Base Lr: 1.19e-03
2022-04-13 16:45:06,890 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.236[s] Speed: 67.8[samples/s]
2022-04-13 16:45:38,450 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.8406846523284912 
2022-04-13 16:45:39,732 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 16:45:39,733 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 184.1%
2022-04-13 16:45:55,473 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 0.970, Acc: 0.951, Base Lr: 7.78e-04
2022-04-13 16:46:13,702 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 0.969, Acc: 0.949, Base Lr: 7.78e-04
2022-04-13 16:46:27,251 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.174[s] Speed: 92.0[samples/s]
2022-04-13 16:47:03,684 reid_baseline.train INFO: normal accuracy 0.7756251407974769 1.8503270149230957 
2022-04-13 16:47:03,685 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 16:47:03,686 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 185.0%
2022-04-13 16:47:24,357 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 0.963, Acc: 0.952, Base Lr: 4.51e-04
2022-04-13 16:47:42,749 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 0.957, Acc: 0.957, Base Lr: 4.51e-04
2022-04-13 16:47:59,060 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.203[s] Speed: 79.0[samples/s]
2022-04-13 16:48:29,186 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.822424054145813 
2022-04-13 16:48:31,571 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 16:48:31,571 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 182.2%
2022-04-13 16:48:52,306 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 0.954, Acc: 0.952, Base Lr: 2.11e-04
2022-04-13 16:49:14,408 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 0.946, Acc: 0.956, Base Lr: 2.11e-04
2022-04-13 16:49:28,503 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.208[s] Speed: 76.8[samples/s]
2022-04-13 16:49:58,393 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.8616656064987183 
2022-04-13 16:49:58,395 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 16:49:58,396 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 186.2%
2022-04-13 16:50:21,155 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 0.962, Acc: 0.953, Base Lr: 6.51e-05
2022-04-13 16:50:41,041 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 0.957, Acc: 0.957, Base Lr: 6.51e-05
2022-04-13 16:50:55,644 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.209[s] Speed: 76.4[samples/s]
2022-04-13 16:51:29,225 reid_baseline.train INFO: normal accuracy 0.7751745888713675 1.8434399366378784 
2022-04-13 16:51:29,227 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 16:51:29,227 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 184.3%
2022-04-13 16:51:48,756 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 0.955, Acc: 0.950, Base Lr: 1.60e-05
2022-04-13 16:52:08,255 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 0.954, Acc: 0.954, Base Lr: 1.60e-05
2022-04-13 16:52:23,983 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.200[s] Speed: 79.8[samples/s]
2022-04-13 16:52:57,263 reid_baseline.train INFO: normal accuracy 0.7760756927235863 1.8741731643676758 
2022-04-13 16:52:57,264 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 16:52:57,265 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 187.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_2/transformer_best_model.pth
2022-04-13 16:53:31,727 reid_baseline.train INFO: normal accuracy 0.7765262446496959 1.822424054145813 
2022-04-13 16:53:31,728 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 16:53:31,728 reid_baseline.train INFO: Accuracy: 77.7%
2022-04-13 16:54:00,770 reid_baseline.train INFO: normal accuracy 0.7517458887136742 1.857024908065796 
2022-04-13 16:54:00,771 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 16:54:00,771 reid_baseline.train INFO: Shuffled Accuracy: 75.2%
2022-04-13 16:54:31,509 reid_baseline.train INFO: normal accuracy 0.9693012600229095 0.7730989456176758 
2022-04-13 16:54:31,509 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 16:54:31,509 reid_baseline.train INFO: Source Clean Accuracy: 96.9%
2022-04-13 16:54:41,169 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_3
2022-04-13 16:54:41,170 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3)
2022-04-13 16:54:41,170 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 16:54:41,170 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 16:54:41,171 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 16:54:56,282 reid_baseline.train INFO: start training
2022-04-13 16:55:17,634 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.105, Acc: 0.238, Base Lr: 8.72e-04
2022-04-13 16:55:41,588 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.027, Acc: 0.303, Base Lr: 8.72e-04
2022-04-13 16:55:55,438 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.216[s] Speed: 74.1[samples/s]
2022-04-13 16:56:24,816 reid_baseline.train INFO: normal accuracy 0.3282270781707592 4.159948348999023 
2022-04-13 16:56:25,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 16:56:25,933 reid_baseline.train INFO: Accuracy: 32.8% Mean Entropy: 416.0%
2022-04-13 16:56:48,699 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.597, Acc: 0.452, Base Lr: 1.66e-03
2022-04-13 16:57:08,560 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.459, Acc: 0.445, Base Lr: 1.66e-03
2022-04-13 16:57:22,113 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.206[s] Speed: 77.8[samples/s]
2022-04-13 16:57:57,236 reid_baseline.train INFO: normal accuracy 0.4050461815724262 3.981956720352173 
2022-04-13 16:57:58,696 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 16:57:58,697 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 398.2%
2022-04-13 16:58:17,395 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.808, Acc: 0.517, Base Lr: 2.46e-03
2022-04-13 16:58:36,552 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.708, Acc: 0.529, Base Lr: 2.46e-03
2022-04-13 16:58:52,347 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.196[s] Speed: 81.5[samples/s]
2022-04-13 16:59:22,539 reid_baseline.train INFO: normal accuracy 0.5805361567920703 3.4818739891052246 
2022-04-13 16:59:23,916 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 16:59:23,916 reid_baseline.train INFO: Accuracy: 58.1% Mean Entropy: 348.2%
2022-04-13 16:59:46,275 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.237, Acc: 0.601, Base Lr: 3.25e-03
2022-04-13 17:00:08,078 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.175, Acc: 0.617, Base Lr: 3.25e-03
2022-04-13 17:00:20,990 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.209[s] Speed: 76.6[samples/s]
2022-04-13 17:00:49,475 reid_baseline.train INFO: normal accuracy 0.673349853570624 2.9995603561401367 
2022-04-13 17:00:50,846 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 17:00:50,846 reid_baseline.train INFO: Accuracy: 67.3% Mean Entropy: 300.0%
2022-04-13 17:01:13,004 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.864, Acc: 0.692, Base Lr: 4.04e-03
2022-04-13 17:01:31,511 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.836, Acc: 0.699, Base Lr: 4.04e-03
2022-04-13 17:01:44,374 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.196[s] Speed: 81.8[samples/s]
2022-04-13 17:02:19,917 reid_baseline.train INFO: normal accuracy 0.716152286551025 2.622426986694336 
2022-04-13 17:02:21,224 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 17:02:21,224 reid_baseline.train INFO: Accuracy: 71.6% Mean Entropy: 262.2%
2022-04-13 17:02:41,435 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.618, Acc: 0.760, Base Lr: 4.83e-03
2022-04-13 17:03:04,201 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.608, Acc: 0.762, Base Lr: 4.83e-03
2022-04-13 17:03:21,154 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.219[s] Speed: 72.9[samples/s]
2022-04-13 17:03:52,914 reid_baseline.train INFO: normal accuracy 0.7314710520387475 2.397707939147949 
2022-04-13 17:03:54,257 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 17:03:54,258 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 239.8%
2022-04-13 17:04:21,602 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.482, Acc: 0.802, Base Lr: 5.62e-03
2022-04-13 17:04:41,257 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.458, Acc: 0.801, Base Lr: 5.62e-03
2022-04-13 17:04:55,333 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.224[s] Speed: 71.5[samples/s]
2022-04-13 17:05:32,443 reid_baseline.train INFO: normal accuracy 0.7330479837801307 2.176547050476074 
2022-04-13 17:05:33,913 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 17:05:33,913 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 217.7%
2022-04-13 17:05:56,317 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.350, Acc: 0.831, Base Lr: 6.42e-03
2022-04-13 17:06:17,767 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.360, Acc: 0.826, Base Lr: 6.42e-03
2022-04-13 17:06:33,831 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.219[s] Speed: 73.0[samples/s]
2022-04-13 17:07:05,647 reid_baseline.train INFO: normal accuracy 0.7429601261545393 2.1329569816589355 
2022-04-13 17:07:06,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 17:07:06,730 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 213.3%
2022-04-13 17:07:26,253 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.230, Acc: 0.872, Base Lr: 7.21e-03
2022-04-13 17:07:46,774 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.254, Acc: 0.864, Base Lr: 7.21e-03
2022-04-13 17:08:02,508 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.204[s] Speed: 78.4[samples/s]
2022-04-13 17:08:37,893 reid_baseline.train INFO: normal accuracy 0.7413831944131561 2.0802671909332275 
2022-04-13 17:08:39,189 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 17:08:39,190 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 208.0%
2022-04-13 17:09:01,304 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.164, Acc: 0.891, Base Lr: 4.01e-03
2022-04-13 17:09:20,687 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.172, Acc: 0.891, Base Lr: 4.01e-03
2022-04-13 17:09:31,987 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.193[s] Speed: 82.8[samples/s]
2022-04-13 17:10:06,292 reid_baseline.train INFO: normal accuracy 0.7483667492678531 2.042419195175171 
2022-04-13 17:10:08,346 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 17:10:08,346 reid_baseline.train INFO: Accuracy: 74.8% Mean Entropy: 204.2%
2022-04-13 17:10:30,495 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.150, Acc: 0.890, Base Lr: 3.38e-03
2022-04-13 17:10:49,043 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.139, Acc: 0.899, Base Lr: 3.38e-03
2022-04-13 17:11:02,928 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.200[s] Speed: 80.1[samples/s]
2022-04-13 17:11:35,689 reid_baseline.train INFO: normal accuracy 0.7555755800856049 2.0388522148132324 
2022-04-13 17:11:37,264 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 17:11:37,264 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 203.9%
2022-04-13 17:12:00,133 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.101, Acc: 0.907, Base Lr: 2.77e-03
2022-04-13 17:12:18,544 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.107, Acc: 0.909, Base Lr: 2.77e-03
2022-04-13 17:12:35,775 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.214[s] Speed: 74.7[samples/s]
2022-04-13 17:13:07,787 reid_baseline.train INFO: normal accuracy 0.7591799954944808 2.0190300941467285 
2022-04-13 17:13:09,480 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 17:13:09,480 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 201.9%
2022-04-13 17:13:30,896 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.061, Acc: 0.929, Base Lr: 2.20e-03
2022-04-13 17:13:52,378 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.071, Acc: 0.922, Base Lr: 2.20e-03
2022-04-13 17:14:05,623 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.205[s] Speed: 77.9[samples/s]
2022-04-13 17:14:34,695 reid_baseline.train INFO: normal accuracy 0.7564766839378239 1.9782099723815918 
2022-04-13 17:14:36,484 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 17:14:36,485 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 197.8%
2022-04-13 17:15:01,766 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.060, Acc: 0.924, Base Lr: 1.66e-03
2022-04-13 17:15:20,860 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.060, Acc: 0.921, Base Lr: 1.66e-03
2022-04-13 17:15:33,944 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.210[s] Speed: 76.2[samples/s]
2022-04-13 17:16:09,113 reid_baseline.train INFO: normal accuracy 0.7591799954944808 1.9792226552963257 
2022-04-13 17:16:09,113 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 17:16:09,114 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 197.9%
2022-04-13 17:16:28,939 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.020, Acc: 0.939, Base Lr: 1.19e-03
2022-04-13 17:16:47,222 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.037, Acc: 0.935, Base Lr: 1.19e-03
2022-04-13 17:17:03,476 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.199[s] Speed: 80.5[samples/s]
2022-04-13 17:17:32,626 reid_baseline.train INFO: normal accuracy 0.7551250281594953 1.9964351654052734 
2022-04-13 17:17:32,628 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 17:17:32,628 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 199.6%
2022-04-13 17:17:57,231 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.050, Acc: 0.931, Base Lr: 7.78e-04
2022-04-13 17:18:18,806 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.037, Acc: 0.932, Base Lr: 7.78e-04
2022-04-13 17:18:32,291 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.218[s] Speed: 73.5[samples/s]
2022-04-13 17:19:02,005 reid_baseline.train INFO: normal accuracy 0.7560261320117143 1.9960222244262695 
2022-04-13 17:19:02,007 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 17:19:02,008 reid_baseline.train INFO: Accuracy: 75.6% Mean Entropy: 199.6%
2022-04-13 17:19:27,452 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.028, Acc: 0.934, Base Lr: 4.51e-04
2022-04-13 17:19:48,021 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.024, Acc: 0.935, Base Lr: 4.51e-04
2022-04-13 17:20:03,344 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.224[s] Speed: 71.3[samples/s]
2022-04-13 17:20:40,347 reid_baseline.train INFO: normal accuracy 0.7616580310880829 1.9509799480438232 
2022-04-13 17:20:41,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 17:20:41,793 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 195.1%
2022-04-13 17:21:02,523 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.029, Acc: 0.929, Base Lr: 2.11e-04
2022-04-13 17:21:22,299 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.015, Acc: 0.940, Base Lr: 2.11e-04
2022-04-13 17:21:39,625 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.212[s] Speed: 75.6[samples/s]
2022-04-13 17:22:10,493 reid_baseline.train INFO: normal accuracy 0.7614327551250282 2.0003910064697266 
2022-04-13 17:22:10,493 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 17:22:10,493 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 200.0%
2022-04-13 17:22:31,833 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.037, Acc: 0.932, Base Lr: 6.51e-05
2022-04-13 17:22:55,514 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.027, Acc: 0.937, Base Lr: 6.51e-05
2022-04-13 17:23:09,741 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.217[s] Speed: 73.8[samples/s]
2022-04-13 17:23:41,292 reid_baseline.train INFO: normal accuracy 0.7596305474205902 1.9614522457122803 
2022-04-13 17:23:41,296 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 17:23:41,297 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 196.1%
2022-04-13 17:24:02,787 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.024, Acc: 0.940, Base Lr: 1.60e-05
2022-04-13 17:24:22,135 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.018, Acc: 0.940, Base Lr: 1.60e-05
2022-04-13 17:24:34,839 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.195[s] Speed: 81.8[samples/s]
2022-04-13 17:25:07,732 reid_baseline.train INFO: normal accuracy 0.7605316512728092 2.020833969116211 
2022-04-13 17:25:07,735 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 17:25:07,735 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 202.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_3/transformer_best_model.pth
2022-04-13 17:25:38,915 reid_baseline.train INFO: normal accuracy 0.7616580310880829 1.9509799480438232 
2022-04-13 17:25:38,915 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:25:38,915 reid_baseline.train INFO: Accuracy: 76.2%
2022-04-13 17:26:11,491 reid_baseline.train INFO: normal accuracy 0.7172786663662987 1.9812384843826294 
2022-04-13 17:26:11,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:26:11,491 reid_baseline.train INFO: Shuffled Accuracy: 71.7%
2022-04-13 17:26:40,707 reid_baseline.train INFO: normal accuracy 0.9509736540664375 0.9134125709533691 
2022-04-13 17:26:40,708 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:26:40,708 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
2022-04-13 17:26:48,023 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_4
2022-04-13 17:26:48,024 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4)
2022-04-13 17:26:48,024 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 17:26:48,024 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 17:26:48,024 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 17:27:10,494 reid_baseline.train INFO: start training
2022-04-13 17:27:32,739 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.107, Acc: 0.222, Base Lr: 8.72e-04
2022-04-13 17:27:51,304 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.032, Acc: 0.276, Base Lr: 8.72e-04
2022-04-13 17:28:08,344 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.209[s] Speed: 76.6[samples/s]
2022-04-13 17:28:38,135 reid_baseline.train INFO: normal accuracy 0.23924307276413606 4.1605048179626465 
2022-04-13 17:28:39,894 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 17:28:39,895 reid_baseline.train INFO: Accuracy: 23.9% Mean Entropy: 416.1%
2022-04-13 17:29:03,398 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.612, Acc: 0.422, Base Lr: 1.66e-03
2022-04-13 17:29:25,204 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.484, Acc: 0.414, Base Lr: 1.66e-03
2022-04-13 17:29:38,809 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.216[s] Speed: 74.2[samples/s]
2022-04-13 17:30:07,075 reid_baseline.train INFO: normal accuracy 0.30975444920027034 4.0015692710876465 
2022-04-13 17:30:08,988 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 17:30:08,989 reid_baseline.train INFO: Accuracy: 31.0% Mean Entropy: 400.2%
2022-04-13 17:30:32,655 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.881, Acc: 0.486, Base Lr: 2.46e-03
2022-04-13 17:30:51,945 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.784, Acc: 0.492, Base Lr: 2.46e-03
2022-04-13 17:31:07,699 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.215[s] Speed: 74.5[samples/s]
2022-04-13 17:31:42,330 reid_baseline.train INFO: normal accuracy 0.49222797927461137 3.60296368598938 
2022-04-13 17:31:45,537 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 17:31:45,538 reid_baseline.train INFO: Accuracy: 49.2% Mean Entropy: 360.3%
2022-04-13 17:32:11,631 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.355, Acc: 0.571, Base Lr: 3.25e-03
2022-04-13 17:32:33,185 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.293, Acc: 0.584, Base Lr: 3.25e-03
2022-04-13 17:32:48,040 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.229[s] Speed: 70.0[samples/s]
2022-04-13 17:33:13,822 reid_baseline.train INFO: normal accuracy 0.6305474205902231 3.212050437927246 
2022-04-13 17:33:15,151 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 17:33:15,152 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 321.2%
2022-04-13 17:33:33,124 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.980, Acc: 0.666, Base Lr: 4.04e-03
2022-04-13 17:33:52,239 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.953, Acc: 0.669, Base Lr: 4.04e-03
2022-04-13 17:34:08,995 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.197[s] Speed: 81.4[samples/s]
2022-04-13 17:34:41,177 reid_baseline.train INFO: normal accuracy 0.6852894796125254 2.83829927444458 
2022-04-13 17:34:42,415 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 17:34:42,415 reid_baseline.train INFO: Accuracy: 68.5% Mean Entropy: 283.8%
2022-04-13 17:35:01,568 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.707, Acc: 0.744, Base Lr: 4.83e-03
2022-04-13 17:35:23,822 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.702, Acc: 0.742, Base Lr: 4.83e-03
2022-04-13 17:35:37,706 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.202[s] Speed: 79.0[samples/s]
2022-04-13 17:36:08,873 reid_baseline.train INFO: normal accuracy 0.7141248028835323 2.602170705795288 
2022-04-13 17:36:10,262 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 17:36:10,262 reid_baseline.train INFO: Accuracy: 71.4% Mean Entropy: 260.2%
2022-04-13 17:36:33,771 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.567, Acc: 0.773, Base Lr: 5.62e-03
2022-04-13 17:36:51,405 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.542, Acc: 0.777, Base Lr: 5.62e-03
2022-04-13 17:37:05,051 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.200[s] Speed: 79.9[samples/s]
2022-04-13 17:37:39,088 reid_baseline.train INFO: normal accuracy 0.7186303221446272 2.3797037601470947 
2022-04-13 17:37:40,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 17:37:40,411 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 238.0%
2022-04-13 17:38:00,005 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.425, Acc: 0.812, Base Lr: 6.42e-03
2022-04-13 17:38:17,638 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.418, Acc: 0.813, Base Lr: 6.42e-03
2022-04-13 17:38:33,286 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.194[s] Speed: 82.6[samples/s]
2022-04-13 17:39:04,998 reid_baseline.train INFO: normal accuracy 0.7276413606668168 2.3027637004852295 
2022-04-13 17:39:06,051 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 17:39:06,051 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 230.3%
2022-04-13 17:39:24,553 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.308, Acc: 0.844, Base Lr: 7.21e-03
2022-04-13 17:39:45,927 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.322, Acc: 0.842, Base Lr: 7.21e-03
2022-04-13 17:40:00,304 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.199[s] Speed: 80.6[samples/s]
2022-04-13 17:40:29,994 reid_baseline.train INFO: normal accuracy 0.7328227078170759 2.177767276763916 
2022-04-13 17:40:31,282 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 17:40:31,283 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 217.8%
2022-04-13 17:40:57,127 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.219, Acc: 0.879, Base Lr: 4.01e-03
2022-04-13 17:41:16,593 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.232, Acc: 0.874, Base Lr: 4.01e-03
2022-04-13 17:41:30,297 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.216[s] Speed: 74.1[samples/s]
2022-04-13 17:42:03,293 reid_baseline.train INFO: normal accuracy 0.7375535030412255 2.1813840866088867 
2022-04-13 17:42:03,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 17:42:03,296 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 218.1%
2022-04-13 17:42:25,468 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.194, Acc: 0.881, Base Lr: 3.38e-03
2022-04-13 17:42:49,180 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.184, Acc: 0.886, Base Lr: 3.38e-03
2022-04-13 17:43:04,264 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.223[s] Speed: 71.8[samples/s]
2022-04-13 17:43:36,646 reid_baseline.train INFO: normal accuracy 0.738905158819554 2.1254613399505615 
2022-04-13 17:43:38,246 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-13 17:43:38,246 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 212.5%
2022-04-13 17:44:00,269 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.133, Acc: 0.907, Base Lr: 2.77e-03
2022-04-13 17:44:19,672 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.146, Acc: 0.900, Base Lr: 2.77e-03
2022-04-13 17:44:33,440 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.202[s] Speed: 79.2[samples/s]
2022-04-13 17:45:03,922 reid_baseline.train INFO: normal accuracy 0.7386798828564992 2.1396450996398926 
2022-04-13 17:45:03,925 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-13 17:45:03,925 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 214.0%
2022-04-13 17:45:24,565 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.115, Acc: 0.919, Base Lr: 2.20e-03
2022-04-13 17:45:44,112 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.122, Acc: 0.909, Base Lr: 2.20e-03
2022-04-13 17:45:59,759 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.204[s] Speed: 78.3[samples/s]
2022-04-13 17:46:34,052 reid_baseline.train INFO: normal accuracy 0.7407073665239919 2.121185302734375 
2022-04-13 17:46:35,503 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-13 17:46:35,504 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 212.1%
2022-04-13 17:46:57,167 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.110, Acc: 0.909, Base Lr: 1.66e-03
2022-04-13 17:47:17,876 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.106, Acc: 0.911, Base Lr: 1.66e-03
2022-04-13 17:47:32,709 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.209[s] Speed: 76.4[samples/s]
2022-04-13 17:48:05,716 reid_baseline.train INFO: normal accuracy 0.7382293309303898 2.131505250930786 
2022-04-13 17:48:05,716 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-13 17:48:05,717 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 213.2%
2022-04-13 17:48:29,938 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.061, Acc: 0.922, Base Lr: 1.19e-03
2022-04-13 17:48:48,647 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.075, Acc: 0.922, Base Lr: 1.19e-03
2022-04-13 17:49:02,215 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.207[s] Speed: 77.4[samples/s]
2022-04-13 17:49:35,874 reid_baseline.train INFO: normal accuracy 0.7393557107456634 2.1363327503204346 
2022-04-13 17:49:35,876 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-13 17:49:35,877 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 213.6%
2022-04-13 17:49:59,659 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.083, Acc: 0.917, Base Lr: 7.78e-04
2022-04-13 17:50:18,869 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.074, Acc: 0.919, Base Lr: 7.78e-04
2022-04-13 17:50:37,701 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.226[s] Speed: 70.8[samples/s]
2022-04-13 17:51:09,027 reid_baseline.train INFO: normal accuracy 0.7391304347826086 2.146470785140991 
2022-04-13 17:51:09,028 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-13 17:51:09,029 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 214.6%
2022-04-13 17:51:33,155 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.075, Acc: 0.917, Base Lr: 4.51e-04
2022-04-13 17:51:54,780 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.067, Acc: 0.927, Base Lr: 4.51e-04
2022-04-13 17:52:08,763 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.219[s] Speed: 73.2[samples/s]
2022-04-13 17:52:39,956 reid_baseline.train INFO: normal accuracy 0.7427348501914846 2.092604637145996 
2022-04-13 17:52:41,155 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-13 17:52:41,156 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 209.3%
2022-04-13 17:53:01,959 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.069, Acc: 0.919, Base Lr: 2.11e-04
2022-04-13 17:53:21,759 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.055, Acc: 0.927, Base Lr: 2.11e-04
2022-04-13 17:53:35,407 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.199[s] Speed: 80.6[samples/s]
2022-04-13 17:54:10,583 reid_baseline.train INFO: normal accuracy 0.7404820905609372 2.1417367458343506 
2022-04-13 17:54:10,585 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-13 17:54:10,585 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 214.2%
2022-04-13 17:54:30,675 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.066, Acc: 0.915, Base Lr: 6.51e-05
2022-04-13 17:54:51,080 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.062, Acc: 0.922, Base Lr: 6.51e-05
2022-04-13 17:55:06,964 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.206[s] Speed: 77.6[samples/s]
2022-04-13 17:55:43,516 reid_baseline.train INFO: normal accuracy 0.7422842982653751 2.10951566696167 
2022-04-13 17:55:43,516 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-13 17:55:43,517 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 211.0%
2022-04-13 17:56:06,901 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.069, Acc: 0.926, Base Lr: 1.60e-05
2022-04-13 17:56:26,601 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.064, Acc: 0.926, Base Lr: 1.60e-05
2022-04-13 17:56:40,639 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.209[s] Speed: 76.5[samples/s]
2022-04-13 17:57:06,286 reid_baseline.train INFO: normal accuracy 0.738905158819554 2.16261887550354 
2022-04-13 17:57:06,286 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-13 17:57:06,286 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 216.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_4/transformer_best_model.pth
2022-04-13 17:57:37,887 reid_baseline.train INFO: normal accuracy 0.7427348501914846 2.092604637145996 
2022-04-13 17:57:37,888 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:57:37,888 reid_baseline.train INFO: Accuracy: 74.3%
2022-04-13 17:58:11,557 reid_baseline.train INFO: normal accuracy 0.6787564766839378 2.0651679039001465 
2022-04-13 17:58:11,558 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:58:11,558 reid_baseline.train INFO: Shuffled Accuracy: 67.9%
2022-04-13 17:58:41,682 reid_baseline.train INFO: normal accuracy 0.9369988545246277 1.0124136209487915 
2022-04-13 17:58:41,682 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 17:58:41,682 reid_baseline.train INFO: Source Clean Accuracy: 93.7%
2022-04-13 17:58:51,118 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_5
2022-04-13 17:58:51,118 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=5, dom_cls=False)
2022-04-13 17:58:51,118 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 17:58:51,118 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 17:58:51,119 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 17:59:06,819 reid_baseline.train INFO: start training
2022-04-13 17:59:27,076 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.111, Acc: 0.210, Base Lr: 8.72e-04
2022-04-13 17:59:45,942 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.040, Acc: 0.246, Base Lr: 8.72e-04
2022-04-13 18:00:02,169 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.202[s] Speed: 79.2[samples/s]
2022-04-13 18:00:30,874 reid_baseline.train INFO: normal accuracy 0.16107231358414056 4.160259246826172 
2022-04-13 18:00:32,112 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 18:00:32,112 reid_baseline.train INFO: Accuracy: 16.1% Mean Entropy: 416.0%
2022-04-13 18:00:52,659 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.651, Acc: 0.366, Base Lr: 1.66e-03
