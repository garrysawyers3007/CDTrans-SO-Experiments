2022-04-20 02:43:34,191 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_1
2022-04-20 02:43:34,191 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-20 02:43:34,191 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 02:43:34,191 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 02:43:34,191 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 02:43:45,364 reid_baseline.train INFO: start training
2022-04-20 02:44:34,386 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.265, Acc: 0.303, Base Lr: 8.72e-04
2022-04-20 02:44:51,423 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.423[s] Speed: 37.8[samples/s]
2022-04-20 02:45:32,187 reid_baseline.train INFO: normal accuracy 0.404581901489118 4.171579837799072 
2022-04-20 02:45:32,999 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 02:45:32,999 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 417.2%
2022-04-20 02:46:11,794 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.936, Acc: 0.593, Base Lr: 1.66e-03
2022-04-20 02:46:30,417 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.378[s] Speed: 42.4[samples/s]
2022-04-20 02:47:08,570 reid_baseline.train INFO: normal accuracy 0.4302405498281787 4.151164531707764 
2022-04-20 02:47:09,561 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 02:47:09,561 reid_baseline.train INFO: Accuracy: 43.0% Mean Entropy: 415.1%
2022-04-20 02:47:45,951 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.393, Acc: 0.633, Base Lr: 2.46e-03
2022-04-20 02:48:04,427 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-20 02:48:44,822 reid_baseline.train INFO: normal accuracy 0.4524627720504009 3.9771130084991455 
2022-04-20 02:48:45,702 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 02:48:45,702 reid_baseline.train INFO: Accuracy: 45.2% Mean Entropy: 397.7%
2022-04-20 02:49:24,047 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.582, Acc: 0.669, Base Lr: 3.25e-03
2022-04-20 02:49:41,707 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.368[s] Speed: 43.5[samples/s]
2022-04-20 02:50:20,327 reid_baseline.train INFO: normal accuracy 0.488659793814433 3.4522545337677 
2022-04-20 02:50:21,114 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 02:50:21,114 reid_baseline.train INFO: Accuracy: 48.9% Mean Entropy: 345.2%
2022-04-20 02:50:58,140 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.138, Acc: 0.710, Base Lr: 4.04e-03
2022-04-20 02:51:16,696 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-20 02:51:57,988 reid_baseline.train INFO: normal accuracy 0.554639175257732 2.965270757675171 
2022-04-20 02:51:58,760 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 02:51:58,760 reid_baseline.train INFO: Accuracy: 55.5% Mean Entropy: 296.5%
2022-04-20 02:52:37,684 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.880, Acc: 0.771, Base Lr: 4.83e-03
2022-04-20 02:52:56,159 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.378[s] Speed: 42.4[samples/s]
2022-04-20 02:53:37,708 reid_baseline.train INFO: normal accuracy 0.6041237113402061 2.6281416416168213 
2022-04-20 02:53:38,584 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 02:53:38,584 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 262.8%
2022-04-20 02:54:15,048 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.743, Acc: 0.801, Base Lr: 5.62e-03
2022-04-20 02:54:32,731 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.356[s] Speed: 44.9[samples/s]
2022-04-20 02:55:11,804 reid_baseline.train INFO: normal accuracy 0.6130584192439863 2.3170533180236816 
2022-04-20 02:55:12,589 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 02:55:12,590 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 231.7%
2022-04-20 02:55:50,736 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.561, Acc: 0.858, Base Lr: 6.42e-03
2022-04-20 02:56:07,562 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-20 02:56:49,286 reid_baseline.train INFO: normal accuracy 0.6176403207331043 2.0968821048736572 
2022-04-20 02:56:50,140 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 02:56:50,140 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 209.7%
2022-04-20 02:57:29,313 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.473, Acc: 0.869, Base Lr: 7.21e-03
2022-04-20 02:57:47,711 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.379[s] Speed: 42.3[samples/s]
2022-04-20 02:58:25,847 reid_baseline.train INFO: normal accuracy 0.611454753722795 1.9762064218521118 
2022-04-20 02:58:26,763 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 02:58:26,764 reid_baseline.train INFO: Accuracy: 61.1% Mean Entropy: 197.6%
2022-04-20 02:59:07,143 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.399, Acc: 0.889, Base Lr: 4.01e-03
2022-04-20 02:59:26,381 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.390[s] Speed: 41.0[samples/s]
2022-04-20 03:00:07,248 reid_baseline.train INFO: normal accuracy 0.6215349369988545 1.9275959730148315 
2022-04-20 03:00:08,103 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 03:00:08,103 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 192.8%
2022-04-20 03:00:44,839 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.351, Acc: 0.909, Base Lr: 3.38e-03
2022-04-20 03:01:03,595 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.364[s] Speed: 44.0[samples/s]
2022-04-20 03:01:43,157 reid_baseline.train INFO: normal accuracy 0.6277205040091638 1.8668042421340942 
2022-04-20 03:01:44,071 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 03:01:44,071 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.7%
2022-04-20 03:02:23,429 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.352, Acc: 0.918, Base Lr: 2.77e-03
2022-04-20 03:02:41,929 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.381[s] Speed: 42.0[samples/s]
2022-04-20 03:03:22,937 reid_baseline.train INFO: normal accuracy 0.6306987399770905 1.8695918321609497 
2022-04-20 03:03:22,937 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 03:03:22,938 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 187.0%
2022-04-20 03:04:02,746 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.314, Acc: 0.912, Base Lr: 2.20e-03
2022-04-20 03:04:22,079 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.389[s] Speed: 41.2[samples/s]
2022-04-20 03:05:01,889 reid_baseline.train INFO: normal accuracy 0.624971363115693 1.8853412866592407 
2022-04-20 03:05:01,891 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 03:05:01,892 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.5%
2022-04-20 03:05:36,172 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.258, Acc: 0.921, Base Lr: 1.66e-03
2022-04-20 03:05:53,298 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-20 03:06:33,410 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.8602535724639893 
2022-04-20 03:06:34,206 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 03:06:34,207 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 186.0%
2022-04-20 03:07:13,826 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.290, Acc: 0.936, Base Lr: 1.19e-03
2022-04-20 03:07:30,412 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-04-20 03:08:09,249 reid_baseline.train INFO: normal accuracy 0.6320733104238259 1.8528895378112793 
2022-04-20 03:08:10,056 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 03:08:10,056 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 185.3%
2022-04-20 03:08:47,403 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.270, Acc: 0.926, Base Lr: 7.78e-04
2022-04-20 03:09:05,339 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.363[s] Speed: 44.0[samples/s]
2022-04-20 03:09:43,268 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.7599560022354126 
2022-04-20 03:09:44,200 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 03:09:44,200 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 176.0%
2022-04-20 03:10:21,137 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.281, Acc: 0.938, Base Lr: 4.51e-04
2022-04-20 03:10:39,215 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-20 03:11:18,831 reid_baseline.train INFO: normal accuracy 0.6352806414662084 1.878299355506897 
2022-04-20 03:11:18,833 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 03:11:18,833 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 187.8%
2022-04-20 03:11:55,747 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.231, Acc: 0.934, Base Lr: 2.11e-04
2022-04-20 03:12:13,091 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-20 03:12:52,189 reid_baseline.train INFO: normal accuracy 0.634135166093929 1.8323726654052734 
2022-04-20 03:12:52,191 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 03:12:52,191 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 183.2%
2022-04-20 03:13:31,011 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.299, Acc: 0.925, Base Lr: 6.51e-05
2022-04-20 03:13:50,040 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-20 03:14:30,937 reid_baseline.train INFO: normal accuracy 0.63184421534937 1.8687539100646973 
2022-04-20 03:14:30,939 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 03:14:30,940 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 186.9%
2022-04-20 03:15:06,926 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.237, Acc: 0.926, Base Lr: 1.60e-05
2022-04-20 03:15:25,205 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.356[s] Speed: 45.0[samples/s]
2022-04-20 03:16:04,712 reid_baseline.train INFO: normal accuracy 0.634135166093929 1.8677573204040527 
2022-04-20 03:16:04,714 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 03:16:04,715 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 186.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_1/transformer_best_model.pth
2022-04-20 03:16:45,728 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.7599560022354126 
2022-04-20 03:16:45,729 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 03:16:45,729 reid_baseline.train INFO: Accuracy: 63.3%
2022-04-20 03:17:24,935 reid_baseline.train INFO: normal accuracy 0.6327605956471936 1.7599560022354126 
2022-04-20 03:17:24,936 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 03:17:24,936 reid_baseline.train INFO: Shuffled Accuracy: 63.3%
2022-04-20 03:17:56,662 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7761717438697815 
2022-04-20 03:17:56,662 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 03:17:56,662 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-20 03:18:02,326 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_1
2022-04-20 03:18:02,326 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_1', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=1, dom_cls=False)
2022-04-20 03:18:02,326 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 03:18:02,326 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 03:18:02,327 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_1
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 03:18:13,720 reid_baseline.train INFO: start training
2022-04-20 03:18:59,357 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.265, Acc: 0.303, Base Lr: 8.72e-04
2022-04-20 03:19:19,910 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.427[s] Speed: 37.5[samples/s]
2022-04-20 03:21:02,114 reid_baseline.train INFO: normal accuracy 0.6011016754647693 4.171505928039551 
2022-04-20 03:21:02,941 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 03:21:02,942 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 417.2%
2022-04-20 03:21:42,546 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.936, Acc: 0.593, Base Lr: 1.66e-03
2022-04-20 03:22:01,437 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.385[s] Speed: 41.6[samples/s]
2022-04-20 03:23:39,565 reid_baseline.train INFO: normal accuracy 0.6265779205875602 4.1386213302612305 
2022-04-20 03:23:40,448 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 03:23:40,448 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.9%
2022-04-20 03:24:18,254 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.393, Acc: 0.632, Base Lr: 2.46e-03
2022-04-20 03:24:33,813 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.351[s] Speed: 45.6[samples/s]
2022-04-20 03:26:16,860 reid_baseline.train INFO: normal accuracy 0.6369061280697728 3.8436131477355957 
2022-04-20 03:26:17,724 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 03:26:17,725 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.4%
2022-04-20 03:26:50,752 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.582, Acc: 0.669, Base Lr: 3.25e-03
2022-04-20 03:27:04,515 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-20 03:28:39,682 reid_baseline.train INFO: normal accuracy 0.6821207252696809 3.100343942642212 
2022-04-20 03:28:40,512 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 03:28:40,512 reid_baseline.train INFO: Accuracy: 68.2% Mean Entropy: 310.0%
2022-04-20 03:29:19,202 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.138, Acc: 0.709, Base Lr: 4.04e-03
2022-04-20 03:29:38,060 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.379[s] Speed: 42.3[samples/s]
2022-04-20 03:31:07,376 reid_baseline.train INFO: normal accuracy 0.7436309387193023 2.4531595706939697 
2022-04-20 03:31:08,205 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 03:31:08,205 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 245.3%
2022-04-20 03:31:47,747 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.880, Acc: 0.771, Base Lr: 4.83e-03
2022-04-20 03:32:06,132 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.381[s] Speed: 42.0[samples/s]
2022-04-20 03:33:45,244 reid_baseline.train INFO: normal accuracy 0.7897635988065183 2.0804898738861084 
2022-04-20 03:33:46,084 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 03:33:46,084 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 208.0%
2022-04-20 03:34:25,661 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.743, Acc: 0.801, Base Lr: 5.62e-03
2022-04-20 03:34:43,913 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-20 03:36:21,591 reid_baseline.train INFO: normal accuracy 0.8113380766582511 1.8070465326309204 
2022-04-20 03:36:22,468 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 03:36:22,468 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 180.7%
2022-04-20 03:36:59,754 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.562, Acc: 0.859, Base Lr: 6.42e-03
2022-04-20 03:37:20,773 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.384[s] Speed: 41.7[samples/s]
2022-04-20 03:38:57,643 reid_baseline.train INFO: normal accuracy 0.8209777369749828 1.6225351095199585 
2022-04-20 03:38:58,466 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 03:38:58,466 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 162.3%
2022-04-20 03:39:37,834 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.473, Acc: 0.870, Base Lr: 7.21e-03
2022-04-20 03:39:55,662 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.376[s] Speed: 42.5[samples/s]
2022-04-20 03:41:35,957 reid_baseline.train INFO: normal accuracy 0.8232728941932522 1.513909935951233 
2022-04-20 03:41:36,799 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 03:41:36,799 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 151.4%
2022-04-20 03:42:14,973 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.400, Acc: 0.890, Base Lr: 4.01e-03
2022-04-20 03:42:33,805 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.374[s] Speed: 42.7[samples/s]
2022-04-20 03:44:14,597 reid_baseline.train INFO: normal accuracy 0.8301583658480606 1.4827101230621338 
2022-04-20 03:44:15,518 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 03:44:15,518 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.3%
2022-04-20 03:44:53,967 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.351, Acc: 0.912, Base Lr: 3.38e-03
2022-04-20 03:45:12,443 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-20 03:46:51,964 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.4339350461959839 
2022-04-20 03:46:52,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 03:46:52,813 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 143.4%
2022-04-20 03:47:32,307 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.352, Acc: 0.918, Base Lr: 2.77e-03
2022-04-20 03:47:50,706 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.381[s] Speed: 42.0[samples/s]
2022-04-20 03:49:24,850 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4379171133041382 
2022-04-20 03:49:24,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 03:49:24,851 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 143.8%
2022-04-20 03:50:05,810 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.315, Acc: 0.911, Base Lr: 2.20e-03
2022-04-20 03:50:24,741 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.394[s] Speed: 40.6[samples/s]
2022-04-20 03:52:03,441 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4584375619888306 
2022-04-20 03:52:03,443 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 03:52:03,443 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.8%
2022-04-20 03:52:43,329 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.258, Acc: 0.920, Base Lr: 1.66e-03
2022-04-20 03:53:03,392 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.394[s] Speed: 40.6[samples/s]
2022-04-20 03:54:48,621 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.4419504404067993 
2022-04-20 03:54:48,621 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 03:54:48,621 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 144.2%
2022-04-20 03:55:28,058 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.290, Acc: 0.935, Base Lr: 1.19e-03
2022-04-20 03:55:48,158 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.392[s] Speed: 40.9[samples/s]
2022-04-20 03:57:29,328 reid_baseline.train INFO: normal accuracy 0.836584806059215 1.4456439018249512 
2022-04-20 03:57:29,328 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 03:57:29,329 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 144.6%
2022-04-20 03:58:07,903 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.271, Acc: 0.927, Base Lr: 7.78e-04
2022-04-20 03:58:25,849 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-20 04:00:03,413 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.3541083335876465 
2022-04-20 04:00:04,242 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 04:00:04,242 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 135.4%
2022-04-20 04:00:45,996 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.281, Acc: 0.938, Base Lr: 4.51e-04
2022-04-20 04:01:05,049 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.400[s] Speed: 40.0[samples/s]
2022-04-20 04:02:44,889 reid_baseline.train INFO: normal accuracy 0.8340601331191186 1.4683082103729248 
2022-04-20 04:02:44,889 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 04:02:44,889 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.8%
2022-04-20 04:03:21,590 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.232, Acc: 0.935, Base Lr: 2.11e-04
2022-04-20 04:03:39,860 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.361[s] Speed: 44.4[samples/s]
2022-04-20 04:05:17,267 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4285403490066528 
2022-04-20 04:05:17,267 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 04:05:17,267 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 142.9%
2022-04-20 04:05:55,749 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.300, Acc: 0.923, Base Lr: 6.51e-05
2022-04-20 04:06:15,049 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.380[s] Speed: 42.1[samples/s]
2022-04-20 04:07:56,835 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4662268161773682 
2022-04-20 04:07:56,835 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 04:07:56,836 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.6%
2022-04-20 04:08:34,477 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.237, Acc: 0.925, Base Lr: 1.60e-05
2022-04-20 04:08:50,089 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-20 04:10:27,735 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.4667121171951294 
2022-04-20 04:10:27,737 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 04:10:27,737 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_1/transformer_best_model.pth
2022-04-20 04:12:06,495 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.3541083335876465 
2022-04-20 04:12:06,495 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:12:06,495 reid_baseline.train INFO: Accuracy: 83.7%
2022-04-20 04:13:47,361 reid_baseline.train INFO: normal accuracy 0.8372733532246959 1.3541083335876465 
2022-04-20 04:13:47,361 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:13:47,361 reid_baseline.train INFO: Shuffled Accuracy: 83.7%
2022-04-20 04:14:19,351 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.7762992978096008 
2022-04-20 04:14:19,351 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:14:19,351 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-20 04:14:24,866 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_2
2022-04-20 04:14:24,866 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-20 04:14:24,866 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 04:14:24,866 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 04:14:24,867 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 04:14:35,835 reid_baseline.train INFO: start training
2022-04-20 04:15:16,767 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.270, Acc: 0.300, Base Lr: 8.72e-04
2022-04-20 04:15:35,048 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.376[s] Speed: 42.5[samples/s]
2022-04-20 04:16:13,899 reid_baseline.train INFO: normal accuracy 0.4013745704467354 4.171613693237305 
2022-04-20 04:16:14,810 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 04:16:14,810 reid_baseline.train INFO: Accuracy: 40.1% Mean Entropy: 417.2%
2022-04-20 04:16:50,506 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.909, Acc: 0.597, Base Lr: 1.66e-03
2022-04-20 04:17:05,961 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-20 04:17:46,134 reid_baseline.train INFO: normal accuracy 0.41260022909507443 4.150779724121094 
2022-04-20 04:17:46,901 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 04:17:46,901 reid_baseline.train INFO: Accuracy: 41.3% Mean Entropy: 415.1%
2022-04-20 04:18:24,815 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.408, Acc: 0.606, Base Lr: 2.46e-03
2022-04-20 04:18:42,606 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.366[s] Speed: 43.7[samples/s]
2022-04-20 04:19:25,278 reid_baseline.train INFO: normal accuracy 0.4316151202749141 3.9747817516326904 
2022-04-20 04:19:26,116 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 04:19:26,116 reid_baseline.train INFO: Accuracy: 43.2% Mean Entropy: 397.5%
2022-04-20 04:20:01,020 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.691, Acc: 0.659, Base Lr: 3.25e-03
2022-04-20 04:20:18,933 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-20 04:20:57,418 reid_baseline.train INFO: normal accuracy 0.4849942726231386 3.468167543411255 
2022-04-20 04:20:58,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 04:20:58,238 reid_baseline.train INFO: Accuracy: 48.5% Mean Entropy: 346.8%
2022-04-20 04:21:30,564 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.125, Acc: 0.712, Base Lr: 4.04e-03
2022-04-20 04:21:48,312 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-20 04:22:28,438 reid_baseline.train INFO: normal accuracy 0.5587628865979382 2.9672417640686035 
2022-04-20 04:22:29,227 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 04:22:29,227 reid_baseline.train INFO: Accuracy: 55.9% Mean Entropy: 296.7%
2022-04-20 04:23:04,625 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.804, Acc: 0.770, Base Lr: 4.83e-03
2022-04-20 04:23:21,359 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.343[s] Speed: 46.7[samples/s]
2022-04-20 04:24:01,505 reid_baseline.train INFO: normal accuracy 0.5860252004581902 2.613222599029541 
2022-04-20 04:24:02,372 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 04:24:02,372 reid_baseline.train INFO: Accuracy: 58.6% Mean Entropy: 261.3%
2022-04-20 04:24:38,533 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.685, Acc: 0.823, Base Lr: 5.62e-03
2022-04-20 04:24:56,658 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-20 04:25:34,614 reid_baseline.train INFO: normal accuracy 0.5997709049255441 2.277721881866455 
2022-04-20 04:25:35,557 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 04:25:35,557 reid_baseline.train INFO: Accuracy: 60.0% Mean Entropy: 227.8%
2022-04-20 04:26:07,747 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.566, Acc: 0.852, Base Lr: 6.42e-03
2022-04-20 04:26:25,521 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.328[s] Speed: 48.8[samples/s]
2022-04-20 04:27:05,973 reid_baseline.train INFO: normal accuracy 0.6098510882016037 2.1176645755767822 
2022-04-20 04:27:06,839 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 04:27:06,839 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 211.8%
2022-04-20 04:27:44,081 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.422, Acc: 0.878, Base Lr: 7.21e-03
2022-04-20 04:27:59,086 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-20 04:28:38,938 reid_baseline.train INFO: normal accuracy 0.616036655211913 1.983416199684143 
2022-04-20 04:28:39,928 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 04:28:39,928 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 198.3%
2022-04-20 04:29:17,658 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.430, Acc: 0.896, Base Lr: 4.01e-03
2022-04-20 04:29:36,045 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.369[s] Speed: 43.3[samples/s]
2022-04-20 04:30:19,233 reid_baseline.train INFO: normal accuracy 0.6245131729667812 1.9156943559646606 
2022-04-20 04:30:20,096 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 04:30:20,096 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 191.6%
2022-04-20 04:30:54,974 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.349, Acc: 0.911, Base Lr: 3.38e-03
2022-04-20 04:31:13,934 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-20 04:31:55,621 reid_baseline.train INFO: normal accuracy 0.6213058419243986 1.8559257984161377 
2022-04-20 04:31:56,527 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 04:31:56,528 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 185.6%
2022-04-20 04:32:31,362 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.338, Acc: 0.917, Base Lr: 2.77e-03
2022-04-20 04:32:49,791 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-20 04:33:29,476 reid_baseline.train INFO: normal accuracy 0.6235967926689576 1.8840779066085815 
2022-04-20 04:33:29,477 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 04:33:29,477 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 188.4%
2022-04-20 04:34:06,780 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.261, Acc: 0.922, Base Lr: 2.20e-03
2022-04-20 04:34:26,302 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-20 04:35:10,050 reid_baseline.train INFO: normal accuracy 0.6290950744558992 1.8506361246109009 
2022-04-20 04:35:10,947 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 04:35:10,947 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 185.1%
2022-04-20 04:35:49,240 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.297, Acc: 0.926, Base Lr: 1.66e-03
2022-04-20 04:36:07,619 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-04-20 04:36:48,320 reid_baseline.train INFO: normal accuracy 0.6240549828178694 1.8572825193405151 
2022-04-20 04:36:48,322 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 04:36:48,323 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 185.7%
2022-04-20 04:37:27,515 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.280, Acc: 0.933, Base Lr: 1.19e-03
2022-04-20 04:37:45,241 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-20 04:38:25,895 reid_baseline.train INFO: normal accuracy 0.6254295532646048 1.8644771575927734 
2022-04-20 04:38:25,895 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 04:38:25,896 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 186.4%
2022-04-20 04:39:03,717 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.229, Acc: 0.936, Base Lr: 7.78e-04
2022-04-20 04:39:20,892 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.362[s] Speed: 44.2[samples/s]
2022-04-20 04:40:01,843 reid_baseline.train INFO: normal accuracy 0.624971363115693 1.813828468322754 
2022-04-20 04:40:02,826 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 04:40:02,827 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 181.4%
2022-04-20 04:40:39,951 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.282, Acc: 0.933, Base Lr: 4.51e-04
2022-04-20 04:40:57,844 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.362[s] Speed: 44.2[samples/s]
2022-04-20 04:41:38,662 reid_baseline.train INFO: normal accuracy 0.6258877434135166 1.8028734922409058 
2022-04-20 04:41:39,502 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 04:41:39,503 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 180.3%
2022-04-20 04:42:15,683 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.238, Acc: 0.935, Base Lr: 2.11e-04
2022-04-20 04:42:34,262 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.360[s] Speed: 44.4[samples/s]
2022-04-20 04:43:14,811 reid_baseline.train INFO: normal accuracy 0.6274914089347079 1.8552709817886353 
2022-04-20 04:43:14,813 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 04:43:14,814 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 185.5%
2022-04-20 04:43:50,114 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.282, Acc: 0.940, Base Lr: 6.51e-05
2022-04-20 04:44:07,467 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.346[s] Speed: 46.2[samples/s]
2022-04-20 04:44:49,793 reid_baseline.train INFO: normal accuracy 0.6252004581901489 1.8991695642471313 
2022-04-20 04:44:49,794 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 04:44:49,794 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 189.9%
2022-04-20 04:45:26,714 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.246, Acc: 0.940, Base Lr: 1.60e-05
2022-04-20 04:45:45,457 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.366[s] Speed: 43.7[samples/s]
2022-04-20 04:46:28,779 reid_baseline.train INFO: normal accuracy 0.6254295532646048 1.861796259880066 
2022-04-20 04:46:28,781 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 04:46:28,782 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 186.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_2/transformer_best_model.pth
2022-04-20 04:47:09,793 reid_baseline.train INFO: normal accuracy 0.6258877434135166 1.8028734922409058 
2022-04-20 04:47:09,793 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:47:09,793 reid_baseline.train INFO: Accuracy: 62.6%
2022-04-20 04:47:48,778 reid_baseline.train INFO: normal accuracy 0.6258877434135166 1.8028734922409058 
2022-04-20 04:47:48,778 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:47:48,778 reid_baseline.train INFO: Shuffled Accuracy: 62.6%
2022-04-20 04:48:22,002 reid_baseline.train INFO: normal accuracy 0.9789864029666254 0.8141137361526489 
2022-04-20 04:48:22,002 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 04:48:22,003 reid_baseline.train INFO: Source Clean Accuracy: 97.9%
2022-04-20 04:48:27,293 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_2
2022-04-20 04:48:27,294 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2, dom_cls=False)
2022-04-20 04:48:27,294 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 04:48:27,294 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 04:48:27,294 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 04:48:36,846 reid_baseline.train INFO: start training
2022-04-20 04:49:25,724 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.270, Acc: 0.300, Base Lr: 8.72e-04
2022-04-20 04:49:46,158 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.445[s] Speed: 36.0[samples/s]
2022-04-20 04:51:30,005 reid_baseline.train INFO: normal accuracy 0.5994950654119807 4.171516418457031 
2022-04-20 04:51:30,902 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 04:51:30,902 reid_baseline.train INFO: Accuracy: 59.9% Mean Entropy: 417.2%
2022-04-20 04:52:06,943 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.909, Acc: 0.597, Base Lr: 1.66e-03
2022-04-20 04:52:25,812 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-04-20 04:54:03,334 reid_baseline.train INFO: normal accuracy 0.6137250401652513 4.137360572814941 
2022-04-20 04:54:04,348 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 04:54:04,349 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 413.7%
2022-04-20 04:54:40,738 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.408, Acc: 0.606, Base Lr: 2.46e-03
2022-04-20 04:54:58,638 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-20 04:56:42,226 reid_baseline.train INFO: normal accuracy 0.6300206564149644 3.8404273986816406 
2022-04-20 04:56:43,054 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 04:56:43,054 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 384.0%
2022-04-20 04:57:20,454 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.691, Acc: 0.659, Base Lr: 3.25e-03
2022-04-20 04:57:39,356 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.370[s] Speed: 43.2[samples/s]
2022-04-20 04:59:19,149 reid_baseline.train INFO: normal accuracy 0.6830387881569887 3.0940027236938477 
2022-04-20 04:59:20,025 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 04:59:20,026 reid_baseline.train INFO: Accuracy: 68.3% Mean Entropy: 309.4%
2022-04-20 04:59:56,323 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.125, Acc: 0.713, Base Lr: 4.04e-03
2022-04-20 05:00:14,480 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.358[s] Speed: 44.7[samples/s]
2022-04-20 05:02:03,653 reid_baseline.train INFO: normal accuracy 0.7459260959375718 2.478607416152954 
2022-04-20 05:02:04,582 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 05:02:04,583 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 247.9%
2022-04-20 05:02:41,309 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.804, Acc: 0.770, Base Lr: 4.83e-03
2022-04-20 05:03:00,856 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.370[s] Speed: 43.2[samples/s]
2022-04-20 05:04:40,027 reid_baseline.train INFO: normal accuracy 0.7897635988065183 2.0764236450195312 
2022-04-20 05:04:40,920 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 05:04:40,920 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 207.6%
2022-04-20 05:05:18,344 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.685, Acc: 0.823, Base Lr: 5.62e-03
2022-04-20 05:05:34,359 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.351[s] Speed: 45.6[samples/s]
2022-04-20 05:07:11,391 reid_baseline.train INFO: normal accuracy 0.8083543722745008 1.7878178358078003 
2022-04-20 05:07:12,264 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 05:07:12,264 reid_baseline.train INFO: Accuracy: 80.8% Mean Entropy: 178.8%
2022-04-20 05:07:46,258 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.566, Acc: 0.852, Base Lr: 6.42e-03
2022-04-20 05:08:03,312 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.336[s] Speed: 47.7[samples/s]
2022-04-20 05:09:47,199 reid_baseline.train INFO: normal accuracy 0.8196006426440211 1.6323355436325073 
2022-04-20 05:09:48,054 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 05:09:48,054 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 163.2%
2022-04-20 05:10:23,521 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.423, Acc: 0.877, Base Lr: 7.21e-03
2022-04-20 05:10:40,672 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.346[s] Speed: 46.2[samples/s]
2022-04-20 05:12:20,184 reid_baseline.train INFO: normal accuracy 0.8223548313059444 1.525461196899414 
2022-04-20 05:12:21,054 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 05:12:21,054 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 152.5%
2022-04-20 05:12:56,311 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.430, Acc: 0.896, Base Lr: 4.01e-03
2022-04-20 05:13:17,399 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.371[s] Speed: 43.2[samples/s]
2022-04-20 05:14:57,071 reid_baseline.train INFO: normal accuracy 0.8296993344044067 1.4813406467437744 
2022-04-20 05:14:58,005 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 05:14:58,006 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 148.1%
2022-04-20 05:15:32,578 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.349, Acc: 0.912, Base Lr: 3.38e-03
2022-04-20 05:15:50,002 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-20 05:17:34,791 reid_baseline.train INFO: normal accuracy 0.8299288501262336 1.4251232147216797 
2022-04-20 05:17:35,652 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 05:17:35,652 reid_baseline.train INFO: Accuracy: 83.0% Mean Entropy: 142.5%
2022-04-20 05:18:10,976 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.338, Acc: 0.918, Base Lr: 2.77e-03
2022-04-20 05:18:28,301 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.346[s] Speed: 46.2[samples/s]
2022-04-20 05:20:09,057 reid_baseline.train INFO: normal accuracy 0.8280927243516181 1.4571458101272583 
2022-04-20 05:20:09,059 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 05:20:09,059 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 145.7%
2022-04-20 05:20:42,683 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.261, Acc: 0.921, Base Lr: 2.20e-03
2022-04-20 05:21:03,669 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.359[s] Speed: 44.5[samples/s]
2022-04-20 05:22:42,296 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4316126108169556 
2022-04-20 05:22:42,296 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 05:22:42,296 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 143.2%
2022-04-20 05:23:21,264 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.297, Acc: 0.925, Base Lr: 1.66e-03
2022-04-20 05:23:39,397 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-04-20 05:25:20,971 reid_baseline.train INFO: normal accuracy 0.8354372274500803 1.4525041580200195 
2022-04-20 05:25:20,975 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 05:25:20,975 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.3%
2022-04-20 05:25:57,562 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.280, Acc: 0.933, Base Lr: 1.19e-03
2022-04-20 05:26:14,790 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-20 05:27:55,300 reid_baseline.train INFO: normal accuracy 0.8354372274500803 1.4644588232040405 
2022-04-20 05:27:55,302 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 05:27:55,302 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.4%
2022-04-20 05:28:33,150 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.229, Acc: 0.936, Base Lr: 7.78e-04
2022-04-20 05:28:48,838 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.352[s] Speed: 45.4[samples/s]
2022-04-20 05:30:15,982 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.41379714012146 
2022-04-20 05:30:16,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 05:30:16,839 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 141.4%
2022-04-20 05:30:52,329 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.282, Acc: 0.934, Base Lr: 4.51e-04
2022-04-20 05:31:11,566 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.360[s] Speed: 44.4[samples/s]
2022-04-20 05:32:55,215 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4091802835464478 
2022-04-20 05:32:55,998 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 05:32:55,998 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 140.9%
2022-04-20 05:33:33,390 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.238, Acc: 0.935, Base Lr: 2.11e-04
2022-04-20 05:33:51,978 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-20 05:35:31,782 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.455735206604004 
2022-04-20 05:35:31,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 05:35:31,783 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.6%
2022-04-20 05:36:07,001 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.283, Acc: 0.941, Base Lr: 6.51e-05
2022-04-20 05:36:24,177 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-20 05:38:09,861 reid_baseline.train INFO: normal accuracy 0.8356667431719073 1.5091651678085327 
2022-04-20 05:38:09,864 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 05:38:09,864 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 150.9%
2022-04-20 05:38:49,128 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.245, Acc: 0.939, Base Lr: 1.60e-05
2022-04-20 05:39:09,626 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.393[s] Speed: 40.7[samples/s]
2022-04-20 05:40:50,918 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4706114530563354 
2022-04-20 05:40:50,919 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 05:40:50,919 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 147.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_2/transformer_best_model.pth
2022-04-20 05:42:31,704 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4091802835464478 
2022-04-20 05:42:31,704 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 05:42:31,704 reid_baseline.train INFO: Accuracy: 83.6%
2022-04-20 05:44:07,339 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4091802835464478 
2022-04-20 05:44:07,340 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 05:44:07,340 reid_baseline.train INFO: Shuffled Accuracy: 83.6%
2022-04-20 05:44:39,744 reid_baseline.train INFO: normal accuracy 0.9789864029666254 0.8144495487213135 
2022-04-20 05:44:39,745 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 05:44:39,745 reid_baseline.train INFO: Source Clean Accuracy: 97.9%
2022-04-20 05:44:45,444 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_3
2022-04-20 05:44:45,444 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-20 05:44:45,444 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 05:44:45,445 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 05:44:45,445 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 05:44:57,478 reid_baseline.train INFO: start training
2022-04-20 05:45:40,760 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.284, Acc: 0.294, Base Lr: 8.72e-04
2022-04-20 05:45:59,498 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.402[s] Speed: 39.8[samples/s]
2022-04-20 05:46:38,326 reid_baseline.train INFO: normal accuracy 0.3970217640320733 4.17158317565918 
2022-04-20 05:46:39,252 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 05:46:39,253 reid_baseline.train INFO: Accuracy: 39.7% Mean Entropy: 417.2%
2022-04-20 05:47:14,151 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.979, Acc: 0.572, Base Lr: 1.66e-03
2022-04-20 05:47:32,113 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-20 05:48:11,758 reid_baseline.train INFO: normal accuracy 0.4316151202749141 4.149919509887695 
2022-04-20 05:48:12,613 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 05:48:12,613 reid_baseline.train INFO: Accuracy: 43.2% Mean Entropy: 415.0%
2022-04-20 05:48:45,734 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.337, Acc: 0.623, Base Lr: 2.46e-03
2022-04-20 05:49:02,764 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.330[s] Speed: 48.5[samples/s]
2022-04-20 05:49:41,463 reid_baseline.train INFO: normal accuracy 0.44558991981672397 3.967134714126587 
2022-04-20 05:49:42,309 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 05:49:42,309 reid_baseline.train INFO: Accuracy: 44.6% Mean Entropy: 396.7%
2022-04-20 05:50:17,164 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.619, Acc: 0.663, Base Lr: 3.25e-03
2022-04-20 05:50:33,916 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.340[s] Speed: 47.1[samples/s]
2022-04-20 05:51:16,538 reid_baseline.train INFO: normal accuracy 0.5046964490263459 3.490138292312622 
2022-04-20 05:51:17,324 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 05:51:17,324 reid_baseline.train INFO: Accuracy: 50.5% Mean Entropy: 349.0%
2022-04-20 05:51:54,801 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.111, Acc: 0.730, Base Lr: 4.04e-03
2022-04-20 05:52:13,050 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.367[s] Speed: 43.6[samples/s]
2022-04-20 05:52:53,037 reid_baseline.train INFO: normal accuracy 0.5621993127147766 3.000673770904541 
2022-04-20 05:52:53,875 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 05:52:53,875 reid_baseline.train INFO: Accuracy: 56.2% Mean Entropy: 300.1%
2022-04-20 05:53:25,620 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.829, Acc: 0.788, Base Lr: 4.83e-03
2022-04-20 05:53:41,082 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-20 05:54:19,259 reid_baseline.train INFO: normal accuracy 0.6054982817869415 2.5904226303100586 
2022-04-20 05:54:20,107 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 05:54:20,107 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 259.0%
2022-04-20 05:54:55,197 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.685, Acc: 0.815, Base Lr: 5.62e-03
2022-04-20 05:55:10,813 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.334[s] Speed: 48.0[samples/s]
2022-04-20 05:55:50,939 reid_baseline.train INFO: normal accuracy 0.6096219931271478 2.3025264739990234 
2022-04-20 05:55:51,826 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 05:55:51,826 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 230.3%
2022-04-20 05:56:26,594 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.524, Acc: 0.854, Base Lr: 6.42e-03
2022-04-20 05:56:42,950 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.336[s] Speed: 47.6[samples/s]
2022-04-20 05:57:22,845 reid_baseline.train INFO: normal accuracy 0.6167239404352807 2.086153030395508 
2022-04-20 05:57:23,687 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 05:57:23,688 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 208.6%
2022-04-20 05:57:58,332 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.461, Acc: 0.864, Base Lr: 7.21e-03
2022-04-20 05:58:15,906 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-20 05:58:54,740 reid_baseline.train INFO: normal accuracy 0.6187857961053838 1.942565679550171 
2022-04-20 05:58:55,642 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 05:58:55,643 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 194.3%
2022-04-20 05:59:28,200 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.400, Acc: 0.886, Base Lr: 4.01e-03
2022-04-20 05:59:45,490 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.327[s] Speed: 49.0[samples/s]
2022-04-20 06:00:25,770 reid_baseline.train INFO: normal accuracy 0.6245131729667812 1.937467336654663 
2022-04-20 06:00:26,756 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 06:00:26,756 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 193.7%
2022-04-20 06:01:02,757 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.352, Acc: 0.894, Base Lr: 3.38e-03
2022-04-20 06:01:20,992 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.356[s] Speed: 45.0[samples/s]
2022-04-20 06:02:02,020 reid_baseline.train INFO: normal accuracy 0.6174112256586484 1.8318084478378296 
2022-04-20 06:02:02,875 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 06:02:02,875 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 183.2%
2022-04-20 06:02:39,919 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.309, Acc: 0.909, Base Lr: 2.77e-03
2022-04-20 06:02:57,518 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.359[s] Speed: 44.5[samples/s]
2022-04-20 06:03:36,414 reid_baseline.train INFO: normal accuracy 0.6224513172966781 1.865355372428894 
2022-04-20 06:03:36,415 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 06:03:36,415 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 186.5%
2022-04-20 06:04:09,544 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.328, Acc: 0.908, Base Lr: 2.20e-03
2022-04-20 06:04:26,450 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.328[s] Speed: 48.7[samples/s]
2022-04-20 06:05:04,839 reid_baseline.train INFO: normal accuracy 0.6229095074455899 1.8741798400878906 
2022-04-20 06:05:04,840 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 06:05:04,840 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 187.4%
2022-04-20 06:05:40,260 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.338, Acc: 0.917, Base Lr: 1.66e-03
2022-04-20 06:05:54,624 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.327[s] Speed: 49.0[samples/s]
2022-04-20 06:06:35,023 reid_baseline.train INFO: normal accuracy 0.6194730813287515 1.7974590063095093 
2022-04-20 06:06:35,970 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 06:06:35,971 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 179.7%
2022-04-20 06:07:10,864 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.263, Acc: 0.940, Base Lr: 1.19e-03
2022-04-20 06:07:27,806 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-20 06:08:06,527 reid_baseline.train INFO: normal accuracy 0.6311569301260023 1.8867870569229126 
2022-04-20 06:08:06,528 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 06:08:06,528 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 188.7%
2022-04-20 06:08:39,695 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.216, Acc: 0.937, Base Lr: 7.78e-04
2022-04-20 06:08:56,601 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.328[s] Speed: 48.7[samples/s]
2022-04-20 06:09:34,547 reid_baseline.train INFO: normal accuracy 0.6268041237113402 1.7930357456207275 
2022-04-20 06:09:35,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 06:09:35,365 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 179.3%
2022-04-20 06:10:09,898 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.245, Acc: 0.940, Base Lr: 4.51e-04
2022-04-20 06:10:24,290 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.322[s] Speed: 49.7[samples/s]
2022-04-20 06:11:04,641 reid_baseline.train INFO: normal accuracy 0.6270332187857961 1.8324695825576782 
2022-04-20 06:11:04,644 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 06:11:04,644 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 183.2%
2022-04-20 06:11:40,111 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.236, Acc: 0.931, Base Lr: 2.11e-04
2022-04-20 06:11:57,122 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-20 06:12:37,597 reid_baseline.train INFO: normal accuracy 0.6274914089347079 1.8893582820892334 
2022-04-20 06:12:37,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 06:12:37,598 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 188.9%
2022-04-20 06:13:14,147 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.294, Acc: 0.931, Base Lr: 6.51e-05
2022-04-20 06:13:32,091 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-20 06:14:11,620 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.838074803352356 
2022-04-20 06:14:11,623 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 06:14:11,623 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 183.8%
2022-04-20 06:14:46,109 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.300, Acc: 0.934, Base Lr: 1.60e-05
2022-04-20 06:15:02,851 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-20 06:15:44,242 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.8553873300552368 
2022-04-20 06:15:44,244 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 06:15:44,244 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 185.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_3/transformer_best_model.pth
2022-04-20 06:16:26,391 reid_baseline.train INFO: normal accuracy 0.6268041237113402 1.7930357456207275 
2022-04-20 06:16:26,391 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 06:16:26,391 reid_baseline.train INFO: Accuracy: 62.7%
2022-04-20 06:17:03,914 reid_baseline.train INFO: normal accuracy 0.6268041237113402 1.7930357456207275 
2022-04-20 06:17:03,914 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 06:17:03,914 reid_baseline.train INFO: Shuffled Accuracy: 62.7%
2022-04-20 06:17:37,124 reid_baseline.train INFO: normal accuracy 0.9765142150803461 0.7968453764915466 
2022-04-20 06:17:37,124 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 06:17:37,125 reid_baseline.train INFO: Source Clean Accuracy: 97.7%
2022-04-20 06:17:43,038 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_3
2022-04-20 06:17:43,038 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3, dom_cls=False)
2022-04-20 06:17:43,038 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 06:17:43,038 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 06:17:43,039 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 06:17:54,588 reid_baseline.train INFO: start training
2022-04-20 06:18:38,351 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.284, Acc: 0.293, Base Lr: 8.72e-04
2022-04-20 06:18:56,649 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.395[s] Speed: 40.5[samples/s]
2022-04-20 06:20:39,580 reid_baseline.train INFO: normal accuracy 0.5997245811338077 4.17147159576416 
2022-04-20 06:20:40,358 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 06:20:40,358 reid_baseline.train INFO: Accuracy: 60.0% Mean Entropy: 417.1%
2022-04-20 06:21:15,185 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.979, Acc: 0.572, Base Lr: 1.66e-03
2022-04-20 06:21:33,829 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.351[s] Speed: 45.6[samples/s]
2022-04-20 06:23:18,323 reid_baseline.train INFO: normal accuracy 0.6293321092494836 4.137025356292725 
2022-04-20 06:23:19,257 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 06:23:19,257 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 413.7%
2022-04-20 06:23:54,629 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.337, Acc: 0.623, Base Lr: 2.46e-03
2022-04-20 06:24:09,715 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-20 06:25:52,567 reid_baseline.train INFO: normal accuracy 0.6343814551296764 3.826493263244629 
2022-04-20 06:25:53,506 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 06:25:53,507 reid_baseline.train INFO: Accuracy: 63.4% Mean Entropy: 382.6%
2022-04-20 06:26:29,122 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.619, Acc: 0.663, Base Lr: 3.25e-03
2022-04-20 06:26:47,879 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-20 06:28:27,957 reid_baseline.train INFO: normal accuracy 0.6899242598117971 3.1487789154052734 
2022-04-20 06:28:28,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 06:28:28,752 reid_baseline.train INFO: Accuracy: 69.0% Mean Entropy: 314.9%
2022-04-20 06:29:03,840 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.111, Acc: 0.730, Base Lr: 4.04e-03
2022-04-20 06:29:21,089 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-20 06:31:01,337 reid_baseline.train INFO: normal accuracy 0.7417948129446867 2.517064332962036 
2022-04-20 06:31:02,208 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 06:31:02,208 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 251.7%
2022-04-20 06:31:37,152 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.829, Acc: 0.788, Base Lr: 4.83e-03
2022-04-20 06:31:53,950 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.340[s] Speed: 47.1[samples/s]
2022-04-20 06:33:33,513 reid_baseline.train INFO: normal accuracy 0.7904521459719991 2.075092077255249 
2022-04-20 06:33:34,393 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 06:33:34,393 reid_baseline.train INFO: Accuracy: 79.0% Mean Entropy: 207.5%
2022-04-20 06:34:08,403 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.685, Acc: 0.815, Base Lr: 5.62e-03
2022-04-20 06:34:27,366 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-20 06:36:08,655 reid_baseline.train INFO: normal accuracy 0.8138627495983475 1.8040192127227783 
2022-04-20 06:36:09,647 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 06:36:09,648 reid_baseline.train INFO: Accuracy: 81.4% Mean Entropy: 180.4%
2022-04-20 06:36:46,760 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.524, Acc: 0.854, Base Lr: 6.42e-03
2022-04-20 06:37:02,636 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-20 06:38:44,727 reid_baseline.train INFO: normal accuracy 0.8182235483130594 1.5947465896606445 
2022-04-20 06:38:45,610 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 06:38:45,610 reid_baseline.train INFO: Accuracy: 81.8% Mean Entropy: 159.5%
2022-04-20 06:39:21,765 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.462, Acc: 0.862, Base Lr: 7.21e-03
2022-04-20 06:39:39,457 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.353[s] Speed: 45.3[samples/s]
2022-04-20 06:41:20,145 reid_baseline.train INFO: normal accuracy 0.8255680514115217 1.4837942123413086 
2022-04-20 06:41:20,984 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 06:41:20,985 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 148.4%
2022-04-20 06:41:56,577 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.401, Acc: 0.887, Base Lr: 4.01e-03
2022-04-20 06:42:14,569 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.352[s] Speed: 45.4[samples/s]
2022-04-20 06:43:56,689 reid_baseline.train INFO: normal accuracy 0.828551755795272 1.517697811126709 
2022-04-20 06:43:56,689 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 06:43:56,689 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 151.8%
2022-04-20 06:44:31,814 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.354, Acc: 0.894, Base Lr: 3.38e-03
2022-04-20 06:44:53,677 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.375[s] Speed: 42.7[samples/s]
2022-04-20 06:46:35,049 reid_baseline.train INFO: normal accuracy 0.8274041771861372 1.4091545343399048 
2022-04-20 06:46:35,968 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 06:46:35,968 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 140.9%
2022-04-20 06:47:10,482 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.309, Acc: 0.909, Base Lr: 2.77e-03
2022-04-20 06:47:27,440 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-20 06:49:05,082 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.448117971420288 
2022-04-20 06:49:05,083 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 06:49:05,083 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 144.8%
2022-04-20 06:49:40,847 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.327, Acc: 0.910, Base Lr: 2.20e-03
2022-04-20 06:49:59,093 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.355[s] Speed: 45.0[samples/s]
2022-04-20 06:51:39,138 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.4685434103012085 
2022-04-20 06:51:39,140 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 06:51:39,140 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 146.9%
2022-04-20 06:52:13,568 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.338, Acc: 0.918, Base Lr: 1.66e-03
2022-04-20 06:52:31,706 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.346[s] Speed: 46.3[samples/s]
2022-04-20 06:54:15,871 reid_baseline.train INFO: normal accuracy 0.8333715859536378 1.3862227201461792 
2022-04-20 06:54:16,770 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 06:54:16,770 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 138.6%
2022-04-20 06:54:55,813 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.264, Acc: 0.942, Base Lr: 1.19e-03
2022-04-20 06:55:12,839 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-04-20 06:56:52,536 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.498262643814087 
2022-04-20 06:56:52,537 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 06:56:52,537 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 149.8%
2022-04-20 06:57:28,042 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.216, Acc: 0.937, Base Lr: 7.78e-04
2022-04-20 06:57:45,422 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.348[s] Speed: 46.0[samples/s]
2022-04-20 06:59:27,255 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.3980138301849365 
2022-04-20 06:59:27,257 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 06:59:27,257 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 139.8%
2022-04-20 07:00:02,507 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.245, Acc: 0.940, Base Lr: 4.51e-04
2022-04-20 07:00:17,976 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.334[s] Speed: 48.0[samples/s]
2022-04-20 07:02:01,628 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4392848014831543 
2022-04-20 07:02:01,629 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 07:02:01,629 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 143.9%
2022-04-20 07:02:36,370 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.237, Acc: 0.931, Base Lr: 2.11e-04
2022-04-20 07:02:55,455 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-20 07:04:35,404 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.5016039609909058 
2022-04-20 07:04:35,406 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 07:04:35,406 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 150.2%
2022-04-20 07:05:05,909 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.295, Acc: 0.930, Base Lr: 6.51e-05
2022-04-20 07:05:17,899 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.279[s] Speed: 57.4[samples/s]
2022-04-20 07:06:55,463 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.4470065832138062 
2022-04-20 07:06:55,465 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 07:06:55,465 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 144.7%
2022-04-20 07:07:29,545 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.300, Acc: 0.934, Base Lr: 1.60e-05
2022-04-20 07:07:46,801 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-20 07:09:28,334 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.4653104543685913 
2022-04-20 07:09:28,336 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 07:09:28,336 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_3/transformer_best_model.pth
2022-04-20 07:11:12,209 reid_baseline.train INFO: normal accuracy 0.8333715859536378 1.3862227201461792 
2022-04-20 07:11:12,209 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:11:12,209 reid_baseline.train INFO: Accuracy: 83.3%
2022-04-20 07:12:42,839 reid_baseline.train INFO: normal accuracy 0.8333715859536378 1.3862227201461792 
2022-04-20 07:12:42,840 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:12:42,840 reid_baseline.train INFO: Shuffled Accuracy: 83.3%
2022-04-20 07:13:15,622 reid_baseline.train INFO: normal accuracy 0.9748660898228265 0.8000444173812866 
2022-04-20 07:13:15,622 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:13:15,622 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-04-20 07:13:21,398 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_4
2022-04-20 07:13:21,398 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-20 07:13:21,399 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 07:13:21,399 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 07:13:21,399 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 07:13:32,955 reid_baseline.train INFO: start training
2022-04-20 07:14:16,661 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.284, Acc: 0.311, Base Lr: 8.72e-04
2022-04-20 07:14:34,364 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.391[s] Speed: 40.9[samples/s]
2022-04-20 07:15:13,982 reid_baseline.train INFO: normal accuracy 0.4052691867124857 4.171594619750977 
2022-04-20 07:15:14,878 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 07:15:14,878 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 417.2%
2022-04-20 07:15:50,994 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.984, Acc: 0.588, Base Lr: 1.66e-03
2022-04-20 07:16:07,322 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.345[s] Speed: 46.4[samples/s]
2022-04-20 07:16:47,624 reid_baseline.train INFO: normal accuracy 0.4323024054982818 4.150429725646973 
2022-04-20 07:16:48,499 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 07:16:48,499 reid_baseline.train INFO: Accuracy: 43.2% Mean Entropy: 415.0%
2022-04-20 07:17:23,702 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.387, Acc: 0.620, Base Lr: 2.46e-03
2022-04-20 07:17:41,356 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-20 07:18:21,086 reid_baseline.train INFO: normal accuracy 0.43986254295532645 3.981472969055176 
2022-04-20 07:18:21,942 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 07:18:21,943 reid_baseline.train INFO: Accuracy: 44.0% Mean Entropy: 398.1%
2022-04-20 07:18:55,731 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.549, Acc: 0.655, Base Lr: 3.25e-03
2022-04-20 07:19:12,599 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.333[s] Speed: 48.0[samples/s]
2022-04-20 07:19:52,352 reid_baseline.train INFO: normal accuracy 0.4925544100801833 3.4679083824157715 
2022-04-20 07:19:53,230 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 07:19:53,230 reid_baseline.train INFO: Accuracy: 49.3% Mean Entropy: 346.8%
2022-04-20 07:20:24,328 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.074, Acc: 0.725, Base Lr: 4.04e-03
2022-04-20 07:20:40,635 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.311[s] Speed: 51.5[samples/s]
2022-04-20 07:21:21,478 reid_baseline.train INFO: normal accuracy 0.5502863688430699 2.9909069538116455 
2022-04-20 07:21:22,365 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 07:21:22,365 reid_baseline.train INFO: Accuracy: 55.0% Mean Entropy: 299.1%
2022-04-20 07:21:56,860 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.764, Acc: 0.801, Base Lr: 4.83e-03
2022-04-20 07:22:13,562 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-20 07:22:53,810 reid_baseline.train INFO: normal accuracy 0.5922107674684994 2.5498502254486084 
2022-04-20 07:22:54,688 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 07:22:54,688 reid_baseline.train INFO: Accuracy: 59.2% Mean Entropy: 255.0%
2022-04-20 07:23:30,591 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.690, Acc: 0.825, Base Lr: 5.62e-03
2022-04-20 07:23:47,974 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.350[s] Speed: 45.7[samples/s]
2022-04-20 07:24:27,044 reid_baseline.train INFO: normal accuracy 0.6080183276059564 2.283799886703491 
2022-04-20 07:24:27,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 07:24:27,933 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 228.4%
2022-04-20 07:25:01,100 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.539, Acc: 0.862, Base Lr: 6.42e-03
2022-04-20 07:25:17,995 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-20 07:25:57,923 reid_baseline.train INFO: normal accuracy 0.6194730813287515 2.1632566452026367 
2022-04-20 07:25:58,695 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 07:25:58,695 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 216.3%
2022-04-20 07:26:30,633 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.476, Acc: 0.882, Base Lr: 7.21e-03
2022-04-20 07:26:45,395 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.307[s] Speed: 52.1[samples/s]
2022-04-20 07:27:22,075 reid_baseline.train INFO: normal accuracy 0.6178694158075602 1.9428153038024902 
2022-04-20 07:27:22,960 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 07:27:22,960 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 194.3%
2022-04-20 07:27:58,308 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.397, Acc: 0.902, Base Lr: 4.01e-03
2022-04-20 07:28:15,129 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-20 07:28:57,204 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.9275263547897339 
2022-04-20 07:28:58,092 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 07:28:58,092 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 192.8%
2022-04-20 07:29:32,507 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.357, Acc: 0.903, Base Lr: 3.38e-03
2022-04-20 07:29:51,024 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.348[s] Speed: 45.9[samples/s]
2022-04-20 07:30:31,255 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.900602102279663 
2022-04-20 07:30:32,126 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 07:30:32,126 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 190.1%
2022-04-20 07:31:04,596 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.337, Acc: 0.925, Base Lr: 2.77e-03
2022-04-20 07:31:20,280 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.316[s] Speed: 50.7[samples/s]
2022-04-20 07:31:59,534 reid_baseline.train INFO: normal accuracy 0.6306987399770905 1.9021010398864746 
2022-04-20 07:31:59,536 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 07:31:59,536 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 190.2%
2022-04-20 07:32:35,224 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.352, Acc: 0.912, Base Lr: 2.20e-03
2022-04-20 07:32:50,384 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.334[s] Speed: 47.9[samples/s]
2022-04-20 07:33:29,759 reid_baseline.train INFO: normal accuracy 0.6329896907216495 1.8656601905822754 
2022-04-20 07:33:30,645 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 07:33:30,645 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 186.6%
2022-04-20 07:34:05,458 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.374, Acc: 0.925, Base Lr: 1.66e-03
2022-04-20 07:34:21,985 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.337[s] Speed: 47.4[samples/s]
2022-04-20 07:35:01,905 reid_baseline.train INFO: normal accuracy 0.627262313860252 1.85592782497406 
2022-04-20 07:35:02,775 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 07:35:02,775 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 185.6%
2022-04-20 07:35:37,373 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.291, Acc: 0.935, Base Lr: 1.19e-03
2022-04-20 07:35:54,163 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-20 07:36:33,839 reid_baseline.train INFO: normal accuracy 0.6304696449026346 1.8502684831619263 
2022-04-20 07:36:34,759 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 07:36:34,759 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 185.0%
2022-04-20 07:37:08,049 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.303, Acc: 0.935, Base Lr: 7.78e-04
2022-04-20 07:37:25,005 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.330[s] Speed: 48.4[samples/s]
2022-04-20 07:38:04,850 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.8053697347640991 
2022-04-20 07:38:05,808 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 07:38:05,808 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 180.5%
2022-04-20 07:38:41,469 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.323, Acc: 0.933, Base Lr: 4.51e-04
2022-04-20 07:38:57,745 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-20 07:39:37,654 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.788345217704773 
2022-04-20 07:39:38,578 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 07:39:38,579 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 178.8%
2022-04-20 07:40:13,078 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.256, Acc: 0.933, Base Lr: 2.11e-04
2022-04-20 07:40:29,974 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-20 07:41:10,137 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.8228341341018677 
2022-04-20 07:41:10,137 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 07:41:10,137 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 182.3%
2022-04-20 07:41:44,707 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.294, Acc: 0.939, Base Lr: 6.51e-05
2022-04-20 07:42:01,378 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-20 07:42:40,276 reid_baseline.train INFO: normal accuracy 0.6286368843069874 1.8332616090774536 
2022-04-20 07:42:40,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 07:42:40,277 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 183.3%
2022-04-20 07:43:12,768 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.268, Acc: 0.934, Base Lr: 1.60e-05
2022-04-20 07:43:29,188 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.320[s] Speed: 49.9[samples/s]
2022-04-20 07:44:08,458 reid_baseline.train INFO: normal accuracy 0.6290950744558992 1.809105396270752 
2022-04-20 07:44:08,458 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 07:44:08,459 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 180.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_4/transformer_best_model.pth
2022-04-20 07:44:48,225 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.788345217704773 
2022-04-20 07:44:48,225 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:44:48,225 reid_baseline.train INFO: Accuracy: 63.0%
2022-04-20 07:45:22,394 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.788345217704773 
2022-04-20 07:45:22,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:45:22,394 reid_baseline.train INFO: Shuffled Accuracy: 63.0%
2022-04-20 07:45:55,457 reid_baseline.train INFO: normal accuracy 0.9773382777091059 0.7958753108978271 
2022-04-20 07:45:55,458 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 07:45:55,458 reid_baseline.train INFO: Source Clean Accuracy: 97.7%
2022-04-20 07:46:01,068 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_4
2022-04-20 07:46:01,068 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4, dom_cls=False)
2022-04-20 07:46:01,068 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 07:46:01,068 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 07:46:01,069 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 07:46:11,867 reid_baseline.train INFO: start training
2022-04-20 07:46:54,668 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.284, Acc: 0.311, Base Lr: 8.72e-04
2022-04-20 07:47:16,771 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.415[s] Speed: 38.6[samples/s]
2022-04-20 07:48:51,037 reid_baseline.train INFO: normal accuracy 0.6001836125774616 4.171509265899658 
2022-04-20 07:48:51,908 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 07:48:51,908 reid_baseline.train INFO: Accuracy: 60.0% Mean Entropy: 417.2%
2022-04-20 07:49:26,503 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.984, Acc: 0.588, Base Lr: 1.66e-03
2022-04-20 07:49:47,562 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.365[s] Speed: 43.8[samples/s]
2022-04-20 07:51:29,138 reid_baseline.train INFO: normal accuracy 0.627495983474868 4.13803768157959 
2022-04-20 07:51:29,992 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 07:51:29,992 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 413.8%
2022-04-20 07:52:07,133 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.386, Acc: 0.620, Base Lr: 2.46e-03
2022-04-20 07:52:25,936 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.368[s] Speed: 43.5[samples/s]
2022-04-20 07:54:04,534 reid_baseline.train INFO: normal accuracy 0.6300206564149644 3.8500683307647705 
2022-04-20 07:54:05,429 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 07:54:05,430 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 385.0%
2022-04-20 07:54:40,239 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.549, Acc: 0.656, Base Lr: 3.25e-03
2022-04-20 07:54:57,070 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.340[s] Speed: 47.1[samples/s]
2022-04-20 07:56:37,676 reid_baseline.train INFO: normal accuracy 0.681661693826027 3.1142516136169434 
2022-04-20 07:56:38,562 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 07:56:38,563 reid_baseline.train INFO: Accuracy: 68.2% Mean Entropy: 311.4%
2022-04-20 07:57:13,610 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.074, Acc: 0.725, Base Lr: 4.04e-03
2022-04-20 07:57:29,413 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.334[s] Speed: 47.9[samples/s]
2022-04-20 07:59:12,450 reid_baseline.train INFO: normal accuracy 0.740876750057379 2.52169132232666 
2022-04-20 07:59:13,343 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 07:59:13,343 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 252.2%
2022-04-20 07:59:47,523 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.764, Acc: 0.801, Base Lr: 4.83e-03
2022-04-20 08:00:07,066 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.352[s] Speed: 45.4[samples/s]
2022-04-20 08:01:50,011 reid_baseline.train INFO: normal accuracy 0.7929768189120955 2.0449576377868652 
2022-04-20 08:01:50,880 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 08:01:50,880 reid_baseline.train INFO: Accuracy: 79.3% Mean Entropy: 204.5%
2022-04-20 08:02:26,234 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.690, Acc: 0.825, Base Lr: 5.62e-03
2022-04-20 08:02:43,703 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-20 08:04:24,796 reid_baseline.train INFO: normal accuracy 0.8088134037181547 1.7955299615859985 
2022-04-20 08:04:25,596 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 08:04:25,596 reid_baseline.train INFO: Accuracy: 80.9% Mean Entropy: 179.6%
2022-04-20 08:05:01,107 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.539, Acc: 0.862, Base Lr: 6.42e-03
2022-04-20 08:05:18,752 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-04-20 08:06:57,592 reid_baseline.train INFO: normal accuracy 0.8184530640348864 1.678629994392395 
2022-04-20 08:06:58,496 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 08:06:58,496 reid_baseline.train INFO: Accuracy: 81.8% Mean Entropy: 167.9%
2022-04-20 08:07:31,039 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.476, Acc: 0.882, Base Lr: 7.21e-03
2022-04-20 08:07:51,209 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-20 08:09:28,741 reid_baseline.train INFO: normal accuracy 0.8221253155841175 1.4866600036621094 
2022-04-20 08:09:29,606 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 08:09:29,607 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 148.7%
2022-04-20 08:10:06,709 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.397, Acc: 0.902, Base Lr: 4.01e-03
2022-04-20 08:10:23,780 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.355[s] Speed: 45.1[samples/s]
2022-04-20 08:12:03,493 reid_baseline.train INFO: normal accuracy 0.8260270828551756 1.4919971227645874 
2022-04-20 08:12:03,495 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 08:12:03,495 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 149.2%
2022-04-20 08:12:37,724 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.357, Acc: 0.901, Base Lr: 3.38e-03
2022-04-20 08:12:55,715 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.343[s] Speed: 46.7[samples/s]
2022-04-20 08:14:40,616 reid_baseline.train INFO: normal accuracy 0.828322240073445 1.468838095664978 
2022-04-20 08:14:41,467 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 08:14:41,468 reid_baseline.train INFO: Accuracy: 82.8% Mean Entropy: 146.9%
2022-04-20 08:15:16,228 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.337, Acc: 0.925, Base Lr: 2.77e-03
2022-04-20 08:15:32,170 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.334[s] Speed: 48.0[samples/s]
2022-04-20 08:17:12,572 reid_baseline.train INFO: normal accuracy 0.828551755795272 1.4770320653915405 
2022-04-20 08:17:12,573 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 08:17:12,573 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 147.7%
2022-04-20 08:17:52,118 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.351, Acc: 0.912, Base Lr: 2.20e-03
2022-04-20 08:18:10,789 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-04-20 08:19:50,400 reid_baseline.train INFO: normal accuracy 0.83245352306633 1.4459059238433838 
2022-04-20 08:19:51,231 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 08:19:51,232 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 144.6%
2022-04-20 08:20:25,553 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.374, Acc: 0.925, Base Lr: 1.66e-03
2022-04-20 08:20:42,239 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.335[s] Speed: 47.7[samples/s]
2022-04-20 08:22:20,677 reid_baseline.train INFO: normal accuracy 0.8331420702318109 1.444421410560608 
2022-04-20 08:22:21,517 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 08:22:21,517 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 144.4%
2022-04-20 08:22:56,040 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.290, Acc: 0.935, Base Lr: 1.19e-03
2022-04-20 08:23:12,506 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.335[s] Speed: 47.7[samples/s]
2022-04-20 08:24:53,583 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.4422738552093506 
2022-04-20 08:24:54,555 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 08:24:54,555 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 144.2%
2022-04-20 08:25:28,729 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.303, Acc: 0.935, Base Lr: 7.78e-04
2022-04-20 08:25:50,030 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.364[s] Speed: 44.0[samples/s]
2022-04-20 08:27:31,142 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.3986741304397583 
2022-04-20 08:27:32,032 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 08:27:32,033 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 139.9%
2022-04-20 08:28:08,709 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.323, Acc: 0.933, Base Lr: 4.51e-04
2022-04-20 08:28:28,896 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-04-20 08:30:08,710 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.3734766244888306 
2022-04-20 08:30:09,534 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 08:30:09,534 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 137.3%
2022-04-20 08:30:42,440 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.256, Acc: 0.934, Base Lr: 2.11e-04
2022-04-20 08:30:59,179 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.326[s] Speed: 49.1[samples/s]
2022-04-20 08:32:38,675 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4177055358886719 
2022-04-20 08:32:38,675 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 08:32:38,676 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 141.8%
2022-04-20 08:33:16,039 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.294, Acc: 0.939, Base Lr: 6.51e-05
2022-04-20 08:33:31,459 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.347[s] Speed: 46.2[samples/s]
2022-04-20 08:35:17,573 reid_baseline.train INFO: normal accuracy 0.8319944916226761 1.4263339042663574 
2022-04-20 08:35:17,573 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 08:35:17,574 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 142.6%
2022-04-20 08:35:50,140 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.268, Acc: 0.935, Base Lr: 1.60e-05
2022-04-20 08:36:06,012 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.318[s] Speed: 50.4[samples/s]
2022-04-20 08:37:46,890 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.4090688228607178 
2022-04-20 08:37:46,893 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 08:37:46,893 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 140.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_4/transformer_best_model.pth
2022-04-20 08:39:32,963 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.3734766244888306 
2022-04-20 08:39:32,963 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 08:39:32,963 reid_baseline.train INFO: Accuracy: 83.5%
2022-04-20 08:41:05,685 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.3734766244888306 
2022-04-20 08:41:05,686 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 08:41:05,686 reid_baseline.train INFO: Shuffled Accuracy: 83.5%
2022-04-20 08:41:39,150 reid_baseline.train INFO: normal accuracy 0.9773382777091059 0.7956576943397522 
2022-04-20 08:41:39,150 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 08:41:39,150 reid_baseline.train INFO: Source Clean Accuracy: 97.7%
2022-04-20 08:41:44,685 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_6
2022-04-20 08:41:44,685 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-20 08:41:44,686 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 08:41:44,686 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 08:41:44,686 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 08:41:56,544 reid_baseline.train INFO: start training
2022-04-20 08:42:40,827 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.296, Acc: 0.315, Base Lr: 8.72e-04
2022-04-20 08:42:57,346 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.391[s] Speed: 40.9[samples/s]
2022-04-20 08:43:35,585 reid_baseline.train INFO: normal accuracy 0.3951890034364261 4.171573638916016 
2022-04-20 08:43:36,379 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 08:43:36,379 reid_baseline.train INFO: Accuracy: 39.5% Mean Entropy: 417.2%
2022-04-20 08:44:10,592 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.987, Acc: 0.571, Base Lr: 1.66e-03
2022-04-20 08:44:26,361 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.329[s] Speed: 48.7[samples/s]
2022-04-20 08:45:06,694 reid_baseline.train INFO: normal accuracy 0.4270332187857961 4.149602890014648 
2022-04-20 08:45:07,492 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 08:45:07,492 reid_baseline.train INFO: Accuracy: 42.7% Mean Entropy: 415.0%
2022-04-20 08:45:41,625 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.359, Acc: 0.633, Base Lr: 2.46e-03
2022-04-20 08:45:57,966 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.332[s] Speed: 48.2[samples/s]
2022-04-20 08:46:37,695 reid_baseline.train INFO: normal accuracy 0.44604810996563576 3.975512981414795 
2022-04-20 08:46:38,546 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 08:46:38,546 reid_baseline.train INFO: Accuracy: 44.6% Mean Entropy: 397.6%
2022-04-20 08:47:13,493 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.582, Acc: 0.678, Base Lr: 3.25e-03
2022-04-20 08:47:30,240 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.339[s] Speed: 47.1[samples/s]
2022-04-20 08:48:09,739 reid_baseline.train INFO: normal accuracy 0.488659793814433 3.4783735275268555 
2022-04-20 08:48:10,705 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 08:48:10,705 reid_baseline.train INFO: Accuracy: 48.9% Mean Entropy: 347.8%
2022-04-20 08:48:42,251 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.137, Acc: 0.730, Base Lr: 4.04e-03
2022-04-20 08:48:59,176 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-20 08:49:38,836 reid_baseline.train INFO: normal accuracy 0.5512027491408935 2.9928574562072754 
2022-04-20 08:49:39,720 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 08:49:39,721 reid_baseline.train INFO: Accuracy: 55.1% Mean Entropy: 299.3%
2022-04-20 08:50:15,676 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.891, Acc: 0.777, Base Lr: 4.83e-03
2022-04-20 08:50:33,368 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.353[s] Speed: 45.3[samples/s]
2022-04-20 08:51:14,326 reid_baseline.train INFO: normal accuracy 0.5972508591065292 2.671177864074707 
2022-04-20 08:51:15,204 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 08:51:15,205 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 267.1%
2022-04-20 08:51:50,356 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.671, Acc: 0.827, Base Lr: 5.62e-03
2022-04-20 08:52:07,047 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-20 08:52:47,001 reid_baseline.train INFO: normal accuracy 0.6142038946162658 2.3663556575775146 
2022-04-20 08:52:47,850 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 08:52:47,850 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 236.6%
2022-04-20 08:53:22,653 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.561, Acc: 0.836, Base Lr: 6.42e-03
2022-04-20 08:53:39,700 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-20 08:54:19,404 reid_baseline.train INFO: normal accuracy 0.624971363115693 2.1250193119049072 
2022-04-20 08:54:20,312 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 08:54:20,312 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 212.5%
2022-04-20 08:54:54,885 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.483, Acc: 0.874, Base Lr: 7.21e-03
2022-04-20 08:55:08,125 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.314[s] Speed: 50.9[samples/s]
2022-04-20 08:55:48,296 reid_baseline.train INFO: normal accuracy 0.6293241695303551 1.9019099473953247 
2022-04-20 08:55:49,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 08:55:49,123 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 190.2%
2022-04-20 08:56:24,268 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.481, Acc: 0.891, Base Lr: 4.01e-03
2022-04-20 08:56:41,018 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-20 08:57:23,008 reid_baseline.train INFO: normal accuracy 0.6263459335624284 1.9819852113723755 
2022-04-20 08:57:23,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 08:57:23,011 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 198.2%
2022-04-20 08:57:57,725 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.351, Acc: 0.911, Base Lr: 3.38e-03
2022-04-20 08:58:14,658 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-20 08:58:53,814 reid_baseline.train INFO: normal accuracy 0.6233676975945017 1.845245599746704 
2022-04-20 08:58:54,762 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 08:58:54,762 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 184.5%
2022-04-20 08:59:27,434 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.280, Acc: 0.919, Base Lr: 2.77e-03
2022-04-20 08:59:43,633 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-20 09:00:22,410 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.9102381467819214 
2022-04-20 09:00:22,411 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 09:00:22,411 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 191.0%
2022-04-20 09:00:57,595 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.300, Acc: 0.917, Base Lr: 2.20e-03
2022-04-20 09:01:14,778 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-20 09:01:54,781 reid_baseline.train INFO: normal accuracy 0.6284077892325315 1.9108257293701172 
2022-04-20 09:01:54,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 09:01:54,783 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 191.1%
2022-04-20 09:02:29,737 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.268, Acc: 0.928, Base Lr: 1.66e-03
2022-04-20 09:02:46,280 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.338[s] Speed: 47.4[samples/s]
2022-04-20 09:03:24,647 reid_baseline.train INFO: normal accuracy 0.629553264604811 1.876631736755371 
2022-04-20 09:03:24,649 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 09:03:24,651 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 187.7%
2022-04-20 09:03:58,716 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.319, Acc: 0.930, Base Lr: 1.19e-03
2022-04-20 09:04:15,138 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.330[s] Speed: 48.4[samples/s]
2022-04-20 09:04:53,761 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.8093571662902832 
2022-04-20 09:04:54,631 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 09:04:54,632 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 180.9%
2022-04-20 09:05:26,233 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.300, Acc: 0.927, Base Lr: 7.78e-04
2022-04-20 09:05:42,666 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.316[s] Speed: 50.7[samples/s]
2022-04-20 09:06:22,603 reid_baseline.train INFO: normal accuracy 0.63184421534937 1.820922613143921 
2022-04-20 09:06:22,605 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 09:06:22,605 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 182.1%
2022-04-20 09:06:56,802 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.257, Acc: 0.935, Base Lr: 4.51e-04
2022-04-20 09:07:13,781 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.335[s] Speed: 47.7[samples/s]
2022-04-20 09:07:53,636 reid_baseline.train INFO: normal accuracy 0.6290950744558992 1.8591318130493164 
2022-04-20 09:07:53,639 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 09:07:53,639 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 185.9%
2022-04-20 09:08:29,265 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.273, Acc: 0.937, Base Lr: 2.11e-04
2022-04-20 09:08:45,929 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.343[s] Speed: 46.6[samples/s]
2022-04-20 09:09:26,625 reid_baseline.train INFO: normal accuracy 0.63184421534937 1.8211711645126343 
2022-04-20 09:09:26,626 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 09:09:26,626 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 182.1%
2022-04-20 09:09:59,183 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.272, Acc: 0.944, Base Lr: 6.51e-05
2022-04-20 09:10:14,886 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-20 09:10:56,701 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.820051670074463 
2022-04-20 09:10:56,704 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 09:10:56,704 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 182.0%
2022-04-20 09:11:34,647 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.264, Acc: 0.928, Base Lr: 1.60e-05
2022-04-20 09:11:50,325 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.352[s] Speed: 45.4[samples/s]
2022-04-20 09:12:30,019 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.8551219701766968 
2022-04-20 09:12:30,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 09:12:30,021 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 185.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_6/transformer_best_model.pth
2022-04-20 09:13:10,122 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.8093571662902832 
2022-04-20 09:13:10,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 09:13:10,122 reid_baseline.train INFO: Accuracy: 63.0%
2022-04-20 09:13:47,959 reid_baseline.train INFO: normal accuracy 0.6300114547537228 1.8093571662902832 
2022-04-20 09:13:47,960 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 09:13:47,960 reid_baseline.train INFO: Shuffled Accuracy: 63.0%
2022-04-20 09:14:19,844 reid_baseline.train INFO: normal accuracy 0.9765142150803461 0.8217922449111938 
2022-04-20 09:14:19,844 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 09:14:19,844 reid_baseline.train INFO: Source Clean Accuracy: 97.7%
2022-04-20 09:14:25,722 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_6
2022-04-20 09:14:25,722 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6, dom_cls=False)
2022-04-20 09:14:25,722 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 09:14:25,722 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 09:14:25,723 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 09:14:36,949 reid_baseline.train INFO: start training
2022-04-20 09:15:22,005 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.296, Acc: 0.316, Base Lr: 8.72e-04
2022-04-20 09:15:40,643 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.409[s] Speed: 39.2[samples/s]
2022-04-20 09:17:21,437 reid_baseline.train INFO: normal accuracy 0.5990360339683268 4.171485424041748 
2022-04-20 09:17:22,281 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 09:17:22,281 reid_baseline.train INFO: Accuracy: 59.9% Mean Entropy: 417.1%
2022-04-20 09:17:58,363 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.987, Acc: 0.571, Base Lr: 1.66e-03
2022-04-20 09:18:15,871 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.353[s] Speed: 45.4[samples/s]
2022-04-20 09:19:54,677 reid_baseline.train INFO: normal accuracy 0.6263484048657333 4.136027812957764 
2022-04-20 09:19:55,559 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 09:19:55,560 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 413.6%
2022-04-20 09:20:33,923 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.359, Acc: 0.633, Base Lr: 2.46e-03
2022-04-20 09:20:49,734 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.356[s] Speed: 44.9[samples/s]
2022-04-20 09:22:31,797 reid_baseline.train INFO: normal accuracy 0.6350700022951572 3.839650869369507 
2022-04-20 09:22:32,663 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 09:22:32,663 reid_baseline.train INFO: Accuracy: 63.5% Mean Entropy: 384.0%
2022-04-20 09:23:07,058 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.583, Acc: 0.678, Base Lr: 3.25e-03
2022-04-20 09:23:23,602 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-20 09:24:59,751 reid_baseline.train INFO: normal accuracy 0.6791370208859306 3.132262945175171 
2022-04-20 09:25:00,576 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 09:25:00,576 reid_baseline.train INFO: Accuracy: 67.9% Mean Entropy: 313.2%
2022-04-20 09:25:35,379 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.138, Acc: 0.730, Base Lr: 4.04e-03
2022-04-20 09:25:52,829 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.343[s] Speed: 46.7[samples/s]
2022-04-20 09:27:34,104 reid_baseline.train INFO: normal accuracy 0.736745467064494 2.512711524963379 
2022-04-20 09:27:34,992 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 09:27:34,992 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 251.3%
2022-04-20 09:28:11,555 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.891, Acc: 0.777, Base Lr: 4.83e-03
2022-04-20 09:28:28,847 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.354[s] Speed: 45.2[samples/s]
2022-04-20 09:30:06,868 reid_baseline.train INFO: normal accuracy 0.7844847372044985 2.147028923034668 
2022-04-20 09:30:07,763 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 09:30:07,764 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 214.7%
2022-04-20 09:30:42,412 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.671, Acc: 0.827, Base Lr: 5.62e-03
2022-04-20 09:30:59,321 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-20 09:32:39,838 reid_baseline.train INFO: normal accuracy 0.8104200137709433 1.8372840881347656 
2022-04-20 09:32:40,733 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 09:32:40,733 reid_baseline.train INFO: Accuracy: 81.0% Mean Entropy: 183.7%
2022-04-20 09:33:15,400 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.562, Acc: 0.836, Base Lr: 6.42e-03
2022-04-20 09:33:32,016 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.337[s] Speed: 47.5[samples/s]
2022-04-20 09:35:15,299 reid_baseline.train INFO: normal accuracy 0.820059674087675 1.647642970085144 
2022-04-20 09:35:16,193 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 09:35:16,194 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 164.8%
2022-04-20 09:35:51,096 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.483, Acc: 0.876, Base Lr: 7.21e-03
2022-04-20 09:36:10,469 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.356[s] Speed: 44.9[samples/s]
2022-04-20 09:37:45,986 reid_baseline.train INFO: normal accuracy 0.8232728941932522 1.4436742067337036 
2022-04-20 09:37:46,865 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 09:37:46,865 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 144.4%
2022-04-20 09:38:23,636 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.481, Acc: 0.892, Base Lr: 4.01e-03
2022-04-20 09:38:39,843 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.347[s] Speed: 46.1[samples/s]
2022-04-20 09:40:24,351 reid_baseline.train INFO: normal accuracy 0.8292403029607528 1.549741268157959 
2022-04-20 09:40:24,353 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 09:40:24,353 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 155.0%
2022-04-20 09:40:59,248 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.352, Acc: 0.911, Base Lr: 3.38e-03
2022-04-20 09:41:15,874 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-20 09:42:56,271 reid_baseline.train INFO: normal accuracy 0.8329125545099839 1.413878321647644 
2022-04-20 09:42:57,086 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 09:42:57,086 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 141.4%
2022-04-20 09:43:29,793 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.280, Acc: 0.920, Base Lr: 2.77e-03
2022-04-20 09:43:48,680 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-20 09:45:30,031 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.5041760206222534 
2022-04-20 09:45:30,034 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 09:45:30,034 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 150.4%
2022-04-20 09:46:07,550 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.301, Acc: 0.917, Base Lr: 2.20e-03
2022-04-20 09:46:25,480 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.365[s] Speed: 43.9[samples/s]
2022-04-20 09:48:03,406 reid_baseline.train INFO: normal accuracy 0.8342896488409456 1.5027079582214355 
2022-04-20 09:48:03,406 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 09:48:03,407 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 150.3%
2022-04-20 09:48:37,341 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.267, Acc: 0.929, Base Lr: 1.66e-03
2022-04-20 09:48:54,291 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-20 09:50:33,844 reid_baseline.train INFO: normal accuracy 0.8377323846683498 1.4663499593734741 
2022-04-20 09:50:33,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 09:50:33,845 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 146.6%
2022-04-20 09:51:08,417 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.319, Acc: 0.929, Base Lr: 1.19e-03
2022-04-20 09:51:23,405 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.325[s] Speed: 49.2[samples/s]
2022-04-20 09:53:07,831 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.3951482772827148 
2022-04-20 09:53:08,730 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 09:53:08,730 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 139.5%
2022-04-20 09:53:45,476 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.300, Acc: 0.927, Base Lr: 7.78e-04
2022-04-20 09:54:02,184 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.351[s] Speed: 45.6[samples/s]
2022-04-20 09:55:36,192 reid_baseline.train INFO: normal accuracy 0.8375028689465228 1.4123024940490723 
2022-04-20 09:55:36,194 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 09:55:36,194 reid_baseline.train INFO: Accuracy: 83.8% Mean Entropy: 141.2%
2022-04-20 09:56:06,601 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.257, Acc: 0.936, Base Lr: 4.51e-04
2022-04-20 09:56:21,761 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.299[s] Speed: 53.5[samples/s]
2022-04-20 09:57:53,073 reid_baseline.train INFO: normal accuracy 0.8347486802845995 1.4604215621948242 
2022-04-20 09:57:53,075 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 09:57:53,075 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 146.0%
2022-04-20 09:58:26,342 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.274, Acc: 0.938, Base Lr: 2.11e-04
2022-04-20 09:58:42,247 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.323[s] Speed: 49.5[samples/s]
2022-04-20 10:00:14,130 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.4133358001708984 
2022-04-20 10:00:14,131 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 10:00:14,131 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 141.3%
2022-04-20 10:00:50,111 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.272, Acc: 0.944, Base Lr: 6.51e-05
2022-04-20 10:01:02,733 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.320[s] Speed: 50.0[samples/s]
2022-04-20 10:02:30,293 reid_baseline.train INFO: normal accuracy 0.8361257746155611 1.4172512292861938 
2022-04-20 10:02:30,294 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 10:02:30,294 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 141.7%
2022-04-20 10:03:04,550 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.265, Acc: 0.927, Base Lr: 1.60e-05
2022-04-20 10:03:21,801 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.338[s] Speed: 47.4[samples/s]
2022-04-20 10:04:54,251 reid_baseline.train INFO: normal accuracy 0.8349781960064264 1.458219289779663 
2022-04-20 10:04:54,253 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 10:04:54,253 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_6/transformer_best_model.pth
2022-04-20 10:06:22,672 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.3951482772827148 
2022-04-20 10:06:22,672 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 10:06:22,672 reid_baseline.train INFO: Accuracy: 83.6%
2022-04-20 10:07:44,763 reid_baseline.train INFO: normal accuracy 0.8363552903373881 1.3951482772827148 
2022-04-20 10:07:44,763 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 10:07:44,763 reid_baseline.train INFO: Shuffled Accuracy: 83.6%
2022-04-20 10:08:12,930 reid_baseline.train INFO: normal accuracy 0.9765142150803461 0.822265088558197 
2022-04-20 10:08:12,930 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 10:08:12,931 reid_baseline.train INFO: Source Clean Accuracy: 97.7%
2022-04-20 10:08:17,862 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_8
2022-04-20 10:08:17,863 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-20 10:08:17,863 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 10:08:17,863 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 10:08:17,863 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 10:08:29,672 reid_baseline.train INFO: start training
2022-04-20 10:09:12,737 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.268, Acc: 0.311, Base Lr: 8.72e-04
2022-04-20 10:09:30,271 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.389[s] Speed: 41.1[samples/s]
2022-04-20 10:10:06,670 reid_baseline.train INFO: normal accuracy 0.4041237113402062 4.171586990356445 
2022-04-20 10:10:07,429 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 10:10:07,429 reid_baseline.train INFO: Accuracy: 40.4% Mean Entropy: 417.2%
2022-04-20 10:10:41,136 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.921, Acc: 0.601, Base Lr: 1.66e-03
2022-04-20 10:10:58,312 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-20 10:11:37,593 reid_baseline.train INFO: normal accuracy 0.4284077892325315 4.150182723999023 
2022-04-20 10:11:39,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 10:11:39,783 reid_baseline.train INFO: Accuracy: 42.8% Mean Entropy: 415.0%
2022-04-20 10:12:13,649 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.339, Acc: 0.639, Base Lr: 2.46e-03
2022-04-20 10:12:29,855 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.329[s] Speed: 48.6[samples/s]
2022-04-20 10:13:06,746 reid_baseline.train INFO: normal accuracy 0.44902634593356244 3.976151943206787 
2022-04-20 10:13:07,519 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 10:13:07,519 reid_baseline.train INFO: Accuracy: 44.9% Mean Entropy: 397.6%
2022-04-20 10:13:39,406 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.584, Acc: 0.669, Base Lr: 3.25e-03
2022-04-20 10:13:55,584 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-20 10:14:33,113 reid_baseline.train INFO: normal accuracy 0.5005727376861397 3.4442222118377686 
2022-04-20 10:14:33,891 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 10:14:33,891 reid_baseline.train INFO: Accuracy: 50.1% Mean Entropy: 344.4%
2022-04-20 10:15:07,442 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.114, Acc: 0.724, Base Lr: 4.04e-03
2022-04-20 10:15:22,189 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.318[s] Speed: 50.4[samples/s]
2022-04-20 10:15:59,434 reid_baseline.train INFO: normal accuracy 0.5445589919816723 2.934086322784424 
2022-04-20 10:16:00,220 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 10:16:00,220 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 293.4%
2022-04-20 10:16:32,895 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.799, Acc: 0.787, Base Lr: 4.83e-03
2022-04-20 10:16:49,088 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.321[s] Speed: 49.9[samples/s]
2022-04-20 10:17:30,112 reid_baseline.train INFO: normal accuracy 0.5885452462772051 2.574523448944092 
2022-04-20 10:17:30,849 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 10:17:30,849 reid_baseline.train INFO: Accuracy: 58.9% Mean Entropy: 257.5%
2022-04-20 10:18:04,026 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.684, Acc: 0.810, Base Lr: 5.62e-03
2022-04-20 10:18:20,008 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.323[s] Speed: 49.5[samples/s]
2022-04-20 10:18:58,966 reid_baseline.train INFO: normal accuracy 0.6121420389461627 2.281306505203247 
2022-04-20 10:18:59,720 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 10:18:59,721 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 228.1%
2022-04-20 10:19:30,358 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.533, Acc: 0.867, Base Lr: 6.42e-03
2022-04-20 10:19:46,588 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.308[s] Speed: 52.0[samples/s]
2022-04-20 10:20:24,772 reid_baseline.train INFO: normal accuracy 0.6238258877434135 2.1063568592071533 
2022-04-20 10:20:25,557 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 10:20:25,557 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 210.6%
2022-04-20 10:20:58,875 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.493, Acc: 0.862, Base Lr: 7.21e-03
2022-04-20 10:21:13,114 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.313[s] Speed: 51.2[samples/s]
2022-04-20 10:21:50,893 reid_baseline.train INFO: normal accuracy 0.6217640320733104 1.933255910873413 
2022-04-20 10:21:51,744 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 10:21:51,745 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 193.3%
2022-04-20 10:22:24,504 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.398, Acc: 0.902, Base Lr: 4.01e-03
2022-04-20 10:22:40,748 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.321[s] Speed: 49.8[samples/s]
2022-04-20 10:23:21,003 reid_baseline.train INFO: normal accuracy 0.622680412371134 1.9553383588790894 
2022-04-20 10:23:21,006 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 10:23:21,006 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 195.5%
2022-04-20 10:23:53,178 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.371, Acc: 0.912, Base Lr: 3.38e-03
2022-04-20 10:24:09,350 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-20 10:24:46,609 reid_baseline.train INFO: normal accuracy 0.6261168384879725 1.8909337520599365 
2022-04-20 10:24:47,443 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 10:24:47,443 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 189.1%
2022-04-20 10:25:16,750 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.321, Acc: 0.911, Base Lr: 2.77e-03
2022-04-20 10:25:32,328 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.295[s] Speed: 54.3[samples/s]
2022-04-20 10:26:10,363 reid_baseline.train INFO: normal accuracy 0.6320733104238259 1.8812732696533203 
2022-04-20 10:26:11,139 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 10:26:11,139 reid_baseline.train INFO: Accuracy: 63.2% Mean Entropy: 188.1%
2022-04-20 10:26:44,920 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.296, Acc: 0.920, Base Lr: 2.20e-03
2022-04-20 10:26:59,529 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-20 10:27:38,359 reid_baseline.train INFO: normal accuracy 0.6224513172966781 1.797522783279419 
2022-04-20 10:27:39,141 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 10:27:39,142 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 179.8%
2022-04-20 10:28:13,540 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.330, Acc: 0.918, Base Lr: 1.66e-03
2022-04-20 10:28:30,111 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.335[s] Speed: 47.8[samples/s]
2022-04-20 10:29:05,529 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.9222508668899536 
2022-04-20 10:29:05,532 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 10:29:05,532 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 192.2%
2022-04-20 10:29:38,499 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.241, Acc: 0.929, Base Lr: 1.19e-03
2022-04-20 10:29:54,588 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.323[s] Speed: 49.6[samples/s]
2022-04-20 10:30:32,539 reid_baseline.train INFO: normal accuracy 0.6277205040091638 1.863726019859314 
2022-04-20 10:30:32,540 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 10:30:32,540 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.4%
2022-04-20 10:31:03,060 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.284, Acc: 0.924, Base Lr: 7.78e-04
2022-04-20 10:31:20,186 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.313[s] Speed: 51.1[samples/s]
2022-04-20 10:31:57,469 reid_baseline.train INFO: normal accuracy 0.6279495990836197 1.8670382499694824 
2022-04-20 10:31:57,471 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 10:31:57,471 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.7%
2022-04-20 10:32:32,866 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.293, Acc: 0.914, Base Lr: 4.51e-04
2022-04-20 10:32:53,123 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.365[s] Speed: 43.9[samples/s]
2022-04-20 10:33:28,539 reid_baseline.train INFO: normal accuracy 0.6277205040091638 1.8236641883850098 
2022-04-20 10:33:28,542 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 10:33:28,542 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 182.4%
2022-04-20 10:34:00,779 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.237, Acc: 0.929, Base Lr: 2.11e-04
2022-04-20 10:34:17,175 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.319[s] Speed: 50.2[samples/s]
2022-04-20 10:34:54,609 reid_baseline.train INFO: normal accuracy 0.6242840778923253 1.8298531770706177 
2022-04-20 10:34:54,610 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 10:34:54,610 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 183.0%
2022-04-20 10:35:32,990 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.289, Acc: 0.933, Base Lr: 6.51e-05
2022-04-20 10:35:48,989 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.357[s] Speed: 44.8[samples/s]
2022-04-20 10:36:26,696 reid_baseline.train INFO: normal accuracy 0.6302405498281787 1.8120265007019043 
2022-04-20 10:36:26,696 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 10:36:26,696 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 181.2%
2022-04-20 10:37:01,755 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.257, Acc: 0.931, Base Lr: 1.60e-05
2022-04-20 10:37:17,857 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.335[s] Speed: 47.7[samples/s]
2022-04-20 10:37:58,885 reid_baseline.train INFO: normal accuracy 0.6288659793814433 1.8322917222976685 
2022-04-20 10:37:58,886 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 10:37:58,886 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 183.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_CEL_8/transformer_best_model.pth
2022-04-20 10:38:38,683 reid_baseline.train INFO: normal accuracy 0.6224513172966781 1.797522783279419 
2022-04-20 10:38:38,684 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 10:38:38,684 reid_baseline.train INFO: Accuracy: 62.2%
2022-04-20 10:39:14,157 reid_baseline.train INFO: normal accuracy 0.6224513172966781 1.797522783279419 
2022-04-20 10:39:14,157 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 10:39:14,157 reid_baseline.train INFO: Shuffled Accuracy: 62.2%
2022-04-20 10:39:44,586 reid_baseline.train INFO: normal accuracy 0.9707457766790276 0.8293416500091553 
2022-04-20 10:39:44,587 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 10:39:44,587 reid_baseline.train INFO: Source Clean Accuracy: 97.1%
2022-04-20 10:39:49,978 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_8
2022-04-20 10:39:49,978 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_8', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False)
2022-04-20 10:39:49,978 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-20 10:39:49,978 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-20 10:39:49,978 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_8
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-20 10:40:00,500 reid_baseline.train INFO: start training
2022-04-20 10:40:45,812 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 6.268, Acc: 0.309, Base Lr: 8.72e-04
2022-04-20 10:41:04,158 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.412[s] Speed: 38.8[samples/s]
2022-04-20 10:42:33,174 reid_baseline.train INFO: normal accuracy 0.6022492540739041 4.171470642089844 
2022-04-20 10:42:33,949 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-20 10:42:33,949 reid_baseline.train INFO: Accuracy: 60.2% Mean Entropy: 417.1%
2022-04-20 10:43:08,126 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 5.921, Acc: 0.601, Base Lr: 1.66e-03
2022-04-20 10:43:26,259 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.344[s] Speed: 46.5[samples/s]
2022-04-20 10:44:52,520 reid_baseline.train INFO: normal accuracy 0.6222171218728483 4.134910583496094 
2022-04-20 10:44:53,305 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-20 10:44:53,305 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 413.5%
2022-04-20 10:45:31,278 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 5.339, Acc: 0.639, Base Lr: 2.46e-03
2022-04-20 10:45:47,331 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.355[s] Speed: 45.0[samples/s]
2022-04-20 10:47:16,796 reid_baseline.train INFO: normal accuracy 0.6408078953408308 3.840360164642334 
2022-04-20 10:47:17,565 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-20 10:47:17,565 reid_baseline.train INFO: Accuracy: 64.1% Mean Entropy: 384.0%
2022-04-20 10:47:49,472 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 4.584, Acc: 0.670, Base Lr: 3.25e-03
2022-04-20 10:48:05,816 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.316[s] Speed: 50.6[samples/s]
2022-04-20 10:49:31,069 reid_baseline.train INFO: normal accuracy 0.6846453982097773 3.107788324356079 
2022-04-20 10:49:31,904 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-20 10:49:31,904 reid_baseline.train INFO: Accuracy: 68.5% Mean Entropy: 310.8%
2022-04-20 10:50:07,258 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 4.113, Acc: 0.725, Base Lr: 4.04e-03
2022-04-20 10:50:23,559 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.338[s] Speed: 47.3[samples/s]
2022-04-20 10:51:50,715 reid_baseline.train INFO: normal accuracy 0.736745467064494 2.4373819828033447 
2022-04-20 10:51:51,478 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-20 10:51:51,478 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 243.7%
2022-04-20 10:52:24,221 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 3.799, Acc: 0.788, Base Lr: 4.83e-03
2022-04-20 10:52:38,007 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.305[s] Speed: 52.4[samples/s]
2022-04-20 10:54:09,662 reid_baseline.train INFO: normal accuracy 0.7856323158136332 2.05617356300354 
2022-04-20 10:54:10,459 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-20 10:54:10,460 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 205.6%
2022-04-20 10:54:47,808 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 3.684, Acc: 0.810, Base Lr: 5.62e-03
2022-04-20 10:55:04,008 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.351[s] Speed: 45.6[samples/s]
2022-04-20 10:56:36,230 reid_baseline.train INFO: normal accuracy 0.8108790452145972 1.7840298414230347 
2022-04-20 10:56:36,978 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-20 10:56:36,978 reid_baseline.train INFO: Accuracy: 81.1% Mean Entropy: 178.4%
2022-04-20 10:57:09,090 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 3.533, Acc: 0.867, Base Lr: 6.42e-03
2022-04-20 10:57:25,324 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.318[s] Speed: 50.3[samples/s]
2022-04-20 10:58:55,557 reid_baseline.train INFO: normal accuracy 0.8230433784714253 1.6410644054412842 
2022-04-20 10:58:56,382 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-20 10:58:56,382 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 164.1%
2022-04-20 10:59:31,210 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 3.493, Acc: 0.862, Base Lr: 7.21e-03
2022-04-20 10:59:47,975 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.339[s] Speed: 47.2[samples/s]
2022-04-20 11:01:18,514 reid_baseline.train INFO: normal accuracy 0.8251090199678678 1.5111597776412964 
2022-04-20 11:01:19,290 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-20 11:01:19,290 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 151.1%
2022-04-20 11:01:51,392 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 3.397, Acc: 0.901, Base Lr: 4.01e-03
2022-04-20 11:02:11,961 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.346[s] Speed: 46.2[samples/s]
2022-04-20 11:03:43,377 reid_baseline.train INFO: normal accuracy 0.8287812715170989 1.527400255203247 
2022-04-20 11:03:43,378 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-20 11:03:43,378 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 152.7%
2022-04-20 11:04:19,084 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 3.371, Acc: 0.912, Base Lr: 3.38e-03
2022-04-20 11:04:35,271 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.341[s] Speed: 46.9[samples/s]
2022-04-20 11:06:05,016 reid_baseline.train INFO: normal accuracy 0.8329125545099839 1.4652122259140015 
2022-04-20 11:06:05,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-04-20 11:06:05,792 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 146.5%
2022-04-20 11:06:38,541 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 3.321, Acc: 0.911, Base Lr: 2.77e-03
2022-04-20 11:06:54,821 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.323[s] Speed: 49.6[samples/s]
2022-04-20 11:08:24,550 reid_baseline.train INFO: normal accuracy 0.8329125545099839 1.4864859580993652 
2022-04-20 11:08:24,552 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-04-20 11:08:24,552 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 148.6%
2022-04-20 11:08:57,976 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 3.296, Acc: 0.920, Base Lr: 2.20e-03
2022-04-20 11:09:12,759 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.317[s] Speed: 50.5[samples/s]
2022-04-20 11:10:43,184 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.393434762954712 
2022-04-20 11:10:44,044 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-04-20 11:10:44,044 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 139.3%
2022-04-20 11:11:18,823 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 3.329, Acc: 0.919, Base Lr: 1.66e-03
2022-04-20 11:11:36,134 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.342[s] Speed: 46.8[samples/s]
2022-04-20 11:13:06,789 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.5159580707550049 
2022-04-20 11:13:06,792 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-04-20 11:13:06,792 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 151.6%
2022-04-20 11:13:31,754 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 3.241, Acc: 0.931, Base Lr: 1.19e-03
2022-04-20 11:13:41,859 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.231[s] Speed: 69.4[samples/s]
2022-04-20 11:15:04,654 reid_baseline.train INFO: normal accuracy 0.8338306173972917 1.4649975299835205 
2022-04-20 11:15:04,654 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-04-20 11:15:04,654 reid_baseline.train INFO: Accuracy: 83.4% Mean Entropy: 146.5%
2022-04-20 11:15:25,611 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 3.284, Acc: 0.925, Base Lr: 7.78e-04
2022-04-20 11:15:35,962 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.206[s] Speed: 77.7[samples/s]
2022-04-20 11:17:00,715 reid_baseline.train INFO: normal accuracy 0.8356667431719073 1.4676239490509033 
2022-04-20 11:17:00,715 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-04-20 11:17:00,715 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 146.8%
2022-04-20 11:17:21,881 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 3.293, Acc: 0.913, Base Lr: 4.51e-04
2022-04-20 11:17:31,700 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.204[s] Speed: 78.5[samples/s]
2022-04-20 11:18:57,948 reid_baseline.train INFO: normal accuracy 0.8358962588937342 1.4277979135513306 
2022-04-20 11:18:57,949 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-04-20 11:18:57,949 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 142.8%
2022-04-20 11:19:18,804 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 3.237, Acc: 0.929, Base Lr: 2.11e-04
2022-04-20 11:19:28,828 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.203[s] Speed: 78.9[samples/s]
2022-04-20 11:20:56,755 reid_baseline.train INFO: normal accuracy 0.8354372274500803 1.4352474212646484 
2022-04-20 11:20:56,755 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-04-20 11:20:56,755 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 143.5%
2022-04-20 11:21:18,046 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 3.289, Acc: 0.933, Base Lr: 6.51e-05
2022-04-20 11:21:28,456 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.208[s] Speed: 77.0[samples/s]
2022-04-20 11:22:54,053 reid_baseline.train INFO: normal accuracy 0.8370438375028689 1.4149305820465088 
2022-04-20 11:22:54,054 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-04-20 11:22:54,054 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 141.5%
2022-04-20 11:23:15,552 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 3.257, Acc: 0.931, Base Lr: 1.60e-05
2022-04-20 11:23:25,545 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.207[s] Speed: 77.5[samples/s]
2022-04-20 11:24:54,316 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4326452016830444 
2022-04-20 11:24:54,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-04-20 11:24:54,317 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 143.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_CEL_8/transformer_best_model.pth
2022-04-20 11:26:17,546 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.393434762954712 
2022-04-20 11:26:17,546 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 11:26:17,546 reid_baseline.train INFO: Accuracy: 83.1%
2022-04-20 11:27:36,423 reid_baseline.train INFO: normal accuracy 0.8308469130135414 1.393434762954712 
2022-04-20 11:27:36,423 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 11:27:36,423 reid_baseline.train INFO: Shuffled Accuracy: 83.1%
2022-04-20 11:28:03,315 reid_baseline.train INFO: normal accuracy 0.9707457766790276 0.8295005559921265 
2022-04-20 11:28:03,316 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-20 11:28:03,316 reid_baseline.train INFO: Source Clean Accuracy: 97.1%
