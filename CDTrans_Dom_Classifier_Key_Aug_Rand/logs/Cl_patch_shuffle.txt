2022-04-13 14:55:33,671 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2
2022-04-13 14:55:33,671 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=2)
2022-04-13 14:55:33,671 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 14:55:33,672 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 10
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 14:55:33,672 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 10
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 14:55:49,164 reid_baseline.train INFO: start training
2022-04-13 14:56:14,069 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.100, Acc: 0.284, Base Lr: 8.72e-04
2022-04-13 14:56:33,800 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.018, Acc: 0.355, Base Lr: 8.72e-04
2022-04-13 14:56:47,724 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.211[s] Speed: 75.7[samples/s]
2022-04-13 14:57:20,352 reid_baseline.train INFO: normal accuracy 0.44041450777202074 4.16038179397583 
2022-04-13 14:57:21,362 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 14:57:21,362 reid_baseline.train INFO: Accuracy: 44.0% Mean Entropy: 416.0%
2022-04-13 14:57:40,546 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.547, Acc: 0.504, Base Lr: 1.66e-03
2022-04-13 14:58:02,157 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.395, Acc: 0.503, Base Lr: 1.66e-03
2022-04-13 14:58:15,899 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.200[s] Speed: 80.1[samples/s]
2022-04-13 14:58:46,287 reid_baseline.train INFO: normal accuracy 0.496057670646542 3.967172145843506 
2022-04-13 14:58:47,770 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 14:58:47,771 reid_baseline.train INFO: Accuracy: 49.6% Mean Entropy: 396.7%
2022-04-13 14:59:12,414 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.682, Acc: 0.576, Base Lr: 2.46e-03
2022-04-13 14:59:30,308 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.561, Acc: 0.591, Base Lr: 2.46e-03
2022-04-13 14:59:44,914 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.209[s] Speed: 76.5[samples/s]
2022-04-13 15:00:20,787 reid_baseline.train INFO: normal accuracy 0.631448524442442 3.3671796321868896 
2022-04-13 15:00:22,083 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 15:00:22,083 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 336.7%
2022-04-13 15:00:42,855 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.064, Acc: 0.670, Base Lr: 3.25e-03
2022-04-13 15:01:03,150 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.996, Acc: 0.679, Base Lr: 3.25e-03
2022-04-13 15:01:19,510 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.210[s] Speed: 76.1[samples/s]
2022-04-13 15:01:49,079 reid_baseline.train INFO: normal accuracy 0.7030862806938499 2.8270182609558105 
2022-04-13 15:01:50,257 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 15:01:50,257 reid_baseline.train INFO: Accuracy: 70.3% Mean Entropy: 282.7%
2022-04-13 15:02:10,485 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.670, Acc: 0.755, Base Lr: 4.04e-03
2022-04-13 15:02:31,333 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.658, Acc: 0.752, Base Lr: 4.04e-03
2022-04-13 15:02:44,906 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.200[s] Speed: 80.0[samples/s]
2022-04-13 15:03:12,171 reid_baseline.train INFO: normal accuracy 0.7359765712998423 2.4132583141326904 
2022-04-13 15:03:13,526 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 15:03:13,526 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 241.3%
2022-04-13 15:03:36,235 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.450, Acc: 0.808, Base Lr: 4.83e-03
2022-04-13 15:03:54,086 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.448, Acc: 0.812, Base Lr: 4.83e-03
2022-04-13 15:04:08,031 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.199[s] Speed: 80.4[samples/s]
2022-04-13 15:04:43,594 reid_baseline.train INFO: normal accuracy 0.7443117819328677 2.220135450363159 
2022-04-13 15:04:44,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 15:04:44,852 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 222.0%
2022-04-13 15:05:06,079 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.347, Acc: 0.842, Base Lr: 5.62e-03
2022-04-13 15:05:25,807 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.319, Acc: 0.848, Base Lr: 5.62e-03
2022-04-13 15:05:41,624 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.208[s] Speed: 77.0[samples/s]
2022-04-13 15:06:02,179 reid_baseline.train INFO: normal accuracy 0.7485920252309078 2.048872709274292 
2022-04-13 15:06:03,592 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 15:06:03,593 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 204.9%
2022-04-13 15:06:22,239 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.232, Acc: 0.875, Base Lr: 6.42e-03
2022-04-13 15:06:41,327 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.231, Acc: 0.873, Base Lr: 6.42e-03
2022-04-13 15:06:56,917 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.195[s] Speed: 82.0[samples/s]
2022-04-13 15:07:28,857 reid_baseline.train INFO: normal accuracy 0.7632349628294661 1.9630873203277588 
2022-04-13 15:07:29,865 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 15:07:29,865 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 196.3%
2022-04-13 15:07:48,638 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.134, Acc: 0.898, Base Lr: 7.21e-03
2022-04-13 15:08:10,373 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.157, Acc: 0.888, Base Lr: 7.21e-03
2022-04-13 15:08:23,758 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.197[s] Speed: 81.1[samples/s]
2022-04-13 15:08:53,296 reid_baseline.train INFO: normal accuracy 0.759855823383645 1.9158962965011597 
2022-04-13 15:08:54,633 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 15:08:54,634 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 191.6%
2022-04-13 15:09:17,163 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.075, Acc: 0.915, Base Lr: 1.60e-05
2022-04-13 15:09:34,987 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.073, Acc: 0.921, Base Lr: 1.60e-05
2022-04-13 15:09:48,592 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.198[s] Speed: 81.0[samples/s]
2022-04-13 15:10:26,423 reid_baseline.train INFO: normal accuracy 0.7614327551250282 1.8747291564941406 
2022-04-13 15:10:27,747 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 15:10:27,748 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 187.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_2/transformer_best_model.pth
2022-04-13 15:11:01,006 reid_baseline.train INFO: normal accuracy 0.7614327551250282 1.8747291564941406 
2022-04-13 15:11:01,006 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:11:01,007 reid_baseline.train INFO: Accuracy: 76.1%
2022-04-13 15:11:36,589 reid_baseline.train INFO: normal accuracy 0.7343996395584591 1.893782615661621 
2022-04-13 15:11:36,589 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:11:36,590 reid_baseline.train INFO: Shuffled Accuracy: 73.4%
2022-04-13 15:11:43,492 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_3
2022-04-13 15:11:43,492 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_3', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=3)
2022-04-13 15:11:43,492 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 15:11:43,492 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 10
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 15:11:43,493 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_3
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 10
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 15:11:54,696 reid_baseline.train INFO: start training
2022-04-13 15:12:15,519 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.105, Acc: 0.238, Base Lr: 8.72e-04
2022-04-13 15:12:35,536 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.027, Acc: 0.303, Base Lr: 8.72e-04
2022-04-13 15:12:49,172 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.199[s] Speed: 80.6[samples/s]
2022-04-13 15:13:21,178 reid_baseline.train INFO: normal accuracy 0.3282270781707592 4.159948348999023 
2022-04-13 15:13:22,053 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 15:13:22,054 reid_baseline.train INFO: Accuracy: 32.8% Mean Entropy: 416.0%
2022-04-13 15:13:42,178 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.597, Acc: 0.452, Base Lr: 1.66e-03
2022-04-13 15:14:01,002 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.459, Acc: 0.445, Base Lr: 1.66e-03
2022-04-13 15:14:14,431 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.192[s] Speed: 83.4[samples/s]
2022-04-13 15:14:47,716 reid_baseline.train INFO: normal accuracy 0.4050461815724262 3.981956720352173 
2022-04-13 15:14:48,634 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 15:14:48,634 reid_baseline.train INFO: Accuracy: 40.5% Mean Entropy: 398.2%
2022-04-13 15:15:08,610 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.808, Acc: 0.517, Base Lr: 2.46e-03
2022-04-13 15:15:28,634 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.708, Acc: 0.529, Base Lr: 2.46e-03
2022-04-13 15:15:43,599 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.201[s] Speed: 79.5[samples/s]
2022-04-13 15:16:16,565 reid_baseline.train INFO: normal accuracy 0.5805361567920703 3.4818739891052246 
2022-04-13 15:16:17,836 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 15:16:17,837 reid_baseline.train INFO: Accuracy: 58.1% Mean Entropy: 348.2%
2022-04-13 15:16:40,246 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.237, Acc: 0.601, Base Lr: 3.25e-03
2022-04-13 15:17:00,152 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.175, Acc: 0.617, Base Lr: 3.25e-03
2022-04-13 15:17:16,152 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.214[s] Speed: 74.9[samples/s]
2022-04-13 15:17:50,716 reid_baseline.train INFO: normal accuracy 0.673349853570624 2.9995603561401367 
2022-04-13 15:17:51,973 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 15:17:51,974 reid_baseline.train INFO: Accuracy: 67.3% Mean Entropy: 300.0%
2022-04-13 15:18:08,969 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.864, Acc: 0.692, Base Lr: 4.04e-03
2022-04-13 15:18:24,259 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.836, Acc: 0.699, Base Lr: 4.04e-03
2022-04-13 15:18:37,975 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.168[s] Speed: 95.0[samples/s]
2022-04-13 15:19:08,883 reid_baseline.train INFO: normal accuracy 0.716152286551025 2.622426986694336 
2022-04-13 15:19:10,074 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 15:19:10,075 reid_baseline.train INFO: Accuracy: 71.6% Mean Entropy: 262.2%
2022-04-13 15:19:30,358 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.618, Acc: 0.760, Base Lr: 4.83e-03
2022-04-13 15:19:49,301 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.608, Acc: 0.762, Base Lr: 4.83e-03
2022-04-13 15:20:04,638 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.199[s] Speed: 80.2[samples/s]
2022-04-13 15:20:36,160 reid_baseline.train INFO: normal accuracy 0.7314710520387475 2.397707939147949 
2022-04-13 15:20:37,454 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 15:20:37,455 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 239.8%
2022-04-13 15:20:56,717 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.482, Acc: 0.802, Base Lr: 5.62e-03
2022-04-13 15:21:17,990 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.458, Acc: 0.801, Base Lr: 5.62e-03
2022-04-13 15:21:31,625 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.198[s] Speed: 80.7[samples/s]
2022-04-13 15:22:02,464 reid_baseline.train INFO: normal accuracy 0.7330479837801307 2.176547050476074 
2022-04-13 15:22:03,689 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 15:22:03,689 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 217.7%
2022-04-13 15:22:26,013 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.350, Acc: 0.831, Base Lr: 6.42e-03
2022-04-13 15:22:45,915 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.360, Acc: 0.826, Base Lr: 6.42e-03
2022-04-13 15:22:59,442 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.204[s] Speed: 78.5[samples/s]
2022-04-13 15:23:33,815 reid_baseline.train INFO: normal accuracy 0.7429601261545393 2.1329569816589355 
2022-04-13 15:23:35,108 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 15:23:35,108 reid_baseline.train INFO: Accuracy: 74.3% Mean Entropy: 213.3%
2022-04-13 15:23:53,797 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.230, Acc: 0.872, Base Lr: 7.21e-03
2022-04-13 15:24:11,344 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.254, Acc: 0.864, Base Lr: 7.21e-03
2022-04-13 15:24:26,912 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.190[s] Speed: 84.4[samples/s]
2022-04-13 15:24:58,801 reid_baseline.train INFO: normal accuracy 0.7413831944131561 2.0802671909332275 
2022-04-13 15:24:59,925 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 15:24:59,925 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 208.0%
2022-04-13 15:25:20,277 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.165, Acc: 0.892, Base Lr: 1.60e-05
2022-04-13 15:25:41,784 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.173, Acc: 0.895, Base Lr: 1.60e-05
2022-04-13 15:25:54,181 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.199[s] Speed: 80.5[samples/s]
2022-04-13 15:26:24,082 reid_baseline.train INFO: normal accuracy 0.7422842982653751 2.045456886291504 
2022-04-13 15:26:25,782 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 15:26:25,783 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 204.5%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_3/transformer_best_model.pth
2022-04-13 15:27:00,290 reid_baseline.train INFO: normal accuracy 0.7422842982653751 2.045456886291504 
2022-04-13 15:27:00,290 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:27:00,291 reid_baseline.train INFO: Accuracy: 74.2%
2022-04-13 15:27:29,516 reid_baseline.train INFO: normal accuracy 0.6992565893219194 2.047916889190674 
2022-04-13 15:27:29,517 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:27:29,517 reid_baseline.train INFO: Shuffled Accuracy: 69.9%
2022-04-13 15:27:38,176 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_4
2022-04-13 15:27:38,176 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_4', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=4)
2022-04-13 15:27:38,176 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 15:27:38,176 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 10
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 15:27:38,177 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_4
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 10
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 15:27:51,848 reid_baseline.train INFO: start training
2022-04-13 15:28:11,878 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.107, Acc: 0.222, Base Lr: 8.72e-04
2022-04-13 15:28:31,619 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.032, Acc: 0.276, Base Lr: 8.72e-04
2022-04-13 15:28:46,855 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.201[s] Speed: 79.7[samples/s]
2022-04-13 15:29:23,138 reid_baseline.train INFO: normal accuracy 0.23924307276413606 4.1605048179626465 
2022-04-13 15:29:24,445 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 15:29:24,445 reid_baseline.train INFO: Accuracy: 23.9% Mean Entropy: 416.1%
2022-04-13 15:29:49,257 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.612, Acc: 0.422, Base Lr: 1.66e-03
2022-04-13 15:30:02,469 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.484, Acc: 0.414, Base Lr: 1.66e-03
2022-04-13 15:30:13,601 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.179[s] Speed: 89.1[samples/s]
2022-04-13 15:30:45,177 reid_baseline.train INFO: normal accuracy 0.30975444920027034 4.0015692710876465 
2022-04-13 15:30:46,332 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 15:30:46,332 reid_baseline.train INFO: Accuracy: 31.0% Mean Entropy: 400.2%
2022-04-13 15:31:08,936 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.881, Acc: 0.486, Base Lr: 2.46e-03
2022-04-13 15:31:27,004 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.784, Acc: 0.492, Base Lr: 2.46e-03
2022-04-13 15:31:40,572 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.199[s] Speed: 80.6[samples/s]
2022-04-13 15:32:16,149 reid_baseline.train INFO: normal accuracy 0.49222797927461137 3.60296368598938 
2022-04-13 15:32:17,400 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 15:32:17,400 reid_baseline.train INFO: Accuracy: 49.2% Mean Entropy: 360.3%
2022-04-13 15:32:36,901 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.355, Acc: 0.571, Base Lr: 3.25e-03
2022-04-13 15:32:55,004 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.293, Acc: 0.584, Base Lr: 3.25e-03
2022-04-13 15:33:10,583 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.195[s] Speed: 82.2[samples/s]
2022-04-13 15:33:39,905 reid_baseline.train INFO: normal accuracy 0.6305474205902231 3.212050437927246 
2022-04-13 15:33:41,188 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 15:33:41,188 reid_baseline.train INFO: Accuracy: 63.1% Mean Entropy: 321.2%
2022-04-13 15:33:59,992 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.980, Acc: 0.666, Base Lr: 4.04e-03
2022-04-13 15:34:21,264 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.953, Acc: 0.669, Base Lr: 4.04e-03
2022-04-13 15:34:35,231 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.198[s] Speed: 80.9[samples/s]
2022-04-13 15:35:04,737 reid_baseline.train INFO: normal accuracy 0.6852894796125254 2.83829927444458 
2022-04-13 15:35:05,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 15:35:05,848 reid_baseline.train INFO: Accuracy: 68.5% Mean Entropy: 283.8%
2022-04-13 15:35:28,152 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.707, Acc: 0.744, Base Lr: 4.83e-03
2022-04-13 15:35:46,211 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.702, Acc: 0.742, Base Lr: 4.83e-03
2022-04-13 15:35:59,994 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.198[s] Speed: 80.7[samples/s]
2022-04-13 15:36:35,964 reid_baseline.train INFO: normal accuracy 0.7141248028835323 2.602170705795288 
2022-04-13 15:36:37,254 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 15:36:37,254 reid_baseline.train INFO: Accuracy: 71.4% Mean Entropy: 260.2%
2022-04-13 15:36:56,552 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.567, Acc: 0.773, Base Lr: 5.62e-03
2022-04-13 15:37:14,967 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.542, Acc: 0.777, Base Lr: 5.62e-03
2022-04-13 15:37:31,708 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.199[s] Speed: 80.3[samples/s]
2022-04-13 15:38:02,860 reid_baseline.train INFO: normal accuracy 0.7186303221446272 2.3797037601470947 
2022-04-13 15:38:04,219 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 15:38:04,219 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 238.0%
2022-04-13 15:38:27,271 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.425, Acc: 0.812, Base Lr: 6.42e-03
2022-04-13 15:38:46,425 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.418, Acc: 0.813, Base Lr: 6.42e-03
2022-04-13 15:38:59,889 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.204[s] Speed: 78.5[samples/s]
2022-04-13 15:39:31,072 reid_baseline.train INFO: normal accuracy 0.7276413606668168 2.3027637004852295 
2022-04-13 15:39:32,394 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 15:39:32,395 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 230.3%
2022-04-13 15:39:53,267 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.308, Acc: 0.844, Base Lr: 7.21e-03
2022-04-13 15:40:11,916 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.322, Acc: 0.842, Base Lr: 7.21e-03
2022-04-13 15:40:26,415 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.197[s] Speed: 81.1[samples/s]
2022-04-13 15:40:59,094 reid_baseline.train INFO: normal accuracy 0.7328227078170759 2.177767276763916 
2022-04-13 15:41:00,597 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 15:41:00,597 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 217.8%
2022-04-13 15:41:23,401 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.222, Acc: 0.880, Base Lr: 1.60e-05
2022-04-13 15:41:44,631 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.233, Acc: 0.877, Base Lr: 1.60e-05
2022-04-13 15:41:57,916 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.210[s] Speed: 76.3[samples/s]
2022-04-13 15:42:19,100 reid_baseline.train INFO: normal accuracy 0.7312457760756927 2.147725820541382 
2022-04-13 15:42:20,187 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 15:42:20,187 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 214.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_4/transformer_best_model.pth
2022-04-13 15:42:50,541 reid_baseline.train INFO: normal accuracy 0.7312457760756927 2.147725820541382 
2022-04-13 15:42:50,542 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:42:50,542 reid_baseline.train INFO: Accuracy: 73.1%
2022-04-13 15:43:24,528 reid_baseline.train INFO: normal accuracy 0.6505969813020951 2.0934417247772217 
2022-04-13 15:43:24,529 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:43:24,529 reid_baseline.train INFO: Shuffled Accuracy: 65.1%
2022-04-13 15:43:31,863 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_5
2022-04-13 15:43:31,863 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_5', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=5)
2022-04-13 15:43:31,864 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 15:43:31,864 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 10
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 15:43:31,864 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_5
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 10
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 15:43:42,089 reid_baseline.train INFO: start training
2022-04-13 15:44:03,740 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.111, Acc: 0.210, Base Lr: 8.72e-04
2022-04-13 15:44:22,695 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.040, Acc: 0.246, Base Lr: 8.72e-04
2022-04-13 15:44:36,620 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.199[s] Speed: 80.4[samples/s]
2022-04-13 15:45:09,352 reid_baseline.train INFO: normal accuracy 0.16107231358414056 4.160259246826172 
2022-04-13 15:45:10,854 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 15:45:10,854 reid_baseline.train INFO: Accuracy: 16.1% Mean Entropy: 416.0%
2022-04-13 15:45:31,343 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.651, Acc: 0.366, Base Lr: 1.66e-03
2022-04-13 15:45:49,397 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.531, Acc: 0.362, Base Lr: 1.66e-03
2022-04-13 15:46:03,694 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.193[s] Speed: 83.0[samples/s]
2022-04-13 15:46:35,648 reid_baseline.train INFO: normal accuracy 0.23428700157693175 4.021060466766357 
2022-04-13 15:46:36,800 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 15:46:36,800 reid_baseline.train INFO: Accuracy: 23.4% Mean Entropy: 402.1%
2022-04-13 15:46:55,459 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.975, Acc: 0.442, Base Lr: 2.46e-03
2022-04-13 15:47:16,763 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.887, Acc: 0.449, Base Lr: 2.46e-03
2022-04-13 15:47:30,689 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.197[s] Speed: 81.1[samples/s]
2022-04-13 15:48:00,760 reid_baseline.train INFO: normal accuracy 0.3915296237891417 3.6858084201812744 
2022-04-13 15:48:02,378 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 15:48:02,379 reid_baseline.train INFO: Accuracy: 39.2% Mean Entropy: 368.6%
2022-04-13 15:48:27,328 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.478, Acc: 0.533, Base Lr: 3.25e-03
2022-04-13 15:48:45,598 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.416, Acc: 0.542, Base Lr: 3.25e-03
2022-04-13 15:48:59,466 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.209[s] Speed: 76.6[samples/s]
2022-04-13 15:49:34,972 reid_baseline.train INFO: normal accuracy 0.5591349403018698 3.367009162902832 
2022-04-13 15:49:36,276 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 15:49:36,276 reid_baseline.train INFO: Accuracy: 55.9% Mean Entropy: 336.7%
2022-04-13 15:49:55,332 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 2.115, Acc: 0.624, Base Lr: 4.04e-03
2022-04-13 15:50:13,149 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 2.080, Acc: 0.631, Base Lr: 4.04e-03
2022-04-13 15:50:29,438 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.195[s] Speed: 82.2[samples/s]
2022-04-13 15:51:00,693 reid_baseline.train INFO: normal accuracy 0.6422617706690696 3.033794641494751 
2022-04-13 15:51:01,878 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 15:51:01,879 reid_baseline.train INFO: Accuracy: 64.2% Mean Entropy: 303.4%
2022-04-13 15:51:21,151 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.824, Acc: 0.700, Base Lr: 4.83e-03
2022-04-13 15:51:42,958 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.824, Acc: 0.697, Base Lr: 4.83e-03
2022-04-13 15:51:57,723 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.204[s] Speed: 78.2[samples/s]
2022-04-13 15:52:27,270 reid_baseline.train INFO: normal accuracy 0.6884433430952918 2.7676963806152344 
2022-04-13 15:52:28,827 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 15:52:28,827 reid_baseline.train INFO: Accuracy: 68.8% Mean Entropy: 276.8%
2022-04-13 15:52:50,651 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.674, Acc: 0.748, Base Lr: 5.62e-03
2022-04-13 15:53:15,172 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.653, Acc: 0.739, Base Lr: 5.62e-03
2022-04-13 15:53:30,533 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.225[s] Speed: 71.2[samples/s]
2022-04-13 15:53:56,654 reid_baseline.train INFO: normal accuracy 0.6924983104302771 2.5789477825164795 
2022-04-13 15:53:57,710 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 15:53:57,711 reid_baseline.train INFO: Accuracy: 69.2% Mean Entropy: 257.9%
2022-04-13 15:54:10,775 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.520, Acc: 0.784, Base Lr: 6.42e-03
2022-04-13 15:54:22,464 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.522, Acc: 0.783, Base Lr: 6.42e-03
2022-04-13 15:54:32,490 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.127[s] Speed: 125.8[samples/s]
2022-04-13 15:54:53,596 reid_baseline.train INFO: normal accuracy 0.7001576931741383 2.432861566543579 
2022-04-13 15:54:54,789 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 15:54:54,789 reid_baseline.train INFO: Accuracy: 70.0% Mean Entropy: 243.3%
2022-04-13 15:55:08,770 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.385, Acc: 0.822, Base Lr: 7.21e-03
2022-04-13 15:55:20,553 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.406, Acc: 0.812, Base Lr: 7.21e-03
2022-04-13 15:55:29,401 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.127[s] Speed: 126.3[samples/s]
2022-04-13 15:55:49,285 reid_baseline.train INFO: normal accuracy 0.7010587970263573 2.362637996673584 
2022-04-13 15:55:50,348 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 15:55:50,348 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 236.3%
2022-04-13 15:56:03,235 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.292, Acc: 0.854, Base Lr: 1.60e-05
2022-04-13 15:56:16,004 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.307, Acc: 0.851, Base Lr: 1.60e-05
2022-04-13 15:56:27,831 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.137[s] Speed: 116.8[samples/s]
2022-04-13 15:56:50,052 reid_baseline.train INFO: normal accuracy 0.7010587970263573 2.3225183486938477 
2022-04-13 15:56:51,434 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 15:56:51,434 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 232.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_5/transformer_best_model.pth
2022-04-13 15:57:13,993 reid_baseline.train INFO: normal accuracy 0.7010587970263573 2.3225183486938477 
2022-04-13 15:57:13,993 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:57:13,993 reid_baseline.train INFO: Accuracy: 70.1%
2022-04-13 15:57:31,251 reid_baseline.train INFO: normal accuracy 0.6138769993241721 2.23179030418396 
2022-04-13 15:57:31,252 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 15:57:31,252 reid_baseline.train INFO: Shuffled Accuracy: 61.4%
2022-04-13 15:57:39,002 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_6
2022-04-13 15:57:39,002 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('0')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_6', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=6)
2022-04-13 15:57:39,002 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-04-13 15:57:39,002 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 10
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-04-13 15:57:39,003 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 0
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_6
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 10
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-04-13 15:57:48,921 reid_baseline.train INFO: start training
2022-04-13 15:58:02,709 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.116, Acc: 0.182, Base Lr: 8.72e-04
2022-04-13 15:58:15,953 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.050, Acc: 0.215, Base Lr: 8.72e-04
2022-04-13 15:58:25,178 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.132[s] Speed: 121.1[samples/s]
2022-04-13 15:58:45,679 reid_baseline.train INFO: normal accuracy 0.11534129308402793 4.15946102142334 
2022-04-13 15:58:46,683 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-04-13 15:58:46,683 reid_baseline.train INFO: Accuracy: 11.5% Mean Entropy: 415.9%
2022-04-13 15:58:58,559 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.690, Acc: 0.333, Base Lr: 1.66e-03
2022-04-13 15:59:09,687 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.580, Acc: 0.322, Base Lr: 1.66e-03
2022-04-13 15:59:19,159 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.119[s] Speed: 134.5[samples/s]
2022-04-13 15:59:37,212 reid_baseline.train INFO: normal accuracy 0.15228655102500563 4.0382466316223145 
2022-04-13 15:59:38,345 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-04-13 15:59:38,345 reid_baseline.train INFO: Accuracy: 15.2% Mean Entropy: 403.8%
2022-04-13 15:59:51,230 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 3.068, Acc: 0.388, Base Lr: 2.46e-03
2022-04-13 16:00:03,159 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.991, Acc: 0.402, Base Lr: 2.46e-03
2022-04-13 16:00:11,889 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.123[s] Speed: 130.6[samples/s]
2022-04-13 16:00:31,346 reid_baseline.train INFO: normal accuracy 0.28790268078396036 3.7884433269500732 
2022-04-13 16:00:32,469 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-04-13 16:00:32,469 reid_baseline.train INFO: Accuracy: 28.8% Mean Entropy: 378.8%
2022-04-13 16:00:45,894 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.606, Acc: 0.481, Base Lr: 3.25e-03
2022-04-13 16:00:58,815 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 2.547, Acc: 0.497, Base Lr: 3.25e-03
2022-04-13 16:01:08,056 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.130[s] Speed: 122.9[samples/s]
2022-04-13 16:01:26,288 reid_baseline.train INFO: normal accuracy 0.46046406848389276 3.555551290512085 
2022-04-13 16:01:27,146 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-04-13 16:01:27,146 reid_baseline.train INFO: Accuracy: 46.0% Mean Entropy: 355.6%
2022-04-13 16:01:40,371 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 2.249, Acc: 0.586, Base Lr: 4.04e-03
2022-04-13 16:01:52,442 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 2.219, Acc: 0.590, Base Lr: 4.04e-03
2022-04-13 16:02:00,817 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.123[s] Speed: 129.8[samples/s]
2022-04-13 16:02:21,446 reid_baseline.train INFO: normal accuracy 0.5706240144176616 3.2723748683929443 
2022-04-13 16:02:22,660 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-04-13 16:02:22,661 reid_baseline.train INFO: Accuracy: 57.1% Mean Entropy: 327.2%
2022-04-13 16:02:35,744 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.966, Acc: 0.649, Base Lr: 4.83e-03
2022-04-13 16:02:48,491 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.957, Acc: 0.649, Base Lr: 4.83e-03
2022-04-13 16:02:58,280 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.130[s] Speed: 122.7[samples/s]
2022-04-13 16:03:19,947 reid_baseline.train INFO: normal accuracy 0.6483442216715476 3.054685115814209 
2022-04-13 16:03:21,275 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-04-13 16:03:21,275 reid_baseline.train INFO: Accuracy: 64.8% Mean Entropy: 305.5%
2022-04-13 16:03:35,948 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.797, Acc: 0.697, Base Lr: 5.62e-03
2022-04-13 16:03:50,231 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.766, Acc: 0.705, Base Lr: 5.62e-03
2022-04-13 16:04:00,384 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.143[s] Speed: 111.9[samples/s]
2022-04-13 16:04:21,482 reid_baseline.train INFO: normal accuracy 0.6798828564992115 2.8091483116149902 
2022-04-13 16:04:22,372 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-04-13 16:04:22,372 reid_baseline.train INFO: Accuracy: 68.0% Mean Entropy: 280.9%
2022-04-13 16:04:35,088 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.631, Acc: 0.754, Base Lr: 6.42e-03
2022-04-13 16:04:47,226 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.627, Acc: 0.749, Base Lr: 6.42e-03
2022-04-13 16:04:56,369 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.124[s] Speed: 129.4[samples/s]
2022-04-13 16:05:18,418 reid_baseline.train INFO: normal accuracy 0.6900202748366749 2.6856801509857178 
2022-04-13 16:05:19,639 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-04-13 16:05:19,639 reid_baseline.train INFO: Accuracy: 69.0% Mean Entropy: 268.6%
2022-04-13 16:05:33,084 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.480, Acc: 0.781, Base Lr: 7.21e-03
2022-04-13 16:05:46,165 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.499, Acc: 0.779, Base Lr: 7.21e-03
2022-04-13 16:05:55,721 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.132[s] Speed: 121.2[samples/s]
2022-04-13 16:06:15,763 reid_baseline.train INFO: normal accuracy 0.6875422392430728 2.560466766357422 
2022-04-13 16:06:16,810 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-04-13 16:06:16,811 reid_baseline.train INFO: Accuracy: 68.8% Mean Entropy: 256.0%
2022-04-13 16:06:30,283 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.387, Acc: 0.822, Base Lr: 1.60e-05
2022-04-13 16:06:44,116 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.388, Acc: 0.827, Base Lr: 1.60e-05
2022-04-13 16:06:53,771 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.135[s] Speed: 118.3[samples/s]
2022-04-13 16:07:14,345 reid_baseline.train INFO: normal accuracy 0.6897949988736202 2.5525925159454346 
2022-04-13 16:07:15,602 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-04-13 16:07:15,603 reid_baseline.train INFO: Accuracy: 69.0% Mean Entropy: 255.3%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_6/transformer_best_model.pth
2022-04-13 16:07:36,355 reid_baseline.train INFO: normal accuracy 0.6897949988736202 2.5525925159454346 
2022-04-13 16:07:36,355 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 16:07:36,358 reid_baseline.train INFO: Accuracy: 69.0%
2022-04-13 16:07:53,596 reid_baseline.train INFO: normal accuracy 0.575580085604866 2.3853273391723633 
2022-04-13 16:07:53,597 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-04-13 16:07:53,597 reid_baseline.train INFO: Shuffled Accuracy: 57.6%
