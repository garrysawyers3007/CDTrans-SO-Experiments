2022-05-02 21:58:41,522 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_2
2022-05-02 21:58:41,522 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=2)
2022-05-02 21:58:41,522 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-02 21:58:41,522 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-02 21:58:41,523 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-02 21:58:54,313 reid_baseline.train INFO: start training
2022-05-02 22:00:12,045 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.119, Acc: 0.296, Base Lr: 8.72e-04
2022-05-02 22:00:43,746 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.709[s] Speed: 22.6[samples/s]
2022-05-02 22:02:35,787 reid_baseline.train INFO: normal accuracy 0.39908361970217643 4.171621799468994 
2022-05-02 22:02:36,727 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-02 22:02:36,727 reid_baseline.train INFO: Accuracy: 39.9% Mean Entropy: 417.2%
2022-05-02 22:03:56,212 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.805, Acc: 0.583, Base Lr: 1.66e-03
2022-05-02 22:04:29,631 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.743[s] Speed: 21.5[samples/s]
2022-05-02 22:06:42,171 reid_baseline.train INFO: normal accuracy 0.41832760595647195 4.149921894073486 
2022-05-02 22:06:43,283 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-02 22:06:43,284 reid_baseline.train INFO: Accuracy: 41.8% Mean Entropy: 415.0%
2022-05-02 22:08:05,051 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.227, Acc: 0.622, Base Lr: 2.46e-03
2022-05-02 22:08:38,103 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.755[s] Speed: 21.2[samples/s]
2022-05-02 22:10:38,750 reid_baseline.train INFO: normal accuracy 0.4361970217640321 3.975205898284912 
2022-05-02 22:10:40,121 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-02 22:10:40,122 reid_baseline.train INFO: Accuracy: 43.6% Mean Entropy: 397.5%
2022-05-02 22:12:08,782 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.471, Acc: 0.648, Base Lr: 3.25e-03
2022-05-02 22:12:44,731 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.820[s] Speed: 19.5[samples/s]
2022-05-02 22:14:33,630 reid_baseline.train INFO: normal accuracy 0.5033218785796105 3.5001325607299805 
2022-05-02 22:14:34,910 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-02 22:14:34,910 reid_baseline.train INFO: Accuracy: 50.3% Mean Entropy: 350.0%
2022-05-02 22:15:58,612 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.934, Acc: 0.723, Base Lr: 4.04e-03
2022-05-02 22:16:38,956 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.816[s] Speed: 19.6[samples/s]
2022-05-02 22:18:37,561 reid_baseline.train INFO: normal accuracy 0.5619702176403207 2.978905200958252 
2022-05-02 22:18:38,913 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-02 22:18:38,914 reid_baseline.train INFO: Accuracy: 56.2% Mean Entropy: 297.9%
2022-05-02 22:19:54,325 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.647, Acc: 0.769, Base Lr: 4.83e-03
2022-05-02 22:20:35,223 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.765[s] Speed: 20.9[samples/s]
2022-05-02 22:22:43,995 reid_baseline.train INFO: normal accuracy 0.5986254295532646 2.564577579498291 
2022-05-02 22:22:45,111 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-02 22:22:45,111 reid_baseline.train INFO: Accuracy: 59.9% Mean Entropy: 256.5%
2022-05-02 22:24:00,265 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.431, Acc: 0.827, Base Lr: 5.62e-03
2022-05-02 22:24:36,039 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.730[s] Speed: 21.9[samples/s]
2022-05-02 22:26:26,960 reid_baseline.train INFO: normal accuracy 0.6087056128293241 2.2886569499969482 
2022-05-02 22:26:28,089 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-02 22:26:28,089 reid_baseline.train INFO: Accuracy: 60.9% Mean Entropy: 228.9%
2022-05-02 22:27:54,518 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.337, Acc: 0.848, Base Lr: 6.42e-03
2022-05-02 22:28:33,680 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.826[s] Speed: 19.4[samples/s]
2022-05-02 22:30:29,150 reid_baseline.train INFO: normal accuracy 0.6048109965635738 2.140449285507202 
2022-05-02 22:30:30,500 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-02 22:30:30,501 reid_baseline.train INFO: Accuracy: 60.5% Mean Entropy: 214.0%
2022-05-02 22:31:53,249 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.236, Acc: 0.870, Base Lr: 7.21e-03
2022-05-02 22:32:29,902 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.785[s] Speed: 20.4[samples/s]
2022-05-02 22:34:27,585 reid_baseline.train INFO: normal accuracy 0.6126002290950745 2.03159236907959 
2022-05-02 22:34:28,742 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-02 22:34:28,743 reid_baseline.train INFO: Accuracy: 61.3% Mean Entropy: 203.2%
2022-05-02 22:35:53,455 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.159, Acc: 0.892, Base Lr: 4.01e-03
2022-05-02 22:36:28,195 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.784[s] Speed: 20.4[samples/s]
2022-05-02 22:38:32,218 reid_baseline.train INFO: normal accuracy 0.6139747995418099 1.9518632888793945 
2022-05-02 22:38:33,569 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-02 22:38:33,570 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 195.2%
2022-05-02 22:39:59,259 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.126, Acc: 0.907, Base Lr: 3.38e-03
2022-05-02 22:40:38,627 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.822[s] Speed: 19.5[samples/s]
2022-05-02 22:42:42,298 reid_baseline.train INFO: normal accuracy 0.6194730813287515 1.9133208990097046 
2022-05-02 22:42:43,629 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-02 22:42:43,629 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 191.3%
2022-05-02 22:44:14,648 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.097, Acc: 0.910, Base Lr: 2.77e-03
2022-05-02 22:44:48,674 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.821[s] Speed: 19.5[samples/s]
2022-05-02 22:46:44,448 reid_baseline.train INFO: normal accuracy 0.6245131729667812 1.8874725103378296 
2022-05-02 22:46:45,274 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-02 22:46:45,274 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 188.7%
2022-05-02 22:48:04,858 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.099, Acc: 0.911, Base Lr: 2.20e-03
2022-05-02 22:48:42,370 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.770[s] Speed: 20.8[samples/s]
2022-05-02 22:50:42,506 reid_baseline.train INFO: normal accuracy 0.6247422680412371 1.8690589666366577 
2022-05-02 22:50:43,898 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-02 22:50:43,899 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 186.9%
2022-05-02 22:52:03,243 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.053, Acc: 0.929, Base Lr: 1.66e-03
2022-05-02 22:52:39,451 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.759[s] Speed: 21.1[samples/s]
2022-05-02 22:54:26,796 reid_baseline.train INFO: normal accuracy 0.6240549828178694 1.8631452322006226 
2022-05-02 22:54:27,961 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-02 22:54:27,962 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 186.3%
2022-05-02 22:55:52,977 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.056, Acc: 0.926, Base Lr: 1.19e-03
2022-05-02 22:56:32,029 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.816[s] Speed: 19.6[samples/s]
2022-05-02 22:58:18,670 reid_baseline.train INFO: normal accuracy 0.6284077892325315 1.899052381515503 
2022-05-02 22:58:18,671 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-02 22:58:18,671 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 189.9%
2022-05-02 22:59:32,344 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.020, Acc: 0.943, Base Lr: 7.78e-04
2022-05-02 23:00:09,657 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.725[s] Speed: 22.1[samples/s]
2022-05-02 23:02:13,843 reid_baseline.train INFO: normal accuracy 0.6270332187857961 1.8341542482376099 
2022-05-02 23:02:14,770 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-02 23:02:14,770 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 183.4%
2022-05-02 23:03:30,094 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.053, Acc: 0.926, Base Lr: 4.51e-04
2022-05-02 23:04:06,819 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.736[s] Speed: 21.7[samples/s]
2022-05-02 23:05:56,222 reid_baseline.train INFO: normal accuracy 0.6284077892325315 1.865299940109253 
2022-05-02 23:05:56,222 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-02 23:05:56,223 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 186.5%
2022-05-02 23:07:22,535 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.040, Acc: 0.929, Base Lr: 2.11e-04
2022-05-02 23:08:00,327 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.816[s] Speed: 19.6[samples/s]
2022-05-02 23:09:46,505 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.8002636432647705 
2022-05-02 23:09:47,673 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-02 23:09:47,673 reid_baseline.train INFO: Accuracy: 62.8% Mean Entropy: 180.0%
2022-05-02 23:11:12,883 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.018, Acc: 0.943, Base Lr: 6.51e-05
2022-05-02 23:11:44,535 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.769[s] Speed: 20.8[samples/s]
2022-05-02 23:13:43,044 reid_baseline.train INFO: normal accuracy 0.6268041237113402 1.8200616836547852 
2022-05-02 23:13:43,044 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-02 23:13:43,045 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 182.0%
2022-05-02 23:15:03,428 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.020, Acc: 0.947, Base Lr: 1.60e-05
2022-05-02 23:15:40,318 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.770[s] Speed: 20.8[samples/s]
2022-05-02 23:17:38,275 reid_baseline.train INFO: normal accuracy 0.6290950744558992 1.8367931842803955 
2022-05-02 23:17:38,277 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-02 23:17:38,278 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 183.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_2/transformer_best_model.pth
2022-05-02 23:19:38,599 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.8002636432647705 
2022-05-02 23:19:38,600 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 23:19:38,600 reid_baseline.train INFO: Accuracy: 62.8%
2022-05-02 23:21:41,838 reid_baseline.train INFO: normal accuracy 0.6281786941580756 1.8002636432647705 
2022-05-02 23:21:41,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 23:21:41,839 reid_baseline.train INFO: Shuffled Accuracy: 62.8%
2022-05-02 23:23:15,462 reid_baseline.train INFO: normal accuracy 0.9798104655953852 0.8149022459983826 
2022-05-02 23:23:15,463 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 23:23:15,463 reid_baseline.train INFO: Source Clean Accuracy: 98.0%
2022-05-02 23:23:23,221 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_11
2022-05-02 23:23:23,221 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=11)
2022-05-02 23:23:23,221 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-02 23:23:23,221 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-02 23:23:23,222 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-02 23:23:33,628 reid_baseline.train INFO: start training
2022-05-02 23:25:06,541 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.122, Acc: 0.276, Base Lr: 8.72e-04
2022-05-02 23:25:49,404 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.888[s] Speed: 18.0[samples/s]
2022-05-02 23:27:43,437 reid_baseline.train INFO: normal accuracy 0.3764032073310424 4.1718268394470215 
2022-05-02 23:27:44,443 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-02 23:27:44,443 reid_baseline.train INFO: Accuracy: 37.6% Mean Entropy: 417.2%
2022-05-02 23:29:03,112 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.821, Acc: 0.546, Base Lr: 1.66e-03
2022-05-02 23:29:40,720 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.765[s] Speed: 20.9[samples/s]
2022-05-02 23:31:46,663 reid_baseline.train INFO: normal accuracy 0.38900343642611684 4.153457164764404 
2022-05-02 23:31:47,759 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-02 23:31:47,759 reid_baseline.train INFO: Accuracy: 38.9% Mean Entropy: 415.3%
2022-05-02 23:33:03,744 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.261, Acc: 0.601, Base Lr: 2.46e-03
2022-05-02 23:33:39,807 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.737[s] Speed: 21.7[samples/s]
2022-05-02 23:35:28,954 reid_baseline.train INFO: normal accuracy 0.41970217640320734 4.0108137130737305 
2022-05-02 23:35:30,220 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-02 23:35:30,220 reid_baseline.train INFO: Accuracy: 42.0% Mean Entropy: 401.1%
2022-05-02 23:36:58,873 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.519, Acc: 0.625, Base Lr: 3.25e-03
2022-05-02 23:37:35,540 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.824[s] Speed: 19.4[samples/s]
2022-05-02 23:39:22,214 reid_baseline.train INFO: normal accuracy 0.4751431844215349 3.571916341781616 
2022-05-02 23:39:23,482 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-02 23:39:23,482 reid_baseline.train INFO: Accuracy: 47.5% Mean Entropy: 357.2%
2022-05-02 23:40:38,100 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.982, Acc: 0.708, Base Lr: 4.04e-03
2022-05-02 23:41:17,260 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.748[s] Speed: 21.4[samples/s]
2022-05-02 23:43:32,480 reid_baseline.train INFO: normal accuracy 0.5470790378006873 3.1298580169677734 
2022-05-02 23:43:33,540 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-02 23:43:33,540 reid_baseline.train INFO: Accuracy: 54.7% Mean Entropy: 313.0%
2022-05-02 23:45:24,783 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.700, Acc: 0.750, Base Lr: 4.83e-03
2022-05-02 23:46:19,268 reid_baseline.train INFO: Epoch 6 done. Time per batch: 1.090[s] Speed: 14.7[samples/s]
2022-05-02 23:48:27,203 reid_baseline.train INFO: normal accuracy 0.5853379152348225 2.8059394359588623 
2022-05-02 23:48:28,455 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-02 23:48:28,455 reid_baseline.train INFO: Accuracy: 58.5% Mean Entropy: 280.6%
2022-05-02 23:50:29,081 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.484, Acc: 0.813, Base Lr: 5.62e-03
2022-05-02 23:51:21,783 reid_baseline.train INFO: Epoch 7 done. Time per batch: 1.140[s] Speed: 14.0[samples/s]
2022-05-02 23:53:32,309 reid_baseline.train INFO: normal accuracy 0.6013745704467354 2.5899744033813477 
2022-05-02 23:53:33,694 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-02 23:53:33,695 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 259.0%
2022-05-02 23:55:27,331 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.382, Acc: 0.848, Base Lr: 6.42e-03
2022-05-02 23:56:26,575 reid_baseline.train INFO: Epoch 8 done. Time per batch: 1.136[s] Speed: 14.1[samples/s]
2022-05-02 23:58:28,794 reid_baseline.train INFO: normal accuracy 0.6075601374570446 2.446143865585327 
2022-05-02 23:58:29,953 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-02 23:58:29,953 reid_baseline.train INFO: Accuracy: 60.8% Mean Entropy: 244.6%
2022-05-03 00:00:19,177 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.264, Acc: 0.859, Base Lr: 7.21e-03
2022-05-03 00:01:04,572 reid_baseline.train INFO: Epoch 9 done. Time per batch: 1.017[s] Speed: 15.7[samples/s]
2022-05-03 00:03:26,587 reid_baseline.train INFO: normal accuracy 0.6061855670103092 2.370776653289795 
2022-05-03 00:03:27,450 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 00:03:27,451 reid_baseline.train INFO: Accuracy: 60.6% Mean Entropy: 237.1%
2022-05-03 00:05:23,519 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.188, Acc: 0.889, Base Lr: 4.01e-03
2022-05-03 00:06:13,478 reid_baseline.train INFO: Epoch 10 done. Time per batch: 1.092[s] Speed: 14.6[samples/s]
2022-05-03 00:08:14,121 reid_baseline.train INFO: normal accuracy 0.6123711340206186 2.311793088912964 
2022-05-03 00:08:15,313 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 00:08:15,313 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 231.2%
2022-05-03 00:10:07,577 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.154, Acc: 0.904, Base Lr: 3.38e-03
2022-05-03 00:10:57,883 reid_baseline.train INFO: Epoch 11 done. Time per batch: 1.069[s] Speed: 15.0[samples/s]
2022-05-03 00:13:03,014 reid_baseline.train INFO: normal accuracy 0.6215349369988545 2.2986180782318115 
2022-05-03 00:13:06,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 00:13:06,010 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 229.9%
2022-05-03 00:14:50,752 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.120, Acc: 0.910, Base Lr: 2.77e-03
2022-05-03 00:15:40,941 reid_baseline.train INFO: Epoch 12 done. Time per batch: 1.018[s] Speed: 15.7[samples/s]
2022-05-03 00:17:39,582 reid_baseline.train INFO: normal accuracy 0.6213058419243986 2.236212730407715 
2022-05-03 00:17:40,504 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 00:17:40,505 reid_baseline.train INFO: Accuracy: 62.1% Mean Entropy: 223.6%
2022-05-03 00:19:15,860 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.119, Acc: 0.906, Base Lr: 2.20e-03
2022-05-03 00:20:03,991 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.944[s] Speed: 17.0[samples/s]
2022-05-03 00:22:25,421 reid_baseline.train INFO: normal accuracy 0.6268041237113402 2.2123048305511475 
2022-05-03 00:22:26,617 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 00:22:26,618 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 221.2%
2022-05-03 00:24:08,692 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.074, Acc: 0.932, Base Lr: 1.66e-03
2022-05-03 00:24:52,454 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.959[s] Speed: 16.7[samples/s]
2022-05-03 00:26:56,222 reid_baseline.train INFO: normal accuracy 0.6240549828178694 2.2346887588500977 
2022-05-03 00:26:56,224 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 00:26:56,224 reid_baseline.train INFO: Accuracy: 62.4% Mean Entropy: 223.5%
2022-05-03 00:28:45,160 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.083, Acc: 0.925, Base Lr: 1.19e-03
2022-05-03 00:29:32,556 reid_baseline.train INFO: Epoch 15 done. Time per batch: 1.028[s] Speed: 15.6[samples/s]
2022-05-03 00:31:46,170 reid_baseline.train INFO: normal accuracy 0.629553264604811 2.2165777683258057 
2022-05-03 00:31:46,173 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 00:31:46,173 reid_baseline.train INFO: Accuracy: 63.0% Mean Entropy: 221.7%
2022-05-03 00:33:29,663 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.047, Acc: 0.939, Base Lr: 7.78e-04
2022-05-03 00:34:18,793 reid_baseline.train INFO: Epoch 16 done. Time per batch: 1.003[s] Speed: 16.0[samples/s]
2022-05-03 00:36:12,966 reid_baseline.train INFO: normal accuracy 0.6261168384879725 2.1809475421905518 
2022-05-03 00:36:14,163 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 00:36:14,163 reid_baseline.train INFO: Accuracy: 62.6% Mean Entropy: 218.1%
2022-05-03 00:37:59,112 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.071, Acc: 0.925, Base Lr: 4.51e-04
2022-05-03 00:38:46,945 reid_baseline.train INFO: Epoch 17 done. Time per batch: 1.005[s] Speed: 15.9[samples/s]
2022-05-03 00:41:02,913 reid_baseline.train INFO: normal accuracy 0.6290950744558992 2.2148983478546143 
2022-05-03 00:41:02,915 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 00:41:02,916 reid_baseline.train INFO: Accuracy: 62.9% Mean Entropy: 221.5%
2022-05-03 00:42:46,136 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.068, Acc: 0.923, Base Lr: 2.11e-04
2022-05-03 00:43:33,950 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.993[s] Speed: 16.1[samples/s]
2022-05-03 00:45:32,597 reid_baseline.train INFO: normal accuracy 0.6274914089347079 2.1606671810150146 
2022-05-03 00:45:35,617 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 00:45:35,618 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 216.1%
2022-05-03 00:47:21,501 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.030, Acc: 0.940, Base Lr: 6.51e-05
2022-05-03 00:48:21,469 reid_baseline.train INFO: Epoch 19 done. Time per batch: 1.088[s] Speed: 14.7[samples/s]
2022-05-03 00:50:38,667 reid_baseline.train INFO: normal accuracy 0.6265750286368843 2.169665575027466 
2022-05-03 00:50:38,669 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 00:50:38,670 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 217.0%
2022-05-03 00:52:24,724 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.040, Acc: 0.941, Base Lr: 1.60e-05
2022-05-03 00:53:16,264 reid_baseline.train INFO: Epoch 20 done. Time per batch: 1.034[s] Speed: 15.5[samples/s]
2022-05-03 00:55:08,315 reid_baseline.train INFO: normal accuracy 0.6268041237113402 2.17817759513855 
2022-05-03 00:55:08,318 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 00:55:08,319 reid_baseline.train INFO: Accuracy: 62.7% Mean Entropy: 217.8%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_11/transformer_best_model.pth
2022-05-03 00:57:12,271 reid_baseline.train INFO: normal accuracy 0.6274914089347079 2.1606671810150146 
2022-05-03 00:57:12,272 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 00:57:12,272 reid_baseline.train INFO: Accuracy: 62.7%
2022-05-03 00:59:39,204 reid_baseline.train INFO: normal accuracy 0.6274914089347079 2.1606671810150146 
2022-05-03 00:59:39,205 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 00:59:39,205 reid_baseline.train INFO: Shuffled Accuracy: 62.7%
2022-05-03 01:01:35,111 reid_baseline.train INFO: normal accuracy 0.9756901524515863 1.2361655235290527 
2022-05-03 01:01:35,114 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 01:01:35,114 reid_baseline.train INFO: Source Clean Accuracy: 97.6%
2022-05-03 01:01:44,015 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_12
2022-05-03 01:01:44,015 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=12)
2022-05-03 01:01:44,015 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 01:01:44,016 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 01:01:44,016 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Clipart
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4365 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 01:02:02,463 reid_baseline.train INFO: start training
2022-05-03 01:04:05,201 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.116, Acc: 0.292, Base Lr: 8.72e-04
2022-05-03 01:04:46,641 reid_baseline.train INFO: Epoch 1 done. Time per batch: 1.059[s] Speed: 15.1[samples/s]
2022-05-03 01:06:51,656 reid_baseline.train INFO: normal accuracy 0.3768613974799542 4.171520709991455 
2022-05-03 01:06:52,853 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 01:06:52,853 reid_baseline.train INFO: Accuracy: 37.7% Mean Entropy: 417.2%
2022-05-03 01:08:37,863 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.792, Acc: 0.537, Base Lr: 1.66e-03
2022-05-03 01:09:33,960 reid_baseline.train INFO: Epoch 2 done. Time per batch: 1.060[s] Speed: 15.1[samples/s]
2022-05-03 01:11:41,206 reid_baseline.train INFO: normal accuracy 0.3940435280641466 4.148725986480713 
2022-05-03 01:11:42,630 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 01:11:42,631 reid_baseline.train INFO: Accuracy: 39.4% Mean Entropy: 414.9%
2022-05-03 01:13:24,510 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.195, Acc: 0.594, Base Lr: 2.46e-03
2022-05-03 01:14:15,125 reid_baseline.train INFO: Epoch 3 done. Time per batch: 1.003[s] Speed: 16.0[samples/s]
2022-05-03 01:16:24,394 reid_baseline.train INFO: normal accuracy 0.41901489117983964 3.980003833770752 
2022-05-03 01:16:25,533 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 01:16:25,534 reid_baseline.train INFO: Accuracy: 41.9% Mean Entropy: 398.0%
2022-05-03 01:17:58,701 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.463, Acc: 0.635, Base Lr: 3.25e-03
2022-05-03 01:18:47,897 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.937[s] Speed: 17.1[samples/s]
2022-05-03 01:21:02,780 reid_baseline.train INFO: normal accuracy 0.4833906071019473 3.601696252822876 
2022-05-03 01:21:04,135 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 01:21:04,135 reid_baseline.train INFO: Accuracy: 48.3% Mean Entropy: 360.2%
2022-05-03 01:22:52,833 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.957, Acc: 0.715, Base Lr: 4.04e-03
2022-05-03 01:23:36,283 reid_baseline.train INFO: Epoch 5 done. Time per batch: 1.001[s] Speed: 16.0[samples/s]
2022-05-03 01:25:58,485 reid_baseline.train INFO: normal accuracy 0.5484536082474227 3.254530429840088 
2022-05-03 01:25:59,886 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 01:25:59,886 reid_baseline.train INFO: Accuracy: 54.8% Mean Entropy: 325.5%
2022-05-03 01:27:37,110 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.694, Acc: 0.756, Base Lr: 4.83e-03
2022-05-03 01:28:23,807 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.946[s] Speed: 16.9[samples/s]
2022-05-03 01:30:41,497 reid_baseline.train INFO: normal accuracy 0.5876288659793815 2.9894285202026367 
2022-05-03 01:30:43,034 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 01:30:43,034 reid_baseline.train INFO: Accuracy: 58.8% Mean Entropy: 298.9%
2022-05-03 01:32:51,203 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.480, Acc: 0.819, Base Lr: 5.62e-03
2022-05-03 01:33:48,402 reid_baseline.train INFO: Epoch 7 done. Time per batch: 1.219[s] Speed: 13.1[samples/s]
2022-05-03 01:36:02,564 reid_baseline.train INFO: normal accuracy 0.6061855670103092 2.695469856262207 
2022-05-03 01:36:03,863 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 01:36:03,864 reid_baseline.train INFO: Accuracy: 60.6% Mean Entropy: 269.5%
2022-05-03 01:37:46,879 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.385, Acc: 0.837, Base Lr: 6.42e-03
2022-05-03 01:38:44,814 reid_baseline.train INFO: Epoch 8 done. Time per batch: 1.059[s] Speed: 15.1[samples/s]
2022-05-03 01:41:01,569 reid_baseline.train INFO: normal accuracy 0.6006872852233677 2.6132314205169678 
2022-05-03 01:41:03,134 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 01:41:03,135 reid_baseline.train INFO: Accuracy: 60.1% Mean Entropy: 261.3%
2022-05-03 01:43:19,513 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.271, Acc: 0.860, Base Lr: 7.21e-03
2022-05-03 01:44:20,654 reid_baseline.train INFO: Epoch 9 done. Time per batch: 1.299[s] Speed: 12.3[samples/s]
2022-05-03 01:46:34,162 reid_baseline.train INFO: normal accuracy 0.6059564719358533 2.5080177783966064 
2022-05-03 01:46:35,122 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 01:46:35,122 reid_baseline.train INFO: Accuracy: 60.6% Mean Entropy: 250.8%
2022-05-03 01:48:08,986 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.198, Acc: 0.889, Base Lr: 4.01e-03
2022-05-03 01:48:59,126 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.947[s] Speed: 16.9[samples/s]
2022-05-03 01:51:05,611 reid_baseline.train INFO: normal accuracy 0.6096219931271478 2.4589688777923584 
2022-05-03 01:51:06,990 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 01:51:06,991 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 245.9%
2022-05-03 01:53:03,513 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.157, Acc: 0.903, Base Lr: 3.38e-03
2022-05-03 01:54:02,990 reid_baseline.train INFO: Epoch 11 done. Time per batch: 1.158[s] Speed: 13.8[samples/s]
2022-05-03 01:56:30,336 reid_baseline.train INFO: normal accuracy 0.6123711340206186 2.4589953422546387 
2022-05-03 01:56:30,339 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 01:56:30,339 reid_baseline.train INFO: Accuracy: 61.2% Mean Entropy: 245.9%
2022-05-03 01:58:17,705 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.119, Acc: 0.908, Base Lr: 2.77e-03
2022-05-03 01:59:08,453 reid_baseline.train INFO: Epoch 12 done. Time per batch: 1.040[s] Speed: 15.4[samples/s]
2022-05-03 02:01:06,390 reid_baseline.train INFO: normal accuracy 0.6135166093928981 2.4115612506866455 
2022-05-03 02:01:07,688 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 02:01:07,689 reid_baseline.train INFO: Accuracy: 61.4% Mean Entropy: 241.2%
2022-05-03 02:03:07,695 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.116, Acc: 0.909, Base Lr: 2.20e-03
2022-05-03 02:04:13,251 reid_baseline.train INFO: Epoch 13 done. Time per batch: 1.221[s] Speed: 13.1[samples/s]
2022-05-03 02:06:42,855 reid_baseline.train INFO: normal accuracy 0.6155784650630012 2.3947041034698486 
2022-05-03 02:06:44,566 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 02:06:44,567 reid_baseline.train INFO: Accuracy: 61.6% Mean Entropy: 239.5%
2022-05-03 02:08:46,899 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.082, Acc: 0.924, Base Lr: 1.66e-03
2022-05-03 02:09:56,787 reid_baseline.train INFO: Epoch 14 done. Time per batch: 1.264[s] Speed: 12.7[samples/s]
2022-05-03 02:12:17,325 reid_baseline.train INFO: normal accuracy 0.6174112256586484 2.403825283050537 
2022-05-03 02:12:17,330 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 02:12:17,330 reid_baseline.train INFO: Accuracy: 61.7% Mean Entropy: 240.4%
2022-05-03 02:14:08,653 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.083, Acc: 0.916, Base Lr: 1.19e-03
2022-05-03 02:14:57,554 reid_baseline.train INFO: Epoch 15 done. Time per batch: 1.054[s] Speed: 15.2[samples/s]
2022-05-03 02:17:27,819 reid_baseline.train INFO: normal accuracy 0.6199312714776632 2.399264335632324 
2022-05-03 02:17:27,822 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 02:17:27,823 reid_baseline.train INFO: Accuracy: 62.0% Mean Entropy: 239.9%
2022-05-03 02:19:33,905 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.048, Acc: 0.937, Base Lr: 7.78e-04
2022-05-03 02:20:43,891 reid_baseline.train INFO: Epoch 16 done. Time per batch: 1.290[s] Speed: 12.4[samples/s]
2022-05-03 02:23:05,739 reid_baseline.train INFO: normal accuracy 0.6178694158075602 2.3745803833007812 
2022-05-03 02:23:06,931 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 02:23:06,932 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 237.5%
2022-05-03 02:25:09,975 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.081, Acc: 0.916, Base Lr: 4.51e-04
2022-05-03 02:26:01,030 reid_baseline.train INFO: Epoch 17 done. Time per batch: 1.145[s] Speed: 14.0[samples/s]
2022-05-03 02:28:04,491 reid_baseline.train INFO: normal accuracy 0.6176403207331043 2.3920326232910156 
2022-05-03 02:28:04,492 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 02:28:04,492 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 239.2%
2022-05-03 02:30:15,238 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.064, Acc: 0.925, Base Lr: 2.11e-04
2022-05-03 02:31:14,913 reid_baseline.train INFO: Epoch 18 done. Time per batch: 1.253[s] Speed: 12.8[samples/s]
2022-05-03 02:34:07,457 reid_baseline.train INFO: normal accuracy 0.6178694158075602 2.3575732707977295 
2022-05-03 02:34:08,911 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 02:34:08,911 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 235.8%
2022-05-03 02:36:10,897 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.036, Acc: 0.940, Base Lr: 6.51e-05
2022-05-03 02:37:10,901 reid_baseline.train INFO: Epoch 19 done. Time per batch: 1.196[s] Speed: 13.4[samples/s]
2022-05-03 02:39:54,325 reid_baseline.train INFO: normal accuracy 0.618327605956472 2.3552210330963135 
2022-05-03 02:39:56,160 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 02:39:56,160 reid_baseline.train INFO: Accuracy: 61.8% Mean Entropy: 235.5%
2022-05-03 02:42:10,261 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.042, Acc: 0.940, Base Lr: 1.60e-05
2022-05-03 02:43:11,167 reid_baseline.train INFO: Epoch 20 done. Time per batch: 1.280[s] Speed: 12.5[samples/s]
2022-05-03 02:46:19,344 reid_baseline.train INFO: normal accuracy 0.6185567010309279 2.3760669231414795 
2022-05-03 02:46:19,344 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 02:46:19,345 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 237.6%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Clipart_shuffled_Cross_Domain_key_layer_12/transformer_best_model.pth
2022-05-03 02:49:28,958 reid_baseline.train INFO: normal accuracy 0.618327605956472 2.3552210330963135 
2022-05-03 02:49:28,959 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 02:49:28,959 reid_baseline.train INFO: Accuracy: 61.8%
2022-05-03 02:51:38,373 reid_baseline.train INFO: normal accuracy 0.618327605956472 2.3552210330963135 
2022-05-03 02:51:38,374 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 02:51:38,374 reid_baseline.train INFO: Shuffled Accuracy: 61.8%
2022-05-03 02:53:42,383 reid_baseline.train INFO: normal accuracy 0.9752781211372065 1.4097926616668701 
2022-05-03 02:53:42,384 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 02:53:42,384 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-05-03 02:53:56,063 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_2
2022-05-03 02:53:56,063 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=2)
2022-05-03 02:53:56,064 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 02:53:56,064 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 02:53:56,064 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 02:54:16,341 reid_baseline.train INFO: start training
2022-05-03 02:56:51,499 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.119, Acc: 0.296, Base Lr: 8.72e-04
2022-05-03 02:57:59,648 reid_baseline.train INFO: Epoch 1 done. Time per batch: 1.444[s] Speed: 11.1[samples/s]
2022-05-03 03:00:39,637 reid_baseline.train INFO: normal accuracy 0.517008335210633 4.171841144561768 
2022-05-03 03:00:40,970 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 03:00:40,971 reid_baseline.train INFO: Accuracy: 51.7% Mean Entropy: 417.2%
2022-05-03 03:02:41,953 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.805, Acc: 0.583, Base Lr: 1.66e-03
2022-05-03 03:03:38,354 reid_baseline.train INFO: Epoch 2 done. Time per batch: 1.167[s] Speed: 13.7[samples/s]
2022-05-03 03:05:45,502 reid_baseline.train INFO: normal accuracy 0.5291732372155891 4.1482133865356445 
2022-05-03 03:05:46,765 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 03:05:46,766 reid_baseline.train INFO: Accuracy: 52.9% Mean Entropy: 414.8%
2022-05-03 03:07:32,553 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.227, Acc: 0.622, Base Lr: 2.46e-03
2022-05-03 03:08:22,322 reid_baseline.train INFO: Epoch 3 done. Time per batch: 1.023[s] Speed: 15.6[samples/s]
2022-05-03 03:11:13,734 reid_baseline.train INFO: normal accuracy 0.5503491777427348 3.9558677673339844 
2022-05-03 03:11:16,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 03:11:16,065 reid_baseline.train INFO: Accuracy: 55.0% Mean Entropy: 395.6%
2022-05-03 03:13:23,243 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.471, Acc: 0.648, Base Lr: 3.25e-03
2022-05-03 03:14:20,280 reid_baseline.train INFO: Epoch 4 done. Time per batch: 1.211[s] Speed: 13.2[samples/s]
2022-05-03 03:16:47,968 reid_baseline.train INFO: normal accuracy 0.6037395809867088 3.416055202484131 
2022-05-03 03:16:49,313 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 03:16:49,314 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 341.6%
2022-05-03 03:18:42,685 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.934, Acc: 0.723, Base Lr: 4.04e-03
2022-05-03 03:19:28,649 reid_baseline.train INFO: Epoch 5 done. Time per batch: 1.048[s] Speed: 15.3[samples/s]
2022-05-03 03:22:10,450 reid_baseline.train INFO: normal accuracy 0.6801081324622663 2.8159291744232178 
2022-05-03 03:22:11,780 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 03:22:11,780 reid_baseline.train INFO: Accuracy: 68.0% Mean Entropy: 281.6%
2022-05-03 03:24:13,206 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.647, Acc: 0.769, Base Lr: 4.83e-03
2022-05-03 03:25:25,515 reid_baseline.train INFO: Epoch 6 done. Time per batch: 1.275[s] Speed: 12.6[samples/s]
2022-05-03 03:27:33,727 reid_baseline.train INFO: normal accuracy 0.7242622212209957 2.3466556072235107 
2022-05-03 03:27:34,872 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 03:27:34,872 reid_baseline.train INFO: Accuracy: 72.4% Mean Entropy: 234.7%
2022-05-03 03:28:51,336 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.431, Acc: 0.827, Base Lr: 5.62e-03
2022-05-03 03:29:27,210 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.739[s] Speed: 21.7[samples/s]
2022-05-03 03:31:27,610 reid_baseline.train INFO: normal accuracy 0.7567019599008786 2.044759511947632 
2022-05-03 03:31:28,787 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 03:31:28,788 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 204.5%
2022-05-03 03:32:48,384 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.337, Acc: 0.849, Base Lr: 6.42e-03
2022-05-03 03:33:26,896 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.777[s] Speed: 20.6[samples/s]
2022-05-03 03:35:52,220 reid_baseline.train INFO: normal accuracy 0.7632349628294661 1.9226421117782593 
2022-05-03 03:35:56,116 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 03:35:56,117 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 192.3%
2022-05-03 03:37:48,346 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.236, Acc: 0.870, Base Lr: 7.21e-03
2022-05-03 03:38:33,805 reid_baseline.train INFO: Epoch 9 done. Time per batch: 1.037[s] Speed: 15.4[samples/s]
2022-05-03 03:40:26,342 reid_baseline.train INFO: normal accuracy 0.7724712773147105 1.797443151473999 
2022-05-03 03:40:27,337 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 03:40:27,337 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 179.7%
2022-05-03 03:41:44,433 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.159, Acc: 0.892, Base Lr: 4.01e-03
2022-05-03 03:42:18,816 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.733[s] Speed: 21.8[samples/s]
2022-05-03 03:44:21,818 reid_baseline.train INFO: normal accuracy 0.7769767965758053 1.7559252977371216 
2022-05-03 03:44:22,976 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 03:44:22,976 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 175.6%
2022-05-03 03:45:59,784 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.125, Acc: 0.907, Base Lr: 3.38e-03
2022-05-03 03:46:53,819 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.992[s] Speed: 16.1[samples/s]
2022-05-03 03:49:08,434 reid_baseline.train INFO: normal accuracy 0.7772020725388601 1.735471248626709 
2022-05-03 03:49:09,754 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 03:49:09,754 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 173.5%
2022-05-03 03:50:39,749 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.097, Acc: 0.910, Base Lr: 2.77e-03
2022-05-03 03:51:15,914 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.830[s] Speed: 19.3[samples/s]
2022-05-03 03:52:55,840 reid_baseline.train INFO: normal accuracy 0.7787790042802433 1.708489179611206 
2022-05-03 03:52:56,934 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 03:52:56,934 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 170.8%
2022-05-03 03:54:19,327 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.099, Acc: 0.911, Base Lr: 2.20e-03
2022-05-03 03:54:55,749 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.782[s] Speed: 20.5[samples/s]
2022-05-03 03:57:09,796 reid_baseline.train INFO: normal accuracy 0.7781031763910791 1.6949470043182373 
2022-05-03 03:57:11,289 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 03:57:11,290 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 169.5%
2022-05-03 03:58:55,747 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.053, Acc: 0.928, Base Lr: 1.66e-03
2022-05-03 03:59:40,308 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.980[s] Speed: 16.3[samples/s]
2022-05-03 04:01:44,040 reid_baseline.train INFO: normal accuracy 0.7783284523541338 1.6859349012374878 
2022-05-03 04:01:45,011 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 04:01:45,011 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 168.6%
2022-05-03 04:03:12,555 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.056, Acc: 0.926, Base Lr: 1.19e-03
2022-05-03 04:03:54,323 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.851[s] Speed: 18.8[samples/s]
2022-05-03 04:05:53,628 reid_baseline.train INFO: normal accuracy 0.7794548321694075 1.7240800857543945 
2022-05-03 04:05:53,630 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 04:05:53,630 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 172.4%
2022-05-03 04:07:49,320 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.020, Acc: 0.943, Base Lr: 7.78e-04
2022-05-03 04:08:34,617 reid_baseline.train INFO: Epoch 16 done. Time per batch: 1.058[s] Speed: 15.1[samples/s]
2022-05-03 04:10:51,832 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.6696197986602783 
2022-05-03 04:10:52,829 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 04:10:52,829 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 167.0%
2022-05-03 04:12:09,996 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.053, Acc: 0.926, Base Lr: 4.51e-04
2022-05-03 04:12:44,127 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.732[s] Speed: 21.9[samples/s]
2022-05-03 04:14:38,073 reid_baseline.train INFO: normal accuracy 0.7823834196891192 1.7028206586837769 
2022-05-03 04:14:38,075 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 04:14:38,076 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 170.3%
2022-05-03 04:16:10,081 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.040, Acc: 0.929, Base Lr: 2.11e-04
2022-05-03 04:16:44,232 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.830[s] Speed: 19.3[samples/s]
2022-05-03 04:18:52,618 reid_baseline.train INFO: normal accuracy 0.7828339716152286 1.6368274688720703 
2022-05-03 04:18:53,905 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 04:18:53,905 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 163.7%
2022-05-03 04:20:37,317 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.018, Acc: 0.943, Base Lr: 6.51e-05
2022-05-03 04:21:31,432 reid_baseline.train INFO: Epoch 19 done. Time per batch: 1.036[s] Speed: 15.4[samples/s]
2022-05-03 04:23:24,943 reid_baseline.train INFO: normal accuracy 0.780806487947736 1.6548162698745728 
2022-05-03 04:23:24,946 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 04:23:24,946 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 165.5%
2022-05-03 04:24:41,882 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.020, Acc: 0.946, Base Lr: 1.60e-05
2022-05-03 04:25:17,177 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.738[s] Speed: 21.7[samples/s]
2022-05-03 04:27:04,061 reid_baseline.train INFO: normal accuracy 0.7814823158369002 1.6739205121994019 
2022-05-03 04:27:04,062 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 04:27:04,062 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 167.4%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_2/transformer_best_model.pth
2022-05-03 04:29:16,063 reid_baseline.train INFO: normal accuracy 0.7828339716152286 1.6368274688720703 
2022-05-03 04:29:16,064 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 04:29:16,064 reid_baseline.train INFO: Accuracy: 78.3%
2022-05-03 04:31:32,661 reid_baseline.train INFO: normal accuracy 0.7828339716152286 1.6368274688720703 
2022-05-03 04:31:32,662 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 04:31:32,662 reid_baseline.train INFO: Shuffled Accuracy: 78.3%
2022-05-03 04:33:22,653 reid_baseline.train INFO: normal accuracy 0.9798104655953852 0.8148614764213562 
2022-05-03 04:33:22,654 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 04:33:22,654 reid_baseline.train INFO: Source Clean Accuracy: 98.0%
2022-05-03 04:33:29,286 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_11
2022-05-03 04:33:29,286 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=11)
2022-05-03 04:33:29,286 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 04:33:29,287 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 04:33:29,287 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 04:33:42,343 reid_baseline.train INFO: start training
2022-05-03 04:35:18,388 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.122, Acc: 0.275, Base Lr: 8.72e-04
2022-05-03 04:35:55,346 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.861[s] Speed: 18.6[samples/s]
2022-05-03 04:37:36,624 reid_baseline.train INFO: normal accuracy 0.47690921378688894 4.172070026397705 
2022-05-03 04:37:37,477 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 04:37:37,477 reid_baseline.train INFO: Accuracy: 47.7% Mean Entropy: 417.2%
2022-05-03 04:38:46,626 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.821, Acc: 0.546, Base Lr: 1.66e-03
2022-05-03 04:39:13,652 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.633[s] Speed: 25.3[samples/s]
2022-05-03 04:41:11,171 reid_baseline.train INFO: normal accuracy 0.5104753322820456 4.152593612670898 
2022-05-03 04:41:12,117 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 04:41:12,117 reid_baseline.train INFO: Accuracy: 51.0% Mean Entropy: 415.3%
2022-05-03 04:42:50,483 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.261, Acc: 0.600, Base Lr: 2.46e-03
2022-05-03 04:43:35,157 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.941[s] Speed: 17.0[samples/s]
2022-05-03 04:45:39,667 reid_baseline.train INFO: normal accuracy 0.5287226852894796 3.997836112976074 
2022-05-03 04:45:41,046 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 04:45:41,047 reid_baseline.train INFO: Accuracy: 52.9% Mean Entropy: 399.8%
2022-05-03 04:47:25,990 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.519, Acc: 0.625, Base Lr: 3.25e-03
2022-05-03 04:48:13,761 reid_baseline.train INFO: Epoch 4 done. Time per batch: 1.005[s] Speed: 15.9[samples/s]
2022-05-03 04:50:10,133 reid_baseline.train INFO: normal accuracy 0.5872944356837125 3.5184853076934814 
2022-05-03 04:50:11,152 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 04:50:11,153 reid_baseline.train INFO: Accuracy: 58.7% Mean Entropy: 351.8%
2022-05-03 04:51:49,609 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.982, Acc: 0.709, Base Lr: 4.04e-03
2022-05-03 04:52:37,740 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.964[s] Speed: 16.6[samples/s]
2022-05-03 04:54:52,698 reid_baseline.train INFO: normal accuracy 0.6514980851543141 3.0296685695648193 
2022-05-03 04:54:54,066 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 04:54:54,066 reid_baseline.train INFO: Accuracy: 65.1% Mean Entropy: 303.0%
2022-05-03 04:56:28,085 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.700, Acc: 0.751, Base Lr: 4.83e-03
2022-05-03 04:57:12,903 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.913[s] Speed: 17.5[samples/s]
2022-05-03 04:59:02,727 reid_baseline.train INFO: normal accuracy 0.701284072989412 2.6817729473114014 
2022-05-03 04:59:03,613 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 04:59:03,614 reid_baseline.train INFO: Accuracy: 70.1% Mean Entropy: 268.2%
2022-05-03 05:00:19,327 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.485, Acc: 0.814, Base Lr: 5.62e-03
2022-05-03 05:00:55,928 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.739[s] Speed: 21.7[samples/s]
2022-05-03 05:02:32,675 reid_baseline.train INFO: normal accuracy 0.7348501914845686 2.438398838043213 
2022-05-03 05:02:33,834 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 05:02:33,835 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 243.8%
2022-05-03 05:03:51,827 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.382, Acc: 0.847, Base Lr: 6.42e-03
2022-05-03 05:04:27,073 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.744[s] Speed: 21.5[samples/s]
2022-05-03 05:06:07,354 reid_baseline.train INFO: normal accuracy 0.7488173011939626 2.3019282817840576 
2022-05-03 05:06:08,306 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 05:06:08,307 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 230.2%
2022-05-03 05:07:21,002 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.264, Acc: 0.861, Base Lr: 7.21e-03
2022-05-03 05:07:57,452 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.718[s] Speed: 22.3[samples/s]
2022-05-03 05:09:36,522 reid_baseline.train INFO: normal accuracy 0.7571525118269881 2.214869976043701 
2022-05-03 05:09:37,635 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 05:09:37,635 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 221.5%
2022-05-03 05:10:51,506 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.188, Acc: 0.887, Base Lr: 4.01e-03
2022-05-03 05:11:25,370 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.709[s] Speed: 22.6[samples/s]
2022-05-03 05:13:06,633 reid_baseline.train INFO: normal accuracy 0.7654877224600135 2.1759727001190186 
2022-05-03 05:13:07,910 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 05:13:07,910 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 217.6%
2022-05-03 05:14:22,016 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.154, Acc: 0.905, Base Lr: 3.38e-03
2022-05-03 05:14:57,196 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.719[s] Speed: 22.3[samples/s]
2022-05-03 05:16:31,805 reid_baseline.train INFO: normal accuracy 0.7688668619058346 2.187821388244629 
2022-05-03 05:16:31,807 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 05:16:31,808 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 218.8%
2022-05-03 05:17:50,128 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.120, Acc: 0.911, Base Lr: 2.77e-03
2022-05-03 05:18:25,049 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.745[s] Speed: 21.5[samples/s]
2022-05-03 05:20:05,706 reid_baseline.train INFO: normal accuracy 0.7686415859427799 2.122347593307495 
2022-05-03 05:20:06,780 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 05:20:06,781 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 212.2%
2022-05-03 05:21:21,948 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.118, Acc: 0.908, Base Lr: 2.20e-03
2022-05-03 05:21:59,281 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.740[s] Speed: 21.6[samples/s]
2022-05-03 05:23:34,618 reid_baseline.train INFO: normal accuracy 0.7686415859427799 2.101656198501587 
2022-05-03 05:23:35,491 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 05:23:35,491 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 210.2%
2022-05-03 05:24:46,984 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.073, Acc: 0.933, Base Lr: 1.66e-03
2022-05-03 05:25:21,468 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.697[s] Speed: 22.9[samples/s]
2022-05-03 05:27:04,631 reid_baseline.train INFO: normal accuracy 0.7684163099797252 2.125761032104492 
2022-05-03 05:27:04,633 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 05:27:04,633 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 212.6%
2022-05-03 05:28:15,778 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.083, Acc: 0.924, Base Lr: 1.19e-03
2022-05-03 05:28:49,755 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.692[s] Speed: 23.1[samples/s]
2022-05-03 05:30:27,846 reid_baseline.train INFO: normal accuracy 0.7733723811669295 2.106924295425415 
2022-05-03 05:30:27,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 05:30:27,848 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 210.7%
2022-05-03 05:31:43,954 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.047, Acc: 0.938, Base Lr: 7.78e-04
2022-05-03 05:32:15,686 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.709[s] Speed: 22.6[samples/s]
2022-05-03 05:33:53,379 reid_baseline.train INFO: normal accuracy 0.7731471052038748 2.0788216590881348 
2022-05-03 05:33:54,305 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 05:33:54,306 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 207.9%
2022-05-03 05:35:09,285 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.071, Acc: 0.925, Base Lr: 4.51e-04
2022-05-03 05:35:44,115 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.722[s] Speed: 22.2[samples/s]
2022-05-03 05:37:20,315 reid_baseline.train INFO: normal accuracy 0.7733723811669295 2.1112890243530273 
2022-05-03 05:37:20,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 05:37:20,317 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 211.1%
2022-05-03 05:38:31,750 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.068, Acc: 0.925, Base Lr: 2.11e-04
2022-05-03 05:39:05,571 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.692[s] Speed: 23.1[samples/s]
2022-05-03 05:40:47,542 reid_baseline.train INFO: normal accuracy 0.7756251407974769 2.0593104362487793 
2022-05-03 05:40:48,392 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 05:40:48,392 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 205.9%
2022-05-03 05:42:00,056 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.030, Acc: 0.943, Base Lr: 6.51e-05
2022-05-03 05:42:34,643 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.699[s] Speed: 22.9[samples/s]
2022-05-03 05:44:11,579 reid_baseline.train INFO: normal accuracy 0.773822933093039 2.06229829788208 
2022-05-03 05:44:11,580 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 05:44:11,580 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 206.2%
2022-05-03 05:45:27,622 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.040, Acc: 0.942, Base Lr: 1.60e-05
2022-05-03 05:46:01,604 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.724[s] Speed: 22.1[samples/s]
2022-05-03 05:47:40,130 reid_baseline.train INFO: normal accuracy 0.7735976571299842 2.077012300491333 
2022-05-03 05:47:40,130 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 05:47:40,131 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 207.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_11/transformer_best_model.pth
2022-05-03 05:49:24,646 reid_baseline.train INFO: normal accuracy 0.7756251407974769 2.0593104362487793 
2022-05-03 05:49:24,647 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 05:49:24,647 reid_baseline.train INFO: Accuracy: 77.6%
2022-05-03 05:51:05,653 reid_baseline.train INFO: normal accuracy 0.7756251407974769 2.0593104362487793 
2022-05-03 05:51:05,654 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 05:51:05,654 reid_baseline.train INFO: Shuffled Accuracy: 77.6%
2022-05-03 05:52:28,051 reid_baseline.train INFO: normal accuracy 0.9748660898228265 1.2347662448883057 
2022-05-03 05:52:28,052 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 05:52:28,052 reid_baseline.train INFO: Source Clean Accuracy: 97.5%
2022-05-03 05:52:34,009 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_12
2022-05-03 05:52:34,009 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=12)
2022-05-03 05:52:34,009 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 05:52:34,009 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 05:52:34,010 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 05:52:42,870 reid_baseline.train INFO: start training
2022-05-03 05:54:05,670 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.116, Acc: 0.292, Base Lr: 8.72e-04
2022-05-03 05:54:39,998 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.759[s] Speed: 21.1[samples/s]
2022-05-03 05:56:20,216 reid_baseline.train INFO: normal accuracy 0.4847938724938049 4.171755313873291 
2022-05-03 05:56:21,246 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 05:56:21,246 reid_baseline.train INFO: Accuracy: 48.5% Mean Entropy: 417.2%
2022-05-03 05:57:37,685 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.792, Acc: 0.537, Base Lr: 1.66e-03
2022-05-03 05:58:12,737 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.733[s] Speed: 21.8[samples/s]
2022-05-03 05:59:48,912 reid_baseline.train INFO: normal accuracy 0.503041225501239 4.146701335906982 
2022-05-03 05:59:49,810 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 05:59:49,810 reid_baseline.train INFO: Accuracy: 50.3% Mean Entropy: 414.7%
2022-05-03 06:01:01,077 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.195, Acc: 0.594, Base Lr: 2.46e-03
2022-05-03 06:01:33,469 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.682[s] Speed: 23.5[samples/s]
2022-05-03 06:03:09,381 reid_baseline.train INFO: normal accuracy 0.5305248929939176 3.9706552028656006 
2022-05-03 06:03:10,644 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 06:03:10,644 reid_baseline.train INFO: Accuracy: 53.1% Mean Entropy: 397.1%
2022-05-03 06:04:21,618 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.463, Acc: 0.635, Base Lr: 3.25e-03
2022-05-03 06:04:53,017 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.673[s] Speed: 23.8[samples/s]
2022-05-03 06:06:23,588 reid_baseline.train INFO: normal accuracy 0.6037395809867088 3.5659220218658447 
2022-05-03 06:06:24,478 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 06:06:24,478 reid_baseline.train INFO: Accuracy: 60.4% Mean Entropy: 356.6%
2022-05-03 06:07:33,412 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.957, Acc: 0.715, Base Lr: 4.04e-03
2022-05-03 06:08:05,693 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.666[s] Speed: 24.0[samples/s]
2022-05-03 06:09:37,847 reid_baseline.train INFO: normal accuracy 0.6699707141248029 3.1777477264404297 
2022-05-03 06:09:38,676 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 06:09:38,676 reid_baseline.train INFO: Accuracy: 67.0% Mean Entropy: 317.8%
2022-05-03 06:10:49,348 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.694, Acc: 0.755, Base Lr: 4.83e-03
2022-05-03 06:11:22,884 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.685[s] Speed: 23.4[samples/s]
2022-05-03 06:13:02,397 reid_baseline.train INFO: normal accuracy 0.7197567019599008 2.8799424171447754 
2022-05-03 06:13:03,450 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 06:13:03,450 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 288.0%
2022-05-03 06:14:15,634 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.480, Acc: 0.817, Base Lr: 5.62e-03
2022-05-03 06:14:50,490 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.704[s] Speed: 22.7[samples/s]
2022-05-03 06:16:27,365 reid_baseline.train INFO: normal accuracy 0.7494931290831268 2.550757884979248 
2022-05-03 06:16:28,650 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 06:16:28,650 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 255.1%
2022-05-03 06:17:40,149 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.385, Acc: 0.838, Base Lr: 6.42e-03
2022-05-03 06:18:14,980 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.699[s] Speed: 22.9[samples/s]
2022-05-03 06:19:48,668 reid_baseline.train INFO: normal accuracy 0.7578283397161523 2.4679088592529297 
2022-05-03 06:19:49,472 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 06:19:49,472 reid_baseline.train INFO: Accuracy: 75.8% Mean Entropy: 246.8%
2022-05-03 06:21:01,515 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.271, Acc: 0.861, Base Lr: 7.21e-03
2022-05-03 06:21:35,967 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.701[s] Speed: 22.8[samples/s]
2022-05-03 06:23:07,712 reid_baseline.train INFO: normal accuracy 0.7648118945708493 2.3622231483459473 
2022-05-03 06:23:08,619 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 06:23:08,619 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 236.2%
2022-05-03 06:24:20,011 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.198, Acc: 0.890, Base Lr: 4.01e-03
2022-05-03 06:24:53,659 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.691[s] Speed: 23.2[samples/s]
2022-05-03 06:26:29,871 reid_baseline.train INFO: normal accuracy 0.7690921378688894 2.346153974533081 
2022-05-03 06:26:30,978 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 06:26:30,978 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 234.6%
2022-05-03 06:27:40,816 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.156, Acc: 0.903, Base Lr: 3.38e-03
2022-05-03 06:28:14,062 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.678[s] Speed: 23.6[samples/s]
2022-05-03 06:29:49,505 reid_baseline.train INFO: normal accuracy 0.7740482090560937 2.3673694133758545 
2022-05-03 06:29:49,508 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 06:29:49,508 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 236.7%
2022-05-03 06:30:57,761 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.119, Acc: 0.906, Base Lr: 2.77e-03
2022-05-03 06:31:31,768 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.673[s] Speed: 23.8[samples/s]
2022-05-03 06:33:06,055 reid_baseline.train INFO: normal accuracy 0.772020725388601 2.311229705810547 
2022-05-03 06:33:06,882 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 06:33:06,882 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 231.1%
2022-05-03 06:34:20,607 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.117, Acc: 0.908, Base Lr: 2.20e-03
2022-05-03 06:34:55,816 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.717[s] Speed: 22.3[samples/s]
2022-05-03 06:36:27,432 reid_baseline.train INFO: normal accuracy 0.772020725388601 2.301064968109131 
2022-05-03 06:36:28,294 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 06:36:28,294 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 230.1%
2022-05-03 06:37:39,152 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.082, Acc: 0.922, Base Lr: 1.66e-03
2022-05-03 06:38:11,107 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.676[s] Speed: 23.7[samples/s]
2022-05-03 06:39:47,851 reid_baseline.train INFO: normal accuracy 0.7733723811669295 2.3104915618896484 
2022-05-03 06:39:47,854 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 06:39:47,854 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 231.0%
2022-05-03 06:40:58,946 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.083, Acc: 0.914, Base Lr: 1.19e-03
2022-05-03 06:41:33,508 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.695[s] Speed: 23.0[samples/s]
2022-05-03 06:43:06,429 reid_baseline.train INFO: normal accuracy 0.7749493129083127 2.3075919151306152 
2022-05-03 06:43:06,429 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 06:43:06,429 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 230.8%
2022-05-03 06:44:18,668 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.047, Acc: 0.938, Base Lr: 7.78e-04
2022-05-03 06:44:51,259 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.690[s] Speed: 23.2[samples/s]
2022-05-03 06:46:27,709 reid_baseline.train INFO: normal accuracy 0.7763009686866411 2.292426109313965 
2022-05-03 06:46:28,560 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 06:46:28,560 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 229.2%
2022-05-03 06:47:43,366 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.081, Acc: 0.916, Base Lr: 4.51e-04
2022-05-03 06:48:16,360 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.709[s] Speed: 22.6[samples/s]
2022-05-03 06:49:48,521 reid_baseline.train INFO: normal accuracy 0.7767515206127507 2.308292865753174 
2022-05-03 06:49:48,523 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 06:49:48,523 reid_baseline.train INFO: Accuracy: 77.7% Mean Entropy: 230.8%
2022-05-03 06:50:59,335 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.064, Acc: 0.925, Base Lr: 2.11e-04
2022-05-03 06:51:34,756 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.699[s] Speed: 22.9[samples/s]
2022-05-03 06:53:11,913 reid_baseline.train INFO: normal accuracy 0.7776526244649696 2.274599075317383 
2022-05-03 06:53:12,866 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 06:53:12,866 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 227.5%
2022-05-03 06:54:22,367 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.035, Acc: 0.941, Base Lr: 6.51e-05
2022-05-03 06:54:55,879 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.678[s] Speed: 23.6[samples/s]
2022-05-03 06:56:31,431 reid_baseline.train INFO: normal accuracy 0.7785537283171886 2.2641284465789795 
2022-05-03 06:56:32,256 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 06:56:32,256 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 226.4%
2022-05-03 06:57:44,036 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.042, Acc: 0.940, Base Lr: 1.60e-05
2022-05-03 06:58:16,899 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.688[s] Speed: 23.2[samples/s]
2022-05-03 06:59:51,856 reid_baseline.train INFO: normal accuracy 0.7794548321694075 2.29226016998291 
2022-05-03 06:59:51,858 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 06:59:51,858 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 229.2%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Product_shuffled_Cross_Domain_key_layer_12/transformer_best_model.pth
2022-05-03 07:01:31,002 reid_baseline.train INFO: normal accuracy 0.7785537283171886 2.2641284465789795 
2022-05-03 07:01:31,002 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 07:01:31,002 reid_baseline.train INFO: Accuracy: 77.9%
2022-05-03 07:03:04,292 reid_baseline.train INFO: normal accuracy 0.7785537283171886 2.2641284465789795 
2022-05-03 07:03:04,292 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 07:03:04,292 reid_baseline.train INFO: Shuffled Accuracy: 77.9%
2022-05-03 07:04:23,684 reid_baseline.train INFO: normal accuracy 0.9756901524515863 1.4077844619750977 
2022-05-03 07:04:23,685 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 07:04:23,685 reid_baseline.train INFO: Source Clean Accuracy: 97.6%
2022-05-03 07:04:30,632 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_2
2022-05-03 07:04:30,633 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=2)
2022-05-03 07:04:30,633 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 07:04:30,633 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 07:04:30,633 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 07:04:40,490 reid_baseline.train INFO: start training
2022-05-03 07:05:59,977 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.119, Acc: 0.296, Base Lr: 8.72e-04
2022-05-03 07:06:34,127 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.733[s] Speed: 21.8[samples/s]
2022-05-03 07:10:59,405 reid_baseline.train INFO: normal accuracy 0.5926095937571724 4.171531677246094 
2022-05-03 07:11:00,151 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 07:11:00,152 reid_baseline.train INFO: Accuracy: 59.3% Mean Entropy: 417.2%
2022-05-03 07:11:51,855 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.805, Acc: 0.583, Base Lr: 1.66e-03
2022-05-03 07:12:14,390 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.488[s] Speed: 32.8[samples/s]
2022-05-03 07:16:03,090 reid_baseline.train INFO: normal accuracy 0.619233417489098 4.136931896209717 
2022-05-03 07:16:03,894 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 07:16:03,894 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 413.7%
2022-05-03 07:16:55,272 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.227, Acc: 0.622, Base Lr: 2.46e-03
2022-05-03 07:17:19,856 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.500[s] Speed: 32.0[samples/s]
2022-05-03 07:21:01,414 reid_baseline.train INFO: normal accuracy 0.6366766123479458 3.839620351791382 
2022-05-03 07:21:02,236 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 07:21:02,236 reid_baseline.train INFO: Accuracy: 63.7% Mean Entropy: 384.0%
2022-05-03 07:21:55,149 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.471, Acc: 0.648, Base Lr: 3.25e-03
2022-05-03 07:22:18,278 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.500[s] Speed: 32.0[samples/s]
2022-05-03 07:25:58,913 reid_baseline.train INFO: normal accuracy 0.690383291255451 3.146782636642456 
2022-05-03 07:26:00,010 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 07:26:00,010 reid_baseline.train INFO: Accuracy: 69.0% Mean Entropy: 314.7%
2022-05-03 07:26:48,563 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.934, Acc: 0.723, Base Lr: 4.04e-03
2022-05-03 07:27:13,154 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.481[s] Speed: 33.3[samples/s]
2022-05-03 07:31:07,431 reid_baseline.train INFO: normal accuracy 0.7452375487720909 2.494940757751465 
2022-05-03 07:31:08,233 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 07:31:08,234 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 249.5%
2022-05-03 07:31:56,603 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.647, Acc: 0.769, Base Lr: 4.83e-03
2022-05-03 07:32:19,217 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.467[s] Speed: 34.3[samples/s]
2022-05-03 07:36:04,350 reid_baseline.train INFO: normal accuracy 0.7876979573100757 2.0533978939056396 
2022-05-03 07:36:05,138 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 07:36:05,138 reid_baseline.train INFO: Accuracy: 78.8% Mean Entropy: 205.3%
2022-05-03 07:36:53,358 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.431, Acc: 0.827, Base Lr: 5.62e-03
2022-05-03 07:37:14,694 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.458[s] Speed: 35.0[samples/s]
2022-05-03 07:41:00,062 reid_baseline.train INFO: normal accuracy 0.815698875372963 1.7946288585662842 
2022-05-03 07:41:00,838 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 07:41:00,838 reid_baseline.train INFO: Accuracy: 81.6% Mean Entropy: 179.5%
2022-05-03 07:41:48,278 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.337, Acc: 0.848, Base Lr: 6.42e-03
2022-05-03 07:42:10,551 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.459[s] Speed: 34.9[samples/s]
2022-05-03 07:45:51,103 reid_baseline.train INFO: normal accuracy 0.8177645168694055 1.6669838428497314 
2022-05-03 07:45:52,058 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 07:45:52,058 reid_baseline.train INFO: Accuracy: 81.8% Mean Entropy: 166.7%
2022-05-03 07:46:43,168 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.236, Acc: 0.870, Base Lr: 7.21e-03
2022-05-03 07:47:05,792 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.485[s] Speed: 33.0[samples/s]
2022-05-03 07:50:41,807 reid_baseline.train INFO: normal accuracy 0.8290107872389259 1.547719955444336 
2022-05-03 07:50:42,692 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 07:50:42,692 reid_baseline.train INFO: Accuracy: 82.9% Mean Entropy: 154.8%
2022-05-03 07:51:33,922 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.159, Acc: 0.892, Base Lr: 4.01e-03
2022-05-03 07:51:56,664 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.485[s] Speed: 33.0[samples/s]
2022-05-03 07:55:49,784 reid_baseline.train INFO: normal accuracy 0.8269451457424833 1.5081329345703125 
2022-05-03 07:55:50,626 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 07:55:50,626 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 150.8%
2022-05-03 07:56:39,638 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.125, Acc: 0.906, Base Lr: 3.38e-03
2022-05-03 07:57:00,713 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.460[s] Speed: 34.7[samples/s]
2022-05-03 08:00:40,940 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.5042738914489746 
2022-05-03 08:00:41,859 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 08:00:41,859 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 150.4%
2022-05-03 08:01:29,956 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.097, Acc: 0.910, Base Lr: 2.77e-03
2022-05-03 08:01:51,930 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.461[s] Speed: 34.7[samples/s]
2022-05-03 08:05:44,199 reid_baseline.train INFO: normal accuracy 0.8313059444571953 1.4740099906921387 
2022-05-03 08:05:45,038 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 08:05:45,038 reid_baseline.train INFO: Accuracy: 83.1% Mean Entropy: 147.4%
2022-05-03 08:06:33,626 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.099, Acc: 0.911, Base Lr: 2.20e-03
2022-05-03 08:06:57,631 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.477[s] Speed: 33.6[samples/s]
2022-05-03 08:10:40,858 reid_baseline.train INFO: normal accuracy 0.8319944916226761 1.4573196172714233 
2022-05-03 08:10:41,682 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 08:10:41,682 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 145.7%
2022-05-03 08:11:26,519 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.053, Acc: 0.929, Base Lr: 1.66e-03
2022-05-03 08:11:45,362 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.418[s] Speed: 38.3[samples/s]
2022-05-03 08:15:09,067 reid_baseline.train INFO: normal accuracy 0.8345191645627725 1.4564423561096191 
2022-05-03 08:15:09,890 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 08:15:09,891 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 145.6%
2022-05-03 08:15:54,974 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.056, Acc: 0.926, Base Lr: 1.19e-03
2022-05-03 08:16:15,483 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.431[s] Speed: 37.2[samples/s]
2022-05-03 08:19:36,757 reid_baseline.train INFO: normal accuracy 0.8315354601790222 1.4941661357879639 
2022-05-03 08:19:36,758 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 08:19:36,758 reid_baseline.train INFO: Accuracy: 83.2% Mean Entropy: 149.4%
2022-05-03 08:20:21,845 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.020, Acc: 0.943, Base Lr: 7.78e-04
2022-05-03 08:20:40,929 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.422[s] Speed: 38.0[samples/s]
2022-05-03 08:24:06,945 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4314923286437988 
2022-05-03 08:24:07,742 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 08:24:07,743 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 143.1%
2022-05-03 08:24:53,236 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.053, Acc: 0.926, Base Lr: 4.51e-04
2022-05-03 08:25:12,113 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.423[s] Speed: 37.9[samples/s]
2022-05-03 08:28:37,446 reid_baseline.train INFO: normal accuracy 0.8352077117282534 1.4707658290863037 
2022-05-03 08:28:37,446 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 08:28:37,446 reid_baseline.train INFO: Accuracy: 83.5% Mean Entropy: 147.1%
2022-05-03 08:29:22,707 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.040, Acc: 0.929, Base Lr: 2.11e-04
2022-05-03 08:29:42,340 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.425[s] Speed: 37.6[samples/s]
2022-05-03 08:33:08,133 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.4005467891693115 
2022-05-03 08:33:08,933 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 08:33:08,933 reid_baseline.train INFO: Accuracy: 83.7% Mean Entropy: 140.1%
2022-05-03 08:33:53,727 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.018, Acc: 0.943, Base Lr: 6.51e-05
2022-05-03 08:34:15,096 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.434[s] Speed: 36.9[samples/s]
2022-05-03 08:37:35,417 reid_baseline.train INFO: normal accuracy 0.832683038788157 1.425721526145935 
2022-05-03 08:37:35,417 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 08:37:35,418 reid_baseline.train INFO: Accuracy: 83.3% Mean Entropy: 142.6%
2022-05-03 08:38:18,898 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.020, Acc: 0.946, Base Lr: 1.60e-05
2022-05-03 08:38:38,320 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.414[s] Speed: 38.7[samples/s]
2022-05-03 08:42:01,097 reid_baseline.train INFO: normal accuracy 0.8356667431719073 1.4367070198059082 
2022-05-03 08:42:01,097 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 08:42:01,097 reid_baseline.train INFO: Accuracy: 83.6% Mean Entropy: 143.7%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_2/transformer_best_model.pth
2022-05-03 08:45:26,783 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.4005467891693115 
2022-05-03 08:45:26,783 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 08:45:26,783 reid_baseline.train INFO: Accuracy: 83.7%
2022-05-03 08:48:57,529 reid_baseline.train INFO: normal accuracy 0.836814321781042 1.4005467891693115 
2022-05-03 08:48:57,530 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 08:48:57,530 reid_baseline.train INFO: Shuffled Accuracy: 83.7%
2022-05-03 08:49:57,744 reid_baseline.train INFO: normal accuracy 0.9798104655953852 0.814862072467804 
2022-05-03 08:49:57,744 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 08:49:57,745 reid_baseline.train INFO: Source Clean Accuracy: 98.0%
2022-05-03 08:50:02,887 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_11
2022-05-03 08:50:02,887 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=11)
2022-05-03 08:50:02,887 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 08:50:02,888 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 08:50:02,888 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 08:50:12,561 reid_baseline.train INFO: start training
2022-05-03 08:51:02,275 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.122, Acc: 0.275, Base Lr: 8.72e-04
2022-05-03 08:51:22,810 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.455[s] Speed: 35.2[samples/s]
2022-05-03 08:54:53,909 reid_baseline.train INFO: normal accuracy 0.5618544870323617 4.1718549728393555 
2022-05-03 08:54:54,697 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 08:54:54,697 reid_baseline.train INFO: Accuracy: 56.2% Mean Entropy: 417.2%
2022-05-03 08:55:38,093 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.821, Acc: 0.546, Base Lr: 1.66e-03
2022-05-03 08:55:57,546 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.413[s] Speed: 38.7[samples/s]
2022-05-03 08:59:30,791 reid_baseline.train INFO: normal accuracy 0.5937571723663071 4.144862174987793 
2022-05-03 08:59:31,612 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 08:59:31,613 reid_baseline.train INFO: Accuracy: 59.4% Mean Entropy: 414.5%
2022-05-03 09:00:13,531 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.261, Acc: 0.600, Base Lr: 2.46e-03
2022-05-03 09:00:34,612 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.414[s] Speed: 38.7[samples/s]
2022-05-03 09:04:04,630 reid_baseline.train INFO: normal accuracy 0.6217580904291944 3.91142201423645 
2022-05-03 09:04:05,428 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 09:04:05,429 reid_baseline.train INFO: Accuracy: 62.2% Mean Entropy: 391.1%
2022-05-03 09:04:50,609 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.519, Acc: 0.625, Base Lr: 3.25e-03
2022-05-03 09:05:08,984 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.418[s] Speed: 38.3[samples/s]
2022-05-03 09:08:37,775 reid_baseline.train INFO: normal accuracy 0.673628643562084 3.292121410369873 
2022-05-03 09:08:38,586 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 09:08:38,586 reid_baseline.train INFO: Accuracy: 67.4% Mean Entropy: 329.2%
2022-05-03 09:09:24,952 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.982, Acc: 0.708, Base Lr: 4.04e-03
2022-05-03 09:09:43,940 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.430[s] Speed: 37.2[samples/s]
2022-05-03 09:13:23,867 reid_baseline.train INFO: normal accuracy 0.7218269451457425 2.763355255126953 
2022-05-03 09:13:24,670 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 09:13:24,670 reid_baseline.train INFO: Accuracy: 72.2% Mean Entropy: 276.3%
2022-05-03 09:14:11,179 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.700, Acc: 0.751, Base Lr: 4.83e-03
2022-05-03 09:14:32,622 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.447[s] Speed: 35.8[samples/s]
2022-05-03 09:18:01,677 reid_baseline.train INFO: normal accuracy 0.7707137938948818 2.421566963195801 
2022-05-03 09:18:02,468 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 09:18:02,468 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 242.2%
2022-05-03 09:18:48,405 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.484, Acc: 0.814, Base Lr: 5.62e-03
2022-05-03 09:19:08,436 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.434[s] Speed: 36.9[samples/s]
2022-05-03 09:22:34,359 reid_baseline.train INFO: normal accuracy 0.795042460408538 2.210604429244995 
2022-05-03 09:22:35,167 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 09:22:35,167 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 221.1%
2022-05-03 09:23:20,197 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.382, Acc: 0.848, Base Lr: 6.42e-03
2022-05-03 09:23:40,837 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.432[s] Speed: 37.0[samples/s]
2022-05-03 09:27:08,976 reid_baseline.train INFO: normal accuracy 0.8056001836125775 2.0847971439361572 
2022-05-03 09:27:09,769 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 09:27:09,770 reid_baseline.train INFO: Accuracy: 80.6% Mean Entropy: 208.5%
2022-05-03 09:27:55,270 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.264, Acc: 0.861, Base Lr: 7.21e-03
2022-05-03 09:28:15,263 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.431[s] Speed: 37.1[samples/s]
2022-05-03 09:31:33,229 reid_baseline.train INFO: normal accuracy 0.8168464539820978 1.9884144067764282 
2022-05-03 09:31:34,102 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 09:31:34,102 reid_baseline.train INFO: Accuracy: 81.7% Mean Entropy: 198.8%
2022-05-03 09:32:19,332 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.188, Acc: 0.887, Base Lr: 4.01e-03
2022-05-03 09:32:39,743 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.432[s] Speed: 37.1[samples/s]
2022-05-03 09:36:16,703 reid_baseline.train INFO: normal accuracy 0.8166169382602708 1.9531267881393433 
2022-05-03 09:36:17,505 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 09:36:17,505 reid_baseline.train INFO: Accuracy: 81.7% Mean Entropy: 195.3%
2022-05-03 09:37:00,402 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.153, Acc: 0.903, Base Lr: 3.38e-03
2022-05-03 09:37:20,169 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.411[s] Speed: 38.9[samples/s]
2022-05-03 09:40:49,703 reid_baseline.train INFO: normal accuracy 0.8184530640348864 1.973459243774414 
2022-05-03 09:40:49,703 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 09:40:49,704 reid_baseline.train INFO: Accuracy: 81.8% Mean Entropy: 197.3%
2022-05-03 09:41:32,147 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.119, Acc: 0.911, Base Lr: 2.77e-03
2022-05-03 09:41:51,271 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.405[s] Speed: 39.6[samples/s]
2022-05-03 09:45:26,774 reid_baseline.train INFO: normal accuracy 0.8223548313059444 1.9048357009887695 
2022-05-03 09:45:27,558 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 09:45:27,559 reid_baseline.train INFO: Accuracy: 82.2% Mean Entropy: 190.5%
2022-05-03 09:46:14,326 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.120, Acc: 0.906, Base Lr: 2.20e-03
2022-05-03 09:46:33,482 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.434[s] Speed: 36.9[samples/s]
2022-05-03 09:49:58,858 reid_baseline.train INFO: normal accuracy 0.8228138627495983 1.8870373964309692 
2022-05-03 09:49:59,679 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 09:49:59,680 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 188.7%
2022-05-03 09:50:46,204 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.073, Acc: 0.931, Base Lr: 1.66e-03
2022-05-03 09:51:06,629 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.440[s] Speed: 36.4[samples/s]
2022-05-03 09:54:34,024 reid_baseline.train INFO: normal accuracy 0.8228138627495983 1.9152920246124268 
2022-05-03 09:54:34,024 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 09:54:34,025 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 191.5%
2022-05-03 09:55:21,078 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.083, Acc: 0.927, Base Lr: 1.19e-03
2022-05-03 09:55:42,017 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.447[s] Speed: 35.8[samples/s]
2022-05-03 09:59:02,106 reid_baseline.train INFO: normal accuracy 0.8232728941932522 1.8995469808578491 
2022-05-03 09:59:02,106 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 09:59:02,106 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 190.0%
2022-05-03 09:59:49,279 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.047, Acc: 0.939, Base Lr: 7.78e-04
2022-05-03 10:00:09,303 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.441[s] Speed: 36.3[samples/s]
2022-05-03 10:03:33,872 reid_baseline.train INFO: normal accuracy 0.8267156300206564 1.8659015893936157 
2022-05-03 10:03:34,761 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 10:03:34,761 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 186.6%
2022-05-03 10:04:20,637 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.071, Acc: 0.923, Base Lr: 4.51e-04
2022-05-03 10:04:41,087 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.436[s] Speed: 36.7[samples/s]
2022-05-03 10:08:07,958 reid_baseline.train INFO: normal accuracy 0.8260270828551756 1.9062838554382324 
2022-05-03 10:08:07,959 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 10:08:07,959 reid_baseline.train INFO: Accuracy: 82.6% Mean Entropy: 190.6%
2022-05-03 10:08:52,695 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.068, Acc: 0.925, Base Lr: 2.11e-04
2022-05-03 10:09:12,452 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.424[s] Speed: 37.7[samples/s]
2022-05-03 10:12:48,130 reid_baseline.train INFO: normal accuracy 0.8271746614643103 1.8413736820220947 
2022-05-03 10:12:48,914 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 10:12:48,915 reid_baseline.train INFO: Accuracy: 82.7% Mean Entropy: 184.1%
2022-05-03 10:13:33,218 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.030, Acc: 0.941, Base Lr: 6.51e-05
2022-05-03 10:13:54,572 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.432[s] Speed: 37.0[samples/s]
2022-05-03 10:17:32,482 reid_baseline.train INFO: normal accuracy 0.824420472802387 1.8620814085006714 
2022-05-03 10:17:32,483 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 10:17:32,483 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 186.2%
2022-05-03 10:18:17,086 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.040, Acc: 0.940, Base Lr: 1.60e-05
2022-05-03 10:18:37,075 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.425[s] Speed: 37.7[samples/s]
2022-05-03 10:22:18,680 reid_baseline.train INFO: normal accuracy 0.8251090199678678 1.8592318296432495 
2022-05-03 10:22:18,681 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 10:22:18,681 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 185.9%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_11/transformer_best_model.pth
2022-05-03 10:25:55,021 reid_baseline.train INFO: normal accuracy 0.8271746614643103 1.8413736820220947 
2022-05-03 10:25:55,021 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 10:25:55,021 reid_baseline.train INFO: Accuracy: 82.7%
2022-05-03 10:29:27,514 reid_baseline.train INFO: normal accuracy 0.8271746614643103 1.8413736820220947 
2022-05-03 10:29:27,514 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 10:29:27,514 reid_baseline.train INFO: Shuffled Accuracy: 82.7%
2022-05-03 10:30:28,653 reid_baseline.train INFO: normal accuracy 0.9744540585084467 1.2357326745986938 
2022-05-03 10:30:28,653 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 10:30:28,654 reid_baseline.train INFO: Source Clean Accuracy: 97.4%
2022-05-03 10:30:34,294 reid_baseline INFO: Saving model in the path :../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_12
2022-05-03 10:30:34,294 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Art.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=12)
2022-05-03 10:30:34,294 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 10:30:34,294 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 10:30:34,295 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Art and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     2427 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 10:30:43,774 reid_baseline.train INFO: start training
2022-05-03 10:31:34,702 reid_baseline.train INFO: Epoch[1] Iteration[100/152] Loss: 4.116, Acc: 0.292, Base Lr: 8.72e-04
2022-05-03 10:31:52,856 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.449[s] Speed: 35.6[samples/s]
2022-05-03 10:35:24,602 reid_baseline.train INFO: normal accuracy 0.5643791599724581 4.1715006828308105 
2022-05-03 10:35:25,361 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 10:35:25,362 reid_baseline.train INFO: Accuracy: 56.4% Mean Entropy: 417.2%
2022-05-03 10:36:12,720 reid_baseline.train INFO: Epoch[2] Iteration[100/152] Loss: 3.792, Acc: 0.537, Base Lr: 1.66e-03
2022-05-03 10:36:32,407 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.441[s] Speed: 36.3[samples/s]
2022-05-03 10:40:01,117 reid_baseline.train INFO: normal accuracy 0.5974294239155382 4.136762619018555 
2022-05-03 10:40:01,919 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 10:40:01,919 reid_baseline.train INFO: Accuracy: 59.7% Mean Entropy: 413.7%
2022-05-03 10:40:48,955 reid_baseline.train INFO: Epoch[3] Iteration[100/152] Loss: 3.195, Acc: 0.593, Base Lr: 2.46e-03
2022-05-03 10:41:10,025 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.448[s] Speed: 35.7[samples/s]
2022-05-03 10:44:36,054 reid_baseline.train INFO: normal accuracy 0.6185448703236172 3.869441270828247 
2022-05-03 10:44:36,845 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 10:44:36,845 reid_baseline.train INFO: Accuracy: 61.9% Mean Entropy: 386.9%
2022-05-03 10:45:23,691 reid_baseline.train INFO: Epoch[4] Iteration[100/152] Loss: 2.463, Acc: 0.635, Base Lr: 3.25e-03
2022-05-03 10:45:44,410 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.443[s] Speed: 36.1[samples/s]
2022-05-03 10:49:13,389 reid_baseline.train INFO: normal accuracy 0.6727105806747762 3.3473870754241943 
2022-05-03 10:49:14,181 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 10:49:14,181 reid_baseline.train INFO: Accuracy: 67.3% Mean Entropy: 334.7%
2022-05-03 10:50:00,750 reid_baseline.train INFO: Epoch[5] Iteration[100/152] Loss: 1.957, Acc: 0.715, Base Lr: 4.04e-03
2022-05-03 10:50:20,685 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.437[s] Speed: 36.6[samples/s]
2022-05-03 10:54:03,216 reid_baseline.train INFO: normal accuracy 0.7271058067477623 2.922955274581909 
2022-05-03 10:54:04,049 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 10:54:04,049 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 292.3%
2022-05-03 10:54:49,994 reid_baseline.train INFO: Epoch[6] Iteration[100/152] Loss: 1.694, Acc: 0.754, Base Lr: 4.83e-03
2022-05-03 10:55:11,335 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.442[s] Speed: 36.2[samples/s]
2022-05-03 10:58:45,474 reid_baseline.train INFO: normal accuracy 0.7757631397750746 2.636833429336548 
2022-05-03 10:58:46,281 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 10:58:46,282 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 263.7%
2022-05-03 10:59:30,137 reid_baseline.train INFO: Epoch[7] Iteration[100/152] Loss: 1.480, Acc: 0.818, Base Lr: 5.62e-03
2022-05-03 10:59:51,511 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.429[s] Speed: 37.3[samples/s]
2022-05-03 11:03:28,505 reid_baseline.train INFO: normal accuracy 0.8005508377323847 2.3416380882263184 
2022-05-03 11:03:29,316 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 11:03:29,316 reid_baseline.train INFO: Accuracy: 80.1% Mean Entropy: 234.2%
2022-05-03 11:04:14,757 reid_baseline.train INFO: Epoch[8] Iteration[100/152] Loss: 1.385, Acc: 0.838, Base Lr: 6.42e-03
2022-05-03 11:04:34,664 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.429[s] Speed: 37.3[samples/s]
2022-05-03 11:08:00,621 reid_baseline.train INFO: normal accuracy 0.8072067936653661 2.258917808532715 
2022-05-03 11:08:01,353 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 11:08:01,353 reid_baseline.train INFO: Accuracy: 80.7% Mean Entropy: 225.9%
2022-05-03 11:08:48,157 reid_baseline.train INFO: Epoch[9] Iteration[100/152] Loss: 1.271, Acc: 0.860, Base Lr: 7.21e-03
2022-05-03 11:09:08,768 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.442[s] Speed: 36.2[samples/s]
2022-05-03 11:12:32,371 reid_baseline.train INFO: normal accuracy 0.8166169382602708 2.1518354415893555 
2022-05-03 11:12:33,215 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 11:12:33,216 reid_baseline.train INFO: Accuracy: 81.7% Mean Entropy: 215.2%
2022-05-03 11:13:14,638 reid_baseline.train INFO: Epoch[10] Iteration[100/152] Loss: 1.198, Acc: 0.891, Base Lr: 4.01e-03
2022-05-03 11:13:34,884 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.405[s] Speed: 39.5[samples/s]
2022-05-03 11:17:14,177 reid_baseline.train INFO: normal accuracy 0.8189120954785403 2.142997980117798 
2022-05-03 11:17:15,026 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 11:17:15,026 reid_baseline.train INFO: Accuracy: 81.9% Mean Entropy: 214.3%
2022-05-03 11:18:00,636 reid_baseline.train INFO: Epoch[11] Iteration[100/152] Loss: 1.157, Acc: 0.901, Base Lr: 3.38e-03
2022-05-03 11:18:19,466 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.424[s] Speed: 37.7[samples/s]
2022-05-03 11:21:47,890 reid_baseline.train INFO: normal accuracy 0.8202891898095019 2.1627275943756104 
2022-05-03 11:21:47,891 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 11:21:47,891 reid_baseline.train INFO: Accuracy: 82.0% Mean Entropy: 216.3%
2022-05-03 11:22:33,660 reid_baseline.train INFO: Epoch[12] Iteration[100/152] Loss: 1.119, Acc: 0.906, Base Lr: 2.77e-03
2022-05-03 11:22:54,393 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.437[s] Speed: 36.6[samples/s]
2022-05-03 11:26:22,446 reid_baseline.train INFO: normal accuracy 0.8228138627495983 2.1067452430725098 
2022-05-03 11:26:23,285 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 11:26:23,285 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 210.7%
2022-05-03 11:27:10,430 reid_baseline.train INFO: Epoch[13] Iteration[100/152] Loss: 1.116, Acc: 0.909, Base Lr: 2.20e-03
2022-05-03 11:27:32,613 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.456[s] Speed: 35.1[samples/s]
2022-05-03 11:30:59,740 reid_baseline.train INFO: normal accuracy 0.824420472802387 2.0983824729919434 
2022-05-03 11:31:00,569 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 11:31:00,569 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 209.8%
2022-05-03 11:31:46,640 reid_baseline.train INFO: Epoch[14] Iteration[100/152] Loss: 1.082, Acc: 0.922, Base Lr: 1.66e-03
2022-05-03 11:32:06,866 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.436[s] Speed: 36.7[samples/s]
2022-05-03 11:35:35,801 reid_baseline.train INFO: normal accuracy 0.8228138627495983 2.110318183898926 
2022-05-03 11:35:35,801 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 11:35:35,801 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 211.0%
2022-05-03 11:36:23,500 reid_baseline.train INFO: Epoch[15] Iteration[100/152] Loss: 1.083, Acc: 0.915, Base Lr: 1.19e-03
2022-05-03 11:36:44,755 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.453[s] Speed: 35.3[samples/s]
2022-05-03 11:40:12,341 reid_baseline.train INFO: normal accuracy 0.8205187055313289 2.108283758163452 
2022-05-03 11:40:12,342 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 11:40:12,342 reid_baseline.train INFO: Accuracy: 82.1% Mean Entropy: 210.8%
2022-05-03 11:41:00,166 reid_baseline.train INFO: Epoch[16] Iteration[100/152] Loss: 1.047, Acc: 0.937, Base Lr: 7.78e-04
2022-05-03 11:41:19,947 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.443[s] Speed: 36.1[samples/s]
2022-05-03 11:44:52,178 reid_baseline.train INFO: normal accuracy 0.8248795042460408 2.083310127258301 
2022-05-03 11:44:53,112 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 11:44:53,112 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 208.3%
2022-05-03 11:45:41,755 reid_baseline.train INFO: Epoch[17] Iteration[100/152] Loss: 1.081, Acc: 0.918, Base Lr: 4.51e-04
2022-05-03 11:46:02,403 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.456[s] Speed: 35.1[samples/s]
2022-05-03 11:49:36,103 reid_baseline.train INFO: normal accuracy 0.8230433784714253 2.1044318675994873 
2022-05-03 11:49:36,104 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 11:49:36,104 reid_baseline.train INFO: Accuracy: 82.3% Mean Entropy: 210.4%
2022-05-03 11:50:19,772 reid_baseline.train INFO: Epoch[18] Iteration[100/152] Loss: 1.064, Acc: 0.924, Base Lr: 2.11e-04
2022-05-03 11:50:41,144 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.428[s] Speed: 37.4[samples/s]
2022-05-03 11:54:20,337 reid_baseline.train INFO: normal accuracy 0.8248795042460408 2.062253713607788 
2022-05-03 11:54:21,189 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 11:54:21,189 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 206.2%
2022-05-03 11:55:04,625 reid_baseline.train INFO: Epoch[19] Iteration[100/152] Loss: 1.035, Acc: 0.941, Base Lr: 6.51e-05
2022-05-03 11:55:24,005 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.413[s] Speed: 38.7[samples/s]
2022-05-03 11:58:54,590 reid_baseline.train INFO: normal accuracy 0.8235024099150792 2.066375732421875 
2022-05-03 11:58:54,591 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 11:58:54,591 reid_baseline.train INFO: Accuracy: 82.4% Mean Entropy: 206.6%
2022-05-03 11:59:44,133 reid_baseline.train INFO: Epoch[20] Iteration[100/152] Loss: 1.042, Acc: 0.940, Base Lr: 1.60e-05
2022-05-03 12:00:05,712 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.468[s] Speed: 34.2[samples/s]
2022-05-03 12:03:33,900 reid_baseline.train INFO: normal accuracy 0.8253385356896947 2.0812222957611084 
2022-05-03 12:03:33,901 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 12:03:33,901 reid_baseline.train INFO: Accuracy: 82.5% Mean Entropy: 208.1%
Loading pretrained model for finetuning from ../logs/pretrain/deit_base/office-home/Art_2_Real_World_shuffled_Cross_Domain_key_layer_12/transformer_best_model.pth
2022-05-03 12:07:12,185 reid_baseline.train INFO: normal accuracy 0.8248795042460408 2.062253713607788 
2022-05-03 12:07:12,186 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 12:07:12,186 reid_baseline.train INFO: Accuracy: 82.5%
2022-05-03 12:10:49,064 reid_baseline.train INFO: normal accuracy 0.8248795042460408 2.062253713607788 
2022-05-03 12:10:49,065 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 12:10:49,065 reid_baseline.train INFO: Shuffled Accuracy: 82.5%
2022-05-03 12:11:49,929 reid_baseline.train INFO: normal accuracy 0.976926246394726 1.3963478803634644 
2022-05-03 12:11:49,929 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 12:11:49,929 reid_baseline.train INFO: Source Clean Accuracy: 97.7%
