2022-05-02 22:00:24,394 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_2
2022-05-02 22:00:24,394 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=2)
2022-05-02 22:00:24,394 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-02 22:00:24,395 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-02 22:00:24,395 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-02 22:00:39,546 reid_baseline.train INFO: start training
2022-05-02 22:02:04,027 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.117, Acc: 0.285, Base Lr: 8.72e-04
2022-05-02 22:03:12,071 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.052, Acc: 0.384, Base Lr: 8.72e-04
2022-05-02 22:04:02,560 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.739[s] Speed: 21.7[samples/s]
2022-05-02 22:05:51,125 reid_baseline.train INFO: normal accuracy 0.507622579316028 4.166822910308838 
2022-05-02 22:05:52,221 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-02 22:05:52,221 reid_baseline.train INFO: Accuracy: 50.8% Mean Entropy: 416.7%
2022-05-02 22:07:09,801 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.647, Acc: 0.553, Base Lr: 1.66e-03
2022-05-02 22:08:23,599 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.484, Acc: 0.562, Base Lr: 1.66e-03
2022-05-02 22:09:14,469 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.741[s] Speed: 21.6[samples/s]
2022-05-02 22:10:59,447 reid_baseline.train INFO: normal accuracy 0.5529460238978162 4.035399913787842 
2022-05-02 22:11:00,742 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-02 22:11:00,743 reid_baseline.train INFO: Accuracy: 55.3% Mean Entropy: 403.5%
2022-05-02 22:12:21,058 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.699, Acc: 0.605, Base Lr: 2.46e-03
2022-05-02 22:13:31,131 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.543, Acc: 0.614, Base Lr: 2.46e-03
2022-05-02 22:14:28,604 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.761[s] Speed: 21.0[samples/s]
2022-05-02 22:16:09,906 reid_baseline.train INFO: normal accuracy 0.6250515039142975 3.43192982673645 
2022-05-02 22:16:11,239 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-02 22:16:11,239 reid_baseline.train INFO: Accuracy: 62.5% Mean Entropy: 343.2%
2022-05-02 22:17:27,461 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 1.991, Acc: 0.702, Base Lr: 3.25e-03
2022-05-02 22:18:44,003 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.929, Acc: 0.705, Base Lr: 3.25e-03
2022-05-02 22:19:39,362 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.762[s] Speed: 21.0[samples/s]
2022-05-02 22:21:21,756 reid_baseline.train INFO: normal accuracy 0.6839719818706221 2.854992389678955 
2022-05-02 22:21:23,677 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-02 22:21:23,678 reid_baseline.train INFO: Accuracy: 68.4% Mean Entropy: 285.5%
2022-05-02 22:22:44,188 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.625, Acc: 0.754, Base Lr: 4.04e-03
2022-05-02 22:23:55,251 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.593, Acc: 0.761, Base Lr: 4.04e-03
2022-05-02 22:24:50,134 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.756[s] Speed: 21.2[samples/s]
2022-05-02 22:26:25,226 reid_baseline.train INFO: normal accuracy 0.7128141738772147 2.481168270111084 
2022-05-02 22:26:26,094 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-02 22:26:26,095 reid_baseline.train INFO: Accuracy: 71.3% Mean Entropy: 248.1%
2022-05-02 22:27:41,995 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.401, Acc: 0.822, Base Lr: 4.83e-03
2022-05-02 22:28:54,522 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.404, Acc: 0.811, Base Lr: 4.83e-03
2022-05-02 22:29:49,357 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.744[s] Speed: 21.5[samples/s]
2022-05-02 22:31:27,545 reid_baseline.train INFO: normal accuracy 0.7210548001648125 2.220104455947876 
2022-05-02 22:31:28,844 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-02 22:31:28,844 reid_baseline.train INFO: Accuracy: 72.1% Mean Entropy: 222.0%
2022-05-02 22:32:43,031 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.340, Acc: 0.826, Base Lr: 5.62e-03
2022-05-02 22:33:57,545 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.326, Acc: 0.833, Base Lr: 5.62e-03
2022-05-02 22:34:49,801 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.736[s] Speed: 21.7[samples/s]
2022-05-02 22:36:30,305 reid_baseline.train INFO: normal accuracy 0.7334157395962093 2.0577449798583984 
2022-05-02 22:36:31,613 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-02 22:36:31,614 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 205.8%
2022-05-02 22:37:48,612 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.244, Acc: 0.857, Base Lr: 6.42e-03
2022-05-02 22:38:59,951 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.244, Acc: 0.855, Base Lr: 6.42e-03
2022-05-02 22:39:51,205 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.731[s] Speed: 21.9[samples/s]
2022-05-02 22:41:36,190 reid_baseline.train INFO: normal accuracy 0.7325916769674495 1.9931893348693848 
2022-05-02 22:41:37,587 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-02 22:41:37,588 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 199.3%
2022-05-02 22:42:53,069 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.196, Acc: 0.871, Base Lr: 7.21e-03
2022-05-02 22:44:08,110 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.187, Acc: 0.869, Base Lr: 7.21e-03
2022-05-02 22:44:48,255 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.698[s] Speed: 22.9[samples/s]
2022-05-02 22:46:26,728 reid_baseline.train INFO: normal accuracy 0.7412443345694273 1.8745523691177368 
2022-05-02 22:46:27,746 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-02 22:46:27,746 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 187.5%
2022-05-02 22:47:40,958 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.111, Acc: 0.897, Base Lr: 4.01e-03
2022-05-02 22:48:48,765 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.115, Acc: 0.898, Base Lr: 4.01e-03
2022-05-02 22:49:41,660 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.710[s] Speed: 22.5[samples/s]
2022-05-02 22:51:27,006 reid_baseline.train INFO: normal accuracy 0.7371240214256284 1.9294602870941162 
2022-05-02 22:51:27,008 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-02 22:51:27,009 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 192.9%
2022-05-02 22:52:40,447 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.088, Acc: 0.903, Base Lr: 3.38e-03
2022-05-02 22:53:52,024 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.084, Acc: 0.905, Base Lr: 3.38e-03
2022-05-02 22:54:40,339 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.708[s] Speed: 22.6[samples/s]
2022-05-02 22:56:26,812 reid_baseline.train INFO: normal accuracy 0.7391841779975278 1.8773808479309082 
2022-05-02 22:56:26,815 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-02 22:56:26,815 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 187.7%
2022-05-02 22:57:38,648 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.050, Acc: 0.915, Base Lr: 2.77e-03
2022-05-02 22:58:54,835 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.063, Acc: 0.909, Base Lr: 2.77e-03
2022-05-02 22:59:46,288 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.730[s] Speed: 21.9[samples/s]
2022-05-02 23:01:26,285 reid_baseline.train INFO: normal accuracy 0.7474248042851257 1.861307144165039 
2022-05-02 23:01:27,502 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-02 23:01:27,502 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 186.1%
2022-05-02 23:02:43,153 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.025, Acc: 0.923, Base Lr: 2.20e-03
2022-05-02 23:03:57,010 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.034, Acc: 0.925, Base Lr: 2.20e-03
2022-05-02 23:04:45,994 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.727[s] Speed: 22.0[samples/s]
2022-05-02 23:06:21,582 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.8482967615127563 
2022-05-02 23:06:22,963 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-02 23:06:22,964 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 184.8%
2022-05-02 23:07:45,484 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.043, Acc: 0.919, Base Lr: 1.66e-03
2022-05-02 23:08:51,743 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.035, Acc: 0.925, Base Lr: 1.66e-03
2022-05-02 23:09:40,995 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.725[s] Speed: 22.1[samples/s]
2022-05-02 23:11:22,710 reid_baseline.train INFO: normal accuracy 0.7408323032550473 1.8372642993927002 
2022-05-02 23:11:24,009 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-02 23:11:24,009 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 183.7%
2022-05-02 23:12:40,356 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.037, Acc: 0.927, Base Lr: 1.19e-03
2022-05-02 23:13:52,625 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.032, Acc: 0.925, Base Lr: 1.19e-03
2022-05-02 23:14:47,456 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.745[s] Speed: 21.5[samples/s]
2022-05-02 23:16:25,374 reid_baseline.train INFO: normal accuracy 0.7457766790276061 1.8205535411834717 
2022-05-02 23:16:26,357 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-02 23:16:26,357 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 182.1%
2022-05-02 23:17:43,687 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.012, Acc: 0.931, Base Lr: 7.78e-04
2022-05-02 23:18:58,837 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.009, Acc: 0.931, Base Lr: 7.78e-04
2022-05-02 23:19:46,806 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.734[s] Speed: 21.8[samples/s]
2022-05-02 23:21:31,050 reid_baseline.train INFO: normal accuracy 0.7449526163988464 1.8558038473129272 
2022-05-02 23:21:31,108 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-02 23:21:31,111 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 185.6%
2022-05-02 23:22:48,749 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.017, Acc: 0.937, Base Lr: 4.51e-04
2022-05-02 23:23:54,938 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.012, Acc: 0.932, Base Lr: 4.51e-04
2022-05-02 23:24:48,667 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.723[s] Speed: 22.1[samples/s]
2022-05-02 23:26:26,309 reid_baseline.train INFO: normal accuracy 0.746188710341986 1.8460972309112549 
2022-05-02 23:26:26,312 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-02 23:26:26,312 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 184.6%
2022-05-02 23:27:44,455 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.010, Acc: 0.934, Base Lr: 2.11e-04
2022-05-02 23:28:57,217 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.019, Acc: 0.929, Base Lr: 2.11e-04
2022-05-02 23:29:43,640 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.722[s] Speed: 22.1[samples/s]
2022-05-02 23:31:32,804 reid_baseline.train INFO: normal accuracy 0.7437165224557066 1.8540970087051392 
2022-05-02 23:31:32,805 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-02 23:31:32,805 reid_baseline.train INFO: Accuracy: 74.4% Mean Entropy: 185.4%
2022-05-02 23:32:49,774 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.004, Acc: 0.941, Base Lr: 6.51e-05
2022-05-02 23:34:01,034 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.006, Acc: 0.933, Base Lr: 6.51e-05
2022-05-02 23:34:52,626 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.732[s] Speed: 21.9[samples/s]
2022-05-02 23:36:40,177 reid_baseline.train INFO: normal accuracy 0.7453646477132262 1.8537932634353638 
2022-05-02 23:36:40,178 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-02 23:36:40,179 reid_baseline.train INFO: Accuracy: 74.5% Mean Entropy: 185.4%
2022-05-02 23:37:53,912 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.009, Acc: 0.924, Base Lr: 1.60e-05
2022-05-02 23:39:08,832 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.011, Acc: 0.928, Base Lr: 1.60e-05
2022-05-02 23:40:00,622 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.734[s] Speed: 21.8[samples/s]
2022-05-02 23:41:39,939 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8183348178863525 
2022-05-02 23:41:41,368 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-02 23:41:41,368 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 181.8%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_2/transformer_best_model.pth
2022-05-02 23:43:42,767 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8183348178863525 
2022-05-02 23:43:42,767 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 23:43:42,768 reid_baseline.train INFO: Accuracy: 74.9%
2022-05-02 23:45:35,180 reid_baseline.train INFO: normal accuracy 0.7490729295426453 1.8183348178863525 
2022-05-02 23:45:35,183 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 23:45:35,183 reid_baseline.train INFO: Shuffled Accuracy: 74.9%
2022-05-02 23:47:40,854 reid_baseline.train INFO: normal accuracy 0.9603665521191295 0.7905059456825256 
2022-05-02 23:47:40,855 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-02 23:47:40,855 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-05-02 23:47:51,164 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_11
2022-05-02 23:47:51,164 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=11)
2022-05-02 23:47:51,164 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-02 23:47:51,164 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-02 23:47:51,165 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-02 23:48:07,238 reid_baseline.train INFO: start training
2022-05-02 23:50:01,632 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.116, Acc: 0.268, Base Lr: 8.72e-04
2022-05-02 23:51:20,024 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.050, Acc: 0.357, Base Lr: 8.72e-04
2022-05-02 23:52:25,731 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.937[s] Speed: 17.1[samples/s]
2022-05-02 23:54:16,683 reid_baseline.train INFO: normal accuracy 0.4713638236505974 4.1670732498168945 
2022-05-02 23:54:17,984 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-02 23:54:17,985 reid_baseline.train INFO: Accuracy: 47.1% Mean Entropy: 416.7%
2022-05-02 23:55:42,771 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.642, Acc: 0.535, Base Lr: 1.66e-03
2022-05-02 23:57:01,758 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.478, Acc: 0.546, Base Lr: 1.66e-03
2022-05-02 23:57:58,334 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.807[s] Speed: 19.8[samples/s]
2022-05-02 23:59:38,643 reid_baseline.train INFO: normal accuracy 0.5348166460651009 4.041789531707764 
2022-05-02 23:59:39,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-02 23:59:39,857 reid_baseline.train INFO: Accuracy: 53.5% Mean Entropy: 404.2%
2022-05-03 00:00:53,587 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.708, Acc: 0.589, Base Lr: 2.46e-03
2022-05-03 00:02:25,944 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.556, Acc: 0.596, Base Lr: 2.46e-03
2022-05-03 00:03:29,532 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.841[s] Speed: 19.0[samples/s]
2022-05-03 00:05:27,454 reid_baseline.train INFO: normal accuracy 0.6102183765966214 3.5024313926696777 
2022-05-03 00:05:31,286 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 00:05:31,286 reid_baseline.train INFO: Accuracy: 61.0% Mean Entropy: 350.2%
2022-05-03 00:06:49,901 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.022, Acc: 0.694, Base Lr: 3.25e-03
2022-05-03 00:08:05,547 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.961, Acc: 0.695, Base Lr: 3.25e-03
2022-05-03 00:09:00,259 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.765[s] Speed: 20.9[samples/s]
2022-05-03 00:10:46,090 reid_baseline.train INFO: normal accuracy 0.6604861969509682 3.0178415775299072 
2022-05-03 00:10:47,279 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 00:10:47,280 reid_baseline.train INFO: Accuracy: 66.0% Mean Entropy: 301.8%
2022-05-03 00:12:18,288 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.661, Acc: 0.743, Base Lr: 4.04e-03
2022-05-03 00:13:39,908 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.627, Acc: 0.752, Base Lr: 4.04e-03
2022-05-03 00:14:37,474 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.843[s] Speed: 19.0[samples/s]
2022-05-03 00:16:21,247 reid_baseline.train INFO: normal accuracy 0.7016893283889576 2.7346014976501465 
2022-05-03 00:16:22,389 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 00:16:22,390 reid_baseline.train INFO: Accuracy: 70.2% Mean Entropy: 273.5%
2022-05-03 00:17:39,844 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.428, Acc: 0.823, Base Lr: 4.83e-03
2022-05-03 00:18:46,311 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.431, Acc: 0.811, Base Lr: 4.83e-03
2022-05-03 00:19:42,394 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.732[s] Speed: 21.8[samples/s]
2022-05-03 00:21:40,875 reid_baseline.train INFO: normal accuracy 0.7148743304491141 2.5962626934051514 
2022-05-03 00:21:42,294 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 00:21:42,294 reid_baseline.train INFO: Accuracy: 71.5% Mean Entropy: 259.6%
2022-05-03 00:23:09,033 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.358, Acc: 0.831, Base Lr: 5.62e-03
2022-05-03 00:24:25,666 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.350, Acc: 0.833, Base Lr: 5.62e-03
2022-05-03 00:25:16,857 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.786[s] Speed: 20.4[samples/s]
2022-05-03 00:27:03,674 reid_baseline.train INFO: normal accuracy 0.7119901112484549 2.41206955909729 
2022-05-03 00:27:04,799 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 00:27:04,799 reid_baseline.train INFO: Accuracy: 71.2% Mean Entropy: 241.2%
2022-05-03 00:28:23,113 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.264, Acc: 0.851, Base Lr: 6.42e-03
2022-05-03 00:29:45,126 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.261, Acc: 0.853, Base Lr: 6.42e-03
2022-05-03 00:30:48,722 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.820[s] Speed: 19.5[samples/s]
2022-05-03 00:32:37,460 reid_baseline.train INFO: normal accuracy 0.722702925422332 2.3703534603118896 
2022-05-03 00:32:38,607 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 00:32:38,607 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 237.0%
2022-05-03 00:33:51,823 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.213, Acc: 0.870, Base Lr: 7.21e-03
2022-05-03 00:35:03,556 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.203, Acc: 0.871, Base Lr: 7.21e-03
2022-05-03 00:35:59,408 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.736[s] Speed: 21.8[samples/s]
2022-05-03 00:37:37,883 reid_baseline.train INFO: normal accuracy 0.73053152039555 2.2599687576293945 
2022-05-03 00:37:39,177 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 00:37:39,177 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 226.0%
2022-05-03 00:39:06,659 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.125, Acc: 0.901, Base Lr: 4.01e-03
2022-05-03 00:40:38,107 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.131, Acc: 0.897, Base Lr: 4.01e-03
2022-05-03 00:41:40,261 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.883[s] Speed: 18.1[samples/s]
2022-05-03 00:43:21,923 reid_baseline.train INFO: normal accuracy 0.7280593325092707 2.271839141845703 
2022-05-03 00:43:21,926 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 00:43:21,926 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 227.2%
2022-05-03 00:44:34,430 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.098, Acc: 0.907, Base Lr: 3.38e-03
2022-05-03 00:45:50,157 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.093, Acc: 0.904, Base Lr: 3.38e-03
2022-05-03 00:46:42,229 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.734[s] Speed: 21.8[samples/s]
2022-05-03 00:48:45,321 reid_baseline.train INFO: normal accuracy 0.7338277709105891 2.255459785461426 
2022-05-03 00:48:46,710 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 00:48:46,711 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 225.5%
2022-05-03 00:50:28,183 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.067, Acc: 0.915, Base Lr: 2.77e-03
2022-05-03 00:51:50,134 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.076, Acc: 0.915, Base Lr: 2.77e-03
2022-05-03 00:52:41,312 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.859[s] Speed: 18.6[samples/s]
2022-05-03 00:54:16,584 reid_baseline.train INFO: normal accuracy 0.7350638648537289 2.2280468940734863 
2022-05-03 00:54:17,881 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 00:54:17,881 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 222.8%
2022-05-03 00:55:31,337 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.044, Acc: 0.917, Base Lr: 2.20e-03
2022-05-03 00:56:57,094 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.049, Acc: 0.920, Base Lr: 2.20e-03
2022-05-03 00:57:50,254 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.778[s] Speed: 20.6[samples/s]
2022-05-03 00:59:53,908 reid_baseline.train INFO: normal accuracy 0.7325916769674495 2.2664973735809326 
2022-05-03 00:59:53,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 00:59:53,910 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 226.6%
2022-05-03 01:01:20,578 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.055, Acc: 0.918, Base Lr: 1.66e-03
2022-05-03 01:02:20,893 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.047, Acc: 0.921, Base Lr: 1.66e-03
2022-05-03 01:03:04,715 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.699[s] Speed: 22.9[samples/s]
2022-05-03 01:04:32,967 reid_baseline.train INFO: normal accuracy 0.7358879274824887 2.2022433280944824 
2022-05-03 01:04:34,274 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 01:04:34,275 reid_baseline.train INFO: Accuracy: 73.6% Mean Entropy: 220.2%
2022-05-03 01:06:00,563 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.050, Acc: 0.922, Base Lr: 1.19e-03
2022-05-03 01:07:19,466 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.045, Acc: 0.922, Base Lr: 1.19e-03
2022-05-03 01:08:12,093 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.798[s] Speed: 20.1[samples/s]
2022-05-03 01:10:04,765 reid_baseline.train INFO: normal accuracy 0.7391841779975278 2.243914842605591 
2022-05-03 01:10:04,766 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 01:10:04,766 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 224.4%
2022-05-03 01:11:30,108 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.023, Acc: 0.928, Base Lr: 7.78e-04
2022-05-03 01:12:36,843 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.019, Acc: 0.930, Base Lr: 7.78e-04
2022-05-03 01:13:16,233 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.701[s] Speed: 22.8[samples/s]
2022-05-03 01:15:00,835 reid_baseline.train INFO: normal accuracy 0.7400082406262876 2.253272533416748 
2022-05-03 01:15:00,837 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 01:15:00,837 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 225.3%
2022-05-03 01:16:28,830 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.032, Acc: 0.934, Base Lr: 4.51e-04
2022-05-03 01:17:50,206 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.026, Acc: 0.930, Base Lr: 4.51e-04
2022-05-03 01:18:36,306 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.789[s] Speed: 20.3[samples/s]
2022-05-03 01:20:32,297 reid_baseline.train INFO: normal accuracy 0.7379480840543882 2.2185347080230713 
2022-05-03 01:20:32,303 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 01:20:32,303 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 221.9%
2022-05-03 01:21:43,591 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.016, Acc: 0.939, Base Lr: 2.11e-04
2022-05-03 01:22:55,271 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.025, Acc: 0.933, Base Lr: 2.11e-04
2022-05-03 01:23:43,359 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.700[s] Speed: 22.9[samples/s]
2022-05-03 01:25:47,587 reid_baseline.train INFO: normal accuracy 0.7412443345694273 2.2588679790496826 
2022-05-03 01:25:47,592 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 01:25:47,592 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 225.9%
2022-05-03 01:27:34,916 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.017, Acc: 0.934, Base Lr: 6.51e-05
2022-05-03 01:29:12,836 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.015, Acc: 0.932, Base Lr: 6.51e-05
2022-05-03 01:30:30,933 reid_baseline.train INFO: Epoch 19 done. Time per batch: 1.038[s] Speed: 15.4[samples/s]
2022-05-03 01:32:39,433 reid_baseline.train INFO: normal accuracy 0.7404202719406675 2.249230146408081 
2022-05-03 01:32:39,434 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 01:32:39,434 reid_baseline.train INFO: Accuracy: 74.0% Mean Entropy: 224.9%
2022-05-03 01:34:09,467 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.024, Acc: 0.923, Base Lr: 1.60e-05
2022-05-03 01:35:27,258 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.022, Acc: 0.929, Base Lr: 1.60e-05
2022-05-03 01:36:23,871 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.822[s] Speed: 19.5[samples/s]
2022-05-03 01:38:12,251 reid_baseline.train INFO: normal accuracy 0.7408323032550473 2.21614408493042 
2022-05-03 01:38:12,253 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 01:38:12,254 reid_baseline.train INFO: Accuracy: 74.1% Mean Entropy: 221.6%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_11/transformer_best_model.pth
2022-05-03 01:40:07,313 reid_baseline.train INFO: normal accuracy 0.7358879274824887 2.2022433280944824 
2022-05-03 01:40:07,313 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 01:40:07,314 reid_baseline.train INFO: Accuracy: 73.6%
2022-05-03 01:42:21,771 reid_baseline.train INFO: normal accuracy 0.7358879274824887 2.2022433280944824 
2022-05-03 01:42:21,772 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 01:42:21,772 reid_baseline.train INFO: Shuffled Accuracy: 73.6%
2022-05-03 01:45:01,103 reid_baseline.train INFO: normal accuracy 0.9512027491408934 1.1131696701049805 
2022-05-03 01:45:01,103 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 01:45:01,104 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
2022-05-03 01:45:10,911 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_12
2022-05-03 01:45:10,911 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Art.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=12)
2022-05-03 01:45:10,911 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 01:45:10,911 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 01:45:10,912 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Art.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Art
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     2427 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 01:45:27,877 reid_baseline.train INFO: start training
2022-05-03 01:46:46,351 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.113, Acc: 0.270, Base Lr: 8.72e-04
2022-05-03 01:47:51,860 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.044, Acc: 0.364, Base Lr: 8.72e-04
2022-05-03 01:48:40,271 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.698[s] Speed: 22.9[samples/s]
2022-05-03 01:50:16,327 reid_baseline.train INFO: normal accuracy 0.4932014833127318 4.1664886474609375 
2022-05-03 01:50:17,593 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 01:50:17,593 reid_baseline.train INFO: Accuracy: 49.3% Mean Entropy: 416.6%
2022-05-03 01:51:49,013 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.621, Acc: 0.531, Base Lr: 1.66e-03
2022-05-03 01:53:22,302 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.447, Acc: 0.543, Base Lr: 1.66e-03
2022-05-03 01:54:36,812 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.949[s] Speed: 16.9[samples/s]
2022-05-03 01:56:45,636 reid_baseline.train INFO: normal accuracy 0.5451174289245982 4.029688358306885 
2022-05-03 01:56:46,824 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 01:56:46,824 reid_baseline.train INFO: Accuracy: 54.5% Mean Entropy: 403.0%
2022-05-03 01:58:34,338 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.673, Acc: 0.591, Base Lr: 2.46e-03
2022-05-03 02:00:10,807 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.522, Acc: 0.600, Base Lr: 2.46e-03
2022-05-03 02:01:28,695 reid_baseline.train INFO: Epoch 3 done. Time per batch: 1.032[s] Speed: 15.5[samples/s]
2022-05-03 02:03:37,731 reid_baseline.train INFO: normal accuracy 0.622991347342398 3.5494637489318848 
2022-05-03 02:03:39,469 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 02:03:39,470 reid_baseline.train INFO: Accuracy: 62.3% Mean Entropy: 354.9%
2022-05-03 02:05:46,684 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.012, Acc: 0.682, Base Lr: 3.25e-03
2022-05-03 02:07:24,525 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.953, Acc: 0.688, Base Lr: 3.25e-03
2022-05-03 02:08:34,146 reid_baseline.train INFO: Epoch 4 done. Time per batch: 1.079[s] Speed: 14.8[samples/s]
2022-05-03 02:10:42,819 reid_baseline.train INFO: normal accuracy 0.673259167696745 3.1373002529144287 
2022-05-03 02:10:44,198 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 02:10:44,199 reid_baseline.train INFO: Accuracy: 67.3% Mean Entropy: 313.7%
2022-05-03 02:12:44,770 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.658, Acc: 0.748, Base Lr: 4.04e-03
2022-05-03 02:14:31,109 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.625, Acc: 0.753, Base Lr: 4.04e-03
2022-05-03 02:15:54,790 reid_baseline.train INFO: Epoch 5 done. Time per batch: 1.137[s] Speed: 14.1[samples/s]
2022-05-03 02:18:04,252 reid_baseline.train INFO: normal accuracy 0.7021013597033374 2.886859178543091 
2022-05-03 02:18:08,406 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 02:18:08,407 reid_baseline.train INFO: Accuracy: 70.2% Mean Entropy: 288.7%
2022-05-03 02:20:04,775 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.427, Acc: 0.815, Base Lr: 4.83e-03
2022-05-03 02:21:51,680 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.435, Acc: 0.809, Base Lr: 4.83e-03
2022-05-03 02:23:15,612 reid_baseline.train INFO: Epoch 6 done. Time per batch: 1.125[s] Speed: 14.2[samples/s]
2022-05-03 02:25:20,715 reid_baseline.train INFO: normal accuracy 0.7202307375360527 2.6906440258026123 
2022-05-03 02:25:23,044 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 02:25:23,045 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 269.1%
2022-05-03 02:27:19,483 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.372, Acc: 0.817, Base Lr: 5.62e-03
2022-05-03 02:28:58,647 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.354, Acc: 0.829, Base Lr: 5.62e-03
2022-05-03 02:30:16,419 reid_baseline.train INFO: Epoch 7 done. Time per batch: 1.075[s] Speed: 14.9[samples/s]
2022-05-03 02:32:36,848 reid_baseline.train INFO: normal accuracy 0.7189946435929131 2.5787606239318848 
2022-05-03 02:32:38,437 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 02:32:38,440 reid_baseline.train INFO: Accuracy: 71.9% Mean Entropy: 257.9%
2022-05-03 02:34:44,396 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.263, Acc: 0.849, Base Lr: 6.42e-03
2022-05-03 02:36:45,327 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.262, Acc: 0.851, Base Lr: 6.42e-03
2022-05-03 02:38:14,663 reid_baseline.train INFO: Epoch 8 done. Time per batch: 1.232[s] Speed: 13.0[samples/s]
2022-05-03 02:40:28,074 reid_baseline.train INFO: normal accuracy 0.7272352698805109 2.5225727558135986 
2022-05-03 02:40:31,610 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 02:40:31,610 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 252.3%
2022-05-03 02:42:31,908 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.206, Acc: 0.869, Base Lr: 7.21e-03
2022-05-03 02:44:38,860 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.200, Acc: 0.868, Base Lr: 7.21e-03
2022-05-03 02:46:19,378 reid_baseline.train INFO: Epoch 9 done. Time per batch: 1.273[s] Speed: 12.6[samples/s]
2022-05-03 02:49:05,495 reid_baseline.train INFO: normal accuracy 0.7321796456530696 2.4193789958953857 
2022-05-03 02:49:06,831 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 02:49:06,832 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 241.9%
2022-05-03 02:51:00,772 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.135, Acc: 0.893, Base Lr: 4.01e-03
2022-05-03 02:52:50,673 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.134, Acc: 0.890, Base Lr: 4.01e-03
2022-05-03 02:54:16,889 reid_baseline.train INFO: Epoch 10 done. Time per batch: 1.136[s] Speed: 14.1[samples/s]
2022-05-03 02:56:49,540 reid_baseline.train INFO: normal accuracy 0.7288833951380305 2.4311139583587646 
2022-05-03 02:56:49,541 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 02:56:49,542 reid_baseline.train INFO: Accuracy: 72.9% Mean Entropy: 243.1%
2022-05-03 02:58:55,032 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.098, Acc: 0.905, Base Lr: 3.38e-03
2022-05-03 03:00:33,935 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.094, Acc: 0.904, Base Lr: 3.38e-03
2022-05-03 03:01:44,076 reid_baseline.train INFO: Epoch 11 done. Time per batch: 1.079[s] Speed: 14.8[samples/s]
2022-05-03 03:03:32,142 reid_baseline.train INFO: normal accuracy 0.7317676143386898 2.35707950592041 
2022-05-03 03:03:33,197 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 03:03:33,198 reid_baseline.train INFO: Accuracy: 73.2% Mean Entropy: 235.7%
2022-05-03 03:05:25,162 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.066, Acc: 0.915, Base Lr: 2.77e-03
2022-05-03 03:07:18,129 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.075, Acc: 0.913, Base Lr: 2.77e-03
2022-05-03 03:08:30,417 reid_baseline.train INFO: Epoch 12 done. Time per batch: 1.089[s] Speed: 14.7[samples/s]
2022-05-03 03:10:50,666 reid_baseline.train INFO: normal accuracy 0.7367119901112484 2.3999078273773193 
2022-05-03 03:10:50,667 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 03:10:50,667 reid_baseline.train INFO: Accuracy: 73.7% Mean Entropy: 240.0%
2022-05-03 03:12:49,173 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.042, Acc: 0.922, Base Lr: 2.20e-03
2022-05-03 03:14:40,575 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.050, Acc: 0.921, Base Lr: 2.20e-03
2022-05-03 03:16:02,144 reid_baseline.train INFO: Epoch 13 done. Time per batch: 1.141[s] Speed: 14.0[samples/s]
2022-05-03 03:18:05,278 reid_baseline.train INFO: normal accuracy 0.7354758961681088 2.3658766746520996 
2022-05-03 03:18:05,283 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 03:18:05,283 reid_baseline.train INFO: Accuracy: 73.5% Mean Entropy: 236.6%
2022-05-03 03:20:02,163 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.050, Acc: 0.917, Base Lr: 1.66e-03
2022-05-03 03:22:07,228 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.044, Acc: 0.924, Base Lr: 1.66e-03
2022-05-03 03:23:20,889 reid_baseline.train INFO: Epoch 14 done. Time per batch: 1.156[s] Speed: 13.8[samples/s]
2022-05-03 03:25:48,653 reid_baseline.train INFO: normal accuracy 0.7334157395962093 2.3414061069488525 
2022-05-03 03:25:49,907 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 03:25:49,907 reid_baseline.train INFO: Accuracy: 73.3% Mean Entropy: 234.1%
2022-05-03 03:27:25,767 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.045, Acc: 0.926, Base Lr: 1.19e-03
2022-05-03 03:28:47,100 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.043, Acc: 0.923, Base Lr: 1.19e-03
2022-05-03 03:29:49,318 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.877[s] Speed: 18.2[samples/s]
2022-05-03 03:31:31,070 reid_baseline.train INFO: normal accuracy 0.746188710341986 2.3207056522369385 
2022-05-03 03:31:32,909 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 03:31:32,910 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 232.1%
2022-05-03 03:33:09,924 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.021, Acc: 0.933, Base Lr: 7.78e-04
2022-05-03 03:34:50,443 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.018, Acc: 0.934, Base Lr: 7.78e-04
2022-05-03 03:36:08,161 reid_baseline.train INFO: Epoch 16 done. Time per batch: 1.008[s] Speed: 15.9[samples/s]
2022-05-03 03:38:05,309 reid_baseline.train INFO: normal accuracy 0.7420683971981871 2.347731113433838 
2022-05-03 03:38:05,309 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 03:38:05,309 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 234.8%
2022-05-03 03:39:46,919 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.030, Acc: 0.934, Base Lr: 4.51e-04
2022-05-03 03:41:23,921 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.029, Acc: 0.925, Base Lr: 4.51e-04
2022-05-03 03:42:24,930 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.951[s] Speed: 16.8[samples/s]
2022-05-03 03:44:06,715 reid_baseline.train INFO: normal accuracy 0.7424804285125669 2.322512149810791 
2022-05-03 03:44:06,715 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 03:44:06,716 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 232.3%
2022-05-03 03:45:40,742 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.019, Acc: 0.939, Base Lr: 2.11e-04
2022-05-03 03:47:23,863 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.028, Acc: 0.932, Base Lr: 2.11e-04
2022-05-03 03:48:41,556 reid_baseline.train INFO: Epoch 18 done. Time per batch: 1.007[s] Speed: 15.9[samples/s]
2022-05-03 03:50:23,380 reid_baseline.train INFO: normal accuracy 0.7424804285125669 2.360656976699829 
2022-05-03 03:50:23,384 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 03:50:23,385 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 236.1%
2022-05-03 03:51:53,758 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.020, Acc: 0.940, Base Lr: 6.51e-05
2022-05-03 03:53:25,207 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.015, Acc: 0.935, Base Lr: 6.51e-05
2022-05-03 03:54:36,060 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.926[s] Speed: 17.3[samples/s]
2022-05-03 03:56:27,041 reid_baseline.train INFO: normal accuracy 0.7416563658838071 2.3463215827941895 
2022-05-03 03:56:27,043 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 03:56:27,044 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 234.6%
2022-05-03 03:58:11,956 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.026, Acc: 0.928, Base Lr: 1.60e-05
2022-05-03 03:59:41,918 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.025, Acc: 0.930, Base Lr: 1.60e-05
2022-05-03 04:00:53,373 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.975[s] Speed: 16.4[samples/s]
2022-05-03 04:02:31,720 reid_baseline.train INFO: normal accuracy 0.746188710341986 2.313774585723877 
2022-05-03 04:02:32,720 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 04:02:32,720 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 231.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Art_shuffled_Cross_Domain_key_layer_12/transformer_best_model.pth
2022-05-03 04:04:10,587 reid_baseline.train INFO: normal accuracy 0.746188710341986 2.313774585723877 
2022-05-03 04:04:10,587 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 04:04:10,588 reid_baseline.train INFO: Accuracy: 74.6%
2022-05-03 04:05:53,620 reid_baseline.train INFO: normal accuracy 0.746188710341986 2.313774585723877 
2022-05-03 04:05:53,620 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 04:05:53,621 reid_baseline.train INFO: Shuffled Accuracy: 74.6%
2022-05-03 04:08:23,648 reid_baseline.train INFO: normal accuracy 0.9573883161512028 1.2046481370925903 
2022-05-03 04:08:23,649 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 04:08:23,649 reid_baseline.train INFO: Source Clean Accuracy: 95.7%
2022-05-03 04:08:31,391 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_2
2022-05-03 04:08:31,391 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=2)
2022-05-03 04:08:31,391 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 04:08:31,392 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 04:08:31,392 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 04:08:45,100 reid_baseline.train INFO: start training
2022-05-03 04:10:46,354 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.117, Acc: 0.285, Base Lr: 8.72e-04
2022-05-03 04:12:07,808 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.052, Acc: 0.384, Base Lr: 8.72e-04
2022-05-03 04:13:13,916 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.982[s] Speed: 16.3[samples/s]
2022-05-03 04:15:26,031 reid_baseline.train INFO: normal accuracy 0.5589096643388151 4.165070056915283 
2022-05-03 04:15:26,984 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 04:15:26,984 reid_baseline.train INFO: Accuracy: 55.9% Mean Entropy: 416.5%
2022-05-03 04:17:04,265 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.647, Acc: 0.553, Base Lr: 1.66e-03
2022-05-03 04:18:43,630 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.484, Acc: 0.562, Base Lr: 1.66e-03
2022-05-03 04:19:48,688 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.959[s] Speed: 16.7[samples/s]
2022-05-03 04:22:12,890 reid_baseline.train INFO: normal accuracy 0.5789592250506871 3.980534315109253 
2022-05-03 04:22:13,864 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 04:22:13,864 reid_baseline.train INFO: Accuracy: 57.9% Mean Entropy: 398.1%
2022-05-03 04:23:48,595 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.699, Acc: 0.605, Base Lr: 2.46e-03
2022-05-03 04:25:21,877 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.543, Acc: 0.614, Base Lr: 2.46e-03
2022-05-03 04:26:28,815 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.934[s] Speed: 17.1[samples/s]
2022-05-03 04:28:27,329 reid_baseline.train INFO: normal accuracy 0.6528497409326425 3.220766544342041 
2022-05-03 04:28:28,643 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 04:28:28,644 reid_baseline.train INFO: Accuracy: 65.3% Mean Entropy: 322.1%
2022-05-03 04:30:17,493 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 1.991, Acc: 0.701, Base Lr: 3.25e-03
2022-05-03 04:31:57,262 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.929, Acc: 0.705, Base Lr: 3.25e-03
2022-05-03 04:33:06,665 reid_baseline.train INFO: Epoch 4 done. Time per batch: 1.018[s] Speed: 15.7[samples/s]
2022-05-03 04:35:02,360 reid_baseline.train INFO: normal accuracy 0.7096192836224375 2.571270227432251 
2022-05-03 04:35:03,509 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 04:35:03,509 reid_baseline.train INFO: Accuracy: 71.0% Mean Entropy: 257.1%
2022-05-03 04:36:40,642 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.625, Acc: 0.754, Base Lr: 4.04e-03
2022-05-03 04:38:11,926 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.593, Acc: 0.761, Base Lr: 4.04e-03
2022-05-03 04:39:00,190 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.866[s] Speed: 18.5[samples/s]
2022-05-03 04:41:01,099 reid_baseline.train INFO: normal accuracy 0.731020500112638 2.2115838527679443 
2022-05-03 04:41:02,427 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 04:41:02,428 reid_baseline.train INFO: Accuracy: 73.1% Mean Entropy: 221.2%
2022-05-03 04:42:38,314 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.401, Acc: 0.822, Base Lr: 4.83e-03
2022-05-03 04:43:56,529 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.404, Acc: 0.811, Base Lr: 4.83e-03
2022-05-03 04:45:00,886 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.873[s] Speed: 18.3[samples/s]
2022-05-03 04:47:16,430 reid_baseline.train INFO: normal accuracy 0.7465645415634152 1.9837273359298706 
2022-05-03 04:47:17,621 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 04:47:17,622 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 198.4%
2022-05-03 04:48:49,367 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.340, Acc: 0.827, Base Lr: 5.62e-03
2022-05-03 04:50:10,067 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.326, Acc: 0.834, Base Lr: 5.62e-03
2022-05-03 04:51:12,746 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.861[s] Speed: 18.6[samples/s]
2022-05-03 04:53:39,362 reid_baseline.train INFO: normal accuracy 0.7474656454156342 1.8150347471237183 
2022-05-03 04:53:40,674 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 04:53:40,675 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 181.5%
2022-05-03 04:55:16,546 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.244, Acc: 0.857, Base Lr: 6.42e-03
2022-05-03 04:56:45,922 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.244, Acc: 0.855, Base Lr: 6.42e-03
2022-05-03 04:57:50,148 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.914[s] Speed: 17.5[samples/s]
2022-05-03 04:59:31,403 reid_baseline.train INFO: normal accuracy 0.752872268528948 1.777961015701294 
2022-05-03 04:59:32,238 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 04:59:32,238 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 177.8%
2022-05-03 05:00:38,715 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.196, Acc: 0.870, Base Lr: 7.21e-03
2022-05-03 05:01:41,287 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.187, Acc: 0.869, Base Lr: 7.21e-03
2022-05-03 05:02:25,529 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.634[s] Speed: 25.2[samples/s]
2022-05-03 05:04:04,507 reid_baseline.train INFO: normal accuracy 0.7600810993466998 1.700302004814148 
2022-05-03 05:04:05,435 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 05:04:05,435 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 170.0%
2022-05-03 05:05:11,656 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.111, Acc: 0.896, Base Lr: 4.01e-03
2022-05-03 05:06:13,692 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.114, Acc: 0.897, Base Lr: 4.01e-03
2022-05-03 05:06:59,386 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.637[s] Speed: 25.1[samples/s]
2022-05-03 05:08:46,147 reid_baseline.train INFO: normal accuracy 0.7632349628294661 1.7428284883499146 
2022-05-03 05:08:46,149 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 05:08:46,150 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 174.3%
2022-05-03 05:09:51,849 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.088, Acc: 0.905, Base Lr: 3.38e-03
2022-05-03 05:10:55,595 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.084, Acc: 0.906, Base Lr: 3.38e-03
2022-05-03 05:11:37,412 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.627[s] Speed: 25.5[samples/s]
2022-05-03 05:13:19,567 reid_baseline.train INFO: normal accuracy 0.7645866186077945 1.7347767353057861 
2022-05-03 05:13:19,569 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 05:13:19,569 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 173.5%
2022-05-03 05:14:26,453 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.049, Acc: 0.914, Base Lr: 2.77e-03
2022-05-03 05:15:29,070 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.063, Acc: 0.909, Base Lr: 2.77e-03
2022-05-03 05:16:13,241 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.636[s] Speed: 25.2[samples/s]
2022-05-03 05:17:52,771 reid_baseline.train INFO: normal accuracy 0.7623338589772471 1.7356442213058472 
2022-05-03 05:17:52,773 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 05:17:52,774 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 173.6%
2022-05-03 05:18:57,432 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.025, Acc: 0.923, Base Lr: 2.20e-03
2022-05-03 05:20:01,614 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.034, Acc: 0.925, Base Lr: 2.20e-03
2022-05-03 05:20:42,316 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.621[s] Speed: 25.8[samples/s]
2022-05-03 05:22:21,508 reid_baseline.train INFO: normal accuracy 0.7641360666816851 1.7075473070144653 
2022-05-03 05:22:21,511 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 05:22:21,511 reid_baseline.train INFO: Accuracy: 76.4% Mean Entropy: 170.8%
2022-05-03 05:23:28,345 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.043, Acc: 0.919, Base Lr: 1.66e-03
2022-05-03 05:24:26,982 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.034, Acc: 0.925, Base Lr: 1.66e-03
2022-05-03 05:25:11,344 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.622[s] Speed: 25.7[samples/s]
2022-05-03 05:26:51,061 reid_baseline.train INFO: normal accuracy 0.7675152061275062 1.6845110654830933 
2022-05-03 05:26:52,126 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 05:26:52,127 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 168.5%
2022-05-03 05:27:59,221 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.037, Acc: 0.925, Base Lr: 1.19e-03
2022-05-03 05:29:01,371 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.032, Acc: 0.925, Base Lr: 1.19e-03
2022-05-03 05:29:47,118 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.641[s] Speed: 25.0[samples/s]
2022-05-03 05:31:25,430 reid_baseline.train INFO: normal accuracy 0.77292182924082 1.696635127067566 
2022-05-03 05:31:25,431 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 05:31:25,431 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 169.7%
2022-05-03 05:32:32,199 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.012, Acc: 0.933, Base Lr: 7.78e-04
2022-05-03 05:33:34,634 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.009, Acc: 0.932, Base Lr: 7.78e-04
2022-05-03 05:34:18,579 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.634[s] Speed: 25.2[samples/s]
2022-05-03 05:35:58,367 reid_baseline.train INFO: normal accuracy 0.7695426897949988 1.7219964265823364 
2022-05-03 05:35:58,368 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 05:35:58,368 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 172.2%
2022-05-03 05:37:09,004 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.018, Acc: 0.936, Base Lr: 4.51e-04
2022-05-03 05:38:11,338 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.012, Acc: 0.931, Base Lr: 4.51e-04
2022-05-03 05:38:55,476 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.648[s] Speed: 24.7[samples/s]
2022-05-03 05:40:38,793 reid_baseline.train INFO: normal accuracy 0.7715701734624916 1.7147624492645264 
2022-05-03 05:40:38,795 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 05:40:38,796 reid_baseline.train INFO: Accuracy: 77.2% Mean Entropy: 171.5%
2022-05-03 05:41:44,535 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.010, Acc: 0.935, Base Lr: 2.11e-04
2022-05-03 05:42:43,475 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.018, Acc: 0.929, Base Lr: 2.11e-04
2022-05-03 05:43:30,529 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.629[s] Speed: 25.4[samples/s]
2022-05-03 05:45:08,645 reid_baseline.train INFO: normal accuracy 0.7708943455733274 1.730049729347229 
2022-05-03 05:45:08,645 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 05:45:08,645 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 173.0%
2022-05-03 05:46:13,301 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.004, Acc: 0.942, Base Lr: 6.51e-05
2022-05-03 05:47:17,260 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.005, Acc: 0.934, Base Lr: 6.51e-05
2022-05-03 05:48:01,599 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.634[s] Speed: 25.3[samples/s]
2022-05-03 05:49:43,293 reid_baseline.train INFO: normal accuracy 0.7713448974994368 1.7230315208435059 
2022-05-03 05:49:43,295 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 05:49:43,295 reid_baseline.train INFO: Accuracy: 77.1% Mean Entropy: 172.3%
2022-05-03 05:50:50,150 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.009, Acc: 0.924, Base Lr: 1.60e-05
2022-05-03 05:51:52,890 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.011, Acc: 0.928, Base Lr: 1.60e-05
2022-05-03 05:52:37,598 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.638[s] Speed: 25.1[samples/s]
2022-05-03 05:54:15,597 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.6818459033966064 
2022-05-03 05:54:16,551 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 05:54:16,551 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 168.2%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_2/transformer_best_model.pth
2022-05-03 05:56:01,390 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.6818459033966064 
2022-05-03 05:56:01,390 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 05:56:01,390 reid_baseline.train INFO: Accuracy: 77.0%
2022-05-03 05:57:43,110 reid_baseline.train INFO: normal accuracy 0.770218517684163 1.6818459033966064 
2022-05-03 05:57:43,110 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 05:57:43,110 reid_baseline.train INFO: Shuffled Accuracy: 77.0%
2022-05-03 05:59:21,513 reid_baseline.train INFO: normal accuracy 0.9601374570446736 0.7897651195526123 
2022-05-03 05:59:21,513 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 05:59:21,513 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-05-03 05:59:29,035 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_11
2022-05-03 05:59:29,035 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=11)
2022-05-03 05:59:29,035 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 05:59:29,035 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 05:59:29,036 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 05:59:38,784 reid_baseline.train INFO: start training
2022-05-03 06:00:51,487 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.116, Acc: 0.268, Base Lr: 8.72e-04
2022-05-03 06:01:51,245 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.050, Acc: 0.357, Base Lr: 8.72e-04
2022-05-03 06:02:34,302 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.641[s] Speed: 25.0[samples/s]
2022-05-03 06:04:12,500 reid_baseline.train INFO: normal accuracy 0.5266952016219869 4.16538143157959 
2022-05-03 06:04:13,258 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 06:04:13,258 reid_baseline.train INFO: Accuracy: 52.7% Mean Entropy: 416.5%
2022-05-03 06:05:15,599 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.642, Acc: 0.535, Base Lr: 1.66e-03
2022-05-03 06:06:14,312 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.478, Acc: 0.546, Base Lr: 1.66e-03
2022-05-03 06:06:59,267 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.608[s] Speed: 26.3[samples/s]
2022-05-03 06:08:33,968 reid_baseline.train INFO: normal accuracy 0.551926109484118 3.987741708755493 
2022-05-03 06:08:35,050 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 06:08:35,051 reid_baseline.train INFO: Accuracy: 55.2% Mean Entropy: 398.8%
2022-05-03 06:09:37,862 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.708, Acc: 0.589, Base Lr: 2.46e-03
2022-05-03 06:10:36,973 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.556, Acc: 0.596, Base Lr: 2.46e-03
2022-05-03 06:11:20,015 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.604[s] Speed: 26.5[samples/s]
2022-05-03 06:12:53,886 reid_baseline.train INFO: normal accuracy 0.6328001802207704 3.3108108043670654 
2022-05-03 06:12:54,841 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 06:12:54,841 reid_baseline.train INFO: Accuracy: 63.3% Mean Entropy: 331.1%
2022-05-03 06:13:55,624 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.022, Acc: 0.694, Base Lr: 3.25e-03
2022-05-03 06:14:54,628 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.961, Acc: 0.695, Base Lr: 3.25e-03
2022-05-03 06:15:35,833 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.589[s] Speed: 27.2[samples/s]
2022-05-03 06:17:11,533 reid_baseline.train INFO: normal accuracy 0.6915972065780581 2.7744534015655518 
2022-05-03 06:17:12,547 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 06:17:12,547 reid_baseline.train INFO: Accuracy: 69.2% Mean Entropy: 277.4%
2022-05-03 06:18:14,673 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.661, Acc: 0.744, Base Lr: 4.04e-03
2022-05-03 06:19:12,441 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.627, Acc: 0.752, Base Lr: 4.04e-03
2022-05-03 06:19:55,841 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.598[s] Speed: 26.8[samples/s]
2022-05-03 06:21:34,603 reid_baseline.train INFO: normal accuracy 0.7226852894796125 2.4941303730010986 
2022-05-03 06:21:35,436 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 06:21:35,436 reid_baseline.train INFO: Accuracy: 72.3% Mean Entropy: 249.4%
2022-05-03 06:22:40,236 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.428, Acc: 0.822, Base Lr: 4.83e-03
2022-05-03 06:23:40,056 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.431, Acc: 0.812, Base Lr: 4.83e-03
2022-05-03 06:24:25,649 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.623[s] Speed: 25.7[samples/s]
2022-05-03 06:26:00,679 reid_baseline.train INFO: normal accuracy 0.7339490876323497 2.3843765258789062 
2022-05-03 06:26:01,854 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 06:26:01,854 reid_baseline.train INFO: Accuracy: 73.4% Mean Entropy: 238.4%
2022-05-03 06:27:04,181 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.358, Acc: 0.831, Base Lr: 5.62e-03
2022-05-03 06:28:03,043 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.350, Acc: 0.833, Base Lr: 5.62e-03
2022-05-03 06:28:45,991 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.601[s] Speed: 26.6[samples/s]
2022-05-03 06:30:24,404 reid_baseline.train INFO: normal accuracy 0.7377787790042802 2.1881773471832275 
2022-05-03 06:30:25,482 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 06:30:25,483 reid_baseline.train INFO: Accuracy: 73.8% Mean Entropy: 218.8%
2022-05-03 06:31:25,605 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.264, Acc: 0.851, Base Lr: 6.42e-03
2022-05-03 06:32:24,325 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.261, Acc: 0.854, Base Lr: 6.42e-03
2022-05-03 06:33:06,226 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.589[s] Speed: 27.2[samples/s]
2022-05-03 06:34:44,919 reid_baseline.train INFO: normal accuracy 0.7418337463392656 2.157839298248291 
2022-05-03 06:34:45,751 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 06:34:45,751 reid_baseline.train INFO: Accuracy: 74.2% Mean Entropy: 215.8%
2022-05-03 06:35:49,093 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.213, Acc: 0.871, Base Lr: 7.21e-03
2022-05-03 06:36:50,160 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.202, Acc: 0.870, Base Lr: 7.21e-03
2022-05-03 06:37:34,793 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.619[s] Speed: 25.8[samples/s]
2022-05-03 06:39:11,524 reid_baseline.train INFO: normal accuracy 0.749267853120072 2.0597667694091797 
2022-05-03 06:39:12,442 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 06:39:12,443 reid_baseline.train INFO: Accuracy: 74.9% Mean Entropy: 206.0%
2022-05-03 06:40:15,619 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.125, Acc: 0.904, Base Lr: 4.01e-03
2022-05-03 06:41:15,516 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.131, Acc: 0.897, Base Lr: 4.01e-03
2022-05-03 06:41:59,822 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.613[s] Speed: 26.1[samples/s]
2022-05-03 06:43:44,194 reid_baseline.train INFO: normal accuracy 0.7530975444920027 2.060331344604492 
2022-05-03 06:43:44,195 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 06:43:44,195 reid_baseline.train INFO: Accuracy: 75.3% Mean Entropy: 206.0%
2022-05-03 06:44:46,619 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.099, Acc: 0.905, Base Lr: 3.38e-03
2022-05-03 06:45:47,898 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.094, Acc: 0.904, Base Lr: 3.38e-03
2022-05-03 06:46:29,061 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.604[s] Speed: 26.5[samples/s]
2022-05-03 06:48:02,263 reid_baseline.train INFO: normal accuracy 0.7553503041225501 2.075016736984253 
2022-05-03 06:48:02,265 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 06:48:02,265 reid_baseline.train INFO: Accuracy: 75.5% Mean Entropy: 207.5%
2022-05-03 06:49:04,790 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.067, Acc: 0.916, Base Lr: 2.77e-03
2022-05-03 06:50:05,951 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.076, Acc: 0.915, Base Lr: 2.77e-03
2022-05-03 06:50:49,440 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.612[s] Speed: 26.1[samples/s]
2022-05-03 06:52:21,877 reid_baseline.train INFO: normal accuracy 0.7571525118269881 2.065551280975342 
2022-05-03 06:52:21,878 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 06:52:21,878 reid_baseline.train INFO: Accuracy: 75.7% Mean Entropy: 206.6%
2022-05-03 06:53:23,765 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.044, Acc: 0.918, Base Lr: 2.20e-03
2022-05-03 06:54:26,140 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.049, Acc: 0.920, Base Lr: 2.20e-03
2022-05-03 06:55:06,631 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.603[s] Speed: 26.5[samples/s]
2022-05-03 06:56:38,900 reid_baseline.train INFO: normal accuracy 0.7616580310880829 2.094714403152466 
2022-05-03 06:56:38,903 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 06:56:38,903 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 209.5%
2022-05-03 06:57:42,987 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.055, Acc: 0.917, Base Lr: 1.66e-03
2022-05-03 06:58:41,278 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.047, Acc: 0.921, Base Lr: 1.66e-03
2022-05-03 06:59:25,937 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.612[s] Speed: 26.2[samples/s]
2022-05-03 07:00:59,988 reid_baseline.train INFO: normal accuracy 0.7634602387925208 2.018371343612671 
2022-05-03 07:01:00,869 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 07:01:00,869 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 201.8%
2022-05-03 07:02:05,442 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.050, Acc: 0.922, Base Lr: 1.19e-03
2022-05-03 07:03:03,606 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.045, Acc: 0.922, Base Lr: 1.19e-03
2022-05-03 07:03:46,609 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.607[s] Speed: 26.4[samples/s]
2022-05-03 07:05:15,881 reid_baseline.train INFO: normal accuracy 0.7681910340166704 2.0898802280426025 
2022-05-03 07:05:15,883 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 07:05:15,884 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 209.0%
2022-05-03 07:06:19,274 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.024, Acc: 0.929, Base Lr: 7.78e-04
2022-05-03 07:07:18,221 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.020, Acc: 0.930, Base Lr: 7.78e-04
2022-05-03 07:08:02,782 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.611[s] Speed: 26.2[samples/s]
2022-05-03 07:09:52,917 reid_baseline.train INFO: normal accuracy 0.7668393782383419 2.0947017669677734 
2022-05-03 07:09:52,919 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 07:09:52,920 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 209.5%
2022-05-03 07:10:54,219 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.032, Acc: 0.934, Base Lr: 4.51e-04
2022-05-03 07:11:55,327 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.026, Acc: 0.930, Base Lr: 4.51e-04
2022-05-03 07:12:35,033 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.594[s] Speed: 26.9[samples/s]
2022-05-03 07:14:05,673 reid_baseline.train INFO: normal accuracy 0.7634602387925208 2.0535969734191895 
2022-05-03 07:14:05,675 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 07:14:05,676 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 205.4%
2022-05-03 07:15:07,912 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.016, Acc: 0.936, Base Lr: 2.11e-04
2022-05-03 07:16:02,512 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.025, Acc: 0.932, Base Lr: 2.11e-04
2022-05-03 07:16:45,947 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.587[s] Speed: 27.3[samples/s]
2022-05-03 07:18:15,730 reid_baseline.train INFO: normal accuracy 0.7677404820905609 2.1047089099884033 
2022-05-03 07:18:15,732 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 07:18:15,732 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 210.5%
2022-05-03 07:19:17,079 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.017, Acc: 0.933, Base Lr: 6.51e-05
2022-05-03 07:20:16,407 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.015, Acc: 0.932, Base Lr: 6.51e-05
2022-05-03 07:20:57,112 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.591[s] Speed: 27.1[samples/s]
2022-05-03 07:22:25,169 reid_baseline.train INFO: normal accuracy 0.7661635503491777 2.0869240760803223 
2022-05-03 07:22:25,169 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 07:22:25,169 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 208.7%
2022-05-03 07:23:26,532 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.023, Acc: 0.923, Base Lr: 1.60e-05
2022-05-03 07:24:23,630 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.022, Acc: 0.929, Base Lr: 1.60e-05
2022-05-03 07:25:02,108 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.575[s] Speed: 27.8[samples/s]
2022-05-03 07:26:24,100 reid_baseline.train INFO: normal accuracy 0.7654877224600135 2.0456931591033936 
2022-05-03 07:26:24,100 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 07:26:24,100 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 204.6%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_11/transformer_best_model.pth
2022-05-03 07:27:54,294 reid_baseline.train INFO: normal accuracy 0.7634602387925208 2.018371343612671 
2022-05-03 07:27:54,294 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 07:27:54,294 reid_baseline.train INFO: Accuracy: 76.3%
2022-05-03 07:29:20,719 reid_baseline.train INFO: normal accuracy 0.7634602387925208 2.018371343612671 
2022-05-03 07:29:20,719 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 07:29:20,719 reid_baseline.train INFO: Shuffled Accuracy: 76.3%
2022-05-03 07:30:43,847 reid_baseline.train INFO: normal accuracy 0.9512027491408934 1.1121608018875122 
2022-05-03 07:30:43,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 07:30:43,848 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
2022-05-03 07:30:48,959 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_12
2022-05-03 07:30:48,959 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Product.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=12)
2022-05-03 07:30:48,959 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 07:30:48,959 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 07:30:48,960 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Product.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Product
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4439 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 07:30:59,558 reid_baseline.train INFO: start training
2022-05-03 07:32:12,538 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.113, Acc: 0.270, Base Lr: 8.72e-04
2022-05-03 07:33:10,801 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.044, Acc: 0.364, Base Lr: 8.72e-04
2022-05-03 07:33:50,910 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.621[s] Speed: 25.8[samples/s]
2022-05-03 07:35:20,717 reid_baseline.train INFO: normal accuracy 0.5411128632574904 4.164656162261963 
2022-05-03 07:35:21,611 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 07:35:21,611 reid_baseline.train INFO: Accuracy: 54.1% Mean Entropy: 416.5%
2022-05-03 07:36:18,342 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.621, Acc: 0.531, Base Lr: 1.66e-03
2022-05-03 07:37:15,798 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.447, Acc: 0.543, Base Lr: 1.66e-03
2022-05-03 07:37:56,824 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.569[s] Speed: 28.1[samples/s]
2022-05-03 07:39:24,023 reid_baseline.train INFO: normal accuracy 0.5645415634151836 3.9759931564331055 
2022-05-03 07:39:24,908 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 07:39:24,908 reid_baseline.train INFO: Accuracy: 56.5% Mean Entropy: 397.6%
2022-05-03 07:40:23,802 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.673, Acc: 0.592, Base Lr: 2.46e-03
2022-05-03 07:41:20,304 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.522, Acc: 0.600, Base Lr: 2.46e-03
2022-05-03 07:42:00,373 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.569[s] Speed: 28.1[samples/s]
2022-05-03 07:43:24,199 reid_baseline.train INFO: normal accuracy 0.6548772246001352 3.385261297225952 
2022-05-03 07:43:25,320 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 07:43:25,320 reid_baseline.train INFO: Accuracy: 65.5% Mean Entropy: 338.5%
2022-05-03 07:44:24,919 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.012, Acc: 0.682, Base Lr: 3.25e-03
2022-05-03 07:45:22,637 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.953, Acc: 0.688, Base Lr: 3.25e-03
2022-05-03 07:46:01,251 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.571[s] Speed: 28.0[samples/s]
2022-05-03 07:47:31,702 reid_baseline.train INFO: normal accuracy 0.7042126605091237 2.910674571990967 
2022-05-03 07:47:32,698 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 07:47:32,699 reid_baseline.train INFO: Accuracy: 70.4% Mean Entropy: 291.1%
2022-05-03 07:48:31,586 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.658, Acc: 0.748, Base Lr: 4.04e-03
2022-05-03 07:49:28,448 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.625, Acc: 0.754, Base Lr: 4.04e-03
2022-05-03 07:50:10,460 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.578[s] Speed: 27.7[samples/s]
2022-05-03 07:51:36,888 reid_baseline.train INFO: normal accuracy 0.7274160847037621 2.655691623687744 
2022-05-03 07:51:37,736 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 07:51:37,736 reid_baseline.train INFO: Accuracy: 72.7% Mean Entropy: 265.6%
2022-05-03 07:52:40,418 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.427, Acc: 0.816, Base Lr: 4.83e-03
2022-05-03 07:53:36,754 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.435, Acc: 0.810, Base Lr: 4.83e-03
2022-05-03 07:54:20,803 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.597[s] Speed: 26.8[samples/s]
2022-05-03 07:55:43,805 reid_baseline.train INFO: normal accuracy 0.7465645415634152 2.477665662765503 
2022-05-03 07:55:44,615 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 07:55:44,615 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 247.8%
2022-05-03 07:56:43,189 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.372, Acc: 0.817, Base Lr: 5.62e-03
2022-05-03 07:57:39,581 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.354, Acc: 0.829, Base Lr: 5.62e-03
2022-05-03 07:58:20,154 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.570[s] Speed: 28.1[samples/s]
2022-05-03 07:59:50,375 reid_baseline.train INFO: normal accuracy 0.7474656454156342 2.361952066421509 
2022-05-03 07:59:51,264 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 07:59:51,265 reid_baseline.train INFO: Accuracy: 74.7% Mean Entropy: 236.2%
2022-05-03 08:00:47,554 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.263, Acc: 0.849, Base Lr: 6.42e-03
2022-05-03 08:01:45,696 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.262, Acc: 0.851, Base Lr: 6.42e-03
2022-05-03 08:02:26,570 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.568[s] Speed: 28.2[samples/s]
2022-05-03 08:03:53,054 reid_baseline.train INFO: normal accuracy 0.75107006082451 2.329976797103882 
2022-05-03 08:03:53,878 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 08:03:53,878 reid_baseline.train INFO: Accuracy: 75.1% Mean Entropy: 233.0%
2022-05-03 08:04:54,068 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.206, Acc: 0.868, Base Lr: 7.21e-03
2022-05-03 08:05:47,175 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.200, Acc: 0.868, Base Lr: 7.21e-03
2022-05-03 08:06:29,104 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.568[s] Speed: 28.2[samples/s]
2022-05-03 08:07:55,421 reid_baseline.train INFO: normal accuracy 0.7524217166028385 2.2355926036834717 
2022-05-03 08:07:56,263 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 08:07:56,263 reid_baseline.train INFO: Accuracy: 75.2% Mean Entropy: 223.6%
2022-05-03 08:08:57,401 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.135, Acc: 0.892, Base Lr: 4.01e-03
2022-05-03 08:09:53,689 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.134, Acc: 0.891, Base Lr: 4.01e-03
2022-05-03 08:10:26,882 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.552[s] Speed: 29.0[samples/s]
2022-05-03 08:11:44,422 reid_baseline.train INFO: normal accuracy 0.7596305474205902 2.242321014404297 
2022-05-03 08:11:44,423 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 08:11:44,423 reid_baseline.train INFO: Accuracy: 76.0% Mean Entropy: 224.2%
2022-05-03 08:12:23,119 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.098, Acc: 0.904, Base Lr: 3.38e-03
2022-05-03 08:12:59,294 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.094, Acc: 0.904, Base Lr: 3.38e-03
2022-05-03 08:13:24,930 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.368[s] Speed: 43.5[samples/s]
2022-05-03 08:14:37,685 reid_baseline.train INFO: normal accuracy 0.7612074791619734 2.2110989093780518 
2022-05-03 08:14:38,492 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 08:14:38,493 reid_baseline.train INFO: Accuracy: 76.1% Mean Entropy: 221.1%
2022-05-03 08:15:13,346 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.066, Acc: 0.914, Base Lr: 2.77e-03
2022-05-03 08:15:52,170 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.075, Acc: 0.913, Base Lr: 2.77e-03
2022-05-03 08:16:19,274 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-05-03 08:17:33,627 reid_baseline.train INFO: normal accuracy 0.7650371705339041 2.261445999145508 
2022-05-03 08:17:33,627 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 08:17:33,627 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 226.1%
2022-05-03 08:18:13,360 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.041, Acc: 0.922, Base Lr: 2.20e-03
2022-05-03 08:18:49,712 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.050, Acc: 0.921, Base Lr: 2.20e-03
2022-05-03 08:19:13,697 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.367[s] Speed: 43.7[samples/s]
2022-05-03 08:20:26,544 reid_baseline.train INFO: normal accuracy 0.7621085830141924 2.2226905822753906 
2022-05-03 08:20:26,544 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 08:20:26,545 reid_baseline.train INFO: Accuracy: 76.2% Mean Entropy: 222.3%
2022-05-03 08:21:06,185 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.051, Acc: 0.917, Base Lr: 1.66e-03
2022-05-03 08:21:41,746 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.044, Acc: 0.924, Base Lr: 1.66e-03
2022-05-03 08:22:07,499 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.370[s] Speed: 43.3[samples/s]
2022-05-03 08:23:20,938 reid_baseline.train INFO: normal accuracy 0.7650371705339041 2.1954870223999023 
2022-05-03 08:23:21,722 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 08:23:21,723 reid_baseline.train INFO: Accuracy: 76.5% Mean Entropy: 219.5%
2022-05-03 08:23:59,124 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.045, Acc: 0.927, Base Lr: 1.19e-03
2022-05-03 08:24:35,123 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.043, Acc: 0.924, Base Lr: 1.19e-03
2022-05-03 08:25:02,835 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.370[s] Speed: 43.3[samples/s]
2022-05-03 08:26:14,018 reid_baseline.train INFO: normal accuracy 0.770218517684163 2.1895577907562256 
2022-05-03 08:26:14,812 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 08:26:14,813 reid_baseline.train INFO: Accuracy: 77.0% Mean Entropy: 219.0%
2022-05-03 08:26:54,439 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.021, Acc: 0.933, Base Lr: 7.78e-04
2022-05-03 08:27:31,349 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.018, Acc: 0.934, Base Lr: 7.78e-04
2022-05-03 08:27:56,426 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.372[s] Speed: 43.1[samples/s]
2022-05-03 08:29:10,347 reid_baseline.train INFO: normal accuracy 0.7657129984230683 2.213906764984131 
2022-05-03 08:29:10,354 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 08:29:10,354 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 221.4%
2022-05-03 08:29:50,633 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.030, Acc: 0.934, Base Lr: 4.51e-04
2022-05-03 08:30:26,852 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.029, Acc: 0.925, Base Lr: 4.51e-04
2022-05-03 08:30:52,547 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.374[s] Speed: 42.7[samples/s]
2022-05-03 08:32:08,008 reid_baseline.train INFO: normal accuracy 0.7677404820905609 2.1859705448150635 
2022-05-03 08:32:08,785 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 08:32:08,785 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 218.6%
2022-05-03 08:32:47,028 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.019, Acc: 0.940, Base Lr: 2.11e-04
2022-05-03 08:33:21,107 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.028, Acc: 0.932, Base Lr: 2.11e-04
2022-05-03 08:33:48,749 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.366[s] Speed: 43.7[samples/s]
2022-05-03 08:35:02,187 reid_baseline.train INFO: normal accuracy 0.7679657580536157 2.233045816421509 
2022-05-03 08:35:02,188 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 08:35:02,188 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 223.3%
2022-05-03 08:35:41,038 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.019, Acc: 0.941, Base Lr: 6.51e-05
2022-05-03 08:36:16,843 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.015, Acc: 0.936, Base Lr: 6.51e-05
2022-05-03 08:36:42,815 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.368[s] Speed: 43.5[samples/s]
2022-05-03 08:37:55,164 reid_baseline.train INFO: normal accuracy 0.7679657580536157 2.209287405014038 
2022-05-03 08:37:55,165 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 08:37:55,165 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 220.9%
2022-05-03 08:38:37,148 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.027, Acc: 0.928, Base Lr: 1.60e-05
2022-05-03 08:39:11,907 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.025, Acc: 0.931, Base Lr: 1.60e-05
2022-05-03 08:39:37,901 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.376[s] Speed: 42.5[samples/s]
2022-05-03 08:40:55,483 reid_baseline.train INFO: normal accuracy 0.7686415859427799 2.1673412322998047 
2022-05-03 08:40:56,282 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 08:40:56,282 reid_baseline.train INFO: Accuracy: 76.9% Mean Entropy: 216.7%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Product_shuffled_Cross_Domain_key_layer_12/transformer_best_model.pth
2022-05-03 08:42:09,624 reid_baseline.train INFO: normal accuracy 0.7686415859427799 2.1673412322998047 
2022-05-03 08:42:09,624 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 08:42:09,624 reid_baseline.train INFO: Accuracy: 76.9%
2022-05-03 08:43:23,923 reid_baseline.train INFO: normal accuracy 0.7686415859427799 2.1673412322998047 
2022-05-03 08:43:23,924 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 08:43:23,924 reid_baseline.train INFO: Shuffled Accuracy: 76.9%
2022-05-03 08:44:38,236 reid_baseline.train INFO: normal accuracy 0.9578465063001146 1.2049354314804077 
2022-05-03 08:44:38,237 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 08:44:38,237 reid_baseline.train INFO: Source Clean Accuracy: 95.8%
2022-05-03 08:44:43,973 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_2
2022-05-03 08:44:43,973 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_2', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=2)
2022-05-03 08:44:43,973 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 08:44:43,973 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 08:44:43,974 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_2
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 08:44:53,304 reid_baseline.train INFO: start training
2022-05-03 08:45:35,698 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.117, Acc: 0.285, Base Lr: 8.72e-04
2022-05-03 08:46:11,523 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.052, Acc: 0.384, Base Lr: 8.72e-04
2022-05-03 08:46:37,494 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.379[s] Speed: 42.2[samples/s]
2022-05-03 08:50:01,989 reid_baseline.train INFO: normal accuracy 0.5678218957998623 4.166251182556152 
2022-05-03 08:50:02,748 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 08:50:02,749 reid_baseline.train INFO: Accuracy: 56.8% Mean Entropy: 416.6%
2022-05-03 08:50:40,750 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.647, Acc: 0.554, Base Lr: 1.66e-03
2022-05-03 08:51:17,895 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.484, Acc: 0.562, Base Lr: 1.66e-03
2022-05-03 08:51:43,524 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-05-03 08:55:11,305 reid_baseline.train INFO: normal accuracy 0.6061510213449621 4.006769180297852 
2022-05-03 08:55:12,138 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 08:55:12,139 reid_baseline.train INFO: Accuracy: 60.6% Mean Entropy: 400.7%
2022-05-03 08:55:53,519 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.699, Acc: 0.605, Base Lr: 2.46e-03
2022-05-03 08:56:28,508 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.543, Acc: 0.614, Base Lr: 2.46e-03
2022-05-03 08:56:54,188 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.373[s] Speed: 42.9[samples/s]
2022-05-03 09:00:13,728 reid_baseline.train INFO: normal accuracy 0.6752352536148726 3.2791223526000977 
2022-05-03 09:00:14,545 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 09:00:14,545 reid_baseline.train INFO: Accuracy: 67.5% Mean Entropy: 327.9%
2022-05-03 09:00:52,612 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 1.991, Acc: 0.701, Base Lr: 3.25e-03
2022-05-03 09:01:29,442 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.929, Acc: 0.705, Base Lr: 3.25e-03
2022-05-03 09:01:55,164 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.368[s] Speed: 43.4[samples/s]
2022-05-03 09:05:17,934 reid_baseline.train INFO: normal accuracy 0.7385815928391095 2.626957654953003 
2022-05-03 09:05:18,779 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 09:05:18,779 reid_baseline.train INFO: Accuracy: 73.9% Mean Entropy: 262.7%
2022-05-03 09:05:58,144 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.625, Acc: 0.754, Base Lr: 4.04e-03
2022-05-03 09:06:33,526 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.593, Acc: 0.761, Base Lr: 4.04e-03
2022-05-03 09:07:00,280 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-05-03 09:10:24,750 reid_baseline.train INFO: normal accuracy 0.7590084920817076 2.247560739517212 
2022-05-03 09:10:25,599 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 09:10:25,599 reid_baseline.train INFO: Accuracy: 75.9% Mean Entropy: 224.8%
2022-05-03 09:11:05,523 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.401, Acc: 0.822, Base Lr: 4.83e-03
2022-05-03 09:11:40,639 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.404, Acc: 0.811, Base Lr: 4.83e-03
2022-05-03 09:12:07,013 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.371[s] Speed: 43.1[samples/s]
2022-05-03 09:15:38,480 reid_baseline.train INFO: normal accuracy 0.7732384668349782 1.9946507215499878 
2022-05-03 09:15:39,307 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 09:15:39,308 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 199.5%
2022-05-03 09:16:18,537 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.340, Acc: 0.827, Base Lr: 5.62e-03
2022-05-03 09:16:54,151 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.327, Acc: 0.834, Base Lr: 5.62e-03
2022-05-03 09:17:20,144 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-05-03 09:21:03,768 reid_baseline.train INFO: normal accuracy 0.7736974982786321 1.8393175601959229 
2022-05-03 09:21:04,598 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 09:21:04,599 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 183.9%
2022-05-03 09:21:43,055 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.244, Acc: 0.856, Base Lr: 6.42e-03
2022-05-03 09:22:17,610 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.244, Acc: 0.854, Base Lr: 6.42e-03
2022-05-03 09:22:40,858 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.351[s] Speed: 45.5[samples/s]
2022-05-03 09:26:14,998 reid_baseline.train INFO: normal accuracy 0.7792058756024788 1.7921773195266724 
2022-05-03 09:26:15,802 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 09:26:15,802 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 179.2%
2022-05-03 09:26:52,805 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.196, Acc: 0.871, Base Lr: 7.21e-03
2022-05-03 09:27:27,137 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.187, Acc: 0.870, Base Lr: 7.21e-03
2022-05-03 09:27:54,467 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.361[s] Speed: 44.3[samples/s]
2022-05-03 09:31:24,989 reid_baseline.train INFO: normal accuracy 0.7842552214826716 1.6957746744155884 
2022-05-03 09:31:25,764 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 09:31:25,764 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 169.6%
2022-05-03 09:32:05,847 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.111, Acc: 0.896, Base Lr: 4.01e-03
2022-05-03 09:32:43,098 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.115, Acc: 0.897, Base Lr: 4.01e-03
2022-05-03 09:33:08,706 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.377[s] Speed: 42.4[samples/s]
2022-05-03 09:36:35,506 reid_baseline.train INFO: normal accuracy 0.7888455359192105 1.7485249042510986 
2022-05-03 09:36:35,507 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 09:36:35,507 reid_baseline.train INFO: Accuracy: 78.9% Mean Entropy: 174.9%
2022-05-03 09:37:17,385 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.088, Acc: 0.902, Base Lr: 3.38e-03
2022-05-03 09:37:52,591 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.084, Acc: 0.904, Base Lr: 3.38e-03
2022-05-03 09:38:18,146 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-05-03 09:41:39,327 reid_baseline.train INFO: normal accuracy 0.7860913472572871 1.7193958759307861 
2022-05-03 09:41:39,328 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 09:41:39,328 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 171.9%
2022-05-03 09:42:18,247 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.050, Acc: 0.914, Base Lr: 2.77e-03
2022-05-03 09:42:55,055 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.063, Acc: 0.909, Base Lr: 2.77e-03
2022-05-03 09:43:20,862 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-05-03 09:46:50,850 reid_baseline.train INFO: normal accuracy 0.7860913472572871 1.7131307125091553 
2022-05-03 09:46:50,851 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 09:46:50,851 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 171.3%
2022-05-03 09:47:30,001 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.025, Acc: 0.923, Base Lr: 2.20e-03
2022-05-03 09:48:06,089 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.033, Acc: 0.925, Base Lr: 2.20e-03
2022-05-03 09:48:30,418 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.364[s] Speed: 43.9[samples/s]
2022-05-03 09:51:52,456 reid_baseline.train INFO: normal accuracy 0.7849437686481524 1.7065860033035278 
2022-05-03 09:51:52,456 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 09:51:52,457 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 170.7%
2022-05-03 09:52:32,604 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.043, Acc: 0.919, Base Lr: 1.66e-03
2022-05-03 09:53:07,788 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.034, Acc: 0.924, Base Lr: 1.66e-03
2022-05-03 09:53:33,080 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.368[s] Speed: 43.4[samples/s]
2022-05-03 09:57:00,340 reid_baseline.train INFO: normal accuracy 0.7922882717466146 1.6824188232421875 
2022-05-03 09:57:01,157 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 09:57:01,158 reid_baseline.train INFO: Accuracy: 79.2% Mean Entropy: 168.2%
2022-05-03 09:57:41,195 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.037, Acc: 0.925, Base Lr: 1.19e-03
2022-05-03 09:58:16,659 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.032, Acc: 0.925, Base Lr: 1.19e-03
2022-05-03 09:58:41,974 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.369[s] Speed: 43.4[samples/s]
2022-05-03 10:02:13,394 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.6777764558792114 
2022-05-03 10:02:14,186 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 10:02:14,187 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 167.8%
2022-05-03 10:02:53,099 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.012, Acc: 0.933, Base Lr: 7.78e-04
2022-05-03 10:03:27,195 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.009, Acc: 0.931, Base Lr: 7.78e-04
2022-05-03 10:03:51,962 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.358[s] Speed: 44.7[samples/s]
2022-05-03 10:07:21,785 reid_baseline.train INFO: normal accuracy 0.7955014918521919 1.7134414911270142 
2022-05-03 10:07:21,785 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 10:07:21,785 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 171.3%
2022-05-03 10:07:59,486 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.017, Acc: 0.936, Base Lr: 4.51e-04
2022-05-03 10:08:36,236 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.012, Acc: 0.931, Base Lr: 4.51e-04
2022-05-03 10:09:03,343 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.372[s] Speed: 43.0[samples/s]
2022-05-03 10:12:27,165 reid_baseline.train INFO: normal accuracy 0.794812944686711 1.704269528388977 
2022-05-03 10:12:27,165 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 10:12:27,166 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 170.4%
2022-05-03 10:13:04,566 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.010, Acc: 0.934, Base Lr: 2.11e-04
2022-05-03 10:13:43,677 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.018, Acc: 0.930, Base Lr: 2.11e-04
2022-05-03 10:14:10,207 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.377[s] Speed: 42.4[samples/s]
2022-05-03 10:17:44,075 reid_baseline.train INFO: normal accuracy 0.7975671333486344 1.7147912979125977 
2022-05-03 10:17:44,075 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 10:17:44,076 reid_baseline.train INFO: Accuracy: 79.8% Mean Entropy: 171.5%
2022-05-03 10:18:25,052 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.004, Acc: 0.941, Base Lr: 6.51e-05
2022-05-03 10:19:02,144 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.006, Acc: 0.934, Base Lr: 6.51e-05
2022-05-03 10:19:29,367 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.385[s] Speed: 41.5[samples/s]
2022-05-03 10:23:10,671 reid_baseline.train INFO: normal accuracy 0.795042460408538 1.7158671617507935 
2022-05-03 10:23:10,671 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 10:23:10,672 reid_baseline.train INFO: Accuracy: 79.5% Mean Entropy: 171.6%
2022-05-03 10:23:52,216 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.009, Acc: 0.924, Base Lr: 1.60e-05
2022-05-03 10:24:31,751 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.011, Acc: 0.928, Base Lr: 1.60e-05
2022-05-03 10:24:58,656 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.395[s] Speed: 40.5[samples/s]
2022-05-03 10:28:30,596 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.6745027303695679 
2022-05-03 10:28:31,410 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 10:28:31,410 reid_baseline.train INFO: Accuracy: 79.6% Mean Entropy: 167.5%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_2/transformer_best_model.pth
2022-05-03 10:31:55,856 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.6745027303695679 
2022-05-03 10:31:55,857 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 10:31:55,857 reid_baseline.train INFO: Accuracy: 79.6%
2022-05-03 10:35:25,033 reid_baseline.train INFO: normal accuracy 0.7957310075740188 1.6745027303695679 
2022-05-03 10:35:25,033 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 10:35:25,033 reid_baseline.train INFO: Shuffled Accuracy: 79.6%
2022-05-03 10:36:41,880 reid_baseline.train INFO: normal accuracy 0.9603665521191295 0.7903329730033875 
2022-05-03 10:36:41,881 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 10:36:41,881 reid_baseline.train INFO: Source Clean Accuracy: 96.0%
2022-05-03 10:36:47,095 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_11
2022-05-03 10:36:47,095 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_11', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=11)
2022-05-03 10:36:47,096 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 10:36:47,096 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 10:36:47,096 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_11
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 10:36:56,465 reid_baseline.train INFO: start training
2022-05-03 10:37:43,876 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.116, Acc: 0.268, Base Lr: 8.72e-04
2022-05-03 10:38:20,863 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.050, Acc: 0.357, Base Lr: 8.72e-04
2022-05-03 10:38:46,590 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.400[s] Speed: 40.0[samples/s]
2022-05-03 10:42:12,502 reid_baseline.train INFO: normal accuracy 0.5322469589166858 4.166566371917725 
2022-05-03 10:42:13,312 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 10:42:13,312 reid_baseline.train INFO: Accuracy: 53.2% Mean Entropy: 416.7%
2022-05-03 10:42:53,233 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.642, Acc: 0.535, Base Lr: 1.66e-03
2022-05-03 10:43:29,227 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.478, Acc: 0.546, Base Lr: 1.66e-03
2022-05-03 10:43:56,004 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.376[s] Speed: 42.6[samples/s]
2022-05-03 10:47:24,155 reid_baseline.train INFO: normal accuracy 0.5845765434932293 4.018119812011719 
2022-05-03 10:47:24,953 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 10:47:24,953 reid_baseline.train INFO: Accuracy: 58.5% Mean Entropy: 401.8%
2022-05-03 10:48:04,451 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.708, Acc: 0.589, Base Lr: 2.46e-03
2022-05-03 10:48:40,222 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.556, Acc: 0.596, Base Lr: 2.46e-03
2022-05-03 10:49:03,750 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.362[s] Speed: 44.2[samples/s]
2022-05-03 10:52:28,407 reid_baseline.train INFO: normal accuracy 0.6596281845306403 3.378988265991211 
2022-05-03 10:52:29,229 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 10:52:29,230 reid_baseline.train INFO: Accuracy: 66.0% Mean Entropy: 337.9%
2022-05-03 10:53:08,190 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.022, Acc: 0.694, Base Lr: 3.25e-03
2022-05-03 10:53:41,751 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.961, Acc: 0.695, Base Lr: 3.25e-03
2022-05-03 10:54:04,618 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.349[s] Speed: 45.9[samples/s]
2022-05-03 10:57:35,929 reid_baseline.train INFO: normal accuracy 0.7202203350929539 2.846013307571411 
2022-05-03 10:57:36,752 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 10:57:36,752 reid_baseline.train INFO: Accuracy: 72.0% Mean Entropy: 284.6%
2022-05-03 10:58:14,173 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.661, Acc: 0.743, Base Lr: 4.04e-03
2022-05-03 10:58:44,800 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.627, Acc: 0.752, Base Lr: 4.04e-03
2022-05-03 10:59:12,744 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.352[s] Speed: 45.5[samples/s]
2022-05-03 11:02:49,236 reid_baseline.train INFO: normal accuracy 0.7463851273812256 2.5532591342926025 
2022-05-03 11:02:50,111 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 11:02:50,111 reid_baseline.train INFO: Accuracy: 74.6% Mean Entropy: 255.3%
2022-05-03 11:03:25,102 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.428, Acc: 0.823, Base Lr: 4.83e-03
2022-05-03 11:04:01,501 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.431, Acc: 0.812, Base Lr: 4.83e-03
2022-05-03 11:04:29,494 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.364[s] Speed: 44.0[samples/s]
2022-05-03 11:08:06,167 reid_baseline.train INFO: normal accuracy 0.7631397750745926 2.416686534881592 
2022-05-03 11:08:07,022 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 11:08:07,022 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 241.7%
2022-05-03 11:08:47,856 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.358, Acc: 0.831, Base Lr: 5.62e-03
2022-05-03 11:09:24,400 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.350, Acc: 0.833, Base Lr: 5.62e-03
2022-05-03 11:09:49,897 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.377[s] Speed: 42.5[samples/s]
2022-05-03 11:13:19,963 reid_baseline.train INFO: normal accuracy 0.7679596052329585 2.2363240718841553 
2022-05-03 11:13:20,756 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 11:13:20,757 reid_baseline.train INFO: Accuracy: 76.8% Mean Entropy: 223.6%
2022-05-03 11:13:59,851 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.264, Acc: 0.851, Base Lr: 6.42e-03
2022-05-03 11:14:36,378 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.261, Acc: 0.854, Base Lr: 6.42e-03
2022-05-03 11:15:02,903 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.374[s] Speed: 42.8[samples/s]
2022-05-03 11:18:32,915 reid_baseline.train INFO: normal accuracy 0.765893963736516 2.2075607776641846 
2022-05-03 11:18:33,773 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 11:18:33,773 reid_baseline.train INFO: Accuracy: 76.6% Mean Entropy: 220.8%
2022-05-03 11:19:13,094 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.212, Acc: 0.869, Base Lr: 7.21e-03
2022-05-03 11:19:49,494 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.202, Acc: 0.871, Base Lr: 7.21e-03
2022-05-03 11:20:16,227 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.375[s] Speed: 42.6[samples/s]
2022-05-03 11:23:46,711 reid_baseline.train INFO: normal accuracy 0.7748450768877668 2.105025291442871 
2022-05-03 11:23:47,505 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 11:23:47,505 reid_baseline.train INFO: Accuracy: 77.5% Mean Entropy: 210.5%
2022-05-03 11:24:27,002 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.125, Acc: 0.901, Base Lr: 4.01e-03
2022-05-03 11:25:03,094 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.131, Acc: 0.895, Base Lr: 4.01e-03
2022-05-03 11:25:29,211 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.373[s] Speed: 43.0[samples/s]
2022-05-03 11:28:56,340 reid_baseline.train INFO: normal accuracy 0.7734679825568052 2.1195614337921143 
2022-05-03 11:28:56,341 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 11:28:56,341 reid_baseline.train INFO: Accuracy: 77.3% Mean Entropy: 212.0%
2022-05-03 11:29:35,418 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.098, Acc: 0.904, Base Lr: 3.38e-03
2022-05-03 11:30:11,465 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.094, Acc: 0.903, Base Lr: 3.38e-03
2022-05-03 11:30:36,325 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.366[s] Speed: 43.7[samples/s]
2022-05-03 11:34:03,290 reid_baseline.train INFO: normal accuracy 0.7775992655496902 2.11091947555542 
2022-05-03 11:34:03,291 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 11:34:03,291 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 211.1%
2022-05-03 11:34:45,904 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.067, Acc: 0.919, Base Lr: 2.77e-03
2022-05-03 11:35:22,148 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.076, Acc: 0.917, Base Lr: 2.77e-03
2022-05-03 11:35:46,883 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.379[s] Speed: 42.2[samples/s]
2022-05-03 11:39:24,029 reid_baseline.train INFO: normal accuracy 0.7794353913243057 2.102271556854248 
2022-05-03 11:39:24,884 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 11:39:24,884 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 210.2%
2022-05-03 11:40:02,848 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.044, Acc: 0.918, Base Lr: 2.20e-03
2022-05-03 11:40:39,747 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.049, Acc: 0.921, Base Lr: 2.20e-03
2022-05-03 11:41:07,001 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.373[s] Speed: 42.8[samples/s]
2022-05-03 11:44:35,556 reid_baseline.train INFO: normal accuracy 0.7778287812715171 2.1434619426727295 
2022-05-03 11:44:35,557 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 11:44:35,557 reid_baseline.train INFO: Accuracy: 77.8% Mean Entropy: 214.3%
2022-05-03 11:45:14,724 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.055, Acc: 0.916, Base Lr: 1.66e-03
2022-05-03 11:45:53,348 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.047, Acc: 0.920, Base Lr: 1.66e-03
2022-05-03 11:46:20,000 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.383[s] Speed: 41.8[samples/s]
2022-05-03 11:49:51,494 reid_baseline.train INFO: normal accuracy 0.7810420013770943 2.067260503768921 
2022-05-03 11:49:52,357 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 11:49:52,357 reid_baseline.train INFO: Accuracy: 78.1% Mean Entropy: 206.7%
2022-05-03 11:50:36,986 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.050, Acc: 0.922, Base Lr: 1.19e-03
2022-05-03 11:51:13,272 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.045, Acc: 0.921, Base Lr: 1.19e-03
2022-05-03 11:51:40,723 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.397[s] Speed: 40.3[samples/s]
2022-05-03 11:55:18,316 reid_baseline.train INFO: normal accuracy 0.7835666743171907 2.1240828037261963 
2022-05-03 11:55:18,317 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 11:55:18,317 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 212.4%
2022-05-03 11:55:59,260 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.024, Acc: 0.928, Base Lr: 7.78e-04
2022-05-03 11:56:38,321 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.020, Acc: 0.930, Base Lr: 7.78e-04
2022-05-03 11:57:05,814 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.394[s] Speed: 40.6[samples/s]
2022-05-03 12:00:42,812 reid_baseline.train INFO: normal accuracy 0.786779894422768 2.133600950241089 
2022-05-03 12:00:42,813 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 12:00:42,813 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 213.4%
2022-05-03 12:01:24,164 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.032, Acc: 0.933, Base Lr: 4.51e-04
2022-05-03 12:02:02,810 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.026, Acc: 0.930, Base Lr: 4.51e-04
2022-05-03 12:02:30,146 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.393[s] Speed: 40.7[samples/s]
2022-05-03 12:06:00,549 reid_baseline.train INFO: normal accuracy 0.7837961900390177 2.0939254760742188 
2022-05-03 12:06:00,549 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 12:06:00,550 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 209.4%
2022-05-03 12:06:41,647 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.016, Acc: 0.937, Base Lr: 2.11e-04
2022-05-03 12:07:14,424 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.025, Acc: 0.932, Base Lr: 2.11e-04
2022-05-03 12:07:41,807 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.371[s] Speed: 43.1[samples/s]
2022-05-03 12:11:11,096 reid_baseline.train INFO: normal accuracy 0.7854028000918063 2.138259172439575 
2022-05-03 12:11:11,097 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 12:11:11,097 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 213.8%
2022-05-03 12:11:50,466 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.017, Acc: 0.934, Base Lr: 6.51e-05
2022-05-03 12:12:22,222 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.015, Acc: 0.932, Base Lr: 6.51e-05
2022-05-03 12:12:45,508 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.346[s] Speed: 46.3[samples/s]
2022-05-03 12:15:51,305 reid_baseline.train INFO: normal accuracy 0.786779894422768 2.129434585571289 
2022-05-03 12:15:51,305 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 12:15:51,306 reid_baseline.train INFO: Accuracy: 78.7% Mean Entropy: 212.9%
2022-05-03 12:16:26,002 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.024, Acc: 0.925, Base Lr: 1.60e-05
2022-05-03 12:16:57,320 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.022, Acc: 0.929, Base Lr: 1.60e-05
2022-05-03 12:17:19,805 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.323[s] Speed: 49.5[samples/s]
2022-05-03 12:20:41,266 reid_baseline.train INFO: normal accuracy 0.7863208629791141 2.0884897708892822 
2022-05-03 12:20:41,268 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 12:20:41,268 reid_baseline.train INFO: Accuracy: 78.6% Mean Entropy: 208.8%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_11/transformer_best_model.pth
2022-05-03 12:24:07,061 reid_baseline.train INFO: normal accuracy 0.7810420013770943 2.067260503768921 
2022-05-03 12:24:07,061 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 12:24:07,061 reid_baseline.train INFO: Accuracy: 78.1%
2022-05-03 12:27:57,247 reid_baseline.train INFO: normal accuracy 0.7810420013770943 2.067260503768921 
2022-05-03 12:27:57,248 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 12:27:57,248 reid_baseline.train INFO: Shuffled Accuracy: 78.1%
2022-05-03 12:29:31,139 reid_baseline.train INFO: normal accuracy 0.9514318442153493 1.1122543811798096 
2022-05-03 12:29:31,139 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 12:29:31,139 reid_baseline.train INFO: Source Clean Accuracy: 95.1%
2022-05-03 12:29:38,699 reid_baseline INFO: Saving model in the path :../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_12
2022-05-03 12:29:38,699 reid_baseline INFO: Namespace(config_file='configs/pretrain.yml', opts=['MODEL.DEVICE_ID', "('3')", 'DATASETS.NAMES', 'OfficeHome', 'OUTPUT_DIR', '../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_12', 'DATASETS.ROOT_TRAIN_DIR', '../data/OfficeHomeDataset/Clipart.txt', 'DATASETS.ROOT_TEST_DIR', '../data/OfficeHomeDataset/Real_World.txt', 'MODEL.Transformer_TYPE', 'vit_base_patch16_224_TransReID', 'MODEL.PRETRAIN_PATH', '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'], local_rank=0, patch_size=8, dom_cls=False, layer_num=12)
2022-05-03 12:29:38,700 reid_baseline INFO: Loaded configuration file configs/pretrain.yml
2022-05-03 12:29:38,700 reid_baseline INFO: 
MODEL:
  PRETRAIN_CHOICE: 'imagenet'
  PRETRAIN_PATH: '../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth'
  METRIC_LOSS_TYPE: 'triplet'
  IF_LABELSMOOTH: 'on'
  IF_WITH_CENTER: 'no'
  NAME: 'transformer'
  NO_MARGIN: True
  DEVICE_ID: ('0')
  Transformer_TYPE: 'vit_base_patch16_224_TransReID' #vit_small_patch16_224_TransReID
  STRIDE_SIZE: [16, 16]
  FC_SETTING: 'TransReID'
  TASK_TYPE: 'classify_DA' 
  UDA_STAGE: 'pretrain'

INPUT:
  SIZE_TRAIN: [256, 256]
  SIZE_TEST: [256, 256]
  SIZE_CROP: [224, 224]
  PROB: 0.5 # random horizontal flip
  RE_PROB: 0.0 # random erasing
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]

DATASETS:
  NAMES: ('OURAPI')
  ROOT_TRAIN_DIR: ('./datasets/reid_datasets/Corrected_Market1501')
  NAMES2: ('OURAPI')
  ROOT_TRAIN_DIR2: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')
  ROOT_TEST_DIR: ('./datasets/reid_datasets/Refined_DukeMTMC_reID')

DATALOADER:
  SAMPLER: 'softmax'
  NUM_INSTANCE: 4
  NUM_WORKERS: 8

SOLVER:
  OPTIMIZER_NAME: 'SGD'
  MAX_EPOCHS: 20
  BASE_LR: 0.008
  IMS_PER_BATCH: 16
  STEPS: [40, 80]
  GAMMA: 0.
  WARMUP_FACTOR: 0.01
  WARMUP_EPOCHS: 10
  WARMUP_METHOD: 'linear'
  LARGE_FC_LR: False
  CHECKPOINT_PERIOD: 10
  LOG_PERIOD: 100
  EVAL_PERIOD: 1
  WEIGHT_DECAY:  1e-4
  WEIGHT_DECAY_BIAS: 1e-4
  BIAS_LR_FACTOR: 2

TEST:
  EVAL: True
  IMS_PER_BATCH: 64
  RE_RANKING: False
  RE_RANKING_TRACK: False

  WEIGHT: '../logs/trans4DA/transformer_120.pth'
  NECK_FEAT: 'after'
  FEAT_NORM: 'yes'

OUTPUT_DIR: '../logs/trans4DA'



2022-05-03 12:29:38,700 reid_baseline INFO: Running with config:
DATALOADER:
  NUM_INSTANCE: 4
  NUM_WORKERS: 8
  SAMPLER: softmax
DATASETS:
  NAMES: OfficeHome
  NAMES2: OURAPI
  PLUS_NUM_ID: 100
  QUERY_MINING: False
  ROOT_TEST_DIR: ../data/OfficeHomeDataset/Real_World.txt
  ROOT_TRAIN_DIR: ../data/OfficeHomeDataset/Clipart.txt
  ROOT_TRAIN_DIR2: ./datasets/reid_datasets/Refined_DukeMTMC_reID
INPUT:
  AA_PROB: 0.0
  PADDING: 0
  PIXEL_MEAN: [0.485, 0.456, 0.406]
  PIXEL_STD: [0.229, 0.224, 0.225]
  PROB: 0.5
  RE_PROB: 0.0
  SIZE_CROP: [224, 224]
  SIZE_TEST: [256, 256]
  SIZE_TRAIN: [256, 256]
MODEL:
  AIE_COE: 1.5
  BLOCK_PATTERN: normal
  CAMERA_EMBEDDING: False
  COS_LAYER: False
  DEVICE: cuda
  DEVICE_ID: 3
  DEVIDE_LENGTH: 4
  DIST_TRAIN: False
  DROP_OUT: 0.0
  DROP_PATH: 0.1
  FC_SETTING: TransReID
  FROZEN: -1
  ID_LOSS_TYPE: softmax
  ID_LOSS_WEIGHT: 1.0
  IF_LABELSMOOTH: on
  IF_WITH_CENTER: no
  LAST_STRIDE: 1
  LOCAL_F: False
  METRIC_LOSS_TYPE: triplet
  NAME: transformer
  NECK: bnneck
  NO_MARGIN: True
  NO_SHUFFLE: False
  PATCH_SHUFFLE: 2
  PRETRAIN_CHOICE: imagenet
  PRETRAIN_PATH: ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
  PROB: 0.0
  RECIP_LOSS: 
  STRIDE_SIZE: [16, 16]
  TASK_TYPE: classify_DA
  THRESH: 0.23
  TRIPLET_LOSS_WEIGHT: 1.0
  Transformer_TYPE: vit_base_patch16_224_TransReID
  UDA_STAGE: pretrain
  VIEWPOINT_EMBEDDING: False
  YIWEI_NUM: 5
  lameda: 0.5
OUTPUT_DIR: ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_12
SOLVER:
  BASE_LR: 0.008
  BIAS_LR_FACTOR: 2
  CENTER_LOSS_WEIGHT: 0.0005
  CENTER_LR: 0.5
  CHECKPOINT_PERIOD: 10
  CLUSTER_MARGIN: 0.3
  COSINE_MARGIN: 0.5
  COSINE_SCALE: 30
  EVAL_PERIOD: 1
  GAMMA: 0.0
  IMS_PER_BATCH: 16
  LARGE_FC_LR: False
  LOG_PERIOD: 100
  MARGIN: 0.3
  MAX_EPOCHS: 20
  MOMENTUM: 0.9
  OPTIMIZER_NAME: SGD
  RANGE_ALPHA: 0
  RANGE_BETA: 1
  RANGE_K: 2
  RANGE_LOSS_WEIGHT: 1
  RANGE_MARGIN: 0.3
  SEED: 1234
  STEPS: (40, 80)
  WARMUP_EPOCHS: 10
  WARMUP_FACTOR: 0.01
  WARMUP_METHOD: linear
  WEIGHT_DECAY: 0.0001
  WEIGHT_DECAY_BIAS: 0.0001
  WITH_PSEUDO_LABEL_FILTER: False
TEST:
  DIST_MAT: dist_mat.npy
  EVAL: True
  FEAT_NORM: yes
  FLIP_FEATS: off
  IMS_PER_BATCH: 64
  NECK_FEAT: after
  RE_RANKING: False
  RE_RANKING_TRACK: False
  WEIGHT: ../logs/trans4DA/transformer_120.pth
=> Office-Home loaded
Dataset statistics:
train Clipart and valid is Real_World
  ----------------------------------------
  subset   | # ids | # images | # cameras
  ----------------------------------------
  train   |    65 |     4365 |         1
  valid   |    65 |     4357 |         1
  ----------------------------------------
use shuffle sampler strategy
using Transformer_type: vit_base_patch16_224_TransReID as a backbone
using stride: [16, 16], and part number is num_y14 * num_x14
using drop_path_rate is : 0.1
using aie_xishu is : 1.5
embed_diim 768 mlp_ratio 4
distill need to choose right cls token in the pth
Resized position embedding: %s to %s torch.Size([1, 197, 768]) torch.Size([1, 197, 768])
Position embedding resize to height:14 width: 14
Loading pretrained ImageNet model......from ../data/pretrainModel/deit_base_distilled_patch16_224-df68dfff.pth
===========building transformer===========
label smooth on, numclasses: 65
pretrain train
2022-05-03 12:29:53,226 reid_baseline.train INFO: start training
2022-05-03 12:31:01,022 reid_baseline.train INFO: Epoch[1] Iteration[100/273] Loss: 4.113, Acc: 0.270, Base Lr: 8.72e-04
2022-05-03 12:31:59,433 reid_baseline.train INFO: Epoch[1] Iteration[200/273] Loss: 4.044, Acc: 0.364, Base Lr: 8.72e-04
2022-05-03 12:32:41,062 reid_baseline.train INFO: Epoch 1 done. Time per batch: 0.610[s] Speed: 26.2[samples/s]
2022-05-03 12:36:52,927 reid_baseline.train INFO: normal accuracy 0.5515262795501492 4.165980815887451 
2022-05-03 12:36:53,709 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 1
2022-05-03 12:36:53,709 reid_baseline.train INFO: Accuracy: 55.2% Mean Entropy: 416.6%
2022-05-03 12:37:44,122 reid_baseline.train INFO: Epoch[2] Iteration[100/273] Loss: 3.621, Acc: 0.531, Base Lr: 1.66e-03
2022-05-03 12:38:33,069 reid_baseline.train INFO: Epoch[2] Iteration[200/273] Loss: 3.447, Acc: 0.543, Base Lr: 1.66e-03
2022-05-03 12:39:15,203 reid_baseline.train INFO: Epoch 2 done. Time per batch: 0.518[s] Speed: 30.9[samples/s]
2022-05-03 12:43:32,652 reid_baseline.train INFO: normal accuracy 0.5985770025246729 4.007215976715088 
2022-05-03 12:43:33,728 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 2
2022-05-03 12:43:33,729 reid_baseline.train INFO: Accuracy: 59.9% Mean Entropy: 400.7%
2022-05-03 12:44:36,101 reid_baseline.train INFO: Epoch[3] Iteration[100/273] Loss: 2.673, Acc: 0.592, Base Lr: 2.46e-03
2022-05-03 12:45:29,246 reid_baseline.train INFO: Epoch[3] Iteration[200/273] Loss: 2.522, Acc: 0.600, Base Lr: 2.46e-03
2022-05-03 12:46:05,047 reid_baseline.train INFO: Epoch 3 done. Time per batch: 0.554[s] Speed: 28.9[samples/s]
2022-05-03 12:50:18,093 reid_baseline.train INFO: normal accuracy 0.6704154234565067 3.4453248977661133 
2022-05-03 12:50:18,974 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 3
2022-05-03 12:50:18,974 reid_baseline.train INFO: Accuracy: 67.0% Mean Entropy: 344.5%
2022-05-03 12:51:17,804 reid_baseline.train INFO: Epoch[4] Iteration[100/273] Loss: 2.012, Acc: 0.682, Base Lr: 3.25e-03
2022-05-03 12:52:13,906 reid_baseline.train INFO: Epoch[4] Iteration[200/273] Loss: 1.953, Acc: 0.688, Base Lr: 3.25e-03
2022-05-03 12:52:55,889 reid_baseline.train INFO: Epoch 4 done. Time per batch: 0.575[s] Speed: 27.8[samples/s]
2022-05-03 12:57:23,371 reid_baseline.train INFO: normal accuracy 0.7275648381914162 2.979609251022339 
2022-05-03 12:57:24,492 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 4
2022-05-03 12:57:24,492 reid_baseline.train INFO: Accuracy: 72.8% Mean Entropy: 298.0%
2022-05-03 12:58:26,518 reid_baseline.train INFO: Epoch[5] Iteration[100/273] Loss: 1.658, Acc: 0.748, Base Lr: 4.04e-03
2022-05-03 12:59:24,780 reid_baseline.train INFO: Epoch[5] Iteration[200/273] Loss: 1.625, Acc: 0.754, Base Lr: 4.04e-03
2022-05-03 13:00:10,577 reid_baseline.train INFO: Epoch 5 done. Time per batch: 0.607[s] Speed: 26.3[samples/s]
2022-05-03 13:05:18,164 reid_baseline.train INFO: normal accuracy 0.7541886619233418 2.716930627822876 
2022-05-03 13:05:19,083 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 5
2022-05-03 13:05:19,084 reid_baseline.train INFO: Accuracy: 75.4% Mean Entropy: 271.7%
2022-05-03 13:06:30,502 reid_baseline.train INFO: Epoch[6] Iteration[100/273] Loss: 1.427, Acc: 0.816, Base Lr: 4.83e-03
2022-05-03 13:07:27,596 reid_baseline.train INFO: Epoch[6] Iteration[200/273] Loss: 1.435, Acc: 0.810, Base Lr: 4.83e-03
2022-05-03 13:08:11,110 reid_baseline.train INFO: Epoch 6 done. Time per batch: 0.630[s] Speed: 25.4[samples/s]
2022-05-03 13:13:47,851 reid_baseline.train INFO: normal accuracy 0.7631397750745926 2.5170488357543945 
2022-05-03 13:13:48,722 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 6
2022-05-03 13:13:48,722 reid_baseline.train INFO: Accuracy: 76.3% Mean Entropy: 251.7%
2022-05-03 13:15:05,173 reid_baseline.train INFO: Epoch[7] Iteration[100/273] Loss: 1.372, Acc: 0.817, Base Lr: 5.62e-03
2022-05-03 13:16:14,928 reid_baseline.train INFO: Epoch[7] Iteration[200/273] Loss: 1.354, Acc: 0.828, Base Lr: 5.62e-03
2022-05-03 13:17:01,045 reid_baseline.train INFO: Epoch 7 done. Time per batch: 0.704[s] Speed: 22.7[samples/s]
2022-05-03 13:23:13,451 reid_baseline.train INFO: normal accuracy 0.7665825109019968 2.4200994968414307 
2022-05-03 13:23:14,293 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 7
2022-05-03 13:23:14,293 reid_baseline.train INFO: Accuracy: 76.7% Mean Entropy: 242.0%
2022-05-03 13:24:31,795 reid_baseline.train INFO: Epoch[8] Iteration[100/273] Loss: 1.263, Acc: 0.848, Base Lr: 6.42e-03
2022-05-03 13:25:46,372 reid_baseline.train INFO: Epoch[8] Iteration[200/273] Loss: 1.262, Acc: 0.851, Base Lr: 6.42e-03
2022-05-03 13:26:40,785 reid_baseline.train INFO: Epoch 8 done. Time per batch: 0.756[s] Speed: 21.2[samples/s]
2022-05-03 13:33:08,188 reid_baseline.train INFO: normal accuracy 0.774156529722286 2.376145362854004 
2022-05-03 13:33:09,030 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 8
2022-05-03 13:33:09,031 reid_baseline.train INFO: Accuracy: 77.4% Mean Entropy: 237.6%
2022-05-03 13:34:25,114 reid_baseline.train INFO: Epoch[9] Iteration[100/273] Loss: 1.206, Acc: 0.870, Base Lr: 7.21e-03
2022-05-03 13:35:37,087 reid_baseline.train INFO: Epoch[9] Iteration[200/273] Loss: 1.200, Acc: 0.869, Base Lr: 7.21e-03
2022-05-03 13:36:31,434 reid_baseline.train INFO: Epoch 9 done. Time per batch: 0.741[s] Speed: 21.6[samples/s]
2022-05-03 13:42:23,927 reid_baseline.train INFO: normal accuracy 0.7764516869405554 2.2831568717956543 
2022-05-03 13:42:24,822 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 9
2022-05-03 13:42:24,822 reid_baseline.train INFO: Accuracy: 77.6% Mean Entropy: 228.3%
2022-05-03 13:43:35,647 reid_baseline.train INFO: Epoch[10] Iteration[100/273] Loss: 1.135, Acc: 0.891, Base Lr: 4.01e-03
2022-05-03 13:44:34,152 reid_baseline.train INFO: Epoch[10] Iteration[200/273] Loss: 1.134, Acc: 0.890, Base Lr: 4.01e-03
2022-05-03 13:45:17,999 reid_baseline.train INFO: Epoch 10 done. Time per batch: 0.634[s] Speed: 25.2[samples/s]
2022-05-03 13:50:19,824 reid_baseline.train INFO: normal accuracy 0.7796649070461327 2.2882838249206543 
2022-05-03 13:50:19,825 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 10
2022-05-03 13:50:19,825 reid_baseline.train INFO: Accuracy: 78.0% Mean Entropy: 228.8%
2022-05-03 13:51:24,301 reid_baseline.train INFO: Epoch[11] Iteration[100/273] Loss: 1.098, Acc: 0.901, Base Lr: 3.38e-03
2022-05-03 13:52:24,362 reid_baseline.train INFO: Epoch[11] Iteration[200/273] Loss: 1.094, Acc: 0.903, Base Lr: 3.38e-03
2022-05-03 13:53:04,615 reid_baseline.train INFO: Epoch 11 done. Time per batch: 0.604[s] Speed: 26.5[samples/s]
2022-05-03 13:57:54,445 reid_baseline.train INFO: normal accuracy 0.7831076428735368 2.2402052879333496 
2022-05-03 13:57:55,350 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 11
2022-05-03 13:57:55,350 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 224.0%
2022-05-03 13:58:53,009 reid_baseline.train INFO: Epoch[12] Iteration[100/273] Loss: 1.066, Acc: 0.914, Base Lr: 2.77e-03
2022-05-03 13:59:45,037 reid_baseline.train INFO: Epoch[12] Iteration[200/273] Loss: 1.075, Acc: 0.913, Base Lr: 2.77e-03
2022-05-03 14:00:21,710 reid_baseline.train INFO: Epoch 12 done. Time per batch: 0.536[s] Speed: 29.9[samples/s]
2022-05-03 14:04:57,437 reid_baseline.train INFO: normal accuracy 0.7794353913243057 2.29974627494812 
2022-05-03 14:04:57,439 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 12
2022-05-03 14:04:57,439 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 230.0%
2022-05-03 14:05:55,949 reid_baseline.train INFO: Epoch[13] Iteration[100/273] Loss: 1.041, Acc: 0.922, Base Lr: 2.20e-03
2022-05-03 14:06:54,218 reid_baseline.train INFO: Epoch[13] Iteration[200/273] Loss: 1.050, Acc: 0.921, Base Lr: 2.20e-03
2022-05-03 14:07:28,886 reid_baseline.train INFO: Epoch 13 done. Time per batch: 0.555[s] Speed: 28.8[samples/s]
2022-05-03 14:11:50,408 reid_baseline.train INFO: normal accuracy 0.7794353913243057 2.2688558101654053 
2022-05-03 14:11:50,408 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 13
2022-05-03 14:11:50,409 reid_baseline.train INFO: Accuracy: 77.9% Mean Entropy: 226.9%
2022-05-03 14:12:47,327 reid_baseline.train INFO: Epoch[14] Iteration[100/273] Loss: 1.051, Acc: 0.918, Base Lr: 1.66e-03
2022-05-03 14:13:39,714 reid_baseline.train INFO: Epoch[14] Iteration[200/273] Loss: 1.044, Acc: 0.924, Base Lr: 1.66e-03
2022-05-03 14:14:19,889 reid_baseline.train INFO: Epoch 14 done. Time per batch: 0.548[s] Speed: 29.2[samples/s]
2022-05-03 14:18:52,663 reid_baseline.train INFO: normal accuracy 0.782648611429883 2.234572410583496 
2022-05-03 14:18:53,626 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 14
2022-05-03 14:18:53,626 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 223.5%
2022-05-03 14:19:55,318 reid_baseline.train INFO: Epoch[15] Iteration[100/273] Loss: 1.045, Acc: 0.927, Base Lr: 1.19e-03
2022-05-03 14:20:48,276 reid_baseline.train INFO: Epoch[15] Iteration[200/273] Loss: 1.043, Acc: 0.924, Base Lr: 1.19e-03
2022-05-03 14:21:24,818 reid_baseline.train INFO: Epoch 15 done. Time per batch: 0.554[s] Speed: 28.9[samples/s]
2022-05-03 14:25:48,136 reid_baseline.train INFO: normal accuracy 0.782419095708056 2.218184232711792 
2022-05-03 14:25:49,152 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 15
2022-05-03 14:25:49,153 reid_baseline.train INFO: Accuracy: 78.2% Mean Entropy: 221.8%
2022-05-03 14:26:49,420 reid_baseline.train INFO: Epoch[16] Iteration[100/273] Loss: 1.021, Acc: 0.934, Base Lr: 7.78e-04
2022-05-03 14:27:48,180 reid_baseline.train INFO: Epoch[16] Iteration[200/273] Loss: 1.018, Acc: 0.934, Base Lr: 7.78e-04
2022-05-03 14:28:28,940 reid_baseline.train INFO: Epoch 16 done. Time per batch: 0.584[s] Speed: 27.4[samples/s]
2022-05-03 14:32:54,660 reid_baseline.train INFO: normal accuracy 0.7851732843699794 2.2453627586364746 
2022-05-03 14:32:54,663 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 16
2022-05-03 14:32:54,663 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 224.5%
2022-05-03 14:33:49,146 reid_baseline.train INFO: Epoch[17] Iteration[100/273] Loss: 1.031, Acc: 0.933, Base Lr: 4.51e-04
2022-05-03 14:34:38,966 reid_baseline.train INFO: Epoch[17] Iteration[200/273] Loss: 1.029, Acc: 0.925, Base Lr: 4.51e-04
2022-05-03 14:35:16,492 reid_baseline.train INFO: Epoch 17 done. Time per batch: 0.519[s] Speed: 30.8[samples/s]
2022-05-03 14:39:25,714 reid_baseline.train INFO: normal accuracy 0.7844847372044985 2.2165274620056152 
2022-05-03 14:39:26,650 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 17
2022-05-03 14:39:26,650 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 221.7%
2022-05-03 14:40:28,175 reid_baseline.train INFO: Epoch[18] Iteration[100/273] Loss: 1.019, Acc: 0.939, Base Lr: 2.11e-04
2022-05-03 14:41:23,764 reid_baseline.train INFO: Epoch[18] Iteration[200/273] Loss: 1.028, Acc: 0.932, Base Lr: 2.11e-04
2022-05-03 14:42:00,084 reid_baseline.train INFO: Epoch 18 done. Time per batch: 0.561[s] Speed: 28.5[samples/s]
2022-05-03 14:46:13,330 reid_baseline.train INFO: normal accuracy 0.7854028000918063 2.2597992420196533 
2022-05-03 14:46:13,332 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 18
2022-05-03 14:46:13,333 reid_baseline.train INFO: Accuracy: 78.5% Mean Entropy: 226.0%
2022-05-03 14:47:08,735 reid_baseline.train INFO: Epoch[19] Iteration[100/273] Loss: 1.019, Acc: 0.941, Base Lr: 6.51e-05
2022-05-03 14:48:04,222 reid_baseline.train INFO: Epoch[19] Iteration[200/273] Loss: 1.015, Acc: 0.936, Base Lr: 6.51e-05
2022-05-03 14:48:45,436 reid_baseline.train INFO: Epoch 19 done. Time per batch: 0.557[s] Speed: 28.7[samples/s]
2022-05-03 14:53:03,846 reid_baseline.train INFO: normal accuracy 0.7837961900390177 2.241685390472412 
2022-05-03 14:53:03,848 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 19
2022-05-03 14:53:03,848 reid_baseline.train INFO: Accuracy: 78.4% Mean Entropy: 224.2%
2022-05-03 14:54:05,113 reid_baseline.train INFO: Epoch[20] Iteration[100/273] Loss: 1.026, Acc: 0.929, Base Lr: 1.60e-05
2022-05-03 14:54:54,830 reid_baseline.train INFO: Epoch[20] Iteration[200/273] Loss: 1.025, Acc: 0.931, Base Lr: 1.60e-05
2022-05-03 14:55:31,660 reid_baseline.train INFO: Epoch 20 done. Time per batch: 0.541[s] Speed: 29.6[samples/s]
2022-05-03 14:59:45,176 reid_baseline.train INFO: normal accuracy 0.7833371585953638 2.2035250663757324 
2022-05-03 14:59:46,035 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Epoch: 20
2022-05-03 14:59:46,035 reid_baseline.train INFO: Accuracy: 78.3% Mean Entropy: 220.4%
Loading pretrained model for finetuning from ../remote_logs/pretrain/deit_base/office-home/Clipart_2_Real_World_shuffled_Cross_Domain_key_layer_12/transformer_best_model.pth
2022-05-03 15:04:04,551 reid_baseline.train INFO: normal accuracy 0.7833371585953638 2.2035250663757324 
2022-05-03 15:04:04,551 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 15:04:04,552 reid_baseline.train INFO: Accuracy: 78.3%
2022-05-03 15:08:41,457 reid_baseline.train INFO: normal accuracy 0.7833371585953638 2.2035250663757324 
2022-05-03 15:08:41,458 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 15:08:41,458 reid_baseline.train INFO: Shuffled Accuracy: 78.3%
2022-05-03 15:10:14,588 reid_baseline.train INFO: normal accuracy 0.9576174112256587 1.2070893049240112 
2022-05-03 15:10:14,589 reid_baseline.train INFO: Classify Domain Adapatation Validation Results - Best Model
2022-05-03 15:10:14,589 reid_baseline.train INFO: Source Clean Accuracy: 95.8%
